const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/groupLayerUtils-cDJLnamk.js","assets/index-BqmCqmfp.js","assets/index-kIqmb12G.css","assets/originUtils-Xpg5-Q2D.js","assets/utils-yJnMCzaE.js","assets/saveUtils-DsVVlvmj.js","assets/resourceUtils-CEABprin.js","assets/resourceUtils-Dtqy_ILo.js"])))=>i.map(i=>d[i]);
import{CD as e,Cw as t,Hb as n,Hx as r,Kb as i,Kw as a,MC as o,Mb as s,Q as c,Qw as l,Uy as u,Vb as d,X as f,_x as p,ah as m,ao as h,cC as g,dw as _,kC as v,ka as y,mb as b,oC as x,oh as S,qb as C,rt as w,sh as T,vE as E}from"./index-BqmCqmfp.js";import{n as D}from"./saveUtils-DsVVlvmj.js";import"./associatedFeatureServiceUtils-C1iuzbPQ.js";import"./fetchService-BUtv2ntd.js";import"./loadUtils-BWnAUV23.js";import{t as O}from"./lazyLayerLoader-DjJLNY3M.js";import{t as k}from"./layersCreator-B-_WTkJO.js";import"./portalLayers-DW_lsX5Z.js";import{t as A}from"./tagSymbols-CNjeVVdC.js";var j=class extends y(f(w(c(m(S(h(s))))))){constructor(e){super(e),this.allLayers=new u({getCollections:()=>[this.layers],getChildrenFunction:e=>`layers`in e?e.layers:null}),this.allTables=T(this),this.fullExtent=void 0,this.operationalLayerType=`GroupLayer`,this.spatialReference=void 0,this.type=`group`,this._debouncedSaveOperations=a(async(e,n,r)=>{let{save:i,saveAs:a}=await t(async()=>{let{save:e,saveAs:t}=await import(`./groupLayerUtils-cDJLnamk.js`);return{save:e,saveAs:t}},__vite__mapDeps([0,1,2,3,4,5,6,7]));switch(e){case 0:return i(this,n);case 1:return a(this,r,n)}})}initialize(){this._enforceVisibility(this.visibilityMode,this.visible),this.addHandles([i(()=>{let e=this.parent;for(;e&&`parent`in e&&e.parent;)e=e.parent;return e&&A in e},e=>{let t=`prevent-adding-tables`;this.removeHandles(t),e&&(this.tables.removeAll(),this.addHandles(n(()=>this.tables,`before-add`,e=>{e.preventDefault(),E.getLogger(this).errorOnce(`tables`,`tables in group layers in a webscene are not supported. Please move the tables from the group layer to the webscene if you want to persist them.`)}),t))},C),i(()=>this.visible,this._onVisibilityChange.bind(this),d)])}destroy(){this.allLayers.destroy(),this.allTables.destroy()}get sourceIsPortalItem(){return this.portalItem&&this.originIdOf(`portalItem`)===7}_writeLayers(e,t,n,r){let i=[];if(!e)return i;e.forEach(e=>{let t=b(e,r.webmap?r.webmap.getLayerJSONFromResourceInfo(e):null,r);t?.layerType&&i.push(t)}),t.layers=i}set portalItem(e){this._set(`portalItem`,e)}readPortalItem(e,t,n){let{itemId:r,layerType:i}=t;if(i===`GroupLayer`&&r)return new p({id:r,portal:n?.portal})}writePortalItem(e,t){e?.id&&(t.itemId=e.id)}set visibilityMode(e){let t=this._get(`visibilityMode`)!==e;this._set(`visibilityMode`,e),t&&this._enforceVisibility(e,this.visible)}async beforeSave(){return D(this)}load(e){let t=this.loadFromPortal({supportedTypes:[`Feature Service`,`Feature Collection`,`Group Layer`,`Scene Service`,`Video Service`],layerModuleTypeMap:O,populateGroupLayer:k},e).catch(e=>{if(l(e),this.sourceIsPortalItem)throw e});return this.addResolvingPromise(t),Promise.resolve(this)}async loadAll(){return g(this,e=>{e(this.layers,this.tables)})}async save(e){return this._debouncedSaveOperations(0,e)}async saveAs(e,t){return this._debouncedSaveOperations(1,t,e)}layerAdded(e){e.visible&&this.visibilityMode===`exclusive`?this._turnOffOtherLayers(e):this.visibilityMode===`inherited`&&(e.visible=this.visible),this.hasHandles(e.uid)?console.error(`Layer read to Grouplayer: uid=${e.uid}`):this.addHandles(i(()=>e.visible,t=>this._onChildVisibilityChange(e,t),d),e.uid)}layerRemoved(e){this.removeHandles(e.uid),this._enforceVisibility(this.visibilityMode,this.visible)}_turnOffOtherLayers(e){this.layers.forEach(t=>{t!==e&&(t.visible=!1)})}_enforceVisibility(e,t){if(!_(this).initialized)return;let n=this.layers,r=n.find(e=>e.visible);switch(e){case`exclusive`:n.length&&!r&&(r=n.at(0),r.visible=!0),this._turnOffOtherLayers(r);break;case`inherited`:n.forEach(e=>{e.visible=t})}}_onVisibilityChange(e){this.visibilityMode===`inherited`&&this.layers.forEach(t=>{t.visible=e})}_onChildVisibilityChange(e,t){switch(this.visibilityMode){case`exclusive`:t?this._turnOffOtherLayers(e):this._isAnyLayerVisible()||(e.visible=!0);break;case`inherited`:e.visible=this.visible}}_isAnyLayerVisible(){return this.layers.some(e=>e.visible)}};e([o({readOnly:!0,dependsOn:[]})],j.prototype,`allLayers`,void 0),e([o({readOnly:!0})],j.prototype,`allTables`,void 0),e([o({json:{read:!0,write:!0}})],j.prototype,`blendMode`,void 0),e([o()],j.prototype,`fullExtent`,void 0),e([o({readOnly:!0})],j.prototype,`sourceIsPortalItem`,null),e([o({json:{read:!1,write:{ignoreOrigin:!0}}})],j.prototype,`layers`,void 0),e([x(`layers`)],j.prototype,`_writeLayers`,null),e([o({type:[`GroupLayer`]})],j.prototype,`operationalLayerType`,void 0),e([o({json:{origins:{"web-map":{read:!1,write:{overridePolicy(e,t,n){return{enabled:e?.type===`Group Layer`&&n?.initiator!==this}}}},"web-scene":{read:!1,write:!1}}}})],j.prototype,`portalItem`,null),e([r(`web-map`,`portalItem`,[`itemId`])],j.prototype,`readPortalItem`,null),e([x(`web-map`,`portalItem`,{itemId:{type:String}})],j.prototype,`writePortalItem`,null),e([o()],j.prototype,`spatialReference`,void 0),e([o({json:{read:!1},readOnly:!0,value:`group`})],j.prototype,`type`,void 0),e([o({type:[`independent`,`inherited`,`exclusive`],value:`independent`,json:{write:!0,origins:{"web-map":{type:[`independent`,`exclusive`],write:(e,t,n)=>{e!==`inherited`&&(t[n]=e)}}}}})],j.prototype,`visibilityMode`,null),j=e([v(`esri.layers.GroupLayer`)],j);var M=j;export{M as default};