import{$l as e,Al as t,CD as n,If as r,Jg as i,Jl as a,Kf as o,LE as s,Mf as c,Ml as l,Ol as u,Qg as d,Rl as f,Ul as p,VC as m,VE as h,Wl as g,XE as _,Xg as v,Xs as y,Ys as b,_E as x,ac as S,ap as C,au as w,aw as T,dc as E,ip as D,iu as O,nu as k,ru as A,uD as j,vh as M,yh as N,zl as P}from"./index-BqmCqmfp.js";import{i as F,t as I}from"./Indices-BsTLKVdx.js";import{D as L,M as R,N as z,O as B,P as V,V as ee,b as H,k as te,u as U,z as ne}from"./BufferView-DNaZpbJX.js";import{a as W}from"./Util-3rPi0NfK.js";import{u as re}from"./Emissions.glsl-DaTtsIIp.js";import{t as ie}from"./NoParameters-CpAItLvD.js";import{t as ae}from"./triangle-1kWe4-AP.js";import{c as oe,i as se,o as ce,u as le}from"./renderState-Be6uDhGv.js";import{r as ue}from"./MaterialUtil-DdudaLIK.js";var de=class{constructor(){this.uid=m()}},fe=class extends de{constructor(e){super(),this.highlightName=e,this.channel=0}},pe=class extends de{constructor(){super(...arguments),this.channel=1}},me=ce(1,0,1,771);function he(e,t=!1){switch(e){case 0:return t?oe:le;case 1:return me;case 2:case 3:return null}}function ge(e){if(e.draped)return null;switch(e.oitPass){case 0:case 2:return e.writeDepth?se:null;case 1:case 3:return null}}var _e=5e5,ve={factor:-1,units:-2};function ye({oitPass:e,enableOffset:t}){return t&&e===1?ve:null}function be(e,t=513){return e===0||e===2?t:515}function xe(e,t){let n=re(t);return e===1?n?{buffers:[y,b,S]}:{buffers:[y,b]}:n?{buffers:[y,b]}:null}var Se=class{constructor(e){this._bits=[...e]}equals(e){return j(this._bits,e.bits)}get code(){return this._code??=String.fromCharCode(...this._bits),this._code}get bits(){return this._bits}},Ce=class extends ie{constructor(){super(),this._parameterBits=this._parameterBits?.map(()=>0)??[],this._parameterNames??=[]}get key(){return this._key??=new Se(this._parameterBits),this._key}decode(e=this.key){let t=this._parameterBits;this._parameterBits=[...e.bits];let n=this._parameterNames.map(e=>`    ${e}: ${this[e]}`).join(`
`);return this._parameterBits=t,n}};function G(e={}){return(t,n)=>{t.hasOwnProperty(`_parameterNames`)||Object.defineProperty(t,`_parameterNames`,{value:t._parameterNames?.slice()??[],configurable:!0,writable:!0}),t.hasOwnProperty(`_parameterBits`)||Object.defineProperty(t,`_parameterBits`,{value:t._parameterBits?.slice()??[0],configurable:!0,writable:!0}),t._parameterNames.push(n);let r=e.count||2,i=Math.ceil(Math.log2(r)),a=t._parameterBits,o=0;for(;a[o]+i>16;)o++,o>=a.length&&a.push(0);let s=a[o],c=(1<<i)-1<<s;a[o]+=i,e.count?Object.defineProperty(t,n,{get(){return(this._parameterBits[o]&c)>>s},set(t){if(this[n]!==t){if(this._key=null,this._parameterBits[o]=this._parameterBits[o]&~c|+t<<s&c,typeof t!=`number`)throw new x(`internal:invalid-shader-configuration`,`Configuration value for ${n} must be a number, got ${typeof t}`);if(e.count==null)throw new x(`internal:invalid-shader-configuration`,`Configuration value for ${n} must provide a count option`)}}}):Object.defineProperty(t,n,{get(){return!!((this._parameterBits[o]&c)>>s)},set(e){if(this[n]!==e&&(this._key=null,this._parameterBits[o]=this._parameterBits[o]&~c|+e<<s&c,typeof e!=`boolean`))throw new x(`internal:invalid-shader-configuration`,`Configuration value for ${n} must be boolean, got ${typeof e}`)}})}}function we(e){if(e.length<1024)return Array.from(e);if(Array.isArray(e))return Float64Array.from(e);if(!(`BYTES_PER_ELEMENT`in e))return Array.from(e);switch(e.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(e);case 2:return h(e)?ee().from(e):s(e)?Uint16Array.from(e):Int16Array.from(e);case 4:return Float32Array.from(e);default:return Float64Array.from(e)}}var Te=class e{get center(){return v(this._data[0],this._data[1],this._data[2])}get radius(){return this._data[3]}get bbMin(){return v(this._data[4],this._data[5],this._data[6])}get bbMax(){return v(this._data[7],this._data[8],this._data[9])}constructor(e,t,n){this.primitiveIndices=e,this._numIndexPerPrimitive=t,this.position=n,this._data=[.1,0,0,0,0,0,0,0,0,0],this._children=void 0,W(e.length>=1),W(n.size===3||n.size===4);let{data:r,size:a,indices:o}=n;W(o.length%this._numIndexPerPrimitive===0),W(o.length>=e.length*this._numIndexPerPrimitive);let s=e.length,c=a*o[this._numIndexPerPrimitive*e[0]];K.clear(),K.push(c);let u=v(r[c],r[c+1],r[c+2]),f=d(u);for(let t=0;t<s;++t){let n=this._numIndexPerPrimitive*e[t];for(let e=0;e<this._numIndexPerPrimitive;++e){c=a*o[n+e],K.push(c);let t=r[c];u[0]=Math.min(t,u[0]),f[0]=Math.max(t,f[0]),t=r[c+1],u[1]=Math.min(t,u[1]),f[1]=Math.max(t,f[1]),t=r[c+2],u[2]=Math.min(t,u[2]),f[2]=Math.max(t,f[2])}}for(let e=0;e<3;++e)this._data[4+e]=u[e],this._data[7+e]=f[e];let p=l(i(),this.bbMin,this.bbMax,.5),m=.5*Math.max(Math.max(f[0]-u[0],f[1]-u[1]),f[2]-u[2]),h=m*m;for(let e=0;e<K.length;++e){c=K.at(e);let t=r[c]-p[0],n=r[c+1]-p[1],i=r[c+2]-p[2],a=t*t+n*n+i*i;if(a<=h)continue;let o=Math.sqrt(a),s=.5*(o-m);m+=s,h=m*m;let l=s/o;p[0]+=t*l,p[1]+=n*l,p[2]+=i*l}this._data[3]=m;for(let e=0;e<3;++e)this._data[0+e]=p[e];K.clear()}getChildren(){if(this._children||w(this.bbMin,this.bbMax)<=1)return this._children;let t=l(i(),this.bbMin,this.bbMax,.5),n=this.primitiveIndices.length,r=new Uint8Array(n),a=Array(8);for(let e=0;e<8;++e)a[e]=0;let{data:o,size:s,indices:c}=this.position;for(let e=0;e<n;++e){let n=0,i=this._numIndexPerPrimitive*this.primitiveIndices[e],l=s*c[i],u=o[l],d=o[l+1],f=o[l+2];for(let e=1;e<this._numIndexPerPrimitive;++e){l=s*c[i+e];let t=o[l],n=o[l+1],r=o[l+2];t<u&&(u=t),n<d&&(d=n),r<f&&(f=r)}u<t[0]&&(n|=1),d<t[1]&&(n|=2),f<t[2]&&(n|=4),r[e]=n,++a[n]}let u=0;for(let e=0;e<8;++e)a[e]>0&&++u;if(u<2)return;let d=Array(8);for(let e=0;e<8;++e)d[e]=a[e]>0?new Uint32Array(a[e]):void 0;for(let e=0;e<8;++e)a[e]=0;for(let e=0;e<n;++e){let t=r[e];d[t][a[t]++]=this.primitiveIndices[e]}this._children=[];for(let t=0;t<8;++t)d[t]!==void 0&&this._children.push(new e(d[t],this._numIndexPerPrimitive,this.position));return this._children}static prune(){K.prune()}},K=new T({deallocator:null}),Ee=class{constructor(e){this.id=m(),this._attributes=new Map;for(let[t,n]of e)this._attributes.set(t,{...n,indices:F(n.indices)})}get attributes(){return this._attributes}};function De(t,n){if(!t)return!1;let{size:r,data:i,indices:o}=t;e(n,0,0,0),e(Y,0,0,0);let s=0,c=0;for(let t=0;t<o.length-2;t+=3){let l=o[t]*r,u=o[t+1]*r,d=o[t+2]*r;e(q,i[l],i[l+1],i[l+2]),e(J,i[u],i[u+1],i[u+2]),e(Ae,i[d],i[d+1],i[d+2]);let f=ae(q,J,Ae);f?(O(q,q,J),O(q,q,Ae),a(q,q,1/3*f),O(n,n,q),s+=f):(O(Y,Y,q),O(Y,Y,J),O(Y,Y,Ae),c+=3)}return(c!==0||s!==0)&&(s===0?c!==0&&(a(n,Y,1/c),!0):(a(n,n,1/s),!0))}function Oe(t,n){if(!t)return!1;let{size:r,data:i,indices:o}=t;e(n,0,0,0);let s=-1,c=0;for(let e=0;e<o.length;e++){let t=o[e]*r;s!==t&&(n[0]+=i[t],n[1]+=i[t+1],n[2]+=i[t+2],c++),s=t}return c>1&&a(n,n,1/c),c>0}function ke(t,n,r){if(!t)return!1;e(r,0,0,0),e(Y,0,0,0);let i=0,o=0,{size:s,data:c,indices:l}=t,u=l.length-1,d=u+(n?2:0);for(let e=0;e<d;e+=2){let t=e<u?e+1:0,n=l[e<u?e:u]*s,d=l[t]*s;q[0]=c[n],q[1]=c[n+1],q[2]=c[n+2],J[0]=c[d],J[1]=c[d+1],J[2]=c[d+2],a(q,O(q,q,J),.5);let f=P(q,J);f>0?(O(r,r,a(q,q,f)),i+=f):i===0&&(O(Y,Y,q),o++)}return i===0?o!==0&&(a(r,Y,1/o),!0):(a(r,r,1/i),!0)}var q=i(),J=i(),Ae=i(),Y=i(),je=class e extends Ee{constructor(e,t,n=null,r=0,i=null,a=-1,o){super(t),this.material=e,this.mapPositions=n,this.type=r,this.olidColor=i,this.edgeIndicesLength=a,this.baseGeometry=o,this._highlights=null,this._highlightOptionsCounts=null,this.visible=!0,this._boundingInfo=null;let s=this.positionAttribute;s!=null&&this.edgeIndicesLength<0&&(this.edgeIndicesLength=s.indices.length)}instantiate(t={}){let n=new e(t.material||this.material,[],this.mapPositions,this.type,this.olidColor,this.edgeIndicesLength,this.baseGeometry);return this._attributes.forEach((e,t)=>{e.exclusive=!1,n._attributes.set(t,e)}),n._boundingInfo=this._boundingInfo,n.transformation=t.transformation||this.transformation,n}getMutableAttribute(e){let t=this._attributes.get(e);return t&&!t.exclusive&&(t={...t,exclusive:!0,data:we(t.data)},this._attributes.set(e,t)),t}setAttributeData(e,t){let n=this._attributes.get(e);n?this._attributes.set(e,{...n,exclusive:!0,data:t}):E()&&console.warn(`Setting undefined attribute ${e} data`)}get positionAttribute(){return this.attributes.get(`position`)??this.baseGeometry?.attributes.get(`position`)}get indexCount(){return this._attributes.values().next().value?.indices?.length??0}get faceCount(){return this.indexCount/3}get boundingInfo(){return this._boundingInfo??=this._calculateBoundingInfo(),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===0?this._computeAttachmentOriginTriangles(e):this.type===2?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(this._transformation!=null&&t(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){let t=this.positionAttribute;return De(t,e)}_computeAttachmentOriginLines(e){let t=this.positionAttribute;return ke(t,Me(this.material.parameters,t),e)}_computeAttachmentOriginPoints(e){let t=this.positionAttribute;return Oe(t,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){let e=this.positionAttribute;if(!e||e.indices.length===0)return null;let t=this.type===0?3:1;W(e.indices.length%t===0,`Indexing error: `+e.indices.length+` not divisible by `+t);let n=I(e.indices.length/t);return new Te(n,t,e)}get transformation(){return this._transformation??D}set transformation(e){this._transformation=e&&e!==D?C(e):null}get highlights(){return this._highlights||Ne}get hasHighlights(){return(this._highlightOptionsCounts?.size??0)>0}foreachHighlightOptions(e){this._highlightOptionsCounts?.forEach((t,n)=>e(n))}allocateIdAndHighlight(e){let t=new fe(e);return this.addHighlight(t)}addHighlight(e){this._ensureHighlights().add(e);let{highlightName:t}=e,n=(this._highlightOptionsCounts?.get(t)??0)+1;return this._ensureHighlightOptionsCounts().set(t,n),e}_ensureHighlights(){let e=this._highlights;return e||(e=new Set,this._highlights=e),e}_ensureHighlightOptionsCounts(){let e=this._highlightOptionsCounts;return e||(e=new Map,this._highlightOptionsCounts=e),e}removeHighlight(e){if(this._highlights?.delete(e)){let{highlightName:t}=e,n=this._highlightOptionsCounts?.get(t)??0;n<=1?this._highlightOptionsCounts?.delete(t):this._ensureHighlightOptionsCounts().set(t,n-1)}}};function Me(e,t){return!(!(`isClosed`in e)||!e.isClosed)&&t.indices.length>2}var Ne=new Set,Pe=class extends Ce{constructor(){super(...arguments),this.instancedDoublePrecision=!1,this.hasModelTransformation=!1}},X=class extends Pe{constructor(){super(...arguments),this.output=0,this.oitPass=0,this.hasSlicePlane=!1,this.hasHighlightMixTexture=!1,this.bindType=1,this.instanced=!1,this.writeDepth=!0}};n([G({count:11})],X.prototype,`output`,void 0),n([G({count:3})],X.prototype,`oitPass`,void 0),n([G()],X.prototype,`hasSlicePlane`,void 0),n([G()],X.prototype,`hasHighlightMixTexture`,void 0);var Fe=class{constructor(e,t){this.id=m(),this.supportsEdges=!1,this._renderPriority=0,this._parameters=new t,ue(this._parameters,e),this.validateParameters(this._parameters)}get parameters(){return this._parameters}update(e){return!1}setParameters(e,t=!0){ue(this._parameters,e)&&(this.validateParameters(this._parameters),t&&this._parametersChanged())}validateParameters(e){}shouldRender(e){return this.visible&&this.isVisibleForOutput(e.output)&&(!this.parameters.isDecoration||e.bind.decorations)&&(this.parameters.renderOccluded&e.renderOccludedMask)!==0}isVisibleForOutput(e){return!0}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this._parametersChanged())}_parametersChanged(){this.repository?.materialChanged(this)}get renderOccludedFlags(){return this.visible?this.parameters.renderOccluded:0}get hasEmissions(){return!1}getConfiguration(e,t,n=new X){return n.output=e,n.hasHighlightMixTexture=e===9&&t.highlightMixTexture!=null,n}},Ie=class extends ie{constructor(){super(...arguments),this.renderOccluded=1,this.isDecoration=!1}};function Le(e,t,n,r=1){let{data:i,indices:a}=e,o=t.typedBuffer,s=t.typedBufferStride,c=a.length;if(n*=s,r===1)for(let e=0;e<c;++e)o[n]=i[a[e]],n+=s;else for(let e=0;e<c;++e){let t=i[a[e]];for(let e=0;e<r;e++)o[n]=t,n+=s}}function Re(e,t,n){let{data:r,indices:i}=e,a=t.typedBuffer,o=t.typedBufferStride,s=i.length;n*=o;for(let e=0;e<s;++e){let t=2*i[e];a[n]=r[t],a[n+1]=r[t+1],n+=o}}function ze(e,t,n,r=1){let{data:i,indices:a}=e,o=t.typedBuffer,s=t.typedBufferStride,c=a.length;if(n*=s,r===1)for(let e=0;e<c;++e){let t=3*a[e];o[n]=i[t],o[n+1]=i[t+1],o[n+2]=i[t+2],n+=s}else for(let e=0;e<c;++e){let t=3*a[e];for(let e=0;e<r;++e)o[n]=i[t],o[n+1]=i[t+1],o[n+2]=i[t+2],n+=s}}function Be(e,t,n,r=1){let{data:i,indices:a}=e,o=t.typedBuffer,s=t.typedBufferStride,c=a.length;if(n*=s,r===1)for(let e=0;e<c;++e){let t=4*a[e];o[n]=i[t],o[n+1]=i[t+1],o[n+2]=i[t+2],o[n+3]=i[t+3],n+=s}else for(let e=0;e<c;++e){let t=4*a[e];for(let e=0;e<r;++e)o[n]=i[t],o[n+1]=i[t+1],o[n+2]=i[t+2],o[n+3]=i[t+3],n+=s}}function Ve(e,t,n){let r=e.typedBuffer,i=e.typedBufferStride;t*=i;for(let e=0;e<n;++e)r[t]=0,r[t+1]=0,r[t+2]=0,r[t+3]=0,t+=i}function He(e,t,n,r,i=1){if(!t)return void ze(e,n,r,i);let{data:a,indices:o}=e,s=n.typedBuffer,c=n.typedBufferStride,l=o.length,u=t[0],d=t[1],f=t[2],p=t[4],m=t[5],h=t[6],g=t[8],_=t[9],v=t[10],y=t[12],b=t[13],x=t[14];r*=c;let S=0,C=0,w=0,T=N(t)?e=>{S=a[e]+y,C=a[e+1]+b,w=a[e+2]+x}:e=>{let t=a[e],n=a[e+1],r=a[e+2];S=u*t+p*n+g*r+y,C=d*t+m*n+_*r+b,w=f*t+h*n+v*r+x};if(i===1)for(let e=0;e<l;++e)T(3*o[e]),s[r]=S,s[r+1]=C,s[r+2]=w,r+=c;else for(let e=0;e<l;++e){T(3*o[e]);for(let e=0;e<i;++e)s[r]=S,s[r+1]=C,s[r+2]=w,r+=c}}function Ue(e,t,n,r,i=1){if(!t)return void ze(e,n,r,i);let{data:a,indices:o}=e,s=t,c=n.typedBuffer,l=n.typedBufferStride,u=o.length,d=s[0],f=s[1],p=s[2],m=s[4],h=s[5],g=s[6],_=s[8],v=s[9],y=s[10],b=!M(s),x=1e-6,S=1-x;r*=l;let C=0,w=0,T=0,E=N(s)?e=>{C=a[e],w=a[e+1],T=a[e+2]}:e=>{let t=a[e],n=a[e+1],r=a[e+2];C=d*t+m*n+_*r,w=f*t+h*n+v*r,T=p*t+g*n+y*r};if(i===1)if(b)for(let e=0;e<u;++e){E(3*o[e]);let t=C*C+w*w+T*T;if(t<S&&t>x){let e=1/Math.sqrt(t);c[r]=C*e,c[r+1]=w*e,c[r+2]=T*e}else c[r]=C,c[r+1]=w,c[r+2]=T;r+=l}else for(let e=0;e<u;++e)E(3*o[e]),c[r]=C,c[r+1]=w,c[r+2]=T,r+=l;else for(let e=0;e<u;++e){if(E(3*o[e]),b){let e=C*C+w*w+T*T;if(e<S&&e>x){let t=1/Math.sqrt(e);C*=t,w*=t,T*=t}}for(let e=0;e<i;++e)c[r]=C,c[r+1]=w,c[r+2]=T,r+=l}}function We(e,t,n,r,i=1){if(!t)return void Be(e,n,r,i);let{data:a,indices:o}=e,s=t,c=n.typedBuffer,l=n.typedBufferStride,u=o.length,d=s[0],f=s[1],p=s[2],m=s[4],h=s[5],g=s[6],_=s[8],v=s[9],y=s[10],b=!M(s),x=1e-6,S=1-x;if(r*=l,i===1)for(let e=0;e<u;++e){let t=4*o[e],n=a[t],i=a[t+1],s=a[t+2],u=a[t+3],C=d*n+m*i+_*s,w=f*n+h*i+v*s,T=p*n+g*i+y*s;if(b){let e=C*C+w*w+T*T;if(e<S&&e>x){let t=1/Math.sqrt(e);C*=t,w*=t,T*=t}}c[r]=C,c[r+1]=w,c[r+2]=T,c[r+3]=u,r+=l}else for(let e=0;e<u;++e){let t=4*o[e],n=a[t],s=a[t+1],u=a[t+2],C=a[t+3],w=d*n+m*s+_*u,T=f*n+h*s+v*u,E=p*n+g*s+y*u;if(b){let e=w*w+T*T+E*E;if(e<S&&e>x){let t=1/Math.sqrt(e);w*=t,T*=t,E*=t}}for(let e=0;e<i;++e)c[r]=w,c[r+1]=T,c[r+2]=E,c[r+3]=C,r+=l}}function Ge(e,t,n,r,i=1){let{data:a,indices:o}=e,s=n.typedBuffer,c=n.typedBufferStride,l=o.length;if(r*=c,t===a.length&&t===4){s[r]=a[0],s[r+1]=a[1],s[r+2]=a[2],s[r+3]=a[3];let e=new Uint32Array(n.typedBuffer.buffer,n.start),t=c/4,o=e[r/=4];r+=t;let u=l*i;for(let n=1;n<u;++n)e[r]=o,r+=t;return}if(i!==1)if(t!==4)for(let e=0;e<l;++e){let t=3*o[e];for(let e=0;e<i;++e)s[r]=a[t],s[r+1]=a[t+1],s[r+2]=a[t+2],s[r+3]=255,r+=c}else for(let e=0;e<l;++e){let t=4*o[e];for(let e=0;e<i;++e)s[r]=a[t],s[r+1]=a[t+1],s[r+2]=a[t+2],s[r+3]=a[t+3],r+=c}else{if(t===4){for(let e=0;e<l;++e){let t=4*o[e];s[r]=a[t],s[r+1]=a[t+1],s[r+2]=a[t+2],s[r+3]=a[t+3],r+=c}return}for(let e=0;e<l;++e){let t=3*o[e];s[r]=a[t],s[r+1]=a[t+1],s[r+2]=a[t+2],s[r+3]=255,r+=c}}}function Ke(e,t,n){let{data:r,indices:i}=e,a=t.typedBuffer,o=t.typedBufferStride,s=i.length,c=r[0];n*=o;for(let e=0;e<s;++e)a[n]=c,n+=o}function qe(e,t,n,r){g(Z,e,t);let i=Math.max(Math.sqrt(k(Z)),1e-4);a(Z,Z,1/i),n[r++]=Z[0],n[r++]=Z[1],n[r++]=Z[2],n[r++]=i}var Z=i();function Je(e,t,n,r,i=1){let a=t.typedBuffer,o=t.typedBufferStride;if(r*=o,i===1)for(let t=0;t<n;++t)a[r]=e[0],a[r+1]=e[1],a[r+2]=e[2],a[r+3]=e[3],r+=o;else for(let t=0;t<n;++t)for(let t=0;t<i;++t)a[r]=e[0],a[r+1]=e[1],a[r+2]=e[2],a[r+3]=e[3],r+=o}function Ye(e,t,n,r,i,a,o){let s={numItems:0,numVerticesPerItem:0};for(let c of n.fields.keys()){let n=e.get(c),l=n?.indices;if(n&&l)c===`position`&&(s={numItems:1,numVerticesPerItem:l.length}),Xe(c,n,r,i,a,o);else if(c===`olidColor`&&t!=null){let n=e.get(`position`)?.indices;if(n){let e=n.length;Je(t,a.getField(c,B),e,o)}}}return s}function Xe(e,t,n,r,i,a){switch(e){case`position`:{W(t.size===3);let r=i.getField(e,z);W(!!r,`No buffer view for ${e}`),He(t,n,r,a);break}case`normal`:{W(t.size===3);let n=i.getField(e,z);W(!!n,`No buffer view for ${e}`),Ue(t,r,n,a);break}case`normalCompressed`:case`profileRight`:case`profileUp`:{W(t.size===2);let n=i.getField(e,U);W(!!n,`No buffer view for ${e}`),Re(t,n,a);break}case`uv0`:{W(t.size===2);let n=i.getField(e,V)??i.getField(e,ne);W(!!n,`No buffer view for ${e}`),Re(t,n,a);break}case`uvi`:{W(t.size===2);let n=i.getField(e,U);W(!!n,`No buffer view for ${e}`),Re(t,n,a);break}case`color`:case`symbolColor`:{let n=i.getField(e,B);W(!!n,`No buffer view for ${e}`),W(t.size===3||t.size===4),Ge(t,t.size,n,a);break}case`colorFeatureAttribute`:case`opacityFeatureAttribute`:case`sizeFeatureAttribute`:{let n=i.getField(e,L)??i.getField(e,L);W(!!n,`No buffer view for ${e}`),W(t.size===1),Ke(t,n,a);break}case`tangent`:{W(t.size===4);let r=i.getField(e,H);W(!!r,`No buffer view for ${e}`),We(t,n,r,a);break}case`profileVertexAndNormal`:{W(t.size===4);let n=i.getField(e,R)??i.getField(e,H);W(!!n,`No buffer view for ${e}`),Be(t,n,a);break}case`profileAuxData`:{W(t.size===3);let n=i.getField(e,te)??i.getField(e,z);W(!!n,`No buffer view for ${e}`),ze(t,n,a);break}}}var Ze={func:513},Qe={func:519},$e={mask:255},et={mask:0},tt={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:0}},nt={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7681}},rt={function:{func:514,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}},it={function:{func:517,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}},at=class{constructor(e=0,t=!1,n=!0){this.tolerance=e,this.isVerticalRay=t,this.normalRequired=n}},ot=o();function st(e,t,n,r,i,a){if(!e.visible)return;let o=f(Et,r,n),s=(e,t,n)=>a(e,n,t),{tolerance:c}=t,l=new at(c,!1,t.options.normalRequired);if(e.boundingInfo)W(e.type===0),lt(e.boundingInfo,n,o,c,i,l,s);else{let t=e.positionAttribute,r=t.indices;ht(n,o,0,r.length/3,r,t.data,t.stride,i,l,s)}}var ct=i();function lt(e,t,n,i,a,o,s){if(e==null)return;let l=St(n,ct);if(c(ot,e.bbMin),r(ot,e.bbMax),a?.applyToAabb(ot),Ct(ot,t,l,i)){let{primitiveIndices:r,position:c}=e,l=r?r.length:c.indices.length/3;if(l>Tt){let r=e.getChildren();if(r!==void 0){for(let e of r)lt(e,t,n,i,a,o,s);return}}mt(t,n,0,l,c.indices,c.data,c.stride,r,a,o,s)}}var Q=i();function ut(e,t,n,r,i,a,o,s,c){let{data:l,stride:u}=a;ht(e,f(Et,t,e),n,r,i,l,u,o,s,c)}function dt(e,t,n,r){if(!n.visible)return;let i=(e,t,n)=>r(e,n,t),{boundingInfo:a}=n;if(a){let{bbMin:n,bbMax:r}=a;if(e<n[0]||e>r[0]||t<n[1]||t>r[1])return}let o=n.positionAttribute,s=o.indices;ft(e,t,0,s.length/3,s,o,i)}function ft(e,t,n,r,i,a,o){let{data:s,stride:c}=a;for(let a=n;a<r;++a){let n=3*a,r=c*i[n],l=c*i[n+1],u=c*i[n+2],d=s[r+0]-e,f=s[r+1]-t,p=s[l+0]-e,m=s[l+1]-t,h=s[u+0]-e,g=s[u+1]-t,_=h*m-g*p,v=d*g-f*h,y=p*f-m*d;(_<0||v<0||y<0)&&(_>0||v>0||y>0)||o(0,a,null)}}function pt(e,t,n,r,i,a,o,s){let c=e[0],l=e[1],u=e[2],d=t[0],f=t[1],p=t[2];for(let e=n;e<r;++e){let t=3*e,n=t+1,r=t+2,m=a*t,h=i[m],g=i[m+1],_=i[m+2],v=a*n,y=a*r,b=i[v]-h,x=i[v+1]-g,S=i[v+2]-_,C=i[y]-h,w=i[y+1]-g,T=i[y+2]-_,E=f*T-w*p,D=p*C-T*d,O=d*w-C*f,k=b*E+x*D+S*O;if(Math.abs(k)<=1e-7)continue;let A=c-h,j=l-g,M=u-_,N=A*E+j*D+M*O;if(k>0){if(N<0||N>k)continue}else if(N>0||N<k)continue;let P=j*S-x*M,F=M*b-S*A,I=A*x-b*j,L=d*P+f*F+p*I;if(k>0){if(L<0||N+L>k)continue}else if(L>0||N+L<k)continue;let R=(C*P+w*F+T*I)/k;R>=0&&s(R,e,o?yt(b,x,S,C,w,T,Q):null)}}function mt(e,t,n,r,i,a,o,s,c,l,u){let d=e[0],f=e[1],p=e[2],m=t[0],h=t[1],g=t[2],{normalRequired:_}=l;for(let e=n;e<r;++e){let t=s[e],n=3*t,r=o*i[n],l=a[r],v=a[r+1],y=a[r+2],b=o*i[n+1],x=a[b],S=a[b+1],C=a[b+2],w=o*i[n+2],T=a[w],E=a[w+1],D=a[w+2];c!=null&&([l,v,y]=c.applyToVertex(l,v,y,e),[x,S,C]=c.applyToVertex(x,S,C,e),[T,E,D]=c.applyToVertex(T,E,D,e));let O=x-l,k=S-v,A=C-y,j=T-l,M=E-v,N=D-y,P=h*N-M*g,F=g*j-N*m,I=m*M-j*h,L=O*P+k*F+A*I;if(Math.abs(L)<=1e-7)continue;let R=d-l,z=f-v,B=p-y,V=R*P+z*F+B*I;if(L>0){if(V<0||V>L)continue}else if(V>0||V<L)continue;let ee=z*A-k*B,H=B*O-A*R,te=R*k-O*z,U=m*ee+h*H+g*te;if(L>0){if(U<0||V+U>L)continue}else if(U>0||V+U<L)continue;let ne=(j*ee+M*H+N*te)/L;ne>=0&&u(ne,t,_?yt(O,k,A,j,M,N,Q):null)}}function ht(t,n,r,i,a,o,s,c,l,u){let d=n,p=Dt,m=Math.abs(d[0]),h=Math.abs(d[1]),g=Math.abs(d[2]),_=m>=h?m>=g?0:2:h>=g?1:2,v=_,y=d[v]<0?2:1,b=(_+y)%3,x=(_+(3-y))%3,S=d[b]/d[v],C=d[x]/d[v],w=1/d[v],T=gt,E=_t,D=vt,{normalRequired:O}=l;for(let n=r;n<i;++n){let r=3*n,i=s*a[r];e(p[0],o[i+0],o[i+1],o[i+2]);let l=s*a[r+1];e(p[1],o[l+0],o[l+1],o[l+2]);let d=s*a[r+2];e(p[2],o[d+0],o[d+1],o[d+2]),c&&(A(p[0],c.applyToVertex(p[0][0],p[0][1],p[0][2],n)),A(p[1],c.applyToVertex(p[1][0],p[1][1],p[1][2],n)),A(p[2],c.applyToVertex(p[2][0],p[2][1],p[2][2],n))),f(T,p[0],t),f(E,p[1],t),f(D,p[2],t);let m=T[b]-S*T[v],h=T[x]-C*T[v],g=E[b]-S*E[v],_=E[x]-C*E[v],y=D[b]-S*D[v],k=D[x]-C*D[v],j=y*_-k*g,M=m*k-h*y,N=g*h-_*m;if((j<0||M<0||N<0)&&(j>0||M>0||N>0))continue;let P=j+M+N;if(P===0)continue;let F=j*(w*T[v])+M*(w*E[v])+N*(w*D[v]);if(F*Math.sign(P)<0)continue;let I=F/P;I>=0&&u(I,n,O?bt(p):null)}}var gt=i(),_t=i(),vt=i();function yt(t,n,r,i,a,o,s){return e(xt,t,n,r),e($,i,a,o),p(s,xt,$),u(s,s),s}function bt(e){return f(xt,e[1],e[0]),f($,e[2],e[0]),p(Q,xt,$),u(Q,Q),Q}var xt=i(),$=i();function St(t,n){return e(n,1/t[0],1/t[1],1/t[2])}function Ct(e,t,n,r){return wt(e,t,n,r,1/0)}function wt(e,t,n,r,i){let a=(e[0]-r-t[0])*n[0],o=(e[3]+r-t[0])*n[0],s=Math.min(a,o),c=Math.max(a,o),l=(e[1]-r-t[1])*n[1],u=(e[4]+r-t[1])*n[1];if(c=Math.min(c,Math.max(l,u)),c<0||(s=Math.max(s,Math.min(l,u)),s>c))return!1;let d=(e[2]-r-t[2])*n[2],f=(e[5]+r-t[2])*n[2];return c=Math.min(c,Math.max(d,f)),!(c<0)&&(s=Math.max(s,Math.min(d,f)),!(s>c)&&s<i)}var Tt=1e3,Et=i(),Dt=[i(),i(),i()],Ot=class{constructor(e){this.layout=e}elementCount(e){return e.get(`position`).indices.length}write(e,t,n,r,i,a){return Ye(n,r,this.layout,e,t,i,a)}intersect(e,t,n,r,i,a,o){let s=this.layout.createView(e).getField(`position`,z);if(s==null)return;let c=f(kt,a,i),l=s.count/3,u=r.options.normalRequired;pt(i,c,0,l,s.typedBuffer,s.typedBufferStride,u,(e,t,n)=>o(e,n,t))}},kt=i();export{Ee as A,ye as B,Xe as C,Fe as D,Ie as E,he as F,fe as H,ve as I,xe as L,we as M,Ce as N,X as O,G as P,ge as R,Re as S,He as T,pe as U,be as V,Ge as _,dt as a,Be as b,tt as c,et as d,Qe as f,Je as g,Ve as h,at as i,Te as j,je as k,it as l,rt as m,ut as n,st as o,nt as p,Ct as r,Ze as s,Ot as t,$e as u,Ue as v,qe as w,Ye as x,Le as y,_e as z};