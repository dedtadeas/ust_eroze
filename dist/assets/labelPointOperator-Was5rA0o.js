import{n as e,t}from"./SimpleGeometryCursor-CI9GIWKa.js";import{B as n,I as r,cn as i,in as a,kt as o,mn as s,ut as c,vn as l}from"./Point2D-UYEfE6HP.js";import{t as u}from"./Envelope2D-BNwQDrOT.js";import{En as d,b as f,lt as p,on as m,pn as h,sn as g}from"./UnitFactory-J9WMNXdY.js";import{a as _,p as v,t as y}from"./apiConverter-DVPFZqjR.js";import{n as b}from"./Centroid-DZi-eb9F-BYEytAn0.js";import{t as x}from"./OperatorProximity-D_PK4-pg.js";var S=class{getOperatorType(){return 10203}accelerateGeometry(e,t,n){return!1}canAccelerateGeometry(e){return!1}supportsCurves(){return!0}executeMany(e,t){return new C(e,t)}execute(e,t){return new C(null,t).labelPoint(e)}},C=class extends e{progress_(){}tock(){return!0}getRank(){return 1}constructor(e,t){super(),this.m_index=-1,this.m_progressCounter=0,this.m_progressTracker=t,this.m_inputGeoms=e}next(){let e=this.m_inputGeoms.next();return e?(s(e),this.m_index=this.m_inputGeoms.getGeometryID(),this.labelPoint(e)):null}getGeometryID(){return this.m_index}labelPoint(e){if(e===null&&a(`null pointer is not allowed`),e.getGeometryType()===i.enumPoint)return e;if(e.isEmpty())return new d({vd:e.getDescription()});switch(e.getGeometryType()){case i.enumPolygon:return this.labelPointPolygon(e);case i.enumPolyline:return this.labelPointPolyline(e);case i.enumMultiPoint:return this.labelPointMultiPoint(e);case i.enumEnvelope:return this.labelPointEnvelope(e);default:a(`geometry is not supported`)}}labelPointPolygon(e){let t=new u;e.queryEnvelope(t);let r=h(null,t,!0).total(),i=null,a=e;if(e.hasNonLinearSegments()){let t=new g({copy:e}),n=p(t,.25*r,r);l(n!==e),i=n,a=i}let s=0,m=0;for(let e=0,t=a.getPathCount();e<t;++e){let t=Math.abs(a.calculateRingArea2D(e));t>m&&(m=t,s=e)}let _=new o;if(Math.abs(m)<=2*r*r?_.setNAN():_.assign(b(a,s)),Number.isNaN(_.x)){let e=new u;return a.queryPathEnvelope(s,e),new d({pt:e.getCenter()})}if(a.getPointCount()<4)return new d({x:_.x,y:_.y});let v=o.getNAN(),y=[v.clone(),v.clone(),v.clone(),v.clone()],S=[NaN,NaN,NaN,NaN],C=[NaN,NaN,NaN,NaN],w=!1,T=new x().getNearestCoordinate(a,_,!0,!1);if(T.m_distance===0&&(w=!0,y[0]=_,T=new x().getNearestCoordinate(a,_,!1,!1),T.m_distance>.25*t.minDimension()*1.66666666))return new d({x:_.x,y:_.y});S[0]=T.m_distance,C[0]=0;let E=new o,D=!1,O=.25,k=-1,A=new u;a.queryPathEnvelope(s,A);do{let e=NaN;if(y[1]=this.calculateParacentroid_(a,n(A.xmin,A.xmax,O),r),y[1].isNAN()||(T=new x().getNearestCoordinate(a,y[1],!1,!1),e=T.m_distance),e>r&&f(a,y[1],r)===1)D=!0,S[1]=e,C[1]=o.sqrDistance(y[1],_);else if(e>k&&(k=e,E.setCoordsPoint2D(y[1])),O-=.01,O<.1){if(!(k>=0))break;D=!0,S[1]=k,y[1]=E,C[1]=o.sqrDistance(y[1],_)}}while(!D);D=!1,O=.5,k=-1;let j=.01,M=1;do{let e=NaN;if(y[2]=this.calculateParacentroid_(a,n(A.xmin,A.xmax,O),r),y[2].isNAN()||(T=new x().getNearestCoordinate(a,y[2],!1,!1),e=T.m_distance),e>r&&f(a,y[2],r)===1)D=!0,S[2]=e,C[2]=o.sqrDistance(y[2],_);else if(e>k&&(k=e,E.setCoordsPoint2D(y[2])),O=.5+j*M,j+=.01,M*=-1,O<.3||O>.7){if(!(k>=0))break;D=!0,S[2]=k,y[2]=E,C[2]=o.sqrDistance(y[2],_)}}while(!D);D=!1,O=.75,k=-1;do{let e=NaN;if(y[3]=this.calculateParacentroid_(a,n(A.xmin,A.xmax,O),r),y[3].isNAN()||(T=new x().getNearestCoordinate(a,y[3],!1,!1),e=T.m_distance),e>r&&f(a,y[3],r)===1)D=!0,S[3]=e,C[3]=o.sqrDistance(y[3],_);else if(e>k&&(k=e,E.setCoordsPoint2D(y[3])),O+=.01,O>.9){if(!(k>=0))break;D=!0,S[3]=k,y[3]=E,C[3]=o.sqrDistance(y[3],_)}}while(!D);let N=[0,1,2,3],P=w?0:1;for(let e=P;e<4;e++)for(let e=P;e<3;e++){let t=C[e],n=C[e+1];if(c(t,n)>0){let r=N[e];N[e]=N[e+1],N[e+1]=r,C[e]=n,C[e+1]=t}}let F=P,I=0,L=0;for(let e=P;e<4;e++){switch(e){case 0:L=2*S[N[e]];break;case 1:L=1.66666666*S[N[e]];break;case 2:L=1.33333333*S[N[e]];break;case 3:L=S[N[e]]}L>I&&(I=L,F=N[e])}return l(!y[F].isNAN()),new d({x:y[F].x,y:y[F].y})}labelPointPolyline(e){let t=new o;if(e.getPointCount()>2*e.getPathCount()){let n=-1,r=-Number.MAX_VALUE;for(let t=0,i=e.getPathCount();t<i;t++)if(e.getPathSize(t)>2){let i=e.calculatePathLength2D(t);i>r&&(r=i,n=t)}let i=e.getPathStart(n),a=e.getPathEnd(n),o=Math.trunc((i+a)/2);t.assign(e.getXY(o))}else{let n=-Number.MAX_VALUE,r=e.querySegmentIterator();for(;r.nextPath();)if(r.hasNextSegment()){let e=r.nextSegment(),i=e.calculateLength2D();i>n&&(n=i,t.assign(e.getCoord2D(e.lengthToT(.5*i))))}}return new d({x:t.x,y:t.y})}labelPointMultiPoint(e){let t=new u;e.queryEnvelope(t);let n=t.getCenter(),r=new x().getNearestCoordinate(e,n,!1,!1).m_coordinate;return new d({x:r.x,y:r.y})}labelPointEnvelope(e){let t=e.getCenterXY();return new d({x:t.x,y:t.y})}calculateParacentroid_(e,t,n){let i=new u;e.queryEnvelope(i);let a=new o(t,0),s=Number.MAX_VALUE,c=Number.MAX_VALUE,d=!1,f=!1,p=new m;p.setStartXYCoords(a.x,i.ymin-1),p.setEndXYCoords(a.x,i.ymax+1);let h=new u,g=new o,_=new o,v=r(o,2),y=e.querySegmentIterator();for(;y.nextPath();)for(;y.hasNextSegment();){let e=y.nextSegment();if(e.queryEnvelope(h),l(e.isMonotoneQuickAndDirty()),g.setCoordsPoint2D(p.getStartXY()),_.setCoordsPoint2D(p.getEndXY()),h.clipLine(g,_)===0||p.intersect(e,v,null,null,n)!==1)continue;let t=v[0].y;s>c?t<s&&(s=t,d=!0):t<c&&(c=t,f=!0)}return d&&f?a.y=(s+c)/2:a.setNAN(),a}},w=new S;function T(e){return w.execute(e,null)}function E(e){let n=w.executeMany(new t(e),null);return Array.from(n)}function D(){return w.supportsCurves()}function O(e){return _(T(v(e)),y(e))}function k(e){let t=e.map(v),n=y(e);return E(t).map(e=>_(e,n))}var A=D(),j=Object.freeze(Object.defineProperty({__proto__:null,execute:O,executeMany:k,supportsCurves:A},Symbol.toStringTag,{value:`Module`}));export{k as i,A as n,O as r,j as t};