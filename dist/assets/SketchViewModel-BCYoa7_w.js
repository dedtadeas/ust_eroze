const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SelfSnappingEngine-D26jtUhq.js","assets/index-BqmCqmfp.js","assets/index-kIqmb12G.css","assets/sphere-CicnK0Bn.js","assets/vectorStacks-CKtslZxP.js","assets/quatf64-CJzmL3cc.js","assets/elevationInfoUtils-Df_uYU_q.js","assets/quantityUtils-Dywg00j-.js","assets/projectPointToVector-Clou1sfo.js","assets/projectVectorToVector-D-Bbb8fP.js","assets/dehydratedPoint-Dwb3orme.js","assets/geodesicUtils-DJORTTMv.js","assets/plane-CTjDePZl.js","assets/viewUtils-CtJQ47Dj.js","assets/constraints-DXu8cqG3.js","assets/LineSnappingHint-BAcwqgNT.js","assets/ParallelSnappingHint-Knbe-U69.js","assets/LineSnappingCandidate-Cp24TJlP.js","assets/SnappingCandidate-BzUm7cf4.js","assets/RightAngleTriangleSnappingCandidate-B-XFn7NT.js","assets/RightAngleSnappingHint--LJCiSno.js","assets/viewUtils-CPzQ7QWB.js","assets/snappingUtils-CbrwOS61.js","assets/angularMeasurementUtils-BFBiid4G.js","assets/GridSnappingEngine-BdjRLbRx.js","assets/gridUtils-7cbr2rDG.js","assets/IntersectionSnappingCandidate-Cv9i7Mdt.js","assets/IntersectionSnappingHint-C3U4Rx6H.js","assets/FeatureSnappingEngine-UaHOdLtO.js","assets/mapCollectionUtils-BFnXgZfs.js","assets/floorFilterUtils-CQ-SmVM_.js","assets/DrapedEdgeSnappingCandidate-Ck4Ob_c8.js","assets/EdgeSnappingCandidate-C1pApw0q.js","assets/layerViewUtils-Bbe7IKvz.js","assets/geometryEngine-DVwZy4Ew.js","assets/_commonjsHelpers-D6ht1XAa.js","assets/geometryEngineBase-Bv_XSz7W.js","assets/editingTools-7hOqqzc_.js","assets/editPlaneUtils-DxRI6Xas.js","assets/boundedPlane-Cn9n7acY.js","assets/lineSegment-uFalXigL.js","assets/ReactiveSet-DIaWCgzH.js","assets/rotate-qEFO-Vf9.js","assets/unitFormatUtils-D4yCMgjI.js","assets/MeshTransform-B2p38eYR.js","assets/quat-Bk_ZaVz9.js","assets/axisAngleDegrees-Di7q97jx.js","assets/meshVertexSpaceUtils-Y8FeTLov.js","assets/MeshLocalVertexSpace-HjmVAuYa.js","assets/getDefaultUnitForView-CBP34vcm.js","assets/createUtils-DwAaa929.js","assets/distanceOperator-5uQbTYel.js","assets/Distance2DCalculator-CXhBP-8I-Xmr2hQVp.js","assets/UnitFactory-J9WMNXdY.js","assets/Envelope2D-BNwQDrOT.js","assets/Point2D-UYEfE6HP.js","assets/OperatorDefinitions-DQQu7-BK.js","assets/SimpleGeometryCursor-CI9GIWKa.js","assets/Transformation2D-DVoPQwGC.js","assets/apiConverter-DVPFZqjR.js","assets/jsonConverter-DiNOXEUJ.js","assets/simplifyOperator-CVaMEoed.js","assets/operatorSimplify-BpM6lQIp.js","assets/GraphicsLayer-BGvt7_Y1.js","assets/dehydratedFeatureComparison-Ch8xWl-8.js","assets/hydratedFeatures-BSV-K3yB.js","assets/SnappingContext-BiPKdvZN.js","assets/GraphicManipulator-3bzgkt2P.js","assets/drapedUtils-p7eKCYi3.js","assets/PointSnappingHint-0hXGrSRX.js","assets/euclideanLengthMeasurementUtils-Bhl6nD1D.js","assets/spatialReferenceEllipsoidUtils-DBtdxVkA.js","assets/SketchOptions-CfisVcr8.js","assets/colorUtils-uG2qTogT.js","assets/cimSymbolUtils-1FVTTBxd.js","assets/SnappingVisualizer2D-RgcarHQv.js","assets/drawUtils-BjZRY3_w.js","assets/hitTestSelectUtils-CyV_4TZP.js","assets/editingTools-BiNcIwsv.js","assets/ColorMaterial.glsl-C_1k6PTy.js","assets/Transform.glsl-YgD9m_jl.js","assets/Float2BindUniform-BJ75NEvo.js","assets/Uniform-DXwqrKA1.js","assets/FloatBindUniform-TDSkRzMc.js","assets/glsl-C2sn87h0.js","assets/NoParameters-CpAItLvD.js","assets/View.glsl-B6vOoRsw.js","assets/Float3BindUniform-BrSuqm5i.js","assets/Float3DrawUniform-UsZpj3mh.js","assets/Matrix4BindUniform-BUS9JrUC.js","assets/VisualVariables.glsl-xWfUXTFa.js","assets/FloatsPassUniform-BT-ZsPj-.js","assets/AlphaCutoff-DTq90Si4.js","assets/HighlightReadBitmap.glsl-DB3CoKpG.js","assets/Texture2DBindUniform-CSngcuNV.js","assets/Float3PassUniform-Co8OqiAU.js","assets/Float4PassUniform-Bo_mhcMi.js","assets/ObjectAndLayerIdColor.glsl-CrEuv_nr.js","assets/VertexColor.glsl-CHR9Q-WR.js","assets/TerrainDepthTest.glsl-neHlKy5u.js","assets/ReadDepth.glsl-DvJ8t0GM.js","assets/OutputColorHighlightOID.glsl-MUXZi3dC.js","assets/Emissions.glsl-DaTtsIIp.js","assets/FloatPassUniform-BEwJjV4q.js","assets/Texture2DDrawUniform-hiIQoiSn.js","assets/Texture2DPassUniform-Cd7cdF1a.js","assets/ShaderBuilder-C3C7fUwK.js","assets/Compositing.glsl-BYZe6B-5.js","assets/ScreenSpacePass.glsl-Br3vxYsG.js","assets/HUDMaterial.glsl-CE_2EJp4.js","assets/HUDVisibility.glsl-BkjA-IFP.js","assets/VerticalOffset.glsl-DYy5IZ2H.js","assets/ScreenSizePerspective.glsl-CRhKUJLC.js","assets/BooleanBindUniform-8vtZmSI6.js","assets/Float4BindUniform-CtMVDjau.js","assets/Float2PassUniform-D4VTGzqn.js","assets/HighlightApply.glsl-zXn-nuwO.js","assets/HighlightDownsample.glsl-3CRIy9lA.js","assets/HighlightCellGridScreenSpacePass.glsl-BA5GfPLV.js","assets/IntegerPassUniform-zyEEceJY.js","assets/Float2DrawUniform-BXYGUyM9.js","assets/HighlightBlur.glsl-u_RKwFOm.js","assets/HighlightToSingle.glsl-AKPfdrUQ.js","assets/ImageMaterial.glsl-C6_eihmD.js","assets/LaserlinePath.glsl-Cc_iomvO.js","assets/Laserline.glsl-BEu4tx-q.js","assets/CameraSpace.glsl-cnQVTSzq.js","assets/Matrix4PassUniform-DbEU5DCd.js","assets/Laserlines.glsl-Ba7d6LU6.js","assets/OverlayCompositing.glsl-DYGifVcT.js","assets/RibbonLine.glsl-BtrXnCru.js","assets/MarkerSizing.glsl-uoP35BjE.js","assets/PiUtils.glsl-CZJ_KlHj.js","assets/ShadedColorMaterial.glsl-CDWT6SD5.js","assets/TextureOnly.glsl-CYpLvtGi.js","assets/SceneLighting-BWVxtKEm.js","assets/frustum-DNBPrNIX.js","assets/orientedBoundingBox-DZQLHGx0.js","assets/computeTranslationToOriginAndRotation-BC3OuSky.js","assets/HUDIntersectorResult-CCf93UUm.js","assets/VertexAttributeLocations-IAhvKZqd.js","assets/VertexElementDescriptor-BGWnA0Rs.js","assets/renderState-Be6uDhGv.js","assets/earcut-Drx511Ix.js","assets/NestedMap-D5qGZL0n.js","assets/vec3f32-CZ7wi78s.js","assets/graphicUtils-BCCvOGWP.js","assets/FloatArray-cqhQU3FO.js","assets/BufferView-DNaZpbJX.js","assets/Util-3rPi0NfK.js","assets/types-BLimCzcc.js","assets/Indices-BsTLKVdx.js","assets/DefaultBufferWriter-BihhFqiH.js","assets/triangle-1kWe4-AP.js","assets/MaterialUtil-DdudaLIK.js","assets/memoryEstimations-O7VgDRVG.js","assets/RenderCoordsHelper-3X105nA6.js","assets/deduplicate-BuZ0DaaO.js","assets/triangulationUtils-BJbNyOeM.js","assets/videoUtils-L_CLmnNC.js","assets/Texture-BUgDxlWW.js","assets/requestImageUtils-Co3yn10g.js","assets/gfxUtils-DZoKCRMw.js","assets/utils-5jlQHYup.js","assets/DefaultLayouts-CjgM05yM.js","assets/weather-DPdwn6Yn.js","assets/ElevationContext-Dr2dVDU-.js","assets/Octree-CJ8Y2SCh.js","assets/BufferObject-lp8QWmVQ.js","assets/VertexArrayObject-Dzn28byJ.js","assets/VertexBuffer-DL5rIQzc.js","assets/isSupportedObject-CNmfINgj.js","assets/SelectedVertexTooltipInfo-CuZHeWi5.js","assets/sdfPrimitives-BFsFtiPt.js","assets/ExtentScaleTooltipInfo-C3_coAyh.js","assets/TranslateTooltipInfo-Dg5jnkfm.js","assets/GraphicsLayerView3D-DvH4TJ-v.js","assets/DefaultMaterial.glsl-CPcjrtyI.js","assets/ReadShadowMap.glsl-DONMmaDt.js","assets/MixExternalColor.glsl-n6kVrPsi.js","assets/SnowCover.glsl-CxdL6slB.js","assets/SSAO.glsl-D6CAmj04.js","assets/SSAOBlur.glsl-Cl8tUkbE.js","assets/Normals.glsl-BlytCSCC.js","assets/LineCallout.glsl-CeiFhF9f.js","assets/RealisticTree.glsl-CbVkeEfD.js","assets/PooledRBush-DKfG2PAm.js","assets/quantizationUtils-C5shine1.js","assets/OptimizedFeature-Dx4_lHip.js","assets/OptimizedGeometry-f3I9Z6C1.js","assets/OptimizedFeatureSet-DlHqIhoP.js","assets/optimizedFeatureQueryEngineAdapter-8HKICOsa.js","assets/dehydratedFeatures-DW1qFa9i.js","assets/featureConversionUtils-7vyVIZ6j.js","assets/pointUtils-sqc3aGBe.js","assets/primitiveObjectSymbolUtils-YY1qMuBN.js","assets/Intersector-DrVIdDEe.js","assets/symbolColorUtils-BNtTwJ67.js","assets/DefaultMaterial-BeGY-ryU.js","assets/rendererConversion-C80YhbmI.js","assets/LayerView-DKEUJRIQ.js","assets/popupUtils-h58HBZOO.js","assets/highlightOptionsUtils-DiIoW0j2.js","assets/GraphicMover-DvViIC8D.js","assets/GraphicMover-CVuh8pZh.js","assets/layerUtils-DVQFdwBE.js","assets/Box-_N-2X-Wq.js","assets/settings-D6uYZqUj.js","assets/Reshape-DMQ44-Zy.js","assets/devEnvironmentUtils-8TtBy-wV.js","assets/previewSymbol3D-CgFD1bFX.js","assets/previewUtils-CT5v5cXU.js","assets/renderUtils-Ckhxu64U.js","assets/webStyleSymbolUtils-Vsg9bxK_.js","assets/webStyleAcceptedFormats-vp0B4e2w.js","assets/symbolUtils-lbLywa7t.js"])))=>i.map(i=>d[i]);
import{$l as e,Am as t,Bg as n,CD as r,CT as i,Cw as a,Gb as o,Gd as s,Hb as c,Hd as l,IS as u,Jg as d,Kb as f,Kd as p,MC as m,OC as h,SC as g,SS as _,TC as v,Ub as y,Vb as ee,Wd as te,Xd as ne,Xl as re,Xw as ie,Yd as ae,_E as oe,aT as se,cD as ce,cT as le,fC as ue,gd as de,gg as fe,hg as pe,iT as me,kC as b,lS as he,mT as x,nD as ge,pd as _e,pf as ve,pg as ye,qb as S,rT as be,sT as xe,tu as Se,ug as Ce,vE as we,vd as C,wT as Te,wb as Ee,wm as w,xy as De,yg as T}from"./index-BqmCqmfp.js";import{i as Oe,r as ke}from"./geodeticLengthOperator-Bd7syy7j.js";import{t as Ae}from"./earcut-Drx511Ix.js";import{S as je,b as Me,p as Ne,v as Pe}from"./plane-CTjDePZl.js";import{t as Fe}from"./projectVectorToVector-D-Bbb8fP.js";import{o as E}from"./elevationInfoUtils-Df_uYU_q.js";import{t as Ie}from"./GraphicsLayer-BGvt7_Y1.js";import{a as Le,n as Re,o as ze,r as Be}from"./geodesicUtils-DJORTTMv.js";import{t as Ve}from"./isSupportedObject-CNmfINgj.js";import{r as He}from"./layerUtils-DVQFdwBE.js";import{i as Ue,n as We,r as Ge,t as Ke}from"./SketchOptions-CfisVcr8.js";import{f as qe,g as Je,p as D}from"./LineSnappingHint-BAcwqgNT.js";import{n as O}from"./ParallelSnappingHint-Knbe-U69.js";import{l as Ye,r as Xe,s as Ze}from"./snappingUtils-CbrwOS61.js";import{t as Qe}from"./EdgeSnappingCandidate-C1pApw0q.js";import{t as $e}from"./DrapedEdgeSnappingCandidate-Ck4Ob_c8.js";import{t as k}from"./IntersectionSnappingCandidate-Cv9i7Mdt.js";import{t as et}from"./LineSnappingCandidate-Cp24TJlP.js";import{n as tt,t as nt}from"./RightAngleTriangleSnappingCandidate-B-XFn7NT.js";import{n as rt,t as it}from"./viewUtils-CPzQ7QWB.js";import{c as at,n as A}from"./quantityUtils-Dywg00j-.js";import{a as ot,c as st,n as ct,r as lt,u as ut}from"./euclideanLengthMeasurementUtils-Bhl6nD1D.js";import{n as dt}from"./triangle-1kWe4-AP.js";import{t as ft}from"./hitTestSelectUtils-CyV_4TZP.js";function pt(e){switch(e){case 0:break;case 1:return`not owned by a graphics layer`;case 2:return`no geometry`;case 3:return`the geometry type is not supported`;case 4:return`the symbol type is not supported`}return``}function mt(e){return ht(e).result}function ht(e){if(e.graphic&&e.graphic.layer?.type!==`graphics`)return{result:1};if(!e.operations)return{result:2};let t=e.operations.data.type,n=e.operations.data.geometry;return t===`point`||t===`mesh`||t===`polyline`||t===`polygon`?{result:0,geometry:n}:{result:3}}function gt(e){if(e.layer?.type!==`graphics`)return 1;if(e.geometry==null)return 2;switch(e.geometry.type){case`point`:break;case`polygon`:case`polyline`:case`multipoint`:case`extent`:case`mesh`:return 0;default:return 3}let t=e.symbol!=null&&e.symbol.type===`point-3d`&&e.symbol.symbolLayers;return t&&t.some(e=>e.type===`object`)?0:4}var j=class extends h{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new g}};r([m({constructOnly:!0})],j.prototype,`layer`,void 0),r([m()],j.prototype,`enabled`,void 0),r([m()],j.prototype,`updating`,void 0),r([m()],j.prototype,`availability`,void 0),r([m()],j.prototype,`sublayerSources`,void 0),j=r([b(`esri.views.interactive.snapping.FeatureSnappingLayerSource`)],j);var M=class extends h{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.gridEnabled=!1,this.attributeRulesEnabled=!1,this.featureSources=new g,this.distance=O.distance,this.touchSensitivityMultiplier=O.touchSensitivityMultiplier}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveGridEnabled(){return this.effectiveEnabled&&this.gridEnabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){let e=this.featureSources;e.some(_t)&&we.getLogger(this).warnOnce(`Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.`);let t=e.filter(yt),n=this._get(`_effectiveFeatureSources`)?.filter(_t)??new g;for(let e of t){let t=n.find(t=>t.layer===e.layer.parent);if(t)t.sublayerSources.includes(e)||t.sublayerSources.add(e);else if(e.layer.parent){let t=new j({layer:e.layer.parent});t.sublayerSources.add(e),n.add(t)}}for(let e of n){let n=e.sublayerSources.filter(e=>!t.includes(e));e.sublayerSources.removeMany(n)}n.removeMany(n.filter(e=>e.sublayerSources.length===0));let r=e.filter(vt),i=this._get(`_effectiveFeatureSources`)??new g,{added:a,removed:o}=ce(i.toArray(),[...r,...n]);return i.removeMany(o),i.addMany(a),i}};function _t(e){return e.layer.type===`subtype-group`}function vt(e){return e.layer.type!==`subtype-group`}function yt(e){return e.layer.type===`subtype-sublayer`}r([m()],M.prototype,`enabled`,void 0),r([m()],M.prototype,`enabledToggled`,void 0),r([m()],M.prototype,`forceDisabled`,void 0),r([m()],M.prototype,`selfEnabled`,void 0),r([m()],M.prototype,`featureEnabled`,void 0),r([m()],M.prototype,`gridEnabled`,void 0),r([m()],M.prototype,`attributeRulesEnabled`,void 0),r([m({type:g.ofType(j)})],M.prototype,`featureSources`,void 0),r([m()],M.prototype,`distance`,void 0),r([m()],M.prototype,`touchSensitivityMultiplier`,void 0),r([m({readOnly:!0})],M.prototype,`effectiveEnabled`,null),r([m({readOnly:!0})],M.prototype,`effectiveGridEnabled`,null),r([m({readOnly:!0})],M.prototype,`effectiveSelfEnabled`,null),r([m({readOnly:!0})],M.prototype,`effectiveFeatureEnabled`,null),r([m({readOnly:!0})],M.prototype,`_effectiveFeatureSources`,null),M=r([b(`esri.views.interactive.snapping.SnappingOptions`)],M);function bt(e){let{spatialReference:t}=e;return ut(t,Dt,Ot,e)}function xt(e,t){if(!u(e.spatialReference,t.spatialReference))return null;let{spatialReference:n}=e;return N[0]=e.x,N[1]=e.y,N[2]=e.hasZ?e.z:0,P[0]=t.x,P[1]=t.y,P[2]=t.hasZ?t.z:0,St(N,P,n)}function St(e,t,n){return ut(n,Tt,Et,e,t,n)}var Ct={geodesicLength:bt,geodesicDistanceBetweenPoints:xt,geodesicDistance:St};async function wt(){return await Oe(),Ct}function Tt(e,t,n){return A(Le(At,e,t,n).distance,`meters`)}function Et(e,t,n){return A(ke(kt(e,t,n),{unit:`meters`}),`meters`)}function Dt(e){return A(Re([e],`meters`)[0],`meters`)}function Ot(e){return A(ke(e,{unit:`meters`}),`meters`)}function kt(e,t,r){return new n({spatialReference:r,paths:[[[...e],[...t]]]})}var At=new Be,N=d(),P=d(),F=class extends v{constructor(e){super(e),this.options=new M,this._engineCache=new Map,this._loadTask=null,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=0}initialize(){this.addHandles([f(()=>{let{distance:e,touchSensitivityMultiplier:t,effectiveSelfEnabled:n,effectiveFeatureEnabled:r,effectiveGridEnabled:i}=this.options;return{selfEnabled:n,featureEnabled:r,gridEnabled:this.view.type===`2d`&&i,viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,distance:e,touchSensitivityMultiplier:t}},(e,t)=>{t&&(this.doneSnapping(),this.emit(`changed`)),this._loadTask?.abort(),this._loadTask=ue(n=>this._updateEngines(e,t,n))},S),f(()=>this.options,e=>{for(let t of this._engines)t.options=e},ee)])}destroy(){this._loadTask?.abort(),this._destroyEngines()}get updating(){return this._engines.some(e=>e.updating)||!this._loadTask?.finished}_destroyEngines(){this._engineCache.forEach(e=>e.destroy()),this._engineCache.clear(),this._engines=[]}async _updateEngines(e,t,n){if(!e.viewReady)return void this._destroyEngines();t?.viewSpatialReference!==e.viewSpatialReference&&this._destroyEngines();let r=this._engineCache,i=await Promise.allSettled([e.featureEnabled&&!r.has(`feature`)?this._createFeatureSnappingEngine(n):void 0,e.selfEnabled&&!r.has(`self`)?this._createSelfSnappingEngine(n):void 0,e.gridEnabled&&!r.has(`grid`)?this._createGridSnappingEngine(n):void 0]);if(n.aborted)for(let e of i)e.status===`fulfilled`&&e.value?.engine.destroy();else{for(let e of i)e.status===`fulfilled`&&e.value&&r.set(e.value.type,e.value.engine);this._engines=Array.from(r.values())}}async _createSelfSnappingEngine(e){let[{SelfSnappingEngine:t},n]=await Promise.all([a(()=>import(`./SelfSnappingEngine-D26jtUhq.js`),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23])),wt()]);return me(e),{type:`self`,engine:new t({view:this.view,options:this.options,geodesicLengthMeasurementUtils:n})}}async _createGridSnappingEngine(e){let{view:t}=this;if(t.type!==`2d`)return;let{GridSnappingEngine:n}=await a(async()=>{let{GridSnappingEngine:e}=await import(`./GridSnappingEngine-BdjRLbRx.js`);return{GridSnappingEngine:e}},__vite__mapDeps([24,1,2,3,4,5,6,11,12,10,25,14,15,26,18,27,17,22]));return me(e),{type:`grid`,engine:new n({view:t,options:this.options})}}async _createFeatureSnappingEngine(e){let{FeatureSnappingEngine:t}=await a(async()=>{let{FeatureSnappingEngine:e}=await import(`./FeatureSnappingEngine-UaHOdLtO.js`);return{FeatureSnappingEngine:e}},__vite__mapDeps([28,1,2,3,4,5,29,6,11,12,10,30,13,14,15,31,32,18,21,20,22,33]));me(e);let{view:n,options:r}=this,{spatialReference:i}=n;return{type:`feature`,engine:new t({view:n,options:r,spatialReference:i})}}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){let{distance:e,touchSensitivityMultiplier:t}=this.options,n=e*t;return n*n}snap(e){return Nt(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){let{point:t,context:n}=e;this._removeVisualization();let r=this._currentMainCandidate;if(r==null)return t;let i=this._selectUpdateInput(e);if(i==null)return t;let{spatialReference:a}=n,o=T(i,a);if(o==null)return t;let{view:s}=this,{elevationInfo:c,visualizer:l}=n,u=[],d=D(o,s,c),f=r.constraint.closestTo(d);if(!this._arePointsWithinScreenThreshold(d,f,n)||!L(r,n.drawConstraints))return this._resetSnappingState(),t;r.targetPoint=Je(f),u.push(...r.hints);for(let e of this._currentOtherActiveCandidates)L(e,n.drawConstraints)&&(e.targetPoint=Je(f),u.push(...e.hints));return l!=null&&this.addHandles(l.draw(u,{spatialReference:a,elevationInfo:Pt(n),view:s,selfSnappingZ:n.selfSnappingZ}),I),qe(f,s,t,n)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:e,scenePoint:t}){switch(this._currentSnappedType){case 0:return e;case 1:return t}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=0}_removeVisualization(){this.removeHandles(I)}async _snapSinglePoint({point:e,context:t,signal:n}){let{view:r}=this,{elevationInfo:i}=t,a=D(e,r,i),o=await this._fetchCandidates(a,3,t,n);return this._createSnapResult(a,0,o,r,e,t,n)}async _snapMultiPoint({point:e,scenePoint:t,context:n,signal:r}){let{view:i}=this,{coordinateHelper:a,elevationInfo:o,spatialReference:s}=n;await fe(t.spatialReference,s);let c=T(t,s),l=D(c,i,o),u=await this._fetchCandidates(l,1,n,r);if(u.length>0){let e=await this._fetchCandidates(l,2,n,r);return this._createSnapResult(l,1,[...u,...e],i,c,n,r)}let d=D(e,i,o),f=await this._fetchCandidates(d,2,n,r);return this._createSnapResult(d,0,f,i,{z:a.hasZ()&&e.hasZ?e.z??0:void 0,m:a.hasM()&&e.hasM?e.m??0:void 0},n,r)}async _fetchCandidates(e,t,n,r){return(await Promise.all(this._engines.map(i=>i.fetchCandidates(e,t,n,r)))).flat()}_createSnapResult(e,t,n,r,i,a,o){return{get valid(){return!ie(o)},apply:()=>{let{spatialReference:o}=a,{snappedPoint:s,hints:c}=this._processCandidates(e,t,n,a);return this._removeVisualization(),a.visualizer!=null&&this.addHandles(a.visualizer.draw(c,{spatialReference:o,elevationInfo:E,view:r,selfSnappingZ:a.selfSnappingZ}),I),qe(s,r,i,a)}}}_processCandidates(e,t,n,r){if(n.length<1)return this.doneSnapping(),{snappedPoint:e,hints:[]};this._currentSnappedType!==t&&this._resetSnappingState(),Ye(e,n);let i=this._currentMainCandidate;if(i!=null){let a=Mt(i,n);if(a>=0){if(!(n[a]instanceof k))return this._intersectWithOtherCandidates(a,n,e,t,r);if(this._arePointsWithinScreenThreshold(e,i.targetPoint,r))return this._updateSnappingCandidate(i,t,n,r)}}return this._intersectWithOtherCandidates(0,n,e,t,r)}_intersectWithOtherCandidates(e,t,n,r,i){let{coordinateHelper:a}=i,o=t[e],s=[];for(let r=0;r<t.length;++r){if(r===e)continue;let i=t[r],c=o.constraint.intersect(i.constraint);if(c)for(let e of c.closestPoints(o.targetPoint))s.push([new k(Je(e),o,i,i.isDraped),this._squaredScreenDistance(n,e,a)])}return s.length>0&&(s.sort((e,t)=>e[1]-t[1]),s[0][1]<this._squaredPointProximityThreshold(i.pointer))?this._updateSnappingCandidate(s[0][0],r,t,i):L(o,i.drawConstraints)?this._updateSnappingCandidate(o,r,t,i):{snappedPoint:n,hints:[]}}_updateSnappingCandidate(e,t,n,r){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=t;let i=this._currentMainCandidate.targetPoint,a=[];a.push(...e.hints);for(let t of n){if(e instanceof k){if(t.constraint.equals(e.first.constraint)||t.constraint.equals(e.second.constraint))continue}else if(t.constraint.equals(e.constraint))continue;let n=t.constraint.closestTo(i);this._squaredScreenDistance(n,i,r.coordinateHelper)<jt()&&(t.targetPoint=i,this._currentOtherActiveCandidates.push(t),a.push(...t.hints))}return{snappedPoint:i,hints:a}}_squaredPointProximityThreshold(e){return e===`touch`?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(e,t,n){return this._squaredScreenDistance(e,t,n.coordinateHelper)<this._squaredPointProximityThreshold(n.pointer)}_squaredScreenDistance(e,t,n){return Xe(this._toScreen(e,n),this._toScreen(t,n))}_toScreen(e,t){return it(e,t.spatialReference,E,this.view)}get test(){}};r([m({constructOnly:!0})],F.prototype,`view`,void 0),r([m()],F.prototype,`options`,void 0),r([m({readOnly:!0})],F.prototype,`updating`,null),r([m()],F.prototype,`_loadTask`,void 0),r([m()],F.prototype,`_engines`,void 0),r([m()],F.prototype,`_squaredMouseProximityThreshold`,null),r([m()],F.prototype,`_squaredTouchProximityThreshold`,null),F=r([b(`esri.views.interactive.snapping.SnappingManager`)],F);var I=`visualization-handle`;function jt(){return O.satisfiesConstraintScreenThreshold*O.satisfiesConstraintScreenThreshold}function L(e,t){return!t||t.direction==null&&t.distance==null||!(e instanceof $e||e instanceof Qe||e instanceof et||e instanceof tt||e instanceof nt)&&(!(e instanceof rt)||t.direction==null&&e.selfSnappingType===1)}function Mt(e,t){return e instanceof k?R(t,e.first)>=0&&R(t,e.second)>=0?0:-1:R(t,e)}function R(e,t){let n=-1;for(let r=0;r<e.length;++r)if(t.constraint.equals(e[r].constraint)){n=r;break}return n}function Nt(e){return e.scenePoint!=null}function Pt({coordinateHelper:e,elevationInfo:t}){return e.hasZ()?E:t}function Ft(e,t=z()){return Lt(e,t)}function It(e,t=z()){return Lt(e,t,!1)}function Lt(t,n,r=t.hasZ){let i=st(t.spatialReference),a=he(i);if(a==null)return null;let o=(t,n)=>!(n.length<2)&&(e(t,n[0],n[1],r&&n[2]||0),!0),s=0;for(let r of t.rings){let a=r.length;if(a<3)continue;let{positionsWorldCoords:c}=n;for(;c.length<a;)c.push(d());let l=Rt,u=e(zt,0,0,0),f=1/a;for(let e=0;e<a;e++){if(!o(l,r[e])||!Fe(l,t.spatialReference,c[e],i))return null;Se(u,u,c[e],f)}let p=je(c[0],c[1],u,Pe());if(re(Me(p))===0)continue;for(let e=0;e<a;e++)Ne(p,u,c[e],c[e]);let m=Bt(c);for(let e=0;e<m.length;e+=3)s+=dt(c[m[e]],c[m[e+1]],c[m[e+2]])}return at(s,a)}var Rt=d(),zt=d();function z(){return{positionsWorldCoords:[]}}function Bt(e){return Ae(Vt(e),[],2)}function Vt(e){let t=new Float64Array(2*e.length);for(let n=0;n<e.length;++n){let r=e[n],i=2*n;t[i]=r[0],t[i+1]=r[1]}return t}var Ht=e=>({geodesicArea(t){let{spatialReference:n}=t;return ut(n,Wt,t=>Gt(e,t),t)}});async function Ut(){let e=await a(()=>import(`./geometryEngine-DVwZy4Ew.js`),__vite__mapDeps([34,1,2,35,36]));return Ht(e)}function Wt(e){return at(Math.abs(ze([e],`square-meters`)[0]),`square-meters`)}function Gt(e,t){try{return at(Math.abs(e.geodesicArea(t,`square-meters`)),`square-meters`)}catch{return null}}var Kt=e=>({autoAreaByElevationMode(t,n,r=z()){return n===`on-the-ground`?e.geodesicArea(t)??It(t,r):Ft(t,r)},autoArea2D(e,t=z()){return this.autoAreaByElevationMode(e,`on-the-ground`,t)}}),qt=null;async function B(){return qt||=Kt(await Ut()),qt}function Jt(e){return{autoLength2D:t=>e.geodesicLength(t)??lt(t),autoDistanceBetweenPoints2D:(t,n)=>e.geodesicDistanceBetweenPoints(t,n)??ot(t,n),autoDistance2D:(t,n,r)=>(H[0]=t[0],H[1]=t[1],H[2]=t.length===3?t[2]:0,U[0]=n[0],U[1]=n[1],U[2]=n.length===3?n[2]:0,e.geodesicDistance(H,U,r)??ct(H,U,r))}}async function V(){return Jt(await wt())}var H=d(),U=d(),Yt=class{constructor(e){this.layer=e}get elevationInfo(){return this.layer.elevationInfo}add(e){this.layer.add(e)}addMany(e){this.layer.addMany(e)}onGraphicsChange(e){let{layer:t}=this;return c(()=>t.graphics,`change`,t=>e(t))}has(e){return e.layer===this.layer}remove(e){this.layer.remove(e)}removeMany(e){this.layer.removeMany(e)}removeAll(){this.layer.removeAll()}};r([m()],Yt.prototype,`elevationInfo`,null);var Xt=class{constructor(e){this.layer=e}get elevationInfo(){}add(e,t){(this._getSublayerForCreateTool(t)??this._getSublayerForGraphic(e))?.add(e)}addMany(e,t){if(t){let n=this._getSublayerForCreateTool(t);if(n)return void n.addMany(e)}e.forEach(e=>this._getSublayerForGraphic(e)?.add(e))}onGraphicsChange(e){let{layer:t}=this;if(t.sublayers?.length)return Te(t.sublayers?.toArray().map(t=>c(()=>t.graphics,`change`,t=>e(t))))}has(e){let{layer:t}=this;return e.layer===t||e.sourceLayer===t||!!t.sublayers?.some(t=>e.layer===t||e.sourceLayer===t)}remove(e){this._getSublayerForGraphic(e)?.remove(e)}removeMany(e){e.forEach(e=>this._getSublayerForGraphic(e)?.remove(e))}removeAll(){this.layer.sublayers?.forEach(e=>e.removeAll())}_getSublayerForCreateTool(e){let{layer:t}=this;switch(e){case`point`:return t.pointLayer;case`polyline`:return t.polylineLayer;case`polygon`:return t.polygonLayer;case`multipoint`:return t.multipointLayer;case`text`:return t.textLayer}}_getSublayerForGraphic(e){let{layer:t}=this;if(e?.geometry)switch(e.geometry.type){case`point`:return e.symbol?.type===`text`?t.textLayer:t.pointLayer;case`polyline`:return t.polylineLayer;case`polygon`:return t.polygonLayer;case`multipoint`:return t.multipointLayer}}};r([m()],Xt.prototype,`elevationInfo`,null);var W=class extends v{constructor(e){super(e),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){let{activeComponent:e}=this;if(!e)return null;switch(e.type){case`graphic-mover`:case`move-3d`:return`move`;case`box`:case`transform-3d`:return`transform`;case`reshape`:case`reshape-3d`:return`reshape`;case`draw-2d`:return e.graphicSymbol?.type===`text`?`text`:e.geometryType;case`draw-3d`:return e.geometryType}return null}addToHistory(e){this.history.redo=[],this.history.undo.push(e)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit(`complete`)}cancel(){this.cancelled=!0,this.complete()}_reset(){this.activeComponent?.reset()}refreshComponent(){let e=this.activeComponent;e&&(e.type!==`box`&&e.type!==`reshape`&&e.type!==`graphic-mover`||e.refresh())}set undo(e){this._set(`undo`,()=>{this.canUndo()&&e()})}set redo(e){this._set(`redo`,()=>{this.canRedo()&&e()})}};r([m()],W.prototype,`activeComponent`,void 0),r([m()],W.prototype,`cancelled`,void 0),r([m()],W.prototype,`history`,void 0),r([m()],W.prototype,`tool`,null),r([m()],W.prototype,`type`,void 0),r([m()],W.prototype,`canUndo`,null),r([m()],W.prototype,`canRedo`,null),r([m()],W.prototype,`onEnd`,void 0),r([m()],W.prototype,`undo`,null),r([m()],W.prototype,`redo`,null),r([m()],W.prototype,`toggleTool`,void 0),r([m()],W.prototype,`addToSelection`,void 0),r([m()],W.prototype,`removeFromSelection`,void 0),W=r([b(`esri.widgets.Sketch.support.OperationHandle`)],W);var G=class extends W{};r([m()],G.prototype,`activeComponent`,void 0),G=r([b(`esri.widgets.Sketch.support.OperationHandle.CreateOperationHandle`)],G);var K=class extends W{};r([m()],K.prototype,`activeComponent`,void 0),K=r([b(`esri.widgets.Sketch.support.OperationHandle.UpdateOperationHandle`)],K);function Zt(e,t){return t===`freehandPolygon`||t===`freehandPolyline`?`freehand`:e??(t===`rectangle`||t===`circle`?`hybrid`:`click`)}function Qt(e){switch(e){case`freehandPolygon`:return`polygon`;case`freehandPolyline`:return`polyline`;case`text`:return`point`;default:return e}}function $t(e){if(e.length>1)return!1;let t=e.at(0)?.geometry;return t?.type===`point`||t?.type===`multipoint`&&t.points.length<2}var en={defaultZ:0},q={reshapeOptions:{edgeOperation:`split`,shapeOperation:`move`,vertexOperation:`move`},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,highlightOptions:{enabled:!0,name:_e},tool:`transform`},tn=Symbol(),nn=Symbol(),J=class extends v{constructor(e){super(e),this._defaultSnappingManager=null,this._internalGraphicsLayer=new Ie({listMode:`hide`,internal:!0,title:`SVM Internal`}),this._operationHandle=null,this._updatingHandles=new t,this._viewHandlesKey=`viewHandles`,this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.layer=null,this.pointSymbol=new s({style:`circle`,size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new p({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new ae({color:[130,130,130,1],width:2}),this.meshSymbol=new ne({symbolLayers:new g([new ve])}),this.textSymbol=new te({text:`text`}),this.updateGraphics=new g,this.updateOnGraphicClick=!0,this.creationMode=`single`,this.vertexSymbol=new s({style:`circle`,size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.sketchOptions=new Ke,this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._sketchContinuationFlag=!1,this._onLayerAdapterChange=async()=>{let{_layerAdapter:e}=this;if(this.removeHandles(nn),!e)return;let t=[e.onGraphicsChange(e=>this._onLayerGraphicsChangeCallback(e)),f(()=>e.elevationInfo,e=>{e!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=e)},S)].filter(ge);this.addHandles(t,nn)},this._originalPopupEnabled=null,this.defaultCreateOptions=en,this.defaultUpdateOptions=q,this.snappingOptions=e?.snappingManager?.options??e?.snappingOptions??new M}initialize(){this.addHandles([c(()=>this.view?.map?.layers,`change`,e=>{this.layer&&e.removed.includes(this.layer)&&this.cancel()}),f(()=>this._layerAdapter,()=>this._onLayerAdapterChange(),S),f(()=>this.view,e=>{this._defaultSnappingManager=x(this._defaultSnappingManager),e&&(this.snappingManager||(this._defaultSnappingManager=new F({view:e,options:this.snappingOptions})),e.type===`2d`?a(()=>import(`./editingTools-7hOqqzc_.js`),__vite__mapDeps([37,1,2,38,39,3,4,5,40,12,41,6,42,7,43,44,45,46,47,48,49,23,9,8,10,11,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,15,16,27,69,20,70,71,72,14,22,73,74,75,76,77])):e.type===`3d`&&(a(()=>import(`./editingTools-BiNcIwsv.js`),__vite__mapDeps([78,1,2,38,39,3,4,5,40,12,41,6,42,7,43,44,45,46,47,48,49,23,9,8,10,11,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,15,16,27,69,20,70,71,72,14,22,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,73,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,74,162,163,164,165,166,167,168,169,170,171,13,172,173,174,175])),a(()=>import(`./GraphicsLayerView3D-DvH4TJ-v.js`),__vite__mapDeps([176,1,2,177,80,81,82,83,84,85,178,102,88,95,103,104,105,92,93,94,132,87,114,179,86,89,90,91,96,97,180,181,108,100,126,115,106,182,120,135,3,4,5,8,9,10,136,12,40,137,45,138,71,139,140,141,142,113,119,127,154,98,111,112,183,99,101,109,110,184,185,130,131,145,146,147,148,149,150,151,47,48,65,152,153,186,6,155,187,188,189,190,191,64,192,193,159,160,161,194,166,167,195,196,197,198,170,168,199,173,200,33,201,202]))))},S),f(()=>this.view?.spatialReference,(e,t)=>{e&&t&&!e.equals(t)&&this.cancel()})]),Ze(this)}destroy(){this.cancel(),this._removeDefaultLayer(),this._defaultSnappingManager=x(this._defaultSnappingManager),this._set(`snappingManager`,null),this._set(`view`,null),this._updatingHandles.destroy(),this.emit(`destroy`)}get _layerAdapter(){let{layer:e}=this;switch(e?.type){case`graphics`:return new Yt(e);case`map-notes`:return new Xt(e);default:return null}}get activeTool(){return this._operationHandle?.tool??null}get activeCreateToolDrawMode(){return this._operationHandle?.type===`create`&&this._operationHandle.activeComponent&&`mode`in this._operationHandle.activeComponent?this._operationHandle.activeComponent.mode:null}get activeTooltip(){let{activeComponent:e,destroyed:t}=this,n=!t&&e&&`tooltip`in e?e.tooltip:null;return n?.visible?n:null}get activeComponent(){return this._operationHandle?.activeComponent??null}get createGraphic(){return this.activeComponent==null||this.activeComponent.type!==`draw-3d`&&this.activeComponent.type!==`draw-2d`?this._get(`createGraphic`):this.activeComponent.graphic}get defaultCreateOptions(){return this._get(`defaultCreateOptions`)}set defaultCreateOptions(e){this._set(`defaultCreateOptions`,{...en,...e})}get defaultUpdateOptions(){return this._get(`defaultUpdateOptions`)}set defaultUpdateOptions(e){this._set(`defaultUpdateOptions`,{...q,...e,reshapeOptions:{...q.reshapeOptions,...e?.reshapeOptions},highlightOptions:{...q.highlightOptions,...e?.highlightOptions}})}get labelOptions(){return this.sketchOptions.labels}set labelOptions(e){this.sketchOptions.labels=e}get snappingOptions(){return this.snappingManager?.options??this._get(`snappingOptions`)}set snappingOptions(e){this._defaultSnappingManager!=null&&(this._defaultSnappingManager.options=e),this._set(`snappingOptions`,e)}get snappingManager(){return this._isOverridden(`snappingManager`)&&this._get(`snappingManager`),this._defaultSnappingManager}set snappingManager(e){if(e)this._isOverridden(`snappingManager`)||(this._defaultSnappingManager=x(this._defaultSnappingManager)),this._override(`snappingManager`,e);else{let{view:e}=this;!this._defaultSnappingManager&&e&&(this._defaultSnappingManager=new F({options:this.snappingOptions,view:e})),this._clearOverride(`snappingManager`)}}get state(){let e=!(!this.view?.ready||!this.layer),t=this._operationHandle;return e&&t?`active`:e?`ready`:`disabled`}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(e){this.sketchOptions.tooltips=e}get updating(){return!(!this._updatingHandles.updating&&!this.snappingManager?.updating)}get valueOptions(){return this.sketchOptions.values}set valueOptions(e){this.sketchOptions.values=e}get view(){return this._get(`view`)}set view(e){let t=this._get(`view`);if(t){let{container:e,map:n}=t;e&&this._clearCursor(),n?.remove(this._internalGraphicsLayer),this.removeHandles(this._viewHandlesKey),this.cancel()}let n=`view-ready`;this.removeHandles(n),e&&this.addHandles(y(()=>e.ready,t=>{this.removeHandles(this._viewHandlesKey),t&&this.addHandles(this._generateViewHandles(e),this._viewHandlesKey)},S),n),this._set(`view`,e)}addGraphic(e){this._layerAdapter?.add(e)}addGraphics(e){this._layerAdapter?.addMany(e)}hasGraphic(e){return!!this._layerAdapter?.has(e)}removeGraphic(e){this._layerAdapter?.remove(e)}removeGraphics(e){this._layerAdapter?.removeMany(e)}removeAllGraphics(){this._layerAdapter?.removeAll()}cancel(){this._moduleLoaderAbortController=le(this._moduleLoaderAbortController),this._viewReadyAbortController=le(this._viewReadyAbortController),this._sketchContinuationFlag=!0,this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle?.complete()}delete(){let{state:e,updateGraphics:t}=this;if(e===`active`&&t.length){let{activeTool:e}=this,n=t.toArray();this.removeGraphics(n),this.cancel(),this._emitDeleteEvent({graphics:n,tool:e})}}duplicate(){if(this.state===`active`&&this.updateGraphics.length){let e=this.updateGraphics.map(e=>e.clone()).toArray();return this.addGraphics(e),this.emit(`duplicate`,{graphics:e,type:`duplicate`}),e}return[]}async create(e,t){this.cancel(),await this._waitViewReady();let{view:n,layer:r}=this;if(!n||this.state===`disabled`)throw r||this._logMissingLayer(),se();if(n.activeTool!=null&&(n.activeTool=null),!e)return void this._logError(`sketch:missing-parameter`,`Missing parameter 'tool'.`);He(n,this._internalGraphicsLayer);let i=await this._updatingHandles.addPromise(this._setupCreateOperation(e,t));if(i==null||this.destroyed)return void n.map?.remove(this._internalGraphicsLayer);i.on(`complete`,()=>{if(i===this._operationHandle){let n=this.createGraphic,r=this._operationHandle.cancelled;if(this._operationHandle.destroy(),this._operationHandle=null,this._set(`createGraphic`,null),this.view?.map?.remove(this._internalGraphicsLayer),i.cancelled||n==null||this.addGraphic(n),this._sketchContinuationFlag=!1,this.emit(`create`,{graphic:n,state:r?`cancel`:`complete`,tool:e,toolEventInfo:null,type:`create`}),r||this._sketchContinuationFlag)return;let{creationMode:a}=this;if(a===`continuous`){if(t?.geometryToPlace)return;this._updatingHandles.addPromise(xe(this.create(e,t)))}else a===`update`&&n&&this._updatingHandles.addPromise(xe(this.update([n])))}}),this._operationHandle=i,n.ready&&n.focus()}async place(e,t){return await e.load(),this.create(`mesh`,{mode:`click`,hasZ:e.hasZ,geometryToPlace:e,...t})}async update(e,t){this.cancel(),await this._waitViewReady();let{layer:n,view:r,state:i}=this;if(!r||i===`disabled`)throw n||this._logMissingLayer(),se();r.activeTool!=null&&(r.activeTool=null);let a=Array.isArray(e)?e:[e];if(e==null||!a?.length)return void this._logError(`sketch:missing-parameter`,`Missing parameter 'graphics'.`);if(a.some(e=>this.hasGraphic(e)?e.geometry==null&&(this._logError(`sketch:invalid-parameter`,`Parameter 'graphics' contains one or more graphics with an unsupported geometry.`),!0):(this._logError(`sketch:invalid-parameter`,`Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer.`),!0)))return;let o=await this._updatingHandles.addPromise(this._setupUpdateOperation(a,t));this.destroyed||o==null||$(o)||(He(r,this._internalGraphicsLayer),this._setUpdateOperationHandle(o,t),this.emit(`update`,{graphics:a,state:`start`,aborted:!1,tool:o.tool,toolEventInfo:null,type:`update`}))}async _updateSpatialReference(e){let t=this.view;if(t){e=Array.isArray(e)?e:[e];for(let n of e)n.geometry==null||n.geometry.type===`mesh`||u(n.geometry.spatialReference,t.spatialReference)||(ye(n.geometry.spatialReference,t.spatialReference)||Ce()||await pe(),n.geometry=T(n.geometry,t.spatialReference))}else this._logMissingView()}undo(){this.canUndo()&&this._operationHandle?.undo()}redo(){this.canRedo()&&this._operationHandle?.redo()}canUndo(){return!!this._operationHandle?.canUndo()}canRedo(){return!!this._operationHandle?.canRedo()}toggleUpdateTool(){this._operationHandle?.toggleTool()}async _getFirstHit(e){let t=this.view;if(!t)return this._logMissingView(),null;if(t.type===`2d`){let n=[];t.map.allLayers.forEach(e=>{e.type!==`vector-tile`&&e.type!==`imagery`||n.push(e)});let r=await t.hitTest(e,{exclude:n});return ft(r.results)}let n=[t.map.ground];t.map.allLayers.forEach(e=>{Ee(e)&&n.push(e)});let r=await t.hitTest(e,{exclude:n});if(r.results.length>0){let e=r.results[0];if(e!=null&&e.type===`graphic`&&e.graphic&&(!r.ground.mapPoint||t.map.ground.opacity<1||r.ground.distance-(e.distance??0)>-Math.min(3*r.ground.distance,t.viewingMode===`global`?_(t.renderCoordsHelper.spatialReference).radius/t.renderCoordsHelper.unitInMeters:1/0)))return e}return null}_generateViewHandles(e){return[e.on(`immediate-click`,async e=>{let t=this.state===`active`&&this._operationHandle?.type===`create`;this.state!==`disabled`&&!t&&this.updateOnGraphicClick&&await this._updatingHandles.addPromise(this._handleImmediateClick(e))},w.WIDGET)]}async _handleImmediateClick(e){let t=await e.defer(()=>this._getFirstHit(de(e))),n=null;if(t!=null){let r=t.graphic;this.updateGraphics.includes(r)||this.hasGraphic(r)?(e.stopPropagation(),n=r):this.view?.type!==`2d`||this._isComponentGraphic(r)||this.state!==`active`||this.cancel()}else this.state===`active`&&this.cancel();n==null||this.updateGraphics.includes(n)||await this.update([n],{...this.defaultUpdateOptions,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions}})}async _setupCreateOperation(e,t){let n=this.view;if(!n)return this._logMissingView(),null;let r={hasZ:n.type===`3d`,...this.defaultCreateOptions,...t},i=await this._setupDrawGraphicTool(e,n,r);return i==null?null:(n.tools.add(i),n.activeTool=i,this._setupCreateOperationHandle(i,e))}async _setupDrawGraphicTool(e,t,n){if(e===`multipoint`&&t.type===`3d`)return this._logError(`sketch:create`,`Multipoint geometries are not supported in SceneView.`),null;if(!t)return this._logMissingView(),null;let{cursor:r,defaultZ:i,hasZ:a,geometryToPlace:o,graphicProperties:s,mode:c,preserveAspectRatio:l}=n,u=Zt(c,e),d=Qt(e),f=n?.optionsPerTool?.has(e)?n.optionsPerTool.get(e):{},p=f?.preserveAspectRatio??l??e!==`rectangle`,m={centered:e!==`rectangle`&&!(e===`circle`&&!p),cursor:r,defaultZ:i,forceUniformSize:p,graphicProperties:{...s,attributes:{...s?.attributes}},geometryToPlace:o,geometryType:d,mode:u,graphicSymbol:this._getGraphicSymbolFromTool(e),hasZ:a,snappingManager:this.snappingManager,snapToScene:!1,view:t,...f};return t.type===`2d`?this._makeDrawGraphicTool2D(m):this._makeDrawGraphicTool3D(m)}async _makeDrawGraphicTool2D(e){let[t,n,r]=await Promise.all([this._requireModule(a(()=>import(`./editingTools-7hOqqzc_.js`),__vite__mapDeps([37,1,2,38,39,3,4,5,40,12,41,6,42,7,43,44,45,46,47,48,49,23,9,8,10,11,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,15,16,27,69,20,70,71,72,14,22,73,74,75,76,77]))),B(),V()]);return $(t)||this.destroyed?null:new t.module.DrawGraphicTool2D({...e,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:on(e.geometryType)?this.activeFillSymbol:null,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:n,automaticLengthMeasurementUtils:r})}async _makeDrawGraphicTool3D(e){let[t,n,r]=await Promise.all([this._requireModule(a(()=>import(`./editingTools-BiNcIwsv.js`),__vite__mapDeps([78,1,2,38,39,3,4,5,40,12,41,6,42,7,43,44,45,46,47,48,49,23,9,8,10,11,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,15,16,27,69,20,70,71,72,14,22,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,73,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,74,162,163,164,165,166,167,168,169,170,171,13,172,173,174,175]))),B(),V()]);return $(t)||this.destroyed?null:new t.module.DrawGraphicTool3D({...e,elevationInfo:this._layerAdapter?.elevationInfo,snapToScene:!0,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:n,automaticLengthMeasurementUtils:r})}_setupCreateOperationHandle(e,t){let n=this.view;if(!n)return this._logMissingView(),null;let r=null,a=e.forceUniformSize,o=e.centered,s=[n.on(`key-down`,t=>{if(t.key===C.pan)t.stopPropagation(),t.repeat||(e.enabled=!1);else if(t.key===C.complete)t.stopPropagation(),e.completeCreateOperation();else if(t.key!==C.vertexAdd||t.repeat)t.key===C.undo?(t.stopPropagation(),c.undo()):t.key===C.redo?(t.stopPropagation(),c.redo()):t.key!==C.constraint||e.geometryType!==`rectangle`&&e.geometryType!==`circle`||t.repeat?t.key===C.center&&(t.repeat||(e.centered=!o,t.stopPropagation())):(e.forceUniformSize=!a,t.stopPropagation());else{let n=e.drawOperation.geometryType;n!==`polyline`&&n!==`polygon`&&n!==`multipoint`||(t.stopPropagation(),e.drawOperation.commitStagedVertex())}},w.WIDGET),n.on(`key-up`,t=>{t.key===C.pan?e.enabled=!0:t.key!==C.constraint||e.geometryType!==`rectangle`&&e.geometryType!==`circle`?t.key===C.center&&(e.centered=o,t.stopPropagation()):(e.forceUniformSize=a,t.stopPropagation())},w.WIDGET),e.on(`vertex-add`,t=>{switch(r=r==null?`start`:`active`,t.operation){case`apply`:this.emit(`create`,{graphic:e.graphic,state:r,tool:this.activeTool,toolEventInfo:t,type:`create`});break;case`undo`:this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case`redo`:this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on(`cursor-update`,t=>{e.drawOperation.numCommittedVertices>0&&this.emit(`create`,{graphic:e.graphic,state:`active`,tool:this.activeTool,toolEventInfo:{coordinates:t.vertices[0].coordinates,type:`cursor-update`},type:`create`})}),e.on(`vertex-remove`,t=>{switch(t.operation){case`apply`:this.emit(`create`,{graphic:e.graphic,state:`active`,tool:this.activeTool,toolEventInfo:t,type:`create`});break;case`undo`:this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case`redo`:this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on(`complete`,e=>{this._set(`createGraphic`,e.graphic),r=`complete`,e.aborted?c&&c.cancel():c&&c.complete()}),f(()=>this._getGraphicSymbolFromTool(t),t=>{e.graphicSymbol=t})],c=new G({activeComponent:e,type:`create`,onEnd:()=>{i(s),n.tools?.remove(e)},undo:()=>{e.canUndo&&e.undo()},redo:()=>{e.canRedo&&e.redo()},canUndo:()=>e.canUndo,canRedo:()=>e.canRedo});return c}_getGraphicSymbolFromTool(e){switch(e){case`point`:case`multipoint`:return this.pointSymbol;case`polyline`:case`freehandPolyline`:return this.polylineSymbol;case`circle`:case`rectangle`:case`polygon`:case`freehandPolygon`:return this.polygonSymbol;case`mesh`:return this.meshSymbol;case`text`:return this.textSymbol}}async _setupUpdateOperation(e,t){let{view:n}=this;if(!n)return this._logMissingView(),null;let r={...this.defaultUpdateOptions,...t,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...t?.reshapeOptions},highlightOptions:{...this.defaultUpdateOptions.highlightOptions,...t?.highlightOptions}},i=r.tool??q.tool;if(this.removeGraphics(e),this.addGraphics(e),n.type===`3d`){if(e.length===0)return null;switch(i){case`move`:return this._setupMove3DOperation(e,r,n,i);case`reshape`:return e.length>1?(this._logError(`sketch:reshape-multiple`,`Reshape operation does not support multiple graphics.`),null):this._setupReshape3DOperation(e[0],r,n);case`transform`:return this._setupGraphicTransform3DOperation(e,r,n)}}switch(i){case`move`:return this._setupMove2DOperation(e,r,n);case`reshape`:return e.length>1?(this._logError(`sketch:reshape-multiple`,`Reshape operation does not support multiple graphics.`),null):this._setupTransformOrReshape2DOperation(e,i,r,n);case`transform`:return $t(e)&&(i=`reshape`),this._setupTransformOrReshape2DOperation(e,i,r,n)}}async _setupMove3DOperation(e,t,n,r,o=!1){let[s,c]=await Promise.all([this._requireModule(a(()=>import(`./editingTools-BiNcIwsv.js`),__vite__mapDeps([78,1,2,38,39,3,4,5,40,12,41,6,42,7,43,44,45,46,47,48,49,23,9,8,10,11,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,15,16,27,69,20,70,71,72,14,22,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,73,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,74,162,163,164,165,166,167,168,169,170,171,13,172,173,174,175]))),V()]);if($(s))return s;let{ManipulatedObject3DGraphic:l,MoveTool3D:u}=s.module,d=new Map,f=()=>{d.forEach(e=>e.destroy()),d.clear()};for(let t of e){let e=new l({view:n,graphic:t}),r=Ve(e);if(r!==0)return f(),this._logError(`sketch:move`,`Move operation not supported for provided graphic(s) (${pt(r)}).`),null;d.set(t,e)}let p=new u({view:n,enableZ:t.enableZ,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,autoLengthMeasurementUtils:c});n.tools.add(p),p.objects.addMany(Array.from(d.values())),o||this.updateGraphics.addMany(e);let m=[],h=new K({activeComponent:p,tool:r,type:`update`,onEnd:()=>{i(m),Q(n,p),f()},undo:()=>{cn(this.view,p),Y(h,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r})},redo:()=>{X(h,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r})},addToSelection:e=>{this.updateGraphics.push(e);let t=new l({view:n,graphic:e});d.set(e,t),p.objects.push(t),this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:`selection-change`},type:`update`})},removeFromSelection:e=>{let t=this.updateGraphics.indexOf(e);if(h.history.undo.forEach(e=>e.updates.splice(t,1)),h.history.redo.forEach(e=>e.updates.splice(t,1)),this.updateGraphics.remove(e),this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:`selection-change`},type:`update`}),this.updateGraphics.length===0)return void h.complete();let n=d.get(e);n&&(p.objects.remove(n),n.destroy(),d.delete(e))},toggleTool:async()=>{if(this.updateGraphics.length!==1||!1===t.toggleToolOnClick||r!==`transform`)return;let e=this.updateGraphics.at(0),i=await this._setupReshape3DOperation(e,t,n,!0);i&&!$(i)&&(h.onEnd(),h.destroy(),this._setUpdateOperationHandle(i,t))}});return m.push(...this._getHandlesForComponent(h,t),n.on(`immediate-click`,e=>this._getCommonUpdateOperationClickHandlers(h,e,t),w.WIDGET),n.on(`key-down`,e=>{this._getCommonUpdateOperationKeyDownHandlers(h,e)},w.WIDGET)),h}_setupGraphicTransform3DOperation(e,t,n,r=!1){if(e.length===1&&gt(e[0])===0){let i=e[0],a=i.geometry;if(a!=null&&(a.type===`point`||a.type===`mesh`))return this._setupPointTransform3DOperation(i,t,n);if(a!=null&&(a.type===`polygon`||a.type===`polyline`))return this._setupPolyTransform3DOperation(i,t,n,r)}return this._setupMove3DOperation(e,t,n,`transform`,r)}async _setupPointTransform3DOperation(e,t,n){let r=`transform`,{enableRotation:o,enableScaling:s,enableZ:c}=t,l=await this._requireModule(a(()=>import(`./editingTools-BiNcIwsv.js`),__vite__mapDeps([78,1,2,38,39,3,4,5,40,12,41,6,42,7,43,44,45,46,47,48,49,23,9,8,10,11,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,15,16,27,69,20,70,71,72,14,22,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,73,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,74,162,163,164,165,166,167,168,169,170,171,13,172,173,174,175])));if($(l))return l;let{TransformTool3D:u,ManipulatedObject3DGraphic:d}=l.module,f=new d({graphic:e,view:n}),p=new u({object:f,view:n,enableRotation:o,enableScaling:s,enableZ:c,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});n.tools.add(p),this.updateGraphics.add(e);let m=[],h=new K({activeComponent:p,tool:r,type:`update`,onEnd:()=>{i(m),Q(n,p),f.destroy()},undo:()=>{cn(this.view,p),Y(h,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r})},redo:()=>{X(h,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r})},addToSelection:async e=>{this.updateGraphics.add(e),this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:`selection-change`},type:`update`}),h.onEnd(),h.destroy();let r=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,n,`transform`,!0);$(r)||this._setUpdateOperationHandle(r,t)},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:`selection-change`},type:`update`}),h.complete()},toggleTool:()=>{}});return m.push(...this._getHandlesForComponent(h,t),n.on(`immediate-click`,e=>this._getCommonUpdateOperationClickHandlers(h,e,t),w.WIDGET),n.on(`key-down`,e=>{this._getCommonUpdateOperationKeyDownHandlers(h,e)},w.WIDGET)),h}async _setupPolyTransform3DOperation(e,t,n,r=!1){let o=`transform`,{enableRotation:s,enableScaling:c,enableZ:l,preserveAspectRatio:u}=t,[d,f]=await Promise.all([this._requireModule(a(()=>import(`./editingTools-BiNcIwsv.js`),__vite__mapDeps([78,1,2,38,39,3,4,5,40,12,41,6,42,7,43,44,45,46,47,48,49,23,9,8,10,11,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,15,16,27,69,20,70,71,72,14,22,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,73,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,74,162,163,164,165,166,167,168,169,170,171,13,172,173,174,175]))),V()]);if($(d))return d;let{ManipulatedObject3DGraphic:p,ExtentTransformTool:m}=d.module,h=this.view?.inputManager?.isModifierKeyDown(C.constraint),g=new p({view:n,graphic:e}),_=new m({object:g,view:n,enableRotation:s,enableScaling:c,enableZ:l,preserveAspectRatio:!!u!=!!h,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:f});n.tools.add(_),r||this.updateGraphics.add(e);let v=[],y=new K({activeComponent:_,tool:o,type:`update`,onEnd:()=>{i(v),Q(n,_),g.destroy()},canUndo:()=>!_.destroyed&&_.canUndo,undo:()=>{_.destroyed||(_.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},canRedo:()=>!_.destroyed&&_.canRedo,redo:()=>{_.destroyed||(_.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},addToSelection:async e=>{this.updateGraphics.add(e),this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:`selection-change`},type:`update`}),y.onEnd(),y.destroy();let r=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,n,`transform`,!0);$(r)||this._setUpdateOperationHandle(r,t)},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:`selection-change`},type:`update`}),y.complete()},toggleTool:async()=>{if(this.updateGraphics.length!==1||!1===t.toggleToolOnClick)return;let r=await this._setupReshape3DOperation(e,t,n,!0);r&&!$(r)&&(y.onEnd(),y.destroy(),this._setUpdateOperationHandle(r,t))}});return v.push(...this._getHandlesForComponent(y,t),n.on(`immediate-click`,e=>this._getCommonUpdateOperationClickHandlers(y,e,t),w.WIDGET),n.on(`key-down`,e=>this._getCommonUpdateOperationKeyDownHandlers(y,e),w.WIDGET),n.on(`key-down`,e=>{e.key!==C.constraint||e.repeat||(_.preserveAspectRatio=!_.preserveAspectRatio,e.stopPropagation())},w.WIDGET),n.on(`key-up`,e=>{e.key===C.constraint&&(_.preserveAspectRatio=!_.preserveAspectRatio,e.stopPropagation())},w.WIDGET)),y}async _setupMove2DOperation(e,t,n){let r=`move`;this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));let a=await this._getGraphicMover(e,t,n);if($(a))return a;let o=new K({activeComponent:a,tool:r,type:`update`,onEnd:()=>{this._clearCursor(),i(l),i(c),a.destroy(),this._internalGraphicsLayer?.removeMany([...this.updateGraphics.toArray()])},undo:()=>{let e=this.updateGraphics.toArray();Y(o,e),o.refreshComponent(),this._emitUndoEvent({graphics:e,tool:r})},redo:()=>{let e=this.updateGraphics.toArray();X(o,e),o.refreshComponent(),this._emitRedoEvent({graphics:e,tool:r})},addToSelection:async e=>{await this._updatingHandles.addPromise(this._updateSpatialReference(e)),this.updateGraphics.push(e),a.graphics=this.updateGraphics.toArray(),this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:`selection-change`},type:`update`})},removeFromSelection:e=>{let t=this.updateGraphics.indexOf(e);o.history.undo.forEach(e=>e.updates.splice(t,1)),o.history.redo.forEach(e=>e.updates.splice(t,1)),this.updateGraphics.remove(e);let n=this.updateGraphics.toArray();this.emit(`update`,{graphics:n,state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:`selection-change`},type:`update`}),this.updateGraphics.length===0?o.complete():a.graphics=n}}),s=!1,c=[n.on(`immediate-click`,e=>this._getCommonUpdateOperationClickHandlers(o,e,t),w.WIDGET),n.on(`key-down`,e=>{this._getCommonUpdateOperationKeyDownHandlers(o,e),e.key!==C.constraint||e.repeat||(s=!0,a.enableMoveAllGraphics=!a.enableMoveAllGraphics)},w.WIDGET),n.on(`key-up`,e=>{e.key===C.constraint&&s&&(s=!1,a.enableMoveAllGraphics=!a.enableMoveAllGraphics)},w.WIDGET)],l=this._getHandlesForComponent(o,t);return o}async _setupReshape3DOperation(e,t,n,r=!1){let o=`reshape`,[s,c,l]=await Promise.all([this._requireModule(a(()=>import(`./editingTools-BiNcIwsv.js`),__vite__mapDeps([78,1,2,38,39,3,4,5,40,12,41,6,42,7,43,44,45,46,47,48,49,23,9,8,10,11,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,15,16,27,69,20,70,71,72,14,22,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,73,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,74,162,163,164,165,166,167,168,169,170,171,13,172,173,174,175]))),B(),V()]);if($(s))return s;let{ManipulatedObject3DGraphic:u,ReshapeTool3D:d}=s.module,f=new u({view:n,graphic:e}),p=mt(f);if(p!==0)return f.destroy(),this._logError(`sketch:reshape`,`Reshape operation not supported for provided graphic(s) (${pt(p)}).`),null;let m=t.reshapeOptions,h=new d({view:n,object:f,enableZVertex:t.enableZ&&m?.vertexOperation===`move`,enableZShape:t.enableZ&&m?.shapeOperation===`move`,enableMoveObject:m?.shapeOperation===`move`||m?.shapeOperation===`move-xy`,enableMidpoints:m?.edgeOperation===`split`,enableEdgeOffset:m?.edgeOperation===`offset`,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:c,automaticLengthMeasurementUtils:l});n.tools.add(h),r||this.updateGraphics.add(f.graphic);let g=[],_=new K({activeComponent:h,tool:o,type:`update`,onEnd:()=>{i(g),Q(n,h),f.destroy()},canUndo:()=>!h.destroyed&&h.canUndo,undo:()=>{h.destroyed||(h.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},canRedo:()=>!h.destroyed&&h.canRedo,redo:()=>{h.destroyed||(h.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},addToSelection:async e=>{this.updateGraphics.add(e),this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:`selection-change`},type:`update`}),_.onEnd(),_.destroy();let r=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,n,`transform`,!0);$(r)||this._setUpdateOperationHandle(r,t)},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:`selection-change`},type:`update`}),_.complete()},toggleTool:async()=>{if(!1===t.toggleToolOnClick)return;_.onEnd(),_.destroy();let e=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),t,n,!0);$(e)||this._setUpdateOperationHandle(e,t)}});return g.push(...this._getHandlesForComponent(_,t),n.on(`immediate-click`,e=>this._getCommonUpdateOperationClickHandlers(_,e,t),w.WIDGET),n.on(`key-down`,e=>{this._getCommonUpdateOperationKeyDownHandlers(_,e)},w.WIDGET)),_}async _setupTransformOrReshape2DOperation(e,t,n,r){this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));let a=t===`transform`?await this._getBox(e,n,r):await this._getReshape(e,n,r);if($(a))return a;let o=new K({activeComponent:a,type:`update`,onEnd:()=>{i(c),i(s),o.activeComponent&&!o.activeComponent.destroyed&&o.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{Y(o,this.updateGraphics.toArray()),o.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:o.tool})},redo:()=>{X(o,this.updateGraphics.toArray()),o.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:o.tool})},addToSelection:async e=>{let t=o.activeComponent;if(t?.type===`reshape`){let t=[...this.updateGraphics,e];this.updateGraphics.removeAll(),o.onEnd(),o.destroy();let i=await this._setupTransformOrReshape2DOperation(t,`transform`,n,r);if($(i))return;this._setUpdateOperationHandle(i,n)}else this.updateGraphics.add(e),t.graphics=this.updateGraphics.toArray(),t.refresh(),o.resetHistory();this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:`selection-change`},type:`update`})},removeFromSelection:e=>{let t=this.updateGraphics.indexOf(e);o.history.undo.forEach(e=>e.updates.splice(t,1)),o.history.redo.forEach(e=>e.updates.splice(t,1)),this.updateGraphics.remove(e);let n=this.updateGraphics.toArray();n.length===0?o.complete():$t(n)?o.toggleTool():o.activeComponent.graphics=n,this.emit(`update`,{graphics:n,state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:`selection-change`},type:`update`})},toggleTool:async()=>{if(this.updateGraphics.length>1)return;let e=this.updateGraphics.at(0),t=e.geometry;if(t!=null&&(o.tool===`reshape`&&t.type===`point`||o.tool===`transform`&&t.type===`extent`))return;let a=null;o.tool===`transform`?a=await this._getReshape([e],n,r):o.tool===`reshape`&&(a=await this._getBox([e],n,r)),$(a)||(o.activeComponent?.destroy(),o.activeComponent=a,o.activeComponent&&(i(c),c=this._getHandlesForComponent(o,n)))}}),s=[r.on(`immediate-click`,e=>this._getCommonUpdateOperationClickHandlers(o,e,n),w.WIDGET),r.on(`key-down`,e=>{if(this._getCommonUpdateOperationKeyDownHandlers(o,e),e.key===C.constraint&&!e.repeat&&o){let e=o.activeComponent;e&&e.type===`box`&&(e.preserveAspectRatio=!e.preserveAspectRatio)}},w.WIDGET),r.on(`key-up`,e=>{if(e.key===C.constraint&&o){let e=o.activeComponent;e&&e.type===`box`&&(e.preserveAspectRatio=!e.preserveAspectRatio)}},w.WIDGET)],c=this._getHandlesForComponent(o,n);return o}async _getGraphicMover(e,t,n){let{enableMoveAllGraphics:r,highlightOptions:i}=t,o=await this._requireModule(a(()=>import(`./GraphicMover-DvViIC8D.js`),__vite__mapDeps([203,6,1,2,8,63,68,204,76,67,205,33])));return $(o)?o:new o.module.default({enableMoveAllGraphics:r,highlightName:i?.name,highlightsEnabled:!!i?.enabled,indicatorsEnabled:!1,graphics:e,view:n,callbacks:{onGraphicMoveStart:({dx:e,dy:t,graphic:n})=>{this._displayCursor(`grabbing`),this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:n,type:`move-start`},type:`update`})},onGraphicMove:({dx:e,dy:t,graphic:n})=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:n,type:`move`},type:`update`}),onGraphicMoveStop:({dx:e,dy:t,graphic:n})=>{this._displayCursor(`pointer`),this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:n,type:`move-stop`},type:`update`})},onGraphicPointerOver:()=>this._displayCursor(`move`),onGraphicPointerOut:()=>this._clearCursor()}})}async _getBox(e,t,n){let{enableRotation:r,enableScaling:i,highlightOptions:o,preserveAspectRatio:s}=t,[c,l]=await Promise.all([this._requireModule(a(()=>import(`./Box-_N-2X-Wq.js`),__vite__mapDeps([206,1,2,5,45,6,42,7,43,44,46,47,48,49,23,9,8,10,11,63,68,204,76,67,205,33,207,72,174,175]))),V()]);if($(c))return c;let u=this.view?.inputManager?.isModifierKeyDown(C.constraint);return new c.module.default({graphics:e,enableRotation:r,enableScaling:i,highlightName:o?.name,highlightsEnabled:!!o?.enabled,preserveAspectRatio:!!s!=!!u,layer:this._internalGraphicsLayer,view:n,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:l,callbacks:{onMoveStart:e=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:`update`}),onMove:e=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:`update`}),onMoveStop:e=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:`update`}),onScaleStart:e=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:`update`}),onScale:e=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:`update`}),onScaleStop:e=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:`update`}),onRotateStart:e=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:`update`}),onRotate:e=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:`update`}),onRotateStop:e=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:`update`})}})}async _getReshape(e,t,n){let{highlightOptions:r,reshapeOptions:i}=t,o=i?.edgeOperation===`split`,s=i?.shapeOperation===`move`,c=!!i?.enableCreateCurveFromStraightEdge,[l,u,d]=await Promise.all([this._requireModule(a(()=>import(`./Reshape-DMQ44-Zy.js`),__vite__mapDeps([208,1,2,53,54,55,56,57,58,4,5,73,209,45,6,42,7,43,44,46,47,48,49,23,9,8,10,11,59,60,71,12,63,68,74,162,210,211,212,163,213,214,215,75,66,67,15,16,27,69,20,70,172,204,76,205,33,207,72,175]))),B(),V()]);return $(l)?l:new l.module.default({enableMidpoints:o,enableMovement:s,enableCurveOnMidpoint:c,graphic:e[0],highlightName:r?.name,highlightsEnabled:!!r?.enabled,layer:this._internalGraphicsLayer,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:u,automaticLengthMeasurementUtils:d,view:n,callbacks:{onReshapeStart:e=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:`update`}),onReshape:e=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:`update`}),onReshapeStop:({mover:e,type:t})=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e,type:t},type:`update`}),onMoveStart:({dx:e,dy:t,mover:n,type:r})=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:n,type:r},type:`update`}),onMove:({dx:e,dy:t,mover:n,type:r})=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:n,type:r},type:`update`}),onMoveStop:({dx:e,dy:t,mover:n,type:r})=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:n,type:r},type:`update`}),onVertexAdd:({added:e,type:t,vertices:n})=>{let r=e.map(e=>De(e.geometry));this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{added:r,vertices:n,type:t},type:`update`})},onVertexRemove:({removed:e,type:t,vertices:n})=>{let r=e.map(e=>De(e.geometry));this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{removed:r,vertices:n,type:t},type:`update`})}}})}_getHandlesForComponent(e,t){let n=e.activeComponent;if(!n)return[];switch(n.type){case`graphic-mover`:return[n.on(`graphic-click`,({graphic:n,viewEvent:r})=>{r.native?.shiftKey&&t.multipleSelectionEnabled&&(r.stopPropagation(),e.removeFromSelection(n))}),n.on(`graphic-move-start`,t=>e.addToHistory(Z(t.allGraphics)))];case`box`:return[n.on(`graphic-click`,n=>this._onTransformOrReshape2DGraphicClick(e,t,n)),n.on(`move-start`,t=>e.addToHistory(Z(t.graphics))),n.on(`rotate-start`,t=>e.addToHistory(Z(t.graphics))),n.on(`scale-start`,t=>e.addToHistory(Z(t.graphics)))];case`reshape`:return[n.on(`graphic-click`,n=>this._onTransformOrReshape2DGraphicClick(e,t,n)),n.on(`move-start`,t=>e.addToHistory(Z([t.mover]))),n.on(`reshape-start`,t=>e.addToHistory(Z([t.graphic]))),n.on(`vertex-add`,t=>e.addToHistory(Z([t.oldGraphic]))),n.on(`vertex-remove`,t=>e.addToHistory(Z([t.oldGraphic])))];case`move-3d`:return[n.events.on(`record-undo`,({updates:t})=>{e.addToHistory({updates:t})}),n.events.on(`move-start`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:e.objects.length>0?e.objects[0].graphic:null,type:`move-start`},type:`update`})}),n.events.on(`move`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e.dx,dy:e.dy,mover:e.objects.length>0?e.objects[0].graphic:null,type:`move`},type:`update`})}),n.events.on(`move-stop`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:e.objects.length>0?e.objects[0].graphic:null,type:`move-stop`},type:`update`})}),n.events.on(`immediate-click`,n=>{n.shiftKey?this._toggleSelection([n.object.graphic],e,t):e.toggleTool()})];case`transform-3d`:return[n.events.on(`record-undo`,({updates:t})=>{e.addToHistory({updates:t})}),n.events.on(`translate-start`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,dx:e.dxScreen,dy:e.dyScreen,type:`move-start`},type:`update`})}),n.events.on(`translate-stop`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,dx:e.dxScreen,dy:e.dyScreen,type:`move-stop`},type:`update`})}),n.events.on(`rotate-start`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,angle:e.angle,type:`rotate-start`},type:`update`})}),n.events.on(`rotate-stop`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,angle:e.angle,type:`rotate-stop`},type:`update`})}),n.events.on(`scale-start`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,xScale:e.xScale,yScale:e.yScale,type:`scale-start`},type:`update`})}),n.events.on(`scale-stop`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,xScale:e.xScale,yScale:e.yScale,type:`scale-stop`},type:`update`})}),n.events.on(`translate`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,dx:e.dxScreen,dy:e.dyScreen,type:`move`},type:`update`})}),n.events.on(`rotate`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,angle:e.angle,type:`rotate`},type:`update`})}),n.events.on(`scale`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,xScale:e.xScale,yScale:e.yScale,type:`scale`},type:`update`})}),n.events.on(`immediate-click`,n=>{n.shiftKey?this._toggleSelection([n.object.graphic],e,t):e.toggleTool()})];case`reshape-3d`:return[n.events.on(`reshape`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{...e,mover:e.object.graphic},type:`update`})}),n.events.on(`move`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{...e,mover:e.object.graphic},type:`update`})}),n.events.on(`vertex-add`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:e,type:`update`})}),n.events.on(`vertex-remove`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:e,type:`update`})}),n.events.on(`immediate-click`,n=>{n.shiftKey?this._toggleSelection([n.object.graphic],e,t):e.toggleTool()})]}}_onTransformOrReshape2DGraphicClick(e,t,n){let{graphic:r,viewEvent:i}=n;return i.native?.shiftKey&&this.hasGraphic(r)?(i.stopPropagation(),e.removeFromSelection(r)):t.toggleToolOnClick?(i.stopPropagation(),e.toggleTool()):void 0}_setUpdateOperationHandle(e,t){this._operationHandle=e;let n=this.view?.map;this._disablePopup(t),e.on(`complete`,()=>{if(e===this._operationHandle){let r=this.updateGraphics.toArray(),i=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),n&&n.remove(this._internalGraphicsLayer),this._restorePopup(t),this.emit(`update`,{graphics:r,state:`complete`,aborted:e.cancelled,tool:i,toolEventInfo:null,type:`update`})}})}async _getCommonUpdateOperationClickHandlers(e,t,n){let r=de(t),i=await t.defer(()=>this._getFirstHit(r));if(i==null)return void e.complete();if(t.native.shiftKey&&this._toggleSelection([i.graphic],e,n))return void t.stopPropagation();this.updateGraphics.includes(i.graphic)?t.stopPropagation():e.complete()}_toggleSelection(e,t,n){let r=!!n.multipleSelectionEnabled;return e.some(e=>e!=null&&!(!r||!this.hasGraphic(e))&&(this.updateGraphics.includes(e)?t.removeFromSelection(e):t.addToSelection(e),!0))}_getCommonUpdateOperationKeyDownHandlers(e,t){if(!e)return;let n=t.key;n===C.undo&&e.canUndo()?(t.stopPropagation(),e.undo()):n===C.redo&&e.canRedo()?(t.stopPropagation(),e.redo()):n===C.cancel?(t.stopPropagation(),e.cancel()):this.allowDeleteKey&&C.delete.includes(n)&&this._onDeleteKey(t)}_onDeleteKey(e){if(!this._operationHandle||this._operationHandle.type!==`update`)return;let t=this.activeComponent,n=this.updateGraphics.toArray();t!=null&&(t.type!==`reshape`||n.length===1&&n[0].geometry?.type===`point`)&&(e.stopPropagation(),this.delete())}_removeDefaultLayer(){this._internalGraphicsLayer&&=(this.view?.map?.remove(this._internalGraphicsLayer),x(this._internalGraphicsLayer))}_isComponentGraphic(e){let{activeComponent:t}=this;return!(!e||t==null)&&(e.attributes?.esriSketchTool||t.type===`draw-2d`&&t.graphic===e||(t.type===`box`||t.type===`reshape`)&&t.isUIGraphic(e))}_clearCursor(){this.removeHandles(tn)}_displayCursor(e){this.removeHandles(tn),this.view?.container&&e!=null&&this.addHandles(this.view.acquireCursor(e,`high`),tn)}_logError(e,t,n){we.getLogger(this).error(new oe(e,t,n))}async _requireModule(e){let t=new AbortController;this._moduleLoaderAbortController=t;let n=await e;return this._moduleLoaderAbortController!==t||t.signal.aborted?{requireError:`aborted`}:{module:n}}_emitUndoEvent(e){this.emit(`undo`,{...e,type:`undo`})}_emitRedoEvent(e){this.emit(`redo`,{...e,type:`redo`})}_emitDeleteEvent(e){this.emit(`delete`,{...e,type:`delete`})}_onLayerGraphicsChangeCallback(e){if(this._operationHandle!=null){let{updateGraphics:t}=this;for(let n of e.removed)if(t.includes(n)){if(!(t.length>1)){this._operationHandle.cancel();break}this._operationHandle.removeFromSelection(n)}}}get test(){}wait(){return o(()=>!this.updating)}_disablePopupEnabled(e){return this.view?.type!==`3d`||this.updateOnGraphicClick||(e?.toggleToolOnClick??!1)}_disablePopup(e){this._disablePopupEnabled(e)&&this.view&&this._originalPopupEnabled==null&&(this._originalPopupEnabled=this.view.popupEnabled,this.view.popupEnabled=!1)}_restorePopup(e){this._disablePopupEnabled(e)&&this.view&&this._originalPopupEnabled!=null&&(this.view.popupEnabled=this._originalPopupEnabled,this._originalPopupEnabled=null)}async _waitViewReady(){let e=this.view;e?(le(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await be(o(()=>e?.ready),this._viewReadyAbortController.signal)):this._logMissingView()}_logMissingView(){this._logError(`sketch:missing-property`,an(`view`))}_logMissingLayer(){this._logError(rn,an(`layer`))}};r([m()],J.prototype,`_defaultSnappingManager`,void 0),r([m()],J.prototype,`_layerAdapter`,null),r([m()],J.prototype,`_operationHandle`,void 0),r([m({readOnly:!0})],J.prototype,`_updatingHandles`,void 0),r([m({readOnly:!0})],J.prototype,`activeTool`,null),r([m({readOnly:!0})],J.prototype,`activeCreateToolDrawMode`,null),r([m()],J.prototype,`activeTooltip`,null),r([m({types:l})],J.prototype,`activeFillSymbol`,void 0),r([m()],J.prototype,`activeLineSymbol`,void 0),r([m()],J.prototype,`activeVertexSymbol`,void 0),r([m()],J.prototype,`allowDeleteKey`,void 0),r([m({readOnly:!0})],J.prototype,`createGraphic`,null),r([m()],J.prototype,`defaultCreateOptions`,null),r([m()],J.prototype,`defaultUpdateOptions`,null),r([m({type:Ue,nonNullable:!0})],J.prototype,`labelOptions`,null),r([m()],J.prototype,`layer`,void 0),r([m({types:l})],J.prototype,`pointSymbol`,void 0),r([m({types:l})],J.prototype,`polygonSymbol`,void 0),r([m({types:l})],J.prototype,`polylineSymbol`,void 0),r([m()],J.prototype,`meshSymbol`,void 0),r([m()],J.prototype,`textSymbol`,void 0),r([m({type:M,nonNullable:!0})],J.prototype,`snappingOptions`,null),r([m()],J.prototype,`snappingManager`,null),r([m({readOnly:!0})],J.prototype,`state`,null),r([m({type:Ge,nonNullable:!0})],J.prototype,`tooltipOptions`,null),r([m({readOnly:!0})],J.prototype,`updateGraphics`,void 0),r([m()],J.prototype,`updateOnGraphicClick`,void 0),r([m()],J.prototype,`updating`,null),r([m()],J.prototype,`creationMode`,void 0),r([m({type:We,nonNullable:!0})],J.prototype,`valueOptions`,null),r([m({types:l})],J.prototype,`vertexSymbol`,void 0),r([m({value:null})],J.prototype,`view`,null),r([m({constructOnly:!0,type:Ke})],J.prototype,`sketchOptions`,void 0),J=r([b(`esri.widgets.Sketch.SketchViewModel`)],J);var rn=`sketch:missing-property`,an=e=>`Property '${e}' is missing on SketchViewModel.`;function on(e){return e===`polygon`||e===`rectangle`||e===`circle`}function Y(e,t){sn(`undo`,e.history.undo,e.history.redo,t)}function X(e,t){sn(`redo`,e.history.redo,e.history.undo,t)}function sn(e,t,n,r){let i=t.pop();if(!i)return;let a=i.updates,o=[];r.forEach((t,n)=>{let r=a[n];r!=null&&(`geometry`in r&&r.geometry!=null&&(o.push({geometry:t.geometry}),t.geometry=r.geometry),`symbol`in r&&r.symbol!=null&&(o.push({symbol:t.symbol}),t.symbol=r.symbol),`undo`in r&&(o.push(r),r[e](t)))}),n.push({updates:o})}function cn(e,t){e!=null&&t.hasGrabbedManipulators&&(e.activeTool=null)}function Z(e){return{updates:e.map(({geometry:e})=>e?.type===`mesh`?{geometry:e.cloneShallow()}:{geometry:e})}}function Q(e,t){e.tools?.remove(t),t.destroyed||t.destroy()}function $(e){return`requireError`in e&&e.requireError===`aborted`}export{J as t};