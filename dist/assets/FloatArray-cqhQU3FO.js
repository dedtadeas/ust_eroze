import{XE as e,rc as t}from"./index-BqmCqmfp.js";import{A as n,B as r,C as i,D as a,E as o,F as s,H as c,I as l,L as u,M as d,N as f,O as p,P as m,R as h,S as g,T as _,_ as ee,a as v,b as y,c as b,d as te,f as x,g as S,h as C,i as w,j as T,k as E,l as D,m as O,n as k,o as A,p as j,r as M,s as N,t as P,u as F,v as I,w as L,x as R,y as z,z as B}from"./BufferView-DNaZpbJX.js";import{a as V}from"./Util-3rPi0NfK.js";import{t as H}from"./types-BLimCzcc.js";import{t as U}from"./VertexAttributeLocations-IAhvKZqd.js";import{t as W}from"./VertexElementDescriptor-BGWnA0Rs.js";function G(e,t=0){let n=e.stride;return Array.from(e.fields.keys()).map(r=>{let i=e.fields.get(r),a=i.constructor.ElementCount,o=K(i.constructor.ElementType),s=i.offset,c=i.optional?.glNormalized??!1;return new W(r,a,o,s,n,c,t)})}function K(e){switch(e){case`u8`:return t.UNSIGNED_BYTE;case`u16`:return t.UNSIGNED_SHORT;case`u32`:return t.UNSIGNED_INT;case`i8`:return t.BYTE;case`i16`:return t.SHORT;case`i32`:return t.INT;case`f16`:return t.HALF_FLOAT;case`f32`:return t.FLOAT;default:throw Error(`BufferType not supported in WebGL`)}}var q=class e{constructor(e,t){this.layout=e,this.buffer=typeof t==`number`?new ArrayBuffer(t*e.stride):t;for(let t of e.fields.keys()){let n=e.fields.get(t);this[t]=new n.constructor(this.buffer,n.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,t){let n=this[e];return n&&n.elementCount===t.ElementCount&&n.elementType===t.ElementType?n:null}slice(t,n){return new e(this.layout,this.buffer.slice(t*this.stride,n*this.stride))}copyFrom(e,t=0,n=0,r=e.count){let i=this.stride;if(i%4==0){let a=new Uint32Array(e.buffer,t*i,r*i/4);new Uint32Array(this.buffer,n*i,r*i/4).set(a)}else{let a=new Uint8Array(e.buffer,t*i,r*i);new Uint8Array(this.buffer,n*i,r*i).set(a)}return this}get usedMemory(){return this.byteLength}dispose(){}},J=class e{constructor(e){this._stride=0,this._fields=new Map,e&&(this._stride=e.stride,e.fields.forEach(e=>this._fields.set(e[0],{...e[1],constructor:ne(e[1].constructor)})))}freeze(){return this}get locations(){return U(G(this))}vec2f16(e,t){return this._appendField(e,c?m:B,t),this}vec2f(e,t){return this._appendField(e,B,t),this}vec2f64(e,t){return this._appendField(e,_,t),this}vec3f16(e,t){return this._appendField(e,c?E:f,t),this}vec3f(e,t){return this._appendField(e,f,t),this}vec3f64(e,t){return this._appendField(e,R,t),this}vec4f16(e,t){return this._appendField(e,c?d:y,t),this}vec4f(e,t){return this._appendField(e,y,t),this}vec4f64(e,t){return this._appendField(e,A,t),this}mat3f(e,t){return this._appendField(e,o,t),this}mat3f64(e,t){return this._appendField(e,h,t),this}mat4f(e,t){return this._appendField(e,v,t),this}mat4f64(e,t){return this._appendField(e,P,t),this}vec4u8(e,t){return this._appendField(e,p,t),this}f16(e,t){return this._appendField(e,c?L:a,t),this}f32(e,t){return this._appendField(e,a,t),this}f64(e,t){return this._appendField(e,k,t),this}u8(e,t){return this._appendField(e,D,t),this}u16(e,t){return this._appendField(e,u,t),this}i8(e,t){return this._appendField(e,r,t),this}vec2i8(e,t){return this._appendField(e,M,t),this}vec2i16(e,t){return this._appendField(e,F,t),this}vec2u8(e,t){return this._appendField(e,n,t),this}vec2u16(e,t){return this._appendField(e,x,t),this}vec4u16(e,t){return this._appendField(e,j,t),this}vec4i16(e,t){return this._appendField(e,O,t),this}u32(e,t){return this._appendField(e,l,t),this}_appendField(e,t,n){this._fields.has(e)&&V(!1,`${e} already added to vertex buffer layout`);let r=t.ElementCount*H(t.ElementType),i=this._stride;this._fields.set(e,{constructor:t,size:r,offset:i,optional:n}),this._alignFields()}_alignFields(){let e=0,t=1;this._fields.forEach(n=>{let r=H(n.constructor.ElementType);e=Math.floor((e+r-1)/r)*r,n.offset=e,e+=n.size,t=Math.max(t,r)}),e=Math.floor((e+t-1)/t)*t,this._stride=e}createBuffer(e){return new q(this,e)}createView(e){return new q(this,e)}clone(){let t=new e;return t._stride=this._stride,t._fields=new Map,this._fields.forEach((e,n)=>t._fields.set(n,e)),t.BufferType=this.BufferType,t}get stride(){return this._stride}get fields(){return this._fields}};function Y(){return new J}var X=class{constructor(e){this.fields=[],e.fields.forEach((e,t)=>{let n={...e,constructor:Q(e.constructor)};this.fields.push([t,n])}),this.stride=e.stride}},Z=[a,B,f,y,o,v,k,_,R,A,h,P,D,n,C,p,u,x,g,j,l,z,T,s,r,M,w,N,b,F,te,O,S,ee,I,i];function Q(e){return`${e.ElementType}_${e.ElementCount}`}function ne(e){return $.get(e)}var $=new Map;Z.forEach(e=>$.set(Q(e),e));function re(e,t=!1){return e<=1024?t?Array(e).fill(0):Array(e):new Float32Array(e)}function ie(e){return(Array.isArray(e)?e.length:e.byteLength/8)<=1024?Array.from(e):new Float32Array(e)}function ae(e,t,n){return Array.isArray(e)?e.slice(t,t+n):e.subarray(t,t+n)}export{Y as a,J as i,ae as n,X as o,re as r,G as s,ie as t};