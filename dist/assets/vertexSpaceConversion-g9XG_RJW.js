import{AS as e,Al as t,FS as n,Fl as r,GS as i,H_ as a,Ix as o,Jg as s,Jy as c,Ky as l,LS as u,Nh as d,Oh as f,Ol as p,Qx as m,Rh as h,Wl as g,cS as _,hh as ee,ip as v,jh as y,k_ as te,kg as ne,np as b,ob as re,rC as ie,su as ae,vE as oe,z_ as x}from"./index-BqmCqmfp.js";import{a as se,t as ce}from"./meshVertexSpaceUtils-Y8FeTLov.js";import{n as S}from"./projectPointToVector-Clou1sfo.js";import{t as C}from"./computeTranslationToOriginAndRotation-BC3OuSky.js";import{N as w,x as T}from"./BufferView-DNaZpbJX.js";import{n as le,o as E,s as D,t as O}from"./vec3-40WN6G4a.js";import{i as ue}from"./vec4-CcFo8HF1.js";import{n as de,t as fe}from"./spatialReferenceEllipsoidUtils-DBtdxVkA.js";var pe=`Projection may be possible after calling projection.load().`;function k(e,t,n,r){e.error(`Failed to project from (wkid:${t.wkid}) to (wkid:${n.wkid}).${r?` `:``}${r}`)}function A(e,t,n,r,i,a){return B(0,w.fromTypedArray(e),0,T.fromTypedArray(t),n,T.fromTypedArray(r),i,w.fromTypedArray(a))?a:null}function j(e,t,n,r,i,a){return B(1,w.fromTypedArray(e),0,T.fromTypedArray(t),n,T.fromTypedArray(r),i,w.fromTypedArray(a))?a:null}function M(e,t,n,r){return ne(e,t,0,n,r,0)?n:null}function N(e,t,n,r){return ne(e,t,0,n,r,0)?n:null}function P(e,t,n){return x(W,n),E(t,e,W),c(W)&&le(t,t),t}function F(e,t,n){return a(W,n),ue(t,e,W),c(W)&&le(t,t,4),t}function me(e,t,n,r){let i=t===0;return I(e,t,n,(e,t)=>{let n=Math.cos(re(e));t[0]=i?n:1/n,t[1]=1},r)}function he(e,t,n,r){let i=t===0;return I(e,t,n,(e,t)=>{let n=Math.cosh(-e/ie.radius);t[0]=1,t[1]=i?n:1/n},r)}function I(e,t,n,r,i){let a=t===0?3:4,o=[0,0];for(let t=0,s=1;t<e.length;t+=a,s+=3){r(n[s],o);let c=e[t]*o[0],l=e[t+1]*o[1],u=e[t+2],d=1/Math.sqrt(c*c+l*l+u*u);i[t]=c*d,i[t+1]=l*d,i[t+2]=u*d,a===4&&(i[t+3]=e[t+3])}return i}function L(e,t,n,r,i,a){if(!B(0,w.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),1,T.fromTypedArray(t),n,T.fromTypedArray(r),i,w.fromTypedArray(a,4*Float32Array.BYTES_PER_ELEMENT)))return null;for(let t=3;t<e.length;t+=4)a[t]=e[t];return a}function R(e,t,n,r,i,a){if(!B(1,w.fromTypedArray(e,16),1,T.fromTypedArray(t),n,T.fromTypedArray(r),i,w.fromTypedArray(a,16)))return null;for(let t=3;t<e.length;t+=4)a[t]=e[t];return a}function z(e,t,n,r,i){switch(C(r,n,U,r),e===1&&d(U,U),t){case 0:return x(i,U);case 1:return a(i,U)}}function B(e,t,n,i,a,s,c,l){if(!t)return;let u=i.count;if(ge(a))for(let i=0;i<u;i++)s.getVec(i,V),t.getVec(i,H),r(H,H,z(e,n,V,c,W)),l.setVec(i,H);else for(let a=0;a<u;a++){s.getVec(a,V),t.getVec(a,H);let u=o(i.get(a,1)),d=Math.cos(u);n===1!=(e===0)&&(d=1/d),z(e,n,V,c,W),e===0?(W[0]*=d,W[1]*=d,W[2]*=d,W[3]*=d,W[4]*=d,W[5]*=d):(W[0]*=d,W[3]*=d,W[6]*=d,W[1]*=d,W[4]*=d,W[7]*=d),r(H,H,W),p(H,H),l.setVec(a,H)}return l}function ge(t){return t.isWGS84||i(t)||e(t)||u(t)}var V=s(),H=s(),U=b(),W=te(),G=()=>oe.getLogger(`esri.geometry.support.meshUtils.vertexSpaceConversion`);function _e(e,n,{vertexSpace:r,spatialReference:i}){if(r.type===`georeferenced`){let t=e;if(!S(n,t,i))return!1;let{origin:a}=r;return g(e,t,a),!0}let a=fe(i),o=e;if(!S(n,o,a))return!1;let{origin:s}=r,c=Me;if(!C(i,s,c,a))return!1;let l=d(Me,c);return l!=null&&(t(e,o,l),!0)}function ve(e,t,n){let{vertexSpace:r,transform:i,vertexAttributes:a}=e,o=se(r)?i:null,s=Y(e.spatialReference,n,3);if(ce(r,t)&&(!o||ee(o.localMatrix,v))&&X(s)){let{position:e,normal:t,tangent:r}=a,i=n?.allowBufferReuse;return{position:i?e:e.slice(),normal:i?t:t?.slice(),tangent:i?r:r?.slice()}}switch(e.vertexSpace.type){case`local`:return t.type===`local`?Ce(e,e.vertexSpace,t.origin,n):be(e,e.vertexSpace,t.origin,n);case`georeferenced`:return t.type===`local`?xe(e,e.vertexSpace,t.origin,n):ye(e,e.vertexSpace,t.origin,n)}}function ye({vertexAttributes:e,transform:t,spatialReference:n},{origin:r},i,a){let o=Y(n,a,3),s=r||!X(o)?h(Q,t?.localMatrix??v):null;s&&J(s,n,a,3);let{position:c,normal:l,tangent:u}=s?q(e,s):e,d=a?.allowBufferReuse,f=d?c:new Float64Array(c.length),p=c;if(r&&(p=O(f,p,r)),i){let e=ae(je,i);p=O(f,p,e)}return{position:p!==e.position||d?p:p.slice(),normal:l!==e.normal||d?l:l?.slice(),tangent:u!==e.tangent||d?u:u?.slice()}}function K(e,t){return t?.useEllipsoid&&n(e)?de:fe(e)}function be({spatialReference:e,vertexAttributes:t,transform:n},{origin:r},i,a){let o=K(e,a);if(!C(e,r,Q,o))return k(G(),e,o),null;n&&f(Q,Q,n.localMatrix),J(Q,e,a,1);let s=new Float64Array(t.position.length),c=we(t.position,Q,e,s,o);if(!c)return null;let l=Te(c,e,s,o,t.normal,Q);if(t.normal&&!l)return null;let u=Ee(c,e,s,o,t.tangent,Q);if(t.tangent&&!u)return null;if(i){let e=ae(je,i);O(c,c,e)}return{position:c,normal:l,tangent:u}}function xe({vertexAttributes:e,spatialReference:t,transform:n},{origin:r},i,a){let o=K(t,a);if(!C(t,i,Q,o))return k(G(),t,o),null;let s=1/Y(t,a,2);y(Q,Q,[s,s,s]);let c=d($,Q),{position:l,normal:u,tangent:f}=Se(e,r,n),p=new Float64Array(l.length),m=De(l,t,c,p,o);if(!m)return null;let h=x(Ae,c),g=Oe(u,l,t,p,o,h,u===e.normal?void 0:u);if(!g&&u)return null;let _=ke(f,l,t,p,o,h,f===e.tangent?void 0:f);return!_&&f?null:{position:m,normal:g,tangent:_}}function Se(e,t,n){if(!t)return e;if(!n){let{position:n,normal:r,tangent:i}=e;return{position:O(new Float64Array(n.length),n,t),tangent:i,normal:r}}let r=q(e,n.localMatrix);return O(r.position,r.position,t),r}function Ce({vertexAttributes:e,spatialReference:t,transform:n},{origin:r},i,a){let o=K(t,a);if(!C(t,r,Q,o))return k(G(),t,o),null;if(n&&f(Q,Q,n.localMatrix),!C(t,i,$,o))return k(G(),o,t),null;d($,$);let s=f(Q,$,Q);return J(s,t,a,3),q(e,s)}function q(e,t){let n=new Float64Array(e.position.length);D(n,e.position,t);let r=e.normal?new Float32Array(e.normal.length):null,i=e.tangent?new Float32Array(e.tangent.length):null;return r&&e.normal&&P(e.normal,r,t),i&&e.tangent&&F(e.tangent,i,t),{position:n,normal:r,tangent:i}}function we(e,t,n,r,i){D(r,e,t);let a=new Float64Array(e.length);return N(r,i,a,n)?a:(k(G(),i,n),null)}function Te(e,t,n,r,i,a){if(i==null)return null;let o=new Float32Array(i.length);return P(i,o,a),j(o,e,t,n,r,o)?o:(k(G(),r,t),null)}function Ee(e,t,n,r,i,a){if(i==null)return null;let o=new Float32Array(i.length);return F(i,o,a),R(o,e,t,n,r,o)?o:(k(G(),r,t),null)}function J(e,t,n,r){let i=Y(t,n,r);X(i)||y(e,e,[i,i,i])}function Y(e,t,n){let r=!!(1&n),i=!!(2&n),a=t?.sourceUnit,o=t?.targetUnit;if(!a&&!o)return 1;let s=Z(a,e);r||!a||X(s)||(G().warn(`source unit conversion not supported`),s=1);let c=1/Z(o,e);return i||!o||X(c)||(G().warn(`target unit conversion not supported`),c=1),s*c}function X(e){return l(e,1)}function De(e,t,n,r,i){let a=M(e,t,r,i);if(!a)return k(G(),t,i),null;let o=new Float64Array(a.length);return D(o,a,n),o}function Oe(e,t,n,r,i,a,o){if(e==null)return null;let s=o??new Float32Array(e.length);return A(e,t,n,r,i,s)?(E(s,s,a),s):(k(G(),n,i),null)}function ke(e,t,n,r,i,a,o){if(e==null)return null;let s=o??new Float32Array(e.length);return L(e,t,n,r,i,s)?(E(s,s,a,4),s):(k(G(),n,i),null)}function Z(e,t){if(e==null)return 1;let n=_(t);return 1/m(n,`meters`,e)}var Q=b(),$=b(),Ae=te(),je=s(),Me=b();export{F as a,R as c,pe as d,k as f,N as h,he as i,me as l,A as m,Z as n,L as o,P as p,ve as r,j as s,_e as t,M as u};