import{$l as e,AE as t,Am as n,Av as r,Ax as i,BC as a,CD as o,Cv as s,Ev as c,Gb as l,Id as u,Jg as d,Jh as f,Jl as p,Kb as m,Kw as h,MC as g,OC as _,RC as v,SC as y,Sv as b,TC as x,Ux as ee,Vb as te,Vw as ne,Wg as re,Wl as ie,Xg as ae,Xh as oe,aS as se,ab as ce,bv as le,cT as ue,dT as de,du as fe,fC as pe,fS as me,fu as he,ii as ge,iu as _e,kC as S,lT as ve,mT as C,nD as ye,ou as be,pS as xe,pv as Se,qb as w,ru as Ce,sT as we,uS as Te,vT as T,wC as Ee,wv as De,xv as Oe,yg as E}from"./index-BqmCqmfp.js";import{n as ke}from"./meshVertexSpaceUtils-Y8FeTLov.js";import{a as D}from"./vectorStacks-CKtslZxP.js";import{n as Ae}from"./dehydratedPoint-Dwb3orme.js";import{t as je}from"./projectVectorToVector-D-Bbb8fP.js";import{S as Me,b as Ne,f as Pe,l as Fe,n as Ie,o as Le,r as Re,x as ze}from"./elevationInfoUtils-Df_uYU_q.js";import{t as Be}from"./GraphicsLayer-BGvt7_Y1.js";import{t as Ve}from"./geodesicUtils-DJORTTMv.js";import{a as He,c as Ue,i as We,n as Ge,o as Ke,r as qe,s as Je,t as Ye}from"./createUtils-DwAaa929.js";import{i as Xe,t as Ze}from"./SketchOptions-CfisVcr8.js";import{d as O,f as Qe,p as $e}from"./LineSnappingHint-BAcwqgNT.js";import{s as et}from"./snappingUtils-CbrwOS61.js";import{a as tt,c as nt,i as rt,l as it,n as at,r as ot,s as st,u as ct}from"./constraints-DXu8cqG3.js";import{f as k,i as A,n as lt,r as ut,t as j,u as dt}from"./quantityUtils-Dywg00j-.js";import{o as ft,t as pt}from"./euclideanLengthMeasurementUtils-Bhl6nD1D.js";import{_ as mt,c as ht,d as M,g as gt,h as _t,i as vt,l as yt,m as bt,n as xt,o as St,p as Ct,r as wt,s as Tt,t as Et,u as Dt,y as Ot}from"./SnappingContext-BiPKdvZN.js";import{c as kt,i as N,l as At,s as jt,u as Mt,x as Nt}from"./rotate-qEFO-Vf9.js";import{n as Pt,t as P}from"./dehydratedFeatureComparison-Ch8xWl-8.js";import{i as Ft,n as F,r as It,s as Lt}from"./angularMeasurementUtils-BFBiid4G.js";import{t as Rt}from"./ReactiveSet-DIaWCgzH.js";import{a as zt,n as Bt}from"./hydratedFeatures-BSV-K3yB.js";import{i as Vt,s as Ht}from"./boundedPlane-Cn9n7acY.js";var Ut={UndoRedoUpdating:`Cannot perform operation whilst undo redo is updating`,UndoInvalidError:`There are no items to Undo`,RedoInvalidError:`There are no items to Redo`,ApplyInvalidError:`Cannot apply an item that is already applied`},I=class extends Error{constructor(){super(Ut.UndoRedoUpdating),this.type=`undo-redo-updating-error`}},Wt=class extends Error{constructor(){super(Ut.UndoInvalidError),this.type=`undo-redo-undo-error`}},Gt=class extends Error{constructor(){super(Ut.RedoInvalidError),this.type=`undo-redo-redo-error`}},L=class extends _{constructor(){super(...arguments),this._stack=new y,this._stackPosition=-1,this._updatingHandles=new n}get updating(){return this._updatingHandles.updating}get canUndo(){return this.hasUndo&&!this.updating}get hasUndo(){return this._stackPosition>=0}get canRedo(){return this.hasRedo&&!this.updating}get hasRedo(){return this._stackPosition<this._stack.length-1}_truncateForwardStack(){this._stack.splice(this._stackPosition+1,this._stack.length-this._stackPosition).forEach(e=>e.destroy())}_drainStack(){this._stack.drain(e=>e.destroy()),this._stackPosition=-1}async undo(){if(!this.hasUndo)throw new Wt;if(this.updating)throw new I;let e=this._stack.getItemAt(this._stackPosition);e&&await this._updatingHandles.addPromise((async()=>{await e.executeUndoRedoOperation(1),--this._stackPosition,e.canRedo||this._truncateForwardStack()})())}async redo(){if(!this.hasRedo)throw new Gt;if(this.updating)throw new I;let e=this._stack.getItemAt(this._stackPosition+1);if(!e)throw new Gt;await this._updatingHandles.addPromise((async()=>{await e.executeUndoRedoOperation(2),++this._stackPosition})())}peekUndo(){if(this.canUndo)return this._stack.getItemAt(this._stackPosition)}peekRedo(){if(this.canRedo)return this._stack.getItemAt(this._stackPosition+1)}async inject(e){if(this.updating)throw new I;await this._updatingHandles.addPromise((async()=>{e.status===0&&await e.executeUndoRedoOperation(0),e.canUndo?(this._stack.splice(this._stackPosition+1,0,e),this._stackPosition++):this._stackPosition>-1&&(this._stack.splice(0,this._stackPosition+1).forEach(e=>e.destroy()),this._stackPosition=-1)})())}async add(e){if(this.updating)throw new I;await this._updatingHandles.addPromise((async()=>{e.status===0&&await e.executeUndoRedoOperation(0),this._stackPosition>=-1&&this._truncateForwardStack(),e.canUndo?(this._stack.push(e),this._stackPosition=this._stack.length-1):this._drainStack()})())}async removeTagged(e,t=!1){if(this.updating&&!t)return;await l(()=>!this.updating);let n=new y;for(let t=0;t<this._stack.length;t++){let r=this._stack.getItemAt(t);r&&(r.tag===e?(r.destroy(),t===this._stackPosition&&(this._stackPosition=n.length-1)):n.push(r))}this._stack=n,this._stackPosition>n.length-1&&(this._stackPosition=n.length-1)}async clear(e=!1){if(this.updating&&!e)throw new I;await l(()=>!this.updating),this._drainStack()}};o([g()],L.prototype,`_stack`,void 0),o([g()],L.prototype,`_stackPosition`,void 0),o([g()],L.prototype,`updating`,null),o([g({readOnly:!0})],L.prototype,`canUndo`,null),o([g({readOnly:!0})],L.prototype,`hasUndo`,null),o([g({readOnly:!0})],L.prototype,`canRedo`,null),o([g({readOnly:!0})],L.prototype,`hasRedo`,null),L=o([S(`esri.UndoRedo`)],L);var Kt=class{constructor(){this.committedVertices=null,this.cursorVertex=null,this.full=null,this.outline=null,this.cursorEdge=null,this.circle=null,this.rectangle=null}};function R(e,t,n){if(e==null)return`noTool`;switch(e){case`point`:return qt();case`multipoint`:return`multipoint`;case`polyline`:return Jt(t,n);case`polygon`:return Yt(t,n);case`rectangle`:case`circle`:return Xt(t,n);default:return}}function qt(e){return`point`}function Jt(e,t){let n=e!=null&&e.type===`polyline`&&e.paths.length?e.paths[0].length:0;return t===`freehand`?n<2?`freehandStart`:`freehandEnd`:n<2?`polylineZeroVertices`:`polylineOneVertex`}function Yt(e,t){let n=e!=null&&e.type===`polygon`&&e.rings.length?e.rings[0].length:0;if(n<3)switch(t){case`freehand`:return`freehandStart`;case`hybrid`:return`polygonZeroVerticesHybrid`;default:return`polygonZeroVertices`}else if(n<4)return t===`freehand`?`freehandEnd`:`polygonOneVertex`;return`polygonTwoVertices`}function Xt(e,t){if((e!=null&&e.type===`polygon`&&e.rings.length?e.rings[0].length:0)<3)switch(t){case`freehand`:return`freehandStart`;case`click`:return`shapeStartClick`;default:return`shapeStartHybrid`}switch(t){case`freehand`:return`freehandEnd`;case`click`:return`shapeEndClick`;default:return`shapeEndHybrid`}}function Zt(t,n){let r=t?.geometry;if(!t||r?.type!==`mesh`||!n)return;let{renderCoordsHelper:i,elevationProvider:a}=n,{camera:o}=n.state,{extent:s}=r,{center:c,spatialReference:l}=s,u=se(l),d=xe(l),f=se(i.spatialReference),p=s.width*u,m=s.height*d,h=(s.zmax??0)*d,g=h-(s.zmin??0)*d,_=Math.max(p,m,g)/f,{x:v,y}=c,b=c.z??0;e(tn,v,y,b),i.toRenderCoords(tn,l,tn);let x=_/o.computeScreenPixelSizeAt(tn);if(x>Math.min(o.width,o.height)/o.pixelRatio*$t)return`meshTooClose`;if(x<Qt)return`meshTooFar`;let ee=Fe(t),{absoluteZ:te}=ze(v,y,h,l,n,ee);return te<(a.getElevation(v,y,b,l,`ground`)??0)*d+g*en?`meshUnderground`:`mesh`}var Qt=20,$t=1,en=.1,tn=d();function nn(e,t,n,r,i,a){let o=`geodesic`,s=Ve(n),c=O();return $e(e,t,r,c),c[2]=0,s&&je(c,n,c,s)||(o=`euclidean`,s=n),{mode:o,view:t,elevationInfo:r,hasZ:i,directionMode:a,spatialReference:e.spatialReference,measurementSR:s,origin:c}}function rn(e,t,n){if(t==null||e==null)return;let r=me(n.measurementSR);if(r==null)return;let i=pn(e,n);if(i==null)return;let a=k(t,r);return new it(i,a)}function an(e,t,n,r){if(n==null||e==null)return;let i=pn(e,r);if(i==null)return;let a=F(n),o=e=>{if(e==null)return;let t=O(),n=ut(e,`degrees`,`geographic`);return It(t,i,r.measurementSR,10,n,r.mode)?new at(i,t):void 0},s=()=>{if(t!=null&&e!=null)return F(Ft(t,e))};switch(r.directionMode){case`absolute`:return o(a);case`relative`:{let e=s();return e==null?void 0:o(e+a)}case`relative-bilateral`:{let e=s();return e==null?void 0:st([o(e+a),o(e-a)])}}}function on(e,t){let n=hn(e,t);return n==null?void 0:new ot(n)}function sn(e,t,n){let{context:r,longitude:i,latitude:a,direction:o,distance:s,elevation:c}=n;if(i!=null||a!=null||s!=null||c!=null||o!=null){if(i!=null||a!=null){let e=F(i),t=F(a),n=hn(c,r);return new tt(e,t,n)}return cn(e,t,n)}}function cn(e,t,{context:n,direction:r,distance:i,elevation:a}){if(t==null)return on(a,n);let{view:o,elevationInfo:s,measurementSR:c}=n,l=$e(t,o,s);if(!c||!je(l,t.spatialReference,_n,c))return;let[u,d]=_n,f=i==null?void 0:k(i,`meters`),p=F(r),m=hn(a,n),h=e=>{let t=new rt([u,d],c,f,m,e);return f==null||e==null||m==null&&n.hasZ?t:new nt(t.closestTo(l))};if(p==null)return h(void 0);let g=()=>{if(e!=null&&t!=null)return F(Ft(e,t))};switch(n.directionMode){case`absolute`:return h(p);case`relative`:{let e=g();return e==null?void 0:h(e+p)}case`relative-bilateral`:{let e=g();return e==null?void 0:st([h(e+p),h(e-p)])}}}function ln(e){return e.context.mode===`geodesic`?sn(null,null,e):dn(e)}function un(e,t,n){let{context:r,x:i,y:a,distance:o,direction:s,elevation:c}=n;return r.mode===`geodesic`?sn(t,e,n):i!=null||a!=null?dn(n):fn([rn(e,o,r),an(e,t,s,r),on(c,r)])}function dn({x:e,y:t,elevation:n,context:r}){yn.x=e?.value??0,yn.y=t?.value??0,yn.spatialReference=r.spatialReference;let i=pn(yn,r,vn);return new tt(e!=null&&i!=null?i[0]:void 0,t!=null&&i!=null?i[1]:void 0,hn(n,r))}function fn(e){let t;for(let n of e)n&&(t=t?.intersect(n)??n);return t}function pn(e,t,n=O()){let{view:r,elevationInfo:i,measurementSR:a,origin:o,mode:s}=t;if($e(e,r,i,n),je(n,e.spatialReference,n,a))return s!==`geodesic`&&ie(n,n,o),n}function mn(e,t,n,r){let{view:i,measurementSR:a,spatialReference:o,origin:s,mode:c}=n;if(c===`geodesic`?Ce(z,e):_e(z,e,s),je(z,a,z,o))return Qe(z,i,t,n,r)}function hn(e,t){return gn(e,t)?.value??void 0}function gn(e,{view:t,origin:n,elevationInfo:r,hasZ:i,measurementSR:a}){if(e==null||!i)return;let o=Te(a);if(o==null)return;let[s,c]=n,l=k(e,o),u=t?.type===`3d`?Re(t,s,c,l,a,r):l;return u==null?void 0:lt(u,o)}var _n=O(),vn=O(),z=O(),yn=Ae(0,0,0,ee.WGS84),B=class extends N{constructor(e){super(e),this.type=`draw-circle`,this.radius=null,this.xSize=null,this.ySize=null,this.area=j}get allFields(){return[]}};o([g()],B.prototype,`type`,void 0),o([g()],B.prototype,`radius`,void 0),o([g()],B.prototype,`xSize`,void 0),o([g()],B.prototype,`ySize`,void 0),o([g()],B.prototype,`area`,void 0),o([g()],B.prototype,`helpMessage`,void 0),o([g()],B.prototype,`allFields`,null),B=o([S(`esri.views.interactive.tooltip.infos.DrawCircleTooltipInfo`)],B);var V=class extends M(N){constructor(e){super(e),this.type=`draw-mesh`,this.orientation=bt({lockable:!1}),this.scale=mt({lockable:!1})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};o([g()],V.prototype,`helpMessage`,void 0),o([g()],V.prototype,`allFields`,null),V=o([S(`esri.views.interactive.tooltip.infos.DrawMeshTooltipInfo`)],V);var H=class extends M(N){constructor(e){super(e),this.type=`draw-multipoint`}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};o([g()],H.prototype,`helpMessage`,void 0),o([g()],H.prototype,`allFields`,null),H=o([S(`esri.views.interactive.tooltip.infos.DrawMultipointTooltipInfo`)],H);var U=class extends M(N){constructor(e){super(e),this.type=`draw-point`}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};o([g()],U.prototype,`helpMessage`,void 0),o([g()],U.prototype,`allFields`,null),U=o([S(`esri.views.interactive.tooltip.infos.DrawPointTooltipInfo`)],U);var W=class extends M(N){constructor(e){super(e),this.type=`draw-polygon`,this.direction=Ct(),this.distance=Ot(),this.area=_t(),this.xyMode=`direction-distance`}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.area]}};o([g()],W.prototype,`xyMode`,void 0),o([g()],W.prototype,`helpMessage`,void 0),o([g()],W.prototype,`allFields`,null),W=o([S(`esri.views.interactive.tooltip.infos.DrawPolygonTooltipInfo`)],W);var G=class extends M(N){constructor(e){super(e),this.type=`draw-polyline`,this.direction=Ct(),this.distance=Ot(),this.totalLength=gt(),this.xyMode=`direction-distance`}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.totalLength]}};o([g()],G.prototype,`helpMessage`,void 0),o([g()],G.prototype,`xyMode`,void 0),o([g()],G.prototype,`allFields`,null),G=o([S(`esri.views.interactive.tooltip.infos.DrawPolylineTooltipInfo`)],G);var K=class extends N{constructor(e){super(e),this.type=`draw-rectangle`,this.xSize=A,this.ySize=A,this.area=j}get allFields(){return[]}};o([g()],K.prototype,`type`,void 0),o([g()],K.prototype,`xSize`,void 0),o([g()],K.prototype,`ySize`,void 0),o([g()],K.prototype,`area`,void 0),o([g()],K.prototype,`helpMessage`,void 0),o([g()],K.prototype,`allFields`,null),K=o([S(`esri.views.interactive.tooltip.infos.DrawRectangleTooltipInfo`)],K);function bn(e,t){return{point:new U({sketchOptions:t,viewType:e}),multipoint:new H({sketchOptions:t,viewType:e}),polyline:new G({sketchOptions:t,viewType:e}),polygon:new W({sketchOptions:t,viewType:e}),mesh:new V({sketchOptions:t,viewType:e}),rectangle:new K({sketchOptions:t}),circle:new B({sketchOptions:t})}}function xn(e){let{directionOptions:t,geometryType:n,sketchOptions:r,tooltipInfos:i}=e,a=t=>{let n=Gn(e).mode,r=i[t].elevation;n===`relative-to-ground`||n===`relative-to-scene`||n===`on-the-ground`?r.lock(Kn(e)):r.unlock()},o=e=>{if(t){let n=i[e].direction;n.committed=t.angle,n.unlockOnVertexPlacement=!1,r.values.directionMode=t.mode}};switch(n){case`polygon`:case`polyline`:a(n),o(n);break;case`point`:case`mesh`:a(n)}}function Sn(e,t){let{drawOperation:n,view:r}=t,i=wn(t),a=Gn(t);if(r.type===`2d`||!e||a.mode!==`absolute-height`||n?.numCommittedVertices!==1||!i||i.type!==`draw-polyline`&&i.type!==`draw-polygon`||i.elevation.locked)return;let[o,s,c]=e,l=Wn(o,s,c,a,t);l!=null&&i.elevation.lock(l)}function Cn(e){wn(e)?.allFields.forEach(e=>{e.unlockOnVertexPlacement&&e.unlock()})}function wn({geometryType:e,graphic:t,tooltipInfos:n}){return t?.geometry?.type===Tn[e]||e===`circle`||e===`rectangle`?n[e]:null}var Tn={point:`point`,multipoint:`multipoint`,mesh:`mesh`,polyline:`polyline`,polygon:`polygon`,circle:`polygon`,rectangle:`polygon`,freehandPolygon:`polygon`,freehandPolyline:`polyline`,text:`point`};function En(e,t){switch(e?.type){case`draw-point`:Dn(e,t);break;case`draw-multipoint`:On(e,t);break;case`draw-polyline`:jn(e,t);break;case`draw-polygon`:Mn(e,t);break;case`draw-rectangle`:In(e,t);break;case`draw-circle`:Ln(e,t);break;case`draw-mesh`:kn(e,t)}}function Dn(e,t){let n=t.graphic?.geometry;n?.type===`point`&&(An(e,n,t),e.helpMessage=R(`point`,n,t.drawOperation.drawingMode))}function On(e,t){let n=t.graphic?.geometry;n?.type===`multipoint`&&(An(e,n,t),e.helpMessage=R(`multipoint`,n,t.drawOperation.drawingMode))}function kn(e,t){let{graphic:n,view:r}=t,i=n?.geometry;r.type!==`3d`||i&&i.type!==`mesh`||(An(e,i?.origin,t),i&&Mt(e,i),e.helpMessage=Zt(n,r))}function An(e,t,n){let{drawOperation:r,view:i,sketchOptions:a}=n,{cursorVertex:o}=r;e.sketchOptions=a,e.viewType=i.type;let s=t?.type===`multipoint`?t.getPoint(t.points.length-1):t;if(e.setLocationFromPoint(s,q(n)),Rn(e.elevation,n),!o)return void(r.constraints=void 0);r.constraints={context:qn(o,n),x:e.x.committed,y:e.y.committed,longitude:e.longitude.committed,latitude:e.latitude.committed,elevation:e.elevation.committed,distance:null,direction:null}}function jn(e,t){let{createOperationGeometry:n,drawOperation:r,automaticLengthMeasurementUtils:i}=t,a=n==null?null:n.full;a&&a.type!==`polyline`||(Pn(e,t),e.totalLength.actual=r.lastVertex?(a?i.autoLength2D(a):null)??A:null,e.helpMessage=R(`polyline`,a,t.drawOperation.drawingMode))}function Mn(e,t){let{createOperationGeometry:n,drawOperation:r}=t,i=n==null?null:n.full;i&&i.type!==`polygon`||(Pn(e,t),e.area.actual=r.lastVertex?(i?t.automaticAreaMeasurementUtils.autoArea2D(i):null)??j:null,e.helpMessage=R(`polygon`,i,t.drawOperation.drawingMode))}var Nn=v(i);function Pn(e,t){let{drawOperation:n,sketchOptions:r,view:i,automaticLengthMeasurementUtils:a}=t,{cursorVertex:o,lastVertex:s,secondToLastVertex:c}=n,l=r.values.effectiveDirectionMode;e.sketchOptions=r,e.viewType=i.type;let u=s&&o?a.autoDistanceBetweenPoints2D(Nn(s),Nn(o))??A:null;if(e.distance.actual=u,e.distance.readOnly=s==null,e.direction.actual=null,e.direction.readOnly=!0,s&&o&&(l===`absolute`||c)){let t=Lt(c,s,o,l);e.direction.actual=t??dt,e.direction.readOnly=!1}e.setLocationFromPoint(o,q(t)),Rn(e.elevation,t);let d=Fn(s,t);e.xyMode=d,e.direction.visible=d===`direction-distance`,e.distance.visible=d===`direction-distance`,e.effectiveX.visible=d===`coordinates`,e.effectiveY.visible=d===`coordinates`;let f=o??s;n.constraints=f?{context:qn(f,t),x:e.x.committed,y:e.y.committed,longitude:e.longitude.committed,latitude:e.latitude.committed,elevation:e.elevation.committed,distance:e.distance.committed,direction:e.direction.committed}:void 0}function Fn(e,{sketchOptions:t}){let n=t.tooltips.xyMode;return n===`auto`?e?`direction-distance`:`coordinates`:n}function In(e,t){e.sketchOptions=t.sketchOptions,e.xSize=Bn(t),e.ySize=Vn(t),e.area=zn(t),e.helpMessage=R(`rectangle`,t.graphic?.geometry,t.drawOperation.drawingMode)}function Ln(e,t){let{forceUniformSize:n,sketchOptions:r}=t;e.sketchOptions=r,e.radius=n?Hn(t):null,e.xSize=n?null:Bn(t),e.ySize=n?null:Vn(t),e.area=zn(t),e.helpMessage=R(`circle`,t.graphic?.geometry,t.drawOperation.drawingMode)}function Rn(e,t){let{drawOperation:n}=t,r=n?.cursorVertex??n?.lastVertex;e.actual=ft(r)??Kn(t),e.visible=n.hasZ,e.readOnly=!1,e.showAsZ=!0}function zn(e){let t=e.createOperationGeometry?.full;return t?.type===`polygon`?e.automaticAreaMeasurementUtils.autoArea2D(t)??j:j}function Bn({createOperationGeometry:e,automaticLengthMeasurementUtils:t}){let n=e?.rectangle?.midpoints;return(n==null?null:t.autoDistanceBetweenPoints2D(n.left,n.right))??A}function Vn({createOperationGeometry:e,automaticLengthMeasurementUtils:t}){let n=e?.rectangle?.midpoints;return(n==null?null:t.autoDistanceBetweenPoints2D(n.top,n.bottom))??A}function Hn({createOperationGeometry:e,automaticLengthMeasurementUtils:t}){return(e?.circle?.center!=null&&e.circle.edge!=null?t.autoDistanceBetweenPoints2D(e.circle.center,e.circle.edge):null)??A}function Un(e){let{geometryType:t,tooltipInfos:n}=e;switch(t){case`point`:case`multipoint`:case`mesh`:case`polyline`:case`polygon`:{let r=n[t].elevation.committed;return r?k(r,`meters`)/xe(q(e)):void 0}default:return}}function Wn(e,t,n,r,i){let{view:a,drawOperation:o}=i;if(a.type!==`3d`||!o)return;n??=0;let s=q(i),c=Gn(i),l=Re(a,e,t,n,s,c,r);return pt(l,s)??Kn(i)}function Gn(e){return e.drawOperation.elevationInfo??Le}function q(e){return e.drawOperation.coordinateHelper.spatialReference}function Kn(e){let t=xe(q(e));return lt(e.defaultZ*t,`meters`)}function qn(e,t){return nn(e,t.view,q(t),Gn(t),t.drawOperation.coordinateHelper.hasZ(),t.sketchOptions.values.effectiveDirectionMode)}var Jn=class{constructor(){this._isToolEditable=!0,this._manipulators=new y,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(e){this._isToolEditable=e}get length(){return this._manipulators.length}add(e,t=0){this.addMany([e],t)}addMany(e,t=0){for(let n of e){let e={manipulator:n,visibilityPredicate:t,attached:!1};this._manipulators.add(e),this._attached&&this._updateManipulatorAttachment(e)}}remove(e){for(let t=0;t<this._manipulators.length;t++)if(this._manipulators.at(t).manipulator===e){let e=this._manipulators.splice(t,1)[0];this._detachManipulator(e);break}}removeAll(){this._manipulators.forEach(e=>{this._detachManipulator(e)}),this._manipulators.removeAll()}attach(){this._manipulators.forEach(e=>{this._updateManipulatorAttachment(e)}),this._attached=!0}detach(){this._manipulators.forEach(e=>{this._detachManipulator(e)}),this._attached=!1}destroy(){this.detach(),this._manipulators.forEach(({manipulator:e})=>e.destroy()),this._manipulators.destroy(),this._resourceContexts=null}on(e,t){return this._manipulators.on(e,e=>{t(e)})}forEach(e){for(let t of this._manipulators.items)e(t)}some(e){return this._manipulators.items.some(e)}toArray(){let e=[];return this.forEach(t=>e.push(t.manipulator)),e}intersect(e,t){let n=null,r=Number.MAX_VALUE;return this._manipulators.forEach(({manipulator:i,attached:a})=>{if(!a||!i.interactive)return;let o=i.intersectionDistance(e,t);o!=null&&o<r&&(r=o,n=i)}),n}_updateManipulatorAttachment(e){this._isManipulatorItemVisible(e)?this._attachManipulator(e):this._detachManipulator(e)}_attachManipulator(e){e.attached||=(e.manipulator.attach&&e.manipulator.attach(this._resourceContexts),!0)}_detachManipulator(e){if(!e.attached)return;let t=e.manipulator;t.grabbing=!1,t.dragging=!1,t.hovering=!1,t.selected=!1,t.detach&&t.detach(this._resourceContexts),e.attached=!1}_isManipulatorItemVisible(e){return e.visibilityPredicate===2||(this._isToolEditable?e.visibilityPredicate===0:e.visibilityPredicate===1)}},J=class extends x{constructor(e){super(e),this.manipulators=new Jn,this.automaticManipulatorSelection=!0,this.hasGrabbedManipulators=!1,this.hasHoveredManipulators=!1,this.firstGrabbedManipulator=null,this.created=!1,this.removeIncompleteOnCancel=!0,this._editableFlags=new Map([[1,!0],[0,!0]]),this._creationFinishedResolver=ne()}get active(){return this.view!=null&&this.view.activeTool===this}set visible(e){this._get(`visible`)!==e&&(this._set(`visible`,e),this._syncVisible())}get editable(){return this.getEditableFlag(0)}set editable(e){this.setEditableFlag(0,e)}get updating(){return!1}get cursor(){return null}get hasFocusedManipulators(){return this.hasGrabbedManipulators||this.hasHoveredManipulators}destroy(){this.manipulators.destroy(),this._set(`view`,null)}onAdd(){this._syncVisible()}activate(){this.view!=null&&(this.view.focus(),this.onActivate())}deactivate(){this.onDeactivate()}cancel(){this.emit(`cancel`)}handleInputEvent(e){this.onInputEvent(e)}handleInputEventAfter(e){this.onInputEventAfter(e)}setEditableFlag(e,t){this._editableFlags.set(e,t),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),e===0&&this.notifyChange(`editable`),this.onEditableChange(),this.onManipulatorSelectionChanged()}getEditableFlag(e){return this._editableFlags.get(e)??!1}endDrag(){let e=this.view.inputManager.latestPointerInfo?.location;if(!e)return;let t=!1;this.manipulators.forEach(({manipulator:n})=>{n.dragging&&(t=!0,n.events.emit(`drag`,{action:`end`,start:e,screenPoint:e}))}),t&&(this.view.toolViewManager.activeTool=null)}whenCreated(){return this._creationFinishedResolver.promise}onManipulatorSelectionChanged(){}onActivate(){}onDeactivate(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(e){}onInputEventAfter(e){}get internallyEditable(){return this.getEditableFlag(0)&&this.getEditableFlag(1)}finishToolCreation(){this.created||this._creationFinishedResolver.resolve(this),this._set(`created`,!0)}_syncVisible(){if(this.initialized){if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.visible?this.manipulators.attach():this.manipulators.detach()}};o([g({constructOnly:!0})],J.prototype,`view`,void 0),o([g({readOnly:!0})],J.prototype,`active`,null),o([g({value:!0})],J.prototype,`visible`,null),o([g({value:!0})],J.prototype,`editable`,null),o([g({readOnly:!0})],J.prototype,`manipulators`,void 0),o([g({readOnly:!0})],J.prototype,`updating`,null),o([g()],J.prototype,`cursor`,null),o([g({readOnly:!0})],J.prototype,`automaticManipulatorSelection`,void 0),o([g()],J.prototype,`hasFocusedManipulators`,null),o([g()],J.prototype,`hasGrabbedManipulators`,void 0),o([g()],J.prototype,`hasHoveredManipulators`,void 0),o([g()],J.prototype,`firstGrabbedManipulator`,void 0),o([g({readOnly:!0})],J.prototype,`created`,void 0),o([g({readOnly:!0})],J.prototype,`removeIncompleteOnCancel`,void 0),J=o([S(`esri.views.interactive.InteractiveToolBase`)],J);var Y=class extends J{constructor(e){super(e),this._graphic=null,this._coordinateFormatterLoadTask=null,this._createOperationGeometry=null,this.defaultZ=0,this.directionOptions=null,this.elevationLockOnVertexAddDisabled=!1,this.geometryType=null,this.hasZ=!0,this.geometryToPlace=null,this.snappingManager=null,this.snapToScene=!1,this.sketchOptions=new Ze}initialize(){let{view:e}=this;this.internalGraphicsLayer=new Be({listMode:`hide`,internal:!0,title:`DrawGraphicTool layer`}),this.view.map.layers.add(this.internalGraphicsLayer);let t=this.drawOperation=this.makeDrawOperation();this.tooltipInfos=bn(e.type,this.sketchOptions);let n=At(()=>({view:e,options:this.sketchOptions.tooltips}));this.tooltip=n,xn(this._tooltipsContext),this._coordinateFormatterLoadTask=pe(()=>Nt()),this.addHandles([t.on(`vertex-add`,e=>this.onVertexAdd(e)),t.on(`vertex-remove`,e=>this.onVertexRemove(e)),t.on(`vertex-update`,e=>this.onVertexUpdate(e)),t.on(`cursor-update`,e=>this.onCursorUpdate(e)),t.on(`cursor-remove`,()=>this._updateGraphic()),t.on(`complete`,e=>this.onComplete(e)),this._coordinateFormatterLoadTask,n.on(`paste`,e=>kt(e,this.activeTooltipInfo)),m(()=>this.cursor,e=>{t.cursor=e},w),a(()=>{let{activeTooltipInfo:e,sketchOptions:t}=this;En(e,this._tooltipsContext),n.info=t.tooltips.effectiveEnabled?e:null}),a(()=>{t.constraintZ=Un(this._tooltipsContext)},te)]),this.finishToolCreation(),t.initializePointer()}destroy(){this.drawOperation=C(this.drawOperation),this.tooltip=C(this.tooltip),this._destroyAllVisualizations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=C(this.internalGraphicsLayer),this._set(`view`,null)}get _drawSpatialReference(){return this.drawOperation.coordinateHelper.spatialReference}get _tooltipsContext(){let{defaultZ:e,directionOptions:t,drawOperation:n,forceUniformSize:r,geometryType:i,graphic:a,sketchOptions:o,tooltipInfos:s,view:c,automaticAreaMeasurementUtils:l,automaticLengthMeasurementUtils:u}=this;return{createOperationGeometry:this._createOperationGeometry,defaultZ:e,directionOptions:t,drawOperation:n,forceUniformSize:r,geometryType:i,graphic:a,sketchOptions:o,tooltipInfos:s,view:c,automaticAreaMeasurementUtils:l,automaticLengthMeasurementUtils:u}}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(e){this._set(`centered`,e),this._updateGraphic()}get cursor(){return this._get(`cursor`)}set cursor(e){this._set(`cursor`,e)}set enabled(e){this.drawOperation.interactive=e,this._set(`enabled`,e)}set forceUniformSize(e){this._set(`forceUniformSize`,e),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(e){this._set(`graphicSymbol`,e),this._graphic!=null&&(this._graphic.symbol=e)}set mode(e){let t=this.drawOperation;t&&(t.drawingMode=e),this._set(`mode`,e)}get updating(){return this.drawOperation?.updating??!1}get undoRedo(){let{view:{type:e,map:t}}=this;return e===`2d`&&t&&`undoRedo`in t&&t.undoRedo instanceof L?t.undoRedo:null}set undoRedo(e){this._override(`undoRedo`,e)}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(e){this.destroyed||jt(e,this.tooltip)||this.drawOperation.onInputEvent(e)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo(),this.drawOperation.numCommittedVertices===0&&xn(this._tooltipsContext)}_destroyAllVisualizations(){this.removeHandles(X.outline),this.removeHandles(X.regularVertices),this.removeHandles(X.activeVertex),this.removeHandles(X.activeEdge),this.removeHandles(Yn)}_createOrUpdateGraphic(e){if(this._graphic!=null)return this.updateGraphicGeometry(e),this._graphic;let t=new u({...this.graphicProperties,symbol:this.graphicSymbol});return this._graphic=t,this.updateGraphicGeometry(e),this.internalGraphicsLayer.add(t),this.addHandles(this.initializeGraphic(t)),this.notifyChange(`graphic`),this.addHandles(T(()=>{this.internalGraphicsLayer.remove(t),this._graphic===t&&(this._graphic=null)}),Yn),t}updateGraphicGeometry(e){this._graphic.geometry=e}_getCreateOperationGeometry(e={operationComplete:!1}){if(this.drawOperation==null)return;let{coordinateHelper:t,view:n,visualizationCursorVertex:r,lastVertex:i,committedVertices:a,geometryIncludingUncommittedVertices:o,numCommittedVertices:s}=this.drawOperation;if(!(s>0||r!=null))return;let c=e.operationComplete?a:o,l=c.length,u=r==null?null:t.pointToArray(r),d=this._drawSpatialReference,f=n.type===`3d`&&n.viewingMode===`global`,p=new Kt;p.committedVertices=a,p.cursorVertex=u;let{geometryType:m}=this;switch(m){case`point`:case`mesh`:p.full=t.arrayToPoint(c[0]);break;case`multipoint`:p.full=l>0?Ye(c,d):null;break;case`polyline`:case`polygon`:l>0&&(p.full=m===`polygon`?Ge([c],d,f,!0):He([c],d,f),p.cursorEdge=u!=null&&i&&!P(r,i)?He([[u,t.pointToArray(i)]],d,f):null,p.outline=l>1?p.full:null);break;case`circle`:case`rectangle`:{if(p.committedVertices=p.cursorVertex=null,!l)break;let t=Ue(n,c[0]),r=c[0],i=t.makeMapPoint(r[0]+Zn*n.resolution,r[1]);m===`circle`?l===1&&e.operationComplete?p.circle=Ke([r,i],t,!0):l===2&&(this.forceUniformSize?p.circle=Ke(c,t,this.centered):p.rectangle=Je(c,t,this.centered)):l===1&&e.operationComplete?p.rectangle=We([r,i],t,!0):l===2&&(p.rectangle=this.forceUniformSize?We(c,t,this.centered):qe(c,t,this.centered)),p.full=p.circle==null?p.rectangle?.geometry:p.circle.geometry,p.outline=p.full?.type===`polygon`?p.full:null;break}default:return null}return p}initializeGraphic(e){return T()}onComplete(e){if(!this.drawOperation)return;this._updateGraphic();let t=null;if(this.drawOperation.isCompleted){let e=this._getCreateOperationGeometry({operationComplete:!0});e!=null&&(t=this._createOrUpdateGraphic(e.full))}this._createOperationGeometry=null,this.emit(`complete`,{graphic:t,...e})}onCursorUpdate(e){this._updateGraphic(),this.emit(`cursor-update`,e)}onDeactivate(){let{drawOperation:e}=this;e&&(e.isCompleted||e.cancel())}onOutlineChanged(e){return T()}onCursorEdgeChanged(e){return T()}onVertexAdd(e){Cn(this._tooltipsContext),this._updateGraphic(),this.elevationLockOnVertexAddDisabled||Sn(e.vertices.at(0)?.coordinates,this._tooltipsContext),this.emit(`vertex-add`,e)}onVertexRemove(e){Cn(this._tooltipsContext),this._updateGraphic(),this.emit(`vertex-remove`,e)}onVertexUpdate(e){this._updateGraphic(),this.emit(`vertex-update`,e)}_updateGraphic(){let e=this._getCreateOperationGeometry();this._createOperationGeometry=e,e==null?this._destroyAllVisualizations():(e.cursorEdge==null?this.removeHandles(X.activeEdge):this.addHandles(this.onCursorEdgeChanged(e.cursorEdge),X.activeEdge),e.outline==null?this.removeHandles(X.outline):this.addHandles(this.onOutlineChanged(e.outline),X.outline),e.committedVertices==null?this.removeHandles(X.regularVertices):this.addHandles(this.onRegularVerticesChanged(e.committedVertices),X.regularVertices),e.cursorVertex==null?this.removeHandles(X.activeVertex):this.addHandles(this.onActiveVertexChanged(e.cursorVertex),X.activeVertex),e.full==null?this.removeHandles(Yn):this._createOrUpdateGraphic(e.full))}get activeTooltipInfo(){return this._coordinateFormatterLoadTask?.finished?wn(this._tooltipsContext):null}};o([g()],Y.prototype,`_coordinateFormatterLoadTask`,void 0),o([g()],Y.prototype,`_createOperationGeometry`,void 0),o([g()],Y.prototype,`_tooltipsContext`,null),o([g({value:!0})],Y.prototype,`centered`,null),o([g()],Y.prototype,`cursor`,null),o([g({nonNullable:!0})],Y.prototype,`defaultZ`,void 0),o([g({constructOnly:!0})],Y.prototype,`directionOptions`,void 0),o([g()],Y.prototype,`drawOperation`,void 0),o([g()],Y.prototype,`elevationLockOnVertexAddDisabled`,void 0),o([g({value:!0})],Y.prototype,`enabled`,null),o([g({value:!0})],Y.prototype,`forceUniformSize`,null),o([g({constructOnly:!0})],Y.prototype,`geometryType`,void 0),o([g()],Y.prototype,`graphic`,null),o([g({constructOnly:!0})],Y.prototype,`graphicProperties`,void 0),o([g()],Y.prototype,`graphicSymbol`,null),o([g({constructOnly:!0})],Y.prototype,`hasZ`,void 0),o([g({constructOnly:!0})],Y.prototype,`geometryToPlace`,void 0),o([g()],Y.prototype,`mode`,null),o([g()],Y.prototype,`snappingManager`,void 0),o([g()],Y.prototype,`snapToScene`,void 0),o([g()],Y.prototype,`tooltip`,void 0),o([g()],Y.prototype,`tooltipInfos`,void 0),o([g({constructOnly:!0,type:Ze})],Y.prototype,`sketchOptions`,void 0),o([g()],Y.prototype,`updating`,null),o([g({constructOnly:!0,nonNullable:!0})],Y.prototype,`view`,void 0),o([g({constructOnly:!0})],Y.prototype,`automaticAreaMeasurementUtils`,void 0),o([g({constructOnly:!0})],Y.prototype,`automaticLengthMeasurementUtils`,void 0),o([g({constructOnly:!0})],Y.prototype,`undoRedo`,null),o([g()],Y.prototype,`activeTooltipInfo`,null),Y=o([S(`esri.views.draw.DrawGraphicTool`)],Y);var Yn=Symbol(`create-operation-graphic`),X={outline:Symbol(`outline-visual`),regularVertices:Symbol(`regular-vertices-visual`),activeVertex:Symbol(`active-vertex-visual`),activeEdge:Symbol(`active-edge-visual`)};function Xn(e){switch(e){case`point`:case`polyline`:case`polygon`:case`multipoint`:return e;case`circle`:case`rectangle`:return`segment`;case`mesh`:return`point`}}var Zn=48,Qn=`click`,Z=class extends _{constructor(e){super(e),this.events=new Ee,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0}intersectionDistance(e,t){return 0}attach(){}detach(){}onElevationChange(){}onViewChange(){}};o([g()],Z.prototype,`interactive`,void 0),o([g()],Z.prototype,`selectable`,void 0),o([g()],Z.prototype,`cursor`,void 0),o([g()],Z.prototype,`grabbing`,void 0),o([g()],Z.prototype,`grabbable`,void 0),o([g()],Z.prototype,`consumesClicks`,void 0),o([g()],Z.prototype,`grabbableForEvent`,void 0),o([g()],Z.prototype,`dragging`,void 0),o([g()],Z.prototype,`hovering`,void 0),o([g()],Z.prototype,`selected`,void 0),Z=o([S(`esri.views.draw.LegacyDrawManipulator`)],Z);function $n(e,t){let n=null,r=null;return i=>{if(i.action===`cancel`)return void(r!=null&&(r.execute({action:`cancel`}),n=null,r=null));let a={action:i.action,screenStart:i.start,screenEnd:i.screenPoint};i.action===`start`&&n==null&&(n=new hr,r=new hr,t(e,n,r,i.pointerType,a)),n?.execute(a),i.action===`end`&&n!=null&&(n=null,r=null)}}function er(e,t){return e.events.on(`drag`,$n(e,t))}function tr(e,t){let n=[e.x,e.y,e.z??0],r=t,i=[Math.cos(r),Math.sin(r)],a=Math.sqrt(i[0]*i[0]+i[1]*i[1]);if(a===0)return null;i[0]/=a,i[1]/=a;let o=e=>{let t=(e.x-n[0])*i[0]+(e.y-n[1])*i[1];e.x=n[0]+t*i[0],e.y=n[1]+t*i[1]};return e=>(o(e.mapStart),o(e.mapEnd),{...e,axis:i})}function nr(e){let t=null,n=dr();return r=>{if(r.action===`start`&&(t=ir(e,r.mapStart.spatialReference)),t==null)return null;let i=n(r);if(!i)return null;let{translationX:a,translationY:o,translationZ:s}=i;return t.move(a,o,s,r.action),i}}function rr(e,t){return e==null?null:e.spatialReference.equals(t)?e.clone():E(e,t)}function ir(e,t){let n=e.operations;if(!n)return null;let r=n.data.geometry,i=Bt(t);if(r.spatialReference.equals(i))return ar(e,n,()=>{});if(r.type!==`mesh`){let t=rr(r,i);if(t==null)return null;let a=r.spatialReference,o=xt.fromGeometry(t,n.viewingMode);return ar(e,o,()=>{let e=o.data.geometry,t=E(e,a);n.trySetGeometry(t)})}if(ke(r)){let t=rr(r.origin,i);if(!t)return null;let a=r.spatialReference,o=xt.fromGeometry(t,n.viewingMode);return ar(e,n,()=>{let e=E(o.data.geometry,a),t=e.x-r.origin.x,i=e.y-r.origin.y,s=(e.z??0)-(r.origin.z??0);n.move(t,i,s)})}return null}function ar(e,t,n){let r=0,i=0,a=0;return{move:(o,s,c,l)=>{l===`start`&&(r=0,i=0,a=0);let u=o-r,d=s-i,f=c-a;t.move(u,d,f),r+=u,i+=d,a+=f,n(),l===`end`&&e.endInteraction?.()}}}function or(e,t=null,n){let r=null,i=t==null||e.spatialReference?.equals(t)?e=>e:e=>e==null?e:E(e,t),a={exclude:[],...n};return t=>{if(t.action===`start`&&(r=i(e.toMap(t.screenStart,a))),r==null)return null;let n=i(e.toMap(t.screenEnd,a));return n==null?null:{...t,mapStart:r,mapEnd:n}}}function sr(e){let t=e.map(e=>nr(e)).filter(ye),n=dr();return e=>{let r=n(e);return t.forEach(t=>t(e)),r}}function cr(e){let t=e.operations?.createResetState();return e=>(t?.remove(),e)}function lr(e){let t=e.map(e=>cr(e)).filter(e=>e!=null);return e=>(t.forEach(t=>t(e)),e)}function ur(){let e=0,t=0,n=0;return r=>{r.action===`start`&&(e=r.mapStart.x,t=r.mapStart.y,n=r.mapStart.z??0);let i=r.mapEnd.x-e,a=r.mapEnd.y-t,o=(r.mapEnd.z??0)-n;return e=r.mapEnd.x,t=r.mapEnd.y,n=r.mapEnd.z,{...r,mapDeltaX:i,mapDeltaY:a,mapDeltaZ:o,mapDeltaSpatialReference:r.mapStart.spatialReference}}}function dr(){let e=0,t=0,n=0;return r=>{r.action===`start`&&(e=r.mapStart.x,t=r.mapStart.y,n=r.mapStart.z??0);let i=r.mapEnd.x-e,a=r.mapEnd.y-t,o=(r.mapEnd.z??0)-n;return{...r,translationX:i,translationY:a,translationZ:o}}}function fr(){let e=0,t=0;return n=>{n.action===`start`&&(e=n.screenStart.x,t=n.screenStart.y);let r=n.screenEnd.x-e,i=n.screenEnd.y-t;return e=n.screenEnd.x,t=n.screenEnd.y,{...n,screenDeltaX:r,screenDeltaY:i}}}function pr(e,t){let n=null,r=0,i=0;return a=>{if(a.action===`start`&&(n=e.toScreen?.(t),n!=null&&(n.x<0||n.x>e.width||n.y<0||n.y>e.height?n=null:(r=a.screenStart.x-n.x,i=a.screenStart.y-n.y))),n==null)return null;let o=ce(a.screenEnd.x-r,0,e.width),s=ce(a.screenEnd.y-i,0,e.height),c=oe(o,s);return a.screenStart=n,a.screenEnd=c,a}}var mr=()=>{},hr=class e{constructor(){this.execute=mr}next(t,n=new e){return t!=null&&(this.execute=e=>{let r=t(e);r!=null&&n.execute(r)}),n}};function gr(e,t,n=[]){if(e.type===`2d`)return e=>e;let r=null;return i=>{i.action===`start`&&(r=e.toMap(i.screenStart,{exclude:n}),r!=null&&(r.z=Ne(r,e,t)));let a=e.toMap(i.screenEnd,{exclude:n});a!=null&&(a.z=Ne(a,e,t));let o=r!=null&&a!=null?{sceneStart:r,sceneEnd:a}:null;return{...i,scenePoints:o}}}function _r(e,t,n){let r=t.elevationProvider.getElevation(e.x,e.y,e.z??0,e.spatialReference,`scene`)??0,i=zt(e);return i.z=r,i.hasZ=!0,i.z=Ne(i,t,n),i}function vr(e,t){if(e.type===`2d`)return e=>e;let n=null;return r=>{r.action===`start`&&(n=_r(r.mapStart,e,t));let i=_r(r.mapEnd,e,t),a=n!=null&&i!=null?{sceneStart:n,sceneEnd:i}:null;return{...r,scenePoints:a}}}function yr({predicate:e=()=>!0,snappingManager:t,snappingContext:n,updatingHandles:r,useZ:i=!0}){let a=new hr;if(t==null)return{snappingStep:[Or,a],cancelSnapping:Or};let o,s=null,c=null,l=null,u=()=>{s=ue(s),t.doneSnapping(),c?.frameTask.remove(),c=null,o=ve(o),l=null},d=br(t,i,a),f=null,p=null,h=null;return{snappingStep:[a=>{if(!e(a))return a;let{action:g}=a;if(g===`start`){let{info:e}=a,r=xr(t.view);if(c=Sr(n,a,r),c.context.selfSnappingZ=null,!i&&e!=null){let t=Dr(n.coordinateHelper,e.handle.part);t!=null&&(c.context.selfSnappingZ={value:t,elevationInfo:n.elevationInfo??Le})}}if(c!=null){let{context:e,originalScenePos:n,originalPos:u}=c,{mapEnd:_,mapStart:v,scenePoints:y}=a,b=Cr(u,Tr(_,v)),x=Tr(v,u),ee={...a,action:`update`},te=c.context,ne=wr(n,y),re=t.update({point:b,scenePoint:ne,context:e});if(h=re,Er(_,re,x,i),f=b,p=ne,g!==`end`){let{frameTask:e}=c;s??=new AbortController,l=t=>{r.addPromise(we(d({frameTask:e,event:ee,context:te,point:b,scenePoint:ne,delta:x,getLastState:()=>({point:f,scenePoint:p,updatePoint:t.forceUpdate?null:h})},s.signal)))},l({forceUpdate:!1}),o??=m(()=>t.options.effectiveEnabled,()=>l?.({forceUpdate:!0}))}}return g===`end`&&u(),a},a],cancelSnapping:e=>(u(),e)}}function br(e,t,n){return h(async({frameTask:r,point:i,scenePoint:a,context:o,event:s,delta:c,getLastState:l},u)=>{let d=await r.schedule(()=>e.snap({point:i,scenePoint:a,context:o,signal:u}),u);if(d.valid){let a=await r.schedule(()=>d.apply(),u),f=l();f.point!=null&&i!==f.point&&(a=e.update({point:f.point,scenePoint:f.scenePoint,context:o})),f.updatePoint!=null&&P(a,f.updatePoint)||(Er(s.mapEnd,a,c,t),n.execute(s))}})}function xr(e){return e.type===`3d`?e.resourceController.scheduler.registerTask(he.SNAPPING):fe}function Sr(e,t,n){return{context:new Et({editGeometryOperations:e.editGeometryOperations,elevationInfo:e.elevationInfo,pointer:e.pointer,vertexHandle:t.info==null?null:t.info.handle,excludeFeature:e.excludeFeature,feature:e.feature,visualizer:e.visualizer}),originalPos:t.snapOrigin==null?t.mapStart:e.coordinateHelper.vectorToDehydratedPoint(t.snapOrigin),originalScenePos:t.scenePoints==null?null:t.scenePoints.sceneStart,frameTask:n}}function Cr(e,[t,n,r]){let i=zt(e);return i.x+=t,i.y+=n,i.hasZ&&(i.z+=r),i}function wr(e,t){return e==null||t==null?null:Cr(e,Tr(t.sceneEnd,t.sceneStart))}function Tr(e,t){let n=e.hasZ&&t.hasZ?e.z-t.z:0;return[e.x-t.x,e.y-t.y,n]}function Er(e,t,[n,r,i],a){e.x=t.x+n,e.y=t.y+r,a&&e.hasZ&&t.hasZ&&(e.z=t.z+i)}function Dr(e,t){if(!e.hasZ())return null;let n=t.vertices,r=null;for(let t of n){let n=e.getZ(t.pos);if(r!=null&&n!=null&&Math.abs(n-r)>1e-6)return null;r??=n}return r}function Or(e){return e}var Q=class extends _{constructor(e){super(e),this.constrainResult=e=>e,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=h(async(e,t,n,r)=>{let i=this._frameTask;if(i==null)return;let a=await i.schedule(()=>t.snap({...e,context:n,signal:r}),r);a.valid&&await i.schedule(()=>{this.stagedPoint=a.apply(),e!==this._snapPoints&&this._snapPoints!=null&&(this.stagedPoint=t.update({...this._snapPoints,context:n}))},r)})}get stagedPoint(){return this._stagedPoint}set stagedPoint(e){this._stagedPoint=this.constrainResult(e)}initialize(){let e=this.view.type===`3d`?this.view?.resourceController?.scheduler:null;this._frameTask=e==null?fe:e.registerTask(he.SNAPPING)}destroy(){this._abortController=ue(this._abortController),this._frameTask=ve(this._frameTask)}update(e,t,n){this._snapPoints=e;let{point:r,scenePoint:i}=e,a=t.update({point:r,scenePoint:i,context:n});return this.stagedPoint=a,a}async snap(e,t,n){let{point:r,scenePoint:i}=e;return this.stagedPoint=t.update({point:r,scenePoint:i,context:n}),this._snapPoints=e,this._abortController??=new AbortController,this._snap(e,t,n,this._abortController.signal)}async snapAgainNearPreviousMapPoint(e,t){this._snapPoints!=null&&await this.snap(this._snapPoints,e,t)}abort(){this._abortController=ue(this._abortController),this._snapPoints=null}};o([g({constructOnly:!0})],Q.prototype,`view`,void 0),o([g()],Q.prototype,`stagedPoint`,null),o([g()],Q.prototype,`constrainResult`,void 0),o([g()],Q.prototype,`_stagedPoint`,void 0),Q=o([S(`esri.views.interactive.snapping.SnappingOperation`)],Q);var kr=`progress`,Ar=Symbol(),jr=Symbol(),$=class extends x{constructor(e){super(e),this._createOperationCompleted=!1,this._hideDefaultCursor=!1,this._pointerDownStates=new Rt,this._stagedScreenPoint=null,this._stagedPointerType=null,this._updatingHandles=new n,this._stagedPointerId=null,this.constraintsEnabled=!1,this.constraints=void 0,this._getPointConstraint=Me(ln),this._getPolylineOrPolygonConstraint=Me(un),this.constraintZ=null,this.defaultZ=null,this.isDraped=!0,this.labelOptions=new Xe,this.cursor=null,this.loading=!1,this.snapToSceneEnabled=null,this.firstVertex=null,this.lastVertex=null,this.secondToLastVertex=null,e.elevationInfo??(this.elevationInfo=Pe(!!e.hasZ))}initializePointer(){let e=this.view.inputManager?.latestPointerInfo;e!=null&&this._updatePointer(e.location,e.id,e.type)}initialize(){let{geometryType:e,view:t}=this,n=t.spatialReference,r=`viewingMode`in t.state?t.state.viewingMode:2,i=e===`segment`||e===`multipoint`?`polyline`:e;this.coordinateHelper=Dt(this.hasZ,this.hasM,n),this._editGeometryOperations=new xt(new yt(i,this.coordinateHelper),r),this._snappingOperation=new Q({view:t}),this.addHandles([m(()=>({stagedPoint:this._snappingOperation.stagedPoint,constraint:this._constraint}),({stagedPoint:e,constraint:t},n)=>{let{snappingOptions:r}=this;if(r&&(r.forceDisabled=t!=null&&ct(t)),n!=null&&e===n.stagedPoint&&t!==n.constraint)return this._onKeyboardBasedChange();this._processCursor(e??this._screenToMap(this._stagedScreenPoint))},{equals:(e,t)=>e.stagedPoint===t.stagedPoint&&de(e.constraint,t.constraint)}),m(()=>this.view.viewpoint,(e,t)=>{e&&t&&ge(e,t)&&this._onKeyboardBasedChange()})]),this._activePart=new ht(n,r),this._editGeometryOperations.data.parts.push(this._activePart);let a=this.segmentLabels;a!=null&&(a.context={view:t,editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,labelOptions:this.labelOptions,automaticLengthMeasurementUtils:this.automaticLengthMeasurementUtils},this.addHandles(m(()=>this.labelOptions.enabled,e=>{a.visible=e},w))),this.addHandles(this._editGeometryOperations.on([`vertex-add`,`vertex-update`,`vertex-remove`],e=>{let t=e.vertices.map(e=>({componentIndex:0,vertexIndex:e.index,coordinates:this.coordinateHelper.vectorToArray(e.pos)})),n=t.map(e=>e.coordinates),r=this.coordinateHelper.vectorToDehydratedPoint(this._activePart.getFirstVertex()?.pos)??null;P(r,this.firstVertex)||(this.firstVertex=r);let i=this.coordinateHelper.vectorToDehydratedPoint(this._activePart.getLastVertex()?.pos)??null;P(i,this.lastVertex)||(this.lastVertex=i);let a=this.coordinateHelper.vectorToDehydratedPoint(this._activePart.segments.at(-1)?.leftVertex?.pos)??null;switch(P(a,this.secondToLastVertex)||(this.secondToLastVertex=a),this._processCursor(this.cursorVertex),e.type){case`vertex-add`:this.emit(e.type,{...e,added:n,vertices:t});break;case`vertex-update`:this.emit(e.type,{...e,updated:n,vertices:t});break;case`vertex-remove`:this.emit(e.type,{...e,removed:n,vertices:t})}}));let o=this._manipulator=new Z({consumesClicks:!1,grabbableForEvent:e=>this.drawingMode!==`click`||e.pointerType===`touch`&&this._snappingEnabled&&this._pointerDownStates.size===1});this.manipulators.add(o),o.grabbable=e!==`point`&&e!==`multipoint`,this.addHandles([o.events.on(`immediate-click`,e=>this._onImmediateClick(e)),o.events.on(`immediate-double-click`,e=>this._onImmediateDoubleClick(e)),m(()=>this.drawingMode,()=>{this.removeHandles(Ar),this.addHandles(this._createManipulatorDragPipeline(o),Ar)},w),m(()=>({effectiveCursor:this.effectiveCursor}),({effectiveCursor:e})=>{o.cursor=e},w)]),et(this,()=>{let e=this.view.inputManager.latestPointerInfo?.type??`mouse`,t=this._getSnappingContext(e);if(this.snappingManager!=null){let e=this._snappingOperation.snapAgainNearPreviousMapPoint(this.snappingManager,t);this._updatingHandles.addPromise(we(e))}})}destroy(){C(this.segmentLabels),C(this._snappingOperation),this._editGeometryOperations=C(this._editGeometryOperations),this._updatingHandles.destroy()}get _isDragging(){let{_stagedPointerId:e,_manipulator:t}=this;return e!=null&&this._pointerDownStates.has(e)||t.grabbing||!t.interactive}get _snappingEnabled(){return this.snappingManager!=null&&this.snappingManager.options.effectiveEnabled}get _requiresScenePoint(){let e=this._updateAndGetEffectiveDrawSurface();return this.view.type===`3d`&&this.drawSurface!==e}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activePart.vertices.map(e=>this.coordinateHelper.vectorToArray(e.pos))}get _constraint(){let{constraints:e,constraintsEnabled:t}=this;if(e&&t)switch(this.geometryType){case`point`:case`multipoint`:return this._getPointConstraint(e);case`polygon`:case`polyline`:return this._getPolylineOrPolygonConstraint(this.lastVertex,this.secondToLastVertex,e)}}set drawingMode(e){this._set(`drawingMode`,e??`click`)}get effectiveCursor(){return this.loading?kr:this._hideDefaultCursor?null:this.cursor||`crosshair`}get interactive(){return this._manipulator.interactive}set interactive(e){this._manipulator.interactive=e}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activePart.vertices.length}get snappingOptions(){return this.snappingManager==null?null:this.snappingManager.options}get cursorVertex(){return this._get(`cursorVertex`)}get visualizationCursorVertex(){return this._stagedPointerType===`mouse`?this.cursorVertex:null}get committableVertex(){let{cursorVertex:e,lastVertex:t,firstVertex:n,geometryType:r}=this;return r===`polygon`&&Pt(e,n)||Pt(e,t)?null:e}get updating(){return this._updatingHandles.updating}get geometryIncludingUncommittedVertices(){let{committedVertices:e,committableVertex:t,coordinateHelper:n}=this,r=e.slice();return t!=null&&r.push(n.pointToArray(t)),r}cancel(){this.complete({aborted:!0})}commitStagedVertex(){this._snappingOperation.abort();let{committableVertex:e}=this;e!=null&&this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(e),this._activePart)}complete(e){let t=e?.aborted||!1;this._snappingOperation.abort(),this.snappingManager?.doneSnapping();let{geometryType:n,numCommittedVertices:r}=this,i=n===`multipoint`&&r===0||n===`polyline`&&r<2||n===`polygon`&&r<3;n!==`segment`&&n!==`point`||this.commitStagedVertex(),this._createOperationCompleted=!i,(this.isCompleted||t)&&(this._stagedScreenPoint=null,this._stagedPointerId=null,this._stagedPointerType=null,this._processCursor(null),this.emit(`complete`,{vertices:this.committedVertices.map((e,t)=>({componentIndex:0,vertexIndex:t,coordinates:e})),aborted:t,type:`complete`}))}onInputEvent(e){switch(e.type){case`pointer-down`:this._pointerDownStates.add(e.pointerId);break;case`pointer-up`:this._pointerDownStates.delete(e.pointerId)}switch(e.type){case`pointer-move`:return this._onPointerMove(e);case`hold`:return this._onHold(e)}}redo(){this._editGeometryOperations.redo()}undo(){this.snappingManager!=null&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_processCursor(e){let n=t(this.cursorVertex),r=t(e),i=r&&(this._updateAndGetEffectiveDrawSurface()?.constrainZ(r)??r),a=this._snapToClosingVertex(i),o=this._applyConstraints(a);Pt(n,o)||(this._set(`cursorVertex`,o),this.segmentLabels?.set(`stagedVertex`,o==null?null:this.coordinateHelper.pointToVector(o)),o==null||this._stagedPointerType!==`mouse`?this.emit(`cursor-remove`):this.emit(`cursor-update`,{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activePart.vertices.length,coordinates:this.coordinateHelper.pointToArray(o)}],operation:`apply`,type:`vertex-update`}))}_snapToClosingVertex(e){if(e==null||this._isDragging||this.geometryType!==`polygon`||this.numCommittedVertices<=2)return e;let t=this._mapToScreen(e);if(!t)return e;let n=this._activePart;return this._vertexWithinPointerDistance(n.vertices[0].pos,t)?this.firstVertex:this._vertexWithinPointerDistance(n.vertices.at(-1).pos,t)?this.lastVertex:e}_createManipulatorDragPipeline(e){switch(this.drawingMode){case`click`:return this._createManipulatorDragPipelineClick(e);case`freehand`:return this._createManipulatorDragPipelineFreehand(e);case`hybrid`:return this._createManipulatorDragPipelineHybrid(e)}}_createManipulatorDragPipelineClick(e){return er(e,(e,t,n,r)=>{let i=r===`touch`&&this._snappingEnabled;if(this.isCompleted||!i)return;let{snappingStep:a,cancelSnapping:o}=yr({predicate:()=>i,snappingManager:this.snappingManager,snappingContext:new Et({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,feature:this.graphic,pointer:r,visualizer:this.snappingVisualizer,drawConstraints:this.constraints}),updatingHandles:this._updatingHandles,useZ:!this._requiresScenePoint});n=n.next(e=>(i&&this.snappingManager!=null&&this.snappingManager.doneSnapping(),e)).next(o),t.next(this._screenToMapDragEventStep()).next(e=>(e.action===`start`&&(this._processCursor(e.mapStart),(this.geometryType===`segment`||i&&!this.numCommittedVertices)&&this.commitStagedVertex()),e)).next(gr(this.view,this.elevationInfo)).next(...a).next(e=>(i&&(this._processCursor(e.mapEnd),e.action===`end`&&this.commitStagedVertex()),e)).next(e=>(e.action===`end`&&(this._stagedPointerType!==`mouse`&&this._snappingOperation.abort(),this.geometryType!==`segment`&&this.geometryType!==`point`||this.complete()),e))})}_createManipulatorDragPipelineFreehand(e){return er(e,(e,t)=>{this.isCompleted||t.next(this._screenToMapDragEventStep()).next(e=>(e.action===`start`&&(this._snappingOperation.abort(),this.committableVertex??this._processCursor(e.mapStart),this.geometryType===`segment`&&this.commitStagedVertex()),e)).next(e=>{switch(e.action){case`start`:case`update`:this._processCursor(e.mapEnd),this.geometryType!==`polygon`&&this.geometryType!==`polyline`||this.commitStagedVertex();break;case`end`:this.complete()}return e})})}_createManipulatorDragPipelineHybrid(e){return er(e,(e,t)=>{this.isCompleted||t.next(this._screenToMapDragEventStep()).next(e=>(e.action===`start`&&(this._snappingOperation.abort(),this.addHandles(this._editGeometryOperations.createUndoGroup(),jr),this._processCursor(e.mapStart),this.commitStagedVertex()),e)).next(e=>{switch(e.action){case`start`:case`update`:this._processCursor(e.mapEnd),this.geometryType!==`polygon`&&this.geometryType!==`polyline`||this.commitStagedVertex();break;case`end`:this._stagedPointerType!==`mouse`&&this._snappingOperation.abort(),this.removeHandles(jr),this.geometryType!==`segment`&&this.geometryType!==`point`||this.complete()}return e})})}get _drawAtFixedElevation(){let{constraintsEnabled:e,constraintZ:t,geometryType:n,numCommittedVertices:r}=this;return e?t!=null||n===`segment`&&r>0:(n===`segment`||n===`polygon`)&&r>0}_updateAndGetEffectiveDrawSurface(){let{constraintsEnabled:e,coordinateHelper:t,drawSurface:n,elevationDrawSurface:r,snapToSceneEnabled:i}=this;if(r==null)return n;if(!this.hasZ)return r.defaultZ=null,r;let a=this.elevationInfo?.mode,o=this.defaultZ,s=e||a===`absolute-height`;return i!=null&&(s=i),a===`on-the-ground`&&(s=!1),this._drawAtFixedElevation&&(o=(e?this.constraintZ:null)??t.getZ(this._activePart.vertices[0].pos),s=!1),s?n:(r.defaultZ=o,r)}_mapToScreen(e){return this._updateAndGetEffectiveDrawSurface()?.mapToScreen(e)}_onHold(e){this._snappingOperation.abort(),this.drawingMode===`click`&&e.pointerType===`touch`&&this._snappingEnabled&&this._processCursor(e.mapPoint),e.stopPropagation()}_onImmediateClick(e){if(!(e.pointerType===`mouse`&&e.button===2||this._manipulator.dragging))try{let{drawingMode:t,geometryType:n}=this;this._stagedPointerType=e.pointerType,this._stagedScreenPoint=e.screenPoint;let r=this._screenToMap(e.screenPoint);if(r==null||r==null||t===`freehand`&&n!==`point`&&n!==`multipoint`)return;if(this._snappingEnabled&&this.cursorVertex!=null||this._processCursor(r),this.committableVertex==null)return void this.complete();this.commitStagedVertex(),e.pointerType!==`mouse`&&this._processCursor(null),(t===`freehand`&&this.geometryType!==`multipoint`||n===`point`||n===`segment`&&this.numCommittedVertices===2||n===`segment`&&t===`hybrid`&&this.numCommittedVertices===1)&&this.complete()}finally{e.stopPropagation()}}_onImmediateDoubleClick(e){this._manipulator.dragging||this.geometryType===`point`||(this.complete(),e.stopPropagation())}_onPointerMove(e){let t=oe(e.x,e.y);this._updatePointer(t,e.pointerId,e.pointerType)&&e.stopPropagation()}_updatePointer(e,t,n){return this._stagedScreenPoint=e,this._stagedPointerType=n,this._stagedPointerId=t,this._isDragging?(this._snappingOperation.abort(),!1):(this._processCursorMovementRelativeToSurface(e,n),!0)}_onKeyboardBasedChange(){this._stagedPointerType===`mouse`&&this._stagedScreenPoint&&this._stagedPointerId!=null&&!this._isDragging?this._processCursorMovementRelativeToSurface(this._stagedScreenPoint,this._stagedPointerType):this._snappingOperation.abort()}_processCursorMovementRelativeToSurface(e,t){let n=this._snappingOperation,r=this._screenToMap(e),i=this._requiresScenePoint?this.drawSurface?.screenToMap(e):null;if(r==null)return this._hideDefaultCursor=!0,this._processCursor(null),void n.abort();this._hideDefaultCursor=!1;let a=this.snappingManager;if(a==null)return this._processCursor(r),void n.abort();let o=this._getSnappingContext(t);this._updatingHandles.addPromise(we(n.snap({point:r,scenePoint:i},a,o)))}_applyConstraints(e){let{_constraint:t,constraints:n}=this;if(!e||!n||!t)return e;let{context:r}=n,i=pn(e,r),a=i?t.closestTo(i):void 0;if(!a)return e;let o=mn(a,e,r),s=this.view.type===`2d`||r.elevationInfo.mode!==`absolute-height`;return o!=null&&s&&this.constraintZ!=null&&this.hasZ&&(o.z=this.constraintZ),o}_screenToMap(e){return e?this._updateAndGetEffectiveDrawSurface()?.screenToMap(e):null}_screenToMapDragEventStep(){let e=null;return t=>{if(t.action===`start`&&(e=this._screenToMap(t.screenStart)),e==null)return null;let n=this._screenToMap(t.screenEnd);return n==null?null:{...t,mapStart:e,mapEnd:n}}}_vertexWithinPointerDistance(e,t){let n=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(e));return n!=null&&Mr(n,t,25)}_getSnappingContext(e){let t=this._drawAtFixedElevation?this.elevationDrawSurface?.defaultZ:null;return new Et({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:e,feature:this.graphic,visualizer:this.snappingVisualizer,selfSnappingZ:t==null?null:{value:t,elevationInfo:this.elevationInfo},drawConstraints:this.constraints})}};function Mr(e,t,n){let r=e.x-t.x,i=e.y-t.y;return r*r+i*i<=n}o([g()],$.prototype,`_hideDefaultCursor`,void 0),o([g()],$.prototype,`_stagedPointerId`,void 0),o([g()],$.prototype,`_isDragging`,null),o([g()],$.prototype,`_snappingOperation`,void 0),o([g()],$.prototype,`_snappingEnabled`,null),o([g({constructOnly:!0})],$.prototype,`graphic`,void 0),o([g()],$.prototype,`constraintsEnabled`,void 0),o([g()],$.prototype,`constraints`,void 0),o([g()],$.prototype,`_constraint`,null),o([g()],$.prototype,`constraintZ`,void 0),o([g()],$.prototype,`defaultZ`,void 0),o([g()],$.prototype,`isDraped`,void 0),o([g({constructOnly:!0})],$.prototype,`automaticLengthMeasurementUtils`,void 0),o([g({value:Qn})],$.prototype,`drawingMode`,null),o([g({constructOnly:!0})],$.prototype,`elevationDrawSurface`,void 0),o([g({constructOnly:!0})],$.prototype,`elevationInfo`,void 0),o([g({constructOnly:!0,type:Xe})],$.prototype,`labelOptions`,void 0),o([g({constructOnly:!0})],$.prototype,`geometryType`,void 0),o([g({constructOnly:!0})],$.prototype,`hasM`,void 0),o([g({constructOnly:!0})],$.prototype,`hasZ`,void 0),o([g()],$.prototype,`cursor`,void 0),o([g()],$.prototype,`effectiveCursor`,null),o([g()],$.prototype,`loading`,void 0),o([g({constructOnly:!0})],$.prototype,`manipulators`,void 0),o([g({constructOnly:!0})],$.prototype,`drawSurface`,void 0),o([g({constructOnly:!0})],$.prototype,`segmentLabels`,void 0),o([g({constructOnly:!0})],$.prototype,`snappingManager`,void 0),o([g({constructOnly:!0})],$.prototype,`snappingVisualizer`,void 0),o([g()],$.prototype,`snapToSceneEnabled`,void 0),o([g({readOnly:!0})],$.prototype,`cursorVertex`,null),o([g({readOnly:!0})],$.prototype,`visualizationCursorVertex`,null),o([g()],$.prototype,`committableVertex`,null),o([g()],$.prototype,`firstVertex`,void 0),o([g()],$.prototype,`lastVertex`,void 0),o([g()],$.prototype,`secondToLastVertex`,void 0),o([g()],$.prototype,`updating`,null),o([g({constructOnly:!0})],$.prototype,`view`,void 0),$=o([S(`esri.views.draw.DrawOperation`)],$);var Nr=class{constructor(e,t,n,r=null){this._elevationInfo=e,this.defaultZ=t,this._view=n,this._excludeGraphics=r}screenToMap(e){let{defaultZ:t,_view:n}=this,r=n.sceneIntersectionHelper.intersectElevationFromScreen(f(e.x,e.y),this._elevationInfo,t??0,this._excludeGraphics);return t==null&&r!=null&&(r.z=void 0),r}mapToScreen(e){let t=Ae(e.x,e.y,Ie(this._view,e,this._elevationInfo),e.spatialReference);return this._view.toScreen(t)}constrainZ(e){let{defaultZ:t}=this;return t!=null&&e.z!==t&&((e=zt(e)).z=t),e}},Pr=class{constructor(e,t,n=[]){this.view=e,this.elevationInfo=t,this.exclude=n}screenToMap(e){let t=this.view.toMap(e,{exclude:this.exclude,excludeLabels:!0});return t!=null&&(t.z=Ne(t,this.view,this.elevationInfo)),t}mapToScreen(e){let t=e;return this.elevationInfo!=null&&(t=Ae(e.x,e.y,Ie(this.view,e,this.elevationInfo),e.spatialReference)),this.view.toScreen(t)}constrainZ(e){return e}},Fr=class{constructor(e,t=!1,n=0){this.view=e,this.hasZ=t,this.defaultZ=n,this.mapToScreen=t=>e.toScreen(t),this.screenToMap=t?t=>{let r=e.toMap(t);return r.z=n,r}:t=>e.toMap(t)}constrainZ(e){let{defaultZ:t}=this;return this.hasZ&&e.z!==t&&((e=zt(e)).z=t),e}};(class e{screenToMap(t){let{x:n,y:r}=t;return new i({x:n,y:r,spatialReference:e.spatialReference})}mapToScreen(e){return oe(e.x,e.y)}constrainZ(e){return e}static{this.spatialReference=new ee}});function Ir(e,t){return Rr(e,t,!1)}function Lr(e,t){return Rr(e,t,!0)}function Rr(e,t,n){if(e instanceof Tt){if(e.operation instanceof St)return zr(e.operation,t,n),!0;if(e.operation instanceof vt)return Br(e.operation,t,n),!0;if(e.operation instanceof wt)return Vr(e.operation,t,n),!0}return!1}function zr(e,t,n=!1){let r=n?-1:1,i=ae(r*e.dx,r*e.dy,r*e.dz);_e(t.origin,t.origin,i),Vt(t)}function Br(e,t,n=!1){let r=n?-e.angle:e.angle;be(t.basis1,t.basis1,re,r),be(t.basis2,t.basis2,re,r),Vt(t)}function Vr(e,t,n=!1){let r=n?1/e.factor1:e.factor1,i=n?1/e.factor2:e.factor2;p(t.basis1,t.basis1,r),p(t.basis2,t.basis2,i),s(t.origin,t.origin,e.origin,e.axis1,r),s(t.origin,t.origin,e.origin,e.axis2,i),Vt(t)}function Hr(t,n,i,a,o=!1){a||=Ht();let s=c(D.get(),t[1],-t[0]),l=c(D.get(),1/0,1/0),u=c(D.get(),-1/0,-1/0),d=D.get(),f=n.allVerticesUnordered;f.forEach(({pos:e})=>{c(d,b(t,e),b(s,e)),Oe(l,l,d),Se(u,u,d)});let p=1e-6,m=c(D.get(),u[0]-l[0]<p?i/2:0,u[1]-l[1]<p?i/2:0);le(l,l,m),r(u,u,m);let h=o?f.reduce((e,t)=>e+(t.pos[2]??0),0)/f.length:0;return De(a.basis1,t,(u[0]-l[0])/2),De(a.basis2,s,(u[1]-l[1])/2),e(a.origin,l[0]*t[0]+l[1]*s[0],l[0]*t[1]+l[1]*s[1],h),_e(a.origin,a.origin,a.basis1),_e(a.origin,a.origin,a.basis2),Vt(a),a}export{Xn as C,Y as S,tr as _,Fr as a,lr as b,yr as c,fr as d,pr as f,cr as g,nr as h,Nr as i,hr as l,gr as m,Lr as n,Pr as o,sr as p,Ir as r,$ as s,Hr as t,or as u,er as v,J as w,ur as x,vr as y};