import{Fu as e,Pa as t,Sw as n,WT as r,XT as i,zu as a}from"./index-BqmCqmfp.js";import{t as o}from"./urlUtils-CtPsFIu4.js";import{t as s}from"./queryUtils-GIY2oFHT.js";import{t as c}from"./PivotQuery-VQ28ggdJ.js";function l(e){let t=s(e),n=t.outPivots;if(n?.length){for(let e of n)e.pivotType===`Pivot`&&e.pivotParameters.outStatistic?e.pivotParameters.outStatistic=JSON.stringify(e.pivotParameters.outStatistic):e.pivotType===`Unpivot`&&(e.unPivotParameters.sourceFields=e.unPivotParameters.sourceFields.join(`,`));t.outPivots=JSON.stringify(n)}return t}async function u(e,t,n){return await d(e,t,n)}async function d(t,a,s={}){let c=typeof t==`string`?r(t):t,u=a.geometry?[a.geometry]:[],d=(await e(u,null,{signal:s.signal}))?.[0];d!=null&&((a=a.clone()).geometry=d);let f=o({...c.query,f:`json`,...l(a)});return n(i(c.path,`queryPivot`),{...s,query:{...f,...s.query}})}async function f(e,n,r){let i=a(e),o={...r},{data:s}=await u(i,c.from(n),o);return t.fromJSON(s)}export{f as executePivotQuery};