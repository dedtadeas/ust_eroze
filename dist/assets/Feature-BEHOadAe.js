const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/calcite-icon-D_iKcGa4.js","assets/dom-atD5WAsR.js","assets/guid-D8BoG5RM.js","assets/logger-N52NEE_B.js","assets/index-BqmCqmfp.js","assets/index-kIqmb12G.css","assets/observers-Ca90Dkfx.js","assets/calcite-icon-DU8UXGam.js","assets/chartUtilsAm5-DQo5Wsn-.js","assets/Theme-Dpr4FPaR.js","assets/Tooltip-CgjhRJOS.js","assets/DefaultTheme-CKCDheUT.js","assets/chartCommon-C42CJpmN.js","assets/Button-BkuHOpqd.js","assets/ColorSet-BiQ4UCjk.js","assets/pieChart-CiwFlogz.js","assets/Tick-3KKt_E4N.js","assets/xyChart-BrTGr9LT.js","assets/arcade-Cn2FEmgE.js","assets/ImmutableArray-C3KNQCVd.js","assets/arcadeEnvironment-DfjU7s2m.js","assets/arcade-B_QRF6lE.js","assets/Dictionary-B3Q9BFVY.js","assets/shared-BZhQTnH4.js","assets/number-Dq0Kt6xf.js","assets/track-CqQN9dI1.js","assets/ArcadePortal-B5V7N8wX.js","assets/Attachment-CoFGJO-I.js","assets/Feature-Bd-5gqon.js","assets/featureConversionUtils-7vyVIZ6j.js","assets/OptimizedFeature-Dx4_lHip.js","assets/memoryEstimations-O7VgDRVG.js","assets/OptimizedGeometry-f3I9Z6C1.js","assets/OptimizedFeatureSet-DlHqIhoP.js","assets/containerUtils-vIXF8Wsj.js","assets/functions-WMuSJ2is.js","assets/fieldStats-DP2AlUAP.js","assets/WhereClause-h6PJ6gjs.js","assets/streamLayerUtils-BMw-RtDi.js","assets/arcade-D8hsF49o.js","assets/unitConversion-BbIQHFw4.js","assets/aiServices-BSz92p7H.js","assets/commonProperties-fyxj-C5K.js","assets/Feature-B5STg1Ce.js","assets/calcite-loader-BQ1zV8tb.js","assets/controllers-DZ7pbtKF.js","assets/useT9n-bRfAARgx.js","assets/calcite-loader-C2BnVEC6.js","assets/uniqueValues-BwDIZ6wg.js","assets/pbf-CwGh07vG.js","assets/quantizationUtils-C5shine1.js","assets/queryUtils-BA7HiGeg.js","assets/urlUtils-CtPsFIu4.js","assets/executeQueryJSON-BAg2ttNX.js","assets/query-D8IHih8e.js","assets/pbfQueryUtils-DOeTJOP2.js","assets/queryUtils-GIY2oFHT.js","assets/executeQueryPBF-DMb74A0k.js","assets/FixedIntervalBinParameters-BO-nZFQ3.js","assets/AttributeBinsQuery-DyK0zHZB.js","assets/generateRendererUtils-BgK3c0Qk.js","assets/PivotQuery-VQ28ggdJ.js","assets/statsWorker-JK_YVXSy.js","assets/utils-C2AeUOnb.js","assets/utils-DD1PtgG7.js","assets/utils-BcHO3hev.js","assets/calcite-chip-DHdJ6msM.js","assets/useSetFocus-BOgV9A-L.js","assets/interactive-C1Xh6Lv0.js","assets/key-UZzOT_rp.js","assets/calcite-list-CgWjPxHf.js","assets/calcite-input-C8DWvaD7.js","assets/form-CYe_Hdps.js","assets/label-CbTib4du.js","assets/keyed-CU6bsPrA.js","assets/static-CFhWbVpa.js","assets/useCancelable-CRHa62_S.js","assets/utils2-B1dhLot4.js","assets/calcite-input-message-BD7sw1wZ.js","assets/calcite-progress-B9qY8ZRX.js","assets/calcite-scrim-ChNbuBJA.js","assets/debounce-JuHvylml.js","assets/calcite-list-item-BNrqiIAE.js","assets/dynamicClasses-DOR4n0eL.js","assets/floating-ui-bSZlirwY.js","assets/openCloseComponent-C1bAqVbv.js","assets/resources5-CUqenAI5.js","assets/resources7-BZ7SBRw5.js","assets/calcite-action-CVrDQiWf.js","assets/calcite-dropdown-group-Cw7DBVuL.js","assets/calcite-dropdown-item-CuDPcNk9.js","assets/calcite-dropdown-gAQ7koWv.js","assets/calcite-notice-CvAfSaDY.js","assets/Feature-CglJwaNJ.js","assets/quantityUtils-Dywg00j-.js","assets/throttle-C7RAnISb.js","assets/unitFormatUtils-D4yCMgjI.js","assets/isImageryGraphicOrigin-Qwa2m0c8.js","assets/isImageryTileGraphicOrigin-DkUl-5nl.js","assets/AttachmentInfo-BN0SLgvw.js","assets/utils-CLvHNiZV.js","assets/utils-5jlQHYup.js","assets/cimSymbolUtils-1FVTTBxd.js","assets/gfxUtils-DZoKCRMw.js","assets/FeatureUtilityNetworkAssociationsViewModel-BAKZ0nr8.js","assets/featureUtils-SEVs0V51.js","assets/FeatureUtilityNetworkAssociationList-1UWvRIyc.js"])))=>i.map(i=>d[i]);
import{Ap as e,Ax as t,Bx as n,CD as r,Cd as i,Cp as a,Cw as o,Db as s,Gr as c,Hb as l,I as u,Id as d,Kb as f,Kw as p,MC as m,OC as h,SC as g,Sp as _,Sw as v,Tp as y,Ub as ee,Ux as te,Wb as b,Xb as ne,Xp as re,Yb as ie,Yw as ae,Zw as oe,_E as x,_o as se,as as ce,bp as le,cT as S,cs as ue,dm as de,eE as fe,eT as pe,fC as me,go as C,ho as w,i as he,iT as ge,is as _e,kC as T,km as ve,kp as ye,ls as be,lu as xe,mT as Se,mo as E,nC as Ce,nD as we,po as D,px as Te,qr as Ee,r as De,rT as Oe,sD as ke,sT as Ae,tx as je,vE as Me,vb as Ne,wD as Pe,wE as Fe,wd as Ie,wp as Le,xD as Re,xE as ze,xp as Be,yE as Ve,ym as He,zb as Ue,zy as We}from"./index-BqmCqmfp.js";import{o as Ge}from"./shared-BZhQTnH4.js";import{r as Ke}from"./streamLayerUtils-BMw-RtDi.js";import{n as qe}from"./executeQueryJSON-BAg2ttNX.js";import{n as Je}from"./isImageryGraphicOrigin-Qwa2m0c8.js";import{n as Ye}from"./isImageryTileGraphicOrigin-DkUl-5nl.js";import{t as Xe}from"./AttachmentInfo-BN0SLgvw.js";import{t as Ze}from"./throttle-C7RAnISb.js";import{a as Qe}from"./unitFormatUtils-D4yCMgjI.js";import{A as $e,E as et,M as tt,O as nt,S as rt,T as it,_ as at,a as ot,b as O,c as k,g as st,h as ct,j as lt,k as ut,l as dt,m as ft,n as pt,o as mt,p as ht,r as gt,s as _t,t as vt,u as yt,v as bt,w as xt,x as St,y as Ct}from"./featureUtils-SEVs0V51.js";import{S as wt,t as Tt}from"./utils-CLvHNiZV.js";import{n as Et,t as Dt}from"./FeatureUtilityNetworkAssociationsViewModel-BAKZ0nr8.js";var Ot={editing:!1,operations:{add:!0,update:!0,delete:!0}},kt=g.ofType(Xe),A=class extends h{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.attachmentKeywords=null,this.attachmentTypes=null,this.capabilities={...Ot},this.activeAttachmentInfo=null,this.activeFileInfo=null,this.attachmentInfos=new kt,this.fileInfos=new g,this.graphic=null,this.mode=`view`,this.orderByFields=null,this.filesEnabled=!1,this.addHandles(f(()=>this.graphic,()=>this._graphicChanged(),b))}destroy(){this._attachmentLayer=null,this.graphic=null}castCapabilities(e){return{...Ot,...e}}get state(){return this._getAttachmentsPromise?`loading`:this.graphic?`ready`:`disabled`}get supportsResizeAttachments(){let{graphic:e}=this;if(!e)return!1;let t=e.layer||e.sourceLayer;return t?.loaded&&`capabilities`in t&&t.capabilities&&`attachment`in t.capabilities&&t.capabilities.attachment&&`supportsResize`in t.capabilities.attachment&&t.capabilities.attachment.supportsResize||!1}get supportsTypeWildcard(){let{graphic:e}=this;if(!e)return!1;let t=e.layer||e.sourceLayer;return t?.loaded&&`capabilities`in t&&t.capabilities&&`attachment`in t.capabilities&&t.capabilities.attachment&&`supportsResize`in t.capabilities.attachment&&t.capabilities.attachment.supportsTypeWildcard||!1}async getAttachments(){let{_attachmentLayer:e,attachmentInfos:t,orderByFields:n,attachmentTypes:r,attachmentKeywords:i,supportsTypeWildcard:a}=this;if(!e||typeof e.queryAttachments!=`function`)throw new x(`invalid-layer`,`getAttachments(): A valid layer is required.`);let o=this._getObjectId();if(typeof o!=`number`)throw new x(`invalid-object-id`,`getAttachments(): Numeric object id is required`);let s=n?.map(e=>`${e.field} ${e.order===`descending`?`DESC`:`ASC`}`),c=new Ee({objectIds:[o],returnMetadata:!0,orderByFields:s,attachmentTypes:a?r?.filter(Boolean).map(e=>`${e}/*`):void 0,keywords:i}),l=[],u=e.queryAttachments(c).then(e=>e[o]||l).catch(()=>l);this._getAttachmentsPromise=u,this.notifyChange(`state`);let d=await u;return t.destroyAll(),d.length&&t.addMany(d),this._getAttachmentsPromise=null,this.notifyChange(`state`),d}async addAttachment(e,t=this.graphic){let{_attachmentLayer:n,attachmentInfos:r,capabilities:i}=this;if(!t)throw new x(`invalid-graphic`,`addAttachment(): A valid graphic is required.`,{graphic:t});if(!e)throw new x(`invalid-attachment`,`addAttachment(): An attachment is required.`,{attachment:e});if(!i.operations?.add)throw new x(`invalid-capabilities`,`addAttachment(): add capabilities are required.`);if(!n||typeof n.addAttachment!=`function`)throw new x(`invalid-layer`,`addAttachment(): A valid layer is required.`);let a=await n.addAttachment(t,e).then(e=>this._queryAttachment(e.objectId,t));return r.add(a),a}async deleteAttachment(e){let{_attachmentLayer:t,attachmentInfos:n,graphic:r,capabilities:i}=this;if(!e)throw new x(`invalid-attachment-info`,`deleteAttachment(): An attachmentInfo is required.`,{attachmentInfo:e});if(!i.operations?.delete)throw new x(`invalid-capabilities`,`deleteAttachment(): delete capabilities are required.`);if(!t||typeof t.deleteAttachments!=`function`)throw new x(`invalid-layer`,`deleteAttachment(): A valid layer is required.`);if(!r)throw new x(`invalid-graphic`,`deleteAttachment(): A graphic is required.`);let a=await t.deleteAttachments(r,[e.id]).then(()=>e);return n.remove(a),a.destroy(),a}async updateAttachment(e,t=this.activeAttachmentInfo){let{_attachmentLayer:n,attachmentInfos:r,graphic:i,capabilities:a}=this;if(!e)throw new x(`invalid-attachment`,`updateAttachment(): An attachment is required.`,{attachment:e});if(!t)throw new x(`invalid-attachment-info`,`updateAttachment(): An attachmentInfo is required.`,{attachmentInfo:t});if(!a.operations?.update)throw new x(`invalid-capabilities`,`updateAttachment(): Update capabilities are required.`);let o=r.indexOf(t);if(!n||typeof n.updateAttachment!=`function`)throw new x(`invalid-layer`,`updateAttachment(): A valid layer is required.`);if(!i)throw new x(`invalid-graphic`,`updateAttachment(): A graphic is required.`);let s=await n.updateAttachment(i,t.id,e).then(e=>this._queryAttachment(e.objectId));return r.splice(o,1,s),s}async commitFiles(){return await Promise.all(this.fileInfos.items.map(e=>this.addAttachment(e.form))),this.fileInfos.removeAll(),this.getAttachments()}addFile(e,t){if(!e||!t)return null;let n={file:e,form:t};return this.fileInfos.add(n),n}updateFile(e,t,n=this.activeFileInfo){if(!e||!t||!n)return null;let r=this.fileInfos.indexOf(n);return r>-1&&this.fileInfos.splice(r,1,{file:e,form:t}),this.fileInfos.items[r]}deleteFile(e){let t=this.fileInfos.find(t=>t.file===e);return t?(this.fileInfos.remove(t),t):null}async _queryAttachment(e,t){let{_attachmentLayer:n}=this;if(!e||!n?.queryAttachments)throw new x(`invalid-attachment-id`,`Could not query attachment.`);let r=this._getObjectId(t);if(typeof r!=`number`)throw new x(`invalid-object-id`,`getAttachments(): Numeric object id is required`);let i=new Ee({objectIds:[r],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return n.queryAttachments(i).then(e=>e[r][0])}_getObjectId(e=this.graphic){return e?.getObjectId()??null}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>this.attachmentInfos.destroyAll()))}_setAttachmentLayer(){let{graphic:e}=this,t=$e(e);this._attachmentLayer=t?t.type===`scene`&&t.associatedLayer!=null?t.associatedLayer:t:null}};r([m({type:[String]})],A.prototype,`attachmentKeywords`,void 0),r([m({type:[[`application`,`audio`,`image`,`model`,`text`,`video`]]})],A.prototype,`attachmentTypes`,void 0),r([m()],A.prototype,`capabilities`,void 0),r([n(`capabilities`)],A.prototype,`castCapabilities`,null),r([m()],A.prototype,`activeAttachmentInfo`,void 0),r([m()],A.prototype,`activeFileInfo`,void 0),r([m({readOnly:!0,type:kt})],A.prototype,`attachmentInfos`,void 0),r([m()],A.prototype,`fileInfos`,void 0),r([m({type:d})],A.prototype,`graphic`,void 0),r([m()],A.prototype,`mode`,void 0),r([m({type:[e]})],A.prototype,`orderByFields`,void 0),r([m({readOnly:!0})],A.prototype,`state`,null),r([m()],A.prototype,`filesEnabled`,void 0),r([m({readOnly:!0})],A.prototype,`supportsResizeAttachments`,null),r([m({readOnly:!0})],A.prototype,`supportsTypeWildcard`,null),A=r([T(`esri.widgets.Attachments.AttachmentsViewModel`)],A);function At(e){let t=e.toLowerCase();return t===`image/bmp`||t===`image/emf`||t===`image/exif`||t===`image/gif`||t===`image/x-icon`||t===`image/jpeg`||t===`image/png`||t===`image/tiff`||t===`image/x-wmf`}function jt(e){let t=Ce(`esri/themes/base/images/files/`);return e?e===`text/plain`?`${t}text-32.svg`:e===`application/pdf`?`${t}pdf-32.svg`:e===`text/csv`?`${t}csv-32.svg`:e===`application/gpx+xml`?`${t}gpx-32.svg`:e===`application/x-dwf`?`${t}cad-32.svg`:e===`application/postscript`||e===`application/json`||e===`text/xml`||e===`model/vrml`?`${t}code-32.svg`:e===`application/x-zip-compressed`||e===`application/x-7z-compressed`||e===`application/x-gzip`||e===`application/x-tar`||e===`application/x-gtar`||e===`application/x-bzip2`||e===`application/gzip`||e===`application/x-compress`||e===`application/x-apple-diskimage`||e===`application/x-rar-compressed`||e===`application/zip`?`${t}zip-32.svg`:e.includes(`image/`)?`${t}image-32.svg`:e.includes(`audio/`)?`${t}sound-32.svg`:e.includes(`video/`)?`${t}video-32.svg`:e.includes(`msexcel`)||e.includes(`ms-excel`)||e.includes(`spreadsheetml`)?`${t}excel-32.svg`:e.includes(`msword`)||e.includes(`ms-word`)||e.includes(`wordprocessingml`)?`${t}word-32.svg`:e.includes(`powerpoint`)||e.includes(`presentationml`)?`${t}report-32.svg`:`${t}generic-32.svg`:`${t}generic-32.svg`}var Mt={close:`esri-icon-close`,collapse:`esri-icon-collapse`,down:`esri-icon-down`,downArrow:`esri-icon-down-arrow`,dragHorizontal:`esri-icon-drag-horizontal`,dragVertical:`esri-icon-drag-vertical`,duplicate:`esri-icon-duplicate`,expand:`esri-icon-expand`,fontFallbackText:`esri-icon-font-fallback-text`,forward:`esri-icon-forward`,handleVertical:`esri-icon-handle-vertical`,icon:`esri-icon`,left:`esri-icon-left`,locateCircled:`esri-icon-locate-circled`,noticeTriangle:`esri-icon-notice-triangle`,pause:`esri-icon-pause`,play:`esri-icon-play`,plus:`esri-icon-plus`,radioChecked:`esri-icon-radio-checked`,radioUnchecked:`esri-icon-radio-unchecked`,refresh:`esri-icon-refresh`,reverse:`esri-icon-reverse`,right:`esri-icon-right`,search:`esri-icon-search`,swap:`esri-icon-swap`,table:`esri-icon-table`,trash:`esri-icon-trash`,up:`esri-icon-up`,upArrow:`esri-icon-up-arrow`,upDownArrows:`esri-icon-up-down-arrows`,urbanModel:`esri-icon-urban-model`,zoomInMagnifyingGlass:`esri-icon-zoom-in-magnifying-glass`,zoomToObject:`esri-icon-zoom-to-object`},Nt={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},j=`esri-attachments`,M={base:j,loaderContainer:`${j}__loader-container`,loader:`${j}__loader`,container:`${j}__container`,containerList:`${j}__container--list`,containerPreview:`${j}__container--preview`,actions:`${j}__actions`,deleteButton:`${j}__delete-button`,addAttachmentButton:`${j}__add-attachment-button`,errorMessage:`${j}__error-message`,items:`${j}__items`,item:`${j}__item`,itemButton:`${j}__item-button`,itemMask:`${j}__item-mask`,itemMaskIcon:`${j}__item-mask--icon`,itemImage:`${j}__image`,itemImageResizable:`${j}__image--resizable`,itemLabel:`${j}__label`,itemFilename:`${j}__filename`,itemChevronIcon:`${j}__item-chevron-icon`,itemLink:`${j}__item-link`,itemLinkOverlay:`${j}__item-link-overlay`,itemLinkOverlayIcon:`${j}__item-link-overlay-icon`,itemAddIcon:`${j}__item-add-icon`,formNode:`${j}__form-node`,fileFieldset:`${j}__file-fieldset`,fileLabel:`${j}__file-label`,fileName:`${j}__file-name`,fileInput:`${j}__file-input`,metadata:`${j}__metadata`,metadataFieldset:`${j}__metadata-fieldset`,progressBar:`${j}__progress-bar`},Pt=window.CSS,N=class extends C{constructor(e,t){super(e,t),this.displayType=`auto`,this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=null,this.visibleElements={...Nt},this._supportsImageOrientation=Pt&&Pt.supports&&Pt.supports(`image-orientation`,`from-image`),this._addAttachmentForm=null,this._updateAttachmentForm=null}normalizeCtorArgs(e){return e?.viewModel||(e={viewModel:new A,...e}),e}initialize(){this.addHandles([l(()=>this.viewModel?.attachmentInfos,`change`,()=>this.scheduleRender()),l(()=>this.viewModel?.fileInfos,`change`,()=>this.scheduleRender()),f(()=>this.viewModel?.mode,()=>this._modeChanged(),b)])}loadDependencies(){return se({icon:()=>o(()=>import(`./calcite-icon-D_iKcGa4.js`),__vite__mapDeps([0,1,2,3,4,5,6,7]))})}get capabilities(){return this.viewModel.capabilities}set capabilities(e){this.viewModel.capabilities=e}get effectiveDisplayType(){let{displayType:e}=this;return e&&e!==`auto`?e:this.viewModel.supportsResizeAttachments?`preview`:`list`}get attachmentKeywords(){return this.viewModel.attachmentKeywords}set attachmentKeywords(e){this.viewModel.attachmentKeywords=e}get attachmentTypes(){return this.viewModel.attachmentTypes}set attachmentTypes(e){this.viewModel.attachmentTypes=e}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get icon(){return`attachment`}set icon(e){this._overrideIfSome(`icon`,e)}get label(){return this.messages?.widgetLabel??``}set label(e){this._overrideIfSome(`label`,e)}castVisibleElements(e){return{...Nt,...e}}addAttachment(){let{_addAttachmentForm:e,viewModel:t}=this;return this._set(`submitting`,!0),this._set(`error`,null),t.addAttachment(e).then(e=>(this._set(`submitting`,!1),this._set(`error`,null),t.mode=`view`,e)).catch(e=>{throw this._set(`submitting`,!1),this._set(`error`,new x(`attachments:add-attachment`,this.messages.addErrorMessage,e)),e})}deleteAttachment(e){let{viewModel:t}=this;return this._set(`submitting`,!0),this._set(`error`,null),t.deleteAttachment(e).then(e=>(this._set(`submitting`,!1),this._set(`error`,null),t.mode=`view`,e)).catch(e=>{throw this._set(`submitting`,!1),this._set(`error`,new x(`attachments:delete-attachment`,this.messages.deleteErrorMessage,e)),e})}updateAttachment(){let{viewModel:e}=this,{_updateAttachmentForm:t}=this;return this._set(`submitting`,!0),this._set(`error`,null),e.updateAttachment(t).then(t=>(this._set(`submitting`,!1),this._set(`error`,null),e.mode=`view`,t)).catch(e=>{throw this._set(`submitting`,!1),this._set(`error`,new x(`attachments:update-attachment`,this.messages.updateErrorMessage,e)),e})}addFile(){let e=this.viewModel.addFile(this.selectedFile,this._addAttachmentForm);return this.viewModel.mode=`view`,e}updateFile(){let{viewModel:e}=this,t=e.updateFile(this.selectedFile,this._updateAttachmentForm,e.activeFileInfo);return e.mode=`view`,t}deleteFile(e){let t=this.viewModel.deleteFile(e||this.viewModel.activeFileInfo?.file);return this.viewModel.mode=`view`,t}render(){let{submitting:e,viewModel:t}=this,{state:n}=t;return D(`div`,{class:this.classes(M.base,w.widget)},e?this._renderProgressBar():null,n===`loading`?this._renderLoading():this._renderAttachments(),this._renderErrorMessage())}_renderErrorMessage(){let{error:e,visibleElements:t}=this;return e&&t.errorMessage?D(`div`,{class:M.errorMessage,key:`error-message`},e.message):null}_renderAttachments(){let{activeFileInfo:e,mode:t,activeAttachmentInfo:n}=this.viewModel;return t===`add`?this._renderAddForm():t===`edit`?this._renderDetailsForm(n||e):this._renderAttachmentContainer()}_renderLoading(){return D(`div`,{class:M.loaderContainer,key:`loader`},D(`div`,{class:M.loader}))}_renderProgressBar(){return this.visibleElements.progressBar?D(`div`,{class:M.progressBar,key:`progress-bar`}):null}_renderAddForm(){let{submitting:e,selectedFile:t}=this,n=e||!t,r=this.visibleElements.cancelAddButton?D(`button`,{bind:this,class:this.classes(w.button,w.buttonTertiary,w.buttonSmall,w.buttonHalf,e&&w.buttonDisabled),disabled:e,onclick:this._cancelForm,type:`button`},this.messages.cancel):null,i=this.visibleElements.addSubmitButton?D(`button`,{class:this.classes(w.button,w.buttonSecondary,w.buttonSmall,w.buttonHalf,{[w.buttonDisabled]:n}),disabled:n,type:`submit`},this.messages.add):null,a=t?D(`span`,{class:M.fileName,key:`file-name`},t.name):null,o=D(`form`,{afterCreate:ue,afterRemoved:ce,bind:this,"data-node-ref":`_addAttachmentForm`,onsubmit:this._submitAddAttachment},D(`fieldset`,{class:M.fileFieldset},a,D(`label`,{class:this.classes(M.fileLabel,w.button,w.buttonSecondary)},t?this.messages.changeFile:this.messages.selectFile,D(`input`,{bind:this,class:M.fileInput,name:`attachment`,onchange:this._handleFileInputChange,type:`file`}))),i,r);return D(`div`,{class:M.formNode,key:`add-form-container`},o)}_renderDetailsForm(e){let{visibleElements:t,viewModel:n,selectedFile:r,submitting:i}=this,{capabilities:a}=n,o=i||!r,s,c,l,u;r?(s=r.type,c=r.name,l=r.size):e&&`file`in e?(s=e.file.type,c=e.file.name,l=e.file.size):e&&`contentType`in e&&(s=e.contentType,c=e.name,l=e.size,u=e.url);let d=a.editing&&a.operations?.delete&&t.deleteButton?D(`button`,{bind:this,class:this.classes(w.button,w.buttonSmall,w.buttonTertiary,M.deleteButton,{[w.buttonDisabled]:i}),disabled:i,key:`delete-button`,onclick:t=>this._submitDeleteAttachment(t,e),type:`button`},this.messages.delete):void 0,f=a.editing&&a.operations?.update&&t.updateButton?D(`button`,{class:this.classes(w.button,w.buttonSmall,w.buttonThird,{[w.buttonDisabled]:o}),disabled:o,key:`update-button`,type:`submit`},this.messages.update):void 0,p=this.visibleElements.cancelUpdateButton?D(`button`,{bind:this,class:this.classes(w.button,w.buttonSmall,w.buttonTertiary,w.buttonThird,{[w.buttonDisabled]:i}),disabled:i,key:`cancel-button`,onclick:this._cancelForm,type:`button`},this.messages.cancel):void 0,m=a.editing&&a.operations?.update?D(`fieldset`,{class:M.fileFieldset,key:`file`},D(`span`,{class:M.fileName,key:`file-name`},c),D(`label`,{class:this.classes(M.fileLabel,w.button,w.buttonSecondary)},this.messages.changeFile,D(`input`,{bind:this,class:M.fileInput,name:`attachment`,onchange:this._handleFileInputChange,type:`file`}))):void 0,h=D(`fieldset`,{class:M.metadataFieldset,key:`size`},D(`label`,null,Qe(this.messagesUnits,l??0))),g=D(`fieldset`,{class:M.metadataFieldset,key:`content-type`},D(`label`,null,s)),_=u==null?this._renderImageMask(e,400):D(`a`,{class:M.itemLink,href:u,rel:`noreferrer`,target:`_blank`},this._renderImageMask(e,400),D(`div`,{class:M.itemLinkOverlay},D(`span`,{class:M.itemLinkOverlayIcon},D(`calcite-icon`,{icon:`launch`})))),v=D(`form`,{afterCreate:ue,afterRemoved:ce,bind:this,"data-node-ref":`_updateAttachmentForm`,onsubmit:t=>this._submitUpdateAttachment(t,e)},D(`div`,{class:M.metadata},h,g),m,D(`div`,{class:M.actions},d,p,f));return D(`div`,{class:M.formNode,key:`edit-form-container`},_,v)}_renderImageMask(e,t){return e?`file`in e?this._renderGenericImageMask(e.file.name,e.file.type):this._renderImageMaskForAttachment(e,t):null}_renderGenericImageMask(e,t){let{supportsResizeAttachments:n}=this.viewModel,r=jt(t),i={[M.itemImageResizable]:n};return D(`div`,{class:this.classes(M.itemMaskIcon,M.itemMask),key:r},D(`img`,{alt:e,class:this.classes(i,M.itemImage),src:r,title:e}))}_renderImageMaskForAttachment(e,t){let{supportsResizeAttachments:n}=this.viewModel;if(!e)return null;let{contentType:r,name:i,size:a,url:o}=e;if(!n||!At(r))return this._renderGenericImageMask(i,r);let s=this._getCSSTransform(e),c=s?{transform:s,"image-orientation":`none`}:{},l=`${o}${o?.includes(`?`)?`&`:`?`}w=${t}&s=${a}`,u={[M.itemImageResizable]:n};return D(`div`,{class:this.classes(M.itemMask),key:l},D(`img`,{alt:i,class:this.classes(u,M.itemImage),src:l,styles:c,title:i}))}_renderFile(e){let{file:t}=e;return D(`li`,{class:M.item,key:t},D(`button`,{"aria-label":this.messages.attachmentDetails,bind:this,class:M.itemButton,key:`details-button`,onclick:()=>this._startEditFile(e),title:this.messages.attachmentDetails,type:`button`},this._renderImageMask(e),D(`label`,{class:M.itemLabel},D(`span`,{class:M.itemFilename},t.name||this.messages.noTitle),D(`span`,{"aria-hidden":`true`,class:this.classes(M.itemChevronIcon,_e(this.container)?Mt.left:Mt.right)}))))}_renderAttachmentInfo({attachmentInfo:e,displayType:t}){let{viewModel:n,effectiveDisplayType:r}=this,{capabilities:i,supportsResizeAttachments:a}=n,{contentType:o,name:s,url:c}=e,l=this._renderImageMask(e,t===`list`?48:400),u=i.editing?D(`span`,{"aria-hidden":`true`,class:this.classes(M.itemChevronIcon,_e(this.container)?Mt.left:Mt.right)}):null,d=[l,r===`preview`&&a&&At(o)?null:D(`label`,{class:M.itemLabel},D(`span`,{class:M.itemFilename},s||this.messages.noTitle),u)],f=i.editing?D(`button`,{"aria-label":this.messages.attachmentDetails,bind:this,class:M.itemButton,"data-attachment-info-id":e.id,key:`details-button`,onclick:()=>this._startEditAttachment(e),title:this.messages.attachmentDetails,type:`button`},d):D(`a`,{class:M.itemButton,href:c??void 0,key:`details-link`,rel:`noreferrer`,target:`_blank`},d);return D(`li`,{class:M.item,key:e},f)}_renderAttachmentContainer(){let{effectiveDisplayType:e,viewModel:t,visibleElements:n}=this,{attachmentInfos:r,capabilities:i,fileInfos:a}=t,o=!!r?.length,s=!!a?.length,c={[M.containerList]:e!==`preview`,[M.containerPreview]:e===`preview`},l=i.editing&&i.operations?.add&&n.addButton?D(`button`,{bind:this,class:this.classes(w.button,w.buttonTertiary,M.addAttachmentButton),onclick:()=>this._startAddAttachment(),type:`button`},D(`span`,{"aria-hidden":`true`,class:this.classes(M.itemAddIcon,Mt.plus)}),this.messages.add):void 0,u=o?D(`ul`,{class:M.items,key:`attachments-list`},r.toArray().map(t=>this._renderAttachmentInfo({attachmentInfo:t,displayType:e}))):void 0,d=s?D(`ul`,{class:M.items,key:`file-list`},a.toArray().map(e=>this._renderFile(e))):void 0,f=s||o?void 0:D(`div`,{class:w.empty},this.messages.noAttachments);return D(`div`,{class:this.classes(M.container,c),key:`attachments-container`},u,d,f,l)}_modeChanged(){this._set(`error`,null),this._set(`selectedFile`,null)}_handleFileInputChange(e){let t=e.target.files?.item(0);this._set(`selectedFile`,t)}_submitDeleteAttachment(e,t){e.preventDefault(),t&&(`file`in t?this.deleteFile(t.file):t&&this.deleteAttachment(t))}_submitAddAttachment(e){e.preventDefault(),this.viewModel.filesEnabled?this.addFile():this.addAttachment()}_submitUpdateAttachment(e,t){e.preventDefault(),t&&`file`in t?this.updateFile():this.updateAttachment()}_startEditAttachment(e){let{viewModel:t}=this;t.activeFileInfo=null,t.activeAttachmentInfo=e,t.mode=`edit`}_startEditFile(e){let{viewModel:t}=this;t.activeAttachmentInfo=null,t.activeFileInfo=e,t.mode=`edit`}_startAddAttachment(){this.viewModel.mode=`add`}_cancelForm(e){e.preventDefault(),this.viewModel.mode=`view`}_getCSSTransform(e){let{orientationInfo:t}=e;return!this._supportsImageOrientation&&t?[t.rotation?`rotate(${t.rotation}deg)`:``,t.mirrored?`scaleX(-1)`:``].join(` `):``}};r([m()],N.prototype,`capabilities`,null),r([m()],N.prototype,`displayType`,void 0),r([m({readOnly:!0})],N.prototype,`effectiveDisplayType`,null),r([m()],N.prototype,`attachmentKeywords`,null),r([m()],N.prototype,`attachmentTypes`,null),r([m()],N.prototype,`graphic`,null),r([m()],N.prototype,`icon`,null),r([m()],N.prototype,`label`,null),r([m(),E(`esri/widgets/Attachments/t9n/Attachments`)],N.prototype,`messages`,void 0),r([m(),E(`esri/core/t9n/Units`)],N.prototype,`messagesUnits`,void 0),r([m({readOnly:!0})],N.prototype,`selectedFile`,void 0),r([m({readOnly:!0})],N.prototype,`submitting`,void 0),r([m({readOnly:!0})],N.prototype,`error`,void 0),r([m({type:A})],N.prototype,`viewModel`,void 0),r([m()],N.prototype,`visibleElements`,void 0),r([n(`visibleElements`)],N.prototype,`castVisibleElements`,null),N=r([T(`esri.widgets.Attachments`)],N);var Ft=class extends A{constructor(e){super(e),this.description=null,this.title=null}};r([m()],Ft.prototype,`description`,void 0),r([m()],Ft.prototype,`title`,void 0),Ft=r([T(`esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel`)],Ft);var It=`esri-feature-element-info`,Lt={base:It,title:`${It}__title`,description:`${It}__description`},P=class extends C{constructor(e,t){super(e,t),this.description=null,this.headingLevel=2,this.title=null}render(){return D(`div`,{class:Lt.base},this._renderTitle(),this._renderDescription())}_renderTitle(){let{title:e}=this;return e?D(wt,{class:Lt.title,innerHTML:e,level:this.headingLevel}):null}_renderDescription(){let{description:e}=this;return e?D(`div`,{class:Lt.description,innerHTML:e,key:`description`}):null}};r([m()],P.prototype,`description`,void 0),r([m()],P.prototype,`headingLevel`,void 0),r([m()],P.prototype,`title`,void 0),P=r([T(`esri.widgets.Feature.support.FeatureElementInfo`)],P);var Rt={base:`esri-feature-attachments`},F=class extends C{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attachmentsWidget=new N,this.headingLevel=2,this.viewModel=new Ft}initialize(){this._featureElementInfo=new P,this.addHandles([f(()=>[this.viewModel?.description,this.viewModel?.title,this.headingLevel],()=>this._setupFeatureElementInfo(),b),f(()=>this.viewModel,e=>this.attachmentsWidget.viewModel=e,b)])}destroy(){this.attachmentsWidget.viewModel=null,this.attachmentsWidget.destroy(),this._featureElementInfo?.destroy()}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get displayType(){return this.attachmentsWidget.displayType}set displayType(e){this.attachmentsWidget.displayType=e}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){let{attachmentsWidget:e}=this;return D(`div`,{class:Rt.base},this._featureElementInfo?.render(),e?.render())}_setupFeatureElementInfo(){let{description:e,title:t,headingLevel:n}=this;this._featureElementInfo?.set({description:e,title:t,headingLevel:n})}};r([m({readOnly:!0})],F.prototype,`attachmentsWidget`,void 0),r([m()],F.prototype,`description`,null),r([m()],F.prototype,`displayType`,null),r([m()],F.prototype,`graphic`,null),r([m()],F.prototype,`headingLevel`,void 0),r([m()],F.prototype,`title`,null),r([m({type:Ft})],F.prototype,`viewModel`,void 0),F=r([T(`esri.widgets.Feature.FeatureAttachments`)],F);var I=class extends h{constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.addHandles(f(()=>this.creator,e=>{this._destroyContent(),this._createContent(e)},b))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?`loading`:`ready`}_destroyContent(){let{created:e,graphic:t,destroyer:n}=this;e&&t&&(it({type:`content`,value:n,event:{graphic:t}}),this._set(`created`,null))}async _createContent(e){let t=this.graphic;if(!t||!e)return;let n=it({type:`content`,value:e,event:{graphic:t}});this._loadingPromise=n,this.notifyChange(`state`);let r=await n;n===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange(`state`),this._set(`created`,r))}};r([m({readOnly:!0})],I.prototype,`created`,void 0),r([m()],I.prototype,`creator`,void 0),r([m()],I.prototype,`destroyer`,void 0),r([m({type:d})],I.prototype,`graphic`,void 0),r([m({readOnly:!0})],I.prototype,`state`,null),I=r([T(`esri.widgets.Feature.FeatureContent.FeatureContentViewModel`)],I);var zt=`esri-feature-content`,Bt={base:zt,loaderContainer:`${zt}__loader-container`,loader:`${zt}__loader`},L=class extends C{constructor(e,t){super(e,t),this.viewModel=null,this._addTargetToAnchors=e=>{Array.from(e.querySelectorAll(`a`)).forEach(e=>{vt(e.href)&&!e.hasAttribute(`target`)&&e.setAttribute(`target`,`_blank`)})}}get creator(){return this.viewModel?.creator}set creator(e){this.viewModel&&(this.viewModel.creator=e)}get graphic(){return this.viewModel?.graphic}set graphic(e){this.viewModel&&(this.viewModel.graphic=e)}render(){let e=this.viewModel?.state;return D(`div`,{class:Bt.base},e===`loading`?this._renderLoading():this._renderCreated())}_renderLoading(){return D(`div`,{class:Bt.loaderContainer,key:`loader`},D(`div`,{class:Bt.loader}))}_renderCreated(){let e=this.viewModel?.created;return e?e instanceof HTMLElement?D(`div`,{afterCreate:this._attachToNode,bind:e,key:e}):De(e)?D(`div`,{key:e},!e.destroyed&&e.render()):D(`div`,{afterCreate:this._addTargetToAnchors,innerHTML:e,key:e}):null}_attachToNode(e){let t=this;e.appendChild(t)}};r([m()],L.prototype,`creator`,null),r([m()],L.prototype,`graphic`,null),r([m({type:I})],L.prototype,`viewModel`,void 0),L=r([T(`esri.widgets.Feature.FeatureContent`)],L);var R=class extends h{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.isContentFieldInfos=!1,this.graphic=null,this.layer=null,this.title=null}get formattedFieldInfos(){let{expressionInfos:e,fieldInfos:t,layer:n,isContentFieldInfos:r,graphic:i}=this,a=[];return t?.forEach(t=>{if(!(!t.hasOwnProperty(`visible`)||t.visible))return;let o=t.clone();o.label=St({fieldInfo:o,expressionInfos:e,layer:n,graphic:i,isContentFieldInfos:r}),Ne(n)&&ot({fieldInfo:t,graphic:i})&&(o.fieldFormat=dt({fieldInfo:o,isContentFieldInfos:r,layer:n})),a.push(o)}),a}};r([m()],R.prototype,`attributes`,void 0),r([m({type:[le]})],R.prototype,`expressionInfos`,void 0),r([m()],R.prototype,`description`,void 0),r([m({type:[y]})],R.prototype,`fieldInfos`,void 0),r([m({readOnly:!0})],R.prototype,`formattedFieldInfos`,null),r([m()],R.prototype,`isContentFieldInfos`,void 0),r([m()],R.prototype,`graphic`,void 0),r([m()],R.prototype,`layer`,void 0),r([m()],R.prototype,`title`,void 0),R=r([T(`esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel`)],R);var Vt=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:`_blank`,label:`{messages.view}`},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:`{hierPart}`},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:`{hierPart}`},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:`{messages.openInApp}`,appName:`App Studio Player`},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:`{messages.openInApp}`,appName:`Collector`},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:`{messages.openInApp}`,appName:`Explorer`},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:`{messages.openInApp}`,appName:`Navigator`},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:`{messages.openInApp}`,appName:`Survey123`},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:`{messages.openInApp}`,appName:`Trek2There`},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:`{messages.openInApp}`,appName:`Workforce`},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:`{messages.openInApp}`,appName:`iForm`},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:`{messages.openInApp}`,appName:`FlowFinity`},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:`{messages.openInApp}`,appName:`Laserfische`},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:`{messages.openInApp}`,appName:`Microsoft Power Bi`}];function Ht(e,t){if(typeof t!=`string`||!t)return t;let n=Vt.find(e=>e.pattern.test(t));if(!n)return t;let r=t.match(n.pattern)?.[2],i=Fe(Fe(n.label,{messages:e,hierPart:r}),{appName:n.appName}),a=n.target?` target="${n.target}"`:``,o=n.target===`_blank`?` rel="noreferrer"`:``;return ve.sanitizeUrl(fe(t)).replace(n.pattern,`<a${a} href="$1"${o}>${i}</a>`)}var Ut=`esri-feature-fields`,Wt={base:Ut,fieldHeader:`${Ut}__field-header`,fieldData:`${Ut}__field-data`,fieldDataDate:`${Ut}__field-data--date`},z=class extends C{constructor(e,t){super(e,t),this._featureElementInfo=null,this.viewModel=new R,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new P,this.addHandles(f(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),b))}destroy(){this._featureElementInfo?.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get expressionInfos(){return this.viewModel.expressionInfos}set expressionInfos(e){this.viewModel.expressionInfos=e}get fieldInfos(){return this.viewModel.fieldInfos}set fieldInfos(e){this.viewModel.fieldInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){return D(`div`,{class:Wt.base},this._featureElementInfo?.render(),this._renderFields())}_renderFieldInfo(e,t){let{attributes:n}=this.viewModel,r=e.fieldName||``,i=e.label||r,a=n?n[r]==null?``:n[r]:``,o=e?.fieldFormat?.type===`date-time`,s=typeof a==`number`&&!o?this._forceLTR(a):Ht(this.messagesURIUtils,a),c={[Wt.fieldDataDate]:o};return D(`tr`,{key:`fields-element-info-row-${r}-${t}`},D(`th`,{class:Wt.fieldHeader,innerHTML:i,key:`fields-element-info-row-header-${r}-${t}`}),D(`td`,{class:this.classes(Wt.fieldData,c),innerHTML:s,key:`fields-element-info-row-data-${r}-${t}`}))}_renderFields(){let{formattedFieldInfos:e}=this.viewModel;return e?.length?D(`table`,{class:w.table,summary:this.messages.fieldsSummary},D(`tbody`,null,e.map((e,t)=>this._renderFieldInfo(e,t)))):null}_setupFeatureElementInfo(){let{description:e,title:t}=this;this._featureElementInfo?.set({description:e,title:t})}_forceLTR(e){return`&lrm;${e}`}};r([m()],z.prototype,`attributes`,null),r([m()],z.prototype,`description`,null),r([m()],z.prototype,`expressionInfos`,null),r([m()],z.prototype,`fieldInfos`,null),r([m()],z.prototype,`title`,null),r([m({type:R,nonNullable:!0})],z.prototype,`viewModel`,void 0),r([m(),E(`esri/widgets/Feature/t9n/Feature`)],z.prototype,`messages`,void 0),r([m(),E(`esri/widgets/support/t9n/uriUtils`)],z.prototype,`messagesURIUtils`,void 0),z=r([T(`esri.widgets.Feature.FeatureFields`)],z);var Gt=`esri.widgets.Feature.support.relatedFeatureUtils`,Kt=()=>Me.getLogger(Gt),qt=new Map;function Jt(e){if(!O(e))return null;let[t,n]=e.split(`/`).slice(1);return{layerId:t,fieldName:n}}function Yt(e,t){if(!t.relationships)return null;let n=null,{relationships:r}=t;return r.some(t=>t.id===parseInt(e,10)&&(n=t,!0)),n}function Xt({originRelationship:e,relationships:t,layerId:n}){return t.find(({relatedTableId:t,id:r})=>`${t}`===n&&r===e?.id)??null}function Zt(e,t){let n=t.toLowerCase();for(let t in e)if(t.toLowerCase()===n)return e[t];return null}function Qt(e,t){let n=Yt(e,t);if(n)return{url:`${t.url}/${n.relatedTableId}`,sourceSpatialReference:t.spatialReference,relation:n,relatedFields:[],outStatistics:[]}}function $t(e,t){if(!t||!e)return;let{features:n,statsFeatures:r}=e,i=n?.value;t.relatedFeatures=i?i.features:[];let a=r?.value;t.relatedStatsFeatures=a?a.features:[]}function en(e,t,n,r){let i=new c;return i.outFields=[`*`],i.relationshipId=typeof t.id==`number`?t.id:parseInt(t.id,10),i.objectIds=[e.attributes[n.objectIdField]],i.gdbVersion=n.gdbVersion??null,i.historicMoment=n.historicMoment??null,n.queryRelatedFeatures?.(i,r)??Promise.resolve({})}function tn(e,t,n){let r=0,i=[];for(;r<t.length;)i.push(`${e} IN (${t.slice(r,n+r)})`),r+=n;return i.join(` OR `)}function nn(e){return e?ke(e):void 0}function rn(e){return e?ke(e,(e,t)=>JSON.stringify(e.toJSON())===JSON.stringify(t.toJSON())):void 0}async function an(e,t,n,r){let a=n.layerId.toString(),{layerInfo:o,relation:s,relatedFields:c,outStatistics:l,url:u,sourceSpatialReference:d}=t,f=nn(c),p=rn(l);if(!o||!s)return null;let m=Xt({originRelationship:s,relationships:o.relationships,layerId:a});if(m?.relationshipTableId&&m.keyFieldInRelationshipTable){let t=(await en(e,m,n,r))[e.attributes[n.objectIdField]];if(!t)return null;let a=t.features.map(e=>e.attributes[o.objectIdField]);if(p?.length&&o.supportsStatistics){let e=new i;e.where=tn(o.objectIdField,a,1e3),e.outFields=f,e.outStatistics=p,e.sourceSpatialReference=d;let n={features:Promise.resolve(t),statsFeatures:qe(u,e)};return pe(n)}}let h=m?.keyField;if(h){let t=re(un(o.fields,h)),a=Zt(e.attributes,s.keyField),c=t?`${h}=${a}`:`${h}='${a}'`,l=n.historicMoment,m=n.gdbVersion,g=qe(u,new i({where:c,outFields:f,sourceSpatialReference:d,historicMoment:l,gdbVersion:m}),r),_=p?.length&&o.supportsStatistics?qe(u,new i({where:c,outFields:f,outStatistics:p,sourceSpatialReference:d}),r):null,v={features:g};return _&&(v.statsFeatures=_),pe(v)}return null}function on(e,t){return v(e,{query:{f:`json`},signal:t?.signal})}function sn({relatedInfos:e,layer:t},n){let r={};return e.forEach((e,n)=>{let{relation:i}=e;if(!i){let e=new x(`editor:relation-required`,`A relation is required on a layer to retrieve related records.`);throw Kt().error(e),e}let{relatedTableId:a}=i;if(typeof a!=`number`){let e=new x(`editor:related-table`,`A related table ID is required on a layer to retrieve related records.`);throw Kt().error(e),e}let o=`${t.url}/${a}`,s=qt.get(o),c=s??on(o);s||qt.set(o,c),r[n]=c}),Oe(pe(r),n)}function cn({graphic:e,relatedInfos:t,layer:n},r){let i={};return t.forEach((t,a)=>{t.layerInfo&&(i[a]=an(e,t,n,r))}),pe(i)}function ln({relatedInfo:e,fieldName:t,fieldInfo:n}){if(e.relatedFields?.push(t),n.statisticType){let r=new Ie({statisticType:n.statisticType,onStatisticField:t,outStatisticFieldName:t});e.outStatistics?.push(r)}}function un(e,t){if(e!=null){t=t.toLowerCase();for(let n of e)if(n&&n.name.toLowerCase()===t)return n}return null}var dn={chartAnimation:!0},B=class extends h{constructor(e){super(e),this.abilities={...dn},this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(e){return{...dn,...e}}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){let{formattedMediaInfoCount:t}=this;this.activeMediaInfoIndex=(e+t)%t}_pageContentElementMedia(e){let{activeMediaInfoIndex:t}=this,n=t+e;this._setContentElementMedia(n)}_formatMediaInfos(){let{mediaInfos:e,layer:t}=this,n=this.attributes??{},r=this.formattedAttributes??{},i=this.expressionAttributes??{},a=this.fieldInfoMap??new Map;return e?.map(e=>{let o=e?.clone();return o?(o.title=k({attributes:n,fieldInfoMap:a,globalAttributes:r,expressionAttributes:i,layer:t,text:o.title}),o.caption=k({attributes:n,fieldInfoMap:a,globalAttributes:r,expressionAttributes:i,layer:t,text:o.caption}),o.altText=k({attributes:n,fieldInfoMap:a,globalAttributes:r,expressionAttributes:i,layer:t,text:o.altText}),o.type===`image`?o.value?(this._setImageValue({value:o.value,formattedAttributes:r,layer:t}),o.value.sourceURL?o:void 0):void 0:o.type===`pie-chart`||o.type===`line-chart`||o.type===`column-chart`||o.type===`bar-chart`?o.value?(this._setChartValue({value:o.value,chartType:o.type,attributes:n,formattedAttributes:r,layer:t,expressionAttributes:i}),o):void 0:null):null}).filter(we)??[]}_setImageValue(e){let t=this.fieldInfoMap??new Map,{value:n,formattedAttributes:r,layer:i}=e,{linkURL:a,sourceURL:o}=n;if(o){let e=pt(o,i);n.sourceURL=_t({formattedAttributes:r,template:e,fieldInfoMap:t})}if(a){let e=pt(a,i);n.linkURL=_t({formattedAttributes:r,template:e,fieldInfoMap:t})}}_setChartValue(e){let{value:t,attributes:n,formattedAttributes:r,chartType:i,layer:a,expressionAttributes:o}=e,{popupTemplate:s,relatedInfos:c}=this,{fields:l,normalizeField:u}=t,d=a;if(t.fields=mt(l,d),u&&(t.normalizeField=tt(u,d)),!l.some(e=>!!(r[e]!=null||O(e)&&c?.size)))return;let f=s?.fieldInfos??[];l.forEach((e,a)=>{let s=t.colors?.[a];if(O(e))return void(t.series=[...t.series,...this._getRelatedChartInfos({fieldInfos:f,fieldName:e,formattedAttributes:r,chartType:i,value:t,color:s})]);let c=this._getChartOption({value:t,attributes:n,chartType:i,formattedAttributes:r,expressionAttributes:o,fieldName:e,fieldInfos:f,color:s});t.series.push(c)})}_getRelatedChartInfos(e){let{fieldInfos:t,fieldName:n,formattedAttributes:r,chartType:i,value:a,color:o}=e,s=[],c=Jt(n),l=c&&this.relatedInfos?.get(c.layerId.toString());if(!l)return s;let{relatedFeatures:u,relation:d}=l;if(!d||!u)return s;let{cardinality:f}=d;return u.forEach(e=>{let{attributes:l}=e;l&&Object.keys(l).forEach(e=>{e===c.fieldName&&s.push(this._getChartOption({value:a,attributes:l,formattedAttributes:r,fieldName:n,chartType:i,relatedFieldName:e,hasMultipleRelatedFeatures:u?.length>1,fieldInfos:t,color:o}))})}),f===`one-to-many`||f===`many-to-many`?s:[s[0]]}_getTooltip({label:e,value:t,chartType:n}){return n===`pie-chart`?`${e}`:`${e}: ${t}`}_getChartOption(e){let{value:t,attributes:n,formattedAttributes:r,expressionAttributes:i,fieldName:o,relatedFieldName:s,fieldInfos:c,chartType:l,hasMultipleRelatedFeatures:u,color:d}=e,{layer:f,graphic:p}=this,m=this.fieldInfoMap??new Map,{normalizeField:h,tooltipField:g}=t,_=h?O(h)?n[Jt(h).fieldName]:n[h]:null,v=yt(o)&&i&&i[o]!==void 0?i[o]:s&&n[s]!==void 0?n[s]:n[o]===void 0?r[o]:n[o],ee=v===void 0?null:v&&_?v/_:v,te=new a({fieldName:o,color:d,value:ee==null?void 0:typeof ee==`number`?ee:Number(ee)});if(O(o)){let e=m.get(o.toLowerCase()),t=g&&m.get(g.toLowerCase()),i=e?.fieldName??o,a=u&&g?Jt(g).fieldName:t?.fieldName??g,c=u&&a?n[a]:r[a]??(e&&St({fieldInfo:e,graphic:p,layer:f}))??e?.fieldName??s,d=u&&s?n[s]:r[i];return te.tooltip=this._getTooltip({label:c,value:d,chartType:l}),te}let b=xt(c,o),ne=tt(o,f),re=g&&r[g]!==void 0?r[g]:St({fieldInfo:b||new y({fieldName:ne}),expressionInfos:this.popupTemplate?.expressionInfos,graphic:p,layer:f}),ie=r[ne];return te.tooltip=this._getTooltip({label:re,value:ie,chartType:l}),te}};r([m()],B.prototype,`abilities`,void 0),r([n(`abilities`)],B.prototype,`castAbilities`,null),r([m()],B.prototype,`activeMediaInfoIndex`,void 0),r([m({readOnly:!0})],B.prototype,`activeMediaInfo`,null),r([m()],B.prototype,`attributes`,void 0),r([m()],B.prototype,`description`,void 0),r([m()],B.prototype,`fieldInfoMap`,void 0),r([m()],B.prototype,`formattedAttributes`,void 0),r([m()],B.prototype,`expressionAttributes`,void 0),r([m({readOnly:!0})],B.prototype,`formattedMediaInfos`,null),r([m()],B.prototype,`graphic`,void 0),r([m()],B.prototype,`layer`,void 0),r([m({readOnly:!0})],B.prototype,`formattedMediaInfoCount`,null),r([m()],B.prototype,`mediaInfos`,void 0),r([m()],B.prototype,`popupTemplate`,void 0),r([m()],B.prototype,`relatedInfos`,void 0),r([m()],B.prototype,`title`,void 0),B=r([T(`esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel`)],B);var V=`esri-feature-media`,H={base:V,mediaContainer:`${V}__container`,mediaItemContainer:`${V}__item-container`,mediaItem:`${V}__item`,mediaItemText:`${V}__item-text`,mediaItemTitle:`${V}__item-title`,mediaItemCaption:`${V}__item-caption`,mediaNavigation:`${V}__item-navigation`,mediaPagination:`${V}__pagination`,mediaPaginationText:`${V}__pagination-text`,mediaChart:`${V}__chart`,mediaPaginationButton:`${V}__pagination-button`,mediaPaginationIcon:`${V}__pagination-icon`,mediaChartRendered:`${V}__chart--rendered`},fn=15,U=`category`,pn=`value`,mn=`rgba(50, 50, 50, 1)`,hn=250,gn=500,_n=200,W=class extends C{constructor(e,t){super(e,t),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this._chartRootMap=new WeakMap,this.viewModel=new B,this.messages=null,this._disposeChart=e=>{this._chartRootMap.get(e)?.dispose(),this._chartRootMap.delete(e)},this._createChart=async e=>{let{destroyed:t,viewModel:n}=this;if(t||!n||!e)return;let{createRoot:r}=await o(async()=>{let{createRoot:e}=await import(`./chartUtilsAm5-DQo5Wsn-.js`);return{createRoot:e}},__vite__mapDeps([8,4,5,9,10,11])),i=await r(e);this._chartRootMap.set(e,i),await this._renderChart({mediaInfo:n.activeMediaInfo,root:i})}}initialize(){this._featureElementInfo=new P,this.addHandles([f(()=>[this.viewModel?.activeMediaInfo,this.viewModel?.activeMediaInfoIndex],()=>this._setupMediaRefreshTimer(),b),f(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),b)])}loadDependencies(){return se({icon:()=>o(()=>import(`./calcite-icon-D_iKcGa4.js`),__vite__mapDeps([0,1,2,3,4,5,6,7]))})}destroy(){this._clearMediaRefreshTimer(),this._featureElementInfo?.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get activeMediaInfoIndex(){return this.viewModel.activeMediaInfoIndex}set activeMediaInfoIndex(e){this.viewModel.activeMediaInfoIndex=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get fieldInfoMap(){return this.viewModel.fieldInfoMap}set fieldInfoMap(e){this.viewModel.fieldInfoMap=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get mediaInfos(){return this.viewModel.mediaInfos}set mediaInfos(e){this.viewModel.mediaInfos=e}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(e){this.viewModel.popupTemplate=e}get relatedInfos(){return this.viewModel.relatedInfos}set relatedInfos(e){this.viewModel.relatedInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){return D(`div`,{bind:this,class:H.base,onkeyup:this._handleMediaKeyup},this._featureElementInfo?.render(),this._renderMedia())}_renderMedia(){let{formattedMediaInfoCount:e,activeMediaInfoIndex:t}=this.viewModel,n=this._renderMediaText();return e?D(`div`,{class:H.mediaContainer,key:`media-element-container`},this._renderMediaInfo(),D(`div`,{class:H.mediaNavigation},n,e>1?D(`div`,{class:H.mediaPagination},this._renderMediaPageButton(`previous`),D(`span`,{class:H.mediaPaginationText},ie(this.messages.pageText,{index:t+1,total:e})),this._renderMediaPageButton(`next`)):null)):null}_renderMediaText(){let{activeMediaInfo:e}=this.viewModel;if(!e)return null;let t=e&&e.title?D(`div`,{class:H.mediaItemTitle,innerHTML:e.title,key:`media-title`}):null,n=e&&e.caption?D(`div`,{class:H.mediaItemCaption,innerHTML:e.caption,key:`media-caption`}):null;return t||n?D(`div`,{class:H.mediaItemText,key:`media-text`},t,n):null}_renderImageMediaInfo(e){if(!e.value)return null;let{_refreshIntervalInfo:t}=this,{activeMediaInfoIndex:n,formattedMediaInfoCount:r}=this.viewModel,{value:i,refreshInterval:a,altText:o,title:s,type:c}=e,{sourceURL:l,linkURL:u}=i,d=vt(u??void 0)?`_blank`:`_self`,f=d===`_blank`?`noreferrer`:``,p=a?t:null,m=p?p.timestamp:0,h=p?p.sourceURL:l,g=D(`img`,{alt:o||s,key:`media-${c}-${n}-${r}-${m}`,src:h??void 0});return(u?D(`a`,{href:u,rel:f,target:d,title:s},g):null)??g}_renderChartMediaInfo(e){let{activeMediaInfoIndex:t,formattedMediaInfoCount:n}=this.viewModel;return D(`div`,{afterCreate:this._createChart,afterRemoved:this._disposeChart,bind:this,class:H.mediaChart,key:`media-${e.type}-${t}-${n}`})}_renderMediaInfoType(){let{activeMediaInfo:e}=this.viewModel;return e?e.type===`image`?this._renderImageMediaInfo(e):e.type.includes(`chart`)?this._renderChartMediaInfo(e):null:null}_renderMediaInfo(){let{activeMediaInfo:e}=this.viewModel;return e?D(`div`,{class:H.mediaItemContainer,key:`media-container`},D(`div`,{class:H.mediaItem,key:`media-item-container`},this._renderMediaInfoType())):null}_renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;let t=e===`previous`,n=t?this.messages.previous:this.messages.next,r=t?`chevron-left`:`chevron-right`,i=t?`media-previous`:`media-next`,a=t?this._previous:this._next;return D(`button`,{"aria-label":n,bind:this,class:H.mediaPaginationButton,key:i,onclick:a,tabIndex:0,title:n,type:`button`},D(`calcite-icon`,{class:H.mediaPaginationIcon,icon:r,scale:`s`}))}_setupFeatureElementInfo(){let{description:e,title:t}=this;this._featureElementInfo?.set({description:e,title:t})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_getRenderer(){if(!this.viewModel)return;let{graphic:e,layer:t}=this.viewModel;return e?.isAggregate&&t?.featureReduction&&`renderer`in t.featureReduction?t.featureReduction.renderer:t?.renderer}async _getSeriesColors(e){let{colorAm5:t}=await o(async()=>{let{colorAm5:e}=await import(`./chartCommon-C42CJpmN.js`);return{colorAm5:e}},__vite__mapDeps([12,9,4,5,13,10,14])),n=new Map;return e.forEach(e=>{e.color&&n.set(e,t(e.color.toCss(!0)))}),n}async _getRendererColors(){let{colorAm5:e}=await o(async()=>{let{colorAm5:e}=await import(`./chartCommon-C42CJpmN.js`);return{colorAm5:e}},__vite__mapDeps([12,9,4,5,13,10,14])),t=new Map,n=this._getRenderer();if(!n)return t;let r=await Tt(n);return r.delete(`default`),Array.from(r.values()).every(e=>e?.length===1)&&Array.from(r.keys()).forEach(n=>{let i=r.get(n)?.[0]?.toCss(!0);i&&t.set(n,e(i))}),t}_handleMediaKeyup(e){let{key:t}=e;t===`ArrowLeft`&&(e.stopPropagation(),this.viewModel.previous()),t===`ArrowRight`&&(e.stopPropagation(),this.viewModel.next())}_canAnimateChart(){return!!this.viewModel&&!!this.viewModel.abilities.chartAnimation&&!xe()}_getChartAnimationMS(){return this._canAnimateChart()?hn:0}_getChartSeriesAnimationMS(){return this._canAnimateChart()?gn:0}async _renderChart(e){let{root:t,mediaInfo:n}=e,{value:r,type:i}=n,{ResponsiveThemeAm5:a,DarkThemeAm5:s,AnimatedThemeAm5:c,ColorSetAm5:l,ThemeAm5:u,esriChartColorSet:d}=await o(async()=>{let{ResponsiveThemeAm5:e,DarkThemeAm5:t,AnimatedThemeAm5:n,ColorSetAm5:r,ThemeAm5:i,esriChartColorSet:a}=await import(`./chartCommon-C42CJpmN.js`);return{ResponsiveThemeAm5:e,DarkThemeAm5:t,AnimatedThemeAm5:n,ColorSetAm5:r,ThemeAm5:i,esriChartColorSet:a}},__vite__mapDeps([12,9,4,5,13,10,14])),f=u.new(t);f.rule(`ColorSet`).set(`colors`,d),f.rule(`ColorSet`).set(`reuse`,!0);let p=[a.new(t),f];be(this.container)&&p.push(s.new(t)),this._canAnimateChart()&&p.push(c.new(t)),t.setThemes(p);let m=await this._getRendererColors(),h=await this._getSeriesColors(r.series),g=l.new(t,{}),_=h.get(r.series[0]),v=_?{lineSettings:{stroke:_}}:void 0,y=r.series.map((e,t)=>{let n=h.get(e)||m.get(e.fieldName)||g.getIndex(t);return{[U]:e.tooltip,[pn]:e.value,columnSettings:{fill:n,stroke:n},...v}}).filter(e=>i!==`pie-chart`||e.value!=null&&e.value>0);await(i===`pie-chart`?this._createPieChart(e,y):this._createXYChart(e,y))}_getDirection(){return _e(this.container)?`rtl`:`ltr`}async _customizeChartTooltip(e,t=`horizontal`){let{colorAm5:n}=await o(async()=>{let{colorAm5:e}=await import(`./chartCommon-C42CJpmN.js`);return{colorAm5:e}},__vite__mapDeps([12,9,4,5,13,10,14]));e.setAll({pointerOrientation:t}),e.get(`background`)?.setAll({stroke:n(mn)}),e.label.setAll({direction:this._getDirection(),oversizedBehavior:`wrap`,maxWidth:_n})}async _createPieChart(e,t){let{TooltipAm5:n}=await o(async()=>{let{TooltipAm5:e}=await import(`./chartCommon-C42CJpmN.js`);return{TooltipAm5:e}},__vite__mapDeps([12,9,4,5,13,10,14])),{PieChartAm5:r,PieSeriesAm5:i}=await o(async()=>{let{PieChartAm5:e,PieSeriesAm5:t}=await import(`./pieChart-CiwFlogz.js`);return{PieChartAm5:e,PieSeriesAm5:t}},__vite__mapDeps([15,4,5,9,16,14,11])),{mediaInfo:a,root:s}=e,{title:c}=a,l=a?.altText||a?.title||``,u=s.container.children.push(r.new(s,{ariaLabel:l,focusable:!0,paddingBottom:5,paddingTop:5,paddingLeft:5,paddingRight:5})),d=`{category}: {valuePercentTotal.formatNumber('0.00')}%
 ({value})`,f=n.new(s,{labelText:d}),p=u.series.push(i.new(s,{name:c,valueField:pn,categoryField:U,tooltip:f}));p.ticks.template.set(`forceHidden`,!0),p.labels.template.set(`forceHidden`,!0),p.slices.template.states.create(`active`,{shiftRadius:5}),await this._customizeChartTooltip(f),p.slices.template.setAll({ariaLabel:d,focusable:!0,templateField:`columnSettings`}),p.data.setAll(t),await p.appear(this._getChartSeriesAnimationMS()),await u.appear(this._getChartAnimationMS()),u.root.dom.classList.toggle(H.mediaChartRendered,!0)}_getMinSeriesValue(e){let t=0;return e.forEach(e=>t=Math.min(e.value,t)),t}async _createColumnChart(e,t,n){let{TooltipAm5:r,ScrollbarAm5:i}=await o(async()=>{let{TooltipAm5:e,ScrollbarAm5:t}=await import(`./chartCommon-C42CJpmN.js`);return{TooltipAm5:e,ScrollbarAm5:t}},__vite__mapDeps([12,9,4,5,13,10,14])),{CategoryAxisAm5:a,AxisRendererXAm5:s,ValueAxisAm5:c,AxisRendererYAm5:l,ColumnSeriesAm5:u}=await o(async()=>{let{CategoryAxisAm5:e,AxisRendererXAm5:t,ValueAxisAm5:n,AxisRendererYAm5:r,ColumnSeriesAm5:i}=await import(`./xyChart-BrTGr9LT.js`);return{CategoryAxisAm5:e,AxisRendererXAm5:t,ValueAxisAm5:n,AxisRendererYAm5:r,ColumnSeriesAm5:i}},__vite__mapDeps([17,4,5,9,13,16,14,11])),{mediaInfo:d,root:f}=t,{value:p,title:m}=d;e.setAll({wheelX:`panX`,wheelY:`zoomX`});let h=e.xAxes.push(a.new(f,{renderer:s.new(f,{inversed:_e(this.container)}),categoryField:U}));h.get(`renderer`).labels.template.setAll({forceHidden:!0});let g=e.yAxes.push(c.new(f,{renderer:l.new(f,{inside:!1}),min:this._getMinSeriesValue(p.series)}));g.get(`renderer`).labels.template.setAll({direction:this._getDirection()});let _=`{categoryX}`,v=r.new(f,{labelText:_}),y=e.series.push(u.new(f,{name:m,xAxis:h,yAxis:g,valueYField:pn,categoryXField:U,tooltip:v}));await this._customizeChartTooltip(v),y.columns.template.setAll({ariaLabel:_,focusable:!0,templateField:`columnSettings`}),p.series.length>fn&&e.set(`scrollbarX`,i.new(f,{orientation:`horizontal`})),h.data.setAll(n),y.data.setAll(n),await y.appear(this._getChartSeriesAnimationMS()),await e.appear(this._getChartAnimationMS())}async _createBarChart(e,t,n){let{TooltipAm5:r,ScrollbarAm5:i}=await o(async()=>{let{TooltipAm5:e,ScrollbarAm5:t}=await import(`./chartCommon-C42CJpmN.js`);return{TooltipAm5:e,ScrollbarAm5:t}},__vite__mapDeps([12,9,4,5,13,10,14])),{CategoryAxisAm5:a,AxisRendererXAm5:s,ValueAxisAm5:c,AxisRendererYAm5:l,ColumnSeriesAm5:u}=await o(async()=>{let{CategoryAxisAm5:e,AxisRendererXAm5:t,ValueAxisAm5:n,AxisRendererYAm5:r,ColumnSeriesAm5:i}=await import(`./xyChart-BrTGr9LT.js`);return{CategoryAxisAm5:e,AxisRendererXAm5:t,ValueAxisAm5:n,AxisRendererYAm5:r,ColumnSeriesAm5:i}},__vite__mapDeps([17,4,5,9,13,16,14,11])),{mediaInfo:d,root:f}=t,{value:p,title:m}=d;e.setAll({wheelX:`panY`,wheelY:`zoomY`});let h=e.yAxes.push(a.new(f,{renderer:l.new(f,{inversed:!0}),categoryField:U}));h.get(`renderer`).labels.template.setAll({forceHidden:!0});let g=e.xAxes.push(c.new(f,{renderer:s.new(f,{inside:!1,inversed:_e(this.container)}),min:this._getMinSeriesValue(p.series)}));g.get(`renderer`).labels.template.setAll({direction:this._getDirection()});let _=`{categoryY}`,v=r.new(f,{labelText:_}),y=e.series.push(u.new(f,{name:m,xAxis:g,yAxis:h,valueXField:pn,categoryYField:U,tooltip:v}));await this._customizeChartTooltip(v,`vertical`),y.columns.template.setAll({ariaLabel:_,focusable:!0,templateField:`columnSettings`}),p.series.length>fn&&e.set(`scrollbarY`,i.new(f,{orientation:`vertical`})),h.data.setAll(n),y.data.setAll(n),await y.appear(this._getChartSeriesAnimationMS()),await e.appear(this._getChartAnimationMS())}async _createLineChart(e,t,n){let{TooltipAm5:r,ScrollbarAm5:i}=await o(async()=>{let{TooltipAm5:e,ScrollbarAm5:t}=await import(`./chartCommon-C42CJpmN.js`);return{TooltipAm5:e,ScrollbarAm5:t}},__vite__mapDeps([12,9,4,5,13,10,14])),{CategoryAxisAm5:a,AxisRendererXAm5:s,ValueAxisAm5:c,AxisRendererYAm5:l,LineSeriesAm5:u}=await o(async()=>{let{CategoryAxisAm5:e,AxisRendererXAm5:t,ValueAxisAm5:n,AxisRendererYAm5:r,LineSeriesAm5:i}=await import(`./xyChart-BrTGr9LT.js`);return{CategoryAxisAm5:e,AxisRendererXAm5:t,ValueAxisAm5:n,AxisRendererYAm5:r,LineSeriesAm5:i}},__vite__mapDeps([17,4,5,9,13,16,14,11])),{root:d,mediaInfo:f}=t,{value:p,title:m}=f;e.setAll({wheelX:`panX`,wheelY:`zoomX`});let h=e.xAxes.push(a.new(d,{renderer:s.new(d,{inversed:_e(this.container)}),categoryField:U}));h.get(`renderer`).labels.template.setAll({forceHidden:!0});let g=e.yAxes.push(c.new(d,{renderer:l.new(d,{inside:!1}),min:this._getMinSeriesValue(p.series)}));g.get(`renderer`).labels.template.setAll({direction:this._getDirection()});let _=n[0]?.lineSettings?.stroke,v=r.new(d,{getFillFromSprite:!_,labelText:`{categoryX}`});_&&v.get(`background`)?.setAll({fill:_});let y=e.series.push(u.new(d,{name:m,xAxis:h,yAxis:g,valueYField:pn,categoryXField:U,tooltip:v}));y.strokes.template.setAll({templateField:`lineSettings`}),await this._customizeChartTooltip(v,`vertical`),p.series.length>fn&&e.set(`scrollbarX`,i.new(d,{orientation:`horizontal`})),h.data.setAll(n),y.data.setAll(n),await y.appear(this._getChartSeriesAnimationMS()),await e.appear(this._getChartAnimationMS())}async _createXYChart(e,t){let{XYChartAm5:n,XYCursorAm5:r}=await o(async()=>{let{XYChartAm5:e,XYCursorAm5:t}=await import(`./xyChart-BrTGr9LT.js`);return{XYChartAm5:e,XYCursorAm5:t}},__vite__mapDeps([17,4,5,9,13,16,14,11])),{root:i,mediaInfo:a}=e,{type:s}=a,c=a?.altText||a?.title||``,l=i.container.children.push(n.new(i,{ariaLabel:c,focusable:!0,panX:!0,panY:!0}));l.set(`cursor`,r.new(i,{})),s===`column-chart`&&await this._createColumnChart(l,e,t),s===`bar-chart`&&await this._createBarChart(l,e,t),s===`line-chart`&&await this._createLineChart(l,e,t),l.root.dom.classList.toggle(H.mediaChartRendered,!0)}_clearMediaRefreshTimer(){let{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){let t=Date.now();this._refreshIntervalInfo={timestamp:t,sourceURL:e&&this._getImageSource(e,t)}}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();let{activeMediaInfo:e}=this.viewModel;e?.type===`image`&&e?.refreshInterval>0&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){let{refreshInterval:t,value:n}=e,r=6e4*t;this._updateMediaInfoTimestamp(n.sourceURL),this._refreshTimer=setInterval(()=>{this._updateMediaInfoTimestamp(n.sourceURL)},r)}_getImageSource(e,t){let n=e.includes(`?`)?`&`:`?`,[r,i=``]=e.split(`#`);return`${r}${n}timestamp=${t}${i?`#`:``}${i}`}};r([m()],W.prototype,`_refreshIntervalInfo`,void 0),r([m()],W.prototype,`attributes`,null),r([m()],W.prototype,`activeMediaInfoIndex`,null),r([m()],W.prototype,`description`,null),r([m()],W.prototype,`fieldInfoMap`,null),r([m()],W.prototype,`layer`,null),r([m()],W.prototype,`mediaInfos`,null),r([m()],W.prototype,`popupTemplate`,null),r([m()],W.prototype,`relatedInfos`,null),r([m()],W.prototype,`title`,null),r([m({type:B})],W.prototype,`viewModel`,void 0),r([m(),E(`esri/widgets/Feature/t9n/Feature`)],W.prototype,`messages`,void 0),W=r([T(`esri.widgets.Feature.FeatureMedia`)],W);var vn=`esri.widgets.Feature.support.arcadeFeatureUtils`,yn=()=>Me.getLogger(vn);function bn(e){return st(at(e))}function xn(e){return`createQuery`in e&&`queryFeatures`in e}async function Sn({graphic:e,view:t,options:n}){let{isAggregate:r}=e,i=e.layer??e.sourceLayer;if(!r||!i||t?.type!==`2d`)return[];let a=await t.whenLayerView(i);if(!xn(a))return[];let o=a.createQuery(),s=e.getObjectId();o.aggregateIds=s==null?[]:[s];let{features:c}=await a.queryFeatures(o,n);return c}function Cn({layer:e,aggregatedFeatures:t,interceptor:n}){let{fields:r,objectIdField:i,geometryType:a,spatialReference:o}=e,s=`displayField`in e?e.displayField:void 0;return new u({fields:r,objectIdField:i,geometryType:a,spatialReference:o,displayField:s,interceptor:n,...e.type===`feature`?{templates:e.templates,typeIdField:e.typeIdField,types:e.types}:null,source:t})}function wn(e){return e.isAggregate?`popup-feature-reduction`:e.declaredClass===`esri.views.3d.layers.VoxelGraphic`?`popup-voxel`:Je(e.origin)||Ye(e.origin)?`popup-imagery`:`popup`}function Tn(e){return{scale:e?.scale,timeProperties:{currentStart:e?.timeExtent?.start,currentEnd:e?.timeExtent?.end,startIncluded:!0,endIncluded:!0}}}function En(e){return{$voxel:e}}function Dn(e){let t=null;if(e.origin.layer.fields?.length>0){t=e.cloneShallow();let n=e.origin.layer.fieldsIndex;t.attributes=Object.fromEntries(Object.entries(t.attributes??{}).filter(([e])=>n.has(e)))}return{$pixel:e,$imageCollectionItem:t}}async function On(e,t,n,r,i,a,o){let s=null;if(a.has(`$aggregatedfeatures`)){let e=await Sn({graphic:t,view:n,options:r}),a=t.sourceLayer||t.layer;s=Cn({layer:a,aggregatedFeatures:e,interceptor:i})}return{vars:{$feature:t,$aggregatedFeatures:s,$view:Tn(n)},track:o?await An(e,t,n):null,[Symbol.dispose]:()=>s?.[Symbol.dispose]()}}function kn(e){if(de(e))return e.getTime();if(typeof e==`number`)return e;if(typeof e==`string`)return new Date(e).getTime();throw Error(`Unexpected time value: ${e}`)}async function An(e,t,n){let r=t.sourceLayer||t.layer;if(r==null||!(`timeInfo`in r))return null;let i=r.timeInfo?.trackIdField;if(i==null)return null;let a=t.getAttribute(i);if(a==null)return null;let o,s;if(typeof a==`string`)o=`"${i.replaceAll(`"`,`""`)}" = '${a.replaceAll(`'`,`''`)}'`;else{if(typeof a!=`number`)return yn().warn(`Expected track id to be a string or number`),null;o=`"${i.replaceAll(`"`,`""`)}" = ${a}`}if(r.type===`stream`&&n!=null){let e=await n.whenLayerView(r),t=e.createQuery();t.returnGeometry=!0,t.where=He(t.where,o),s=(await e.queryFeatures(t)).features}else{if(!(`queryFeatures`in r))return null;{let e=r.createQuery();e.returnGeometry=!0,e.where=He(e.where,o),s=(await r.queryFeatures(e)).features}}let c=r.fieldsIndex.normalizeFieldName(r.timeInfo.startField)??`__esri_time_received__`,l=r.timeInfo.endField?r.fieldsIndex.normalizeFieldName(r.timeInfo.endField):null,u=s.map(t=>{let r=t.getObjectId();if(r==null)throw Error(`Cannot identify observation`);let i=e.ArcadeFeature.createFromGraphic(t,n?.timeZone),a=kn(t.getAttribute(c));return{id:r,feature:i,startTime:a,endTime:l==null?a:kn(t.getAttribute(l)),stats:{totalDistance:void 0,distance:void 0,speed:void 0,acceleration:void 0}}}).sort((e,t)=>e.startTime-t.startTime),d=t.declaredClass===`esri.TrackGraphic`?u.length-1:u.findIndex(e=>t.getObjectId()===e.id);if(d<0)throw Error(`Couldn't locate feature in observations`);return{observations:u,currentObservationIndex:d}}async function jn(e,t,n,r,i,a){let o=(t.sourceLayer||t.layer)??void 0;return{vars:{$feature:t,$layer:o!=null&&Ge(o)?o:o?.type===`scene`&&o.associatedLayer!=null?o.associatedLayer:void 0,$map:n,$datastore:o&&`url`in o?o.url:void 0,$userInput:r,$graph:o?.type===`knowledge-graph-sublayer`?o.parentCompositeLayer?.knowledgeGraph:void 0,$view:Tn(i)},track:a?await An(e,t,i):null}}async function Mn(e,{arcade:t,graphic:n,map:r,location:i,view:a,options:o,interceptor:s,arcadeExecutor:c,usesTrack:l}){switch(e){case`popup`:return{...await jn(t,n,r,i,a,l),[Symbol.dispose](){}};case`popup-feature-reduction`:{let e=new Set(c.variablesUsed);return await On(t,n,a,o,s,e,l)}case`popup-voxel`:return{vars:En(n),track:null,[Symbol.dispose](){}};case`popup-imagery`:return{vars:Dn(n),track:null,[Symbol.dispose](){}};default:throw Error(`Unexpected profile name ${e}`)}}async function Nn(){let[e,t,{Feature:n}]=await Promise.all([o(()=>import(`./arcade-Cn2FEmgE.js`),__vite__mapDeps([18,4,5,19,20])),o(()=>import(`./arcade-B_QRF6lE.js`),__vite__mapDeps([21,22,4,5,19,23,24,25,26,27,28,29,30,31,32,33,20,34,35,36,37,38,39,40,41,42])),o(()=>import(`./Feature-B5STg1Ce.js`),__vite__mapDeps([43,22,4,5,19,23,24,28,29,30,31,32,33]))]);return{executor:e,syntaxUtils:t,ArcadeFeature:n}}async function Pn(e,t,n){let{executor:{createArcadeProfile:r,createArcadeExecutor:i},syntaxUtils:a}=n,o=wn(t),s=r(o),c;try{c=await i(e,s)}catch(t){return yn().error(`arcade-executor-error`,{error:t,expression:e}),null}let l=new Set;c.variablesUsed.includes(`$view`)&&(a.scriptUsesViewProperties(c.syntaxTree,[`scale`])&&l.add(`view-scale`),a.scriptUsesViewProperties(c.syntaxTree,[`timeProperties`])&&l.add(`view-time-extent`));let u=a.scriptUsesTrack(c.syntaxTree);return{dependencies:l,async evaluate({graphic:t,interceptor:r,location:i,map:a,options:s,spatialReference:l,view:d}){let f={stack:[],error:void 0,hasError:!1};try{let p=Re(f,await Mn(o,{arcade:n,graphic:t,map:a,location:i,view:d,options:s,interceptor:r,arcadeExecutor:c,usesTrack:u}),!1),m={abortSignal:s?.signal??void 0,interceptor:r??void 0,rawOutput:!0,spatialReference:l??void 0,timeZone:d?.timeZone,track:p.track,console(...e){yn().info(...e)}};try{return await c.executeAsync(p.vars,m)}catch(n){if(s?.signal?.aborted)return;yn().error(`arcade-execution-error`,{error:n,graphic:t,expression:e});return}}catch(e){f.error=e,f.hasError=!0}finally{Pe(f)}}}}async function Fn({expression:e,graphic:t}){return e?Pn(e,t,await Nn()):null}async function In(e,t){if(!e?.length)return{dependencies:new Set,expressions:new Map};let n=await Nn(),r=new Set,i=new Map;for(let a of e){let e=await Pn(a.expression,t,n);i.set(`expression/${a.name}`,e),e?.dependencies.forEach(e=>r.add(e))}return{dependencies:r,expressions:i}}var Ln=1,G=class extends h{constructor(e){super(e),this._compileTask=null,this._evaluateTask=null,this.expressionInfo=null,this.graphic=null,this.contentElementViewModel=null,this.interceptor=null,this.location=null,this.view=null,this._createVM=()=>{let e=this.contentElement?.type;this.contentElementViewModel?.destroy();let t=e===`fields`?new R:e===`media`?new B:e===`text`?new I:null;this._set(`contentElementViewModel`,t)},this._compileThrottled=Ze(this._startCompile,()=>this.notifyChange(`state`),Ln,this),this._evaluateThrottled=Ze(this._startEvaluate,()=>this.notifyChange(`state`),Ln,this),this.addHandles([f(()=>[this.expressionInfo,this.graphic],()=>this._compileThrottled(),b),f(()=>[this.contentElement],()=>this._createVM(),b),ee(()=>{if(!this._compileTask?.finished)return null;let e=this._compileTask.value,t=e?.dependencies;return[e,this.spatialReference,this.map,this.view,t?.has(`view-scale`)?this.view?.scale:null,t?.has(`view-time-extent`)?this.view?.timeExtent?.start:null,t?.has(`view-time-extent`)?this.view?.timeExtent?.end:null]},([e])=>this._evaluateThrottled(e))])}initialize(){this.addHandles([this._compileThrottled,this._evaluateThrottled])}destroy(){this._compileTask=S(this._compileTask),this._evaluateTask=S(this._evaluateTask),this.contentElementViewModel?.destroy(),this._set(`contentElementViewModel`,null)}get contentElement(){return this._evaluateTask?.value}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(e){this._override(`spatialReference`,e)}get state(){let{contentElement:e,contentElementViewModel:t}=this;return this._compileThrottled.hasPendingUpdates()||this._evaluateThrottled.hasPendingUpdates()||!this._compileTask?.finished||!this._evaluateTask?.finished?`loading`:e||t?`ready`:`disabled`}get map(){return this.view?.map??null}set map(e){this._override(`map`,e)}_startCompile(){this._evaluateTask=S(this._evaluateTask),this._compileTask=S(this._compileTask),this._compileTask=me(async e=>{let{expressionInfo:t,graphic:n}=this,r=t?.expression;if(!r||!n)return null;let i=await Fn({expression:r,graphic:n});return ge(e),i})}_startEvaluate(e){this._evaluateTask=S(this._evaluateTask),this._evaluateTask=me(async t=>{let{graphic:n}=this;if(!e||!n)return null;let{interceptor:r,spatialReference:i,map:a,location:o,view:s}=this,c=await e.evaluate({graphic:n,interceptor:r,location:o,map:a,options:{signal:t},spatialReference:i,view:s});ge(t);let l=c;if(!l||l.declaredClass!==`esri.arcade.Dictionary`)return null;let u=await l.castAsJsonAsync(t);ge(t);let d=u?.type,f=d===`media`?_.fromJSON(u):d===`text`?Be.fromJSON(u):d===`fields`?Le.fromJSON(u):null;return f.type===`media`&&!f.mediaInfos||f.type===`fields`&&!f.fieldInfos||f.type===`text`&&!f.text?null:f})}};r([m()],G.prototype,`_compileTask`,void 0),r([m()],G.prototype,`_evaluateTask`,void 0),r([m({type:ye})],G.prototype,`expressionInfo`,void 0),r([m({type:d})],G.prototype,`graphic`,void 0),r([m({readOnly:!0})],G.prototype,`contentElement`,null),r([m({readOnly:!0})],G.prototype,`contentElementViewModel`,void 0),r([m()],G.prototype,`interceptor`,void 0),r([m({type:t})],G.prototype,`location`,void 0),r([m()],G.prototype,`spatialReference`,null),r([m({readOnly:!0})],G.prototype,`state`,null),r([m()],G.prototype,`map`,null),r([m()],G.prototype,`view`,void 0),G=r([T(`esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel`)],G);var Rn=`esri-feature`,zn={base:`${Rn}-expression`,loadingSpinnerContainer:`${Rn}__loading-container`},Bn=class extends C{constructor(e,t){super(e,t),this._contentWidget=null,this.viewModel=new G}initialize(){this.addHandles(f(()=>this.viewModel?.contentElementViewModel,()=>this._setupExpressionWidget(),b))}loadDependencies(){return se({loader:()=>o(()=>import(`./calcite-loader-BQ1zV8tb.js`),__vite__mapDeps([44,45,4,5,2,46,47]))})}destroy(){this._destroyContentWidget()}render(){let{state:e}=this.viewModel;return D(`div`,{class:zn.base},e===`loading`?this._renderLoading():e===`disabled`?null:this._contentWidget?.render())}_renderLoading(){return D(`div`,{class:zn.loadingSpinnerContainer,key:`loading-container`},D(`calcite-loader`,{inline:!0,label:``}))}_destroyContentWidget(){let{_contentWidget:e}=this;e&&(e.viewModel=null,e.destroy()),this._contentWidget=null}_setupExpressionWidget(){let{contentElementViewModel:e,contentElement:t}=this.viewModel,n=t?.type;this._destroyContentWidget(),this._contentWidget=e?n===`fields`?new z({viewModel:e}):n===`media`?new W({viewModel:e}):n===`text`?new L({viewModel:e}):null:null,this.scheduleRender()}};r([m({type:G})],Bn.prototype,`viewModel`,void 0),Bn=r([T(`esri.widgets.Feature.FeatureExpression`)],Bn);var Vn=e=>{let t=[];if(e.formTemplate){let{description:n,title:r}=e.formTemplate;e.fields?.forEach(e=>{let i=r&&ze(r,e.name),a=n&&ze(n,e.name);(i||a)&&t.push(e.name)})}return t},Hn=100,K=class extends We(Ue(h)){constructor(e){super(e),this._loaded=!1,this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.featuresPerPage=10,this.activeCategory=null,this.allCategories=null,this.description=null,this.graphic=null,this.layer=null,this.map=null,this.orderByFields=null,this.featureCount=0,this.relationshipId=null,this.showAllEnabled=!1,this.title=null,this._cancelQuery=()=>{let{_queryAbortController:e}=this;e&&e.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{let{_queryFeatureCountAbortController:e}=this;e&&e.abort(),this._queryFeatureCountAbortController=null},this._cancelQueryPage=()=>{let{_queryPageAbortController:e}=this;e&&e.abort(),this._queryPageAbortController=null},this._queryController=async()=>{this._cancelQuery();let e=new AbortController;this._queryAbortController=e,await Ae(this._query()),this._queryAbortController===e&&(this._queryAbortController=null)},this._queryFeatureCountController=async()=>{this._loaded=!1,this._cancelQueryFeatureCount();let e=new AbortController;this._queryFeatureCountAbortController=e,await Ae(this._queryFeatureCount()),this._queryFeatureCountAbortController===e&&(this._queryFeatureCountAbortController=null),this._loaded=!0},this._queryPageController=async()=>{let e=new AbortController;this._queryPageAbortController=e,await Ae(this._queryPage()),this._queryPageAbortController===e&&(this._queryPageAbortController=null)},this._queryDebounced=p(this._queryController,Hn),this._queryFeatureCountDebounced=p(this._queryFeatureCountController,Hn),this._queryPageDebounced=p(this._queryPageController,Hn),this._query=async()=>{let{_queryAbortController:e,relatedFeatures:t}=this;this.featureCount&&(this.relatedLayer?.type!==`subtype-group`||this.activeCategory)&&(this._destroyRelatedFeatureViewModels(),this.featurePage=1,t.destroyAll(),this.destroyed||t.addMany(this._sliceFeatures(await this._queryRelatedFeatures({signal:e?.signal}))))},this.addHandles([f(()=>[this.displayCount,this.graphic,this.layer,this.layer?.loaded,this.map,this.orderByFields,this.relationshipId,this.featuresPerPage,this.showAllEnabled,this.canQuery,this.featureCount,this.activeCategory],()=>this._queryDebounced(),b),f(()=>[this.featurePage,this.showAllEnabled],()=>this._queryPageDebounced()),f(()=>[this.layer,this.relationshipId,this.objectId,this.canQuery,this.activeCategory],()=>this._queryFeatureCountDebounced())])}destroy(){this._destroyRelatedFeatureViewModels(),this.relatedFeatures.destroyAll(),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage()}set featurePage(e){let{featuresPerPage:t,featureCount:n}=this,r=Math.ceil(n/t)||1;this._set(`featurePage`,Math.min(Math.max(e,1),r))}get featurePage(){return this._get(`featurePage`)}get orderByFieldsFixedCasing(){let{orderByFields:e,relatedLayer:t}=this;return e&&t?.loaded?e.map(e=>{let n=e.clone();return n.field=tt(e.field,t),n}):e??[]}get supportsCacheHint(){return!!this.layer?.capabilities?.queryRelated?.supportsCacheHint}get canLoad(){return!!this.map&&this.relationshipId!=null&&typeof this.objectId==`number`}get canQuery(){let e=this.layer?.capabilities?.queryRelated;return!!(this.relatedLayer&&this.relationship&&this.relationshipId!=null&&this.objectId!=null&&e?.supportsCount&&e?.supportsPagination)}get allCategoriesCount(){return this.allCategories?.length??0}get categories(){let{allCategories:e}=this;return this.showAllEnabled?e:e?.slice(0,this.displayCount)??null}set displayCount(e){this._set(`displayCount`,Math.min(Math.max(e??3,0),10))}get displayCount(){return this._get(`displayCount`)}get itemDescriptionFieldName(){return this.orderByFieldsFixedCasing[0]?.field||null}get objectId(){return(this.objectIdField&&this.graphic?.attributes?.[this.objectIdField])??null}get objectIdField(){return this.layer?.objectIdField||null}get relatedFeatures(){return this._get(`relatedFeatures`)||new g}get relatedLayer(){let{layer:e,map:t,relationship:n}=this;if(!e?.loaded||!t||!n)return null;let r=e.type===`subtype-sublayer`&&e.parent&&ht(e.parent)?e.parent:e;return ut(t,r,n)??null}get relatedLayerKeyField(){let{relatedLayer:e,relationshipId:t}=this;return e?.loaded&&t!=null?e.relationships?.find(e=>e.id===t)?.keyField:null}get relatedLayerKeyFields(){let{relatedLayer:e}=this;return e?.loaded?e.relationships?.map(e=>e.keyField).filter(we)??[]:[]}get relationship(){let{relationshipId:e,layer:t}=this;return e!=null&&t?.loaded?t.relationships?.find(({id:t})=>t===e)??null:null}get relationshipKey(){let{relationshipKeyField:e}=this;return(e&&this.graphic?.attributes?.[e])??null}get relationshipKeyField(){return this.relationship?.keyField||null}get relatedFeatureViewModels(){return this._get(`relatedFeatureViewModels`)||new g}get state(){let{_queryAbortController:e,_queryFeatureCountAbortController:t,_queryPageAbortController:n,canQuery:r,_loaded:i,canLoad:a}=this;return t||a&&!i?`loading`:e||n?`querying`:r?`ready`:`disabled`}getRelatedFeatureByObjectId(e){return this.relatedFeatures.find(t=>t.getObjectId()===e)}refresh(){this._queryFeatureCountDebounced()}_destroyRelatedFeatureViewModels(){this.relatedFeatureViewModels?.destroyAll()}async _queryFeatureCount(){let{layer:e,relatedLayer:t}=this;await e?.load(),await t?.load();let{_queryFeatureCountAbortController:n,activeCategory:r,canQuery:i,objectId:a,relatedLayerKeyField:s,relationshipId:l,relationshipKey:u,supportsCacheHint:d}=this;if(!i||!e||!t||a==null)return this._set(`featureCount`,0),void this._set(`allCategories`,null);if(t?.type===`subtype-group`&&!r){if(this._set(`featureCount`,0),this._destroyRelatedFeatureViewModels(),this.featurePage=1,this.relatedFeatures.destroyAll(),s&&u!=null){let{default:e}=await o(async()=>{let{default:e}=await import(`./uniqueValues-BwDIZ6wg.js`);return{default:e}},__vite__mapDeps([48,4,5,31,49,50,30,32,33,51,29,52,53,54,55,56,57,58,59,60,61,62,63,64,65])),{uniqueValueInfos:r}=await e({layer:t,sqlWhere:`${s} = '${u}'`,field:t.subtypeField,signal:n?.signal}),i=r.map(({count:e,value:n})=>{let r=t.subtypes?.find(e=>e.code===n)?.name;return n!=null&&r?{count:e,value:n,name:r}:void 0}).filter(we);this._set(`allCategories`,i)}return}let{historicMoment:f,gdbVersion:p}=e,m=new c({cacheHint:d,gdbVersion:p,historicMoment:f,relationshipId:l,returnGeometry:!1,objectIds:[a],where:this._getRelationshipWhereClause(t)}),h=await e.queryRelatedFeaturesCount(m,{signal:n?.signal});this._set(`allCategories`,null),this._set(`featureCount`,h[a]||0)}_getRelationshipWhereClause(e){let{activeCategory:t}=this,n=e.createQuery(),r=`subtypeField`in e?e.subtypeField:void 0,i=t&&r?`${r} = ${t.value}`:void 0,a=n.where;return a&&i?`(${a}) AND (${i})`:a??i}_sliceFeatures(e){let{showAllEnabled:t,displayCount:n}=this;return t?e:n?e.slice(0,n):[]}async _queryPage(){let{relatedFeatures:e,featurePage:t,showAllEnabled:n,_queryPageAbortController:r,featureCount:i}=this;!n||t<2||!i||this.relatedLayer?.type===`subtype-group`&&!this.activeCategory||e.addMany(await this._queryRelatedFeatures({signal:r?.signal}))}async _queryRelatedFeatures(e){let{displayCount:t,featureCount:n,featurePage:r,featuresPerPage:i,layer:a,orderByFieldsFixedCasing:o,relatedLayer:s,relatedLayerKeyFields:l,relationshipId:u,showAllEnabled:d,supportsCacheHint:f}=this,{canQuery:p,objectId:m}=this;if(!p||!a||!s||m==null)return[];let h=d?((r-1)*i+n)%n:0,g=d?i:t,_=s.objectIdField,v=`subtypeField`in s?s.subtypeField:void 0,y=[...o.map(e=>e.field),...Vn(s),...l,_,v].filter(Un),ee=o.map(e=>`${e.field} ${e.order}`),{historicMoment:te,gdbVersion:b}=a,ne=new c({orderByFields:ee,start:h,num:g,outFields:y,cacheHint:f,historicMoment:te,gdbVersion:b,relationshipId:u,returnGeometry:!1,objectIds:[m],where:this._getRelationshipWhereClause(s)}),re=(await a.queryRelatedFeatures(ne,{signal:e?.signal}))[m]?.features||[];return s.type===`subtype-group`&&v?re.forEach(e=>{let t=e.attributes[v],n=s.findSublayerForSubtypeCode?.(t);e.sourceLayer=n,e.layer=n}):re.forEach(e=>{e.sourceLayer=s,e.layer=s}),re}};function Un(e){return e!=null&&e!==``}r([m()],K.prototype,`_loaded`,void 0),r([m()],K.prototype,`_queryAbortController`,void 0),r([m()],K.prototype,`_queryPageAbortController`,void 0),r([m()],K.prototype,`_queryFeatureCountAbortController`,void 0),r([m({value:1})],K.prototype,`featurePage`,null),r([m()],K.prototype,`featuresPerPage`,void 0),r([m({readOnly:!0})],K.prototype,`orderByFieldsFixedCasing`,null),r([m({readOnly:!0})],K.prototype,`supportsCacheHint`,null),r([m({readOnly:!0})],K.prototype,`canLoad`,null),r([m({readOnly:!0})],K.prototype,`canQuery`,null),r([m()],K.prototype,`activeCategory`,void 0),r([m({readOnly:!0})],K.prototype,`allCategories`,void 0),r([m({readOnly:!0})],K.prototype,`allCategoriesCount`,null),r([m({readOnly:!0})],K.prototype,`categories`,null),r([m()],K.prototype,`description`,void 0),r([m({value:3})],K.prototype,`displayCount`,null),r([m({type:d})],K.prototype,`graphic`,void 0),r([m({readOnly:!0})],K.prototype,`itemDescriptionFieldName`,null),r([m()],K.prototype,`layer`,void 0),r([m()],K.prototype,`map`,void 0),r([m({readOnly:!0})],K.prototype,`objectId`,null),r([m({readOnly:!0})],K.prototype,`objectIdField`,null),r([m()],K.prototype,`orderByFields`,void 0),r([m({readOnly:!0})],K.prototype,`relatedFeatures`,null),r([m({readOnly:!0})],K.prototype,`relatedLayer`,null),r([m({readOnly:!0})],K.prototype,`relatedLayerKeyField`,null),r([m({readOnly:!0})],K.prototype,`relatedLayerKeyFields`,null),r([m({readOnly:!0})],K.prototype,`relationship`,null),r([m({readOnly:!0})],K.prototype,`relationshipKey`,null),r([m({readOnly:!0})],K.prototype,`relationshipKeyField`,null),r([m({readOnly:!0})],K.prototype,`featureCount`,void 0),r([m({readOnly:!0})],K.prototype,`relatedFeatureViewModels`,null),r([m()],K.prototype,`relationshipId`,void 0),r([m()],K.prototype,`showAllEnabled`,void 0),r([m()],K.prototype,`state`,null),r([m()],K.prototype,`title`,void 0),K=r([T(`esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel`)],K);var Wn,Gn=`esri-feature`,Kn=`${Gn}-relationship`,q={base:Kn,listContainer:`${Kn}__list`,listItem:`${Kn}__list-item`,listItemHidden:`${Kn}__list-item--hidden`,listContainerQuerying:`${Kn}__list--querying`,featureObserver:`${Gn}__feature-observer`,stickySpinnerContainer:`${Gn}__sticky-loading-container`,loadingSpinnerContainer:`${Gn}__loading-container`},qn={title:!0,description:!0},J=Wn=class extends C{constructor(e,t){super(e,t),this._featureElementInfo=null,this._relatedFeatureIntersectionObserverNode=null,this._relatedFeatureIntersectionObserver=new IntersectionObserver(([e])=>{e?.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this.flowItems=null,this.flowType=`feature-relationship`,this.headingLevel=2,this.viewModel=new K,this.messages=null,this.messagesCommon=null,this.visibleElements={...qn},this._increaseFeaturePage=()=>{let{state:e,showAllEnabled:t,relatedFeatures:n,featuresPerPage:r,featurePage:i}=this.viewModel;e===`ready`&&t&&n.length>=r*i&&this.viewModel.featurePage++}}initialize(){this._featureElementInfo=new P,this.addHandles([f(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),b),f(()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),l(()=>this.viewModel.relatedFeatureViewModels,`change`,()=>this._setupRelatedFeatureViewModels())])}loadDependencies(){return se({chip:()=>o(()=>import(`./calcite-chip-DHdJ6msM.js`),__vite__mapDeps([66,4,5,45,67,1,2,68,69,3,6,46,7])),icon:()=>o(()=>import(`./calcite-icon-D_iKcGa4.js`),__vite__mapDeps([0,1,2,3,4,5,6,7])),list:()=>o(()=>import(`./calcite-list-CgWjPxHf.js`),__vite__mapDeps([70,4,5,45,71,67,1,72,68,69,73,46,74,75,2,3,6,76,77,7,78,47,79,80,81])),"list-item":()=>o(()=>import(`./calcite-list-item-BNrqiIAE.js`),__vite__mapDeps([82,4,5,45,67,1,83,84,81,72,2,68,69,3,6,85,86,87,46,77,88,74,89,90,91,7,47])),loader:()=>o(()=>import(`./calcite-loader-BQ1zV8tb.js`),__vite__mapDeps([44,45,4,5,2,46,47])),notice:()=>o(()=>import(`./calcite-notice-CvAfSaDY.js`),__vite__mapDeps([92,4,5,45,67,1,2,3,6,85,46,7]))})}destroy(){this._unobserveRelatedFeatureObserver(),this._featureElementInfo=Se(this._featureElementInfo)}get displayShowAllButton(){let{showAllEnabled:e,featureCount:t,displayCount:n,state:r,allCategoriesCount:i}=this.viewModel;return!e&&r===`ready`&&(!!i&&(i>n||n===0)||!!t&&(t>n||n===0))}get displayListItems(){let{relatedFeatureViewModels:e,allCategoriesCount:t}=this.viewModel;return this.displayShowAllButton||!!e.length||!!t}get allItemsDescription(){let{messages:e}=this,{featureCount:t,allCategories:n,allCategoriesCount:r}=this.viewModel;return ie(e?.numberRecords,{number:ne(n?r:t)})}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get title(){let{activeCategory:e,title:t}=this.viewModel;return e?.name??t}set title(e){this.viewModel.title=e}castVisibleElements(e){return{...qn,...e}}render(){let{state:e}=this.viewModel;return D(`div`,{class:this.classes(q.base,w.widget)},this._featureElementInfo?.render(),e===`loading`?this._renderLoading():e===`disabled`?this._renderRelationshipNotFound():this._renderRelatedFeatures())}_selectCategory(e){let{flowItems:t,featureVisibleElements:n,viewModel:r}=this;t&&(r.activeCategory=e,r.showAllEnabled=!0,t.push(new Wn({flowItems:t,featureVisibleElements:n,visibleElements:{title:!1,description:!1},viewModel:r})))}async _selectRecord(e){let{flowItems:t,featureVisibleElements:n}=this;if(!t)return;e.abilities={relationshipContent:!0};let{default:r}=await o(async()=>{let{default:e}=await import(`./Feature-CglJwaNJ.js`);return{default:e}},__vite__mapDeps([93,23,4,5,31,49,94,95,96,97,98,30,32,33,99,38,100,64,101,102,103,52,53,54,55,56,104,105]));t.push(new r({flowItems:t,flowType:this.flowType,viewModel:e,visibleElements:n}))}_showAllRecords(){let{flowItems:e}=this;if(!e)return;let{viewModel:t,featureVisibleElements:n}=this;t.showAllEnabled=!0;let r=new Wn({flowItems:e,featureVisibleElements:n,visibleElements:{title:!1,description:!1},viewModel:t});e.push(r)}_renderStickyLoading(){return this.viewModel.state===`querying`?D(`div`,{class:q.stickySpinnerContainer,key:`sticky-loader`},this._renderLoadingIcon()):null}_renderLoadingIcon(){return D(`calcite-loader`,{inline:!0,label:``})}_renderLoading(){return D(`div`,{class:q.loadingSpinnerContainer,key:`loading-container`},this._renderLoadingIcon())}_renderShowAllIconNode(){return D(`calcite-icon`,{icon:`list`,scale:`s`,slot:`content-end`})}_renderChevronIconNode(){let e=_e(this.container)?`chevron-left`:`chevron-right`;return D(`calcite-icon`,{icon:e,scale:`s`,slot:`content-end`})}_renderCategory(e){let{count:t,name:n,value:r}=e,i=ne(t);return D(`calcite-list-item`,{class:q.listItem,disabled:!t,key:r,label:n,onCalciteListItemSelect:()=>this._selectCategory(e)},D(`calcite-chip`,{label:i,scale:`s`,slot:`content-end`},i),this._renderChevronIconNode())}_renderRelatedFeature(e){let{itemDescriptionFieldName:t}=this.viewModel,n=e.title;e.description=t&&e.formattedAttributes?.global[t];let r=e.state===`loading`;return D(`calcite-list-item`,{class:this.classes(q.listItem,{[q.listItemHidden]:r}),description:Ve(e.description??``),key:e.uid,label:Ve(n),onCalciteListItemSelect:()=>this._selectRecord(e)},this._renderChevronIconNode())}_renderShowAllListItem(){return this.displayShowAllButton?D(`calcite-list-item`,{description:this.allItemsDescription,key:`show-all-item`,label:this.messages?.showAll,onCalciteListItemSelect:()=>this._showAllRecords()},this._renderShowAllIconNode()):null}_renderNoRelatedFeaturesMessage(){return D(`calcite-notice`,{icon:`information`,key:`no-related-features-message`,kind:`brand`,open:!0,scale:`s`,width:`full`},D(`div`,{slot:`message`},this.messages?.noRelatedFeatures))}_renderFeatureObserver(){return D(`div`,{afterCreate:this._relatedFeatureIntersectionObserverCreated,bind:this,class:q.featureObserver,key:`feature-observer`})}_renderList(){let{relatedFeatureViewModels:e,categories:t}=this.viewModel;return D(`calcite-list`,{displayMode:`flat`,label:this.messages?.relatedFeaturesList},t?.map(e=>this._renderCategory(e))??e.toArray().map(e=>this._renderRelatedFeature(e)),this._renderShowAllListItem())}_renderRelatedFeatures(){let{displayListItems:e}=this,{state:t}=this.viewModel;return D(`div`,{class:this.classes(q.listContainer,{[q.listContainerQuerying]:t===`querying`}),key:`list-container`},e?this._renderList():t===`ready`?this._renderNoRelatedFeaturesMessage():null,this._renderStickyLoading(),this._renderFeatureObserver())}_renderRelationshipNotFound(){return D(`calcite-notice`,{icon:`exclamation-mark-triangle`,key:`relationship-not-found`,kind:`danger`,open:!0,scale:`s`,width:`full`},D(`div`,{slot:`message`},this.messages?.relationshipNotFound))}_setupRelatedFeatureViewModels(){let{relatedFeatureViewModels:e}=this.viewModel,t=`related-feature-viewmodels`;this.removeHandles(t),e?.forEach(e=>{this.addHandles(f(()=>[e.title,e.state],()=>this.scheduleRender(),b),t)}),this.scheduleRender()}_setupFeatureElementInfo(){let{headingLevel:e,visibleElements:t}=this,n=t.description&&this.description,r=t.title&&this.title;this._featureElementInfo?.set({description:n,title:r,headingLevel:e})}async _handleRelatedFeatureObserverChange(){this._unobserveRelatedFeatureObserver();let{state:e,showAllEnabled:t}=this.viewModel;await ae(0),this._relatedFeatureIntersectionObserverNode&&e===`ready`&&t&&this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode)}_relatedFeatureIntersectionObserverCreated(e){this._relatedFeatureIntersectionObserverNode=e}_unobserveRelatedFeatureObserver(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}};r([m()],J.prototype,`_relatedFeatureIntersectionObserverNode`,void 0),r([m({readOnly:!0})],J.prototype,`displayShowAllButton`,null),r([m({readOnly:!0})],J.prototype,`displayListItems`,null),r([m({readOnly:!0})],J.prototype,`allItemsDescription`,null),r([m()],J.prototype,`description`,null),r([m()],J.prototype,`featureVisibleElements`,void 0),r([m()],J.prototype,`flowItems`,void 0),r([m()],J.prototype,`flowType`,void 0),r([m()],J.prototype,`headingLevel`,void 0),r([m()],J.prototype,`title`,null),r([m({type:K})],J.prototype,`viewModel`,void 0),r([m(),E(`esri/widgets/Feature/t9n/Feature`)],J.prototype,`messages`,void 0),r([m(),E(`esri/t9n/common`)],J.prototype,`messagesCommon`,void 0),r([m()],J.prototype,`visibleElements`,void 0),r([n(`visibleElements`)],J.prototype,`castVisibleElements`,null),J=Wn=r([T(`esri.widgets.Feature.FeatureRelationship`)],J);var Jn=`esri-feature-utility-network-associations`,Yn=`${Jn}__loading-container`,Xn={base:Jn,listContainer:`${Jn}__list`,loadingContainer:Yn,loadingContainerSticky:`${Yn}--sticky`},Y=class extends C{constructor(e,t){super(e,t),this._featureElementInfo=null,this.onSelectAssociationType=()=>{},this.flowType=`feature-utility-network-associations`,this.flowItems=null,this.parentFeatureViewModel=null,this.headingLevel=5,this.viewModel=new Dt,this.messages=null,this.messagesCommon=null,this.visibleElements=new Et}initialize(){this._featureElementInfo=new P,this.addHandles([f(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),b)])}loadDependencies(){return se({icon:()=>o(()=>import(`./calcite-icon-D_iKcGa4.js`),__vite__mapDeps([0,1,2,3,4,5,6,7])),list:()=>o(()=>import(`./calcite-list-CgWjPxHf.js`),__vite__mapDeps([70,4,5,45,71,67,1,72,68,69,73,46,74,75,2,3,6,76,77,7,78,47,79,80,81])),"list-item":()=>o(()=>import(`./calcite-list-item-BNrqiIAE.js`),__vite__mapDeps([82,4,5,45,67,1,83,84,81,72,2,68,69,3,6,85,86,87,46,77,88,74,89,90,91,7,47])),loader:()=>o(()=>import(`./calcite-loader-BQ1zV8tb.js`),__vite__mapDeps([44,45,4,5,2,46,47])),notice:()=>o(()=>import(`./calcite-notice-CvAfSaDY.js`),__vite__mapDeps([92,4,5,45,67,1,2,3,6,85,46,7]))})}destroy(){this._featureElementInfo=Se(this._featureElementInfo)}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){let{state:e}=this.viewModel;return D(`div`,{class:this.classes(Xn.base,w.widget)},this._featureElementInfo?.render(),e===`loading`?this._renderLoading():e===`disabled`?this._renderAssociationNotFound():this._renderContent())}_renderStickyLoading(){return this.viewModel.state===`querying`?D(`div`,{class:Xn.loadingContainerSticky,key:`sticky-loader`},this._renderLoadingIcon()):null}_renderLoadingIcon(){return D(`calcite-loader`,{inline:!0,label:this.messagesCommon.loading})}_renderLoading(){return D(`div`,{class:Xn.loadingContainer,key:`loading-container`},this._renderLoadingIcon())}_renderAssociationNotFound(){return D(`calcite-notice`,{icon:`information`,key:`association-not-found`,kind:`info`,open:!0,scale:`s`,width:`full`},D(`div`,{slot:`message`},this.messages?.noAssociations))}_renderAssociationType(e){let{viewModel:t}=this,n=this._getAssociationTypeTitle(e);return D(`calcite-list-item`,{description:Ve(e.description),key:`association-type-${e.type}`,label:Ve(n),value:e.type,onCalciteListItemSelect:()=>this.onSelectAssociationType({viewModel:t,listType:e,title:n})},D(`calcite-icon`,{flipRtl:!0,icon:`chevron-right`,scale:`s`,slot:`content-end`}))}_renderAssociations(e){let{viewModel:t}=this;return t.source===`featureForm`||t.getFeatureCountForAssociationType(e.type)>0?this._renderAssociationType(e):void 0}_renderContent(){let{messages:e,viewModel:t}=this,{state:n,associationTypes:r}=t;return D(`div`,{class:Xn.listContainer,key:`list-container`},n===`ready`?D(`div`,null,D(`calcite-list`,{displayMode:`flat`,label:e?.associationsList},r.map(e=>this._renderAssociations(e)))):null,this._renderStickyLoading())}_getAssociationTypeTitle(e){let{messages:t}=this;if(e.title)return e.title;switch(e.type){case`attachment`:return t.associationsAttachments;case`connectivity`:return t.associationsConnectivity;case`structure`:return t.associationsStructure;case`content`:return t.associationsContents;case`container`:return t.associationsContainer}}_setupFeatureElementInfo(){let{headingLevel:e,visibleElements:t}=this,n=t.description&&this.description,r=t.title&&this.title;this._featureElementInfo?.set({description:n,title:r,headingLevel:e})}};r([m({constructOnly:!0})],Y.prototype,`onSelectAssociationType`,void 0),r([m()],Y.prototype,`flowType`,void 0),r([m()],Y.prototype,`flowItems`,void 0),r([m()],Y.prototype,`parentFeatureViewModel`,void 0),r([m()],Y.prototype,`featureVisibleElements`,void 0),r([m()],Y.prototype,`description`,null),r([m()],Y.prototype,`headingLevel`,void 0),r([m()],Y.prototype,`title`,null),r([m({type:Dt})],Y.prototype,`viewModel`,void 0),r([m(),E(`esri/widgets/Feature/t9n/Feature`)],Y.prototype,`messages`,void 0),r([m(),E(`esri/t9n/common`)],Y.prototype,`messagesCommon`,void 0),r([m({type:Et,nonNullable:!0})],Y.prototype,`visibleElements`,void 0),Y=r([T(`esri.widgets.Feature.FeatureUtilityNetworkAssociations`)],Y);var Zn=class{constructor(e,t){this.preLayerQueryCallback=e,this.preRequestCallback=t,this.preLayerQueryCallback||=e=>{},this.preRequestCallback||(this.preLayerQueryCallback=e=>{})}},Qn,$n=1,er=`content-view-models`,tr=`relationship-view-models`,nr=`association-view-models`,rr={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0,utilityNetworkAssociationsContent:!0},X=class extends Ue(h){static{Qn=this}constructor(e){super(e),this._error=null,this._graphicChangedTask=null,this._evaluateExpressionAttributesTask=null,this._associationVMAbortController=null,this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities={...rr},this.content=null,this.contentViewModels=[],this.description=null,this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.graphic=null,this.lastEditInfo=null,this.location=null,this.relatedInfos=new Map,this.title=``,this.view=null,this._graphicChangedThrottled=Ze(this._graphicChanged,()=>this.notifyChange(`waitingForContent`),$n,this),this._isAllowedContentType=e=>{let{abilities:t}=this;return e.type===`attachments`&&!!t.attachmentsContent||e.type===`custom`&&!!t.customContent||e.type===`fields`&&!!t.fieldsContent||e.type===`media`&&!!t.mediaContent||e.type===`text`&&!!t.textContent||e.type===`expression`&&!!t.expressionContent||e.type===`relationship`&&!!t.relationshipContent||e.type===`utility-network-associations`&&!!t.utilityNetworkAssociationsContent},this._evaluateExpressionAttributesThrottled=Ze(this._evaluateExpressionAttributes,()=>this.notifyChange(`waitingForContent`),$n,this),this.addHandles([f(()=>[this.graphic,this._effectivePopupTemplate,this.abilities,this.timeZone],()=>this._graphicChangedThrottled(),b),ee(()=>{if(!this._graphicChangedTask?.finished||this._graphicChangedTask.value==null)return null;let e=this._graphicChangedTask.value,t=e?.expressionInfos?.dependencies;return[e,t?.has(`view-scale`)?this.view?.scale:null,t?.has(`view-time-extent`)?this.view?.timeExtent?.start:null,t?.has(`view-time-extent`)?this.view?.timeExtent?.end:null]},([e])=>this._evaluateExpressionAttributesThrottled(e))])}initialize(){this.addHandles([this._graphicChangedThrottled,this._evaluateExpressionAttributesThrottled])}destroy(){this._clear(),this._graphicChangedTask=S(this._graphicChangedTask),this._evaluateExpressionAttributesTask=S(this._evaluateExpressionAttributesTask),this._error=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}static{this.interceptor=new Zn(gt,ft)}get _effectivePopupTemplate(){return this.graphic==null?null:this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled)}get _fieldInfoMap(){return et(Ct(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return $e(this.graphic)}castAbilities(e){return{...rr,...e}}get isFeatureFromTable(){return this._sourceLayer?.isTable||!1}get state(){return this.graphic?this._error?`error`:this.waitingForContent?`loading`:`ready`:`disabled`}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(e){this._override(`spatialReference`,e)}get timeZone(){return this.view?.timeZone??`system`}set timeZone(e){this._overrideIfSome(`timeZone`,e)}get map(){return this.view?.map||null}set map(e){this._override(`map`,e)}get waitingForContent(){let{_graphicChangedThrottled:e,_evaluateExpressionAttributesThrottled:t,_graphicChangedTask:n,_evaluateExpressionAttributesTask:r,_associationVMAbortController:i}=this;return e.hasPendingUpdates()||t.hasPendingUpdates()||n!=null&&!n.finished||r!=null&&!r.finished||!!i}setActiveMedia(e,t){let n=this.contentViewModels[e];n instanceof B&&n.setActiveMedia(t)}nextMedia(e){let t=this.contentViewModels[e];t instanceof B&&t.next()}previousMedia(e){let t=this.contentViewModels[e];t instanceof B&&t.previous()}async updateGeometry(){let{graphic:e,spatialReference:t,_sourceLayer:n}=this;await n?.load();let r=n?.objectIdField;if(!r||!e||!n)return;let i=e?.attributes?.[r];if(i==null)return;let a=[i];if(!e.geometry){let r=(await rt({layer:n,graphic:e,outFields:[],objectIds:a,returnGeometry:!0,spatialReference:t}))?.geometry;r&&(e.geometry=r)}}_clear(){this._set(`title`,``),this._set(`content`,null),this._set(`formattedAttributes`,null)}_graphicChanged(){this._evaluateExpressionAttributesTask=S(this._evaluateExpressionAttributesTask),this._graphicChangedTask=S(this._graphicChangedTask),this._graphicChangedTask=me(async e=>{this._error=null,this._clear();let{graphic:t}=this;try{if(!t)return null;let{_sourceLayer:n,_effectivePopupTemplate:r}=this,i=this.spatialReference;await ct({graphic:t,popupTemplate:r,layer:n,spatialReference:i},{signal:e});let[{value:a},{value:o}]=await pe([this._getContent(),this._getTitle()]),[,{value:s}]=await pe([this._checkForRelatedFeatures({signal:e}),In(r?.expressionInfos,t)]);return{expressionInfos:s,content:a,title:o}}catch(e){throw oe(e)||(this._error=e,Me.getLogger(this).error(`error`,`The popupTemplate could not be displayed for this feature.`,{error:e,graphic:t,popupTemplate:this._effectivePopupTemplate})),e}})}_compileContentElement(e,t){return e.type===`attachments`?this._compileAttachments(e,t):e.type===`custom`?this._compileCustom(e,t):e.type===`fields`?this._compileFields(e,t):e.type===`media`?this._compileMedia(e,t):e.type===`text`?this._compileText(e,t):e.type===`expression`?this._compileExpression(e,t):e.type===`relationship`?this._compileRelationship(e,t):e.type===`utility-network-associations`?this._compileUtilityNetworkAssociation(e,t):void 0}_compileContent(e){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(e)?e.filter(this._isAllowedContentType).map((e,t)=>this._compileContentElement(e,t)).filter(we):typeof e==`string`?this._compileText(new Be({text:e}),0).text:e}_destroyContentViewModels(){this.removeHandles(tr),this.removeHandles(er),this.contentViewModels.forEach(e=>e&&!e.destroyed&&e.destroy()),this._set(`contentViewModels`,[])}_matchesFeature(e,t){let n=e?.graphic?.getObjectId(),r=t?.getObjectId();return n!=null&&r!=null&&n===r}_setRelatedFeaturesViewModels({relatedFeatureViewModels:e,relatedFeatures:t,map:n}){let{view:r,spatialReference:i,timeZone:a}=this;t?.filter(Boolean).forEach(t=>{e.some(e=>this._matchesFeature(e,t))||e.add(new Qn({abilities:{relationshipContent:!1},map:n,view:r,spatialReference:i,timeZone:a,graphic:t}))}),e.forEach(n=>{t?.find(e=>this._matchesFeature(n,e))||e.remove(n)})}_setExpressionContentVM(e,t){let n=this.formattedAttributes,{contentElement:r,contentElementViewModel:i}=e,a=r?.type;i&&a&&(a===`fields`&&(this._createFieldsFormattedAttributes({contentElement:r,contentElementIndex:t,formattedAttributes:n}),i.set(this._createFieldsVMParams(r,t))),a===`media`&&(this._createMediaFormattedAttributes({contentElement:r,contentElementIndex:t,formattedAttributes:n}),i.set(this._createMediaVMParams(r,t))),a===`text`&&i.set(this._createTextVMParams(r)))}_compileRelationship(e,t){let{displayCount:n,orderByFields:r,relationshipId:i,title:a,description:o}=e,{_sourceLayer:s,graphic:c,map:u}=this;if(!ht(s))return;let d=new K({displayCount:n,graphic:c,orderByFields:r,relationshipId:i,layer:s,map:u,...this._compileTitleAndDesc({title:a,description:o})});return this.contentViewModels[t]=d,this.addHandles(l(()=>d.relatedFeatures,`change`,()=>this._setRelatedFeaturesViewModels(d)),tr),e}_matchesGlobalFeature(e,t){return e.association.equals(t.association)}_setUpUtilityNetworkAssociationsViewModels(e,t,n){let{view:r,spatialReference:i,timeZone:a}=this;e.forEach((n,r)=>{let i=t.get(r);i?n.forEach(t=>{i.find(e=>this._matchesGlobalFeature(t,e))||(n.remove(t),n.length===0&&e.delete(r))}):(n.removeAll(),e.delete(r))}),t.forEach((t,o)=>{let s=e.get(o)||new g;t?.filter(Boolean).forEach((e,t)=>{if(!s.some(t=>this._matchesGlobalFeature(t,e))){let{association:o,feature:c,terminalName:l,title:u}=e;s.add({title:u,association:o,featureViewModel:new Qn({abilities:{utilityNetworkAssociationsContent:!1},map:n,view:r,spatialReference:i,timeZone:a,graphic:c}),terminalName:l},t)}}),e.set(o,s)})}_compileUtilityNetworkAssociation(e,t){let{displayCount:n,title:r,description:i,associationTypes:a}=e,{_sourceLayer:o,graphic:s,map:c}=this;if(!bt(o))return;let l=new Dt({graphic:s,displayCount:n,associationTypes:a,layer:o,map:c,...this._compileTitleAndDesc({title:r,description:i})});return this.contentViewModels[t]=l,this.addHandles([f(()=>l.associationFeatures.values(),()=>this._setUpUtilityNetworkAssociationsViewModels(l.associationViewModels,l.associationFeatures,l.map))],nr),e}_compileExpression(e,t){let{expressionInfo:n}=e,{graphic:r,map:i,spatialReference:a,view:o,location:s}=this,c=new G({expressionInfo:n,graphic:r,interceptor:Qn.interceptor,map:i,spatialReference:a,view:o,location:s});return this.contentViewModels[t]=c,this.addHandles(f(()=>c.contentElementViewModel,()=>this._setExpressionContentVM(c,t),b),er),e}_compileAttachments(e,t){let{graphic:n}=this,{description:r,title:i,orderByFields:a,attachmentKeywords:o,attachmentTypes:s}=e;return this.contentViewModels[t]=new Ft({attachmentKeywords:o,attachmentTypes:s,graphic:n,orderByFields:a,...this._compileTitleAndDesc({title:i,description:r})}),e}_compileCustom(e,t){let{graphic:n}=this,{creator:r,destroyer:i}=e;return this.contentViewModels[t]=new I({graphic:n,creator:r,destroyer:i}),e}_compileTitleAndDesc({title:e,description:t}){let{_fieldInfoMap:n,_sourceLayer:r,graphic:i,formattedAttributes:a}=this,o=i?.attributes,s=this._expressionAttributes,c=a.global;return{title:k({attributes:o,fieldInfoMap:n,globalAttributes:c,expressionAttributes:s,layer:r,text:e}),description:k({attributes:o,fieldInfoMap:n,globalAttributes:c,expressionAttributes:s,layer:r,text:t})}}_createFieldsVMParams(e,t){let n=this._effectivePopupTemplate,r=this.formattedAttributes,i={...r?.global,...r?.content[t]},a=!!e?.fieldInfos,o=(e?.fieldInfos||n?.fieldInfos)?.filter(({fieldName:e})=>!!e&&(yt(e)||O(e)||i.hasOwnProperty(e))),s=n?.expressionInfos,{description:c,title:l}=e;return{attributes:i,expressionInfos:s,fieldInfos:o,isContentFieldInfos:a,graphic:this.graphic,layer:this._sourceLayer,...this._compileTitleAndDesc({title:l,description:c})}}_compileFields(e,t){let n=e.clone(),r=new R(this._createFieldsVMParams(e,t));return this.contentViewModels[t]=r,n.fieldInfos=r.formattedFieldInfos.slice(),n}_createMediaVMParams(e,t){let{abilities:n,graphic:r,_fieldInfoMap:i,_effectivePopupTemplate:a,relatedInfos:o,_sourceLayer:s,_expressionAttributes:c}=this,l=this.formattedAttributes,u=r?.attributes??{},{description:d,mediaInfos:f,title:p}=e;return{abilities:{chartAnimation:n.chartAnimation},activeMediaInfoIndex:e.activeMediaInfoIndex||0,attributes:u,graphic:r,layer:s,fieldInfoMap:i,formattedAttributes:{...l?.global,...l?.content[t]},expressionAttributes:c,mediaInfos:f,popupTemplate:a,relatedInfos:o,...this._compileTitleAndDesc({title:p,description:d})}}_compileMedia(e,t){let n=e.clone(),r=new B(this._createMediaVMParams(e,t));return n.mediaInfos=r.formattedMediaInfos.slice(),this.contentViewModels[t]=r,n}_createTextVMParams(e){let{graphic:t,_fieldInfoMap:n,_sourceLayer:r,_expressionAttributes:i}=this;if(e&&e.text){let a=t?.attributes??{},o=this.formattedAttributes?.global??{};e.text=k({attributes:a,fieldInfoMap:n,globalAttributes:o,expressionAttributes:i,layer:r,text:e.text})}return{graphic:t,creator:e.text}}_compileText(e,t){let n=e.clone();return this.contentViewModels[t]=new I(this._createTextVMParams(n)),n}_compileLastEditInfo(){let{_effectivePopupTemplate:e,_sourceLayer:t,graphic:n,timeZone:r}=this;if(!e)return;let{lastEditInfoEnabled:i}=e,a=t?.editFieldsInfo;return i&&a?nt(a,n?.attributes,r,t):void 0}_compileTitle(e){let{_fieldInfoMap:t,_sourceLayer:n,graphic:r,_expressionAttributes:i}=this,a=r?.attributes??{},o=this.formattedAttributes?.global??{};return k({attributes:a,fieldInfoMap:t,globalAttributes:o,expressionAttributes:i,layer:n,text:e})}async _getTitle(){let{_effectivePopupTemplate:e,graphic:t}=this;return t?it({type:`title`,value:e?.title,event:{graphic:t}}):null}async _getContent(){let{_effectivePopupTemplate:e,graphic:t}=this;return t?it({type:`content`,value:e?.content,event:{graphic:t}}):null}_evaluateExpressionAttributes({title:e,content:t,expressionInfos:n}){this._evaluateExpressionAttributesTask=S(this._evaluateExpressionAttributesTask),this._evaluateExpressionAttributesTask=me(async r=>{let{graphic:i,map:a,view:o,spatialReference:s,location:c}=this;try{if(!i)return;let l;if(n!=null){let e=[];for(let[t,l]of n.expressions.entries())l==null?e.push(Promise.resolve([t,void 0])):e.push(l.evaluate({graphic:i,interceptor:Qn.interceptor,location:c,map:a,options:{signal:r},spatialReference:s,view:o}).then(e=>[t,typeof e==`string`?bn(e):e]).catch(()=>[t,void 0]));l=Object.fromEntries(await Promise.all(e)),ge(r)}this._expressionAttributes=l,this._graphicExpressionAttributes={...i.attributes,...l},this._set(`formattedAttributes`,this._createFormattedAttributes(t)),this._set(`title`,this._compileTitle(e)),this._set(`lastEditInfo`,this._compileLastEditInfo()||null),this._set(`content`,this._compileContent(t)||null)}catch(e){oe(e)||(this._error=e,Me.getLogger(this).error(`error`,`The popupTemplate could not be displayed for this feature.`,{error:e,graphic:i,popupTemplate:this._effectivePopupTemplate}))}})}_createMediaFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:n}){let{_effectivePopupTemplate:r,graphic:i,relatedInfos:a,_sourceLayer:o,_fieldInfoMap:s,_graphicExpressionAttributes:c,timeZone:l}=this;n.content[t]=lt({attributes:{...c,...e.attributes},fieldInfoMap:s,fieldInfos:r?.fieldInfos,graphic:i,layer:o,relatedInfos:a,timeZone:l})}_createFieldsFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:n}){if(e.fieldInfos){let{graphic:r,relatedInfos:i,_sourceLayer:a,_fieldInfoMap:o,_graphicExpressionAttributes:s,timeZone:c}=this;n.content[t]=lt({attributes:{...s,...e.attributes},fieldInfoMap:o,fieldInfos:e.fieldInfos,graphic:r,isContentFieldInfos:!0,layer:a,relatedInfos:i,timeZone:c})}}_createFormattedAttributes(e){let{_effectivePopupTemplate:t,graphic:n,relatedInfos:r,_sourceLayer:i,_fieldInfoMap:a,_graphicExpressionAttributes:o,timeZone:s}=this,c=t?.fieldInfos,l={global:lt({attributes:o,fieldInfoMap:a,fieldInfos:c,graphic:n,layer:i,relatedInfos:r,timeZone:s}),content:[]};return Array.isArray(e)&&e.forEach((e,t)=>{e.type===`fields`&&this._createFieldsFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:l}),e.type===`media`&&this._createMediaFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:l})}),l}_checkForRelatedFeatures(e){let{graphic:t,_effectivePopupTemplate:n}=this;return this._queryRelatedInfos(t,Ct(n),e)}async _queryRelatedInfos(e,t,n){let{relatedInfos:r,_sourceLayer:i}=this;r.clear();let a=i?.associatedLayer==null?i:await i?.associatedLayer.load(n);if(!a||!e||!t.filter(e=>!!e.fieldName&&O(e.fieldName))?.length)return;t.forEach(e=>this._configureRelatedInfo(e,a));let o=await sn({relatedInfos:r,layer:a},n);Object.keys(o).forEach(e=>{let t=r.get(e.toString()),n=o[e]?.value;t&&n&&(t.layerInfo=n.data)});let s=await cn({graphic:e,relatedInfos:r,layer:a},n);Object.keys(s).forEach(e=>{$t(s[e]?.value,r.get(e.toString()))})}_configureRelatedInfo(e,t){let{relatedInfos:n}=this,r=Jt(e.fieldName||``);if(!r)return;let{layerId:i,fieldName:a}=r;if(!i)return;let o=n.get(i.toString())||Qt(i,t);o&&(ln({relatedInfo:o,fieldName:a,fieldInfo:e}),this.relatedInfos.set(i,o))}};r([m()],X.prototype,`_error`,void 0),r([m()],X.prototype,`_graphicChangedTask`,void 0),r([m()],X.prototype,`_evaluateExpressionAttributesTask`,void 0),r([m()],X.prototype,`_associationVMAbortController`,void 0),r([m({readOnly:!0})],X.prototype,`_effectivePopupTemplate`,null),r([m({readOnly:!0})],X.prototype,`_fieldInfoMap`,null),r([m({readOnly:!0})],X.prototype,`_sourceLayer`,null),r([m()],X.prototype,`abilities`,void 0),r([n(`abilities`)],X.prototype,`castAbilities`,null),r([m({readOnly:!0})],X.prototype,`content`,void 0),r([m({readOnly:!0})],X.prototype,`contentViewModels`,void 0),r([m()],X.prototype,`description`,void 0),r([m({type:Boolean})],X.prototype,`defaultPopupTemplateEnabled`,void 0),r([m({readOnly:!0})],X.prototype,`isFeatureFromTable`,null),r([m({readOnly:!0})],X.prototype,`state`,null),r([m({readOnly:!0})],X.prototype,`formattedAttributes`,void 0),r([m({type:d})],X.prototype,`graphic`,void 0),r([m({readOnly:!0})],X.prototype,`lastEditInfo`,void 0),r([m({type:t})],X.prototype,`location`,void 0),r([m({readOnly:!0})],X.prototype,`relatedInfos`,void 0),r([m({type:te})],X.prototype,`spatialReference`,null),r([m()],X.prototype,`timeZone`,null),r([m({readOnly:!0})],X.prototype,`title`,void 0),r([m()],X.prototype,`map`,null),r([m({readOnly:!0})],X.prototype,`waitingForContent`,null),r([m()],X.prototype,`view`,void 0),X=Qn=r([T(`esri.widgets.Feature.FeatureViewModel`)],X);var Z=`esri-feature`,Q={base:Z,container:`${Z}__size-container`,title:`${Z}__title`,main:`${Z}__main-container`,btn:`${Z}__button`,icon:`${Z}__icon`,content:`${Z}__content`,contentNode:`${Z}__content-node`,contentNodeText:`${Z}__content-node--text`,contentElement:`${Z}__content-element`,text:`${Z}__text`,lastEditedInfo:`${Z}__last-edited-info`,fields:`${Z}__fields`,fieldHeader:`${Z}__field-header`,fieldData:`${Z}__field-data`,fieldDataDate:`${Z}__field-data--date`,loadingSpinnerContainer:`${Z}__loading-container`},ir=e=>{let t=e,n=class extends t{constructor(){super(...arguments),this.renderNodeContent=e=>De(e)&&!e.destroyed?D(`div`,{class:Q.contentNode,key:e},e.render()):e instanceof HTMLElement?D(`div`,{afterCreate:this._attachToNode,bind:e,class:Q.contentNode,key:e}):he(e)?D(`div`,{afterCreate:this._attachToNode,bind:e.domNode,class:Q.contentNode,key:e}):null}_attachToNode(e){let t=this;e.appendChild(t)}};return n=r([T(`esri.widgets.Feature.support.FeatureContentMixin`)],n),n},ar={title:!0,content:!0,lastEditedInfo:!0},$=class extends ir(C){constructor(e,t){super(e,t),this._contentWidgets=[],this.flowType=`feature`,this.flowItems=null,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.visibleElements={...ar},this.viewModel=new X}initialize(){this.addHandles(f(()=>this.viewModel?.contentViewModels,()=>this._setupContentWidgets(),b))}loadDependencies(){return se({notice:()=>o(()=>import(`./calcite-notice-CvAfSaDY.js`),__vite__mapDeps([92,4,5,45,67,1,2,3,6,85,46,7])),loader:()=>o(()=>import(`./calcite-loader-BQ1zV8tb.js`),__vite__mapDeps([44,45,4,5,2,46,47]))})}destroy(){this._destroyContentWidgets()}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(e){this.viewModel.defaultPopupTemplateEnabled=e}get isTable(){return this.viewModel.isFeatureFromTable}get icon(){return`polygon`}set icon(e){this._overrideIfSome(`icon`,e)}get label(){return this.messages?.widgetLabel??``}set label(e){this._overrideIfSome(`label`,e)}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get title(){return this.viewModel.title}castVisibleElements(e){return{...ar,...e}}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}setActiveMedia(e,t){return this.viewModel.setActiveMedia(e,t)}nextMedia(e){return this.viewModel.nextMedia(e)}previousMedia(e){return this.viewModel.previousMedia(e)}render(){let{state:e}=this.viewModel,t=D(`div`,{class:Q.container,key:`container`},this._renderTitle(),e===`error`?this._renderError():e===`loading`?this._renderLoading():this._renderContentContainer());return D(`div`,{class:this.classes(Q.base,w.widget)},t)}_renderError(){let{messagesCommon:e,messages:t,visibleElements:n}=this;return D(`calcite-notice`,{icon:`exclamation-mark-circle`,kind:`danger`,open:!0,scale:`s`},n.title?D(`div`,{key:`error-title`,slot:`title`},e.errorMessage):null,D(`div`,{key:`error-message`,slot:`message`},t.loadingError))}_renderLoading(){return D(`div`,{class:Q.loadingSpinnerContainer,key:`loading-container`},D(`calcite-loader`,{inline:!0,label:``}))}_renderContentContainer(){let{visibleElements:e}=this;return e.content?D(`div`,{class:Q.main},[this._renderContent(),this._renderLastEditInfo()]):null}_renderTitle(){let{visibleElements:e,title:t}=this;return e.title?D(wt,{class:Q.title,innerHTML:t,level:this.headingLevel}):null}_renderContent(){let e=this.viewModel.content,t=`content`;if(!e)return null;if(Array.isArray(e))return e.length?D(`div`,{class:Q.contentNode,key:`${t}-content-elements`},e.map(this._renderContentElement,this)):null;if(typeof e==`string`){let e=this._contentWidgets[0];return!e||e.destroyed?null:D(`div`,{class:this.classes(Q.contentNode,Q.contentNodeText),key:`${t}-content`},e.render())}return this.renderNodeContent(e)}_renderContentElement(e,t){let{visibleElements:n}=this;if(typeof n.content!=`boolean`&&!n.content?.[e.type])return null;switch(e.type){case`attachments`:return this._renderAttachments(t);case`custom`:return this._renderCustom(e,t);case`fields`:return this._renderFields(t);case`media`:return this._renderMedia(t);case`text`:return this._renderText(e,t);case`expression`:return this._renderExpression(t);case`relationship`:return this._renderRelationship(t);case`utility-network-associations`:return this._renderAssociation(t);default:return null}}_renderAttachments(e){let t=this._contentWidgets[e];if(!t||t.destroyed)return null;let{state:n,attachmentInfos:r}=t.viewModel;return n===`loading`||r.length>0?D(`div`,{class:this.classes(Q.contentElement),key:this._buildKey(`attachments-element`,e)},t.render()):null}_renderRelationship(e){let t=this._contentWidgets[e];return t&&!t.destroyed&&this.flowItems?D(`div`,{class:Q.contentElement,key:this._buildKey(`relationship-element`,e)},t.render()):null}_renderAssociation(e){let t=this._contentWidgets[e];return t&&!t.destroyed&&this.flowItems?D(`div`,{class:Q.contentElement,key:this._buildKey(`utility-network-association-element`,e)},t.render()):null}_renderExpression(e){let t=this._contentWidgets[e];return t&&!t.destroyed&&t.viewModel.contentElement?D(`div`,{class:Q.contentElement,key:this._buildKey(`expression-element`,e)},t.render()):null}_renderCustom(e,t){let{creator:n}=e,r=this._contentWidgets[t];return!r||r.destroyed?null:n?D(`div`,{class:Q.contentElement,key:this._buildKey(`custom-element`,t)},r.render()):null}_renderFields(e){let t=this._contentWidgets[e];return!t||t.destroyed?null:D(`div`,{class:Q.contentElement,key:this._buildKey(`fields-element`,e)},t.render())}_renderMedia(e){let t=this._contentWidgets[e];return!t||t.destroyed?null:D(`div`,{class:Q.contentElement,key:this._buildKey(`media-element`,e)},t.render())}_renderLastEditInfo(){let{visibleElements:e,messages:t}=this,{lastEditInfo:n}=this.viewModel;if(!n||!e.lastEditedInfo)return null;let{date:r,user:i}=n,a=n.type===`edit`?i?t.lastEditedByUser:t.lastEdited:i?t.lastCreatedByUser:t.lastCreated,o=ie(a,{date:r,user:i});return D(`div`,{class:this.classes(Q.lastEditedInfo,Q.contentElement),key:`edit-info-element`},o)}_renderText(e,t){let n=e.text,r=this._contentWidgets[t];return!r||r.destroyed?null:n?D(`div`,{class:this.classes(Q.contentElement,Q.text),key:this._buildKey(`text-element`,t)},r.render()):null}_buildKey(e,...t){return`${e}__${this.viewModel?.graphic?.uid||`0`}-${t.join(`-`)}`}_destroyContentWidget(e){e&&(e.viewModel=null,!e.destroyed&&e.destroy())}_destroyContentWidgets(){this._contentWidgets.forEach(e=>this._destroyContentWidget(e)),this._contentWidgets=[]}_setupContentWidgets(){this._destroyContentWidgets();let{headingLevel:e,visibleElements:t,flowItems:n,viewModel:r}=this,i=r?.content,{contentViewModels:a}=r;if(Array.isArray(i))i.forEach((i,s)=>{if(i.type===`attachments`&&(this._contentWidgets[s]=new F({displayType:i.displayType,headingLevel:t.title&&e<6?e+1:e,viewModel:a[s]})),i.type===`fields`&&(this._contentWidgets[s]=new z({viewModel:a[s]})),i.type===`media`&&(this._contentWidgets[s]=new W({viewModel:a[s]})),i.type===`text`&&(this._contentWidgets[s]=new L({viewModel:a[s]})),i.type===`custom`&&(this._contentWidgets[s]=new L({viewModel:a[s]})),i.type===`expression`&&(this._contentWidgets[s]=new Bn({viewModel:a[s]})),i.type===`relationship`){let e=new J({flowItems:n,featureVisibleElements:t,viewModel:a[s]});this._contentWidgets[s]=e}if(i.type===`utility-network-associations`){let e=new Y({flowItems:n,onSelectAssociationType:async e=>{let{viewModel:i,listType:a,title:s}=e;if(!n)return;i.activeAssociationType=a;let{default:c}=await o(async()=>{let{default:e}=await import(`./FeatureUtilityNetworkAssociationList-1UWvRIyc.js`);return{default:e}},__vite__mapDeps([106,4,5,64,104,105])),l=new c({viewModel:i,parentFeatureViewModel:r,listType:a,title:s,featureVisibleElements:t,description:r.title,flowItems:n});n.push(l)},parentFeatureViewModel:r,featureVisibleElements:t,viewModel:a[s]});this._contentWidgets[s]=e}},this);else{let e=a[0];e&&!e.destroyed&&(this._contentWidgets[0]=new L({viewModel:e}))}this.scheduleRender()}};r([m()],$.prototype,`flowType`,void 0),r([m()],$.prototype,`graphic`,null),r([m()],$.prototype,`defaultPopupTemplateEnabled`,null),r([m()],$.prototype,`flowItems`,void 0),r([m()],$.prototype,`headingLevel`,void 0),r([m({readOnly:!0})],$.prototype,`isTable`,null),r([m()],$.prototype,`icon`,null),r([m()],$.prototype,`label`,null),r([m()],$.prototype,`location`,null),r([m(),E(`esri/widgets/Feature/t9n/Feature`)],$.prototype,`messages`,void 0),r([m(),E(`esri/t9n/common`)],$.prototype,`messagesCommon`,void 0),r([m()],$.prototype,`spatialReference`,null),r([m()],$.prototype,`timeZone`,null),r([m({readOnly:!0})],$.prototype,`title`,null),r([m()],$.prototype,`visibleElements`,void 0),r([n(`visibleElements`)],$.prototype,`castVisibleElements`,null),r([m()],$.prototype,`map`,null),r([m()],$.prototype,`view`,null),r([m({type:X})],$.prototype,`viewModel`,void 0),$=r([T(`esri.widgets.Feature`)],$);export{Mt as a,X as i,ir as n,Q as r,$ as t};