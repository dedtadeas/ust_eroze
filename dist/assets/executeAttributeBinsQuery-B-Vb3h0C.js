import{$m as e,Fu as t,IS as n,OS as r,Sw as i,WT as a,XT as o,zu as s}from"./index-BqmCqmfp.js";import{t as c}from"./urlUtils-CtPsFIu4.js";import"./queryUtils-BA7HiGeg.js";import"./FixedIntervalBinParameters-BO-nZFQ3.js";import{t as l}from"./AttributeBinsFeatureSet-Cw3XBtzs.js";import{t as u}from"./AttributeBinsQuery-DyK0zHZB.js";function d(t){let i=t.geometry,a=t.toJSON(),o=a,s,c,l;if(i!=null&&(c=i.spatialReference,l=r(c),o.geometryType=e(i),o.geometry=JSON.stringify(i),o.inSR=l),a.outSR?(o.outSR=r(a.outSR),s=t.outSpatialReference):i&&(o.outSR=o.inSR,s=c),o.bin&&=JSON.stringify(o.bin),o.quantizationParameters&&=JSON.stringify(o.quantizationParameters),o.outStatistics&&=JSON.stringify(o.outStatistics),o.outTimeReference&&=JSON.stringify(o.outTimeReference),a.timeExtent){let{start:e,end:t}=a.timeExtent;e==null&&t==null||(o.time=e===t?e:`${e??`null`},${t??`null`}`),delete a.timeExtent}return t.defaultSpatialReference&&n(c,s)&&(o.defaultSR=o.inSR,delete o.inSR,delete o.outSR),o}async function f(e,t,n){return t.timeExtent!=null&&t.timeExtent.isEmpty?{data:{features:[]}}:await p(e,t,n)}async function p(e,n,r={}){let s=typeof e==`string`?a(e):e,l=n.geometry?[n.geometry]:[],u=(await t(l,null,{signal:r.signal}))?.[0];u!=null&&((n=n.clone()).geometry=u);let f=c({...s.query,f:`json`,...d(n)});return i(o(s.path,`queryBins`),{...r,query:{...f,...r.query}})}async function m(e,t,n){let{data:r}=await f(s(e),u.from(t),n);return l.fromJSON(r)}export{m as executeAttributeBinsQuery};