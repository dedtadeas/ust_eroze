const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/editingSupport-DZmD-Wdk.js","assets/editingSupport-z-WY3UuH.js","assets/index-BqmCqmfp.js","assets/index-kIqmb12G.css","assets/Mesh-BuH3i-9R.js","assets/earcut-Drx511Ix.js","assets/vec3-40WN6G4a.js","assets/vec4-CcFo8HF1.js","assets/vectorStacks-CKtslZxP.js","assets/quatf64-CJzmL3cc.js","assets/quat-Bk_ZaVz9.js","assets/Mesh-CUHzTZdQ.js","assets/computeTranslationToOriginAndRotation-BC3OuSky.js","assets/projectPointToVector-Clou1sfo.js","assets/spatialReferenceEllipsoidUtils-DBtdxVkA.js","assets/MeshComponent--ctdPfFQ.js","assets/MeshMaterialMetallicRoughness-BUsirHC6.js","assets/meshCloneUtils-Akm6YUJV.js","assets/meshProperties-Du90n6lL.js","assets/MeshLocalVertexSpace-HjmVAuYa.js","assets/MeshTransform-B2p38eYR.js","assets/axisAngleDegrees-Di7q97jx.js","assets/MeshVertexAttributes-Df5_8xlW.js","assets/External-Cyg8cgWj.js","assets/vertexSpaceConversion-g9XG_RJW.js","assets/BufferView-DNaZpbJX.js","assets/Util-3rPi0NfK.js","assets/meshVertexSpaceUtils-Y8FeTLov.js","assets/triangulationUtils-BJbNyOeM.js","assets/Indices-BsTLKVdx.js","assets/deduplicate-BuZ0DaaO.js","assets/plane-CTjDePZl.js"])))=>i.map(i=>d[i]);
import{AE as e,Ar as t,Ax as n,Ay as r,Bp as i,Br as a,By as o,CD as s,Cd as c,Cw as l,Ea as u,Gb as d,Gi as f,H as p,Hb as m,Hi as h,Hx as g,Id as _,Ji as v,L as y,La as b,MC as x,Ma as ee,Mb as te,Na as ne,Nb as S,Np as C,Q as re,Qw as ie,R as ae,Ra as oe,Rr as se,Rw as ce,SC as w,Sw as T,U as E,Un as D,Vb as le,X as ue,XT as de,Xi as fe,Y as O,Yi as pe,Za as me,Zi as he,Zn as ge,Zw as _e,_E as k,_w as ve,ao as A,br as j,cm as M,da as N,dg as P,dw as F,er as ye,fp as be,fr as xe,gp as Se,hp as Ce,iT as I,ig as L,kC as R,kw as z,mT as we,mr as Te,nT as Ee,ot as De,q as Oe,rt as ke,ut as Ae,vC as B,vE as V,yT as H,zy as je}from"./index-BqmCqmfp.js";import"./quatf64-CJzmL3cc.js";import"./quat-Bk_ZaVz9.js";import"./axisAngleDegrees-Di7q97jx.js";import"./MeshTransform-B2p38eYR.js";import"./vectorStacks-CKtslZxP.js";import"./plane-CTjDePZl.js";import"./projectPointToVector-Clou1sfo.js";import"./computeTranslationToOriginAndRotation-BC3OuSky.js";import"./spatialReferenceEllipsoidUtils-DBtdxVkA.js";import{n as Me}from"./capabilities-Bfip05kH.js";import{n as Ne}from"./SceneService-D87lJ-9p.js";import{i as Pe,n as Fe,r as U,t as Ie}from"./I3SLayerDefinitions-CBsRawSe.js";import"./dehydratedPoint-Dwb3orme.js";import"./projectVectorToVector-D-Bbb8fP.js";import"./sphere-CicnK0Bn.js";import"./featurePopupQueryUtils-D4olkuib.js";import"./I3SBinaryReader-BEyu-d1C.js";import{t as Le}from"./I3SUtil-B0pnWJld.js";import"./symbolColorUtils-BNtTwJ67.js";import"./orientedBoundingBox-DZQLHGx0.js";import"./Emissions.glsl-DaTtsIIp.js";import"./glsl-C2sn87h0.js";import"./Uniform-DXwqrKA1.js";import"./Float3DrawUniform-UsZpj3mh.js";import"./Float3PassUniform-Co8OqiAU.js";import"./FloatPassUniform-BEwJjV4q.js";import"./Texture2DDrawUniform-hiIQoiSn.js";import"./Texture2DPassUniform-Cd7cdF1a.js";import"./NoParameters-CpAItLvD.js";import"./layerViewUtils-Bbe7IKvz.js";import{n as Re,t as ze}from"./popupUtils-h58HBZOO.js";import"./originUtils-Xpg5-Q2D.js";import"./resourceUtils-CEABprin.js";import"./resourceUtils-Dtqy_ILo.js";import"./saveUtils-DsVVlvmj.js";import{t as Be}from"./associatedFeatureServiceUtils-C1iuzbPQ.js";import{a as Ve,p as W,t as He}from"./elevationInfoUtils-Df_uYU_q.js";import{t as Ue}from"./lazyLayerLoader-DjJLNY3M.js";import{a as We,s as Ge,t as Ke}from"./meshSpatialReferenceScaleUtils-CQTVIwyV.js";var qe=Symbol(`isSceneGraphicOrigin`),G,Je=class extends b{get[(G=qe,be)](){return this.layer}get[Ce](){return this.layer}get[oe](){return this.layer}constructor(e){super(),this[G]=!0,this.type=`scene`,this.layer=e}get id(){return this.layer.id}};function K({associatedLayer:e,serviceUpdateTimeStamp:t}){let n=e?.editingInfo?.lastEditDate,r=e?.serverGens,i=n!=null,a=t!=null,o=i&&a&&t.lastUpdate!==n.getTime();return i&&(o||!a&&r?.minServerGen!==r?.serverGen)}var Ye=e=>{let t=e,n=class extends t{constructor(){super(...arguments),this.serviceTimeInfo=null}get timeInfo(){let e=this.associatedLayer?.timeInfo;if(e==null)return null;let t=e.clone();return C(t,this.fieldsIndex),t}set timeInfo(e){C(e,this.fieldsIndex),this._override(`timeInfo`,e)}get timeExtent(){return this.associatedLayer?.timeExtent}set timeExtent(e){this._override(`timeExtent`,e)}get timeOffset(){return this.associatedLayer?.timeOffset}set timeOffset(e){this._override(`timeOffset`,e)}get datesInUnknownTimezone(){return this.associatedLayer?.datesInUnknownTimezone??!1}set datesInUnknownTimezone(e){this._override(`datesInUnknownTimezone`,e)}async loadTimeInfoFromService(e){let{serviceTimeInfo:t}=this;if(t==null)return;let{startTimeField:n,endTimeField:r}=t;if(n==null&&r==null||K({associatedLayer:this.associatedLayer,serviceUpdateTimeStamp:this.serviceUpdateTimeStamp}))return;let i=async t=>{let r=null;try{r=(await this.fetchStatistics?.(t,e))?.stats}catch{}if(r==null)return null;let{minTimeStr:i,min:a,maxTimeStr:o,max:s}=r,c=t===n?i??a:o??s;return c==null?null:new Date(c)},[a,o]=await Promise.all([i(n),i(r)]);if(n!=null&&a==null||r!=null&&o==null)return;let s=new S({start:a,end:o});this.setAtOrigin(`timeInfo`,new O({endField:r,startField:n,fullTimeExtent:s}),`service`)}};return s([x({type:O,json:{read:!1,write:!1}})],n.prototype,`timeInfo`,null),s([x({type:S,json:{read:!1,write:!1}})],n.prototype,`timeExtent`,null),s([x({type:me,json:{read:!1,write:!1}})],n.prototype,`timeOffset`,null),s([x({type:Boolean,nonNullable:!0,json:{read:!1,write:!1}})],n.prototype,`datesInUnknownTimezone`,null),s([x({type:q,readOnly:!0,json:{read:{source:`timeInfo`}},clonable:!1})],n.prototype,`serviceTimeInfo`,void 0),n=s([R(`esri.layers.mixins.TemporalSceneLayer`)],n),n},q=class extends B{constructor(){super(...arguments),this.endTimeField=null,this.startTimeField=null}};s([x({type:String})],q.prototype,`endTimeField`,void 0),s([x({type:String})],q.prototype,`startTimeField`,void 0),q=s([R(`esri.layers.mixins.TemporalSceneLayer.SceneServiceTimeInfo`)],q);var J=class extends B{constructor(){super(...arguments),this.name=null,this.field=null,this.currentRangeExtent=null,this.fullRangeExtent=null,this.type=`rangeInfo`}};s([x({type:String,json:{read:!0,write:{isRequired:!0}}})],J.prototype,`name`,void 0),s([x({type:String,json:{read:!0,write:{isRequired:!0}}})],J.prototype,`field`,void 0),s([x({type:[Number],json:{read:!0,write:!0}})],J.prototype,`currentRangeExtent`,void 0),s([x({type:[Number],json:{read:!0,write:!0}})],J.prototype,`fullRangeExtent`,void 0),s([x({type:[`rangeInfo`],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],J.prototype,`type`,void 0),J=s([R(`esri.layers.support.RangeInfo`)],J);var Y,X=Y=class extends B{constructor(e){super(e),this.spatialRelationship=`disjoint`,this.geometries=new L,this._geometriesSource=null}initialize(){this.addHandles(m(()=>this.geometries,`after-changes`,()=>this.geometries=this.geometries,le))}readGeometries(e,t,n){Array.isArray(e)?this.geometries=L.fromJSON(e,n):n.origin!==`web-scene`&&n.origin!==`portal-item`||(this._geometriesSource={url:ce(e,n),context:n})}async loadGeometries(e,t){if(this._geometriesSource==null)return;let{url:n,context:r}=this._geometriesSource,i=await T(n,{responseType:`json`,signal:t?.signal}),a=e.toJSON(),o=i.data.map(e=>({...e,spatialReference:a}));this.geometries=L.fromJSON(o,r),this._geometriesSource=null}clone(){let t=new Y({geometries:e(this.geometries),spatialRelationship:this.spatialRelationship});return t._geometriesSource=this._geometriesSource,t}};s([x({type:[`disjoint`,`contains`],nonNullable:!0,json:{write:{isRequired:!0}}})],X.prototype,`spatialRelationship`,void 0),s([x({type:L,nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}}}),r({origins:[`web-scene`,`portal-item`],type:`resource`,prefix:`geometries`,contentAddressed:!0})],X.prototype,`geometries`,void 0),s([g([`web-scene`,`portal-item`,`service`],`geometries`)],X.prototype,`readGeometries`,null),X=Y=s([R(`esri.layers.support.SceneFilter`)],X);var Xe=X;async function Ze({fieldName:e,statisticsInfo:t,errorContext:n,fieldsIndex:r,path:i,customParameters:a,apiKey:o,signal:s}){if(t==null)throw new k(`${n}:no-cached-statistics`,`Cached statistics are not available for this layer`);let c=r.get(e);if(c==null)throw new k(`${n}:field-unexisting`,`Field '${e}' does not exist on the layer`);let l=t.find(e=>e.name===c.name);if(l==null)throw new k(`${n}:no-cached-statistics`,`Cached statistics for this attribute are not available`);let u=de(i,l.href),{data:d}=await T(u,{query:{f:`json`,...a,token:o},responseType:`json`,signal:s});return d}async function Qe(e){let t=[];for(let n of e)n.name.toLowerCase().endsWith(`.zip`)?t.push($e(n)):t.push(Promise.resolve(n));return(await Promise.all(t)).flat()}async function $e(e){let{BlobReader:t,ZipReader:n,BlobWriter:r}=await l(async()=>{let{BlobReader:e,ZipReader:t,BlobWriter:n}=await import(`./zipjs-wrapper-7q0ox6m2.js`);return{BlobReader:e,ZipReader:t,BlobWriter:n}},[]),i=[];return(await new n(new t(e)).getEntries()).forEach(e=>{if(e.directory||/^__MACOS/i.test(e.filename))return;let t=new r;i.push(e.getData(t).then(t=>new File([t],e.filename)))}),Promise.all(i)}var et=new Set([`3DObject`,`Point`]),Z=E(),Q=class extends Ye(N(Ne(ee(ke(re(ue(A(u(ne(je(te))))))))))){constructor(...e){super(...e),this.featureReduction=null,this.rangeInfos=null,this.operationalLayerType=`ArcGISSceneServiceLayer`,this.type=`scene`,this.fields=null,this.graphicOrigin=new Je(this),this.floorInfo=null,this.outFields=null,this.nodePages=null,this.materialDefinitions=null,this.textureSetDefinitions=null,this.geometryDefinitions=null,this.serviceUpdateTimeStamp=null,this.excludeObjectIds=new w,this.definitionExpression=null,this.filter=null,this.path=null,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.priority=null,this.semantic=null,this.cachedDrawingInfo={color:!1},this.popupEnabled=!0,this.popupTemplate=null,this.attributeTableTemplate=null,this.objectIdField=null,this.globalIdField=null,this._fieldUsageInfo={},this.screenSizePerspectiveEnabled=!0,this.serviceItemId=void 0}normalizeCtorArgs(e,t){return typeof e==`string`?{url:e,...t}:e}destroy(){this._set(`renderer`,null),this.associatedLayer=we(this.associatedLayer)}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,n){let r=this.getField(e)?.domain??null;return this.associatedLayer?t(this.associatedLayer,e,n,r):r}getFeatureType(e){return e&&this.associatedLayer?this.associatedLayer.getFeatureType(e):null}get types(){return this.associatedLayer?.types??[]}get typeIdField(){return this.associatedLayer?.typeIdField??null}get templates(){return this.associatedLayer?.templates??null}get formTemplate(){return this.associatedLayer?.formTemplate??null}get fieldsIndex(){return new D(this.fields)}readNodePages(e,t,n){return t.layerType===`Point`&&(e=t.pointNodePages),typeof e!=`object`||!e?null:U.fromJSON(e,n)}set elevationInfo(e){this._set(`elevationInfo`,e),this.loaded&&this._validateElevationInfo()}get effectiveCapabilities(){return this._capabilitiesFromAssociatedFeatureLayer(this.associatedLayer?.effectiveCapabilities)}get effectiveEditingEnabled(){return this.associatedLayer!=null&&se(this.associatedLayer)}get geometryType(){return tt[this.profile]||`mesh`}set renderer(e){M(e,this.fieldsIndex),this._set(`renderer`,e)}readCachedDrawingInfo(e){return typeof e==`object`&&e||(e={}),e.color??=!1,e}get capabilities(){return this._capabilitiesFromAssociatedFeatureLayer(this.associatedLayer?.capabilities)}_capabilitiesFromAssociatedFeatureLayer(e){e??=Me;let{query:t,queryRelated:n,editing:{supportsGlobalId:r,supportsRollbackOnFailure:i,supportsUploadWithItemId:a,supportsGeometryUpdate:o,supportsReturnServiceEditsInSourceSpatialReference:s},data:{supportsZ:c,supportsM:l,isVersioned:u,supportsAttachment:d},operations:{supportsEditing:f,supportsAdd:p,supportsUpdate:m,supportsDelete:h,supportsQuery:g,supportsQueryAttachments:_,supportsAsyncConvert3D:v}}=e,y=e.operations.supportsChangeTracking,b=!!this.associatedLayer?.infoFor3D;return{query:t,queryRelated:n,editing:{supportsGlobalId:r,supportsReturnServiceEditsInSourceSpatialReference:s,supportsRollbackOnFailure:i,supportsGeometryUpdate:b&&o,supportsUploadWithItemId:a},data:{supportsAttachment:d,supportsZ:c,supportsM:l,isVersioned:u},operations:{supportsQuery:g,supportsQueryAttachments:_,supportsEditing:f&&y,supportsAdd:b&&p&&y,supportsDelete:b&&h&&y,supportsUpdate:m&&y,supportsAsyncConvert3D:v}}}get editingEnabled(){return this._isOverridden(`editingEnabled`)?this._get(`editingEnabled`):this.associatedLayer?.editingEnabled??!1}set editingEnabled(e){this._overrideIfSome(`editingEnabled`,e)}get infoFor3D(){return this.associatedLayer?.infoFor3D??null}get relationships(){return this.associatedLayer?.relationships}get defaultPopupTemplate(){return this.associatedLayer||this.attributeStorageInfo?this.createPopupTemplate():null}readObjectIdField(e,t){return!e&&t.fields&&t.fields.some(t=>(t.type===`esriFieldTypeOID`&&(e=t.name),!!e)),e||void 0}readGlobalIdField(e,t){return!e&&t.fields&&t.fields.some(t=>(t.type===`esriFieldTypeGlobalID`&&(e=t.name),!!e)),e||void 0}get displayField(){return this.associatedLayer?.displayField??null}readProfile(e,t){let n=t.store.profile;return n!=null&&$[n]?$[n]:(V.getLogger(this).error(`Unknown or missing profile`,{profile:n,layer:this}),`mesh-pyramids`)}get useViewTime(){return this.associatedLayer?.useViewTime??!0}set useViewTime(e){this._override(`useViewTime`,e)}load(e){return this.addResolvingPromise(this._load(e)),Promise.resolve(this)}async _load(e){let t=e?.signal;await this.loadFromPortal({supportedTypes:[`Scene Service`]},e).catch(ie),await this._fetchService(t),await Promise.all([this._fetchIndexAndUpdateExtent(this.nodePages,t),this._setAssociatedFeatureLayer(t),this._loadFilterGeometries()]),this._validateElevationInfo(),this._applyAssociatedLayerOverrides(),this._populateFieldUsageInfo(),await this.loadTimeInfoFromService(e),await ae(this,{origin:`service`},t),M(this.renderer,this.fieldsIndex),await this.finishLoadEditablePortalLayer(e)}async beforeSave(){this.filter!=null&&(this.filter=this.filter.clone(),await this.load())}async _loadFilterGeometries(){if(this.filter)try{await this.filter.loadGeometries(this.spatialReference)}catch(e){V.getLogger(this).error(`#_loadFilterGeometries()`,this,`Failed to load filter geometries. Geometry filter will not be applied for this layer.`,{error:e}),this.filter=null}}createQuery(){let e=new c;return this.geometryType===`mesh`?this.capabilities.query.supportsReturnMesh&&(e.returnGeometry=!0):(e.returnGeometry=!0,e.returnZ=!0),e.where=this.definitionExpression||`1=1`,e.sqlFormat=`standard`,e.outFields=[`*`],e}queryExtent(e,t){return this._getAssociatedLayerForQuery().then(n=>n.queryExtent(e||this.createQuery(),t))}queryFeatureCount(e,t){return this._getAssociatedLayerForQuery().then(n=>n.queryFeatureCount(e||this.createQuery(),t))}queryFeatures(e,t){return this._getAssociatedLayerForQuery().then(n=>n.queryFeatures(e||this.createQuery(),t)).then(e=>{if(e?.features)for(let t of e.features)t.layer=this,t.sourceLayer=this,t.origin=this.graphicOrigin;return e})}async queryRelatedFeatures(e,t){if(await this.load(),!this.associatedLayer)throw new k(`scenelayer:query-not-available`,`SceneLayer queries are not available without an associated feature layer`,{layer:this});return this.associatedLayer.queryRelatedFeatures(e,t)}async queryRelatedFeaturesCount(e,t){if(await this.load(),!this.associatedLayer)throw new k(`scenelayer:query-not-available`,`SceneLayer queries are not available without an associated feature layer`,{layer:this});return this.associatedLayer.queryRelatedFeaturesCount(e,t)}async queryCachedAttributes(e,t){let n=i(this.fieldsIndex,await Re(this,ze(this)));return Le(this.parsedUrl?.path??``,this.attributeStorageInfo??[],e,t,n,this.apiKey,this.customParameters)}async queryCachedFeature(e,t){let n=await this.queryCachedAttributes(e,[t]);if(!n||n.length===0)throw new k(`scenelayer:feature-not-in-cached-data`,`Feature not found in cached data`);let r=new _;return r.attributes=n[0],r.layer=this,r.sourceLayer=this,r.origin=this.graphicOrigin,r}queryObjectIds(e,t){return this._getAssociatedLayerForQuery().then(n=>n.queryObjectIds(e||this.createQuery(),t))}queryAttachments(e,t){return this._getAssociatedLayerForQuery().then(n=>n.queryAttachments(e,t))}getFieldUsageInfo(e){let t={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[e]||t:(V.getLogger(this).error(`#getFieldUsageInfo()`,`Unavailable until layer is loaded`),t)}createPopupTemplate(e){return y(this,e)}_getAssociatedLayerForQuery(){let e=this.associatedLayer;return e?.loaded?Promise.resolve(e):this._loadAssociatedLayerForQuery()}async _loadAssociatedLayerForQuery(){if(await this.load(),!this.associatedLayer)throw new k(`scenelayer:query-not-available`,`SceneLayer queries are not available without an associated feature layer`,{layer:this});try{await this.associatedLayer.load()}catch(e){throw new k(`scenelayer:query-not-available`,`SceneLayer associated feature layer could not be loaded`,{layer:this,error:e})}return this.associatedLayer}hasCachedStatistics(e){return this.statisticsInfo!=null&&this.statisticsInfo.some(t=>t.name===e)}async queryCachedStatistics(e,t){return await this.load(t),await this.fetchStatistics(e,t)}async saveAs(e,t){return this._debouncedSaveOperations(1,{...t,getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:`scene`},e)}async save(){return this._debouncedSaveOperations(0,{getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:`scene`})}async applyEdits(e,t){let{applyEdits:n}=await l(async()=>{let{applyEdits:e}=await import(`./editingSupport-DZmD-Wdk.js`);return{applyEdits:e}},__vite__mapDeps([0,1,2,3])),r=t;await this.load();let i=this.associatedLayer;if(!i)throw new k(`${this.type}-layer:not-editable`,`Service is not editable`);await i.load();let{globalIdField:o}=i,s=!!i.infoFor3D,c=r?.globalIdUsed??!0;if(s&&o==null)throw new k(`${this.type}-layer:not-editable`,`Valid globalIdField expected on editable SceneLayer`);if(s&&!c)throw new k(`${this.type}-layer:globalid-required`,`globalIdUsed must not be false for SceneLayer editing as globalIds are required.`);return z(i.url)&&s&&e.deleteFeatures!=null&&o!=null&&(r={...r,globalIdToObjectId:await a(i,e.deleteFeatures,o)}),n(this,i.source,e,r)}async uploadAssets(e,t){if(await this.load(),this.associatedLayer==null)throw new k(`${this.type}-layer:not-editable`,`Service is not editable`);return await this.associatedLayer.load(),this.associatedLayer.uploadAssets(e,t)}async convertMesh(e,t){t??={},t.location!=null&&ve(V.getLogger(this),`The 'location' option of convertMesh() has been deprecated in favour of 'origin'.`,{version:`4.34`,replacement:`origin`,warnOnce:!0});let r=e=>{throw V.getLogger(this).error(`.convertMesh()`,e.message),e};await this.load(t),this.infoFor3D||r(new k(`invalid:layer`,`SceneLayer has no capability for mesh conversion`));let i=await this.extractAndFilterFiles(e);I(t);let a=i.reduce((e,t)=>Te(this.infoFor3D,t)?e+1:e,0);a===0&&r(new We),a>1&&r(new Ge);let o=this.spatialReference,s=t.origin??t.location,c=await P(s??t.defaultOrigin??new n({x:0,y:0,z:0,spatialReference:o}),o,t),u=c.spatialReference.isGeographic?`local`:`georeferenced`,{default:d}=await l(async()=>{let{default:e}=await import(`./Mesh-BuH3i-9R.js`);return{default:e}},__vite__mapDeps([4,5,6,2,3,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]));I(t);let f=d.createWithExternalSource(c,{type:`client`,files:i},{vertexSpace:u,transform:Ke(c.spatialReference),unitConversionDisabled:!0}),[p]=await this.uploadAssets([f],{...t,useAssetOrigin:!s});return p}async extractAndFilterFiles(e){await this.load();let t=this.infoFor3D;return t?(await Qe(e)).filter(e=>xe(t,e)):e}validateLayer(e){if(e.layerType&&!et.has(e.layerType))throw new k(`scenelayer:layer-type-not-supported`,`SceneLayer does not support this layer type`,{layerType:e.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new k(`layer:service-version-not-supported`,`Service version is not supported.`,{serviceVersion:this.version.versionString,supportedVersions:`1.x, 2.x`});if(this.version.major>2)throw new k(`layer:service-version-too-new`,`Service version is too new.`,{serviceVersion:this.version.versionString,supportedVersions:`1.x, 2.x`});function t(e,t){let n=!1,r=!1;if(e==null)n=!0,r=!0;else{let i=t&&t.isGeographic;switch(e){case`east-north-up`:case`earth-centered`:n=!0,r=i;break;case`vertex-reference-frame`:n=!0,r=!i;break;default:n=!1}}if(!n)throw new k(`scenelayer:unsupported-normal-reference-frame`,`Normal reference frame is invalid.`);if(!r)throw new k(`scenelayer:incompatible-normal-reference-frame`,`Normal reference frame is incompatible with layer spatial reference.`)}t(this.normalReferenceFrame,this.spatialReference)}_getTypeKeywords(){let e=[];if(this.profile===`points`)e.push(`Point`);else{if(this.profile!==`mesh-pyramids`)throw new k(`scenelayer:unknown-profile`,`SceneLayer:save() encountered an unknown SceneLayer profile: `+this.profile);e.push(`3DObject`)}return e}_populateFieldUsageInfo(){if(this._fieldUsageInfo={},this.fields)for(let e of this.fields){let t=!!this.attributeStorageInfo?.some(t=>t.name===e.name),n=!!this.associatedLayer?.fields?.some(t=>t&&e.name===t.name),r={supportsLabelingInfo:t,supportsRenderer:t,supportsPopupTemplate:t||n,supportsLayerQuery:n};this._fieldUsageInfo[e.name]=r}}_applyAssociatedLayerOverrides(){this._applyAssociatedLayerFieldsOverrides(),this._applyAssociatedLayerPropertyOverrides(),this._applyAssociatedLayerExtentOverride(),this._applyAssociatedLayerPrivileges()}_applyAssociatedLayerFieldsOverrides(){if(!this.associatedLayer?.fields)return;let e=null;for(let t of this.associatedLayer.fields){let n=this.getField(t.name);n?(!n.domain&&t.domain&&(n.domain=t.domain.clone()),n.editable=t.editable,n.nullable=t.nullable,n.length=t.length):(e||=this.fields?this.fields.slice():[],e.push(t.clone()))}e&&this._set(`fields`,e)}_applyAssociatedLayerPropertyOverrides(){if(!this.associatedLayer)return;let e=[`popupTemplate`,`popupEnabled`,`attributeTableTemplate`],t=F(this);for(let n=0;n<e.length;n++){let r=e[n],i=this.originIdOf(r),a=this.associatedLayer.originIdOf(r);i<a&&(a===2||a===3)&&t.setAtOrigin(r,this.associatedLayer[r],a)}}_applyAssociatedLayerExtentOverride(){let e=this.associatedLayer?.getAtOrigin(`fullExtent`,`service`);this.associatedLayer?.infoFor3D==null||!e||!z(this.associatedLayer?.url)||!K(this)||F(this).setAtOrigin(`fullExtent`,e.clone(),2)}_applyAssociatedLayerPrivileges(){let e=this.associatedLayer;e&&(this._set(`userHasEditingPrivileges`,e.userHasEditingPrivileges),this._set(`userHasFullEditingPrivileges`,e.userHasFullEditingPrivileges),this._set(`userHasUpdateItemPrivileges`,e.userHasUpdateItemPrivileges))}async _setAssociatedFeatureLayer(e){if([`mesh-pyramids`,`points`].includes(this.profile))try{let{serverUrl:t,layerId:n,portalItem:r}=await Be(`${this.url}/layers/${this.layerId}`,{sceneLayerItem:this.portalItem,customParameters:this.customParameters,apiKey:this.apiKey,signal:e});this.associatedLayer=new(await(Ue.FeatureLayer()))({url:t,customParameters:this.customParameters,layerId:n,portalItem:r}),await this.associatedLayer.load()}catch(e){_e(e)||this._logWarningOnPopupEnabled()}}async _logWarningOnPopupEnabled(){let e=new AbortController;this.addHandles(H(e));try{await d(()=>this.popupEnabled&&this.popupTemplate!=null,e.signal)}catch(e){Ee(e);return}let t=`this SceneLayer: ${this.title}`;this.attributeStorageInfo==null?V.getLogger(this).warn(`Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on ${t}`):V.getLogger(this).info(`Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on ${t}`)}_validateElevationInfo(){let e=this.elevationInfo;this.profile===`mesh-pyramids`&&W(V.getLogger(this),He(`Mesh scene layers`,`relative-to-scene`,e)),W(V.getLogger(this),Ve(`Scene layers`,e))}async fetchStatistics(e,t){return await Ze({fieldName:e,statisticsInfo:this.statisticsInfo,errorContext:`scenelayer`,fieldsIndex:this.fieldsIndex,path:this.parsedUrl?.path??``,customParameters:this.customParameters,apiKey:this.apiKey,signal:t?.signal})}};s([x({types:{key:`type`,base:ye,typeMap:{selection:De}},json:{origins:{"web-scene":{name:`layerDefinition.featureReduction`,write:{allowNull:!0}},"portal-item":{name:`layerDefinition.featureReduction`,write:{allowNull:!0}}}}})],Q.prototype,`featureReduction`,void 0),s([x({type:[J],json:{read:!1,origins:{"web-scene":{name:`layerDefinition.rangeInfos`,write:!0},"portal-item":{name:`layerDefinition.rangeInfos`,write:!0}}},clonable:!1})],Q.prototype,`rangeInfos`,void 0),s([x({json:{read:!1}})],Q.prototype,`associatedLayer`,void 0),s([x({type:[`show`,`hide`]})],Q.prototype,`listMode`,void 0),s([x({type:[`ArcGISSceneServiceLayer`]})],Q.prototype,`operationalLayerType`,void 0),s([x({json:{read:!1},readOnly:!0})],Q.prototype,`type`,void 0),s([x({...Z.fields,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],Q.prototype,`fields`,void 0),s([x()],Q.prototype,`types`,null),s([x()],Q.prototype,`typeIdField`,null),s([x()],Q.prototype,`templates`,null),s([x()],Q.prototype,`formTemplate`,null),s([x({readOnly:!0})],Q.prototype,`graphicOrigin`,void 0),s([x({readOnly:!0,clonable:!1})],Q.prototype,`fieldsIndex`,null),s([x({type:j,json:{read:{source:`layerDefinition.floorInfo`},write:{target:`layerDefinition.floorInfo`}}})],Q.prototype,`floorInfo`,void 0),s([x(Z.outFields)],Q.prototype,`outFields`,void 0),s([x({type:U,readOnly:!0,json:{read:!1},clonable:!1})],Q.prototype,`nodePages`,void 0),s([g(`service`,`nodePages`,[`nodePages`,`pointNodePages`])],Q.prototype,`readNodePages`,null),s([x({type:[Ie],readOnly:!0,clonable:!1})],Q.prototype,`materialDefinitions`,void 0),s([x({type:[Pe],readOnly:!0,clonable:!1})],Q.prototype,`textureSetDefinitions`,void 0),s([x({type:[Fe],readOnly:!0,clonable:!1})],Q.prototype,`geometryDefinitions`,void 0),s([x({readOnly:!0})],Q.prototype,`serviceUpdateTimeStamp`,void 0),s([x({readOnly:!0})],Q.prototype,`attributeStorageInfo`,void 0),s([x({readOnly:!0})],Q.prototype,`statisticsInfo`,void 0),s([x({type:w.ofType(Number),nonNullable:!0,json:{origins:{service:{read:!1,write:!1}},name:`layerDefinition.excludeObjectIds`,write:{enabled:!0}}})],Q.prototype,`excludeObjectIds`,void 0),s([x({type:String,json:{origins:{service:{read:!1,write:!1}},name:`layerDefinition.definitionExpression`,write:{enabled:!0,allowNull:!0}}})],Q.prototype,`definitionExpression`,void 0),s([x({type:Xe,json:{name:`layerDefinition.polygonFilter`,write:{enabled:!0,allowNull:!0},origins:{service:{read:!1,write:!1}}}})],Q.prototype,`filter`,void 0),s([x({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],Q.prototype,`path`,void 0),s([x(pe)],Q.prototype,`elevationInfo`,null),s([x({readOnly:!0,json:{read:!1}})],Q.prototype,`effectiveCapabilities`,null),s([x({readOnly:!0})],Q.prototype,`effectiveEditingEnabled`,null),s([x({type:String})],Q.prototype,`geometryType`,null),s([x(fe)],Q.prototype,`labelsVisible`,void 0),s([x({type:[ge],json:{origins:{service:{name:`drawingInfo.labelingInfo`,read:{reader:p},write:!1}},name:`layerDefinition.drawingInfo.labelingInfo`,read:{reader:p},write:!0}})],Q.prototype,`labelingInfo`,void 0),s([x(f)],Q.prototype,`legendEnabled`,void 0),s([x({type:Number,json:{origins:{"web-document":{default:1,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}},read:{source:[`opacity`,`layerDefinition.drawingInfo.transparency`],reader(e,t){if(typeof e==`number`&&e>=0&&e<=1)return e;let n=t.layerDefinition?.drawingInfo?.transparency;return n===void 0?void 0:o(n)}}},"portal-item":{write:!0},service:{read:!1}}}})],Q.prototype,`opacity`,void 0),s([x({type:[`Low`,`High`],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],Q.prototype,`priority`,void 0),s([x({type:[`Labels`],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],Q.prototype,`semantic`,void 0),s([x({types:Ae,json:{origins:{service:{read:{source:`drawingInfo.renderer`}}},name:`layerDefinition.drawingInfo.renderer`,write:!0},value:null})],Q.prototype,`renderer`,null),s([x({json:{read:!1}})],Q.prototype,`cachedDrawingInfo`,void 0),s([g(`service`,`cachedDrawingInfo`)],Q.prototype,`readCachedDrawingInfo`,null),s([x({readOnly:!0,json:{read:!1}})],Q.prototype,`capabilities`,null),s([x({type:Boolean,json:{read:!1}})],Q.prototype,`editingEnabled`,null),s([x({readOnly:!0,json:{write:!1,read:!1}})],Q.prototype,`infoFor3D`,null),s([x({readOnly:!0,json:{write:!1,read:!1}})],Q.prototype,`relationships`,null),s([x(v)],Q.prototype,`popupEnabled`,void 0),s([x({type:Se,json:{name:`popupInfo`,write:!0}})],Q.prototype,`popupTemplate`,void 0),s([x({readOnly:!0,json:{read:!1}})],Q.prototype,`defaultPopupTemplate`,null),s([x(h)],Q.prototype,`attributeTableTemplate`,void 0),s([x({type:String,json:{read:!1}})],Q.prototype,`objectIdField`,void 0),s([g(`service`,`objectIdField`,[`objectIdField`,`fields`])],Q.prototype,`readObjectIdField`,null),s([x({type:String,json:{read:!1}})],Q.prototype,`globalIdField`,void 0),s([g(`service`,`globalIdField`,[`globalIdField`,`fields`])],Q.prototype,`readGlobalIdField`,null),s([x({readOnly:!0,type:String,json:{read:!1}})],Q.prototype,`displayField`,null),s([x({type:String,json:{read:!1}})],Q.prototype,`profile`,void 0),s([g(`service`,`profile`,[`store.profile`])],Q.prototype,`readProfile`,null),s([x({readOnly:!0,type:String,json:{origins:{service:{read:{source:`store.normalReferenceFrame`}}},read:!1}})],Q.prototype,`normalReferenceFrame`,void 0),s([x(he)],Q.prototype,`screenSizePerspectiveEnabled`,void 0),s([x({json:{read:!1,origins:{service:{read:!0}}}})],Q.prototype,`serviceItemId`,void 0),s([x(Oe)],Q.prototype,`useViewTime`,null),Q=s([R(`esri.layers.SceneLayer`)],Q);var $={"mesh-pyramids":`mesh-pyramids`,meshpyramids:`mesh-pyramids`,"features-meshes":`mesh-pyramids`,points:`points`,"features-points":`points`,lines:`lines`,"features-lines":`lines`,polygons:`polygons`,"features-polygons":`polygons`},tt={"mesh-pyramids":`mesh`,points:`point`},nt=Q;export{nt as default};