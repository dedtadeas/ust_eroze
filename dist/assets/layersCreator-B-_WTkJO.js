import{R as e,SC as t,_x as n}from"./index-BqmCqmfp.js";import{u as r}from"./loadUtils-BWnAUV23.js";import{t as i}from"./lazyLayerLoader-DjJLNY3M.js";import{n as a}from"./portalLayers-DW_lsX5Z.js";function o(e){return l(e,`notes`)}function s(e){return l(e,`markup`)}function c(e){return l(e,`route`)}function l(e,t){return!(!e.layerType||e.layerType!==`ArcGISFeatureLayer`)&&e.featureCollectionType===t}async function u(e,t,n){if(!t)return;let r=t.map(e=>S(e,n)),i=await Promise.allSettled(r);for(let t of i)t.status===`rejected`||t.value&&e.add(t.value)}var d={ArcGISDimensionLayer:`DimensionLayer`,ArcGISFeatureLayer:`FeatureLayer`,ArcGISImageServiceLayer:`ImageryLayer`,ArcGISMapServiceLayer:`MapImageLayer`,ArcGISSceneServiceLayer:`SceneLayer`,ArcGISTiledElevationServiceLayer:`ElevationLayer`,ArcGISTiledImageServiceLayer:`ImageryTileLayer`,ArcGISTiledMapServiceLayer:`TileLayer`,BuildingSceneLayer:`BuildingSceneLayer`,CatalogLayer:`CatalogLayer`,CSV:`CSVLayer`,DefaultTileLayer:`TileLayer`,GaussianSplatLayer:`GaussianSplatLayer`,GeoJSON:`GeoJSONLayer`,GroupLayer:`GroupLayer`,IntegratedMesh3DTilesLayer:`IntegratedMesh3DTilesLayer`,Object3DTilesLayer:`UnsupportedLayer`,IntegratedMeshLayer:`IntegratedMeshLayer`,KML:`KMLLayer`,LineOfSightLayer:`LineOfSightLayer`,MediaLayer:`MediaLayer`,OGCFeatureLayer:`OGCFeatureLayer`,OrientedImageryLayer:`OrientedImageryLayer`,PointCloudLayer:`PointCloudLayer`,RasterDataLayer:`UnsupportedLayer`,VectorTileLayer:`VectorTileLayer`,ViewshedLayer:`ViewshedLayer`,Voxel:`VoxelLayer`,WCS:`WCSLayer`,WFS:`WFSLayer`,WMS:`WMSLayer`,WebTiledLayer:`WebTileLayer`},f={ArcGISTiledElevationServiceLayer:`ElevationLayer`,DefaultTileLayer:`ElevationLayer`,RasterDataElevationLayer:`UnsupportedLayer`},p={ArcGISFeatureLayer:`FeatureLayer`},m={ArcGISImageServiceLayer:`UnsupportedLayer`,ArcGISMapServiceLayer:`UnsupportedLayer`,ArcGISSceneServiceLayer:`SceneLayer`,ArcGISTiledImageServiceLayer:`ImageryTileLayer`,ArcGISTiledMapServiceLayer:`TileLayer`,DefaultTileLayer:`TileLayer`,OpenStreetMap:`OpenStreetMapLayer`,VectorTileLayer:`VectorTileLayer`,WCS:`UnsupportedLayer`,WMS:`UnsupportedLayer`,WebTiledLayer:`WebTileLayer`},h={IntegratedMesh3DTilesLayer:`IntegratedMesh3DTilesLayer`},g={ArcGISAnnotationLayer:`UnsupportedLayer`,ArcGISDimensionLayer:`UnsupportedLayer`,ArcGISFeatureLayer:`FeatureLayer`,ArcGISImageServiceLayer:`ImageryLayer`,ArcGISImageServiceVectorLayer:`ImageryLayer`,ArcGISMapServiceLayer:`MapImageLayer`,ArcGISStreamLayer:`StreamLayer`,ArcGISTiledImageServiceLayer:`ImageryTileLayer`,ArcGISTiledMapServiceLayer:`TileLayer`,ArcGISVideoLayer:`VideoLayer`,BingMapsAerial:`BingMapsLayer`,BingMapsHybrid:`BingMapsLayer`,BingMapsRoad:`BingMapsLayer`,CatalogLayer:`CatalogLayer`,CSV:`CSVLayer`,DefaultTileLayer:`TileLayer`,GeoJSON:`GeoJSONLayer`,GeoRSS:`GeoRSSLayer`,GroupLayer:`GroupLayer`,KML:`KMLLayer`,KnowledgeGraphLayer:`KnowledgeGraphLayer`,MediaLayer:`MediaLayer`,OGCFeatureLayer:`OGCFeatureLayer`,OrientedImageryLayer:`OrientedImageryLayer`,SubtypeGroupLayer:`SubtypeGroupLayer`,VectorTileLayer:`VectorTileLayer`,WCS:`WCSLayer`,WFS:`WFSLayer`,WMS:`WMSLayer`,WebTiledLayer:`WebTileLayer`},_={ArcGISFeatureLayer:`FeatureLayer`,SubtypeGroupTable:`SubtypeGroupLayer`},v={ArcGISImageServiceLayer:`ImageryLayer`,ArcGISImageServiceVectorLayer:`ImageryLayer`,ArcGISMapServiceLayer:`MapImageLayer`,ArcGISTiledImageServiceLayer:`ImageryTileLayer`,ArcGISTiledMapServiceLayer:`TileLayer`,BingMapsAerial:`BingMapsLayer`,BingMapsHybrid:`BingMapsLayer`,BingMapsRoad:`BingMapsLayer`,DefaultTileLayer:`TileLayer`,OpenStreetMap:`OpenStreetMapLayer`,VectorTileLayer:`VectorTileLayer`,WCS:`WCSLayer`,WMS:`WMSLayer`,WebTiledLayer:`WebTileLayer`},y={...g,LinkChartLayer:`LinkChartLayer`},b={..._},x={...v};async function S(e,t){return C(await w(e,t),e,t)}async function C(t,n,r){let i=new t;return i.read(n,r.context),i.type===`group`&&(n.layerType===`GroupLayer`?await O(i,n,r):E(n)?k(i,n,r.context):T(n)&&await A(i,n,r.context)),await e(i,r.context),i}async function w(e,t){let l=t.context,u=D(l),d=e.layerType||e.type;!d&&t?.defaultLayerType&&(d=t.defaultLayerType);let f=u[d],p=f?i[f]:i.UnknownLayer;if(E(e)){let t=l?.portal;if(e.itemId){let o=new n({id:e.itemId,portal:t});await o.load();let s=(await a(o,new r)).className||`UnknownLayer`;p=i[s]}}else d===`ArcGISFeatureLayer`?o(e)||s(e)?p=i.MapNotesLayer:c(e)?p=i.RouteLayer:T(e)&&(p=i.GroupLayer):e.wmtsInfo?.url&&e.wmtsInfo.layerIdentifier?p=i.WMTSLayer:d===`WFS`&&e.wfsInfo?.version!==`2.0.0`&&(p=i.UnsupportedLayer);return p()}function T(e){return e.layerType!==`ArcGISFeatureLayer`||E(e)?!1:(e.featureCollection?.layers?.length??0)>1}function E(e){return e.type===`Feature Collection`}function D(e){let t;switch(e.origin){case`web-scene`:switch(e.layerContainerType){case`basemap-base-layers`:t=m;break;case`basemap-ground-layers`:t=h;break;case`ground`:t=f;break;case`tables`:t=p;break;default:t=d}break;case`link-chart`:switch(e.layerContainerType){case`basemap-base-layers`:t=x;break;case`tables`:t=b;break;default:t=y}break;default:switch(e.layerContainerType){case`basemap-base-layers`:t=v;break;case`tables`:t=_;break;default:t=g}}return t}async function O(e,n,r){let i=new t,a=u(i,Array.isArray(n.layers)?n.layers:[],r);try{try{if(await a,e.type===`group`)return e.layers.addMany(i),e}catch(t){e.destroy();for(let e of i)e.destroy();throw t}}catch(e){throw e}}function k(e,t,r){t.itemId&&(e.portalItem=new n({id:t.itemId,portal:r?.portal}),e.when(()=>{let n=n=>{let i=n.layerId;j(n,e,t,i,r);let a=t.featureCollection?.layers?.[i];a&&n.read(a,r)};e.layers?.forEach(n),e.tables?.forEach(n)}))}async function A(e,t,n){let r=i.FeatureLayer,a=await r(),o=t.featureCollection,s=o?.showLegend,c=o?.layers?.map((r,i)=>{let o=new a;o.read(r,n);let c={...n,ignoreDefaults:!0};return j(o,e,t,i,c),s!=null&&o.read({showLegend:s},c),o});e.layers.addMany(c??[])}function j(e,t,n,r,i){e.read({id:`${t.id}-sublayer-${r}`,visibility:n.visibleLayers?.includes(r)??!0},i)}export{u as n,O as t};