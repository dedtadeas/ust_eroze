import{CD as e,Us as t,Vs as n,_E as r,fT as i,kE as a,vE as o}from"./index-BqmCqmfp.js";import{n as s}from"./ProgramTemplate-ks-pn-xm.js";import{t as c}from"./ShaderBuilder-C3C7fUwK.js";var l=class{constructor(){this.drawPhase=89}startup(){}shutdown(e){}};function u(e){return e.split(` `).map((e,t)=>t>0?e.charAt(0).toUpperCase()+e.slice(1):e).join(``)}function d(e,t){let n=[];for(n.push(t);n.length;){let t=n.pop();if(typeof t==`object`&&!e.has(t.uid)){e.add(t.uid);for(let e of t.children)n.push(e)}}}var f=class e{constructor(){this.uid=e.NodeCount++,this._debugName=null,this._isMutable=!1,this.isImplicit=!1}static{this.NodeCount=0}get isMutable(){return this._isMutable}setMutable(){return this._isMutable=!0,this}setDebugName(t){return t=u(t),this._debugName=t,this.isImplicit&&this.children[0]instanceof e&&this.children[0].setDebugName(t),this}get debugInfo(){return{name:this._debugName??``}}cloneInto(e){e._debugName=this._debugName,e._isMutable=this._isMutable,e.isImplicit=this.isImplicit,e.uid=this.uid}};function p(e){return typeof e==`object`?e.clone():e}var m=class extends f{constructor(){super(...arguments),this.shaderType=`primitive-node`}},h=class e extends f{constructor(e){super(),this.child=e,this.shaderType=`scope-node`}get children(){return[this.child]}clone(){let t=new e(p(this.child));return this.cloneInto(t),t}},g=class e extends f{constructor(e,t,n){super(),this.property=e,this.target=t,this.returnType=n,this.shaderType=`property-access-node`}get children(){let e=[this.target];return typeof this.property!=`string`&&e.push(this.property),e}clone(){let t=new e(this.property,p(this.target),this.returnType);return this.cloneInto(t),t}},_=class e extends f{constructor(e,t,n,r){super(),this.x=e,this.y=t,this.target=n,this.returnType=r,this.shaderType=`property-access-2d-node`}get children(){return[this.target,this.x,this.y]}clone(){let t=new e(this.x,this.y,p(this.target),this.returnType);return this.cloneInto(t),t}},v=class e extends f{constructor(e,t,n){super(),this.condition=e,this.ifTrue=t,this.ifFalse=n,this.shaderType=`condition-node`}get children(){return[this.condition,this.ifTrue,this.ifFalse]}clone(){let t=p(this.ifTrue),n=this.ifFalse?p(this.ifFalse):null,r=new e(this.condition,t,n);return this.cloneInto(r),r}},ee=class e extends f{constructor(e,t,n,r){super(),this.captureList=e,this.returnType=t,this.generator=r,this.shaderType=`block-node`,n&&(this.subgraph=new h(n))}get children(){return Object.keys(this.captureList).map(e=>this.captureList[e]).concat(this.subgraph??[])}clone(){let t={};for(let e in this.captureList)t[e]=p(this.captureList[e]);let n=new e(t,this.returnType,this.subgraph?p(this.subgraph.child):this.subgraph,this.generator);return this.cloneInto(n),n}},y=class e extends f{constructor(e,t,n,r,i,a=!1){super(),this.token=e,this._children=t,this.isInfix=n,this.isPropertyAccess=r,this.returnType=i,this.isTernary=a,this.shaderType=`function-node`}get children(){return this._children}clone(){let t=new e(this.token,this._children.map(p),this.isInfix,this.isPropertyAccess,this.returnType,this.isTernary);return this.cloneInto(t),t}},b,te,ne,re,x,ie,ae,oe,se,ce,le,ue,de,fe;function pe(e){switch(e.type){case`bool`:case`bvec2`:case`bvec3`:case`bvec4`:return A;case`float`:case`vec2`:case`vec3`:case`vec4`:return T;case`int`:case`ivec2`:case`ivec3`:case`ivec4`:return M;case`uint`:case`uvec2`:case`uvec3`:case`uvec4`:return k;default:throw Error(`Unable to handle type`)}}function me(e){for(let t of[[`float`,`vec2`,`vec3`,`vec4`],[`int`,`ivec2`,`ivec3`,`ivec4`],[`uint`,`uvec2`,`uvec3`,`uvec4`],[`bool`,`bvec2`,`bvec3`,`bvec4`]])if(t.includes(e))return t.map(e=>Ae[e]);throw Error(`Unable to find type family`)}function he(e){return new Proxy(e,{get(t,n){if(n===`constructor`)return new Proxy(t.constructor,{construct:(e,t,n)=>he(new e(...t))});if(n in t)return t[n];if(typeof n==`string`){let t=me(e.type);return F(e,n,t[n.length-1])}}})}function S(e){return new Proxy(e,{construct:(e,t,n)=>he(new e(...t))})}function ge(e){return new Proxy(e,{get(t,n){if(n in t)return t[n];if(typeof n==`string`){let t=parseInt(n,10);if(!isNaN(t))return F(e,`[${t}]`,e.elementType.constructor)}}})}function _e(e){return new Proxy(e,{construct:(e,t,n)=>ge(new e(...t))})}var C=class extends Error{},w=class extends m{static{b=this}static{this.type=`array`}constructor(e,t){super(),this.elementType=e,this.size=t,this.children=[],this.type=`array`}clone(){let e=new b(this.elementType,this.size);return super.cloneInto(e),e}get(e,t){let n=new M(e),r=t==null?null:new M(t);return r==null?F(this,n,this.elementType.constructor):I(this,n,r,pe(this.elementType.constructor))}last(){return this.get(this.size-1)}first(){return this.get(0)}findIndex(e,t,n){return Re(this,e,t,n)}glslFindIndex(e,t,n){return ze(this,e,t,n)}static ofType(e,t){return new Proxy(b,{construct:(n,r)=>new b(new e,t)})}};w=b=e([_e],w);var ve=class e extends m{static{this.type=`array-2d`}constructor(e,t,n,r=!1){super(),this.elementType=e,this.xSize=t,this.ySize=n,this.isRowMajor=r,this.children=[],this.type=`array-2d`}clone(){let t=new e(this.elementType,this.xSize,this.ySize,this.isRowMajor);return super.cloneInto(t),t}get size(){return this.xSize*this.ySize}get(e,t){return this.isRowMajor?this._getRowMajor(e,t):this._getColumnMajor(e,t)}_getColumnMajor(e,t){let n=new M(e);return F(this,new M(t).add(n.multiply(this.xSize)),this.elementType.constructor)}_getRowMajor(e,t){let n=new M(e),r=new M(t);return F(this,n.add(r.multiply(this.ySize)),this.elementType.constructor)}static ofType(t,n,r,i=!1){return new Proxy(w,{construct:(a,o)=>new e(new t,n,r,i)})}},ye=class e extends m{constructor(){super(...arguments),this.type=`sampler2D`,this.children=[]}static{this.type=`sampler2D`}clone(){let t=new e;return t.children=this.children.map(p),super.cloneInto(t),t}},T=class e extends m{static{this.type=`float`}constructor(e){super(),this.type=`float`,this.children=[e]}clone(){let t=new e(p(this.children[0]));return super.cloneInto(t),t}multiply(t){return H(this,typeof t==`number`?j(t,e):t)}divide(t){return U(this,typeof t==`number`?j(t,e):t)}add(t){return W(this,typeof t==`number`?j(t,e):t)}subtract(t){return G(this,typeof t==`number`?j(t,e):t)}},E=class extends m{static{te=this}static{this.type=`vec2`}constructor(e,t){super(),this.type=`vec2`,this.children=[e,t].filter(e=>e!=null)}clone(){let e=new te(p(this.children[0]),p(this.children[1]));return super.cloneInto(e),e}get 0(){return F(this,`[0]`,T)}get 1(){return F(this,`[1]`,T)}get 2(){throw new C}get 3(){throw new C}multiply(e){return H(this,typeof e==`number`?j(e,T):e)}divide(e){return U(this,typeof e==`number`?j(e,T):e)}add(e){return W(this,typeof e==`number`?j(e,T):e)}subtract(e){return G(this,typeof e==`number`?j(e,T):e)}};E=te=e([S],E);var D=class extends m{static{ne=this}static{this.type=`vec3`}constructor(e,t,n){super(),this.type=`vec3`,this.children=[e,t,n].filter(e=>e!=null)}get 0(){return F(this,`[0]`,T)}get 1(){return F(this,`[1]`,T)}get 2(){return F(this,`[2]`,T)}get 3(){throw new C}clone(){let e=new ne(p(this.children[0]),p(this.children[1]),p(this.children[2]));return super.cloneInto(e),e}multiply(e){return H(this,typeof e==`number`?j(e,T):e)}divide(e){return U(this,typeof e==`number`?j(e,T):e)}add(e){return W(this,typeof e==`number`?j(e,T):e)}subtract(e){return G(this,typeof e==`number`?j(e,T):e)}};D=ne=e([S],D);var O=class extends m{static{re=this}static{this.type=`vec4`}constructor(e,t,n,r){super(),this.type=`vec4`,this.children=[e,t,n,r].filter(e=>e!=null)}clone(){let e=new re(p(this.children[0]),p(this.children[1]),p(this.children[2]),p(this.children[3]));return super.cloneInto(e),e}get 0(){return F(this,`[0]`,T)}get 1(){return F(this,`[1]`,T)}get 2(){return F(this,`[2]`,T)}get 3(){return F(this,`[3]`,T)}multiply(e){return H(this,typeof e==`number`?j(e,T):e)}divide(e){return U(this,typeof e==`number`?j(e,T):e)}add(e){return W(this,typeof e==`number`?j(e,T):e)}subtract(e){return G(this,typeof e==`number`?j(e,T):e)}};O=re=e([S],O);var k=class extends m{static{x=this}static{this.type=`uint`}constructor(e){super(),this.type=`uint`,this.children=[e]}clone(){let e=new x(p(this.children[0]));return super.cloneInto(e),e}multiply(e){return H(this,j(e,x))}add(e){return W(this,j(e,x))}subtract(e){return G(this,j(e,x))}divide(e){return U(this,j(e,x))}};k=x=e([S],k);var be=class extends m{static{ie=this}static{this.type=`uvec2`}constructor(e,t){super(),this.type=`uvec2`,this.children=[e,t].filter(e=>e!=null)}clone(){let e=new ie(p(this.children[0]),p(this.children[1]));return super.cloneInto(e),e}get 0(){return F(this,`[0]`,M)}get 1(){return F(this,`[1]`,M)}get 2(){throw new C}get 3(){throw new C}multiply(e){return H(this,typeof e==`number`?j(e,k):e)}divide(e){return U(this,typeof e==`number`?j(e,k):e)}add(e){return W(this,typeof e==`number`?j(e,k):e)}subtract(e){return G(this,typeof e==`number`?j(e,k):e)}};be=ie=e([S],be);var xe=class extends m{static{ae=this}static{this.type=`uvec3`}constructor(e,t,n){super(),this.type=`uvec3`,this.children=[e,t,n].filter(e=>e!=null)}clone(){let e=new ae(p(this.children[0]),p(this.children[1]),p(this.children[2]));return super.cloneInto(e),e}get 0(){return F(this,`[0]`,k)}get 1(){return F(this,`[1]`,k)}get 2(){return F(this,`[2]`,k)}get 3(){throw new C}multiply(e){return H(this,typeof e==`number`?j(e,k):e)}divide(e){return U(this,typeof e==`number`?j(e,k):e)}add(e){return W(this,typeof e==`number`?j(e,k):e)}subtract(e){return G(this,typeof e==`number`?j(e,k):e)}};xe=ae=e([S],xe);var Se=class extends m{static{oe=this}static{this.type=`uvec4`}constructor(e,t,n,r){super(),this.type=`uvec4`,this.children=[e,t,n,r].filter(e=>e!=null)}clone(){let e=new oe(p(this.children[0]),p(this.children[1]),p(this.children[2]),p(this.children[3]));return super.cloneInto(e),e}get 0(){return F(this,`[0]`,k)}get 1(){return F(this,`[1]`,k)}get 2(){return F(this,`[2]`,k)}get 3(){return F(this,`[3]`,k)}multiply(e){return H(this,typeof e==`number`?j(e,k):e)}divide(e){return U(this,typeof e==`number`?j(e,k):e)}add(e){return W(this,typeof e==`number`?j(e,k):e)}subtract(e){return G(this,typeof e==`number`?j(e,k):e)}};Se=oe=e([S],Se);var A=class e extends m{static{this.type=`bool`}constructor(e){super(),this.type=`bool`,this.children=[e]}and(e){return at(this,e)}or(e){return tt(this,e)}xor(e){return rt(this,e)}clone(){let t=new e(p(this.children[0]));return super.cloneInto(t),t}},Ce=class extends m{static{se=this}static{this.type=`bvec2`}constructor(e,t){super(),this.type=`bvec2`,this.children=[e,t].filter(e=>e!=null)}all(){return ut(this)}any(){return dt(this)}clone(){let e=new se(p(this.children[0]),p(this.children[1]));return super.cloneInto(e),e}};Ce=se=e([S],Ce);var we=class extends m{static{ce=this}static{this.type=`bvec3`}constructor(e,t,n){super(),this.type=`bvec3`,this.children=[e,t,n].filter(e=>e!=null)}all(){return ut(this)}any(){return dt(this)}clone(){let e=new ce(p(this.children[0]),p(this.children[1]),p(this.children[2]));return super.cloneInto(e),e}};function j(e,t){return typeof e==`number`?new t(e):e}we=ce=e([S],we);var Te=class extends m{static{le=this}static{this.type=`bvec4`}constructor(e,t,n,r){super(),this.type=`bvec4`,this.children=[e,t,n,r].filter(e=>e!=null)}all(){return ut(this)}any(){return dt(this)}clone(){let e=new le(p(this.children[0]),p(this.children[1]),p(this.children[2]),p(this.children[3]));return super.cloneInto(e),e}};Te=le=e([S],Te);var M=class e extends m{static{this.type=`int`}constructor(e){super(),this.type=`int`,this.children=[e]}multiply(t){return H(this,j(t,e))}add(t){return W(this,j(t,e))}subtract(t){return G(this,j(t,e))}divide(t){return U(this,j(t,e))}clone(){let t=new e(p(this.children[0]));return super.cloneInto(t),t}},N=class extends m{static{ue=this}static{this.type=`ivec2`}constructor(e,t){super(),this.type=`ivec2`,this.children=[e,t].filter(e=>e!=null)}clone(){let e=new ue(p(this.children[0]),p(this.children[1]));return super.cloneInto(e),e}get 0(){return F(this,`[0]`,M)}get 1(){return F(this,`[1]`,M)}get 2(){throw new C}get 3(){throw new C}multiply(e){return H(this,typeof e==`number`?j(e,M):e)}divide(e){return U(this,typeof e==`number`?j(e,M):e)}add(e){return W(this,typeof e==`number`?j(e,M):e)}subtract(e){return G(this,typeof e==`number`?j(e,M):e)}};N=ue=e([S],N);var Ee=class extends m{static{de=this}static{this.type=`ivec3`}constructor(e,t,n){super(),this.type=`ivec3`,this.children=[e,t,n].filter(e=>e!=null)}clone(){let e=new de(p(this.children[0]),p(this.children[1]),p(this.children[2]));return super.cloneInto(e),e}get 0(){return F(this,`[0]`,M)}get 1(){return F(this,`[1]`,M)}get 2(){return F(this,`[2]`,M)}get 3(){throw new C}multiply(e){return H(this,typeof e==`number`?j(e,M):e)}divide(e){return U(this,typeof e==`number`?j(e,M):e)}add(e){return W(this,typeof e==`number`?j(e,M):e)}subtract(e){return G(this,typeof e==`number`?j(e,M):e)}};Ee=de=e([S],Ee);var P=class extends m{static{fe=this}static{this.type=`ivec4`}constructor(e,t,n,r){super(),this.type=`ivec4`,this.children=[e,t,n,r].filter(e=>e!=null)}clone(){let e=new fe(p(this.children[0]),p(this.children[1]),p(this.children[2]),p(this.children[3]));return super.cloneInto(e),e}get 0(){return F(this,`[0]`,M)}get 1(){return F(this,`[1]`,M)}get 2(){return F(this,`[2]`,M)}get 3(){return F(this,`[3]`,M)}multiply(e){return H(this,typeof e==`number`?j(e,M):e)}divide(e){return U(this,typeof e==`number`?j(e,M):e)}add(e){return W(this,typeof e==`number`?j(e,M):e)}subtract(e){return G(this,typeof e==`number`?j(e,M):e)}};P=fe=e([S],P);var De=class e extends m{static{this.type=`mat2`}constructor(e,t,n,r){super(),this.type=`mat2`,this.children=[e,t,n,r]}clone(){let t=new e(p(this.children[0]),p(this.children[1]),p(this.children[2]),p(this.children[3]));return super.cloneInto(t),t}get(e,t){return I(this,new M(e),new M(t),T)}multiply(e){return H(this,e)}},Oe=class e extends m{static{this.type=`mat3`}static identity(){return new e(1,0,0,0,1,0,0,0,1)}static fromRotation(t){let n=Lt(t),r=vt(t);return new e(r,n,0,Le(n),r,0,0,0,1)}constructor(e,t,n,r,i,a,o,s,c){super(),this.type=`mat3`,this.children=[e,t,n,r,i,a,o,s,c]}add(e){return W(this,e)}multiply(e){return H(this,e)}get(e,t){return I(this,new M(e),new M(t),T)}clone(){let t=new e(p(this.children[0]),p(this.children[1]),p(this.children[2]),p(this.children[3]),p(this.children[4]),p(this.children[5]),p(this.children[6]),p(this.children[7]),p(this.children[8]));return super.cloneInto(t),t}},ke=class e extends m{static{this.type=`mat4`}static identity(){return new e(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}constructor(e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h){super(),this.type=`mat4`,this.children=[e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h]}static fromColumns(t,n,r,i){return new e(t.x,t.y,t.z,t.w,n.x,n.y,n.z,n.w,r.x,r.y,r.z,r.w,i.x,i.y,i.z,i.w)}multiply(e){return H(this,e)}get(e,t){return I(this,new M(e),new M(t),T)}clone(){let t=new e(p(this.children[0]),p(this.children[1]),p(this.children[2]),p(this.children[3]),p(this.children[4]),p(this.children[5]),p(this.children[6]),p(this.children[7]),p(this.children[8]),p(this.children[9]),p(this.children[10]),p(this.children[11]),p(this.children[12]),p(this.children[13]),p(this.children[14]),p(this.children[15]));return super.cloneInto(t),t}},Ae={float:T,vec2:E,vec3:D,vec4:O,int:M,ivec2:N,ivec3:Ee,ivec4:P,uint:k,uvec2:be,uvec3:xe,uvec4:Se,bool:A,bvec2:Ce,bvec3:we,bvec4:Te},je=(...e)=>new M(...e),Me=(...e)=>new T(...e),Ne=(...e)=>new E(...e),Pe=(...e)=>new D(...e),Fe=(...e)=>new O(...e),Ie=(...e)=>new Oe(...e);function F(e,t,n){let r=new n(new g(t,e,n));return r.isImplicit=!0,r}function I(e,t,n,r){let i=new r(new _(t,n,e,r));return i.isImplicit=!0,i}function L(e,t,n,r=null){if(r){let i=new r,a=new r(new y(e,[t,n],!0,!1,i));return a.isImplicit=!0,a}if(t.type===`float`||t.type===`int`){let r=new n.constructor(new y(e,[t,n],!0,!1,n.constructor));return r.isImplicit=!0,r}if((t.type===`mat2`||t.type===`mat3`||t.type===`mat4`)&&n.type!==`float`){let r=new n.constructor(new y(e,[t,n],!0,!1,n.constructor));return r.isImplicit=!0,r}let i=new t.constructor(new y(e,[t,n],!0,!1,t.constructor));return i.isImplicit=!0,i}function R(e,t,n=t.constructor){let r=new n(new y(e,[t],!1,!1,n));return r.isImplicit=!0,r}function z(e,t,n,r=t.constructor){let i=new r(new y(e,[t,n],!1,!1,r));return i.isImplicit=!0,i}function B(e,t,n,r,i=t.constructor){let a=new i(new y(e,[t,n,r],!1,!1,i));return a.isImplicit=!0,a}function Le(e){return H(e,Me(-1))}function V(e,t,n,r){return new t(new ee(e,t,n,r))}function Re(e,t,n=0,r=e.size){let i=new M(n).setMutable().setDebugName(`FindIndexIterator`),a=t(e.get(i)).setDebugName(`FindIndexPredicate`);return V({iter:i},M,a,({out:e,iter:t,subgraph:n})=>`\n${e} = -1;\n\nfor (; ${t} < ${r}; ${t}++) {\n\n${n.body}\n\n  if (${n.varName}) {\n    ${e} = ${t};\n    break;\n  }\n\n}\n`).setDebugName(`FindIndexBlock`)}function ze(e,t,n=0,r=e.size){return V({array:e},M,null,({out:e,array:i})=>`\n${e} = -1;\nfor (int i = ${n}; i < ${r}; i++) {\n  bool condition;\n  ${t({array:i,i:`i`,out:`condition`})}\n  if (condition) {\n    ${e} = i;\n    break;\n  }\n}\n`).setDebugName(`GlslFindIndexBlock`)}function Be(e,t,n){let r=typeof t==`function`?t():t,i=typeof n==`function`?n():n,a=new r.constructor(new v(e,r,i));return a.isImplicit=!0,a}function Ve(...e){let t=e.map(([e,t])=>typeof t==`function`?[e,t()]:[e,t]),n=t[0][1].constructor,r=t.findIndex(e=>!0===e[0]);if(r===-1)throw Error("A cond must have a fallthrough case with `true`/; ");let i=t.slice(0,r),a=t[r][1],o=new n(i.reduceRight((e,t)=>Be(t[0],t[1],e),a));return o.isImplicit=!0,o}function H(e,t){return L(`*`,e,t)}function U(e,t){return L(`/`,e,t)}function W(e,t){return L(`+`,e,t)}function G(e,t){return L(`-`,e,t)}function He(e,t){return L(`%`,e,t)}function Ue(e,t){return L(`<<`,e,t)}function We(e,t){return L(`>>`,e,t)}function Ge(e,t){return L(`&`,e,t)}function Ke(e,t){return L(`|`,e,t)}function qe(e,t){return L(`^`,e,t)}function Je(e){return R(`~`,e)}function Ye(e,t){return L(`==`,e,t,A)}function Xe(e,t){return L(`!=`,e,t,A)}function Ze(e,t){return L(`<`,e,t,A)}function Qe(e,t){return L(`<=`,e,t,A)}function $e(e,t){return L(`>`,e,t,A)}function et(e,t){return L(`>=`,e,t,A)}function tt(...e){return e.length<=1?e[0]:e.slice(1).reduce((e,t)=>nt(e,t),e[0])}function nt(e,t){return L(`||`,e,t,A)}function rt(...e){return e.length<=1?e[0]:e.slice(1).reduce((e,t)=>it(e,t),e[0])}function it(e,t){return L(`^^`,e,t,A)}function at(...e){return e.length<=1?e[0]:e.slice(1).reduce((e,t)=>ot(e,t),e[0])}function ot(e,t){return L(`&&`,e,t,A)}function st(e){return R(`abs`,e)}function ct(e){return R(`acos`,e)}function lt(e){return R(`acosh`,e)}function ut(e){return R(`all`,e,A)}function dt(e){return R(`any`,e,A)}function ft(e){return R(`asin`,e)}function pt(e){return R(`asinh`,e)}function mt(e,t){return t==null?R(`atan`,e):z(`atan`,e,t,e.constructor)}function ht(e){return R(`atanh`,e)}function gt(e){return R(`ceil`,e)}function _t(e,t,n){return B(`clamp`,e,t,n,e.constructor)}function vt(e){return R(`cos`,e)}function yt(e){return R(`cosh`,e)}function bt(e,t){return z(`distance`,e,t,T)}function xt(e,t){return z(`dot`,e,t,T)}function St(e){return R(`exp`,e)}function Ct(e){return R(`floor`,e)}function wt(e){return R(`fract`,e)}function Tt(e){return R(`length`,e,T)}function Et(e){return R(`log`,e)}function Dt(e){return R(`log2`,e)}function Ot(e,t){return z(`max`,e,t)}function kt(e,t){return z(`min`,e,t)}function At(e,t,n){return B(`mix`,e,t,n)}function jt(e,t){return z(`mod`,e,t)}function Mt(e){return R(`normalize`,e)}function Nt(e){return e.type===`bool`?R(`!`,e):R(`not`,e)}function Pt(e,t){return z(`pow`,e,t)}function Ft(e){return R(`round`,e)}function It(e){return R(`sign`,e)}function Lt(e){return R(`sin`,e)}function Rt(e){return R(`sinh`,e)}function zt(e,t,n){return B(`smoothstep`,e,t,n)}function Bt(e){return R(`sqrt`,e)}function Vt(e,t){return z(`step`,e,t,t.constructor)}function Ht(e){return R(`tan`,e)}function Ut(e){return R(`tanh`,e)}function Wt(e,t,n){return B(`texelFetch`,e,t,n,O)}function Gt(e,t){return z(`texture`,e,t,O)}function Kt(e,t){let{initialValue:n,xRange:r,yRange:i,callback:a}=t,[o,s]=r,[c,l]=i,u=new M(0).setMutable().setDebugName(`iterX`),d=new M(0).setMutable().setDebugName(`iterY`),f=n.setMutable().setDebugName(`accumulator`),p=a(f,e.get(u,d),u,d).setDebugName(`callback`);return V({iterX:u,iterY:d,accumulator:f},n.constructor,p,({out:e,iterX:t,iterY:n,accumulator:r,subgraph:i})=>`\nfor (${n} = ${c}; ${n} < ${l}; ${n}++) {\n  for (${t} = ${o}; ${t} < ${s}; ${t}++) {\n\n  ${i.body}\n\n  ${r} = ${i.varName};\n  }\n}\n${e} = ${r};\n`).setDebugName(`reduce2DBody`)}var K=5;function q(e,t,n){let r=t.split(`
`);for(let t of r)if(t.trim().length){{let t=``;n!=null&&(t+=`/*id:${n??`000`}*/   `),e.body+=t.padEnd(14)}e.body+=` `.repeat(e.indent)+t+`
`}}var qt=class{write(e){for(let t of e.rootOutputNodes())e.shouldPruneOutputNode(t)||(t.variableName=this._write(e,t.node));return e}_createVarName(e,t){let n=``;return typeof t!=`boolean`&&typeof t!=`number`&&t.debugInfo.name&&(n=`${t.debugInfo.name}_`),`${n}v${e.varCount++}`}_write(e,t,n=!1){if(typeof t==`number`||typeof t==`boolean`)return t.toString();let r=e.getEmit(t);if(r)return r;switch(t.shaderType){case`scope-node`:r=this._writeScopeNode(e,t);break;case`primitive-node`:r=this._writePrimitiveNode(e,t,n);break;case`function-node`:r=this._writeFunctionNode(e,t);break;case`property-access-node`:r=this._writePropertyAccessNode(e,t);break;case`property-access-2d-node`:r=this._writePropertyAccess2DNode(e,t);break;case`text-node`:r=t.text;break;case`block-node`:r=this._writeBlockNode(e,t);break;case`condition-node`:r=this._writeConditionNode(e,t)}return e.setEmit(t,r),r}_writeScopeNode(e,t){let n=new t.child.constructor;n.setDebugName(t.debugInfo.name);let r=this._write(e,n,!0);return q(e,`{ /*ScopeStart: ${t.uid} ${t.debugInfo.name}*/`),e.indent+=2,q(e,`${r} = ${this._write(e,t.child)};`),e.indent-=2,q(e,`} /*ScopeEnd: ${t.uid} ${t.debugInfo.name}*/`),r}_writeConditionNode(e,t){let n=new t.ifTrue.constructor,r=this._write(e,n,!0);q(e,`if (${this._write(e,t.condition)}) {`),e.indent+=2;let i=e.createSubgraphContext(),a=this._write(i,t.ifTrue);if(e.body+=i.body,a&&q(e,`${r} = ${a};`),e.indent-=2,q(e,`}`),t.ifFalse){q(e,`else {`),e.indent+=2;let n=e.createSubgraphContext(),i=this._write(n,t.ifFalse);e.body+=n.body,i&&q(e,`${r} = ${i};`),e.indent-=2,q(e,`}`)}return r}_writeBlockNode(e,t){let{captureList:n,generator:r,returnType:i}=t,a={};for(let t in n)n[t]&&(a[t]=this._write(e,n[t]));let o=new i,s=this._write(e,o,!0);if(a.out=s,t.subgraph){let n=e.createSubgraphContext(),r=this._write(n,t.subgraph.child),i=n.body;a.subgraph={varName:r,body:i}}let c=r(a);return q(e,`{
`),e.indent+=2,q(e,c),e.indent-=2,q(e,`}
`),s}_writePropertyAccessNode(e,t){let n=this._write(e,t.target);return typeof t.property==`string`&&t.property.includes(`[`)?`${n}${t.property}`:typeof t.property==`string`?`${n}.${t.property}`:`${n}[${this._write(e,t.property)}]`}_writePropertyAccess2DNode(e,t){return`${this._write(e,t.target)}[${this._write(e,t.x)}][${this._write(e,t.y)}]`}_writeFunctionNode(e,t){let n=t.returnType.type;if(t.isInfix){let[r,i]=t.children.map(t=>this._write(e,t)),a=this._createVarName(e,t);return q(e,`${n.padEnd(K)} ${a} = ${r} ${t.token} ${i};`,t.uid),a}let r=t.children.map(t=>this._write(e,t)).join(`, `),i=this._createVarName(e,t);return q(e,`${n.padEnd(K)} ${i} = ${t.token}(${r});`,t.uid),i}_writePrimitiveNode(e,t,n=!1){let r=e.getInput(t);if(r)return r.isUsed=!0,r.variableName;let i=t.children.length===1&&t.children[0]?.type===t.type;if(!t.isMutable&&(t.isImplicit||i))return this._write(e,t.children[0]);let a=this._createVarName(e,t);if(n)return q(e,`${t.type.padEnd(K)} ${a};`,t.uid),a;let o=!t.debugInfo.name&&!t.isMutable;if(o&&t.type===`float`&&typeof t.children[0]==`number`)return Number.isInteger(t.children[0])?t.children[0].toFixed(1):t.children[0].toString();if(o&&t.type===`int`&&typeof t.children[0]==`number`&&Number.isInteger(t.children[0]))return t.children[0].toString();let s=t.children.map(t=>this._write(e,t)).join(`, `);return t.type===`array`?(q(e,`${t.type.padEnd(K)} ${a} = [${s}];`,t.uid),a):o?`${t.type}(${s})`:(q(e,`${t.type.padEnd(K)} ${a} = ${t.type}(${s});`,t.uid),a)}},J=class e{constructor(e,t,n,r=[]){this.variableName=e,this.variableInputType=t,this.node=n,this.qualifiers=r,this.type=`shader-input`,this.isUsed=!1}clone(){return new e(this.variableName,this.variableInputType,p(this.node),[...this.qualifiers])}},Y=class e{constructor(e,t,n,r=[]){this.outVariableName=e,this.outVariableType=t,this.node=n,this.qualifiers=r,this.type=`shader-output`}clone(){let t=new e(this.outVariableName,this.outVariableType,p(this.node),[...this.qualifiers]);return t.variableName=this.variableName,t}},Jt=class e{static createVertex(t,n,r,i,a,o){let s=[];for(let e in t){let n=t[e],i=r.get(e);i?s.push(new J(i,`builtin`,n)):s.push(new J(`a_`+e,`in`,n))}for(let e of i){let t=e.uniformHydrated;s.push(new J(e.uniformName,`uniform`,t))}let c=[];for(let e in n){let t=n[e];if(e===`glPosition`)c.push(new Y(`gl_Position`,`builtin`,t));else if(e===`glPointSize`)c.push(new Y(`gl_PointSize`,`builtin`,t));else{let n=Yt(t),r=[];n&&r.push(n),c.push(new Y(`v_`+e,`out`,t,r))}}return new e(s,c,a,o)}static createFragment(t,n,r,i,a,o){let s=[],c=Array.from(a.rootOutputNodes());for(let e in t){let n=t[e],i=r.get(e);if(i){s.push(new J(i,`builtin`,n));continue}let a=c.find(e=>e.node===n);a&&s.push(new J(a.outVariableName,`in`,n))}for(let e of i){let t=e.uniformHydrated;s.push(new J(e.uniformName,`uniform`,t))}let l=[];for(let e in n){let t=n[e],i=r.get(e);switch(e){case`discard`:l.push(new Y(null,`discard`,t));break;case`fragData0`:l.push(new Y(`fragData0`,`fragData0`,t));break;case`fragData1`:l.push(new Y(`fragData1`,`fragData1`,t));break;case`fragData2`:l.push(new Y(`fragData2`,`fragData2`,t));break;case`fragData3`:l.push(new Y(`fragData3`,`fragData3`,t));break;default:i?l.push(new Y(i,`builtin`,t)):l.push(new Y(e,`out`,t))}}return new e(s,l,o)}constructor(e,t,n,r){this.type=`shader-graph-context`,this.indent=0,this.body=``,this.varCount=0,this._inputShaderTypesByNodeUid=new Map,this._nodeEmitMap=new Map;for(let t of e)this._inputShaderTypesByNodeUid.set(t.node.uid,t);this._outputShaderTypes=t,this._transformFeedbackBindings=n,this._transformFeedbackNames=new Set(n.map(e=>`v_`+e.propertyKey)),this._usedInFragmentShader=r}shouldPruneOutputNode(e){return!!this._usedInFragmentShader&&e.outVariableType!==`builtin`&&!this._transformFeedbackNames.has(e.outVariableName)&&!this._usedInFragmentShader.has(e.node.uid)}setEmit(e,t){this._nodeEmitMap.set(e.uid,t)}getEmit(e){return this._nodeEmitMap.get(e.uid)}inputs(){return this._inputShaderTypesByNodeUid.values()}getInput(e){return this._inputShaderTypesByNodeUid.get(e.uid)}*rootOutputNodes(){for(let e of this._outputShaderTypes)yield e}*nodes(){let e=[];for(let t of this._outputShaderTypes.values())e.push(t.node);for(;e.length;){let t=e.pop();typeof t!=`number`&&typeof t!=`boolean`&&e.push(...t.children.filter(Boolean)),yield t}}*nodesOfTypeOrFunction(){for(let e of this.nodes())typeof e!=`number`&&typeof e!=`boolean`&&(yield e)}createSubgraphContext(){let e=this.clone();return e.body=``,e.indent=this.indent+2,e._nodeEmitMap=new Map(this._nodeEmitMap),e}clone(){let t=new e([],this._outputShaderTypes,this._transformFeedbackBindings,this._usedInFragmentShader);return t._inputShaderTypesByNodeUid=this._inputShaderTypesByNodeUid,t.indent=this.indent,t.body=this.body,t.varCount=this.varCount,t._nodeEmitMap=this._nodeEmitMap,t}insertVertexShader(e){e.vertex.code.add(``),this._insertInputs(e,`vertex`),e.vertex.code.add(``),e.vertex.code.add(`// OUTPUTS: `),e.vertex.code.add(`// --------------------------------------------------------- `);for(let t of this.rootOutputNodes()){let n=t.outVariableType===`builtin`;if(!this.shouldPruneOutputNode(t))if(n)e.vertex.code.add(`// ${t.outVariableType.padEnd(7)} ${t.node.type.padEnd(9)} ${t.outVariableName};`);else{let n=[...t.qualifiers,t.outVariableType].join(` `);e.vertex.code.add(`${n.padEnd(10)} ${t.node.type.padEnd(9)} ${t.outVariableName};`)}}e.vertex.code.add(``),e.vertex.code.add(`void main() {`),e.vertex.code.add(`  `+this.body.split(`
`).join(`
  `));for(let t of this.rootOutputNodes())this.shouldPruneOutputNode(t)||e.vertex.code.add(`  ${t.outVariableName} = ${t.variableName};`);e.vertex.code.add(`}`)}insertFragmentShader(e){this._insertInputs(e,`fragment`),e.fragment.code.add(``),e.fragment.code.add(`// OUTPUTS: `),e.fragment.code.add(`// --------------------------------------------------------- `);let t=0;for(let n of this.rootOutputNodes())n.outVariableType===`builtin`?e.fragment.code.add(`// ${n.outVariableType.padEnd(7)} ${n.node.type.padEnd(9)} ${n.outVariableName};`):e.outputs.add(n.outVariableName,n.node.type,t++);e.fragment.code.add(``),e.fragment.code.add(`void main() {`),e.fragment.code.add(`  `+this.body.split(`
`).join(`
  `));for(let t of this.rootOutputNodes())t.outVariableType===`discard`?(e.fragment.code.add(`  // TODO: Should ensure codegen for discard appears first in fragment shader`),e.fragment.code.add(`  if (${t.variableName}) {`),e.fragment.code.add(`    discard;`),e.fragment.code.add(`  }`),e.fragment.code.add(`  `)):e.fragment.code.add(`  ${t.outVariableName} = ${t.variableName};`);e.fragment.code.add(`}`)}_insertInputs(e,t){e[t].code.add(`// INPUTS: `),e[t].code.add(`// --------------------------------------------------------- `);for(let n of this.inputs())if(n.isUsed&&n.variableInputType!==`builtin`)if(n.node.type===`array`)e[t].code.add(`${n.variableInputType.padEnd(10)} ${n.node.elementType.type.padEnd(9)} ${n.variableName}[${n.node.size}];`);else if(n.node.type===`array-2d`)e[t].code.add(`${n.variableInputType.padEnd(10)} ${n.node.elementType.type.padEnd(9)} ${n.variableName}[${n.node.size}]; // Emulated 2D Array. Not supported by ES3.0`);else{let r=[...n.qualifiers,n.variableInputType].join(` `);e[t].code.add(` ${r.padEnd(10)} ${n.node.type.padEnd(9)} ${n.variableName};`)}}};function Yt(e){switch(e.type){case`float`:case`vec2`:case`vec3`:case`vec4`:return null;case`int`:case`ivec2`:case`ivec3`:case`ivec4`:case`uint`:case`uvec2`:case`uvec3`:case`uvec4`:case`bool`:case`bvec2`:case`bvec3`:case`bvec4`:return`flat`;case`mat2`:case`mat3`:case`mat4`:case`array`:case`sampler2D`:case`array-2d`:throw Error(`InternalError: ${e.type} is not a valid output type`)}}function Xt(e,r,i){let a=new t(r.width,r.height);return a.dataType=r.dataType,r.depth&&(a.depth=r.depth),r.flipped&&(a.flipped=r.flipped),r.hasMipmap&&(a.hasMipmap=r.hasMipmap),a.internalFormat=r.internalFormat,r.isImmutable&&(a.isImmutable=r.isImmutable),r.isOpaque&&(a.isOpaque=r.isOpaque),r.maxAnisotropy&&(a.maxAnisotropy=r.maxAnisotropy),a.pixelFormat=r.pixelFormat,r.preMultiplyAlpha&&(a.preMultiplyAlpha=r.preMultiplyAlpha),r.samplingMode&&(a.samplingMode=r.samplingMode),r.target&&(a.target=r.target),a.uniform=r.uniform,r.unpackAlignment&&(a.unpackAlignment=r.unpackAlignment),r.wrapMode&&(a.wrapMode=r.wrapMode),new n(e,a,i)}var Zt=()=>o.getLogger(`esri.views.2d.engine.webgl.shaderGraph.typed.TypedShaderProgram`);function X(e,t,n){let i=t.length;if(i!==n){let a=new r(`Invalid Uniform`,`Invalid length, expected ${n} but got ${i}`,{uniformName:e,values:t});Zt().errorOnce(a)}}var Qt=class{constructor(e,t,n,r,i){this.vertexShader=e,this.fragmentShader=t,this._locations=n,this._uniformBindings=r,this._transformFeedbackBindings=i,this._vao=null,this._temporaryTextures=[]}destroy(){this._program=i(this._program),this.cleanupTemporaryTextures()}setUniforms(e){this._uniforms=e}cleanupTemporaryTextures(){for(let e of this._temporaryTextures)e.dispose();this._temporaryTextures=[]}bind(e){let t=this._uniforms;if(!this._program){let t=[];for(let e of this._transformFeedbackBindings??[]){let{index:n,propertyKey:r}=e;t[n]=`v_${r}`}this._program=new s(e,this.vertexShader,this.fragmentShader,this._locations,new Map,t)}let n=this._program;e.useProgram(n);for(let r of this._uniformBindings){let{shaderModulePath:i,uniformName:o,uniformType:s,uniformArrayLength:c}=r,l=a(i,t);if(l==null){if(s===`sampler2D`)continue;throw Error(`Failed to find uniform value for ${i}`)}switch(s===`array`||s===`array-2d`?r.uniformArrayElementType:s){case`sampler2D`:{let{unit:t,texture:r}=l;if(n.setUniform1i(o,t),`type`in r)e.bindTexture(r,t);else{let n=Xt(e,r.descriptor,r.data);e.bindTexture(n,t)}break}case`int`:if(!c){n.setUniform1i(o,l);break}X(r.uniformName,l,c),n.setUniform1iv(o,l);break;case`float`:if(!c){n.setUniform1f(o,l);break}X(r.uniformName,l,c),n.setUniform1fv(o,l);break;case`vec2`:if(!c){n.setUniform2f(o,l[0],l[1]);break}X(r.uniformName,l,c),n.setUniform2fv(o,l.flat());break;case`vec3`:if(!c){n.setUniform3f(o,l[0],l[1],l[2]);break}X(r.uniformName,l,c),n.setUniform3fv(o,l.flat());break;case`vec4`:if(!c){n.setUniform4f(o,l[0],l[1],l[2],l[3]);break}X(r.uniformName,l,c),n.setUniform4fv(o,l.flat());break;case`mat3`:n.setUniformMatrix3fv(o,l);break;case`mat4`:n.setUniformMatrix4fv(o,l);break;default:throw Error(`Unable to set uniform for type ${s}`)}}}};function Z(e){return new e}function Q(e,t,n){let r=e.constructor[t]??[];e.constructor.hasOwnProperty(t)||Object.defineProperty(e.constructor,t,{value:r.slice()}),e.constructor[t].push(n)}function $t(e,t){return(n,r)=>{Q(n,`locations`,{typeCtor:t,propertyKey:r,parameterIndex:null,index:e})}}var en=e=>(t,n)=>{Q(t,`builtins`,{builtin:e,propertyKey:n})},tn=e=>(t,n,r)=>{Q(t,`inputs`,{inputCtor:e,propertyKey:n,parameterIndex:r})},nn=e=>(t,n)=>{Q(t,`uniforms`,{typeCtor:e,propertyKey:n})},rn=e=>(t,n)=>{Q(t,`options`,{typeCtor:e,propertyKey:n})},an=(e,t)=>{Q(e,`defines`,{propertyKey:t})},on=(e,t)=>(n,r)=>{n.constructor.builtins.push({builtin:e,propertyKey:r,typeCtor:t})},sn=class{static{this.builtins=[]}};e([on(`gl_VertexID`,M)],sn.prototype,`glVertexID`,void 0);var cn=class{},$=class{static{this.builtins=[]}};e([on(`gl_FragCoord`,O)],$.prototype,`glFragCoord`,void 0),e([on(`gl_PointCoord`,E)],$.prototype,`glPointCoord`,void 0);var ln=class{};e([en(`gl_FragDepth`)],ln.prototype,`glFragDepth`,void 0);var un=class{constructor(){this.type=`uniform-group`}get _uniforms(){return this.constructor.uniforms??[]}},dn=class{constructor(){this.logShader=!1,this.computeAttributes={}}get vertexInput(){let e=this._shaderModuleClass.inputs.findLast(e=>e.propertyKey===`vertex`&&e.parameterIndex===0);if(!e)throw Error(`Unable to find vertex input parameter`);return e}get computeInput(){return this._shaderModuleClass.inputs.findLast(e=>e.propertyKey===`vertex`&&e.parameterIndex===1)}get fragmentInput(){let e=this._shaderModuleClass.inputs.findLast(e=>e.propertyKey===`fragment`);if(!e)throw Error(`Unable to find fragment input parameter`);return e}get transformFeedbackBindings(){return this.fragmentInput.inputCtor.transformFeedbackBindings??[]}get locations(){return[...this.vertexInput.inputCtor.locations,...this.computeInput?.inputCtor.locations??[]]}get locationsMap(){let e=new Map,t=new Set;for(let n of this.locations)t.has(n.index)?o.getLogger(`esri.views.2d.engine.webgl.shaderGraph.GraphShaderModule`).warnOnce(`mapview-rendering`,`Unable to assigned attribute ${n.propertyKey} to ${n.index}. Index already in use`,{locationsMap:e}):(e.set(n.propertyKey,n.index),t.add(n.index));return e}get locationInfo(){if(!this._locationInfo){let e=this.locationsMap,t=Array.from(e.entries()).map(([e,t])=>`${e}.${t}`).join(`.`),n=this.computeAttributes;this._locationInfo={stringHash:t,locations:e,computeAttributeMap:n}}return this._locationInfo}get renamedLocationsMap(){let e=new Map;for(let t of this.locations)e.set(`a_`+t.propertyKey,t.index);return e}get optionPropertyKeys(){if(!this._optionPropertyKeys){let e=new Set;for(let t of this._options)e.add(t.propertyKey);this._optionPropertyKeys=e}return this._optionPropertyKeys}get _shaderModuleClass(){return this.constructor}get _defines(){return this._shaderModuleClass.defines??[]}get _options(){return this._shaderModuleClass.options??[]}get _uniforms(){return this._shaderModuleClass.uniforms??[]}getProgram(e,t,n,r){try{let{vertex:i,fragment:a,uniformBindings:o}=this._generateShaders(e,t,n,r);return new Qt(i,a,this.renamedLocationsMap,o,this.transformFeedbackBindings)}catch{return new Qt(``,``,this.renamedLocationsMap,[],this.transformFeedbackBindings)}}getDebugUniformClassInfo(e){let t=this._options.find(t=>t.propertyKey===e);if(t)return{type:`option`,className:t.typeCtor};let n=this._uniforms.find(t=>t.propertyKey===e);if(!n)throw Error(`Unable to find uniform class type for property: ${e}`);return{type:`required`,className:n.typeCtor}}getShaderKey(e,t,n,r){let i=Object.keys(e).map(t=>`${t}.${e[t]}`).join(`.`),a=Object.keys(n).map(e=>`${e}.${n[e]}`).join(`.`),o=Object.keys(r).map(e=>`${e}.${r[e]}`).join(`.`),s=Object.keys(t).filter(e=>this.optionPropertyKeys.has(e)&&t[e]).join(`.`);return`${this.type}.${i}.${a}.${o}.${s}`}_generateShaders(e,t,n,r){let i=[];this._setDefines(n),this._setOptionalUniforms(i,t),this._setRequiredUniforms(i);let a=this._hydrateVertexInput(r),o=this._injectPackPrecisionFactor(a,e),s=this._hydrateComputeInput(),c=s&&this._injectComputePackPrecisionFactor(s,e),l=this.vertex(o,c),u=this._hydrateFragmentInput(l),f=this.fragment(u),p=new Set;for(let e in f){let t=f[e];d(p,t)}let m=this._getVertexInputBuiltins(),h={};for(let[e,t]of Object.entries(a))h[e]=t;if(s!=null)for(let[e,t]of Object.entries(s))h[e]=t;let g=Jt.createVertex(h,l,m,i,this.transformFeedbackBindings,p);new qt().write(g);let _=this._getFragmentInputBuiltins(f);_.set(`glPointCoord`,`gl_PointCoord`),_.set(`glFragCoord`,`gl_FragCoord`);let v=Jt.createFragment(u,f,_,i,g,this.transformFeedbackBindings);new qt().write(v);let ee=this._createShaderBuilder(g,v),y=ee.generate(`vertex`),b=ee.generate(`fragment`);return this.logShader&&(console.log(y),console.log(b)),{vertex:y,fragment:b,uniformBindings:i}}_setDefines(e){for(let t in e)this[t]=e[t]}_setOptionalUniforms(e,t){for(let n of this._options)t[n.propertyKey]?this[n.propertyKey]=this._hydrateUniformGroup(e,n):this[n.propertyKey]=null}_setRequiredUniforms(e){for(let t of this._uniforms)this[t.propertyKey]=this._hydrateUniformGroup(e,t)}_hydrateUniformGroup(e,t){let n=new t.typeCtor;for(let r of n._uniforms??[]){let i=Z(r.typeCtor),a=`u_${t.propertyKey}_${r.propertyKey}`,o=i.type,s=[t.propertyKey,r.propertyKey].join(`.`);if(`type`in r.typeCtor&&r.typeCtor.type===`array`){let t=i;e.push({shaderModulePath:s,uniformName:a,uniformType:o,uniformArrayLength:t.size,uniformArrayElementType:t.elementType.type,uniformHydrated:i})}else if(`type`in r.typeCtor&&r.typeCtor.type===`array-2d`){let t=i;e.push({shaderModulePath:s,uniformName:a,uniformType:o,uniformArrayLength:t.size,uniformArrayElementType:t.elementType.type,uniformHydrated:i})}else e.push({shaderModulePath:s,uniformName:a,uniformType:o,uniformHydrated:i});n[r.propertyKey]=i}return n}_hydrateVertexInput(e){let t=this.vertexInput.inputCtor,n=t.locations.reduce((t,n)=>!1===e[n.propertyKey]?t:{...t,[n.propertyKey]:Z(n.typeCtor)},{});for(let{propertyKey:e,typeCtor:r}of t.builtins)n[e]=Z(r);return n}_hydrateComputeInput(){return this.computeInput==null?null:this.computeInput.inputCtor.locations.reduce((e,t)=>({...e,[t.propertyKey]:Z(t.typeCtor)}),{})}_injectPackPrecisionFactor(e,t){let n={};for(let r in e){let i=e[r],a=t[r];if(a){if(i.type!==`float`&&i.type!==`vec2`&&i.type!==`vec3`&&i.type!==`vec4`)throw Error(`InternalError: packPrecisionFactor requires GenType, but found ${i.type}`);n[r]=i.divide(new T(a))}else n[r]=i}return n}_injectComputePackPrecisionFactor(e,t){let n={},r=new Map;for(let e in this.computeAttributes)for(let t of this.computeAttributes[e]??[])r.set(t,e);for(let i in e){let a=e[i],o=r.get(i);if(!o)continue;let s=t[o];if(s){if(a.type!==`float`&&a.type!==`vec2`&&a.type!==`vec3`&&a.type!==`vec4`)throw Error(`InternalError: packPrecisionFactor requires GenType, but found ${a.type}`);n[i]=a.divide(new T(s))}else n[i]=a}return n}_hydrateFragmentInput(e){let t={};for(let n in e)t[n]=e[n];for(let{propertyKey:e,typeCtor:n}of $.builtins)t[e]=Z(n);return t}_getVertexInputBuiltins(){let e=this.vertexInput.inputCtor,t=new Map;for(let{builtin:n,propertyKey:r}of e.builtins)t.set(r,n);return t}_getFragmentInputBuiltins(e){let t=e.constructor,n=new Map;for(let e of t.builtins??[])n.set(e.propertyKey,e.builtin);return n}_createShaderBuilder(e,t){let n=new c;return this._insertDebugInfo(n),e.insertVertexShader(n),t.insertFragmentShader(n),n}_insertDebugInfo(e){e.vertex.code.add(`// DEFINES: `),e.vertex.code.add(`// --------------------------------------------------------- `);for(let t of this._defines)this[t.propertyKey]?e.vertex.code.add(`//   ${t.propertyKey}: true`):e.vertex.code.add(`//   ${t.propertyKey}: false`);e.vertex.code.add(``),e.vertex.code.add(`// OPTIONS: `),e.vertex.code.add(`// --------------------------------------------------------- `);for(let t of this._options)this[t.propertyKey]?e.vertex.code.add(`//   ${t.propertyKey}: true`):e.vertex.code.add(`//   ${t.propertyKey}: false`)}};export{Ut as $,wt as A,je as At,Ot as B,A as C,pt as Ct,st as D,Me as Dt,Ge as E,Rt as Et,Nt as F,Ct as Ft,N as G,D as H,M as I,Be as It,At as J,lt as K,Pt as L,l as Lt,ye as M,Gt as Mt,Dt as N,V as Nt,Ue as O,gt as Ot,Je as P,bt as Pt,It as Q,ct as R,et as S,qe as St,at as T,_t as Tt,kt as U,Xe as V,Ze as W,Ht as X,Qe as Y,ht as Z,T as _,zt as _t,$t as a,Pe as at,jt as b,ve as bt,nn as c,Tt as ct,cn as d,Vt as dt,Ie as et,Qt as f,Fe as ft,Ke as g,vt as gt,w as h,De as ht,an as i,Bt as it,Ve as j,xt as jt,He as k,Lt as kt,ln as l,Kt as lt,tt as m,Ft as mt,$ as n,Le as nt,rn as o,mt as ot,Mt as p,ft as pt,O as q,dn as r,yt as rt,tn as s,ke as st,sn as t,St as tt,un as u,We as ut,Ye as v,Ne as vt,rt as w,Oe as wt,$e as x,Et as xt,H as y,Wt as yt,E as z};