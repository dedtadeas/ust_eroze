import{Jv as e,Qm as t,Ym as n,Zm as r,_E as i,dp as a,eh as o,qf as s,uT as c,vE as l,yf as u}from"./index-BqmCqmfp.js";import{n as d}from"./OptimizedFeature-Dx4_lHip.js";import{t as f}from"./OptimizedGeometry-f3I9Z6C1.js";import{t as p}from"./OptimizedFeatureSet-DlHqIhoP.js";function m(e,t){return e?t?4:3:t?3:2}var h=()=>l.getLogger(`esri.layers.graphics.featureConversionUtils`),g={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryMultiPatch:3,esriGeometryEnvelope:0},_=(e,t,n,r,i,a)=>{e[n]=i,e[n+1]=a},v=(e,t,n,r,i,a)=>{e[n]=i,e[n+1]=a,e[n+2]=t[r+2]},y=(e,t,n,r,i,a)=>{e[n]=i,e[n+1]=a,e[n+2]=t[r+3]},b=(e,t,n,r,i,a)=>{e[n]=i,e[n+1]=a,e[n+2]=t[r+2],e[n+3]=t[r+3]};function x(e,t,n,r){if(e){if(n)return t&&r?b:v;if(t&&r)return y}else if(t&&r)return v;return _}function S({scale:e,translate:t},n){return Math.round((n-t[0])/e[0])}function C({scale:e,translate:t},n){return Math.round((t[1]-n)/e[1])}function w({scale:e,translate:t},n){return Math.round((n-t[0])/e[0])}function T({scale:e,translate:t},n){return Math.round((n-t[1])/e[1])}function E({scale:e,translate:t},n,r){return n*e[r]+t[r]}function ee(e,t,n){return e?t?n?M(e):k(e):n?j(e):D(e):null}function D(e){let t=e.coords;return{x:t[0],y:t[1]}}function O(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function k(e){let t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function A(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function j(e){let t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function te(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function M(e){let t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function ne(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function re(e,t,n,r){let i=D;n&&r?i=M:n?i=k:r&&(i=j);for(let n of t){let{geometry:t,attributes:r}=n,a=t==null?null:i(t);e.push({attributes:r,geometry:a})}return e}function N(e,t){return e&&t?ne:e?A:t?te:O}function ie(e,t,n,r,i){let o=N(n,r);for(let n of t){let t=n.geometry==null?null:o(new f,n.geometry);e.push(new d(t,n.attributes,null,a(n,i)))}return e}function P(e,t,n=N(t.z!=null,t.m!=null)){return n(e,t)}function F(e,t,n,r){for(let{geometry:i,attributes:a}of t)e.push({attributes:a,geometry:i==null?null:I(i,n,r)});return e}function I(e,t,n){if(e==null)return null;let r=m(t,n),i=[];for(let t=0;t<e.coords.length;t+=r){let n=[];for(let i=0;i<r;i++)n.push(e.coords[t+i]);i.push(n)}return t?n?{points:i,hasZ:t,hasM:n}:{points:i,hasZ:t}:n?{points:i,hasM:n}:{points:i}}function ae(e,t,n,r,i){let o=m(n,r);for(let n of t){let t=n.geometry==null?null:L(new f,n.geometry,o);e.push(new d(t,n.attributes,null,a(n,i)))}return e}function L(e,t,n=m(t.hasZ,t.hasM)){e.lengths[0]=t.points.length;let r=e.coords,i=0;for(let e of t.points)for(let t=0;t<n;t++)r[i++]=e[t];return e}function oe(e,t,n,r){for(let{geometry:i,attributes:a}of t)e.push({attributes:a,geometry:i==null?null:R(i,n,r)});return e}function R(e,t,n){if(!e)return null;let r=m(t,n),{coords:i,lengths:a}=e,o=[],s=0;for(let e of a){let t=[];for(let n=0;n<e;n++){let e=[];for(let t=0;t<r;t++)e.push(i[s++]);t.push(e)}o.push(t)}return t?n?{paths:o,hasZ:t,hasM:n}:{paths:o,hasZ:t}:n?{paths:o,hasM:n}:{paths:o}}function se(e,t,n,r,i){let o=m(n,r);for(let n of t){let t=n.geometry==null?null:z(new f,n.geometry,o),r=n.centroid==null?null:P(new f,n.centroid);e.push(new d(t,n.attributes,r,a(n,i)))}return e}function z(e,t,n=m(t.hasZ,t.hasM)){let{lengths:r,coords:i}=e,a=0;for(let e of t.paths){for(let t of e)for(let e=0;e<n;e++)i[a++]=t[e];r.push(e.length)}return e}function ce(e,t,n,r){for(let{geometry:i,attributes:a,centroid:o}of t){let t=i==null?null:B(i,n,r);if(o!=null){let n=D(o);e.push({attributes:a,centroid:n,geometry:t})}else e.push({attributes:a,geometry:t})}return e}function B(e,t,n){if(!e)return null;let r=m(t,n),{coords:i,lengths:a}=e,o=[],s=0;for(let e of a){let t=[];for(let n=0;n<e;n++){let e=[];for(let t=0;t<r;t++)e.push(i[s++]);t.push(e)}o.push(t)}return t?n?{rings:o,hasZ:t,hasM:n}:{rings:o,hasZ:t}:n?{rings:o,hasM:n}:{rings:o}}function le(e,t,n,r,i){for(let o of t){let t=o.geometry==null?null:V(new f,o.geometry,n,r),s=a(o,i);o.centroid==null?e.push(new d(t,o.attributes,null,s)):e.push(new d(t,o.attributes,O(new f,o.centroid),s))}return e}function V(e,t,n=t.hasZ,r=t.hasM){return H(e,t.rings,n,r)}function H(e,t,n,r){let i=m(n,r),{lengths:a,coords:o}=e,s=0;Q(e);for(let e of t){for(let t of e)for(let e=0;e<i;e++)o[s++]=t[e];a.push(e.length)}return e}var U=[],W=[];function ue(e,t,n,r,i){U[0]=e;let[a]=G(W,U,t,n,r,i);return $(U),$(W),a}function G(e,t,n,r,o,s){if($(e),!n){for(let n of t){let t=a(n,s);e.push(new d(null,n.attributes,null,t))}return e}switch(n){case`esriGeometryPoint`:return ie(e,t,r,o,s);case`esriGeometryMultipoint`:return ae(e,t,r,o,s);case`esriGeometryPolyline`:return se(e,t,r,o,s);case`esriGeometryPolygon`:case`esriGeometryMultiPatch`:return le(e,t,r,o,s);default:h().error(`convertToFeatureSet:unknown-geometry`,new i(`internal:geometry`,`Unable to parse unknown geometry type '${n}'`)),$(e)}return e}function de(e,t,n,r){W[0]=e,q(U,W,t,n,r);let i=U[0];return $(U),$(W),i}function fe(e,a,s){if(e==null)return null;let c=new f;return`hasZ`in e&&a==null&&(a=e.hasZ),`hasM`in e&&s==null&&(s=e.hasM),n(e)?N(a??e.z!=null,s??e.m!=null)(c,e):o(e)?V(c,e,a,s):r(e)?z(c,e,m(a,s)):t(e)?L(c,e,m(a,s)):void h().error(`convertFromGeometry:unknown-geometry`,new i(`internal:geometry`,`Unable to parse unknown geometry type '${e}'`))}function K(e,t,n,r){let a=e&&(`coords`in e?e:e.geometry);if(a==null)return null;switch(t){case`esriGeometryPoint`:{let e=D;return n&&r?e=M:n?e=k:r&&(e=j),e(a)}case`esriGeometryMultipoint`:return I(a,n,r);case`esriGeometryPolyline`:return R(a,n,r);case`esriGeometryPolygon`:return B(a,n,r);default:return h().error(`convertToGeometry:unknown-geometry`,new i(`internal:geometry`,`Unable to parse unknown geometry type '${t}'`)),null}}function pe(e,t){for(let n of t)e.push({attributes:n.attributes});return e}function q(e,t,n,r,a){if($(e),n==null)return pe(e,t);switch(n){case`esriGeometryPoint`:return re(e,t,r,a);case`esriGeometryMultipoint`:return F(e,t,r,a);case`esriGeometryPolyline`:return oe(e,t,r,a);case`esriGeometryPolygon`:return ce(e,t,r,a);default:h().error(`convertToFeatureSet:unknown-geometry`,new i(`internal:geometry`,`Unable to parse unknown geometry type '${n}'`))}return e}function me(e){let{spatialReference:t,transform:n,fields:r,hasM:i,hasZ:a,features:o,geometryType:s,exceededTransferLimit:c,queryGeometry:l,queryGeometryType:u}=e,d={features:q([],o,s,a,i),fields:r,geometryType:s,spatialReference:t,queryGeometry:K(l,u,!1,!1)};return n&&(d.transform=n),c&&(d.exceededTransferLimit=c),i&&(d.hasM=i),a&&(d.hasZ=a),d}function he(e,t){let n=new p,{hasM:r,hasZ:i,features:a,spatialReference:o,geometryType:s,exceededTransferLimit:c,transform:l,fields:u}=e;return u&&(n.fields=u),n.geometryType=s??null,n.spatialReference=o??null,a&&G(n.features,a,s,i,r,t),c&&(n.exceededTransferLimit=c),r&&(n.hasM=r),i&&(n.hasZ=i),l&&(n.transform=l),n}function ge(e){let{transform:t,features:n,hasM:r,hasZ:i}=e;if(!t)return e;for(let e of n)e.geometry!=null&&X(e.geometry,e.geometry,r,i,t),e.centroid!=null&&X(e.centroid,e.centroid,r,i,t);return e.transform=null,e}function _e(e,t){let{geometryType:n,features:r,hasM:i,hasZ:a}=t;if(!e)return t;for(let t=0;t<r.length;t++){let o=r[t],s=o.weakClone();s.geometry=new f,J(s.geometry,o.geometry,i,a,n,e),o.centroid&&(s.centroid=new f,J(s.centroid,o.centroid,i,a,`esriGeometryPoint`,e)),r[t]=s}return t.transform=e,t}function J(e,t,n,r,i,a,o=n,s=r){if(Q(e),!t?.coords.length)return null;let c=g[i],{coords:l,lengths:u}=t,d=m(n,r),f=m(n&&o,r&&s),p=x(n,r,o,s);if(!u.length)return p(e.coords,l,0,0,S(a,l[0]),C(a,l[1])),Q(e,d,0),e;let h,_,v,y,b=0,w=0,T=w;for(let t of u){if(t<c)continue;let n=0;w=T,v=h=S(a,l[b]),y=_=C(a,l[b+1]),p(e.coords,l,w,b,v,y),n++,b+=d,w+=f;for(let r=1;r<t;r++,b+=d)v=S(a,l[b]),y=C(a,l[b+1]),v===h&&y===_||(p(e.coords,l,w,b,v-h,y-_),w+=f,n++,h=v,_=y);n>=c&&(e.lengths.push(n),T=w)}return $(e.coords,T),e.coords.length?e:null}function ve(e,t,n,r,i,a,o=n,s=r){if(Q(e),!t?.coords.length)return null;let c=g[i],{coords:l,lengths:u}=t,d=m(n,r),f=m(n&&o,r&&s),p=x(n,r,o,s);if(!u.length)return p(e.coords,l,0,0,l[0],l[1]),Q(e,d,0),e;let h=0,_=a*a;for(let t of u){if(t<c){h+=t*d;continue}let n=e.coords.length/f,r=h,i=h+(t-1)*d;p(e.coords,l,e.coords.length,r,l[r],l[r+1]),Y(e.coords,l,d,_,p,r,i),p(e.coords,l,e.coords.length,i,l[i],l[i+1]);let a=e.coords.length/f-n;a>=c?e.lengths.push(a):$(e.coords,n*f),h+=t*d}return e.coords.length?e:null}function ye(e,t,n,r){let i=e[t],a=e[t+1],o=e[n],s=e[n+1],c=e[r],l=e[r+1],u=o,d=s,f=c-u,p=l-d;if(f!==0||p!==0){let e=((i-u)*f+(a-d)*p)/(f*f+p*p);e>1?(u=c,d=l):e>0&&(u+=f*e,d+=p*e)}return f=i-u,p=a-d,f*f+p*p}function Y(e,t,n,r,i,a,o){let s,c=r,l=0;for(let e=a+n;e<o;e+=n)s=ye(t,e,a,o),s>c&&(l=e,c=s);c>r&&(l-a>n&&Y(e,t,n,r,i,a,l),i(e,t,e.length,l,t[l],t[l+1]),o-l>n&&Y(e,t,n,r,i,l,o))}function be(t,n,r,i){if(!n?.coords?.length)return null;let a=m(r,i),o=1/0,c=1/0,l=-1/0,d=-1/0;if(n&&n.coords){let e=n.coords;for(let t=0;t<e.length;t+=a){let n=e[t],r=e[t+1];o=Math.min(o,n),l=Math.max(l,n),c=Math.min(c,r),d=Math.max(d,r)}}return s(t)?u(t,o,c,l,d):e(o,c,l,d,t),t}function X(e,t,n,r,i){let{coords:a,lengths:o}=t,s=m(n,r);if(!a.length)return e!==t&&Q(e),e;c(i);let{originPosition:l,scale:u,translate:d}=i,f=Te;f.originPosition=l;let p=f.scale;p[0]=u[0]??1,p[1]=-(u[1]??1),p[2]=u[2]??1,p[3]=u[3]??1;let h=f.translate;if(h[0]=d[0]??0,h[1]=d[1]??0,h[2]=d[2]??0,h[3]=d[3]??0,!o.length){for(let t=0;t<s;++t)e.coords[t]=E(f,a[t],t);return e!==t&&Q(e,s,0),e}let g=0;for(let t=0;t<o.length;t++){let n=o[t];e.lengths[t]=n;for(let t=0;t<s;++t)e.coords[g+t]=E(f,a[g+t],t);let r=e.coords[g],i=e.coords[g+1];g+=s;for(let t=1;t<n;t++,g+=s){r+=a[g]*p[0],i+=a[g+1]*p[1],e.coords[g]=r,e.coords[g+1]=i;for(let t=2;t<s;++t)e.coords[g+t]=E(f,a[g+t],t)}}return e!==t&&Q(e,a.length,o.length),e}function xe(e,t,n,r,i,a){if(Q(e),e.lengths.push(...t.lengths),n===i&&r===a)for(let n=0;n<t.coords.length;n++)e.coords.push(t.coords[n]);else{let o=m(n,r),s=x(n,r,i,a),c=t.coords;for(let t=0;t<c.length;t+=o)s(e.coords,c,e.coords.length,t,c[t],c[t+1])}return e}function Se(e,t,n,r){let i=0,a=e[r*t],o=e[r*(t+1)];for(let s=1;s<n;s++){let n=a+e[r*(t+s)],c=o+e[r*(t+s)+1],l=(n-a)*(c+o);a=n,o=c,i+=l}return .5*i}function Z(e,t){let{coords:n,lengths:r}=e,i=0,a=0;for(let e=0;e<r.length;e++){let o=r[e];a+=Se(n,i,o,t),i+=o}return Math.abs(a)}function Ce(e,t,n,r){return e*r-n*t===0&&e*n+t*r>0}function we(e,t,n,r,i){let a=m(r,i);if(!e.lengths.length){if(e.coords.length<2)return null;let[n,r]=e.coords,i=w(t,n),a=T(t,r);return new f([],[i,a])}let o=new f([],[0,0]),s=g[n],c=n===`esriGeometryPolygon`||n===`esriGeometryPolyline`,l=0,u=0;for(let n=0;n<e.lengths.length;n++){let r=e.lengths[n],i=u,d=w(t,e.coords[a*l]),f=T(t,e.coords[a*l+1]);o.coords[u++]=d,o.coords[u++]=f;let p=0,m=0,h=1;for(let n=1;n<r;n++){let r=w(t,e.coords[a*(n+l)]),i=T(t,e.coords[a*(n+l)+1]);if(r!==d||i!==f){let e=r-d,t=i-f;c&&Ce(p,m,e,t)?(o.coords[u-2]+=e,o.coords[u-1]+=t,d+=e,f+=t):(o.coords[u++]=r,o.coords[u++]=i,d=r,f=i,p=e,m=t,h+=1)}}h<s?u=i:o.lengths.push(h),l+=r}return o.lengths.length===0?null:o}function Q(e,t=0,n=0){$(e.lengths,n),$(e.coords,t)}function $(e,t=0){e.length!==t&&(e.length=t)}var Te={originPosition:`lowerLeft`,scale:[1,1,1,1],translate:[0,0,0,0]};export{fe as C,H as S,we as T,K as _,be as a,G as b,P as c,he as d,S as f,ge as g,J as h,xe as i,C as l,me as m,R as n,Z as o,ve as p,ee as r,B as s,I as t,V as u,_e as v,X as w,de as x,ue as y};