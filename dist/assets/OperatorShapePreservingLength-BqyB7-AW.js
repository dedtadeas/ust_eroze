import{X as e,cn as t,dn as n,in as r,kt as i,ln as a,st as o}from"./Point2D-UYEfE6HP.js";import{t as s}from"./Envelope2D-BNwQDrOT.js";import{Bt as c,M as l,Mt as u,Nt as d,Tn as f,Vt as p,ot as m,qt as h,sn as g,u as _}from"./UnitFactory-J9WMNXdY.js";function v(){return{m_pGcs:new i,m_xyz:new f,m_factor:NaN,m_geoLength:NaN,setValues:y,setLength:b,assign:x}}function y(e,t,n,r){this.m_factor=e,this.m_pGcs.assign(t),this.m_xyz.assign(r),this.m_geoLength=n}function b(e){this.m_geoLength=e}function x(e){this.m_pGcs.assign(e.m_pGcs),this.m_xyz.assign(e.m_xyz),this.m_factor=e.m_factor,this.m_geoLength=e.m_geoLength}var S=class{getOperatorType(){return 10315}supportsCurves(){return!0}accelerateGeometry(e,t,n){return!1}canAccelerateGeometry(e){return!1}_ExecuteShapePreservingLength(e,t,n,r,i){if(e.hasNonLinearSegments()&&(e=new c().execute(e,0,t.getTolerance(0),0,i)),t.isPannable()){let r=90,a=-90;if(n.getUnit().getUnitToBaseFactor()===1&&(r*=Math.PI/180,a*=Math.PI/180),t.getCoordinateSystemType()===2){let e=null,n=[0,0,0,0];e=t.getPECoordSys(),n[0]=0,n[1]=r,n[2]=0,n[3]=a,u.geogToProj(e,2,n),r=n[1],a=n[3]}let o=new s;e.queryEnvelope(o),o.ymin=a,o.ymax=r,e=new p().execute(e,o,t,i)}else{let n=t.getPCSHorizon();(e=new d().execute(e,n,t,i))===n&&(e=e.clone())}return e.isEmpty()?0:this._ExecuteIterativeApproach(e,t,n,r,1,i)}_ExecuteIterativeApproach(t,n,r,s,c,l){let d=_();r.querySpheroidData(d);let p=d.majorSemiAxis,m=d.e2,h=r.getUnit().getUnitToBaseFactor(),g=e(v,40),y=o(40,NaN),b=v(),x=v(),S,T=[0,0,0,0],E=n.getPECoordSys(),D=new i,O=new i,k=new i,A=new i,j=new i,M=0,N=t.querySegmentIterator();for(;N.nextPath();)for(;N.hasNextSegment();){let e=N.nextSegment();D.assign(e.getStartXY()),O.assign(e.getEndXY()),n.getCoordinateSystemType()===2?(T[0]=D.x,T[1]=D.y,T[2]=O.x,T[3]=O.y,u.projToGeog(E,2,T),k.x=T[0]*h,k.y=T[1]*h,A.x=T[2]*h,A.y=T[3]*h):(k.setCoordsPoint2D(D),A.setCoordsPoint2D(O),k.scale(h),A.scale(h));let t=new f,r=new f;C(p,m,k,t),C(p,m,A,r);let i=w(p,t,r);b.setValues(0,k,NaN,t),x.setValues(1,A,i,r),S=c,g[0].assign(x),y[0]=c;let o=0;for(;;){o>128&&a(`iterations exceeded`);let t=.5*(b.m_factor+x.m_factor),r=e.getCoord2D(t);n.getCoordinateSystemType()===2?(T[0]=r.x,T[1]=r.y,u.projToGeog(E,1,T),j.x=T[0]*h,j.y=T[1]*h):(j.setCoordsPoint2D(r),j.scale(h)),k.setCoordsPoint2D(b.m_pGcs),A.setCoordsPoint2D(x.m_pGcs);let s=new f;C(p,m,j,s);let l=w(p,b.m_xyz,s),d=w(p,x.m_xyz,s);i=x.m_geoLength,Number.isNaN(i)&&(i=w(p,b.m_xyz,x.m_xyz));let _=l+d,v=S===c&&_>=20&&Math.abs(_-i)>1e-8*(i+_);if(o+2<40&&(v||Math.abs(_-i)>0&&S>0))x.setLength(d),g[o].assign(x),x.setValues(t,j,l,s),g[++o].assign(x),v?(S=c,y[o]=c):(S--,y[o-1]=S,y[o]=S);else{if(M+=_,o===0)break;b.assign(x),x.assign(g[--o]),S=y[o]}}}return M}execute(e,i,a){if(i&&i.getCoordinateSystemType()!==0||r(``),e.isEmpty()||e.getDimension()<1)return 0;let o=null,s=i.getGCS();s!==i&&(o=l(i,s,null));let c=e.getGeometryType();if(c===t.enumEnvelope){let t=new g;return t.addEnvelope(e,!1),this._ExecuteShapePreservingLength(t,i,s,o,a)}if(n(c)){let t=new h;return t.addSegment(e,!0),this._ExecuteShapePreservingLength(t,i,s,o,a)}return this._ExecuteShapePreservingLength(e,i,s,o,a)}};function C(e,t,n,r){r.assign(m(e,t,n))}function w(e,t,n){let r=e,i=new f;i.setSub(t,n);let a=i.length();return 2*r*Math.asin(a/(2*r))}export{S as t};