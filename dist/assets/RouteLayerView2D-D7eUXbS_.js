const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/RouteLayerInteraction-DgjWWrzB.js","assets/index-BqmCqmfp.js","assets/index-kIqmb12G.css","assets/earcut-Drx511Ix.js","assets/geodeticLengthOperator-Bd7syy7j.js","assets/geodeticCurveType-hqCRc72W.js","assets/sphere-CicnK0Bn.js","assets/vectorStacks-CKtslZxP.js","assets/quatf64-CJzmL3cc.js","assets/elevationInfoUtils-Df_uYU_q.js","assets/quantityUtils-Dywg00j-.js","assets/projectPointToVector-Clou1sfo.js","assets/projectVectorToVector-D-Bbb8fP.js","assets/dehydratedPoint-Dwb3orme.js","assets/spatialReferenceEllipsoidUtils-DBtdxVkA.js","assets/geodesicUtils-DJORTTMv.js","assets/lineSegment-uFalXigL.js","assets/plane-CTjDePZl.js","assets/triangle-1kWe4-AP.js","assets/GraphicsLayer-BGvt7_Y1.js","assets/Stop-DfLyF0Gk.js","assets/networkEnums-BShtiFSl.js","assets/SketchViewModel-BCYoa7_w.js","assets/isSupportedObject-CNmfINgj.js","assets/layerUtils-DVQFdwBE.js","assets/SketchOptions-CfisVcr8.js","assets/LineSnappingHint-BAcwqgNT.js","assets/ParallelSnappingHint-Knbe-U69.js","assets/DrapedEdgeSnappingCandidate-Ck4Ob_c8.js","assets/constraints-DXu8cqG3.js","assets/EdgeSnappingCandidate-C1pApw0q.js","assets/SnappingCandidate-BzUm7cf4.js","assets/IntersectionSnappingCandidate-Cv9i7Mdt.js","assets/IntersectionSnappingHint-C3U4Rx6H.js","assets/LineSnappingCandidate-Cp24TJlP.js","assets/RightAngleTriangleSnappingCandidate-B-XFn7NT.js","assets/RightAngleSnappingHint--LJCiSno.js","assets/viewUtils-CPzQ7QWB.js","assets/viewUtils-CtJQ47Dj.js","assets/snappingUtils-CbrwOS61.js","assets/euclideanLengthMeasurementUtils-Bhl6nD1D.js","assets/hitTestSelectUtils-CyV_4TZP.js"])))=>i.map(i=>d[i]);
import{CD as e,Cw as t,Kb as n,MC as r,SC as i,Uy as a,Wb as o,kC as s,nD as c,qb as l,vT as u}from"./index-BqmCqmfp.js";import"./memoryEstimations-O7VgDRVG.js";import"./OptimizedFeature-Dx4_lHip.js";import"./OptimizedGeometry-f3I9Z6C1.js";import"./OptimizedFeatureSet-DlHqIhoP.js";import"./featureConversionUtils-7vyVIZ6j.js";import"./streamLayerUtils-BMw-RtDi.js";import"./QueueProcessor-C8_CgXms.js";import"./earcut-Drx511Ix.js";import"./layerViewUtils-Bbe7IKvz.js";import"./colorUtils-uG2qTogT.js";import"./networkEnums-BShtiFSl.js";import"./timeSupport-DheFkvFH.js";import"./queryUtils-BA7HiGeg.js";import"./quantizationUtils-C5shine1.js";import"./normalizeUtilsSync-Btn24Gtg.js";import{i as d,r as f,t as p}from"./RouteInfo-BYlTBn3w.js";import{i as m,n as h,r as g,t as _}from"./Stop-DfLyF0Gk.js";import"./GeometryUtils-DBkUrkz1.js";import"./VertexAttributeLocations-IAhvKZqd.js";import"./VertexElementDescriptor-BGWnA0Rs.js";import"./labelPoint-B7zLrA23.js";import"./callExpressionWithCursor-kl7GHpJ1.js";import"./FeatureMetadata-H6WAS0Lx.js";import"./fontUtils-CWolFklQ.js";import"./CIMSymbolHelper-bdBsF42t.js";import"./rasterizingUtils-B0Pd5uE0.js";import"./Rect-BMNJQxpm.js";import"./BoundingBox-DnR5UeUT.js";import"./BidiEngine-CpIovbIK.js";import"./callExpressionWithFeature-BK7JnF3H.js";import"./OverrideHelper-BKNowJt8.js";import"./densifyCurvedGeometry-C2XDhl14.js";import"./config-BSvujflG.js";import"./dehydratedFeatureComparison-Ch8xWl-8.js";import"./WGLContainer-Caxzva6E.js";import"./utils-DBLYSlue.js";import"./ProgramTemplate-ks-pn-xm.js";import"./VertexArrayObject-Dzn28byJ.js";import"./BufferObject-lp8QWmVQ.js";import"./VertexBuffer-DL5rIQzc.js";import"./vec3f32-CZ7wi78s.js";import"./Container-DgT8F3N0.js";import"./EffectView-CvH-XuUh.js";import"./GraphShaderModule-D5xwSwIQ.js";import"./FramebufferObject-CkeUwNOD.js";import"./ShaderBuilder-C3C7fUwK.js";import{t as v}from"./LayerView2D-DVE2Teoj.js";import{t as y}from"./LayerView-DKEUJRIQ.js";import"./UpdateTracking2D-yw0xaCSk.js";import"./TechniqueInstance-BhM4b8eb.js";import"./TileContainer-BwjyXNO3.js";import"./FeatureCommandQueue-COnDeivB.js";import"./constants-BOI_CTg-.js";import"./utils-CY7cI7hp.js";import{t as b}from"./highlightOptionsUtils-DiIoW0j2.js";import"./AGraphicContainer-ShIe2ypS.js";import{t as x}from"./GraphicContainer-DNktOekL.js";import"./ComputedAttributeStorage-D_u4lyEq.js";import{t as S}from"./GraphicsView2D-Dg0AUWQu.js";import"./dehydratedFeatures-DW1qFa9i.js";var C=[`route-info`,`direction-line`,`direction-point`,`polygon-barrier`,`polyline-barrier`,`point-barrier`,`stop`],w={graphic:null,property:null,oldValue:null,newValue:null};function T(e){return e instanceof d||e instanceof f||e instanceof m||e instanceof g||e instanceof h||e instanceof p||e instanceof _}function E(e){return i.isCollection(e)&&e.length&&T(e.at(0))}function D(e){return Array.isArray(e)&&e.length>0&&T(e[0])}var O=class extends v(y){constructor(){super(...arguments),this._graphics=new i,this._networkFeatureMap=new Map,this._networkGraphicMap=new Map,this._interaction=null,this._loadInteractionPromise=null,this.interactive=!1}get _routeItems(){return new a({getCollections:()=>this.layer==null||this.destroyed?[]:[this.layer.routeInfo==null?null:new i([this.layer.routeInfo]),this.layer.directionLines,this.layer.directionPoints,this.layer.polygonBarriers,this.layer.polylineBarriers,this.layer.pointBarriers,this.layer.stops]})}initialize(){this.addHandles(n(()=>{let{interactive:e,suspended:t}=this;return{interactive:e,suspended:t}},({interactive:e,suspended:t})=>{let n=e&&!t;n&&this._getInteractionLoadPromise().then(e=>{e.enabled=this.interactive&&!this.suspended}),this._interaction&&(this._interaction.enabled=n)},l)),this._updatingHandles.addOnCollectionChange(()=>this._routeItems,e=>this._routeItemsChanged(e),o)}destroy(){this._networkFeatureMap.clear(),this._networkGraphicMap.clear(),this._graphics.removeAll(),this._get(`_routeItems`)?.destroy()}attach(){this._createGraphicsView()}detach(){this._destroyGraphicsView(),this._interaction?.enabled&&(this._interaction.enabled=!1)}get selectedNetworkFeatures(){return this._interaction?.selectedNetworkFeatures??null}async create(e){if(this.interactive)return(await this._getInteractionLoadPromise()).create(e)}async fetchPopupFeaturesAtLocation(e,t){return this._graphicsView.hitTest(e).filter(({popupTemplate:e})=>!!e)}highlight(e,t){let n;n=T(e)?[this._getNetworkFeatureUid(e)]:D(e)?e.map(e=>this._getNetworkFeatureUid(e)):E(e)?e.map(e=>this._getNetworkFeatureUid(e)).toArray():[e.uid];let r=n.filter(c);if(!r.length)return u();let i=b(t);return this._addHighlights(r,i),u(()=>this._removeHighlights(r,i))}async hitTest(e,t){if(this.suspended)return null;let n=this._graphicsView.hitTest(e).filter(c).map(e=>this._networkGraphicMap.get(e));if(!n.length)return null;let{layer:r}=this;return n.reverse().map(t=>({type:`route`,layer:r,mapPoint:e,networkFeature:t}))}isUpdating(){return this._graphicsView.updating}moveEnd(){}remove(e){this._interaction?.remove(e)}update(e){this._graphicsView.processUpdate(e)}viewChange(){this._graphicsView.viewChange()}_createGraphic(e){let t=e.toGraphic();return t.layer=this.layer,t.sourceLayer=this.layer,t}_createGraphicsView(){let e=this.view,t=()=>this.requestUpdate(),n=new x(e.featuresTilingScheme);this._graphicsView=new S({container:n,graphics:this._graphics,requestUpdateCallback:t,view:e}),this.container.addChild(n),this._processHighlight()}_destroyGraphicsView(){this.container.removeChild(this._graphicsView.container),this._graphicsView.destroy()}_getDrawOrder(e){let t=this._networkGraphicMap.get(e);return C.indexOf(t.type)}_getInteractionLoadPromise(){return this._loadInteractionPromise||(this._loadInteractionPromise=this._loadInteraction(),this._updatingHandles.addPromise(this._loadInteractionPromise)),this._loadInteractionPromise}_getNetworkFeatureUid(e){return this._networkFeatureMap.has(e)?this._networkFeatureMap.get(e).uid:null}async _loadInteraction(){let{layer:e,view:n}=this,{RouteLayerInteraction:r}=await t(async()=>{let{RouteLayerInteraction:e}=await import(`./RouteLayerInteraction-DgjWWrzB.js`);return{RouteLayerInteraction:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41]));return this._interaction=new r({view:n,layer:e}),this._interaction}_routeItemsChanged(e){if(e.removed.length){this._graphics.removeMany(e.removed.map(e=>{let t=this._networkFeatureMap.get(e);return this._networkFeatureMap.delete(e),this._networkGraphicMap.delete(t),t}));for(let t of e.removed)this.removeHandles(t)}if(e.added.length){this._graphics.addMany(e.added.map(e=>{let t=this._createGraphic(e);return t.symbol==null?null:(this._networkFeatureMap.set(e,t),this._networkGraphicMap.set(t,e),t)}).filter(c));for(let t of e.added)this.addHandles([n(()=>t.geometry,(e,n)=>{this._updateGraphic(t,`geometry`,e,n)}),n(()=>t.symbol,(e,n)=>{this._updateGraphic(t,`symbol`,e,n)}),n(()=>t.popupTemplate,e=>{this._networkFeatureMap.has(t)&&(this._networkFeatureMap.get(t).popupTemplate=e)}),n(()=>t.toGraphic().attributes,e=>{this._networkFeatureMap.has(t)&&(this._networkFeatureMap.get(t).attributes=e)})],t);this._graphics.sort((e,t)=>this._getDrawOrder(e)-this._getDrawOrder(t))}}_updateGraphic(e,t,n,r){if(!this._networkFeatureMap.has(e)){let t=this._createGraphic(e);this._networkFeatureMap.set(e,t),this._networkGraphicMap.set(t,e),this._graphics.add(t);return}let i=this._networkFeatureMap.get(e);i[t]=n,w.graphic=i,w.property=t,w.oldValue=r,w.newValue=n,this._graphicsView.graphicUpdateHandler(w)}_processHighlight(){let e=this._getHighlights();this._graphicsView?.setHighlight(e)}};e([r()],O.prototype,`_graphics`,void 0),e([r()],O.prototype,`_routeItems`,null),e([r()],O.prototype,`_interaction`,void 0),e([r()],O.prototype,`interactive`,void 0),e([r({readOnly:!0})],O.prototype,`selectedNetworkFeatures`,null),O=e([s(`esri.views.2d.layers.RouteLayerView2D`)],O);var k=O;export{k as default};