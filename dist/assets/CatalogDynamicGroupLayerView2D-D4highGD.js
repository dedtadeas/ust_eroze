import{CD as e,Kw as t,MC as n,SC as r,kC as i,sT as a,vE as o,vT as s,wT as c,ym as l}from"./index-BqmCqmfp.js";import"./layerViewUtils-Bbe7IKvz.js";import"./Container-DgT8F3N0.js";import"./EffectView-CvH-XuUh.js";import{t as u}from"./LayerView2D-DVE2Teoj.js";import{t as d}from"./LayerView-DKEUJRIQ.js";var f=Symbol(),p=u=>{let d=u,p=class extends d{constructor(...e){super(...e),this.layerViews=new r,this._debouncedUpdate=t(async()=>{let{layer:e,parent:t}=this,n=t?.footprintLayerView,r=[],i=this._createQuery();if(i&&n){let{features:t}=await n.queryFeatures(i);this.suspended||(r=t.map(t=>e.acquireLayer(t)))}this.removeHandles(f),this.addHandles(r,f)})}get creatingLayerViews(){return this.view?.layerViewManager.isCreatingLayerViewsForLayer(this.layer)??!1}isUpdating(){return this.creatingLayerViews||this.layer.updating||this.layerViews.some(e=>e.updating)}enableLayerUpdates(){return c([this._updatingHandles.addWhen(()=>!1===this.parent?.footprintLayerView?.dataUpdating,()=>this.updateLayers()),this._updatingHandles.add(()=>[this.layer.maximumVisibleSublayers,this.layer.parent?.orderBy,this.parent?.footprintLayerView?.filter,this.parent?.footprintLayerView?.timeExtent,this.suspended],()=>this.updateLayers()),s(()=>this.removeHandles(f))])}updateLayers(){this.suspended?this.removeHandles(f):this._updatingHandles.addPromise(a(this._debouncedUpdate()).catch(e=>{o.getLogger(this).error(e)}))}_createQuery(){let e=this.parent?.footprintLayerView,t=this.layer?.parent;if(!e||!t||t.destroyed)return null;let{layer:{maximumVisibleSublayers:n},view:{scale:r}}=this;if(!n)return null;let{itemTypeField:i,itemSourceField:a,itemNameField:o,minScaleField:s,maxScaleField:c,objectIdField:u,orderBy:d}=t,f=l(`${s} IS NULL OR ${r} <= ${s} OR ${s} = 0`,`${c} IS NULL OR ${r} >= ${c}`),p=d?.find(e=>e.field&&!e.valueExpression),m=e.createQuery();if(m.returnGeometry=!1,m.num=n,m.outFields=[u,a,o],m.where=l(m.where,f),this.unsupportedItemTypes!=null){let e=`${i} NOT IN (${this.unsupportedItemTypes.map(e=>`'${e}'`)})`;m.where=l(m.where,e)}return p?.field&&(m.orderByFields=[`${p.field} ${p.order===`descending`?`DESC`:`ASC`}`],m.outFields.push(p.field)),m}};return e([n({readOnly:!0})],p.prototype,`creatingLayerViews`,null),e([n()],p.prototype,`layer`,void 0),e([n()],p.prototype,`layerViews`,void 0),e([n({readOnly:!0})],p.prototype,`unsupportedItemTypes`,void 0),e([n()],p.prototype,`parent`,void 0),e([n({readOnly:!0})],p.prototype,`isUpdating`,null),p=e([i(`esri.views.layers.CatalogDynamicGroupLayerView`)],p),p},m=class extends p(u(d)){constructor(){super(...arguments),this.unsupportedItemTypes=[`Scene Service`],this.layerViews=new r}attach(){this.addAttachHandles([this.layerViews.on(`after-changes`,()=>this._updateStageChildren()),this.enableLayerUpdates()])}detach(){this.container.removeAllChildren()}update(e){this.updateLayers()}viewChange(){}moveEnd(){this.requestUpdate()}_updateStageChildren(){this.container.removeAllChildren(),this.layerViews.forEach((e,t)=>this.container.addChildAt(e.container,t))}};m=e([i(`esri.views.2d.layers.CatalogDynamicGroupLayerView2D`)],m);var h=m;export{h as default};