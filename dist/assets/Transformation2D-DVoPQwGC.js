import{I as e,Lt as t,in as n,kt as r,m as i,nn as a,vn as o,x as s,z as c}from"./Point2D-UYEfE6HP.js";var l=class e{constructor(t,n,r){if(t instanceof e)return this.data=t.data,this.N=t.N,this.M=t.M,t.data=null,t.N=0,void(t.M=0);this.data=t,this.N=n,this.M=r}assignCopy(e){return this===e||(o(this.N*this.M===e.N*e.M),this.data.set(e.data),this.N=e.N,this.M=e.M),this}setZero(){return this.data?.fill(0),this}setIdentity(){for(let e=0;e<this.N;e++)for(let t=0;t<this.M;t++)this.setRowCol(e,t,e===t?1:0);return this}rows(){return this.N}cols(){return this.M}row(e){return o(0),{}}set(e,t){return this.data[e]=t,this}setRowCol(e,t,n){return this.data[e*this.M+t]=n,this}at(e){return this.data[e]}atRowCol(e,t){return this.data[e*this.M+t]}mulScalar(e,t){o(0)}mul(t,n){if(o(this.M===t.rows()),o(this.N===n.rows()),o(t.cols()===n.cols()),n===this){let r=new Float64Array(this.N*this.M),i=new e(r,this.N,this.M);this.mul(t,i),n.assignCopy(i);return}if(n===t){let r=new Float64Array(t.N*t.M),i=new e(r,t.N,t.M);this.mul(t,i),n.assignCopy(i);return}let r=t.cols();for(let e=0;e<this.N;e++)for(let i=0;i<r;i++){let r=0;for(let n=0;n<this.M;n++)r+=this.atRowCol(e,n)*t.atRowCol(n,i);n.setRowCol(e,i,r)}}mulTranspose(t,n){if(o(this.M===t.cols()),o(this.N===n.rows()),o(t.rows()===n.cols()),n===this){let r=new Float64Array(this.N*this.M),i=new e(r,this.N,this.M);this.mulTranspose(t,i),n.assignCopy(i);return}if(n===t){let r=new Float64Array(t.N*t.M),i=new e(r,t.N,t.M);this.mulTranspose(t,i),n.assignCopy(i);return}let r=t.rows();for(let e=0;e<this.N;e++)for(let i=0;i<r;i++){let r=0;for(let n=0;n<this.M;n++)r+=this.atRowCol(e,n)*t.atRowCol(i,n);n.setRowCol(e,i,r)}}mulLeft(e,t){o(0)}mulLeftTranspose(e,t){o(0)}mulDiag(t,n){if(o(this.M===t.N*t.M),o(this.N===n.rows()),o(this.M===n.cols()),n===this){let r=new Float64Array(this.N*this.M),i=new e(r,this.N,this.M);this.mulDiag(t,i),n.assignCopy(i);return}let r=this.M;for(let e=0;e<this.N;e++)for(let i=0;i<r;i++)n.setRowCol(e,i,this.atRowCol(e,i)*t.at(i))}transposeInPlace(){if(this.N===this.M){for(let e=0;e<this.N;e++)for(let t=e+1;t<this.M;t++){let n=this.atRowCol(e,t);this.setRowCol(e,t,this.atRowCol(t,e)),this.setRowCol(t,e,n)}return this}let t=new Float64Array(this.N*this.M),n=new e(t,this.N,this.M);return n.assignCopy(this),this.M=c(this.N,this.N=this.M),n.transpose(this),this}transpose(t){if(this!==t){e.checkDims(t,this.M,this.N);for(let e=0;e<this.N;e++)for(let n=0;n<this.M;n++)t.setRowCol(n,e,this.atRowCol(e,n))}else t.transposeInPlace()}add(e,t){}svd(t,n,r,i=!1){if(e.checkDims(t,this.N,this.M),e.checkDims(n,this.M,1),e.checkDims(r,this.M,this.M),i){if(o(this.N===this.M),!this.symmetricEigen(n,r))return!1;for(let e=0;e<this.M;++e)n.at(e)<0&&n.set(e,0);return t.assignCopy(r),!0}let a,s,c,l,u,d,f,p=0,m=0,h=0,g=0,_=0,v=this.M,y=this.N;t.assignCopy(this);let b=new Float64Array(v),x=new e(b,v,1),S=(e,t)=>t>=0?Math.abs(e):-Math.abs(e),C=(e,t)=>{if((e=Math.abs(e))>(t=Math.abs(t))){let n=t/e;return e*Math.sqrt(n*n+1)}if(t>0){let n=e/t;return t*Math.sqrt(n*n+1)}return 0};for(let e=0;e<v;e++){if(p=e+1,x.set(e,g*h),h=l=g=0,e<y){for(let n=e;n<y;n++)g+=Math.abs(t.atRowCol(n,e));if(g){for(let n=e;n<y;n++)t.setRowCol(n,e,t.atRowCol(n,e)/g),l+=t.atRowCol(n,e)*t.atRowCol(n,e);s=t.atRowCol(e,e),h=-S(Math.sqrt(l),s),c=s*h-l,t.setRowCol(e,e,s-h);for(let n=p;n<v;n++){l=0;for(let r=e;r<y;r++)l+=t.atRowCol(r,e)*t.atRowCol(r,n);s=l/c;for(let r=e;r<y;r++)t.setRowCol(r,n,t.atRowCol(r,n)+s*t.atRowCol(r,e))}for(let n=e;n<y;n++)t.setRowCol(n,e,t.atRowCol(n,e)*g)}}if(n.set(e,g*h),h=l=g=0,e<y&&e!==v-1){for(let n=p;n<v;n++)g+=Math.abs(t.atRowCol(e,n));if(g){for(let n=p;n<v;n++)t.setRowCol(e,n,t.atRowCol(e,n)/g),l+=t.atRowCol(e,n)*t.atRowCol(e,n);s=t.atRowCol(e,p),h=-S(Math.sqrt(l),s),c=s*h-l,t.setRowCol(e,p,s-h);for(let n=p;n<v;n++)x.set(n,t.atRowCol(e,n)/c);for(let n=p;n<y;n++){l=0;for(let r=p;r<v;r++)l+=t.atRowCol(n,r)*t.atRowCol(e,r);for(let e=p;e<v;e++)t.setRowCol(n,e,t.atRowCol(n,e)+l*x.at(e))}for(let n=p;n<v;n++)t.setRowCol(e,n,t.atRowCol(e,n)*g)}}let r=Math.abs(n.at(e))+Math.abs(x.at(e));_=r>_?r:_}for(let e=v-1;e>=0;e--){if(e<v-1){if(h){for(let n=p;n<v;n++)r.setRowCol(n,e,t.atRowCol(e,n)/t.atRowCol(e,p)/h);for(let n=p;n<v;n++){l=0;for(let i=p;i<v;i++)l+=t.atRowCol(e,i)*r.atRowCol(i,n);for(let t=p;t<v;t++)r.setRowCol(t,n,r.atRowCol(t,n)+l*r.atRowCol(t,e))}}for(let t=p;t<v;t++)r.setRowCol(e,t,0),r.setRowCol(t,e,0)}r.setRowCol(e,e,1),h=x.at(e),p=e}for(let e=(y<v?y:v)-1;e>=0;e--){p=e+1,h=n.at(e);for(let n=p;n<v;n++)t.setRowCol(e,n,0);if(h){h=1/h;for(let n=p;n<v;n++){l=0;for(let r=p;r<y;r++)l+=t.atRowCol(r,e)*t.atRowCol(r,n);s=l/t.atRowCol(e,e)*h;for(let r=e;r<y;r++)t.setRowCol(r,n,t.atRowCol(r,n)+s*t.atRowCol(r,e))}for(let n=e;n<y;n++)t.setRowCol(n,e,t.atRowCol(n,e)*h)}else for(let n=e;n<y;n++)t.setRowCol(n,e,0);t.setRowCol(e,e,t.atRowCol(e,e)+1)}for(let e=v-1;e>=0;e--)for(let i=1;;i++){let o=1;for(p=e;p>=0;p--){if(m=p-1,Math.abs(x.at(p))+_===_){o=0;break}if(Math.abs(n.at(m))+_===_)break}if(o){a=0,l=1;for(let r=p;r<=e&&(s=l*x.at(r),x.set(r,x.at(r)*a),Math.abs(s)+_!==_);r++){h=n.at(r),c=C(s,h),n.set(r,c),c=1/c,a=h*c,l=-s*c;for(let e=0;e<y;e++)d=t.atRowCol(e,m),f=t.atRowCol(e,r),t.setRowCol(e,m,d*a+f*l),t.setRowCol(e,r,f*a-d*l)}}if(f=n.at(e),p===e){if(f<0){n.set(e,-f);for(let t=0;t<v;t++)r.setRowCol(t,e,-r.atRowCol(t,e))}break}if(i===100)return!1;u=n.at(p),m=e-1,d=n.at(m),h=x.at(m),c=x.at(e),s=((d-f)*(d+f)+(h-c)*(h+c))/(2*c*d),h=C(s,1),s=((u-f)*(u+f)+c*(d/(s+S(h,s))-c))/u,a=l=1;for(let e=p;e<=m;e++){let i=e+1;h=x.at(i),d=n.at(i),c=l*h,h*=a,f=C(s,c),x.set(e,f),a=s/f,l=c/f,s=u*a+h*l,h=h*a-u*l,c=d*l,d*=a;for(let t=0;t<v;t++)u=r.atRowCol(t,e),f=r.atRowCol(t,i),r.setRowCol(t,e,u*a+f*l),r.setRowCol(t,i,f*a-u*l);f=C(s,c),n.set(e,f),f&&(f=1/f,a=s*f,l=c*f),s=a*h+l*d,u=a*d-l*h;for(let n=0;n<y;n++)d=t.atRowCol(n,e),f=t.atRowCol(n,i),t.setRowCol(n,e,d*a+f*l),t.setRowCol(n,i,f*a-d*l)}x.set(p,0),x.set(e,s),n.set(e,u)}let w=new Float64Array(this.N),T=new Float64Array(this.M),E=new e(w,this.N,1),D=new e(T,this.M,1),O=1;do O*=3,O++;while(O<=this.M);do{O/=3,O=Math.trunc(O);for(let e=O;e<this.M;e++){let i=n.at(e);for(let n=0;n<this.N;n++)E.set(n,t.atRowCol(n,e));for(let t=0;t<this.M;t++)D.set(t,r.atRowCol(t,e));let a=e;for(;n.at(a-O)<i;){n.set(a,n.at(a-O));for(let e=0;e<this.N;e++)t.setRowCol(e,a,t.atRowCol(e,a-O));for(let e=0;e<this.M;e++)r.setRowCol(e,a,r.atRowCol(e,a-O));if(a-=O,a<O)break}n.set(a,i);for(let e=0;e<this.N;e++)t.setRowCol(e,a,E.at(e));for(let e=0;e<this.M;e++)r.setRowCol(e,a,D.at(e))}}while(O>1);for(let e=0;e<this.M;e++){let n=0;for(let r=0;r<this.N;r++)t.atRowCol(r,e)<0&&n++;for(let t=0;t<this.M;t++)r.atRowCol(t,e)<0&&n++;if(n>Math.trunc((this.N+this.M)/2)){for(let n=0;n<this.N;n++)t.setRowCol(n,e,-t.atRowCol(n,e));for(let t=0;t<this.M;t++)r.setRowCol(t,e,-r.atRowCol(t,e))}}return!0}isSymmetric(){if(this.N!==this.M)return!1;for(let e=0;e<this.N;e++)for(let t=e+1;t<this.M;t++)if(this.atRowCol(e,t)!==this.atRowCol(t,e))return!1;return!0}isZero(){return o(0),!1}isIdentity(){return o(0),!1}equals(e,t){if(t!==void 0&&o(0),this.N!==e.N||this.M!==e.M)return!1;for(let t=0;t<this.N*this.M;t++)if(this.data[t]!==e.data[t])return!1;return!0}maxElement(){return o(0),0}minElement(){return o(0),0}determinant(){if(o(this.N===this.M),this.N===1)return this.data[0];if(this.N===2)return this.data[0]*this.data[3]-this.data[1]*this.data[2];if(this.N===3){let e=this;return e.atRowCol(0,0)*(e.atRowCol(1,1)*e.atRowCol(2,2)-e.atRowCol(1,2)*e.atRowCol(2,1))-e.atRowCol(0,1)*(e.atRowCol(1,0)*e.atRowCol(2,2)-e.atRowCol(2,0)*e.atRowCol(1,2))+e.atRowCol(0,2)*(e.atRowCol(1,0)*e.atRowCol(2,1)-e.atRowCol(1,1)*e.atRowCol(2,0))}let t=new Float64Array(this.N*this.N),n=new e(t,this.N,this.N),r=new Float64Array(this.N);if(!this.luDecomposition(n,r))return 0;let i=1;for(let e=0;e<this.N;e++)i*=n.atRowCol(e,e),r[e]!==e&&(i=-i);return i}submatrix(e,t,n){o(0)}inverse(e){o(0)}pseudoInverse(t,n=!1,r=2220446049250313e-31){if(t.setZero(),this.N===1&&this.M===1)return this.atRowCol(0,0)===0?t.setRowCol(0,0,0):t.setRowCol(0,0,1/this.atRowCol(0,0)),!0;if(this.N===2&&this.M===2){let e=this.atRowCol(0,0)*this.atRowCol(1,1)-this.atRowCol(0,1)*this.atRowCol(1,0),n=1e-5*(Math.abs(this.atRowCol(0,0)*this.atRowCol(1,1))+Math.abs(this.atRowCol(0,1)*this.atRowCol(1,0)));if(Math.abs(e)>n)return t.setRowCol(0,0,this.atRowCol(1,1)/e),t.setRowCol(0,1,-this.atRowCol(0,1)/e),t.setRowCol(1,0,-this.atRowCol(1,0)/e),t.setRowCol(1,1,this.atRowCol(0,0)/e),!0}let i=new Float64Array(this.N*this.M),a=new e(i,this.N,this.M),o=new Float64Array(this.M),s=new e(o,this.M,1),c=new Float64Array(this.M*this.M),l=new e(c,this.M,this.M);if(!this.svd(a,s,l,n))return!1;let u=Math.max(this.N,this.M),d=r*Math.abs(s.at(0))*u;for(let e=0;e<this.M;e++)s.at(e)>d?s.set(e,1/s.at(e)):s.set(e,0);return l.mulDiag(s,t),t.mulTranspose(a,t),!0}luDecomposition(e,t){return o(0),!1}symmetricEigen(t,n){o(this.rows()===this.cols()),o(this.rows()===t.rows()),o(n.rows()===n.cols()&&n.rows()===this.rows()),o(this.isSymmetric());let r=new Float64Array(this.N*this.M),i=new e(r,this.N,this.M);i.assignCopy(this);let a=100/2**-52,s=this.rows(),c=new Float64Array(s),l=new Float64Array(s),u=new e(c,s,1),d=new e(l,s,1);for(let e=0;e<s;e++)u.set(e,i.atRowCol(e,e)),t.set(e,i.atRowCol(e,e)),d.set(e,0);n.setIdentity();let f=()=>{let e=u;n.transposeInPlace();let r=1;do r*=3,r++;while(r<=s);do{r/=3,r=Math.trunc(r);for(let i=r;i<s;i++){let a=t.at(i),o=Math.abs(a);for(let t=0;t<this.M;t++)e.set(t,n.atRowCol(t,i));let s=i;for(;Math.abs(t.at(s-r))<o;){t.set(s,t.at(s-r));for(let e=0;e<this.M;e++)n.setRowCol(e,s,n.atRowCol(e,s-r));if(s-=r,s<r)break}if(s!==i){t.set(s,a);for(let t=0;t<this.M;t++)n.setRowCol(t,s,e.at(t))}}}while(r>1)};for(let e=1;;e++){let r=0;for(let e=1;e<s;e++)for(let t=0;t<e;t++)r+=Math.abs(i.atRowCol(e,t));if(r===0)return f(),!0;let o=e<4?.2*r/(s*s):0;for(let r=0;r<s;r++)for(let c=r+1;c<s;c++){let l=a*Math.abs(i.atRowCol(c,r));if(e>4&&l<=Math.abs(t.at(r))&&l<=Math.abs(t.at(c)))i.setRowCol(c,r,0);else if(Math.abs(i.atRowCol(c,r))>o){let e,a=t.at(c)-t.at(r);if(l<Math.abs(a))e=i.atRowCol(c,r)/a;else{let t=.5*a/i.atRowCol(c,r);e=1/(Math.abs(t)+Math.sqrt(1+t*t)),t<0&&(e=-e)}let o=1/Math.sqrt(1+e*e),u=e*o,f=u/(1+o);a=e*i.atRowCol(c,r),d.set(r,d.at(r)-a),d.set(c,d.at(c)+a),t.set(r,t.at(r)-a),t.set(c,t.at(c)+a),i.setRowCol(c,r,0);let p=0;for(;p<r;p++)l=i.atRowCol(r,p),a=i.atRowCol(c,p),i.setRowCol(r,p,l-u*(a+l*f)),i.setRowCol(c,p,a+u*(l-a*f));for(p++;p<c;p++)l=i.atRowCol(p,r),a=i.atRowCol(c,p),i.setRowCol(p,r,l-u*(a+l*f)),i.setRowCol(c,p,a+u*(l-a*f));for(p++;p<s;p++)l=i.atRowCol(p,r),a=i.atRowCol(p,c),i.setRowCol(p,r,l-u*(a+l*f)),i.setRowCol(p,c,a+u*(l-a*f));for(p=0;p<s;p++)l=n.atRowCol(r,p),a=n.atRowCol(c,p),n.setRowCol(r,p,l-u*(a+l*f)),n.setRowCol(c,p,a+u*(l-a*f))}}for(let e=0;e<s;e++)u.set(e,u.at(e)+d.at(e)),t.set(e,u.at(e)),d.set(e,0)}}static checkDims(e,t,n){o(e.rows()===t&&e.cols()===n)}},u=class extends l{constructor(e){if(e.copy){let t=new Float64Array(e.copy.N*e.copy.M);super(t,e.copy.N,e.copy.M),this.buffer=t,this.assignCopy(e.copy);return}let t=new Float64Array(e.NN*e.MM);super(t,e.NN,e.MM),this.buffer=t,e.initializerList&&i(this.buffer,e.initializerList,0,0,e.initializerList.length)}assignCopy(e){return this===e||super.assignCopy(e),this}},d=class i{constructor(e){this.m_TransformationType=1,e===void 0?this.setIdentity():e instanceof i?this.set(e):this.setScale(e)}set(e){return this.xx=e.xx,this.xy=e.xy,this.xd=e.xd,this.yx=e.yx,this.yy=e.yy,this.yd=e.yd,this}clone(){return new i().set(this)}setZero(){this.xx=0,this.yy=0,this.xy=0,this.yx=0,this.xd=0,this.yd=0}isEqual(e){return this===e||this.xx===e.xx&&this.xy===e.xy&&this.xd===e.xd&&this.yx===e.yx&&this.yy===e.yy&&this.yd===e.yd}transformInPlace(e){let t=this.xx*e.x+this.xy*e.y+this.xd,n=this.yx*e.x+this.yy*e.y+this.yd;e.x=t,e.y=n}transform(e){let t=e.clone();return this.transformInPlace(t),t}queryTransform(e,t){let n=this.xx*e.x+this.xy*e.y+this.xd,r=this.yx*e.x+this.yy*e.y+this.yd;t.setCoords(n,r)}transformEnvInPlace(t){if(t.isEmpty())return;let n=e(r,4);t.queryCorners(n),this.transformPoints2D(n,4,n),t.setFromPoints(n,4)}queryTransformEnv(e,t){o(0)}transformPoints2D(e,t,n){for(let r=0;r<t;++r)this.queryTransform(e[r],n[r])}transformInterleavedPoints(e,t,n){t*=2;let i=r.getNAN();for(let r=0;r<t;r+=2)i.x=e[r],i.y=e[r+1],this.transformInPlace(i),n[r]=i.x,n[r+1]=i.y}multiply(e){return i.st_multiply(this,e,this),this}mulLeft(e){return o(0),this}static st_multiply(e,t,n){let r=e.xx*t.xx+e.yx*t.xy,i=e.xy*t.xx+e.yy*t.xy,a=e.xd*t.xx+e.yd*t.xy+t.xd,o=e.xx*t.yx+e.yx*t.yy,s=e.xy*t.yx+e.yy*t.yy,c=e.xd*t.yx+e.yd*t.yy+t.yd;n.xx=r,n.xy=i,n.xd=a,n.yx=o,n.yy=s,n.yd=c}getCoefficients(e){o(e.length>=6),e[0]=this.xx,e[1]=this.xy,e[2]=this.xd,e[3]=this.yx,e[4]=this.yy,e[5]=this.yd}setCoefficients(e){o(e.length>=6),this.xx=e[0],this.xy=e[1],this.xd=e[2],this.yx=e[3],this.yy=e[4],this.yd=e[5]}copyTo(e){o(0)}initializeFromRect(e,t){e.isEmpty()||t.isEmpty()||!e.width()||!e.height()?this.setZero():(this.xy=this.yx=0,this.xx=t.width()/e.width(),this.yy=t.height()/e.height(),this.xd=t.xmin-e.xmin*this.xx,this.yd=t.ymin-e.ymin*this.yy)}initializeFromRectIsotropic(e,t){if(e.isEmpty()||!e.width()||!e.height()||t.isEmpty())this.setZero();else{this.yx=0,this.xy=0,this.xx=t.width()/e.width(),this.yy=t.height()/e.height(),this.xx>this.yy?this.xx=this.yy:this.yy=this.xx;let n=t.getCenter(),r=e.getCenter();this.xd=n.x-r.x*this.xx,this.yd=n.y-r.y*this.yy}}initializeFromTwoPointsArray(e,t){if(e[0].equals(t[0])&&e[1].equals(t[1]))return void this.setIdentity();if(e[0].equals(e[1])){if(t[0].equals(t[1]))return void this.setShift(t[0].sub(e[0]));n(``)}if(!e[0].equals(e[1])&&t[0].equals(t[1]))return this.setZero(),void this.shift(t[0]);this.setShiftCoords(-e[0].x,-e[0].y);let i=r.distance(e[0],e[1]),a=r.distance(t[0],t[1]),o=a/i;this.scale(o,o);let s=e[1].sub(e[0]);s.divThis(i);let c=t[1].sub(t[0]);c.divThis(a);let l=s.crossProduct(c),u=s.dotProduct(c);this.rotate(u,l),this.shiftCoords(t[0].x,t[0].y)}initializeFromTwoPoints(e,t,n,r){let i=[e,t],a=[n,r];this.initializeFromTwoPointsArray(i,a)}transformSizeInPlace(e){o(0)}transformSize(e,t){o(0)}transformTol(e){return o(0),0}transformWithoutTranslateArray(e,t,n){for(let r=0;r<t;++r)this.transformWithoutTranslate(e[r],n[r])}transformWithoutTranslateInPlace(e){let t=this.xx*e.x+this.xy*e.y,n=this.yx*e.x+this.yy*e.y;e.setCoords(t,n)}transformWithoutTranslate(e,t){let n=this.xx*e.x+this.xy*e.y,r=this.yx*e.x+this.yy*e.y;t.setCoords(n,r)}setIdentity(){this.xx=1,this.xy=0,this.xd=0,this.yx=0,this.yy=1,this.yd=0}isIdentity(){return!(this.xx!==1||this.yy!==1||this.xy||this.xd||this.yx||this.yd)}isIdentityTol(e){let t=e*e;return!(s(this.xd)+s(this.yd)>t)&&!(s(this.xy+this.xd)+s(this.yy+this.yd-1)>t)&&!(s(this.xx+this.xd-1)+s(this.yx+this.yd)>t)}isReflective(){return this.xx*this.yy-this.yx*this.xy<0}isUniform(e){let t=this.xx*this.xx+this.yx*this.yx,n=this.xy*this.xy+this.yy*this.yy,r=(t+n)*e;return Math.abs(t-n)<=r&&Math.abs(this.xx*this.xy+this.yx*this.yy)<=r}isUniformNoRotation(){return this.xx!==0&&Math.abs(this.xx)===Math.abs(this.yy)&&this.xy===0&&this.yx===0}isTranslate(){return this.xx===1&&this.yy===1&&!this.xy&&!this.yx}isTranslateTol(e){let t=new r;return t.setCoords(0,1),this.transformWithoutTranslateInPlace(t),--t.y,!(t.sqrLength()>e*e)&&(t.setCoords(1,0),this.transformWithoutTranslateInPlace(t),--t.x,t.sqrLength()<=e*e)}isOrthonormal(e){let t=new i;return t.xx=this.xx*this.xx+this.xy*this.xy,t.xy=this.xx*this.yx+this.xy*this.yy,t.yx=this.yx*this.xx+this.yy*this.xy,t.yy=this.yx*this.yx+this.yy*this.yy,t.xd=0,t.yd=0,t.isIdentityTol(e)}isDegenerate(e){return Math.abs(this.xx*this.yy-this.yx*this.xy)<=2*e*(Math.abs(this.xx*this.yy)+Math.abs(this.yx*this.xy))}isZero(){return this.xx===0&&this.yy===0&&this.xy===0&&this.yx===0&&this.xd===0&&this.yd===0}isScaleAndTranslateTol(e){return this.xy*this.xy+this.yx*this.yx<=(this.xx*this.xx+this.yy*this.yy)*e}setTranslate(e,t){return this.xx=1,this.xy=0,this.xd=e,this.yx=0,this.yy=1,this.yd=t,this}setShiftCoords(e,t){return this.xx=1,this.xy=0,this.xd=e,this.yx=0,this.yy=1,this.yd=t,this}setShift(e){return this.xx=1,this.xy=0,this.xd=e.x,this.yx=0,this.yy=1,this.yd=e.y,this}setScaleCoords(e,t){return this.xx=e,this.xy=0,this.xd=0,this.yx=0,this.yy=t,this.yd=0,this}setScale(e){return this.setScaleCoords(e,e),this}setFlipX(e,t){return this.xx=-1,this.xy=0,this.xd=e+t,this.yx=0,this.yy=1,this.yd=0,this}setFlipY(e,t){return this.xx=1,this.xy=0,this.xd=0,this.yx=0,this.yy=-1,this.yd=e+t,this}setShear(e,t){return this.xx=1,this.xy=e,this.xd=0,this.yx=t,this.yy=1,this.yd=0,this}scale(e,t){return this.xx*=e,this.xy*=e,this.xd*=e,this.yx*=t,this.yy*=t,this.yd*=t,this}setRotateAngle(e){return this.setRotate(Math.cos(e),Math.sin(e))}setRotate(e,t){return this.xx=e,this.xy=-t,this.xd=0,this.yx=t,this.yy=e,this.yd=0,this}setRotateAngleAbout(e,t){return this.setRotateAbout(Math.cos(e),Math.sin(e),t)}setRotateAbout(e,t,n){return this.setTranslate(-n.x,-n.y),this.rotate(e,t),this.translate(n.x,n.y)}setSwapCoordinates(){return this.xx=0,this.xy=1,this.xd=0,this.yx=1,this.yy=0,this.yd=0,this}setRotateCw90(){return this.xx=0,this.xy=1,this.xd=0,this.yx=-1,this.yy=0,this.yd=0,this}setRotateCcw90(){return this.xx=0,this.xy=-1,this.xd=0,this.yx=1,this.yy=0,this.yd=0,this}shiftCoords(e,t){return this.xd+=e,this.yd+=t,this}shift(e){return this.xd+=e.x,this.yd+=e.y,this}translate(e,t){return this.xd+=e,this.yd+=t,this}flipX(e,t){return this.xx=-this.xx,this.xy=-this.xy,this.xd=e+t-this.xd,this}flipY(e,t){return this.yx=-this.yx,this.yy=-this.yy,this.yd=e+t-this.yd,this}shear(e,t){let n=new i;return n.setShear(e,t),this.multiply(n)}rotateAngle(e){let t=new i;return t.setRotateAngle(e),this.multiply(t)}rotate(e,t){let n=new i;return n.setRotate(e,t),this.multiply(n)}rotateAbout(e,t,n){return this.translate(-n.x,-n.y),this.rotate(e,t),this.translate(n.x,n.y)}rotateAngleAbout(e,t){return this.rotateAbout(Math.cos(e),Math.sin(e),t)}setInvert(e){return this.set(e),this.invertThis()}invertThis(){let e=this.xx*this.yy-this.xy*this.yx;if(e===0)return this.setZero(),this;e=1/e;let t=(this.xy*this.yd-this.xd*this.yy)*e,n=(this.xd*this.yx-this.xx*this.yd)*e,r=this.yy*e,i=-this.xy*e,a=-this.yx*e,o=this.xx*e;return this.xd=t,this.yd=n,this.xx=r,this.yy=o,this.xy=i,this.yx=a,this}invertPrecise(e){return this.set(e),this.invertPreciseThis()}invertPreciseThis(){let e=t.constructDouble(this.xy),n=t.constructDouble(this.xx),r=n.mulDouble(this.yy).sub(e.mulDouble(this.yx));if(r.isZero())return this.setZero(),this;let i=r.clone();i.invertThis();let a=t.constructDouble(this.xd),o=e.mulDouble(this.yd).sub(a.mulDouble(this.yy)).mul(i).toDouble(),s=a.mulDouble(this.yx).sub(n.mulDouble(this.yd)).mul(i).toDouble(),c=i.mulDouble(this.yy).toDouble(),l=i.mulDouble(-this.xy).toDouble(),u=i.mulDouble(-this.yx).toDouble(),d=i.mulDouble(this.xx).toDouble();return this.xd=o,this.yd=s,this.xx=c,this.yy=d,this.xy=l,this.yx=u,this}extractScaleTransform(e,t){let n=Math.sqrt(this.xx*this.xx+this.xy*this.xy),r=Math.sqrt(this.yx*this.yx+this.yy*this.yy);t.setScaleCoords(1/n,1/r),t.multiply(this),e.setScaleCoords(n,r)}setFromTwoTriangles(e,t){let n=!0;for(let r=0;r<3;++r)n&&=e[r].equals(t[r]);if(n)return this.setIdentity(),!0;let i=new r;i.setSub(e[0],e[1]);let a=new r;a.setSub(e[0],e[2]);let o=new r;o.setSub(t[0],t[1]);let s=new r;s.setSub(t[0],t[2]);let c=4*2**-52*(Math.abs(i.x*a.y)+Math.abs(a.x*i.y)),l=i.x*a.y-i.y*a.x;return Math.abs(l)>c?(l=1/l,this.xx=(o.x*a.y-i.y*s.x)*l,this.xy=(i.x*s.x-o.x*a.x)*l,this.yx=(o.y*a.y-i.y*s.y)*l,this.yy=(i.x*s.y-o.y*a.x)*l,this.xd=t[0].x-(this.xx*e[0].x+this.xy*e[0].y),this.yd=t[0].y-(this.yx*e[0].x+this.yy*e[0].y),!0):(this.setZero(),!1)}initializeFromControlPoints(e,t,n,r,i=null){t===0?(this.setIdentity(),i&&i.setIdentity()):t===1?(this.setShift(r[0].sub(n[0])),i&&i.setShift(n[0].sub(r[0]))):(t<3&&(e=1),e===4&&t>2?m(this,t,n,r,i):h(e,this,t,n,r,i))}calculateErrors(e,t,n,i){o(e>0&&t!==null&&n!==null);let a=0;for(let o=0;o<e;++o){let e=this.transform(t[o]),s=r.sqrDistance(n[o],e);a+=s,i&&(i[o]=Math.sqrt(s))}return Math.sqrt(a/e)}},f=[43,11,41,9,61];function p(e,t){o(!(t.rows()!==2&&t.rows()!==3||t.cols()!==2&&t.rows()!==3)),e.xx=t.atRowCol(0,0),e.xy=t.atRowCol(0,1),e.yx=t.atRowCol(1,0),e.yy=t.atRowCol(1,1),t.cols()===3?(e.xd=t.atRowCol(0,2),e.yd=t.atRowCol(1,2)):(e.xd=0,e.yd=0)}function m(e,t,n,i,o){let s=r.average(n,t),c=r.average(i,t),l=new u({NN:2,MM:2});l.setZero();let d=new u({NN:2,MM:2});d.setZero();for(let e=0;e<t;++e)l.setRowCol(0,0,l.atRowCol(0,0)+(n[e].x-s.x)*(n[e].x-s.x)),l.setRowCol(0,1,l.atRowCol(0,1)+(n[e].x-s.x)*(n[e].y-s.y)),l.setRowCol(1,1,l.atRowCol(1,1)+(n[e].y-s.y)*(n[e].y-s.y)),d.setRowCol(0,0,d.atRowCol(0,0)+(i[e].x-c.x)*(n[e].x-s.x)),d.setRowCol(0,1,d.atRowCol(0,1)+(i[e].x-c.x)*(n[e].y-s.y)),d.setRowCol(1,0,d.atRowCol(1,0)+(i[e].y-c.y)*(n[e].x-s.x)),d.setRowCol(1,1,d.atRowCol(1,1)+(i[e].y-c.y)*(n[e].y-s.y));l.setRowCol(1,0,l.atRowCol(0,1));let f=new u({NN:2,MM:2});l.pseudoInverse(f,!0)||a(`Failed to compute pseudo inverse`),d.mul(f,d),p(e,d);let m=s.clone();e.transformInPlace(m),e.xd=c.x-m.x,e.yd=c.y-m.y,o&&(d.pseudoInverse(f,!1)||a(`Failed to compute pseudo inverse`),p(o,f),o.transformInPlace(c),o.xd=s.x-c.x,o.yd=s.y-c.y)}function h(e,t,n,i,s,c){o(e===1||e===0||e===2||e===3),t.setIdentity();let l=r.average(i,n),m=r.average(s,n);if(o(e<f.length&&e>0),8&f[e]){let r=new u({NN:2,MM:2});r.setZero();for(let e=0;e<n;++e)r.setRowCol(0,0,r.atRowCol(0,0)+(s[e].x-m.x)*(i[e].x-l.x)),r.setRowCol(1,0,r.atRowCol(1,0)+(s[e].x-m.x)*(i[e].y-l.y)),r.setRowCol(0,1,r.atRowCol(0,1)+(s[e].y-m.y)*(i[e].x-l.x)),r.setRowCol(1,1,r.atRowCol(1,1)+(s[e].y-m.y)*(i[e].y-l.y));let o=new u({NN:2,MM:2}),c=new u({NN:2,MM:1}),h=new u({NN:2,MM:2});r.svd(o,c,h)||a(`Failed to compute svd`);let g=new u({NN:2,MM:2});o.transpose(g);let _=new u({NN:2,MM:2});h.mul(g,_),!(32&f[e])&&_.determinant()<0&&(g.setRowCol(1,0,-g.atRowCol(1,0)),g.setRowCol(1,1,-g.atRowCol(1,1)),h.mul(g,_));let v=new d;p(v,_),t.set(v)}if(2&f[e]){let e=0,r=0;for(let a=0;a<n;++a){let n=i[a].sub(l);e+=n.sqrLength(),t.transformInPlace(n),r+=n.dotProduct(s[a].sub(m))}if(e===0)r===0?t.setIdentity():t.setZero();else{let n=r/e;t.scale(n,n)}}else o(!(4&f[e]));let h=l.clone();t.transformInPlace(h),t.xd=m.x-h.x,t.yd=m.y-h.y,c&&(c.set(t),c.invertThis(),c.isZero()&&(c.xd=l.x,c.yd=l.y))}export{d as t};