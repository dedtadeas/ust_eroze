import{$m as e,OS as t}from"./index-BqmCqmfp.js";function n(e,t){if(t&&e.type===`extent`)return`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`;if(t&&e.type===`point`)return`${e.x},${e.y}`;let n=e.toJSON();return delete n.spatialReference,JSON.stringify(n)}function r(r,i,a){let{geometry:o}=r,s=r.compactGeometryEnabled??!1,c=r.toJSON();delete c.compactGeometryEnabled,delete c.defaultSpatialReferenceEnabled;let l=c,u,d,f;if(o&&(d=o.spatialReference,f=t(d),l.geometryType=e(o),l.geometry=n(o,s),l.inSR=f),c.groupByFieldsForStatistics&&(l.groupByFieldsForStatistics=c.groupByFieldsForStatistics.join(`,`)),c.objectIds)switch(a?.uniqueIdFields?.length){case void 0:l.objectIds=c.objectIds.join(`,`);break;case 1:l.uniqueIds=JSON.stringify(c.objectIds),delete l.objectIds;break;default:l.uniqueIds=JSON.stringify(c.objectIds.map(e=>JSON.parse(e))),delete l.objectIds}if(c.orderByFields&&(l.orderByFields=c.orderByFields.join(`,`)),!c.outFields||!c.returnDistinctValues&&(i?.returnCountOnly||i?.returnExtentOnly||i?.returnIdsOnly)?delete l.outFields:c.outFields.includes(`*`)?l.outFields=`*`:l.outFields=c.outFields.join(`,`),c.outSR?(l.outSR=t(c.outSR),u=r.outSpatialReference):o&&(c.returnGeometry||c.returnCentroid)&&(l.outSR=l.inSR,u=d),c.returnGeometry&&delete c.returnGeometry,c.outStatistics&&(l.outStatistics=JSON.stringify(c.outStatistics)),c.fullText&&(l.fullText=JSON.stringify(c.fullText)),c.pixelSize&&(l.pixelSize=JSON.stringify(c.pixelSize)),c.quantizationParameters&&(r.defaultSpatialReferenceEnabled&&d!=null&&r.quantizationParameters?.extent!=null&&d.equals(r.quantizationParameters.extent.spatialReference)&&delete c.quantizationParameters.extent.spatialReference,l.quantizationParameters=JSON.stringify(c.quantizationParameters)),c.parameterValues&&(l.parameterValues=JSON.stringify(c.parameterValues)),c.rangeValues&&(l.rangeValues=JSON.stringify(c.rangeValues)),c.dynamicDataSource&&(l.layer=JSON.stringify({source:c.dynamicDataSource}),delete c.dynamicDataSource),c.timeExtent){let{start:e,end:t}=c.timeExtent;e==null&&t==null||(l.time=e===t?e:`${e??`null`},${t??`null`}`),delete c.timeExtent}return r.defaultSpatialReferenceEnabled&&d!=null&&u!=null&&d.equals(u)&&(l.defaultSR=l.inSR,delete l.inSR,delete l.outSR),l}export{r as t};