import{Do as e,Mo as t,To as n,Xo as r,Zo as i,bo as a,jo as o}from"./index-BqmCqmfp.js";import"./guid-D8BoG5RM.js";import"./controllers-DZ7pbtKF.js";import{x as s}from"./dom-atD5WAsR.js";import{t as c}from"./observers-Ca90Dkfx.js";import"./logger-N52NEE_B.js";import{t as l}from"./useSetFocus-BOgV9A-L.js";var u={frame:`frame`,frameAdvancing:`frame--advancing`,frameRetreating:`frame--retreating`},d=i`:host{--calcite-internal-color-focus: var( --calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)) )}:host{box-sizing:border-box;background-color:var(--calcite-color-foreground-1);color:var(--calcite-color-text-2);font-size:var(--calcite-font-size--1)}:host *{box-sizing:border-box}:host{position:relative;display:flex;inline-size:100%;flex:1 1 auto;align-items:stretch;overflow:hidden;background-color:transparent}:host .frame{position:relative;margin:0;display:flex;inline-size:100%;flex:1 1 auto;flex-direction:column;align-items:stretch;padding:0;animation-name:none;animation-duration:var(--calcite-animation-timing);background-color:var(--calcite-flow-background-color)}:host ::slotted(*){display:none;block-size:100%}:host ::slotted(*[selected]){display:flex}:host ::slotted(.calcite-match-height:last-child){display:flex;flex:1 1 auto;overflow:hidden}:host .frame--advancing{animation-name:calcite-frame-advance}:host .frame--retreating{animation-name:calcite-frame-retreat}@keyframes calcite-frame-advance{0%{--tw-bg-opacity: .5;transform:translate3d(50px,0,0)}to{--tw-bg-opacity: 1;transform:translateZ(0)}}@keyframes calcite-frame-retreat{0%{--tw-bg-opacity: .5;transform:translate3d(-50px,0,0)}to{--tw-bg-opacity: 1;transform:translateZ(0)}}:host([hidden]){display:none}[hidden]{display:none}`,f=class extends n{constructor(){super(),this.frameRef=o(),this.itemMutationObserver=c(`mutation`,()=>this.updateItemsAndProps()),this.items=[],this.selectedIndex=-1,this.focusSetter=l()(this),this.flowDirection=`standby`,this.listen(`calciteInternalFlowItemChange`,this.handleCalciteInternalFlowItemChange),this.listen(`calciteFlowItemBack`,this.handleItemBackClick)}static{this.properties={flowDirection:[16,{},{state:!0}],customItemSelectors:1}}static{this.styles=d}async back(){let{items:e,selectedIndex:t}=this,n=e[t],r=e[t-1];if(!n||!r)return;let i=n.beforeBack?n.beforeBack:()=>Promise.resolve();try{await i.call(n)}catch{return}return n.selected=!1,r.selected=!0,r}async setFocus(e){return this.focusSetter(()=>this.items[this.selectedIndex],e)}connectedCallback(){super.connectedCallback(),this.itemMutationObserver?.observe(this.el,{childList:!0,subtree:!0})}willUpdate(e){e.has(`flowDirection`)&&(this.hasUpdated||this.flowDirection!==`standby`)&&this.handleFlowDirectionChange(this.flowDirection)}loaded(){this.updateItemsAndProps()}disconnectedCallback(){super.disconnectedCallback(),this.itemMutationObserver?.disconnect()}async handleFlowDirectionChange(e){e===`standby`||!this.frameRef.value||(await s(this.frameRef.value,e===`retreating`?`calcite-frame-retreat`:`calcite-frame-advance`),this.resetFlowDirection())}handleCalciteInternalFlowItemChange(e){e.stopPropagation(),this.updateFlowProps()}async handleItemBackClick(e){if(!e.defaultPrevented)return await this.back(),this.setFocus()}resetFlowDirection(){this.flowDirection=`standby`}getFlowDirection(e,t){return!(e>-1&&t>0)&&!(e>0)?`standby`:t<e?`retreating`:`advancing`}updateItemsAndProps(){let{customItemSelectors:e,el:t}=this;this.items=Array.from(t.querySelectorAll(`calcite-flow-item${e?`,${e}`:``}`)).filter(e=>e.closest(`calcite-flow`)===t),this.ensureSelectedFlowItemExists(),this.updateFlowProps()}updateFlowProps(){let{selectedIndex:e,items:t}=this,n=this.findSelectedFlowItemIndex(t);t.forEach((e,t)=>{let r=t===n;r||(e.menuOpen=!1),e.showBackButton=r&&n>0}),n!==-1&&(e!==n&&(this.flowDirection=this.getFlowDirection(e,n)),this.selectedIndex=n)}findSelectedFlowItemIndex(e){let t=e.slice(0).reverse().find(e=>!!e.selected);return e.indexOf(t)}ensureSelectedFlowItemExists(){let{items:e}=this;if(this.findSelectedFlowItemIndex(e)!==-1)return;let t=e[e.length-1];t&&(t.selected=!0)}render(){let{flowDirection:n}=this,i={[u.frame]:!0,[u.frameAdvancing]:n===`advancing`,[u.frameRetreating]:n===`retreating`};return r`<div class=${e(i)} ${t(this.frameRef)}><slot></slot></div>`}};a(`calcite-flow`,f);export{f as Flow};