import{qy as e}from"./index-BqmCqmfp.js";var t={};t.defaultNoDataValue=e(-1/0),t.decode=function(o,s){var c=(s||={}).encodedMaskData||s.encodedMaskData===null,l=a(o,s.inputOffset||0,c),u=s.noDataValue==null?t.defaultNoDataValue:e(s.noDataValue),d=n(l,s.pixelType||Float32Array,s.encodedMaskData,u,s.returnMask),f={width:l.width,height:l.height,pixelData:d.resultPixels,minValue:l.pixels.minValue,maxValue:l.pixels.maxValue,noDataValue:u};return d.resultMask&&(f.maskData=d.resultMask),s.returnEncodedMask&&l.mask&&(f.encodedMaskData=l.mask.bitset?l.mask.bitset:null),s.returnFileInfo&&(f.fileInfo=r(l,u),s.computeUsedBitDepths&&(f.fileInfo.bitDepths=i(l))),f};var n=function(e,t,n,r,i){var a,s,c=0,l=e.pixels.numBlocksX,u=e.pixels.numBlocksY,d=Math.floor(e.width/l),f=Math.floor(e.height/u),p=2*e.maxZError;n||=e.mask?e.mask.bitset:null,a=new t(e.width*e.height),i&&n&&(s=new Uint8Array(e.width*e.height));for(var m,h,g=new Float32Array(d*f),_=0;_<=u;_++){var v=_===u?e.height%u:f;if(v!==0)for(var y=0;y<=l;y++){var b=y===l?e.width%l:d;if(b!==0){var x,S,C,w,T=_*e.width*f+y*d,E=e.width-b,D=e.pixels.blocks[c];if(D.encoding<2?(D.encoding===0?x=D.rawData:(o(D.stuffedData,D.bitsPerPixel,D.numValidPixels,D.offset,p,g,e.pixels.maxValue),x=g),S=0):C=D.encoding===2?0:D.offset,n)for(h=0;h<v;h++){for(7&T&&(w=n[T>>3],w<<=7&T),m=0;m<b;m++)7&T||(w=n[T>>3]),128&w?(s&&(s[T]=1),a[T++]=D.encoding<2?x[S++]:C):(s&&(s[T]=0),a[T++]=r),w<<=1;T+=E}else if(D.encoding<2)for(h=0;h<v;h++){for(m=0;m<b;m++)a[T++]=x[S++];T+=E}else for(h=0;h<v;h++)if(a.fill)a.fill(C,T,T+b),T+=b+E;else{for(m=0;m<b;m++)a[T++]=C;T+=E}if(D.encoding===1&&S!==D.numValidPixels)throw`Block and Mask do not match`;c++}}}return{resultPixels:a,resultMask:s}},r=function(e,t){return{fileIdentifierString:e.fileIdentifierString,fileVersion:e.fileVersion,imageType:e.imageType,height:e.height,width:e.width,maxZError:e.maxZError,eofOffset:e.eofOffset,mask:e.mask?{numBlocksX:e.mask.numBlocksX,numBlocksY:e.mask.numBlocksY,numBytes:e.mask.numBytes,maxValue:e.mask.maxValue}:null,pixels:{numBlocksX:e.pixels.numBlocksX,numBlocksY:e.pixels.numBlocksY,numBytes:e.pixels.numBytes,maxValue:e.pixels.maxValue,minValue:e.pixels.minValue,noDataValue:t}}},i=function(e){for(var t=e.pixels.numBlocksX*e.pixels.numBlocksY,n={},r=0;r<t;r++){var i=e.pixels.blocks[r];i.encoding===0?n.float32=!0:i.encoding===1?n[i.bitsPerPixel]=!0:n[0]=!0}return Object.keys(n)},a=function(e,t,n){var r={},i=new Uint8Array(e,t,10);if(r.fileIdentifierString=String.fromCharCode.apply(null,i),r.fileIdentifierString.trim()!=`CntZImage`)throw`Unexpected file identifier string: `+r.fileIdentifierString;t+=10;var a=new DataView(e,t,24);if(r.fileVersion=a.getInt32(0,!0),r.imageType=a.getInt32(4,!0),r.height=a.getUint32(8,!0),r.width=a.getUint32(12,!0),r.maxZError=a.getFloat64(16,!0),t+=24,!n)if(a=new DataView(e,t,16),r.mask={},r.mask.numBlocksY=a.getUint32(0,!0),r.mask.numBlocksX=a.getUint32(4,!0),r.mask.numBytes=a.getUint32(8,!0),r.mask.maxValue=a.getFloat32(12,!0),t+=16,r.mask.numBytes>0){var o=new Uint8Array(Math.ceil(r.width*r.height/8)),s=(a=new DataView(e,t,r.mask.numBytes)).getInt16(0,!0),c=2,l=0;do{if(s>0)for(;s--;)o[l++]=a.getUint8(c++);else{var u=a.getUint8(c++);for(s=-s;s--;)o[l++]=u}s=a.getInt16(c,!0),c+=2}while(c<r.mask.numBytes);if(s!==-32768||l<o.length)throw`Unexpected end of mask RLE encoding`;r.mask.bitset=o,t+=r.mask.numBytes}else (r.mask.numBytes|r.mask.numBlocksY|r.mask.maxValue)===0&&(o=new Uint8Array(Math.ceil(r.width*r.height/8)),r.mask.bitset=o);a=new DataView(e,t,16),r.pixels={},r.pixels.numBlocksY=a.getUint32(0,!0),r.pixels.numBlocksX=a.getUint32(4,!0),r.pixels.numBytes=a.getUint32(8,!0),r.pixels.maxValue=a.getFloat32(12,!0),t+=16;var d=r.pixels.numBlocksX,f=r.pixels.numBlocksY,p=d+(r.width%d>0?1:0),m=f+(r.height%f>0?1:0);r.pixels.blocks=Array(p*m);for(var h=1e9,g=0,_=0;_<m;_++)for(var v=0;v<p;v++){var y=0,b=e.byteLength-t;a=new DataView(e,t,Math.min(10,b));var x={};r.pixels.blocks[g++]=x;var S=a.getUint8(0);if(y++,x.encoding=63&S,x.encoding>3)throw`Invalid block encoding (`+x.encoding+`)`;if(x.encoding!==2){if(S!==0&&S!==2){if(S>>=6,x.offsetType=S,S===2)x.offset=a.getInt8(1),y++;else if(S===1)x.offset=a.getInt16(1,!0),y+=2;else{if(S!==0)throw`Invalid block offset type`;x.offset=a.getFloat32(1,!0),y+=4}if(h=Math.min(x.offset,h),x.encoding===1)if(S=a.getUint8(y),y++,x.bitsPerPixel=63&S,S>>=6,x.numValidPixelsType=S,S===2)x.numValidPixels=a.getUint8(y),y++;else if(S===1)x.numValidPixels=a.getUint16(y,!0),y+=2;else{if(S!==0)throw`Invalid valid pixel count type`;x.numValidPixels=a.getUint32(y,!0),y+=4}}var C;if(t+=y,x.encoding!=3){if(x.encoding===0){var w=(r.pixels.numBytes-1)/4;if(w!==Math.floor(w))throw`uncompressed block has invalid length`;C=new ArrayBuffer(4*w),new Uint8Array(C).set(new Uint8Array(e,t,4*w));for(var T=new Float32Array(C),E=0;E<T.length;E++)h=Math.min(h,T[E]);x.rawData=T,t+=4*w}else if(x.encoding===1){var D=Math.ceil(x.numValidPixels*x.bitsPerPixel/8),O=Math.ceil(D/4);C=new ArrayBuffer(4*O),new Uint8Array(C).set(new Uint8Array(e,t,D)),x.stuffedData=new Uint32Array(C),t+=D}}}else t++,h=Math.min(h,0)}return r.pixels.minValue=h,r.eofOffset=t,r},o=function(e,t,n,r,i,a,o){var s,c,l,u=(1<<t)-1,d=0,f=0,p=Math.ceil((o-r)/i),m=4*e.length-Math.ceil(t*n/8);for(e[e.length-1]<<=8*m,s=0;s<n;s++){if(f===0&&(l=e[d++],f=32),f>=t)c=l>>>f-t&u,f-=t;else{var h=t-f;c=(l&u)<<h&u,c+=(l=e[d++])>>>(f=32-h)}a[s]=c<p?r+c*i:o}return a},s=t.decode,c=class{_decode(e){let t=s(e.buffer,e.options);return Promise.resolve({result:t,transferList:[t.pixelData.buffer]})}};function l(){return new c}export{l as default};