import{AE as e,CD as t,MC as n,OC as r,bD as i,fh as a,ja as o,kC as s,ph as c,vE as l}from"./index-BqmCqmfp.js";var u=-1,d=class extends r{constructor(e){super(e),this._from=null,this._to=null,this._final=null,this._current=[],this._time=0,this.duration=i(`mapview-transitions-duration`),this.effects=[]}set effect(e){if(this._get(`effect`)!==(e||=``)){this._set(`effect`,e);try{this._transitionTo(f(e))}catch(t){this._transitionTo([]),l.getLogger(this).warn(`Invalid Effect`,{effect:e,error:t})}}}get final(){return this._final}get hasEffects(){return this.transitioning||!!this.effects.length}set scale(e){this._updateForScale(e)}get transitioning(){return this._to!==null}canTransitionTo(e){try{return this.scale>0&&p(this._current,f(e),this.scale)}catch{return!1}}transitionStep(e,t){this._applyTimeTransition(e),this._updateForScale(t)}endTransition(){this._applyTimeTransition(this.duration)}_transitionTo(t){this.scale>0&&p(this._current,t,this.scale)?(this._final=t,this._to=e(t),m(this._current,this._to,this.scale),this._from=e(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=t),this._set(`effects`,this._current[0]?e(this._current[0].effects):[])}_applyTimeTransition(t){if(!(this._to&&this._from&&this._current&&this._final))return;this._time+=t;let n=Math.min(1,this._time/this.duration);for(let e=0;e<this._current.length;e++){let t=this._current[e],r=this._from[e],i=this._to[e];t.scale=h(r.scale,i.scale,n);for(let e=0;e<t.effects.length;e++){let a=t.effects[e],o=r.effects[e],s=i.effects[e];a.interpolate(o,s,n)}}n===1&&(this._current=this._final,this._set(`effects`,this._current[0]?e(this._current[0].effects):[]),this._from=this._to=this._final=null)}_updateForScale(e){if(this._set(`scale`,e),this._current.length===0)return;let t=this._current,n=this._current.length-1,r,i,a=1;if(t.length===1||e>=t[0].scale)i=r=t[0].effects;else if(e<=t[n].scale)i=r=t[n].effects;else for(let o=0;o<n;o++){let n=t[o],s=t[o+1];if(n.scale>=e&&s.scale<=e){a=(e-n.scale)/(s.scale-n.scale),r=n.effects,i=s.effects;break}}for(let e=0;e<this.effects.length;e++)this.effects[e].interpolate(r[e],i[e],a)}};function f(e){let t=o(e)||[];return g(t)?[{scale:u,effects:t}]:t}function p(e,t,n){return!e[0]?.effects||!t[0]?.effects?!0:!((e[0]?.scale===u||t[0]?.scale===u)&&(e.length>1||t.length>1)&&n<=0)&&c(e[0].effects,t[0].effects)}function m(e,t,n){let r=e.length>t.length?e:t,i=e.length>t.length?t:e,o=i[i.length-1],s=o?.scale??n,c=o?.effects??[];for(let e=i.length;e<r.length;e++)i.push({scale:s,effects:[...c]});for(let e=0;e<r.length;e++)i[e].scale=i[e].scale===u?n:i[e].scale,r[e].scale=r[e].scale===u?n:r[e].scale,a(i[e].effects,r[e].effects)}function h(e,t,n){return e+(t-e)*n}function g(e){let t=e[0];return!!t&&`type`in t}t([n()],d.prototype,`_to`,void 0),t([n()],d.prototype,`duration`,void 0),t([n({value:``})],d.prototype,`effect`,null),t([n({readOnly:!0})],d.prototype,`effects`,void 0),t([n({readOnly:!0})],d.prototype,`final`,null),t([n({readOnly:!0})],d.prototype,`hasEffects`,null),t([n({value:0})],d.prototype,`scale`,null),t([n({readOnly:!0})],d.prototype,`transitioning`,null),d=t([s(`esri.layers.effects.EffectView`)],d);export{d as t};