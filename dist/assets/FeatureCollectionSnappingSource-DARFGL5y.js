import{CD as e,Hb as t,Kb as n,MC as r,OC as i,Wb as a,iT as o,kC as s,rT as c,ym as l}from"./index-BqmCqmfp.js";import"./quatf64-CJzmL3cc.js";import"./vectorStacks-CKtslZxP.js";import"./plane-CTjDePZl.js";import"./dehydratedPoint-Dwb3orme.js";import"./sphere-CicnK0Bn.js";import{S as u,i as d}from"./elevationInfoUtils-Df_uYU_q.js";import"./geodesicUtils-DJORTTMv.js";import"./LineSnappingHint-BAcwqgNT.js";import{i as f}from"./snappingUtils-CbrwOS61.js";import"./constraints-DXu8cqG3.js";import"./SnappingCandidate-BzUm7cf4.js";import"./EdgeSnappingCandidate-C1pApw0q.js";import"./DrapedEdgeSnappingCandidate-Ck4Ob_c8.js";import"./PointSnappingHint-0hXGrSRX.js";import"./VertexSnappingCandidate-CXMVwFHn.js";import{n as p,t as m}from"./queryEngineUtils-QbXGee_m.js";import{n as h,r as g,t as _}from"./symbologySnappingCandidates-CMGkAgRH.js";var v=class extends i{get availability(){return 1}get _snappingElevationAligner(){let{view:e}=this,{layer:t}=this.layerSource,n=e!=null&&e.type===`3d`;return!n||t.type===`subtype-group`?g():g(n,{elevationInfo:t.elevationInfo,alignPointsInFeatures:async(n,r)=>(await c(e.whenLayerView(t),r)).elevationAlignPointsInFeatures(n,r)})}get _snappingElevationFilter(){let{view:e}=this,t=e!=null&&e.type===`3d`&&this.layerSource.layer.type!==`subtype-group`;return h(t)}get _symbologySnappingFetcher(){let{view:e}=this,{layer:t}=this.layerSource;return e!=null&&e.type===`3d`&&t.type!==`subtype-group`?_(this._symbologySnappingSupported,async(n,r)=>{let i=await e.whenLayerView(t);return o(r),i.queryForSymbologySnapping({candidates:n,spatialReference:e.spatialReference},r)}):_()}get _layerView(){let{view:e}=this;if(e==null)return null;let{layer:t}=this.layerSource;return e.allLayerViews.find(e=>e.layer===t)}get _layerView3D(){let{view:e}=this;return e==null||e.type===`2d`?null:this._layerView}get _symbologySnappingSupported(){return this._layerView3D!=null&&this._layerView3D.symbologySnappingSupported}initialize(){let{view:e}=this,{layer:r}=this.layerSource;e!=null&&e.type===`3d`&&r.type!==`subtype-group`&&this.addHandles([e.elevationProvider.on(`elevation-change`,({context:e})=>{let{elevationInfo:t}=r;d(e,t)&&this._snappingElevationAligner.notifyElevationSourceChange()}),n(()=>r.elevationInfo,()=>this._snappingElevationAligner.notifyElevationSourceChange(),a),n(()=>this._layerView3D==null?null:this._layerView3D.layer?.renderer,()=>this._symbologySnappingFetcher.notifySymbologyChange(),a),t(()=>this._layerView3D?.layer,[`edits`,`apply-edits`],()=>this._symbologySnappingFetcher.notifySymbologyChange())])}constructor(e){super(e),this.view=null,this.updating=!1,this._memoizedMakeGetGroundElevation=u(m)}refresh(){}async fetchCandidates(e,t){let{layer:n}=this.layerSource,{source:r}=n;if(!r?.querySnapping)return[];let i=n.createQuery();this._layerView&&`effectiveDisplayFilter`in this._layerView&&(i.where=l(i.where,this._layerView.effectiveDisplayFilter?.where));let a=`returnZ`in n?n.returnZ:void 0,s=f({parameters:e,mode:this.view?.type??`2d`,returnZ:a,filter:i}),c=await r.querySnapping(s,{signal:t});o(t);let u=e.coordinateHelper.spatialReference,d=await this._snappingElevationAligner.alignCandidates(c.candidates,u,t);o(t);let m=await this._symbologySnappingFetcher.fetch(d,t);o(t);let h=m.length===0?d:[...d,...m],g=this._snappingElevationFilter.filter(s,h),_=this._memoizedMakeGetGroundElevation(this.view,u);return g.map(e=>p(e,_))}};e([r({constructOnly:!0})],v.prototype,`layerSource`,void 0),e([r({constructOnly:!0})],v.prototype,`view`,void 0),e([r()],v.prototype,`_snappingElevationAligner`,null),e([r()],v.prototype,`_snappingElevationFilter`,null),e([r()],v.prototype,`_symbologySnappingFetcher`,null),e([r()],v.prototype,`_layerView`,null),e([r()],v.prototype,`_layerView3D`,null),e([r()],v.prototype,`_symbologySnappingSupported`,null),v=e([s(`esri.views.interactive.snapping.featureSources.FeatureCollectionSnappingSource`)],v);export{v as FeatureCollectionSnappingSource};