import{$l as e,Al as t,Dt as n,If as r,Jg as i,Kf as a,Mf as o,Pf as s,Rh as c,Sf as l,Tt as u,Ug as d,Wf as f,Wy as p,Xg as m,Zw as ee,_y as te,bD as ne,by as re,cT as ie,gy as ae,iu as oe,jf as se,kg as ce,lf as le,mt as h,np as ue,ru as de,vD as g,vE as fe,vf as pe,vt as _,wi as v,xt as me,yt as he}from"./index-BqmCqmfp.js";import{n as y}from"./projectPointToVector-Clou1sfo.js";import{t as b}from"./computeTranslationToOriginAndRotation-BC3OuSky.js";import{n as ge}from"./dehydratedPoint-Dwb3orme.js";import{i as _e}from"./sphere-CicnK0Bn.js";import{i as ve,t as ye}from"./symbolColorUtils-BNtTwJ67.js";import{a as be,c as x,d as xe,h as Se,i as Ce,p as we,t as S,x as Te}from"./ElevationContext-Dr2dVDU-.js";import{f as C,l as w}from"./FloatsPassUniform-BT-ZsPj-.js";import{c as Ee,i as De,t as T}from"./graphicUtils-BCCvOGWP.js";import{n as Oe}from"./primitiveObjectSymbolUtils-YY1qMuBN.js";import{n as ke}from"./DefaultMaterial-BeGY-ryU.js";var E=class{constructor(e,t){this.renderer=e,this.symbol=t,this.color=null,this.size=null,this.opacity=null,this.outlineSize=null,this.heading=null,this.tilt=null,this.roll=null}};function Ae(e,t){if(e.symbol!=null)return e.symbol;let n=t?.renderer;return n!=null&&n.type!==`dot-density`?n.getSymbol(e,t):null}function je(e,t){let n=Ae(e,t);if(n==null)return null;let r=t?.renderer,i=new E(r,n);if(r==null||!(`visualVariables`in r)||!r.visualVariables)return i;let a=v(r,e,t)??[],o=[`proportional`,`proportional`,`proportional`];for(let{variable:e,value:t}of a)if(t!=null||e.type===`size`&&e.useSymbolValue)switch(e.type){case`color`:i.color=t?.toRgba();break;case`size`:if(e.target===`outline`)i.outlineSize=t;else{let n=e.axis,r=e.useSymbolValue?`symbol-value`:t??`proportional`;switch(n){case`width`:o[0]=r;break;case`depth`:o[1]=r;break;case`height`:o[2]=r;break;case`width-and-depth`:o[0]=o[1]=r;break;default:o[0]=o[1]=o[2]=r}}break;case`opacity`:i.opacity=t;break;case`rotation`:switch(e.axis){case`tilt`:i.tilt=t;break;case`roll`:i.roll=t;break;default:i.heading=t}}return o[0]===`proportional`&&o[1]===`proportional`&&o[2]===`proportional`||(i.size=o),i}async function Me(e,t){return e.symbol==null?t?.renderer?.getSymbolAsync(e,t)??null:e.symbol}async function Ne(e,t){let n=await Me(e,t);if(!n)return null;let r=t?.renderer,i=new E(r,n);if(!r||!(`visualVariables`in r)||!r.visualVariables)return i;let a=v(r,e,t)??[],o=[`proportional`,`proportional`,`proportional`];for(let{variable:e,value:t}of a)if(e.type===`color`)i.color=p.toUnitRGBA(t);else if(e.type===`size`)if(e.target===`outline`)i.outlineSize=t;else{let n=e.axis,r=e.useSymbolValue?`symbol-value`:t;n===`width`?o[0]=r:n===`depth`?o[1]=r:n===`height`?o[2]=r:o[0]=o[1]=n===`width-and-depth`?r:o[2]=r}else e.type===`opacity`?i.opacity=t:e.type===`rotation`&&e.axis===`tilt`?i.tilt=t:e.type===`rotation`&&e.axis===`roll`?i.roll=t:e.type===`rotation`&&(i.heading=t);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(i.size=o),i}function Pe(e,t=0){let n=e[t];return typeof n==`number`&&isFinite(n)?n:null}function Fe(e){for(let t=0;t<3;t++){let n=e[t];if(typeof n==`number`)return isFinite(n)?n:0}return 0}var Ie=1.2,Le=h,Re=3,ze=3,Be=10,D=class{constructor(e){this.estimated=!1,this.verticesPerFeature=e.verticesPerFeature??0,this.verticesPerCoordinate=e.verticesPerCoordinate??0,this.drawCallsPerFeature=e.drawCallsPerFeature??0,this.memory=e.memory??new k}},O=class extends D{constructor(e){super(e),this.estimated=!0}},Ve=class extends D{constructor(e,t){super(t),this.numComplexities=e}},He=class extends O{constructor(e,t){super(t),this.numComplexities=e}},k=class{constructor(){this.bytesPerFeature=0,this.bytesPerFeatureLabel=0,this.resourceBytes=0,this.draped={bytesPerFeature:0,bytesPerFeatureLabel:0}}},A=new O({});function Ue(e){return e.type===`web-style`?A:j(e.symbolLayers.toArray().map(t=>N(e,t)))}function j(e){let t=0,n=0,r=0,i=!1,a=0,o=new k;for(let s of e)s!=null&&(t+=s.verticesPerFeature,n+=s.verticesPerCoordinate,r+=s.drawCallsPerFeature,o.bytesPerFeature+=s.memory.bytesPerFeature,o.bytesPerFeatureLabel+=s.memory.bytesPerFeatureLabel,o.resourceBytes+=s.memory.resourceBytes,o.draped.bytesPerFeature+=s.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=s.memory.bytesPerFeatureLabel,i||=s.estimated,++a);return i?new He(a,{verticesPerFeature:t,verticesPerCoordinate:n,drawCallsPerFeature:r,memory:o}):new Ve(a,{verticesPerFeature:t,verticesPerCoordinate:n,drawCallsPerFeature:r,memory:o})}function We(e){let t=j(e);return t.numComplexities>0&&(t.verticesPerFeature/=t.numComplexities,t.verticesPerCoordinate/=t.numComplexities,t.drawCallsPerFeature/=t.numComplexities,t.memory.bytesPerFeature/=t.numComplexities,t.memory.bytesPerFeatureLabel/=t.numComplexities,t.memory.resourceBytes/=t.numComplexities,t.memory.draped.bytesPerFeature/=t.numComplexities,t.memory.draped.bytesPerFeatureLabel/=t.numComplexities),t}var M={};function N(e,t){let n=P(e,t),r=ve(t)?2:0;switch(t.type){case`extrude`:return new D({verticesPerFeature:-12,verticesPerCoordinate:12,drawCallsPerFeature:r,memory:n});case`fill`:if(e.type===`mesh-3d`)return new D({drawCallsPerFeature:r,memory:n});if(t.outline!=null&&t.outline.size>0)return new D({verticesPerFeature:-12,verticesPerCoordinate:9,memory:n});case`water`:return new D({verticesPerFeature:-6,verticesPerCoordinate:3,memory:n});case`line`:return new D({verticesPerFeature:-6,verticesPerCoordinate:6,memory:n});case`object`:return t.resource?.href?new O({verticesPerFeature:100,memory:n}):{...Ge(t.resource?.primitive??`sphere`),memory:n};case`path`:{let e=0,r=0;switch(t.profile){case`circle`:e=10;break;case`quad`:e=4;break;default:g(t.profile);return}switch(t.join){case`round`:r=3;break;case`miter`:case`bevel`:r=1;break;default:return}let i=2*e,a=e*r*2,o=a+i,s=-2*a-i;switch(t.cap){case`none`:break;case`butt`:case`square`:s+=2*(e-1);break;case`round`:s+=2*(e*2*2+e);break;default:return}return new D({verticesPerFeature:s,verticesPerCoordinate:o,memory:n})}case`text`:{let t=e.type===`label-3d`?0:2;return new D({verticesPerFeature:6,memory:n,drawCallsPerFeature:t})}case`icon`:return new D({verticesPerFeature:6,memory:n});default:return}}function P(e,t){let n=e.type===`point-3d`;switch(t.type){case`extrude`:return t.edges&&t.edges.size>0?I.EXTRUDE_EDGES:I.EXTRUDE;case`fill`:return t.outline!=null&&t.outline.size>0?I.FILL_OUTLINE:I.FILL;case`water`:return I.FILL;case`line`:return t.join===`round`?I.LINE_ROUND:I.LINE_MITER;case`path`:switch(t.join){case`round`:switch(t.profile){case`circle`:return I.PATH_ROUND_CIRCLE;case`quad`:return I.PATH_ROUND_QUAD;default:g(t.profile);return}case`miter`:case`bevel`:switch(t.profile){case`circle`:return I.PATH_MITER_CIRCLE;case`quad`:return I.PATH_MITER_QUAD;default:g(t.profile);return}default:return}case`object`:return n?I.OBJECT_POINT:I.OBJECT_POLYGON;case`icon`:case`text`:return n?I.ICON_POINT:I.ICON_POLYGON;default:return}}function Ge(e){let t=M[e];if(t)return t;let n=F(Oe(e,new ke({},{spherical:!0})).levels);return M[e]=new D({verticesPerFeature:n}),M[e]}function F(e){return e.reduce((e,t,n)=>e+t.numVertices*(1/10**n),0)/e.reduce((e,t,n)=>e+1/10**n,0)}var I={ICON_POINT:{bytesPerFeature:2658,bytesPerFeatureLabel:3484,resourceBytes:0,draped:{bytesPerFeature:1845,bytesPerFeatureLabel:3498}},ICON_POLYGON:{bytesPerFeature:3086,bytesPerFeatureLabel:2996,resourceBytes:0,draped:{bytesPerFeature:2694,bytesPerFeatureLabel:3014}},OBJECT_POINT:{bytesPerFeature:497,bytesPerFeatureLabel:2933,resourceBytes:0,draped:{bytesPerFeature:497,bytesPerFeatureLabel:2933}},OBJECT_POLYGON:{bytesPerFeature:867,bytesPerFeatureLabel:2491,resourceBytes:0,draped:{bytesPerFeature:867,bytesPerFeatureLabel:2491}},LINE_MITER:{bytesPerFeature:2337,bytesPerFeatureLabel:2658,resourceBytes:0,draped:{bytesPerFeature:1864,bytesPerFeatureLabel:2656}},LINE_ROUND:{bytesPerFeature:2341,bytesPerFeatureLabel:2672,resourceBytes:0,draped:{bytesPerFeature:1873,bytesPerFeatureLabel:2643}},PATH_MITER_CIRCLE:{bytesPerFeature:22374,bytesPerFeatureLabel:2558,resourceBytes:0,draped:{bytesPerFeature:22374,bytesPerFeatureLabel:2558}},PATH_ROUND_CIRCLE:{bytesPerFeature:24004,bytesPerFeatureLabel:2598,resourceBytes:0,draped:{bytesPerFeature:24004,bytesPerFeatureLabel:2598}},PATH_MITER_QUAD:{bytesPerFeature:24040,bytesPerFeatureLabel:2940,resourceBytes:0,draped:{bytesPerFeature:24040,bytesPerFeatureLabel:2940}},PATH_ROUND_QUAD:{bytesPerFeature:23088,bytesPerFeatureLabel:2886,resourceBytes:0,draped:{bytesPerFeature:23088,bytesPerFeatureLabel:2886}},FILL:{bytesPerFeature:3059,bytesPerFeatureLabel:2838,resourceBytes:0,draped:{bytesPerFeature:2352,bytesPerFeatureLabel:2808}},FILL_OUTLINE:{bytesPerFeature:3093,bytesPerFeatureLabel:2632,resourceBytes:0,draped:{bytesPerFeature:2480,bytesPerFeatureLabel:2601}},EXTRUDE:{bytesPerFeature:5075,bytesPerFeatureLabel:2559,resourceBytes:0,draped:{bytesPerFeature:5075,bytesPerFeatureLabel:2559}},EXTRUDE_EDGES:{bytesPerFeature:2843,bytesPerFeatureLabel:2139,resourceBytes:0,draped:{bytesPerFeature:2843,bytesPerFeatureLabel:2139}}};if(ne(`esri-tests-disable-symbol-memory-estimators`))for(let e in I){let t=I[e];t.bytesPerFeature=0,t.bytesPerFeatureLabel=0,t.draped.bytesPerFeature=0,t.draped.bytesPerFeatureLabel=0}function L(e){return e.mapPositions!=null}function Ke(e,t,n,r,i){let a=e.stageObject,o=a.geometries,s=0;for(let e of o){if(!L(e))continue;let{update:o,averageGeometrySampledElevation:c}=W(e,t,n,r,i);s+=c,o&&a.geometryVertexAttributeUpdated(e,`position`)}return s/o.length}function qe(t,n,r,i,a,o){let s=t.stageObject,l=n.centerInElevationSR,u=0;i(l,U),s.usesVerticalDistanceToGround?(xe(s,U.verticalDistanceToGround),u=U.sampledElevation):n.mode!==`absolute-height`&&(u=U.sampledElevation);let d=c(Je,o??s.transformation),f=e(H,d[12],d[13],d[14]);C.TESTS_DISABLE_OPTIMIZATIONS?(z[0]=l[0],z[1]=l[1],z[2]=U.z,b(r,z,d,a.spatialReference)&&(o?c(o,d):s.transformation=d)):a.setAltitudeOfTransformation(U.z,d);let p=R/a.unitInMeters;return(Math.abs(d[12]-f[0])>=p||Math.abs(d[13]-f[1])>=p||Math.abs(d[14]-f[2])>=p)&&(o?c(o,d):s.transformation=d),u}var Je=ue();function Ye(t,n,r,i,a){let o=t.graphics3DSymbolLayer.lodRenderer;if(o==null)return 0;let s=n.centerInElevationSR;i(s,U);let c=n.mode===`absolute-height`?0:U.sampledElevation,l=o.instanceData,u=t.instanceIndex,d=Ze;l.getGlobalTransform(u,d);let f=e(H,d[12],d[13],d[14]);C.TESTS_DISABLE_OPTIMIZATIONS?(z[0]=s[0],z[1]=s[1],z[2]=U.z,b(r,z,d,a.spatialReference)&&l.setGlobalTransform(u,d)):a.setAltitudeOfTransformation(U.z,d);let p=R/a.unitInMeters;return(C.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(d[12]-f[0])>=p||Math.abs(d[13]-f[1])>=p||Math.abs(d[14]-f[2])>=p)&&l.setGlobalTransform(u,d),c}function Xe(e,t,n,r,i){let a=e.stageObject,o=a.geometries;if(o.length===0)return 0;let s=0,c=null,l=0,u=!1;for(let e of o){if(!L(e))continue;let o=e.attributes.get(`position`);if(o!==c){let{update:a,averageGeometrySampledElevation:s}=W(e,t,n,r,i);l=s,c=o,u=a}u&&a.geometryVertexAttributeUpdated(e,`position`),s+=l}return s/o.length}var R=.01,z=i(),B=i(),V=i(),Ze=ue(),H=i(),U=new we;function W(e,t,n,r,i){let a=!1,o=e.transformation,s=t.requiresSampledElevationInfo;B[0]=o[12],B[1]=o[13],B[2]=o[14],e.invalidateBoundingInfo();let c=e.getMutableAttribute(`position`),l=c.data,u=c.size,d=l.length/u,f=new Se(e.mapPositions,n),p=0,m=0;for(let e=0;e<d;e++){if(V[0]=l[p],V[1]=l[p+1],V[2]=l[p+2],r(f,U),s&&(m+=U.sampledElevation),C.TESTS_DISABLE_OPTIMIZATIONS)l[p]=f.array[f.offset],l[p+1]=f.array[f.offset+1],l[p+2]=U.z,ce(l,n,p,l,i.spatialReference,p,1),l[p]-=B[0],l[p+1]-=B[1],l[p+2]-=B[2],a=!0;else{z[0]=l[p]+B[0],z[1]=l[p+1]+B[1],z[2]=l[p+2]+B[2],i.setAltitude(z,U.z),l[p]=z[0]-B[0],l[p+1]=z[1]-B[1],l[p+2]=z[2]-B[2];let e=R/i.unitInMeters;(Math.abs(V[0]-l[p])>=e||Math.abs(V[1]-l[p+1])>=e||Math.abs(V[2]-l[p+2])>=e)&&(a=!0)}p+=u,f.offset+=3}return m/=d,{update:a,averageGeometrySampledElevation:m}}var Qe=class{constructor(e,t,n){this.baseMaterial=e,this.edgeMaterial=t,this.hasSlicePlane=n}},$e=class{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(e,t,n,r,i,a=null){this.graphics3DSymbolLayer=e,this.stageObject=t,this._sharedResource=n,this.elevationAligner=r,this.elevationContext=i,this._edgeState=a,this.type=`object3d`,this._stageLayer=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e){this._stageLayer=e}destroy(){if(!this._stageLayer)return;let e=this._stageLayer.stage;this._addedToStage&&=(this._stageLayer.remove(this.stageObject),!1),e.renderer.edgeView?.removeObject(this.stageObject),this.stageObject.dispose(),this._sharedResource?.release(),this._visible=!1,this._stageLayer=null}get usedMemory(){return this.graphics3DSymbolLayer.usedMemory}layerOpacityChanged(e,t){let{stageObject:n,_edgeState:r,_stageLayer:i}=this;if(r==null)return;let a=G(r.baseMaterial);r.edgeMaterial.objectTransparency!==a&&(r.edgeMaterial.objectTransparency=a,this.resetEdgeObject(t)),i.stage.renderer.withEdgeView(t=>t.updateAllComponentOpacities(n,[e]))}updateHighlights(e){}slicePlaneEnabledChanged(e,t){let{stageObject:n,_edgeState:r,_stageLayer:i}=this;r!=null&&i.stage.renderer.withEdgeView(i=>{i.updateAllComponentMaterials(n,r.edgeMaterial,e,!t),r.hasSlicePlane=e})}setVisibility(e){let{_edgeState:t,stageObject:n,_stageLayer:r}=this;r!=null&&this.visible!==e&&(this._visible=e,n.visible=e,e&&!this._addedToStage&&(r.add(n),this._addedToStage=!0),t!=null&&r.stage.renderer.withEdgeView(r=>{r.hasObject(n)?r.updateObjectVisibility(n,e):e&&this._addOrUpdateEdgeObject(t,r,!1)}))}get visible(){return this._visible}alignWithElevation(e,t,n){this.elevationAligner!=null&&(this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,(n,r)=>be(n,e,this.elevationContext,t,r),t),this.resetEdgeObject(n))}alignWithAbsoluteElevation(e,t,n){this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,this.graphics3DSymbolLayer.view.spatialReference,(t,n)=>{n.sampledElevation=e,n.verticalDistanceToGround=0,n.z=e},t),this.resetEdgeObject(n)}getCenterObjectSpace(e=i()){return de(e,_e(this.stageObject.boundingVolumeObjectSpace.bounds))}getBoundingBoxObjectSpace(e=a()){let t=this.stageObject.boundingVolumeObjectSpace;return o(e,t.min),r(e,t.max),e}computeAttachmentOrigin(e){let n=this.stageObject.effectiveTransformation;if(this.useObjectOriginAsAttachmentOrigin)e.render.origin[0]+=n[12],e.render.origin[1]+=n[13],e.render.origin[2]+=n[14],e.render.num++;else for(let r of this.stageObject.geometries)r.computeAttachmentOrigin(J)&&(t(J,J,n),oe(e.render.origin,e.render.origin,J),e.render.num++)}async getProjectedBoundingBox(e,n,r,i,a){let o=this.getBoundingBoxObjectSpace(a),c=et,u=pe(o)?1:c.length;for(let e=0;e<u;e++){let n=c[e];q[0]=o[n[0]],q[1]=o[n[1]],q[2]=o[n[2]],t(q,q,this.stageObject.transformation),K[3*e]=q[0],K[3*e+1]=q[1],K[3*e+2]=q[2]}if(!e(K,0,u))return null;f(o);let d=null;this.calculateRelativeScreenBounds&&(d=this.calculateRelativeScreenBounds());for(let e=0;e<3*u;e+=3){for(let t=0;t<3;t++)o[t]=Math.min(o[t],K[e+t]),o[t+3]=Math.max(o[t+3],K[e+t]);d&&r.push({location:K.slice(e,e+3),screenSpaceBoundingRect:d})}if(n?.service&&this.elevationContext.mode!==`absolute-height`){s(o,J);let e=this.elevationContext.mode===`relative-to-scene`?`scene`:`ground`,t=0;if(n.useViewElevation)t=n.service.getElevation(J[0],J[1],e)??0;else try{let r=De(o,n.service.spatialReference,n);t=await n.service.queryElevation(J[0],J[1],i,r,e)??0}catch{}l(o,0,0,-this.alignedSampledElevation+t)}return o}addObjectState(e){e.stateType===0&&e.addObject(this.stageObject,this.stageObject.highlight(e.highlightName)),e.stateType===1&&e.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeByObject(this.stageObject)}resetEdgeObject(e){let{_edgeState:t,stageObject:n,_stageLayer:r,_visible:i}=this;t!=null&&r.stage.renderer.withEdgeView(r=>{i?this._addOrUpdateEdgeObject(t,r,e):r.removeObject(n)})}_addOrUpdateEdgeObject(e,t,n){let r=G(e.baseMaterial);e.edgeMaterial.objectTransparency=r,t.addOrUpdateObject3D(this.stageObject,e.edgeMaterial,e.hasSlicePlane,!n).then(()=>this._stageLayer?.sync())}};function G(e){return e.transparent?0:1}var K=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],q=i(),J=i(),et=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],tt=class{constructor(e,t=null){this.labelText=t,this.elevationOffset=e??0}},Y=class{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=0,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,t){return this._loadStatus===1?(e&&e(),this._loader??Promise.resolve()):this._loadStatus===2?(t&&t(this._loadError),this._loader??Promise.resolve()):(this._loader??=(this._abortController=new AbortController,this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=1},e=>{throw this._loadError=e,this._abortController=null,this._loadStatus=2,!ee(e)&&this.logger&&e.message&&this.logger.warn(e.message),e})),this._loader.then(e,t).catch(()=>{}),this._loader)}abortLoad(){this._abortController==null?this._loadStatus===0&&(this._loadStatus=2):this._abortController=ie(this._abortController),this._loader=null}},X=()=>fe.getLogger(`esri.views.3d.layers.graphics.Graphics3DSymbolLayer`),nt=class extends Y{constructor(e,t,n,r,i=!0){super(n.schedule),this.symbol=e,this.symbolLayer=t,this._context=n,this._drivenOpacityFallbackAlwaysOpaque=i,this.ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1,rotation:!1},this._materials=[],this.logger=X(),this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.skipHighSymbolLodsChanged=!0,this._renderPriority=r.renderPriority,this._renderPriorityStep=r.renderPriorityStep,this._elevationContext=new S,this.updateComplexity(),this.ignoreDrivers=r.ignoreDrivers,this.ignoreDrivers||(this._drivenProperties=Z(this._context.renderer,i)),this._updateElevationContext()}destroy(){this.complexity=null,this._materials.length=0,super.destroy()}get view(){return this._context.stage.view}getCachedSize(){return null}get extentPadding(){return 0}get materials(){return this._materials}get estimatedMemory(){let{complexity:e}=this;return e==null?0:(this.draped?e.memory.draped:e.memory).bytesPerFeature}get usedMemory(){return this.estimatedMemory}_drivenPropertiesChanged(e){if(this.ignoreDrivers)return!1;let t=this._drivenProperties,n=Z(e,this._drivenOpacityFallbackAlwaysOpaque);return n.color!==t.color||n.opacity!==t.opacity||n.opacityAlwaysOpaque!==t.opacityAlwaysOpaque||n.size!==t.size||n.rotation!==t.rotation}get needsDrivenTransparentPass(){return this._hasDrivenColorOrOpacity&&!this._drivenProperties.opacityAlwaysOpaque}get _hasDrivenColorOrOpacity(){return this._drivenProperties.color||this._drivenProperties.opacity}_logGeometryCreationWarnings(e,t,n,r){let i=e.projectionSuccess,a=`polygons`in e?e.polygons:null,o=`${r} geometry failed to be created`;i?!this._logGeometryValidationWarnings(t,n,r)&&a&&a.length===0&&n===`rings`&&t.length>0&&t[0].length>2&&X().warnOncePerTick(`${o} (filled rings should use clockwise winding - try reversing the order of vertices)`):X().warnOncePerTick(`${o} (failed to project geometry to view spatial reference)`)}get needsUpdateFocus(){return!1}_logGeometryValidationWarnings(e,t,n){let r=`${n} geometry failed to be created`;return!e.length||e.length===1&&!e[0].length?(X().warnOncePerTick(`${r} (no ${t} were defined)`),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(X().warnOncePerTick(`${r} (${t} should be defined as a 2D array)`),!0)}_validateGeometry(e,t=null,n=null){if(t!=null&&!t.includes(e.type))return this.logger.warn(`unsupported geometry type for `+n+` symbol: ${e.type}`),!1;switch(e.type){case`point`:{let t=e;if(!isFinite(t.x)||!isFinite(t.y))return X().warn(`point coordinate is not a valid number, graphic skipped`),!1;break}case`polygon`:re(e)}return!0}_defaultElevationInfoNoZ(){return rt}_defaultElevationInfoZ(){return it}_updateElevationContext(){this._elevationInfoOverride==null?this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.setFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset():(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.setFeatureExpressionInfoContext(null))}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,t=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||t.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}createElevationContextForGraphic(e){let t=new S;return this.updateElevationContextForGraphic(t,e),t}updateElevationContextForGraphic(e,t){let n=t.geometry,r=this.getDefaultElevationInfo(n);e.unit=this._elevationContext.unit==null?r.unit:this._elevationContext.unit,e.mode=this.getGeometryElevationMode(n,r),e.offsetMeters=this._elevationContext.meterUnitOffset??r.offset??0;let i=!this._elevationOptions.supportsOnTheGround&&e.mode===`on-the-ground`;i&&(e.mode=`relative-to-ground`,e.offsetMeters=0);let a=i?Ce:this._elevationContext.featureExpressionInfoContext;a?e.updateFeatureExpressionInfoContextForGraphic(a,t,this._context.layer):e.setFeatureExpressionInfoContext(null)}prepareSymbolLayerPatch(e){}onRemoveGraphic(e){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&`fullOpacity`in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity??0:this._context.layer.opacity??1}_getCombinedOpacity(e,t=Q){let n=this.draped?1:this._getLayerOpacity();return this._drivenProperties.color?n:e?n*(this._drivenProperties.opacity?1:e.a):t.hasIntrinsicColor?n:0}_getCombinedOpacityAndColor(e,t=Q){let n=this._getCombinedOpacity(e,t);if(this._drivenProperties.color)return T(null,n);let r=e==null?d:p.toUnitRGB(e);return T(r,n)}_getDrivenUInt8Color({color:e,opacity:t},n,r){let{color:i,opacity:a}=this._drivenProperties,o=p.toUnitRGBA(n)??(r?he:h),s=i?e??o:null,c=e||n||r,l=i?null:o[3];return T(s,a&&c?t??l:null,255)}_getDrivenUInt8ColorWithNaNSupport({color:e,opacity:t},r,i){let a=r?me(p.toUnitRGBA(r)):_(NaN,NaN,NaN,i?NaN:0);return this._drivenProperties.color&&e!=null&&u(a,e),this._drivenProperties.opacity&&t!=null&&(a[3]=t),n(a,a,255),ye(a,a)}isFastUpdatesEnabled(){return this._fastUpdates!=null}updateComplexity(){this.complexity=this.computeComplexity()}computeComplexity(){return N(this.symbol,this.symbolLayer)}globalPropertyChanged(e,t,n){switch(e){case`opacity`:return this.layerOpacityChanged(t,n),!0;case`screenSizePerspectiveEnabled`:return this.layerScreenSizePerspectiveChanged(t,n),!0;case`elevationInfo`:{let e=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(t,n,e)!==2}case`slicePlaneEnabled`:return this.slicePlaneEnabledChanged(t,n);case`physicalBasedRenderingEnabled`:return this.physicalBasedRenderingChanged();case`pixelRatio`:return this.pixelRatioChanged;case`skipHighSymbolLods`:return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(e,t,n){let r=1;return e?.forEach(e=>{let i=t(e);if(i!=null){let t=e.graphic;this.updateElevationContextForGraphic(i.elevationContext,t),i.needsElevationUpdates=n(i.elevationContext.mode)}else r=2}),r}applyRendererDiff(e,t){return 0}getFastUpdateAttrValues(e){if(!this._fastUpdates)return null;let t=this._fastUpdates.visualVariables,n=t.size?w(t.size.field,e):0,r=t.color?w(t.color.field,e):0,i=t.opacity?w(t.opacity.field,e):0;return _(n,r,i,0)}get draped(){return this._draped}ensureDrapedStatus(e){return this._draped==null?(this._draped=e,!0):(e!==this.draped&&X().warnOnce(`A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary.`),!1)}test(){return{drivenProperties:this._drivenProperties,getVisVarFields:()=>({size:this._fastUpdates?.visualVariables.size?.field??null,color:this._fastUpdates?.visualVariables.color?.field??null,opacity:this._fastUpdates?.visualVariables.opacity?.field??null,rotation:this._fastUpdates?.visualVariables.rotation?.field??null})}}};function Z(e,t){let n={color:!1,opacity:!1,opacityAlwaysOpaque:t,size:!1,rotation:!1};return e&&`visualVariables`in e&&e.visualVariables&&e.visualVariables.forEach(e=>{switch(e.type){case`color`:if(n.color=!0,e.stops)for(let t=0;t<e.stops.length;t++){let r=e.stops[t].color;r&&r.a<1&&(n.opacityAlwaysOpaque=!1)}break;case`opacity`:n.opacity=!0,n.opacityAlwaysOpaque=!1;break;case`size`:n.size=!0;break;case`rotation`:n.rotation=!0}}),n}var rt={mode:`on-the-ground`,offset:0,unit:`meters`},it={mode:`absolute-height`,offset:0,unit:`meters`},Q={hasIntrinsicColor:!1},at=_(NaN,NaN,NaN,NaN);function ot(e,t,n,r,i){if(ct(e,t))return null;n.localOrigin=dt(e,t);let a=new Te({geometries:[n],castShadow:!1,layerViewUid:e.layerViewUid,graphicUid:i,usesVerticalDistanceToGround:!0});return{object:a,sampledElevation:x(a,t,e.elevationProvider,e.renderCoordsHelper,r)}}function st(e,t,n,r){return ct(t,n)?null:x(e,n,t.elevationProvider,t.renderCoordsHelper,r)}function ct(e,t){let n=e.clippingExtent;return!!n&&(y(t,$,e.elevationProvider.spatialReference),!se(n,$))}function lt(e,t,n){let r=e.elevationContext,i=n.spatialReference;y(t,$,i),r.centerInElevationSR=m($[0],$[1],t.hasZ?$[2]:0)}function ut(e){switch(e.type){case`point`:return e;case`polygon`:case`extent`:return Ee(e);case`polyline`:{let t=e.paths[0];if(!t||t.length===0)return null;let n=ae(t,te(t)/2);return ge(n[0],n[1],n[2],e.spatialReference)}case`mesh`:return e.extent.center}return null}function dt(e,t){return y(t,$,e.renderCoordsHelper.spatialReference),e.localOriginFactory.getOrigin($)}var $=i();export{Ne as A,D as C,Ie as D,ze as E,Fe as M,E as N,Le as O,F as S,Re as T,P as _,st as a,We as b,Y as c,Qe as d,Xe as f,L as g,qe as h,ot as i,je as j,Pe as k,tt as l,Ye as m,lt as n,at as o,Ke as p,dt as r,nt as s,ut as t,$e as u,j as v,Be as w,Ue as x,A as y};