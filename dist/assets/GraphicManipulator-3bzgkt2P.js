import{A_ as e,CD as t,E_ as n,Jg as r,Jh as i,Kb as a,MC as o,M_ as s,OC as c,T_ as l,Vb as u,Yh as d,di as f,eg as p,eu as m,f_ as h,kC as g,k_ as _,pg as v,ra as y,vv as b,wC as x,yg as S}from"./index-BqmCqmfp.js";import{n as C}from"./projectPointToVector-Clou1sfo.js";import{s as w}from"./elevationInfoUtils-Df_uYU_q.js";import{t as T}from"./drapedUtils-p7eKCYi3.js";function E(e,t,r,i,a,o,s,c){let u=t??r.leftVertex.pos,[d,f,p,m,g,_,v]=(l(e)?n(u,e):e).a,y=g??0,b=_??Math.hypot(d[0]-f[0],d[1]-f[1]),x=v??1,S=D(i[0],i[1],a[0],a[1],o[0],o[1],s,c);return h(u,{a:[d,f,p,m,y,b,x]},S)}function D(t,n,r,i,a,o,c,l){let u=e(1,0,0,0,1,0,-t,-n,1),d=c-1,f=e(r*r*d+1,i*r*d,0,r*i*d,i*i*d+1,0,0,0,1),p=l-1,m=e(a*a*p+1,o*a*p,0,a*o*p,o*o*p+1,0,0,0,1),h=e(1,0,0,0,1,0,t,n,1),g=_();return s(g,f,u),s(g,m,g),s(g,h,g),g}function O(e){let t=0,n=0,r=0;return e?(e.type===`cim`&&e.data.symbol&&`symbolLayers`in e.data.symbol&&e.data.symbol.symbolLayers&&e.data.symbol.symbolLayers.map(e=>{e.type===`CIMVectorMarker`&&e.anchorPoint&&(Math.abs(e.anchorPoint.x)>t&&(t=e.anchorPoint.x),Math.abs(e.anchorPoint.y)>n&&(n=e.anchorPoint.y),e.size!=null&&e.size>r&&(r=e.size))}),t=p(t),n=p(n),r=p(r),{offsetX:t,offsetY:n,size:r}):{offsetX:t,offsetY:n,size:r}}var k=class extends c{set graphic(e){this._circleCollisionCache=null,this._originalSymbol=e.symbol,this._set(`graphic`,e),this.attachSymbolChanged()}get elevationInfo(){let{layer:e}=this.graphic,t=e&&`elevationInfo`in e?e.elevationInfo:null,n=w(this.graphic),r=t?t.offset:0;return new y({mode:n,offset:r})}set focusedSymbol(e){e!==this._get(`focusedSymbol`)&&(this._set(`focusedSymbol`,e),this._updateGraphicSymbol(),this._circleCollisionCache=null)}grabbableForEvent(){return!0}set grabbing(e){e!==this._get(`grabbing`)&&(this._set(`grabbing`,e),this._updateGraphicSymbol())}set hovering(e){e!==this._get(`hovering`)&&(this._set(`hovering`,e),this._updateGraphicSymbol())}set selected(e){e!==this._get(`selected`)&&(this._set(`selected`,e),this._updateGraphicSymbol(),this.events.emit(`select-changed`,{action:e?`select`:`deselect`}))}get _focused(){return this._get(`hovering`)||this._get(`grabbing`)}constructor(e){super(e),this.layer=null,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.dragging=!1,this.cursor=null,this.consumesClicks=!0,this.events=new x,this._circleCollisionCache=null,this._graphicSymbolChangedHandle=null,this._originalSymbol=null}destroy(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set(`view`,null)}intersectionDistance(e){let t=this.graphic;if(!1===t.visible)return null;let n=t.geometry;if(n==null)return null;let r=this._get(`focusedSymbol`)??t.symbol;return this.view.type===`2d`?this._intersectDistance2D(this.view,e,n,r):this._intersectDistance3D(this.view,e,t)}attach(){this.attachSymbolChanged(),this.layer!=null&&this.layer.add(this.graphic)}detach(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this.layer!=null&&this.layer.remove(this.graphic)}attachSymbolChanged(){this.detachSymbolChanged(),this._graphicSymbolChangedHandle=a(()=>this.graphic?.symbol,e=>{e!=null&&e!==this.focusedSymbol&&e!==this._originalSymbol&&(this._originalSymbol=e,this._focused&&this.focusedSymbol!=null&&(this.graphic.symbol=this.focusedSymbol))},u)}detachSymbolChanged(){this._graphicSymbolChangedHandle!=null&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}onElevationChange(){}onViewChange(){}_updateGraphicSymbol(){this.graphic.symbol=this._focused&&this.focusedSymbol!=null?this.focusedSymbol:this._originalSymbol}_resetGraphicSymbol(){this.graphic.symbol=this._originalSymbol}_intersectDistance2D(e,t,n,r){if((r||=f(n))==null)return null;let i=this._circleCollisionCache;if(n.type===`point`&&r.type===`cim`&&r.data.symbol?.type===`CIMPointSymbol`&&r.data.symbol.symbolLayers){let{offsetX:i,offsetY:a,size:o}=O(r),s=d(t,j),c=o/2,l=e.toScreen(n),u=l.x+i,f=l.y+a;return b(s,[u,f])<c*c?1:null}if(n.type!==`point`||r.type!==`simple-marker`)return T(t,n,e)?1:null;if(i==null||!i.originalPoint.equals(n)){let t=n,a=e.spatialReference;if(v(t.spatialReference,a)){let e=S(t,a);i={originalPoint:t.clone(),mapPoint:e,radiusPx:p(r.size)},this._circleCollisionCache=i}}if(i!=null){let n=d(t,j),a=e.toScreen?.(i.mapPoint);if(!a)return null;let o=i.radiusPx,s=a.x+p(r.xoffset),c=a.y-p(r.yoffset);return b(n,[s,c])<o*o?1:null}return null}_intersectDistance3D(e,t,n){let r=e.toMap(t,{include:[n]});return r&&C(r,A,e.renderSpatialReference)?m(A,e.state.camera.eye):null}};t([o({constructOnly:!0,nonNullable:!0})],k.prototype,`graphic`,null),t([o()],k.prototype,`elevationInfo`,null),t([o({constructOnly:!0,nonNullable:!0})],k.prototype,`view`,void 0),t([o({value:null})],k.prototype,`focusedSymbol`,null),t([o({constructOnly:!0})],k.prototype,`layer`,void 0),t([o()],k.prototype,`interactive`,void 0),t([o()],k.prototype,`selectable`,void 0),t([o()],k.prototype,`grabbable`,void 0),t([o({value:!1})],k.prototype,`grabbing`,null),t([o()],k.prototype,`dragging`,void 0),t([o()],k.prototype,`hovering`,null),t([o({value:!1})],k.prototype,`selected`,null),t([o()],k.prototype,`cursor`,void 0),k=t([g(`esri.views.interactive.GraphicManipulator`)],k);var A=r(),j=i();export{E as i,O as n,D as r,k as t};