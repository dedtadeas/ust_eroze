import{CD as e,Hb as t,Id as n,Kb as r,SC as i,Wb as a,kC as o,nD as s,vT as c}from"./index-BqmCqmfp.js";import"./memoryEstimations-O7VgDRVG.js";import"./OptimizedFeature-Dx4_lHip.js";import"./OptimizedGeometry-f3I9Z6C1.js";import"./OptimizedFeatureSet-DlHqIhoP.js";import"./featureConversionUtils-7vyVIZ6j.js";import"./streamLayerUtils-BMw-RtDi.js";import"./QueueProcessor-C8_CgXms.js";import"./earcut-Drx511Ix.js";import"./layerViewUtils-Bbe7IKvz.js";import"./colorUtils-uG2qTogT.js";import"./timeSupport-DheFkvFH.js";import"./queryUtils-BA7HiGeg.js";import"./quantizationUtils-C5shine1.js";import"./normalizeUtilsSync-Btn24Gtg.js";import"./GeometryUtils-DBkUrkz1.js";import"./VertexAttributeLocations-IAhvKZqd.js";import"./VertexElementDescriptor-BGWnA0Rs.js";import"./labelPoint-B7zLrA23.js";import"./callExpressionWithCursor-kl7GHpJ1.js";import"./FeatureMetadata-H6WAS0Lx.js";import"./fontUtils-CWolFklQ.js";import"./CIMSymbolHelper-bdBsF42t.js";import"./rasterizingUtils-B0Pd5uE0.js";import"./Rect-BMNJQxpm.js";import"./BoundingBox-DnR5UeUT.js";import"./BidiEngine-CpIovbIK.js";import"./callExpressionWithFeature-BK7JnF3H.js";import"./OverrideHelper-BKNowJt8.js";import"./densifyCurvedGeometry-C2XDhl14.js";import"./config-BSvujflG.js";import"./dehydratedFeatureComparison-Ch8xWl-8.js";import"./WGLContainer-Caxzva6E.js";import"./utils-DBLYSlue.js";import"./ProgramTemplate-ks-pn-xm.js";import"./VertexArrayObject-Dzn28byJ.js";import"./BufferObject-lp8QWmVQ.js";import"./VertexBuffer-DL5rIQzc.js";import"./vec3f32-CZ7wi78s.js";import"./Container-DgT8F3N0.js";import"./EffectView-CvH-XuUh.js";import"./GraphShaderModule-D5xwSwIQ.js";import"./FramebufferObject-CkeUwNOD.js";import"./ShaderBuilder-C3C7fUwK.js";import{t as l}from"./LayerView2D-DVE2Teoj.js";import{t as u}from"./LayerView-DKEUJRIQ.js";import"./UpdateTracking2D-yw0xaCSk.js";import"./TechniqueInstance-BhM4b8eb.js";import"./TileContainer-BwjyXNO3.js";import"./FeatureCommandQueue-COnDeivB.js";import"./constants-BOI_CTg-.js";import"./utils-CY7cI7hp.js";import{t as d}from"./highlightOptionsUtils-DiIoW0j2.js";import"./AGraphicContainer-ShIe2ypS.js";import{t as f}from"./GraphicContainer-DNktOekL.js";import"./ComputedAttributeStorage-D_u4lyEq.js";import{t as p}from"./GraphicsView2D-Dg0AUWQu.js";import"./dehydratedFeatures-DW1qFa9i.js";var m=`sublayers`,h=`layerView`,g=class extends l(u){*graphicsViews(){this._graphicsViewsFeatureCollectionMap==null?this._graphicsViews==null?yield*[]:yield*this._graphicsViews:yield*this._graphicsViewsFeatureCollectionMap.keys()}async hitTest(e,t){return Array.from(this.graphicsViews(),t=>{let n=t.hitTest(e);if(this._graphicsViewsFeatureCollectionMap!=null){let e=this._graphicsViewsFeatureCollectionMap.get(t);for(let t of n)!t.popupTemplate&&e.popupTemplate&&(t.popupTemplate=e.popupTemplate),t.sourceLayer=t.layer=this.layer}return n}).flat().map(t=>({type:`graphic`,graphic:t,layer:this.layer,mapPoint:e}))}highlight(e,t){let r;typeof e==`number`?r=[e]:e instanceof n?r=[e.uid]:Array.isArray(e)&&e.length>0?r=typeof e[0]==`number`?e:e.map(e=>e&&e.uid):i.isCollection(e)&&(r=e.map(e=>e&&e.uid).toArray());let a=r?.filter(s);if(!a?.length)return c();let o=d(t);return this._addHighlights(a,o),c(()=>this._removeHighlights(a,o))}update(e){for(let t of this.graphicsViews())t.processUpdate(e)}attach(){let e=this.view,n=()=>this.requestUpdate(),i=this.layer.featureCollections;if(i!=null&&i.length){this._graphicsViewsFeatureCollectionMap=new Map;for(let t of i){let i=new f(this.view.featuresTilingScheme),o=new p({view:e,graphics:t.source,renderer:t.renderer,requestUpdateCallback:n,container:i});this._graphicsViewsFeatureCollectionMap.set(o,t),this.container.addChild(o.container),this.addHandles([r(()=>t.visible,e=>o.container.visible=e,a),r(()=>o.updating,()=>this.notifyChange(`updating`),a)],h)}this._processHighlight()}else this.layer.sublayers!=null&&this.addHandles(t(()=>this.layer.sublayers,`change`,()=>this._createGraphicsViews(),{onListenerAdd:()=>this._createGraphicsViews(),onListenerRemove:()=>this._destroyGraphicsViews()}),m)}detach(){this._destroyGraphicsViews(),this.removeHandles(m)}moveEnd(){}viewChange(){for(let e of this.graphicsViews())e.viewChange()}isUpdating(){for(let e of this.graphicsViews())if(e.updating)return!0;return!1}_destroyGraphicsViews(){this.container.removeAllChildren(),this.removeHandles(h);for(let e of this.graphicsViews())e.destroy();this._graphicsViews=null,this._graphicsViewsFeatureCollectionMap=null}_createGraphicsViews(){if(this._destroyGraphicsViews(),this.layer.sublayers==null)return;let e=[],t=this.view,n=()=>this.requestUpdate();for(let i of this.layer.sublayers){let o=new f(this.view.featuresTilingScheme);o.fadeTransitionEnabled=!0;let s=new p({view:t,graphics:i.graphics,requestUpdateCallback:n,container:o});this.addHandles([i.on(`graphic-update`,s.graphicUpdateHandler),r(()=>i.visible,e=>s.container.visible=e,a),r(()=>s.updating,()=>this.notifyChange(`updating`),a)],h),this.container.addChild(s.container),e.push(s)}this._graphicsViews=e,this._processHighlight()}_processHighlight(){let e=this._getHighlights();for(let t of this._graphicsViews||[])t.setHighlight(e);this._graphicsViewsFeatureCollectionMap?.forEach((t,n)=>{n.setHighlight(e)})}};g=e([o(`esri.views.2d.layers.MapNotesLayerView2D`)],g);var _=g;export{_ as default};