import{CD as e,Hy as t,MC as n,aC as r,kC as i,vC as a,vE as o}from"./index-BqmCqmfp.js";var s=new r({esriClassifyEqualInterval:`equal-interval`,esriClassifyManual:`manual`,esriClassifyNaturalBreaks:`natural-breaks`,esriClassifyQuantile:`quantile`,esriClassifyStandardDeviation:`standard-deviation`,esriClassifyDefinedInterval:`defined-interval`}),c=new r({esriNormalizeByLog:`log`,esriNormalizeByPercentOfTotal:`percent-of-total`,esriNormalizeByField:`field`}),l=class extends a{constructor(e){super(e),this.type=`class-breaks-definition`,this.breakCount=null,this.classificationField=null,this.classificationMethod=null,this.normalizationField=null,this.normalizationType=null}set standardDeviationInterval(e){this.classificationMethod===`standard-deviation`&&this._set(`standardDeviationInterval`,e)}set definedInterval(e){this.classificationMethod===`defined-interval`&&this._set(`definedInterval`,e)}};e([t({classBreaksDef:`class-breaks-definition`})],l.prototype,`type`,void 0),e([n({json:{write:!0}})],l.prototype,`breakCount`,void 0),e([n({json:{write:!0}})],l.prototype,`classificationField`,void 0),e([n({type:String,json:{read:s.read,write:s.write}})],l.prototype,`classificationMethod`,void 0),e([n({json:{write:!0}})],l.prototype,`normalizationField`,void 0),e([n({json:{read:c.read,write:c.write}})],l.prototype,`normalizationType`,void 0),e([n({value:null,json:{write:!0}})],l.prototype,`standardDeviationInterval`,null),e([n({value:null,json:{write:!0}})],l.prototype,`definedInterval`,null),l=e([i(`esri.rest.support.ClassBreaksDefinition`)],l);var u=()=>o.getLogger(`esri.rest.support.generateRendererUtils`);function d(e,t){return Number(e.toFixed(t))}function f(e){let t=g(e),n=[],r=t.uniqueValues.length;for(let e=0;e<r;e++){let r=t.uniqueValues[e],i=t.valueFrequency[e],a=r.toString();n.push({value:r,count:i,label:a})}return{uniqueValues:n}}function p(e,t){let{normalizationTotal:n}=e;return{classBreaks:m(e,t),normalizationTotal:n}}function m(e,t){let n=e.definition,{classificationMethod:r,normalizationType:i,definedInterval:a}=n,o=n.breakCount??1,s=[],c=e.values;if(c.length===0)return[];c=c.sort((e,t)=>e-t);let[l,u]=t??[c.at(0),c.at(-1)];if(r===`equal-interval`)if(c.length>=o){let e=(u-l)/o,t=l;for(let n=1;n<o;n++){let r=d(l+n*e,6);s.push({minValue:t,maxValue:r,label:h(t,r,i)}),t=r}s.push({minValue:t,maxValue:u,label:h(t,u,i)})}else c.forEach(e=>{s.push({minValue:e,maxValue:e,label:h(e,e,i)})});else if(r===`natural-breaks`){let t=g(c),n=e.valueFrequency||t.valueFrequency,r=_(t.uniqueValues,n,o),a=l;for(let e=1;e<o;e++)if(t.uniqueValues.length>e){let n=d(t.uniqueValues[r[e]],6);s.push({minValue:a,maxValue:n,label:h(a,n,i)}),a=n}s.push({minValue:a,maxValue:u,label:h(a,u,i)})}else if(r===`quantile`)if(c.length>=o&&l!==u){let e=l,t=Math.ceil(c.length/o),n=0;for(let r=1;r<o;r++){let a=t+n-1;a>c.length&&(a=c.length-1),a<0&&(a=0),s.push({minValue:e,maxValue:c[a],label:h(e,c[a],i)}),e=c[a],n+=t,t=Math.ceil((c.length-n)/(o-r))}s.push({minValue:e,maxValue:u,label:h(e,u,i)})}else{let e=-1;for(let t=0;t<c.length;t++){let n=c[t];n!==e&&(e=n,s.push({minValue:e,maxValue:n,label:h(e,n,i)}),e=n)}}else if(r===`standard-deviation`){let e=x(c),t=S(c,e);if(t===0)s.push({minValue:c[0],maxValue:c[0],label:h(c[0],c[0],i)});else{let n=b(l,u,o,e,t)*t,r=0,a=l;for(let t=o;t>=1;t--){let o=d(e-(t-.5)*n,6);s.push({minValue:a,maxValue:o,label:h(a,o,i)}),a=o,r++}let c=d(e+.5*n,6);s.push({minValue:a,maxValue:c,label:h(a,c,i)}),a=c,r++;for(let t=1;t<=o;t++)c=r===2*o?u:d(e+(t+.5)*n,6),s.push({minValue:a,maxValue:c,label:h(a,c,i)}),a=c,r++}}else if(r===`defined-interval`){if(!a)return s;let[e,n]=t??[c.at(0),c.at(-1)],r=Math.ceil((n-e)/a),o=e;for(let t=1;t<r;t++){let n=d(e+t*a,6);s.push({minValue:o,maxValue:n,label:h(o,n,i)}),o=n}s.push({minValue:o,maxValue:n,label:h(o,n,i)})}return s}function h(e,t,n){let r=null;return r=e===t?n&&n===`percent-of-total`?e+`%`:e.toString():n&&n===`percent-of-total`?e+`% - `+t+`%`:e+` - `+t,r}function g(e){let t=[],n=[],r=Number.MIN_VALUE,i=1,a=-1;for(let o=0;o<e.length;o++){let s=e[o];s===r?(i++,n[a]=i):s!==null&&(t.push(s),r=s,i=1,n.push(i),a++)}return{uniqueValues:t,valueFrequency:n}}function _(e,t,n){let r=e.length,i=[];n>r&&(n=r);for(let e=0;e<n;e++)i.push(Math.round(e*r/n-1));i.push(r-1);let a=v(i,e,t,n);return y(a.mean,a.sdcm,i,e,t,n)&&(a=v(i,e,t,n)),i}function v(e,t,n,r){let i=[],a=[],o=[],s=0,c=[],l=[];for(let i=0;i<r;i++){let r=C(i,e,t,n);c.push(r.sbMean),l.push(r.sbSdcm),s+=l[i]}let u,d=s,f=!0;for(;f||s<d;){f=!1,i=[];for(let t=0;t<r;t++)i.push(e[t]);for(let n=0;n<r;n++)for(let i=e[n]+1;i<=e[n+1];i++)if(u=t[i],n>0&&i!==e[n+1]&&Math.abs(u-c[n])>Math.abs(u-c[n-1]))e[n]=i;else if(n<r-1&&e[n]!==i-1&&Math.abs(u-c[n])>Math.abs(u-c[n+1])){e[n+1]=i-1;break}d=s,s=0,a=[],o=[];for(let i=0;i<r;i++){a.push(c[i]),o.push(l[i]);let r=C(i,e,t,n);c[i]=r.sbMean,l[i]=r.sbSdcm,s+=l[i]}}if(s>d){for(let t=0;t<r;t++)e[t]=i[t],c[t]=a[t],l[t]=o[t];s=d}return{mean:c,sdcm:l}}function y(e,t,n,r,i,a){let o=0,s=0,c=0,l=0,u=!0;for(let d=0;d<2&&u;d++){d===0&&(u=!1);for(let d=0;d<a-1;d++)for(;n[d+1]+1!==n[d+2];){n[d+1]=n[d+1]+1;let a=C(d,n,r,i);c=a.sbMean,o=a.sbSdcm;let f=C(d+1,n,r,i);if(l=f.sbMean,s=f.sbSdcm,!(o+s<t[d]+t[d+1])){n[d+1]=n[d+1]-1;break}t[d]=o,t[d+1]=s,e[d]=c,e[d+1]=l,u=!0}for(let d=a-1;d>0;d--)for(;n[d]!==n[d-1]+1;){n[d]=n[d]-1;let a=C(d-1,n,r,i);c=a.sbMean,o=a.sbSdcm;let f=C(d,n,r,i);if(l=f.sbMean,s=f.sbSdcm,!(o+s<t[d-1]+t[d])){n[d]=n[d]+1;break}t[d-1]=o,t[d]=s,e[d-1]=c,e[d]=l,u=!0}}return u}function b(e,t,n,r,i){let a=Math.max(r-e,t-r)/i/n;return a=a>=1?1:a>=.5?.5:.25,a}function x(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n];return t/=e.length,t}function S(e,t){let n=0;for(let r=0;r<e.length;r++){let i=e[r];n+=(i-t)*(i-t)}return n/=e.length,Math.sqrt(n)}function C(e,t,n,r){let i=0,a=0;for(let o=t[e]+1;o<=t[e+1];o++){let e=r[o];i+=n[o]*e,a+=e}a<=0&&u().warn(`Exception in Natural Breaks calculation`);let o=i/a,s=0;for(let i=t[e]+1;i<=t[e+1];i++)s+=r[i]*(n[i]-o)**2;return{sbMean:o,sbSdcm:s}}export{f as n,l as r,p as t};