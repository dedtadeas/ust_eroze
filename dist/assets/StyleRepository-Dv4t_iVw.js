import{AE as e,Dl as t,Jc as n,Jv as r,Wy as i,lb as a,rc as o}from"./index-BqmCqmfp.js";import{f as s,m as c,n as l}from"./colorUtils-uG2qTogT.js";import{t as u}from"./constants-gtdOjz1K.js";import{a as d,f,n as p,r as m,t as h}from"./GeometryUtils-DBkUrkz1.js";import{r as g,t as ee}from"./VertexAttributeLocations-IAhvKZqd.js";import{t as _}from"./VertexElementDescriptor-BGWnA0Rs.js";var te=class{constructor(e){this._array=[],this._stride=e}get array(){return this._array}get index(){return 4*this._array.length/this._stride}get itemSize(){return this._stride}get sizeInBytes(){return 4*this._array.length}reset(){this.array.length=0}toBuffer(){return new Uint32Array(this._array).buffer}static i1616to32(e,t){return 65535&e|t<<16}static i8888to32(e,t,n,r){return 255&e|(255&t)<<8|(255&n)<<16|r<<24}static i8816to32(e,t,n){return 255&e|(255&t)<<8|n<<16}},v=class e{constructor(e){this._key=e}get key(){return this._key}get type(){return 7&this._key}defines(){return[]}getStride(){return this._geometryLayout||this._buildAttributesInfo(),this._stride}getAttributeLocations(){return this._geometryLayout||this._buildAttributesInfo(),this._locations}get geometryLayout(){return this._geometryLayout||this._buildAttributesInfo(),this._geometryLayout}getEncodingInfos(){return this._propertyEncodingInfo||this._buildAttributesInfo(),this._propertyEncodingInfo}getUniforms(){return this._uniforms||this._buildAttributesInfo(),this._uniforms}getShaderHeader(){return this._shaderHeader||this._buildAttributesInfo(),this._shaderHeader}getShaderMain(){return this._shaderMain||this._buildAttributesInfo(),this._shaderMain}setDataUniforms(e,t,n,r,i){let a=this.getUniforms();for(let o of a){let{name:a,type:s,getValue:c}=o,l=c(n,t,r,i);if(l!==null)switch(s){case`float`:e.setUniform1f(a,l);break;case`vec2`:e.setUniform2fv(a,l);break;case`vec4`:e.setUniform4fv(a,l)}}}encodeAttributes(e,t,n,r){let i=this.attributesInfo,a=this.getEncodingInfos(),o=[],s=0,c=0;for(let l of Object.keys(a)){let u=a[l],{type:d,precisionFactor:f,isLayout:p}=i[l],m=p?n.getLayoutProperty(l):n.getPaintProperty(l),h=m.interpolator?.getInterpolationRange(t),g=0;for(let n of u){let{offset:i,bufferElementsToAdd:a}=n;if(a>0){for(let e=0;e<a;e++)o.push(0);s+=c,c=n.bufferElementsToAdd}let l=r??m.getValue(h?h[g]:t,e);switch(d){case 0:case 1:o[s]|=this._encodeByte(l*(f||1),8*i);break;case 2:case 3:o[s]|=this._encodeShort(l*(f||1),8*i);break;case 4:case 5:o[s]|=this._encodeByte(l*(f||1),8*i),o[s]|=this._encodeByte(l*(f||1),8*i+8);break;case 6:case 7:o[s]|=this._encodeShort(l*(f||1),8*i),o[s]|=this._encodeShort(l*(f||1),8*i+16);break;case 8:case 9:o[s]|=this._encodeByte(l*(f||1),8*i),o[s]|=this._encodeByte(l*(f||1),8*i+8),o[s]|=this._encodeByte(l*(f||1),8*i+16),o[s]|=this._encodeByte(l*(f||1),8*i+24);break;case 10:o[s]=this._encodeColor(l);break;case 11:case 12:this._encodePattern(s,o,l);break;default:throw Error(`Unsupported encoding type`)}g++}}return o}getAtributeState(e){let t=0,n=3+2*e;return t|=this._bit(n),t|=this._bit(n+1)<<1,t}static{this._encodingInfo={0:{dataType:o.BYTE,bytesPerElement:1,count:1,normalized:!1},1:{dataType:o.UNSIGNED_BYTE,bytesPerElement:1,count:1,normalized:!1},2:{dataType:o.SHORT,bytesPerElement:2,count:1,normalized:!1},3:{dataType:o.UNSIGNED_SHORT,bytesPerElement:2,count:1,normalized:!1},4:{dataType:o.BYTE,bytesPerElement:1,count:2,normalized:!1},5:{dataType:o.UNSIGNED_BYTE,bytesPerElement:1,count:2,normalized:!1},6:{dataType:o.SHORT,bytesPerElement:2,count:2,normalized:!1},7:{dataType:o.UNSIGNED_SHORT,bytesPerElement:2,count:2,normalized:!1},8:{dataType:o.BYTE,bytesPerElement:1,count:4,normalized:!1},9:{dataType:o.UNSIGNED_BYTE,bytesPerElement:1,count:4,normalized:!1},10:{dataType:o.UNSIGNED_BYTE,bytesPerElement:1,count:4,normalized:!0},11:{dataType:o.UNSIGNED_SHORT,bytesPerElement:2,count:4,normalized:!1},12:{dataType:o.UNSIGNED_SHORT,bytesPerElement:2,count:4,normalized:!1}}}_buildAttributesInfo(){let t=[],n={},{attributesInfo:r,attributes:i}=this,a={},s=-1,c=-1;for(let o of i){c++;let i=this.getAtributeState(c);if(i===0||i===3)continue;let l=r[o],u=[];n[o]=u;let d=l.type;for(let n=0;n<i;n++){let{dataType:n,bytesPerElement:r,count:i,normalized:o}=e._encodingInfo[d],c=r*i,l=`${n}-${!0===o}`,f=a[l],p=0;if(!f||f.count+i>4)s++,f={dataIndex:s,count:0,offset:0},i!==4&&(a[l]=f),t.push({location:-1,name:`a_data_`+s,count:i,type:n,normalized:o}),p=Math.ceil(Math.max(c/4,1));else{let e=t[f.dataIndex];e.count+=i,p=Math.ceil(Math.max(e.count*r/4,1))-Math.ceil(Math.max(f.offset/4,1))}u.push({dataIndex:f.dataIndex,offset:f.offset,bufferElementsToAdd:p}),f.offset+=c,f.count+=i}}for(let e of t)switch(e.type){case o.BYTE:case o.UNSIGNED_BYTE:e.count=4;break;case o.SHORT:case o.UNSIGNED_SHORT:e.count+=e.count%2}this._buildVertexBufferLayout(t),this._buildShaderInfo(t,n),this._propertyEncodingInfo=n}_buildVertexBufferLayout(e){let t=this.baseGeometryLayout,n=t[0].stride;if(e.length===0)this._geometryLayout=t;else{let r=[],i=n;for(let t of e)n+=y(t.type)*t.count;for(let e of t)r.push(new _(e.name,e.count,e.type,e.offset,n,e.normalized));for(let t of e)r.push(new _(t.name,t.count,t.type,i,n,t.normalized)),i+=y(t.type)*t.count;this._geometryLayout=r}this.opacityLayout?this._locations=g([this._geometryLayout,this.opacityLayout]):this._locations=ee(this._geometryLayout),this._stride=n}_buildShaderInfo(t,n){let r=`
`,i=`
`,a=[];for(let e of t)r+=`attribute ${this._getType(e.count)} ${e.name};\n`;let{attributesInfo:o,attributes:s}=this,c=-1;for(let t of s){c++;let{name:s,type:l,precisionFactor:u,isLayout:d}=o[t],f=u&&u!==1?` * `+1/u:``,{bytesPerElement:p,count:m}=e._encodingInfo[l],h=e=>`a_data_${e.dataIndex}${ne(m,e.offset,p)}`;switch(this.getAtributeState(c)){case 0:{let e=this._getType(m),n=`u_${s}`;a.push({name:n,type:e,getValue:(e,n,r,i)=>{let a=d?e.getLayoutValue(t,n):e.getPaintValue(t,n);if(l===11){let t=e.getDashKey(a,e.getLayoutValue(`line-cap`,n)),r=i.getMosaicItemPosition(t,!1);if(r==null)return null;let{tl:o,br:s}=r;return[o[0],s[1],s[0],o[1]]}if(l===12){let e=i.getMosaicItemPosition(a,!t.includes(`line-`));if(e==null)return null;let{tl:n,br:r}=e;return[n[0],r[1],r[0],n[1]]}if(l===10){let e=a[3];return[e*a[0],e*a[1],e*a[2],e]}return a}}),r+=`uniform ${e} ${n};\n`,i+=`${e} ${s} = ${n};\n`}break;case 1:{let e=h(n[t][0]);i+=`${this._getType(m)} ${s} = ${e}${f};\n`}break;case 2:{let e=`u_t_${s}`;a.push({name:e,type:`float`,getValue:(e,n,r,i)=>(d?e.getLayoutProperty(t):e.getPaintProperty(t)).interpolator.interpolationUniformValue(r,n)}),r+=`uniform float ${e};\n`;let o=h(n[t][0]),c=h(n[t][1]);i+=`${this._getType(m)} ${s} = mix(${o}${f}, ${c}${f}, ${e});\n`}}}this._shaderHeader=r,this._shaderMain=i,this._uniforms=a}_bit(e){return(this._key&1<<e)>>e}_getType(e){switch(e){case 1:return`float`;case 2:return`vec2`;case 3:return`vec3`;case 4:return`vec4`}throw Error(`Invalid count`)}_encodeColor(e){let t=255*e[3];return te.i8888to32(e[0]*t,e[1]*t,e[2]*t,t)}_encodePattern(e,t,n){if(!n?.rect)return;let r=n.rect,i=n.width,a=n.height;t[e]=this._encodeShort(r.x+2,0),t[e]|=this._encodeShort(r.y+2+a,16),t[e+1]=this._encodeShort(r.x+2+i,0),t[e+1]|=this._encodeShort(r.y+2,16)}_encodeByte(e,t){return(255&e)<<t}_encodeShort(e,t){return(65535&e)<<t}},y=e=>{switch(e){case o.FLOAT:case o.INT:case o.UNSIGNED_INT:return 4;case o.SHORT:case o.UNSIGNED_SHORT:case o.HALF_FLOAT:return 2;case o.BYTE:case o.UNSIGNED_BYTE:return 1}},ne=(e,t,n)=>{let r=t/n;if(e===1)switch(r){case 0:return`.x`;case 1:return`.y`;case 2:return`.z`;case 3:return`.w`}else if(e===2)switch(r){case 0:return`.xy`;case 1:return`.yz`;case 2:return`.zw`}else if(e===3)switch(r){case 0:return`.xyz`;case 1:return`.yzw`}return``},b=class e extends v{static{this.ATTRIBUTES=[]}static{this.GEOMETRY_LAYOUT=[new _(`a_pos`,2,o.BYTE,0,2)]}static{this.ATTRIBUTES_INFO={}}constructor(t){super(t),this.baseGeometryLayout=e.GEOMETRY_LAYOUT,this.attributes=e.ATTRIBUTES,this.attributesInfo=e.ATTRIBUTES_INFO}},x=class e extends v{static{this.ATTRIBUTES=[`circle-radius`,`circle-color`,`circle-opacity`,`circle-stroke-width`,`circle-stroke-color`,`circle-stroke-opacity`,`circle-blur`]}static{this.GEOMETRY_LAYOUT=[new _(`a_pos`,2,o.SHORT,0,4)]}static{this.ATTRIBUTES_INFO={"circle-radius":{name:`radius`,type:1},"circle-color":{name:`color`,type:10},"circle-opacity":{name:`opacity`,type:1,precisionFactor:100},"circle-stroke-width":{name:`stroke_width`,type:1,precisionFactor:4},"circle-stroke-color":{name:`stroke_color`,type:10},"circle-stroke-opacity":{name:`stroke_opacity`,type:1,precisionFactor:100},"circle-blur":{name:`blur`,type:1,precisionFactor:32}}}constructor(t){super(t),this.baseGeometryLayout=e.GEOMETRY_LAYOUT,this.attributes=e.ATTRIBUTES,this.attributesInfo=e.ATTRIBUTES_INFO}},S=class e extends v{static{this.ATTRIBUTES=[`fill-color`,`fill-opacity`,`fill-pattern`]}static{this.GEOMETRY_LAYOUT=[new _(`a_pos`,2,o.SHORT,0,4)]}static{this.ATTRIBUTES_INFO={"fill-color":{name:`color`,type:10},"fill-opacity":{name:`opacity`,type:1,precisionFactor:100},"fill-pattern":{name:`tlbr`,type:12,isOptional:!0}}}constructor(t){super(t),this.baseGeometryLayout=e.GEOMETRY_LAYOUT,this.attributes=e.ATTRIBUTES,this.attributesInfo=e.ATTRIBUTES_INFO}},C=class e extends v{static{this.ATTRIBUTES_OUTLINE=[`fill-outline-color`,`fill-opacity`]}static{this.ATTRIBUTES_FILL=[`fill-color`,`fill-opacity`]}static{this.GEOMETRY_LAYOUT=[new _(`a_pos`,2,o.SHORT,0,8),new _(`a_offset`,2,o.BYTE,4,8),new _(`a_xnormal`,2,o.BYTE,6,8)]}static{this.ATTRIBUTES_INFO_OUTLINE={"fill-outline-color":{name:`color`,type:10},"fill-opacity":{name:`opacity`,type:1,precisionFactor:100}}}static{this.ATTRIBUTES_INFO_FILL={"fill-color":{name:`color`,type:10},"fill-opacity":{name:`opacity`,type:1,precisionFactor:100}}}constructor(t,n){super(t),this.baseGeometryLayout=e.GEOMETRY_LAYOUT,this.attributes=n?e.ATTRIBUTES_FILL:e.ATTRIBUTES_OUTLINE,this.attributesInfo=n?e.ATTRIBUTES_INFO_FILL:e.ATTRIBUTES_INFO_OUTLINE}},w=class e extends v{static{this.ATTRIBUTES=[`line-blur`,`line-color`,`line-gap-width`,`line-offset`,`line-opacity`,`line-width`,`line-pattern`,`line-dasharray`]}static{this.GEOMETRY_LAYOUT=[new _(`a_pos`,2,o.SHORT,0,16),new _(`a_extrude_offset`,4,o.BYTE,4,16),new _(`a_dir_normal`,4,o.BYTE,8,16),new _(`a_accumulatedDistance`,2,o.UNSIGNED_SHORT,12,16)]}static{this.ATTRIBUTES_INFO={"line-width":{name:`width`,type:1,precisionFactor:2},"line-gap-width":{name:`gap_width`,type:1,precisionFactor:2},"line-offset":{name:`offset`,type:0,precisionFactor:2},"line-color":{name:`color`,type:10},"line-opacity":{name:`opacity`,type:1,precisionFactor:100},"line-blur":{name:`blur`,type:1,precisionFactor:4},"line-pattern":{name:`tlbr`,type:12,isOptional:!0},"line-dasharray":{name:`tlbr`,type:11,isOptional:!0}}}constructor(t){super(t),this.baseGeometryLayout=e.GEOMETRY_LAYOUT,this.attributes=e.ATTRIBUTES,this.attributesInfo=e.ATTRIBUTES_INFO}},T=[new _(`a_pos`,2,o.SHORT,0,16),new _(`a_vertexOffset`,2,o.SHORT,4,16),new _(`a_texAngleRange`,4,o.UNSIGNED_BYTE,8,16),new _(`a_levelInfo`,4,o.UNSIGNED_BYTE,12,16)],E=[new _(`a_opacityInfo`,1,o.UNSIGNED_BYTE,0,1)],D=class e extends v{static{this.ATTRIBUTES=[`icon-color`,`icon-opacity`,`icon-halo-blur`,`icon-halo-color`,`icon-halo-width`,`icon-size`]}static{this.ATTRIBUTES_INFO={"icon-color":{name:`color`,type:10},"icon-opacity":{name:`opacity`,type:1,precisionFactor:100},"icon-halo-color":{name:`halo_color`,type:10},"icon-halo-width":{name:`halo_width`,type:1,precisionFactor:4},"icon-halo-blur":{name:`halo_blur`,type:1,precisionFactor:4},"icon-size":{name:`size`,type:1,precisionFactor:32,isLayout:!0}}}constructor(t){super(t),this.baseGeometryLayout=T,this.opacityLayout=E,this.attributes=e.ATTRIBUTES,this.attributesInfo=e.ATTRIBUTES_INFO}},O=class e extends v{static{this.ATTRIBUTES=[`text-color`,`text-opacity`,`text-halo-blur`,`text-halo-color`,`text-halo-width`,`text-size`]}static{this.ATTRIBUTES_INFO={"text-color":{name:`color`,type:10},"text-opacity":{name:`opacity`,type:1,precisionFactor:100},"text-halo-color":{name:`halo_color`,type:10},"text-halo-width":{name:`halo_width`,type:1,precisionFactor:4},"text-halo-blur":{name:`halo_blur`,type:1,precisionFactor:4},"text-size":{name:`size`,type:1,isLayout:!0}}}constructor(t){super(t),this.baseGeometryLayout=T,this.opacityLayout=E,this.attributes=e.ATTRIBUTES,this.attributesInfo=e.ATTRIBUTES_INFO}},k={kind:`null`},A={kind:`number`},j={kind:`string`},M={kind:`boolean`},N={kind:`color`},P={kind:`object`},F={kind:`value`};function I(e,t){return{kind:`array`,itemType:e,n:t}}var re=[k,A,j,M,N,P,I(F)];function L(e){if(e.kind===`array`){let t=L(e.itemType);return typeof e.n==`number`?`array<${t}, ${e.n}>`:e.itemType.kind===`value`?`array`:`array<${t}>`}return e.kind}function R(e){if(e===null)return k;if(typeof e==`string`)return j;if(typeof e==`boolean`)return M;if(typeof e==`number`)return A;if(e instanceof i)return N;if(Array.isArray(e)){let t;for(let n of e){let e=R(n);if(t){if(t!==e){t=F;break}}else t=e}return I(t||F,e.length)}return typeof e==`object`?P:F}function z(e,t){if(t.kind===`array`)return e.kind===`array`&&(e.n===0&&e.itemType.kind===`value`||z(e.itemType,t.itemType))&&(typeof t.n!=`number`||t.n===e.n);if(t.kind===`value`){for(let t of re)if(z(e,t))return!0}return t.kind===e.kind}function B(e){if(e===null)return``;let t=typeof e;return t===`string`?e:t===`number`||t===`boolean`?String(e):e instanceof i?e.toString():JSON.stringify(e)}var ie=class{constructor(e){this._parent=e,this._vars={}}add(e,t){this._vars[e]=t}get(e){return this._vars[e]?this._vars[e]:this._parent?this._parent.get(e):null}},ae=class e{constructor(){this.type=F}static parse(t){if(t.length>1)throw Error(`"id" does not expect arguments`);return new e}evaluate(e,t){return e?.id}},oe=class e{constructor(){this.type=j}static parse(t){if(t.length>1)throw Error(`"geometry-type" does not expect arguments`);return new e}evaluate(e,t){if(!e)return null;switch(e.type){case 1:return`Point`;case 2:return`LineString`;case 3:return`Polygon`;default:return null}}},se=class e{constructor(){this.type=P}static parse(t){if(t.length>1)throw Error(`"properties" does not expect arguments`);return new e}evaluate(e,t){return e?.values}},V=class e{constructor(){this.type=A}static parse(t){if(t.length>1)throw Error(`"zoom" does not expect arguments`);return new e}evaluate(e,t){return t}},H=class e{constructor(e,t,n){this._lhs=e,this._rhs=t,this._compare=n,this.type=M}static parse(t,n,r){if(t.length!==3&&t.length!==4)throw Error(`"${t[0]}" expects 2 or 3 arguments`);if(t.length===4)throw Error(`"${t[0]}" collator not supported`);return new e(Y(t[1],n),Y(t[2],n),r)}evaluate(e,t){return this._compare(this._lhs.evaluate(e,t),this._rhs.evaluate(e,t))}},ce=class extends H{static parse(e,t){return H.parse(e,t,(e,t)=>e===t)}},le=class extends H{static parse(e,t){return H.parse(e,t,(e,t)=>e!==t)}},ue=class extends H{static parse(e,t){return H.parse(e,t,(e,t)=>e<t)}},de=class extends H{static parse(e,t){return H.parse(e,t,(e,t)=>e<=t)}},fe=class extends H{static parse(e,t){return H.parse(e,t,(e,t)=>e>t)}},pe=class extends H{static parse(e,t){return H.parse(e,t,(e,t)=>e>=t)}},me=class e{constructor(e){this._arg=e,this.type=M}static parse(t,n){if(t.length!==2)throw Error(`"!" expects 1 argument`);return new e(Y(t[1],n))}evaluate(e,t){return!this._arg.evaluate(e,t)}},he=class e{constructor(e){this._args=e,this.type=M}static parse(t,n){let r=[];for(let e=1;e<t.length;e++)r.push(Y(t[e],n));return new e(r)}evaluate(e,t){for(let n of this._args)if(!n.evaluate(e,t))return!1;return!0}},ge=class e{constructor(e){this._args=e,this.type=M}static parse(t,n){let r=[];for(let e=1;e<t.length;e++)r.push(Y(t[e],n));return new e(r)}evaluate(e,t){for(let n of this._args)if(n.evaluate(e,t))return!0;return!1}},_e=class e{constructor(e){this._args=e,this.type=M}static parse(t,n){let r=[];for(let e=1;e<t.length;e++)r.push(Y(t[e],n));return new e(r)}evaluate(e,t){for(let n of this._args)if(n.evaluate(e,t))return!1;return!0}},ve=class e{constructor(e,t,n){this.type=e,this._args=t,this._fallback=n}static parse(t,n,r){if(t.length<4)throw Error(`"case" expects at least 3 arguments`);if(t.length%2==1)throw Error(`"case" expects an odd number of arguments`);let i,a=[];for(let e=1;e<t.length-1;e+=2){let o=Y(t[e],n),s=Y(t[e+1],n,r);i||=s.type,a.push({condition:o,output:s})}let o=Y(t[t.length-1],n,r);return i||=o.type,new e(i,a,o)}evaluate(e,t){for(let n of this._args)if(n.condition.evaluate(e,t))return n.output.evaluate(e,t);return this._fallback.evaluate(e,t)}},ye=class e{constructor(e,t){this.type=e,this._args=t}static parse(t,n){if(t.length<2)throw Error(`"coalesce" expects at least 1 argument`);let r,i=[];for(let e=1;e<t.length;e++){let a=Y(t[e],n);r||=a.type,i.push(a)}return new e(r,i)}evaluate(e,t){for(let n of this._args){let r=n.evaluate(e,t);if(r!==null)return r}return null}},be=class e{constructor(e,t,n,r,i){this.type=e,this._input=t,this._labels=n,this._outputs=r,this._fallback=i}static parse(t,n){if(t.length<3)throw Error(`"match" expects at least 3 arguments`);if(t.length%2==0)throw Error(`"case" expects an even number of arguments`);let r,i=Y(t[1],n),a=[],o={},s;for(let e=2;e<t.length-1;e+=2){let i=t[e];Array.isArray(i)||(i=[i]);for(let e of i){let t=typeof e;if(t!==`string`&&t!==`number`)throw Error(`"match" requires string or number literal as labels`);if(s){if(t!==s)throw Error(`"match" requires labels to have the same type`)}else s=t;o[e]=a.length}let c=Y(t[e+1],n);r||=c.type,a.push(c)}return new e(r,i,o,a,Y(t[t.length-1],n))}evaluate(e,t){let n=this._input.evaluate(e,t);return(this._outputs[this._labels[n]]||this._fallback).evaluate(e,t)}},U=class e{constructor(e,t,n,r,i){this._operator=e,this.type=t,this.interpolation=n,this.input=r,this._stops=i}static parse(t,n,r){let i=t[0];if(t.length<5)throw Error(`"${i}" expects at least 4 arguments`);let a=t[1];if(!Array.isArray(a)||a.length===0)throw Error(`"${a}" is not a valid interpolation`);switch(a[0]){case`linear`:if(a.length!==1)throw Error(`Linear interpolation cannot have parameters`);break;case`exponential`:if(a.length!==2||typeof a[1]!=`number`)throw Error(`Exponential interpolation requires one numeric argument`);break;case`cubic-bezier`:if(a.length!==5)throw Error(`Cubic bezier interpolation requires four numeric arguments with values between 0 and 1`);for(let e=1;e<5;e++){let t=a[e];if(typeof t!=`number`||t<0||t>1)throw Error(`Cubic bezier interpolation requires four numeric arguments with values between 0 and 1`)}break;default:throw Error(`"${t[0]}" unknown interpolation type "${a[0]}"`)}if(t.length%2!=1)throw Error(`"${i}" expects an even number of arguments`);let o=Y(t[2],n,A),s;i===`interpolate-hcl`||i===`interpolate-lab`?s=N:r&&r.kind!==`value`&&(s=r);let c=[];for(let e=3;e<t.length;e+=2){let r=t[e];if(typeof r!=`number`)throw Error(`"${i}" requires stop inputs as literal numbers`);if(c.length&&c[c.length-1][0]>=r)throw Error(`"${i}" requires strictly ascending stop inputs`);let a=Y(t[e+1],n,s);s||=a.type,c.push([r,a])}if(s&&s!==N&&s!==A&&(s.kind!==`array`||s.itemType!==A))throw Error(`"${i}" cannot interpolate type ${L(s)}`);return new e(i,s,a,o,c)}evaluate(t,n){let r=this._stops;if(r.length===1)return r[0][1].evaluate(t,n);let a=this.input.evaluate(t,n);if(a<=r[0][0])return r[0][1].evaluate(t,n);if(a>=r[r.length-1][0])return r[r.length-1][1].evaluate(t,n);let o=0;for(;++o<r.length&&!(a<r[o][0]););let u=r[o-1][0],d=r[o][0],p=e.interpolationRatio(this.interpolation,a,u,d),m=r[o-1][1].evaluate(t,n),h=r[o][1].evaluate(t,n);if(this._operator===`interpolate`){if(this.type.kind===`array`&&Array.isArray(m)&&Array.isArray(h))return m.map((e,t)=>f(e,h[t],p));if(this.type.kind===`color`&&m instanceof i&&h instanceof i){let e=new i(m),t=new i(h);return new i([f(e.r,t.r,p),f(e.g,t.g,p),f(e.b,t.b,p),f(e.a,t.a,p)])}if(this.type.kind===`number`&&typeof m==`number`&&typeof h==`number`)return f(m,h,p);throw Error(`"${this._operator}" cannot interpolate type ${L(this.type)}`)}if(this._operator===`interpolate-hcl`){let e=c(m),t=c(h),n=t.h-e.h,r=s({h:e.h+p*(n>180||n<-180?n-360*Math.round(n/360):n),c:f(e.c,t.c,p),l:f(e.l,t.l,p)});return new i({a:f(m.a,h.a,p),...r})}if(this._operator===`interpolate-lab`){let e=l(m),t=l(h),n=s({l:f(e.l,t.l,p),a:f(e.a,t.a,p),b:f(e.b,t.b,p)});return new i({a:f(m.a,h.a,p),...n})}throw Error(`Unexpected operator "${this._operator}"`)}interpolationUniformValue(t,n){let r=this._stops;if(r.length===1||t>=r[r.length-1][0])return 0;let i=0;for(;++i<r.length&&!(t<r[i][0]););let a=r[i-1][0],o=r[i][0];return e.interpolationRatio(this.interpolation,n,a,o)}getInterpolationRange(e){let t=this._stops;if(t.length===1){let e=t[0][0];return[e,e]}let n=t[t.length-1][0];if(e>=n)return[n,n];let r=0;for(;++r<t.length&&!(e<t[r][0]););return[t[r-1][0],t[r][0]]}static interpolationRatio(n,r,i,a){let o=0;return n[0]===`linear`?o=e._exponentialInterpolationRatio(r,1,i,a):n[0]===`exponential`?o=e._exponentialInterpolationRatio(r,n[1],i,a):n[0]===`cubic-bezier`&&(o=t(n[1],n[2],n[3],n[4])(e._exponentialInterpolationRatio(r,1,i,a),1e-5)),o<0?o=0:o>1&&(o=1),o}static _exponentialInterpolationRatio(e,t,n,r){let i=r-n;if(i===0)return 0;let a=e-n;return t===1?a/i:(t**a-1)/(t**i-1)}},xe=class e{constructor(e,t,n){this.type=e,this._input=t,this._stops=n}static parse(t,n){if(t.length<5)throw Error(`"step" expects at least 4 arguments`);if(t.length%2!=1)throw Error(`"step" expects an even number of arguments`);let r=Y(t[1],n,A),i,a=[];a.push([-1/0,Y(t[2],n)]);for(let e=3;e<t.length;e+=2){let r=t[e];if(typeof r!=`number`)throw Error(`"step" requires stop inputs as literal numbers`);if(a.length&&a[a.length-1][0]>=r)throw Error(`"step" requires strictly ascending stop inputs`);let o=Y(t[e+1],n);i||=o.type,a.push([r,o])}return new e(i,r,a)}evaluate(e,t){let n=this._stops;if(n.length===1)return n[0][1].evaluate(e,t);let r=this._input.evaluate(e,t),i=0;for(;++i<n.length&&!(r<n[i][0]););return this._stops[i-1][1].evaluate(e,t)}},Se=class e{constructor(e,t){this.type=e,this._output=t}static parse(t,n,r){if(t.length<4)throw Error(`"let" expects at least 3 arguments`);if(t.length%2==1)throw Error(`"let" expects an odd number of arguments`);let i=new ie(n);for(let e=1;e<t.length-1;e+=2){let r=t[e];if(typeof r!=`string`)throw Error(`"let" requires a string to define variable names - found ${r}`);i.add(r,Y(t[e+1],n))}let a=Y(t[t.length-1],i,r);return new e(a.type,a)}evaluate(e,t){return this._output.evaluate(e,t)}},Ce=class e{constructor(e,t){this.type=e,this.output=t}static parse(t,n,r){if(t.length!==2||typeof t[1]!=`string`)throw Error(`"var" requires just one literal string argument`);let i=n.get(t[1]);if(!i)throw Error(`${t[1]} must be defined before being used in a "var" expression`);return new e(r||F,i)}evaluate(e,t){return this.output.evaluate(e,t)}},we=class e{constructor(e,t,n){this.type=e,this._index=t,this._array=n}static parse(t,n){if(t.length!==3)throw Error(`"at" expects 2 arguments`);let r=Y(t[1],n,A),i=Y(t[2],n);return new e(i.type.itemType,r,i)}evaluate(e,t){let n=this._index.evaluate(e,t),r=this._array.evaluate(e,t);if(n<0||n>=r.length)throw Error(`"at" index out of bounds`);if(n!==Math.floor(n))throw Error(`"at" index must be an integer`);return r[n]}},Te=class e{constructor(e,t){this._key=e,this._obj=t,this.type=F}static parse(t,n){let r,i;switch(t.length){case 2:return r=Y(t[1],n),new e(r);case 3:return r=Y(t[1],n),i=Y(t[2],n),new e(r,i);default:throw Error(`"get" expects 1 or 2 arguments`)}}evaluate(e,t){let n=this._key.evaluate(e,t);return this._obj?this._obj.evaluate(e,t)[n]:e?.values[n]}},Ee=class e{constructor(e,t){this._key=e,this._obj=t,this.type=M}static parse(t,n){let r,i;switch(t.length){case 2:return r=Y(t[1],n),new e(r);case 3:return r=Y(t[1],n),i=Y(t[2],n),new e(r,i);default:throw Error(`"has" expects 1 or 2 arguments`)}}evaluate(e,t){let n=this._key.evaluate(e,t);return this._obj?n in this._obj.evaluate(e,t):!!e?.values[n]}},De=class e{constructor(e,t){this._key=e,this._vals=t,this.type=M}static parse(t,n){if(t.length!==3)throw Error(`"in" expects 2 arguments`);return new e(Y(t[1],n),Y(t[2],n))}evaluate(e,t){let n=this._key.evaluate(e,t);return this._vals.evaluate(e,t).includes(n)}},Oe=class e{constructor(e,t,n){this._item=e,this._array=t,this._from=n,this.type=A}static parse(t,n){if(t.length<3||t.length>4)throw Error(`"index-of" expects 3 or 4 arguments`);let r=Y(t[1],n),i=Y(t[2],n);if(t.length===4){let a=Y(t[3],n,A);return new e(r,i,a)}return new e(r,i)}evaluate(e,t){let n=this._item.evaluate(e,t),r=this._array.evaluate(e,t);if(this._from){let i=this._from.evaluate(e,t);if(i!==Math.floor(i))throw Error(`"index-of" index must be an integer`);return r.indexOf(n,i)}return r.indexOf(n)}},ke=class e{constructor(e){this._arg=e,this.type=A}static parse(t,n){if(t.length!==2)throw Error(`"length" expects 2 arguments`);let r=Y(t[1],n);return new e(r)}evaluate(e,t){let n=this._arg.evaluate(e,t);if(typeof n==`string`||Array.isArray(n))return n.length;throw Error(`"length" expects string or array`)}},Ae=class e{constructor(e,t,n,r){this.type=e,this._array=t,this._from=n,this._to=r}static parse(t,n){if(t.length<3||t.length>4)throw Error(`"slice" expects 2 or 3 arguments`);let r=Y(t[1],n),i=Y(t[2],n,A);if(i.type!==A)throw Error(`"slice" index must return a number`);if(t.length===4){let a=Y(t[3],n,A);if(a.type!==A)throw Error(`"slice" index must return a number`);return new e(r.type,r,i,a)}return new e(r.type,r,i)}evaluate(e,t){let n=this._array.evaluate(e,t);if(!Array.isArray(n)&&typeof n!=`string`)throw Error(`"slice" input must be an array or a string`);let r=this._from.evaluate(e,t);if(r<0||r>=n.length)throw Error(`"slice" index out of bounds`);if(r!==Math.floor(r))throw Error(`"slice" index must be an integer`);if(this._to){let i=this._to.evaluate(e,t);if(i<0||i>=n.length)throw Error(`"slice" index out of bounds`);if(i!==Math.floor(i))throw Error(`"slice" index must be an integer`);return n.slice(r,i)}return n.slice(r)}},je=class e{constructor(){this.type=M}static parse(t){if(t.length!==1)throw Error(`"has-id" expects no arguments`);return new e}evaluate(e,t){return e?.id!==void 0}},W=class e{constructor(e,t){this._args=e,this._calculate=t,this.type=A}static parse(t,n,r){let i=t.slice(1).map(e=>Y(e,n));return new e(i,r)}evaluate(e,t){let n;return this._args&&(n=this._args.map(n=>n.evaluate(e,t))),this._calculate(n)}},Me=class extends W{static parse(e,t){switch(e.length){case 2:return W.parse(e,t,e=>-e[0]);case 3:return W.parse(e,t,e=>e[0]-e[1]);default:throw Error(`"-" expects 1 or 2 arguments`)}}},Ne=class extends W{static parse(e,t){return W.parse(e,t,e=>{let t=1;for(let n of e)t*=n;return t})}},Pe=class extends W{static parse(e,t){if(e.length===3)return W.parse(e,t,e=>e[0]/e[1]);throw Error(`"/" expects 2 arguments`)}},Fe=class extends W{static parse(e,t){if(e.length===3)return W.parse(e,t,e=>e[0]%e[1]);throw Error(`"%" expects 2 arguments`)}},Ie=class extends W{static parse(e,t){if(e.length===3)return W.parse(e,t,e=>e[0]**e[1]);throw Error(`"^" expects 1 or 2 arguments`)}},Le=class extends W{static parse(e,t){return W.parse(e,t,e=>{let t=0;for(let n of e)t+=n;return t})}},G=class e{constructor(e,t){this._args=e,this._calculate=t,this.type=A}static{this.ops={abs:e=>Math.abs(e[0]),acos:e=>Math.acos(e[0]),asin:e=>Math.asin(e[0]),atan:e=>Math.atan(e[0]),ceil:e=>Math.ceil(e[0]),cos:e=>Math.cos(e[0]),e:()=>Math.E,floor:e=>Math.floor(e[0]),ln:e=>Math.log(e[0]),ln2:()=>Math.LN2,log10:e=>Math.log(e[0])/Math.LN10,log2:e=>Math.log(e[0])/Math.LN2,max:e=>Math.max(...e),min:e=>Math.min(...e),pi:()=>Math.PI,round:e=>Math.round(e[0]),sin:e=>Math.sin(e[0]),sqrt:e=>Math.sqrt(e[0]),tan:e=>Math.tan(e[0])}}static parse(t,n){let r=t.slice(1).map(e=>Y(e,n));return new e(r,e.ops[t[0]])}evaluate(e,t){let n;return this._args&&(n=this._args.map(n=>n.evaluate(e,t))),this._calculate(n)}},Re=class e{constructor(e){this._args=e,this.type=j}static parse(t,n){return new e(t.slice(1).map(e=>Y(e,n)))}evaluate(e,t){return this._args.map(n=>n.evaluate(e,t)).join(``)}},K=class e{constructor(e,t){this._arg=e,this._calculate=t,this.type=j}static{this.ops={downcase:e=>e.toLowerCase(),upcase:e=>e.toUpperCase()}}static parse(t,n){if(t.length!==2)throw Error(`${t[0]} expects 1 argument`);let r=Y(t[1],n);return new e(r,e.ops[t[0]])}evaluate(e,t){return this._calculate(this._arg.evaluate(e,t))}},ze=class e{constructor(e){this._args=e,this.type=N}static parse(t,n){if(t.length!==4)throw Error(`"rgb" expects 3 arguments`);let r=t.slice(1).map(e=>Y(e,n));return new e(r)}evaluate(e,t){let n=this._validate(this._args[0].evaluate(e,t)),r=this._validate(this._args[1].evaluate(e,t)),a=this._validate(this._args[2].evaluate(e,t));return new i({r:n,g:r,b:a})}_validate(e){if(typeof e!=`number`||e<0||e>255)throw Error(`${e}: invalid color component`);return Math.round(e)}},Be=class e{constructor(e){this._args=e,this.type=N}static parse(t,n){if(t.length!==5)throw Error(`"rgba" expects 4 arguments`);let r=t.slice(1).map(e=>Y(e,n));return new e(r)}evaluate(e,t){let n=this._validate(this._args[0].evaluate(e,t)),r=this._validate(this._args[1].evaluate(e,t)),a=this._validate(this._args[2].evaluate(e,t)),o=this._validateAlpha(this._args[3].evaluate(e,t));return new i({r:n,g:r,b:a,a:o})}_validate(e){if(typeof e!=`number`||e<0||e>255)throw Error(`${e}: invalid color component`);return Math.round(e)}_validateAlpha(e){if(typeof e!=`number`||e<0||e>1)throw Error(`${e}: invalid alpha color component`);return e}},Ve=class e{constructor(e){this._color=e,this.type=I(A,4)}static parse(t,n){if(t.length!==2)throw Error(`"to-rgba" expects 1 argument`);let r=Y(t[1],n);return new e(r)}evaluate(e,t){return new i(this._color.evaluate(e,t)).toRgba()}},q=class e{constructor(e,t){this.type=e,this._args=t}static parse(t,n){let r=t[0];if(t.length<2)throw Error(`${r} expects at least one argument`);let i,a=1;if(r===`array`){if(t.length>2){switch(t[1]){case`string`:i=j;break;case`number`:i=A;break;case`boolean`:i=M;break;default:throw Error(`"array" type argument must be string, number or boolean`)}a++}else i=F;let e;if(t.length>3){if(e=t[2],e!==null&&(typeof e!=`number`||e<0||e!==Math.floor(e)))throw Error(`"array" length argument must be a positive integer literal`);a++}i=I(i,e)}else switch(r){case`string`:i=j;break;case`number`:i=A;break;case`boolean`:i=M;break;case`object`:i=P}let o=[];for(;a<t.length;a++){let e=Y(t[a],n);o.push(e)}return new e(i,o)}evaluate(e,t){let n;for(let r of this._args){let i=r.evaluate(e,t);if(n=R(i),z(n,this.type))return i}throw Error(`Expected ${L(this.type)} but got ${L(n)}`)}},J=class e{static{this.types={"to-boolean":M,"to-color":N,"to-number":A,"to-string":j}}constructor(e,t){this.type=e,this._args=t}static parse(t,n){let r=t[0],i=e.types[r];if(i===M||i===j){if(t.length!==2)throw Error(`${r} expects one argument`)}else if(t.length<2)throw Error(`${r} expects at least one argument`);let a=[];for(let e=1;e<t.length;e++){let r=Y(t[e],n);a.push(r)}return new e(i,a)}evaluate(t,n){if(this.type===M)return!!this._args[0].evaluate(t,n);if(this.type===j)return B(this._args[0].evaluate(t,n));if(this.type===A){for(let e of this._args){let r=Number(e.evaluate(t,n));if(!isNaN(r))return r}return null}if(this.type===N){for(let r of this._args)try{let a=e.toColor(r.evaluate(t,n));if(a instanceof i)return a}catch{}return null}}static toBoolean(e){return!!e}static toString(e){return B(e)}static toNumber(e){let t=Number(e);if(isNaN(t))throw Error(`"${e}" is not a number`);return t}static toColor(e){if(e instanceof i)return e;if(typeof e==`string`){let t=i.fromString(e);if(t)return t;throw Error(`"${e}" is not a color`)}if(Array.isArray(e))return i.fromArray(e);throw Error(`"${e}" is not a color`)}},He=class e{constructor(e){this._val=e,this.type=R(e)}static parse(t){if(t.length!==2)throw Error(`"literal" expects 1 argument`);return new e(t[1])}evaluate(e,t){return this._val}},Ue=class e{constructor(e){this._arg=e,this.type=j}static parse(t,n){if(t.length!==2)throw Error(`"typeof" expects 1 argument`);return new e(Y(t[1],n))}evaluate(e,t){return L(R(this._arg.evaluate(e,t)))}};function Y(e,t,n){let r=typeof e;if(r===`string`||r===`boolean`||r===`number`||e===null){if(n)switch(n.kind){case`string`:r!==`string`&&(e=J.toString(e));break;case`number`:r!==`number`&&(e=J.toNumber(e));break;case`color`:e=J.toColor(e)}e=[`literal`,e]}if(!Array.isArray(e)||e.length===0)throw Error(`Expression must be a non empty array`);let i=e[0];if(typeof i!=`string`)throw Error(`First element of expression must be a string`);let a=X[i];if(a===void 0)throw Error(`Invalid expression operator "${i}"`);if(!a)throw Error(`Unimplemented expression operator "${i}"`);return a.parse(e,t,n)}var X={array:q,boolean:q,collator:null,format:null,image:null,literal:He,number:q,"number-format":null,object:q,string:q,"to-boolean":J,"to-color":J,"to-number":J,"to-string":J,typeof:Ue,accumulated:null,"feature-state":null,"geometry-type":oe,id:ae,"line-progress":null,properties:se,at:we,get:Te,has:Ee,in:De,"index-of":Oe,length:ke,slice:Ae,"!":me,"!=":le,"<":ue,"<=":de,"==":ce,">":fe,">=":pe,all:he,any:ge,case:ve,coalesce:ye,match:be,within:null,interpolate:U,"interpolate-hcl":U,"interpolate-lab":U,step:xe,let:Se,var:Ce,concat:Re,downcase:K,"is-supported-script":null,"resolved-locale":null,upcase:K,rgb:ze,rgba:Be,"to-rgba":Ve,"-":Me,"*":Ne,"/":Pe,"%":Fe,"^":Ie,"+":Le,abs:G,acos:G,asin:G,atan:G,ceil:G,cos:G,e:G,floor:G,ln:G,ln2:G,log10:G,log2:G,max:G,min:G,pi:G,round:G,sin:G,sqrt:G,tan:G,zoom:V,"heatmap-density":null,"has-id":je,none:_e},We=class e{constructor(e){this._expression=e}filter(e,t){if(!this._expression)return!0;try{return this._expression.evaluate(e,t)}catch(e){return console.log(e.message),!0}}static createFilter(t){if(!t)return null;this.isLegacyFilter(t)&&(t=this.convertLegacyFilter(t));try{let n=Y(t,null,M);return new e(n)}catch(e){return console.log(e.message),null}}static isLegacyFilter(e){if(!Array.isArray(e)||e.length===0)return!0;switch(e[0]){case`==`:case`!=`:case`>`:case`<`:case`>=`:case`<=`:return e.length===3&&typeof e[1]==`string`&&!Array.isArray(e[2]);case`in`:return e.length>=3&&typeof e[1]==`string`&&!Array.isArray(e[2]);case`!in`:case`none`:case`!has`:return!0;case`any`:case`all`:for(let t=1;t<e.length;t++)if(this.isLegacyFilter(e[t]))return!0;return!1;case`has`:return e.length===2&&(e[1]===`$id`||e[1]===`$type`);default:return!1}}static convertLegacyFilter(t){if(!Array.isArray(t)||t.length===0)return!0;let n=t[0];if(t.length===1)return n!==`any`;switch(n){case`==`:return e.convertComparison(`==`,t[1],t[2]);case`!=`:return e.negate(e.convertComparison(`==`,t[1],t[2]));case`>`:case`<`:case`>=`:case`<=`:return e.convertComparison(n,t[1],t[2]);case`in`:return e.convertIn(t[1],t.slice(2));case`!in`:return e.negate(e.convertIn(t[1],t.slice(2)));case`any`:case`all`:case`none`:return e.convertCombining(n,t.slice(1));case`has`:return e.convertHas(t[1]);case`!has`:return e.negate(e.convertHas(t[1]));default:throw Error(`Unexpected legacy filter.`)}}static convertComparison(e,t,n){switch(t){case`$type`:return[e,[`geometry-type`],n];case`$id`:return[e,[`id`],n];default:return[e,[`get`,t],n]}}static convertIn(e,t){switch(e){case`$type`:return[`in`,[`geometry-type`],[`literal`,t]];case`$id`:return[`in`,[`id`],[`literal`,t]];default:return[`in`,[`get`,e],[`literal`,t]]}}static convertHas(e){switch(e){case`$type`:return!0;case`$id`:return[`has-id`];default:return[`has`,e]}}static convertCombining(e,t){return[e].concat(t.map(this.convertLegacyFilter))}static negate(e){return[`!`,e]}},Z=class{static{this.backgroundLayoutDefinition={visibility:{type:`enum`,values:[`visible`,`none`],default:0}}}static{this.fillLayoutDefinition={visibility:{type:`enum`,values:[`visible`,`none`],default:0}}}static{this.lineLayoutDefinition={visibility:{type:`enum`,values:[`visible`,`none`],default:0},"line-cap":{type:`enum`,values:[`butt`,`round`,`square`],default:0},"line-join":{type:`enum`,values:[`bevel`,`round`,`miter`],default:2},"line-miter-limit":{type:`number`,default:2},"line-round-limit":{type:`number`,default:1.05}}}static{this.symbolLayoutDefinition={visibility:{type:`enum`,values:[`visible`,`none`],default:0},"symbol-avoid-edges":{type:`boolean`,default:!1},"symbol-placement":{type:`enum`,values:[`point`,`line`,`line-center`],default:0},"symbol-sort-key":{type:`number`,default:-1},"symbol-spacing":{type:`number`,minimum:1,default:250},"icon-allow-overlap":{type:`boolean`,default:!1},"icon-anchor":{type:`enum`,values:[`center`,`left`,`right`,`top`,`bottom`,`top-left`,`top-right`,`bottom-left`,`bottom-right`],default:0},"icon-ignore-placement":{type:`boolean`,default:!1},"icon-image":{type:`string`},"icon-keep-upright":{type:`boolean`,default:!1},"icon-offset":{type:`array`,value:`number`,length:2,default:[0,0]},"icon-optional":{type:`boolean`,default:!1},"icon-padding":{type:`number`,minimum:0,default:2},"icon-rotate":{type:`number`,default:0},"icon-rotation-alignment":{type:`enum`,values:[`map`,`viewport`,`auto`],default:2},"icon-size":{type:`number`,minimum:0,default:1},"text-allow-overlap":{type:`boolean`,default:!1},"text-anchor":{type:`enum`,values:[`center`,`left`,`right`,`top`,`bottom`,`top-left`,`top-right`,`bottom-left`,`bottom-right`],default:0},"text-field":{type:`string`},"text-font":{type:`array`,value:`string`,default:[`Open Sans Regular`,`Arial Unicode MS Regular`]},"text-ignore-placement":{type:`boolean`,default:!1},"text-justify":{type:`enum`,values:[`auto`,`left`,`center`,`right`],default:2},"text-keep-upright":{type:`boolean`,default:!0},"text-letter-spacing":{type:`number`,default:0},"text-line-height":{type:`number`,default:1.2},"text-max-angle":{type:`number`,minimum:0,default:45},"text-max-width":{type:`number`,minimum:0,default:10},"text-offset":{type:`array`,value:`number`,length:2,default:[0,0]},"text-optional":{type:`boolean`,default:!1},"text-padding":{type:`number`,minimum:0,default:2},"text-rotate":{type:`number`,default:0},"text-rotation-alignment":{type:`enum`,values:[`map`,`viewport`,`auto`],default:2},"text-size":{type:`number`,minimum:0,default:16},"text-transform":{type:`enum`,values:[`none`,`uppercase`,`lowercase`],default:0},"text-writing-mode":{type:`array`,value:`enum`,values:[`horizontal`,`vertical`],default:[0]}}}static{this.circleLayoutDefinition={visibility:{type:`enum`,values:[`visible`,`none`],default:0}}}static{this.backgroundPaintDefinition={"background-color":{type:`color`,default:[0,0,0,1]},"background-opacity":{type:`number`,minimum:0,maximum:1,default:1},"background-pattern":{type:`string`}}}static{this.fillPaintDefinition={"fill-antialias":{type:`boolean`,default:!0},"fill-color":{type:`color`,default:[0,0,0,1]},"fill-opacity":{type:`number`,minimum:0,maximum:1,default:1},"fill-outline-color":{type:`color`,default:[0,0,0,0]},"fill-pattern":{type:`string`},"fill-translate":{type:`array`,value:`number`,length:2,default:[0,0]},"fill-translate-anchor":{type:`enum`,values:[`map`,`viewport`],default:0}}}static{this.linePaintDefinition={"line-blur":{type:`number`,minimum:0,default:0},"line-color":{type:`color`,default:[0,0,0,1]},"line-dasharray":{type:`array`,value:`number`,default:[]},"line-gap-width":{type:`number`,minimum:0,default:0},"line-offset":{type:`number`,default:0},"line-opacity":{type:`number`,minimum:0,maximum:1,default:1},"line-pattern":{type:`string`},"line-translate":{type:`array`,value:`number`,length:2,default:[0,0]},"line-translate-anchor":{type:`enum`,values:[`map`,`viewport`],default:0},"line-width":{type:`number`,minimum:0,default:1}}}static{this.symbolPaintDefinition={"icon-color":{type:`color`,default:[0,0,0,1]},"icon-halo-blur":{type:`number`,minimum:0,default:0},"icon-halo-color":{type:`color`,default:[0,0,0,0]},"icon-halo-width":{type:`number`,minimum:0,default:0},"icon-opacity":{type:`number`,minimum:0,maximum:1,default:1},"icon-translate":{type:`array`,value:`number`,length:2,default:[0,0]},"icon-translate-anchor":{type:`enum`,values:[`map`,`viewport`],default:0},"text-color":{type:`color`,default:[0,0,0,1]},"text-halo-blur":{type:`number`,minimum:0,default:0},"text-halo-color":{type:`color`,default:[0,0,0,0]},"text-halo-width":{type:`number`,minimum:0,default:0},"text-opacity":{type:`number`,minimum:0,maximum:1,default:1},"text-translate":{type:`array`,value:`number`,length:2,default:[0,0]},"text-translate-anchor":{type:`enum`,values:[`map`,`viewport`],default:0}}}static{this.rasterPaintDefinition={"raster-opacity":{type:`number`,minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:`number`,default:0},"raster-brightness-min":{type:`number`,minimum:0,maximum:1,default:0},"raster-brightness-max":{type:`number`,minimum:0,maximum:1,default:1},"raster-saturation":{type:`number`,minimum:-1,maximum:1,default:0},"raster-contrast":{type:`number`,minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:`number`,minimum:0,default:300}}}static{this.circlePaintDefinition={"circle-blur":{type:`number`,minimum:0,default:0},"circle-color":{type:`color`,default:[0,0,0,1]},"circle-opacity":{type:`number`,minimum:0,maximum:1,default:1},"circle-radius":{type:`number`,minimum:0,default:5},"circle-stroke-color":{type:`color`,default:[0,0,0,1]},"circle-stroke-opacity":{type:`number`,minimum:0,maximum:1,default:1},"circle-stroke-width":{type:`number`,minimum:0,default:0},"circle-translate":{type:`array`,value:`number`,length:2,default:[0,0]},"circle-translate-anchor":{type:`enum`,values:[`map`,`viewport`],default:0}}}},Ge=class e{constructor(e,t){let n;switch(this.isDataDriven=!1,this.interpolator=null,e.type){case`number`:case`color`:n=!0;break;case`array`:n=e.value===`number`;break;default:n=!1}if((t==null||t===``&&e.type===`color`)&&(t=e.default),Array.isArray(t)&&t.length>0&&X[t[0]]){let n={number:A,color:N,string:j,boolean:M,enum:j};try{let r=e.type===`array`?I(n[e.value]||F,e.length):n[e.type],i=Y(t,null,r);this.getValue=this._buildExpression(i,e),this.isDataDriven=!0,i instanceof U&&i.input instanceof V&&(this.interpolator=i)}catch(t){console.log(t.message),this.getValue=this._buildSimple(e.default)}return}n&&t.type===`interval`&&(n=!1);let r=t?.stops&&t.stops.length>0;if(r)for(let n of t.stops)n[1]=this._validate(n[1],e);if(this.isDataDriven=!!t&&!!t.property,this.isDataDriven)if(t.default!==void 0&&(t.default=this._validate(t.default,e)),r)switch(t.type){case`identity`:this.getValue=this._buildIdentity(t,e);break;case`categorical`:this.getValue=this._buildCategorical(t,e);break;default:this.getValue=n?this._buildInterpolate(t,e):this._buildInterval(t,e)}else this.getValue=this._buildIdentity(t,e);else r?this.getValue=n?this._buildZoomInterpolate(t):this._buildZoomInterval(t):(t=this._validate(t,e),this.getValue=this._buildSimple(t))}_validate(t,n){if(n.type===`number`){if(n.minimum!=null&&t<n.minimum)return n.minimum;if(n.maximum!=null&&t>n.maximum)return n.maximum}else n.type===`color`?t=e._parseColor(t):n.type===`enum`?typeof t==`string`&&(t=n.values.indexOf(t)):n.type===`array`&&n.value===`enum`?t=t.map(e=>typeof e==`string`?n.values.indexOf(e):e):n.type===`string`&&(t=B(t));return t}_buildSimple(e){return()=>e}_buildExpression(e,t){return(n,r)=>{try{let i=e.evaluate(r,n);return i===void 0?t.default:this._validate(i,t)}catch(e){return console.log(e.message),t.default}}}_buildIdentity(e,t){return(n,r)=>{let i;return r&&(i=r.values[e.property]),i!==void 0&&(i=this._validate(i,t)),i??(e.default===void 0?t.default:e.default)}}_buildCategorical(e,t){return(n,r)=>{let i;return r&&(i=r.values[e.property]),i=this._categorical(i,e.stops),i===void 0?e.default===void 0?t.default:e.default:i}}_buildInterval(e,t){return(n,r)=>{let i;return r&&(i=r.values[e.property]),typeof i==`number`?this._interval(i,e.stops):e.default===void 0?t.default:e.default}}_buildInterpolate(e,t){return(n,r)=>{let i;return r&&(i=r.values[e.property]),typeof i==`number`?this._interpolate(i,e.stops,e.base||1):e.default===void 0?t.default:e.default}}_buildZoomInterpolate(e){return t=>this._interpolate(t,e.stops,e.base||1)}_buildZoomInterval(e){return t=>this._interval(t,e.stops)}_categorical(e,t){let n=t.length;for(let r=0;r<n;r++)if(t[r][0]===e)return t[r][1]}_interval(e,t){let n=t.length,r=0;for(let i=0;i<n&&t[i][0]<=e;i++)r=i;return t[r][1]}_interpolate(e,t,n){let r,i,a=t.length;for(let n=0;n<a;n++){let a=t[n];if(!(a[0]<=e)){i=a;break}r=a}if(r&&i){let t=i[0]-r[0],a=e-r[0],o=n===1?a/t:(n**a-1)/(n**t-1);if(Array.isArray(r[1])){let e=r[1],t=i[1],n=[];for(let r=0;r<e.length;r++)n.push(f(e[r],t[r],o));return n}return f(r[1],i[1],o)}return r?r[1]:i?i[1]:void 0}static _isEmpty(e){for(let t in e)if(e.hasOwnProperty(t))return!1;return!0}static _parseColor(e){return Array.isArray(e)?e:typeof e==`string`?a(e)??void 0:e instanceof i&&!this._isEmpty(e)?i.toUnitRGBA(e):void 0}},Ke=class{constructor(e,t,n,r,i,a){this.layer=e,this.feature=t,this.bounds=n,this.normalizationRatio=r,this.normalizationOffsetX=i,this.normalizationOffsetY=a}},Q=class{constructor(e,t,n,r){switch(this.type=e,this.typeName=t.type,this.id=t.id,this.source=t.source,this.sourceLayer=t[`source-layer`],this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,this.filter=t.filter,this.layout=t.layout,this.paint=t.paint,this.z=n,this.uid=r,e){case 0:this._layoutDefinition=Z.backgroundLayoutDefinition,this._paintDefinition=Z.backgroundPaintDefinition;break;case 1:this._layoutDefinition=Z.fillLayoutDefinition,this._paintDefinition=Z.fillPaintDefinition;break;case 2:this._layoutDefinition=Z.lineLayoutDefinition,this._paintDefinition=Z.linePaintDefinition;break;case 3:this._layoutDefinition=Z.symbolLayoutDefinition,this._paintDefinition=Z.symbolPaintDefinition;break;case 4:this._layoutDefinition=Z.circleLayoutDefinition,this._paintDefinition=Z.circlePaintDefinition}this._layoutProperties=this._parseLayout(this.layout),this._paintProperties=this._parsePaint(this.paint)}getFeatureFilter(){return this._featureFilter===void 0?this._featureFilter=We.createFilter(this.filter):this._featureFilter}getLayoutProperty(e){return this._layoutProperties[e]}getPaintProperty(e){return this._paintProperties[e]}getLayoutValue(e,t,n){let r,i=this._layoutProperties[e];return i&&(r=i.getValue(t,n)),r===void 0&&(r=this._layoutDefinition[e].default),r}getPaintValue(e,t,n){let r,i=this._paintProperties[e];return i&&(r=i.getValue(t,n)),r===void 0&&(r=this._paintDefinition[e].default),r}isPainterDataDriven(){let e=this._paintProperties;if(e){for(let t in e)if(e[t].isDataDriven)return!0}return!1}isIntersectingFeature(e,t,n,r,i,a,o){return!1}getFeatureInflatedBounds(e,t,n,r){return null}_parseLayout(e){let t={};for(let n in e){let r=this._layoutDefinition[n];r&&(t[n]=new Ge(r,e[n]))}return t}_parsePaint(e){let t={};for(let n in e){let r=this._paintDefinition[n];r&&(t[n]=new Ge(r,e[n]))}return t}computeAttributesKey(e,t,n,r){let i=0,a=0;for(let e of t){let t=3;if(!e||e!==r){let{isLayout:r,isOptional:i}=n[e],a=r?this.getLayoutProperty(e):this.getPaintProperty(e);t=a?.interpolator?2:a?.isDataDriven?1:i&&!a?3:0}a|=t<<i,i+=2}return a<<3|e}},qe=class extends Q{constructor(e,t,n,r){super(e,t,n,r),this.backgroundMaterial=new b(this.computeAttributesKey(0,b.ATTRIBUTES,b.ATTRIBUTES_INFO))}},Je=class extends Q{constructor(e,t,n,r){super(e,t,n,r);let i=this.getPaintProperty(`fill-color`),a=this.getPaintProperty(`fill-opacity`),o=this.getPaintProperty(`fill-pattern`);this.hasDataDrivenColor=i?.isDataDriven,this.hasDataDrivenOpacity=a?.isDataDriven,this.hasDataDrivenFill=this.hasDataDrivenColor||this.hasDataDrivenOpacity||o?.isDataDriven;let s=this.getPaintProperty(`fill-outline-color`);this.outlineUsesFillColor=!s,this.hasDataDrivenOutlineColor=s?.isDataDriven,this.hasDataDrivenOutline=s?s.isDataDriven:!!i&&i.isDataDriven,this.hasDataDrivenOutline=(s?this.hasDataDrivenOutlineColor:this.hasDataDrivenColor)||this.hasDataDrivenOpacity,this.fillMaterial=new S(this.computeAttributesKey(1,S.ATTRIBUTES,S.ATTRIBUTES_INFO)),this.outlineMaterial=new C(this.computeAttributesKey(2,this.outlineUsesFillColor?C.ATTRIBUTES_FILL:C.ATTRIBUTES_OUTLINE,this.outlineUsesFillColor?C.ATTRIBUTES_INFO_FILL:C.ATTRIBUTES_INFO_OUTLINE),this.outlineUsesFillColor)}getFeatureInflatedBounds(e,t,n,r){let i=$(e);if(!i)return null;let a=this.getPaintValue(`fill-translate`,t,e),o=r*Math.max(a[0],a[1]);return i[0]-=o,i[2]-=o,i[1]+=o,i[3]+=o,i}isIntersectingFeature(e,t,n,r,i,a,o){let s=r.getGeometry();if(!s)return!1;let c=8/o.normalizationRatio;e=e/o.normalizationRatio+o.normalizationOffsetX,t=t/o.normalizationRatio+o.normalizationOffsetY;let l=d(this.getPaintValue(`fill-translate`,i,r),this.getPaintValue(`fill-translate-anchor`,i,r),a,8);return e-=c*l.x,t-=c*l.y,!!h(e,t,s)||p(e,t,s,c*n)}},Ye=class extends Q{constructor(e,t,n,r){super(e,t,n,r);let i=this.getPaintProperty(`line-pattern`);if(this.lineMaterial=new w(this.computeAttributesKey(3,w.ATTRIBUTES,w.ATTRIBUTES_INFO,i?`line-dasharray`:``)),this.hasDataDrivenLine=this.getPaintProperty(`line-blur`)?.isDataDriven||this.getPaintProperty(`line-color`)?.isDataDriven||this.getPaintProperty(`line-gap-width`)?.isDataDriven||this.getPaintProperty(`line-offset`)?.isDataDriven||this.getPaintProperty(`line-opacity`)?.isDataDriven||this.getPaintProperty(`line-pattern`)?.isDataDriven||this.getPaintProperty(`line-dasharray`)?.isDataDriven||this.getLayoutProperty(`line-cap`)?.isDataDriven||this.getPaintProperty(`line-width`)?.isDataDriven,this.canUseThinTessellation=!1,!this.hasDataDrivenLine){let e=this.getPaintProperty(`line-width`);if(!e||typeof e==`number`&&.5*e<1.05){let e=this.getPaintProperty(`line-offset`);(!e||typeof e==`number`&&e===0)&&(this.canUseThinTessellation=!0)}}}getDashKey(e,t){let n;switch(t){case 0:default:n=`Butt`;break;case 1:n=`Round`;break;case 2:n=`Square`}return`dasharray-[${e.toString()}]-${n}`}getFeatureInflatedBounds(e,t,n,r){let i=$(e);if(!i)return null;let a=this.getPaintValue(`line-translate`,t,e),o=r*Math.max(a[0],a[1]);i[0]-=o,i[2]-=o,i[1]+=o,i[3]+=o;let s=r*Math.abs(this.getPaintValue(`line-offset`,t,e)||0),c=r*(this.getPaintValue(`line-width`,t,e)/2);return i[0]-=s+c,i[1]-=s+c,i[2]+=s+c,i[3]+=s+c,i}isIntersectingFeature(e,t,n,r,i,a,o){let s=r.getGeometry();if(!s)return!1;let c=8/o.normalizationRatio;e=e/o.normalizationRatio+o.normalizationOffsetX,t=t/o.normalizationRatio+o.normalizationOffsetY;let l=d(this.getPaintValue(`line-translate`,i,r),this.getPaintValue(`line-translate-anchor`,i,r),a,8);e-=c*l.x,t-=c*l.y;let u=c*this.getPaintValue(`line-offset`,i,r)||0;u!==0&&(s=m(s,-u));let f=this.getPaintValue(`line-width`,i,r);return p(e,t,s,c*(n+f/2))}},Xe=class extends Q{constructor(e,t,n,r){super(e,t,n,r),this.iconMaterial=new D(this.computeAttributesKey(4,D.ATTRIBUTES,D.ATTRIBUTES_INFO)),this.textMaterial=new O(this.computeAttributesKey(6,O.ATTRIBUTES,O.ATTRIBUTES_INFO)),this.hasDataDrivenIcon=this.getPaintProperty(`icon-color`)?.isDataDriven||this.getPaintProperty(`icon-halo-blur`)?.isDataDriven||this.getPaintProperty(`icon-halo-color`)?.isDataDriven||this.getPaintProperty(`icon-halo-width`)?.isDataDriven||this.getPaintProperty(`icon-opacity`)?.isDataDriven||this.getLayoutProperty(`icon-size`)?.isDataDriven,this.hasDataDrivenText=this.getPaintProperty(`text-color`)?.isDataDriven||this.getPaintProperty(`text-halo-blur`)?.isDataDriven||this.getPaintProperty(`text-halo-color`)?.isDataDriven||this.getPaintProperty(`text-halo-width`)?.isDataDriven||this.getPaintProperty(`text-opacity`)?.isDataDriven||this.getLayoutProperty(`text-size`)?.isDataDriven}},Ze=class extends Q{constructor(e,t,n,r){super(e,t,n,r),this.circleMaterial=new x(this.computeAttributesKey(5,x.ATTRIBUTES,x.ATTRIBUTES_INFO))}getFeatureInflatedBounds(e,t,n,r){let i=$(e);if(!i)return null;let a=this.getPaintValue(`circle-translate`,t,e),o=Math.max(a[0],a[1]);i[0]-=o,i[2]-=o,i[1]+=o,i[3]+=o;let s=r*(8*(this.getPaintValue(`circle-radius`,t,e)+this.getPaintValue(`circle-stroke-width`,t,e))/2);return i[0]-=s,i[1]-=s,i[2]+=s,i[3]+=s,i}isIntersectingFeature(e,t,n,r,i,a,o){let s=r.getGeometry();if(!s)return!1;let c=8/o.normalizationRatio;e=e/o.normalizationRatio+o.normalizationOffsetX,t=t/o.normalizationRatio+o.normalizationOffsetY,n*=c;let l=d(this.getPaintValue(`circle-translate`,i,r),this.getPaintValue(`circle-translate-anchor`,i,r),a,c),u=c*(this.getPaintValue(`circle-radius`,i,r)+this.getPaintValue(`circle-stroke-width`,i,r)),f,p;for(let r of s)if(r){for(let i of r)if(f=i.x+l.x,p=i.y+l.y,Math.sqrt((e-f)*(e-f)+(t-p)*(t-p))-n<=u)return!0}return!1}},Qe=class{constructor(e,t,n){let r;this.allowOverlap=e.getLayoutValue(`icon-allow-overlap`,t),this.ignorePlacement=e.getLayoutValue(`icon-ignore-placement`,t),this.keepUpright=e.getLayoutValue(`icon-keep-upright`,t),this.optional=e.getLayoutValue(`icon-optional`,t),this.rotationAlignment=e.getLayoutValue(`icon-rotation-alignment`,t),this.rotationAlignment===2&&(this.rotationAlignment=n?0:1),r=e.getLayoutProperty(`icon-anchor`),r?.isDataDriven?this._anchorProp=r:this.anchor=e.getLayoutValue(`icon-anchor`,t),r=e.getLayoutProperty(`icon-offset`),r?.isDataDriven?this._offsetProp=r:this.offset=e.getLayoutValue(`icon-offset`,t),r=e.getLayoutProperty(`icon-padding`),r?.isDataDriven?this._paddingProp=r:this.padding=e.getLayoutValue(`icon-padding`,t),r=e.getLayoutProperty(`icon-rotate`),r?.isDataDriven?this._rotateProp=r:this.rotate=e.getLayoutValue(`icon-rotate`,t),r=e.getLayoutProperty(`icon-size`),r?.isDataDriven?this._sizeProp=r:this.size=e.getLayoutValue(`icon-size`,t)}update(e,t){this._anchorProp&&(this.anchor=this._anchorProp.getValue(e,t)),this._offsetProp&&(this.offset=this._offsetProp.getValue(e,t)),this._paddingProp&&(this.padding=this._paddingProp.getValue(e,t)),this._rotateProp&&(this.rotate=this._rotateProp.getValue(e,t)),this._sizeProp&&(this.size=this._sizeProp.getValue(e,t))}},$e=class{constructor(e,t,n){let r;this.allowOverlap=e.getLayoutValue(`text-allow-overlap`,t),this.ignorePlacement=e.getLayoutValue(`text-ignore-placement`,t),this.keepUpright=e.getLayoutValue(`text-keep-upright`,t),this.optional=e.getLayoutValue(`text-optional`,t),this.rotationAlignment=e.getLayoutValue(`text-rotation-alignment`,t),this.rotationAlignment===2&&(this.rotationAlignment=n?0:1),r=e.getLayoutProperty(`text-anchor`),r?.isDataDriven?this._anchorProp=r:this.anchor=e.getLayoutValue(`text-anchor`,t),r=e.getLayoutProperty(`text-justify`),r?.isDataDriven?this._justifyProp=r:this.justify=e.getLayoutValue(`text-justify`,t),r=e.getLayoutProperty(`text-letter-spacing`),r?.isDataDriven?this._letterSpacingProp=r:this.letterSpacing=e.getLayoutValue(`text-letter-spacing`,t),r=e.getLayoutProperty(`text-line-height`),r?.isDataDriven?this._lineHeightProp=r:this.lineHeight=e.getLayoutValue(`text-line-height`,t),r=e.getLayoutProperty(`text-max-angle`),r?.isDataDriven?this._maxAngleProp=r:this.maxAngle=e.getLayoutValue(`text-max-angle`,t),r=e.getLayoutProperty(`text-max-width`),r?.isDataDriven?this._maxWidthProp=r:this.maxWidth=e.getLayoutValue(`text-max-width`,t),r=e.getLayoutProperty(`text-offset`),r?.isDataDriven?this._offsetProp=r:this.offset=e.getLayoutValue(`text-offset`,t),r=e.getLayoutProperty(`text-padding`),r?.isDataDriven?this._paddingProp=r:this.padding=e.getLayoutValue(`text-padding`,t),r=e.getLayoutProperty(`text-rotate`),r?.isDataDriven?this._rotateProp=r:this.rotate=e.getLayoutValue(`text-rotate`,t),r=e.getLayoutProperty(`text-size`),r?.isDataDriven?this._sizeProp=r:this.size=e.getLayoutValue(`text-size`,t),r=e.getLayoutProperty(`text-writing-mode`),r?.isDataDriven?this._writingModeProp=r:this.writingMode=e.getLayoutValue(`text-writing-mode`,t)}update(e,t){this._anchorProp&&(this.anchor=this._anchorProp.getValue(e,t)),this._justifyProp&&(this.justify=this._justifyProp.getValue(e,t)),this._letterSpacingProp&&(this.letterSpacing=this._letterSpacingProp.getValue(e,t)),this._lineHeightProp&&(this.lineHeight=this._lineHeightProp.getValue(e,t)),this._maxAngleProp&&(this.maxAngle=this._maxAngleProp.getValue(e,t)),this._maxWidthProp&&(this.maxWidth=this._maxWidthProp.getValue(e,t)),this._offsetProp&&(this.offset=this._offsetProp.getValue(e,t)),this._paddingProp&&(this.padding=this._paddingProp.getValue(e,t)),this._rotateProp&&(this.rotate=this._rotateProp.getValue(e,t)),this._sizeProp&&(this.size=this._sizeProp.getValue(e,t)),this._writingModeProp&&(this.writingMode=this._writingModeProp.getValue(e,t))}};function $(e){let t=e?.getGeometry();if(t==null)return null;let n=1/0,i=1/0,a=-1/0,o=-1/0;for(let e of t)if(e)for(let t of e)n=Math.min(n,t.x),i=Math.min(i,t.y),a=Math.max(a,t.x),o=Math.max(o,t.y);return r(n,i,a,o)}var et=class t{constructor(t,n=!0){if(this.backgroundBucketIds=[],this._uidToLayer=new Map,this._layerByName={},this._runningId=0,this._style=n?e(t):t,this._style.layers||(this._style.layers=[]),this.version=parseFloat(this._style.version),this.layers=this._style.layers.map((e,t,n)=>this._create(e,t,n)).filter(e=>!!e),this.layers)for(let e=0;e<this.layers.length;e++){let t=this.layers[e];this._layerByName[t.id]=t,this._uidToLayer.set(t.uid,t),t.type===0&&this.backgroundBucketIds.push(t.id)}this._identifyRefLayers()}getLayerStyleProperties(e,t){let n=this.getStyleLayerByUID(e),r=n?.getLayoutValue(`symbol-placement`,t)!==0,i=n?.getLayoutValue(`icon-rotation-alignment`,t);i===2&&(i=r?0:1);let a=n?.getLayoutValue(`text-rotation-alignment`,t);a===2&&(a=r?0:1);let o=n?.getPaintValue(`icon-translate`,t),s=n?.getPaintValue(`icon-translate-anchor`,t),c=n?.getPaintValue(`text-translate`,t),l=n?.getPaintValue(`text-translate-anchor`,t);return{geometryType:null,iconAllowOverlap:n?.getLayoutValue(`icon-allow-overlap`,t),iconIgnorePlacement:n?.getLayoutValue(`icon-ignore-placement`,t),textAllowOverlap:n?.getLayoutValue(`text-allow-overlap`,t),textIgnorePlacement:n?.getLayoutValue(`text-ignore-placement`,t),iconRotationAlignment:i,textRotationAlignment:a,iconTranslateAnchor:s,iconTranslate:o,textTranslateAnchor:l,textTranslate:c}}isPainterDataDriven(e){let t=this._layerByName[e];return!!t&&t.isPainterDataDriven()}getStyleLayerId(e){return e>=this.layers.length?null:this.layers[e].id}getStyleLayerByUID(e){return this._uidToLayer.get(e)??null}getStyleLayerIndex(e){let t=this._layerByName[e];return t?this.layers.indexOf(t):-1}setStyleLayer(e,n){if(!e?.id)return;let r=this._style;n!=null&&n>=this.layers.length&&(n=this.layers.length-1);let i,a=!0,o=this._layerByName[e.id];if(o){let s=this.layers.indexOf(o);n||=s,n===s?(a=!1,i=t._recreateLayer(e,o),this.layers[n]=i,r.layers[n]=e):(this.layers.splice(s,1),r.layers.splice(s,1),i=this._create(e,n,this.layers),this.layers.splice(n,0,i),r.layers.splice(n,0,e))}else i=this._create(e,n,this.layers),!n||n>=this.layers.length?(this.layers.push(i),r.layers.push(e)):(this.layers.splice(n,0,i),r.layers.splice(n,0,e));this._layerByName[e.id]=i,this._uidToLayer.set(i.uid,i),a&&this._recomputeZValues(),this._identifyRefLayers()}getStyleLayer(e){let t=this._layerByName[e];return t?{type:t.typeName,id:t.id,source:t.source,"source-layer":t.sourceLayer,minzoom:t.minzoom,maxzoom:t.maxzoom,filter:t.filter,layout:t.layout,paint:t.paint}:null}deleteStyleLayer(e){let t=this._layerByName[e];if(t){delete this._layerByName[e],this._uidToLayer.delete(t.uid);let n=this.layers.indexOf(t);this.layers.splice(n,1),this._style.layers.splice(n,1),this._recomputeZValues(),this._identifyRefLayers()}}getLayerById(e){return this._layerByName[e]}getLayoutProperties(e){let t=this._layerByName[e];return t?t.layout:null}getPaintProperties(e){let t=this._layerByName[e];return t?t.paint:null}setPaintProperties(e,n){let r=this._layerByName[e];if(!r)return;let i={type:r.typeName,id:r.id,source:r.source,"source-layer":r.sourceLayer,minzoom:r.minzoom,maxzoom:r.maxzoom,filter:r.filter,layout:r.layout,paint:n},a=t._recreateLayer(i,r),o=this.layers.indexOf(r);this.layers[o]=a,this._style.layers[o].paint=n,this._layerByName[r.id]=a,this._uidToLayer.set(r.uid,a)}setLayoutProperties(e,n){let r=this._layerByName[e];if(!r)return;let i={type:r.typeName,id:r.id,source:r.source,"source-layer":r.sourceLayer,minzoom:r.minzoom,maxzoom:r.maxzoom,filter:r.filter,layout:n,paint:r.paint},a=t._recreateLayer(i,r),o=this.layers.indexOf(r);this.layers[o]=a,this._style.layers[o].layout=n,this._layerByName[r.id]=a,this._uidToLayer.set(r.uid,a)}setStyleLayerVisibility(e,n){let r=this._layerByName[e];if(!r)return;let i=r.layout||{};i.visibility=n;let a={type:r.typeName,id:r.id,source:r.source,"source-layer":r.sourceLayer,minzoom:r.minzoom,maxzoom:r.maxzoom,filter:r.filter,layout:i,paint:r.paint},o=t._recreateLayer(a,r),s=this.layers.indexOf(r);this.layers[s]=o,this._style.layers[s].layout=i,this._layerByName[r.id]=o,this._uidToLayer.set(r.uid,o)}getStyleLayerVisibility(e){let t=this._layerByName[e];return t?t.layout?.visibility??`visible`:`none`}_recomputeZValues(){let e=this.layers,t=1/(e.length+1);for(let n=0;n<e.length;n++)e[n].z=1-(1+n)*t}_identifyRefLayers(){let e=[],t=[],n=0;for(let r of this.layers){let i=r.layout;if(r.type===1){let t=r,a=r.source+`|`+r.sourceLayer;a+=`|`+(i?.visibility??``),a+=`|`+r.minzoom,a+=`|`+r.maxzoom,a+=`|`+JSON.stringify(r.filter),(t.hasDataDrivenFill||t.hasDataDrivenOutline)&&(a+=`|`+n),e.push({key:a,layer:r})}else if(r.type===2){let e=r,a=r.paint,o=a!=null&&(a[`line-pattern`]!=null||a[`line-dasharray`]!=null),s=r.source+`|`+r.sourceLayer;s+=`|`+(i?.visibility??``),s+=`|`+r.minzoom,s+=`|`+r.maxzoom,s+=`|`+JSON.stringify(r.filter),s+=`|`+(i===void 0?``:i[`line-cap`]),s+=`|`+(i===void 0?``:i[`line-join`]),(e.hasDataDrivenLine||o)&&(s+=`|`+n),t.push({key:s,layer:r})}++n}this._assignRefLayers(e),this._assignRefLayers(t)}_assignRefLayers(e){let t,n;e.sort((e,t)=>e.key<t.key?-1:e.key>t.key?1:0);let r=e.length;for(let i=0;i<r;i++){let a=e[i];if(a.key===t)a.layer.refLayerId=n;else if(t=a.key,n=a.layer.id,a.layer.type===1){if(!a.layer.getPaintProperty(`fill-outline-color`))for(let o=i+1;o<r;o++){let r=e[o];if(r.key!==t)break;if(r.layer.getPaintProperty(`fill-outline-color`)){e[i]=r,e[o]=a,n=r.layer.id;break}}}else if(a.layer.type===2){let o=a.layer;for(let s=i+1;s<r;s++){let r=e[s];if(r.key!==t)break;let c=r.layer;(o.canUseThinTessellation&&!c.canUseThinTessellation||!o.canUseThinTessellation&&(c.getPaintProperty(`line-pattern`)||c.getPaintProperty(`line-dasharray`)))&&(o=c,e[i]=r,e[s]=a,n=r.layer.id)}}}}_create(e,t,n){let r=1-(1+t)*(1/(n.length+1)),i=this._runningId++;switch(e.type){case`background`:return new qe(0,e,r,i);case`fill`:return new Je(1,e,r,i);case`line`:return new Ye(2,e,r,i);case`symbol`:return new Xe(3,e,r,i);case`raster`:return console.warn(`Unsupported vector tile raster layer ${e.id}`),null;case`circle`:return new Ze(4,e,r,i)}return null}static _recreateLayer(e,t){switch(e.type){case`background`:return new qe(0,e,t.z,t.uid);case`fill`:return new Je(1,e,t.z,t.uid);case`line`:return new Ye(2,e,t.z,t.uid);case`symbol`:return new Xe(3,e,t.z,t.uid);case`raster`:return console.warn(`Unsupported vector tile raster layer ${e.id}`),null;case`circle`:return new Ze(4,e,t.z,t.uid)}return null}};export{te as a,Qe as i,Ke as n,$e as r,et as t};