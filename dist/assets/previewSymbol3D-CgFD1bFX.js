import{_E as e,eg as t,ff as n,lf as r,nC as i,vE as a}from"./index-BqmCqmfp.js";import{f as o,t as s}from"./colorUtils-uG2qTogT.js";import{a as c,n as l,t as u}from"./gfxUtils-DZoKCRMw.js";import{o as d,s as f}from"./utils-5jlQHYup.js";import{n as p,t as m}from"./renderUtils-Ckhxu64U.js";import{a as h,c as g,d as _,f as v,l as y,n as b,o as x,r as S,s as C,t as w,u as T}from"./previewUtils-CT5v5cXU.js";import{n as E}from"./webStyleSymbolUtils-Vsg9bxK_.js";var D=22,O=120,k=80,A=50,j=20;function M(e){let n=e.outline,r=e.material==null?null:e.material.color,i=r==null?null:r.toHex();if(n==null||`pattern`in n&&n.pattern!=null&&n.pattern.type===`style`&&n.pattern.style===`none`)return e.type===`fill`&&i===`#ffffff`?{color:`#bdc3c7`,width:.75}:null;let a=t(n.size)||0;return{color:`rgba(`+(n.color==null?`255,255,255,1`:n.color.toRgba())+`)`,width:Math.min(a,k),style:`pattern`in n&&n.pattern!=null&&n.pattern.type===`style`?c(n.pattern.style):null,join:`butt`,cap:`patternCap`in n?n.patternCap:`butt`}}async function N(e,t){if(e.thumbnail?.url)return e.thumbnail.url;if(t.type===`icon`&&t?.resource?.href)return d(t);let n=i(`esri/images/Legend/legend3dsymboldefault.png`);if(e.styleOrigin&&(e.styleOrigin.styleName||e.styleOrigin.styleUrl)){let t=await E(e.styleOrigin,{portal:e.styleOrigin.portal}).catch(()=>null);if(t&&`thumbnail`in t&&t.thumbnail?.url)return t.thumbnail.url}return n}function P(e,t=1){let n=e.a,r=s(e),i=r.h,a=r.s/t,c=100-(100-r.v)/t,{r:l,g:u,b:d}=o({h:i,s:a,v:c});return[l,u,d,n]}function F(e){return e.type===`water`?e.color==null?null:e.color:e.material?.color==null?null:e.material.color}function I(e,t=0){let n=F(e);if(!n){if(e.type===`fill`)return null;let n=u.r,r=v(n,t);return[r,r,r,100]}let r=n.toRgba();for(let e=0;e<3;e++)r[e]=v(r[e],t);return r}async function L(e,t){let n=e.style;return n===`none`?null:{type:`pattern`,x:0,y:0,src:await l(i(`esri/symbols/patterns/${n}.png`),t.toCss(!0)),width:5,height:5}}function R(e){return e.outline?M(e):{color:`rgba(0, 0, 0, 1)`,width:1.5}}function z(e,t){let n=F(e);if(!n)return null;let r=`rgba(`;return r+=v(n.r,t)+`,`,r+=v(n.g,t)+`,`,r+=v(n.b,t)+`,`,r+n.a+`);`}function B(e,n){let r=e.edges;return!r||!r.color||!r.size?null:{color:r.color.toCss(!0),width:Math.min(t(r.size),n,k),join:`round`}}function V(e,n){let r=z(e,n);if(!r||`pattern`in e&&e.pattern!=null&&e.pattern.type===`style`&&e.pattern.style===`none`)return null;let i={color:r,width:Math.min(e.size?t(e.size):.75,k)};return`pattern`in e&&e.pattern?.type===`style`&&(i.style=c(e.pattern.style)),`cap`in e&&e.cap&&(i.cap=e.cap),`join`in e&&e.join&&(i.join=e.join===`miter`?t(2):e.join),i}function H(e,t,n){let r=n==null?0:.75*n;return{type:`linear`,x1:r?.25*r:0,y1:r?.5*r:0,x2:r||4,y2:r?.5*r:4,colors:[{color:e,offset:0},{color:t,offset:1}]}}function U(e){let t=e.depth,n=e.height,r=e.width;return r!==0&&t!==0&&n!==0&&r===t&&r!=null&&n!=null&&r<n}function W(e,t,n){let r=[];if(!e)return r;switch(e.type){case`icon`:{let n=t,i=t;switch(e.resource?.primitive??`circle`){case`circle`:r.push({shape:{type:`circle`,cx:0,cy:0,r:.5*t},fill:I(e,0),stroke:M(e)});break;case`square`:r.push({shape:{type:`path`,path:[{command:`M`,values:[0,i]},{command:`L`,values:[0,0]},{command:`L`,values:[n,0]},{command:`L`,values:[n,i]},{command:`Z`,values:[]}]},fill:I(e,0),stroke:M(e)});break;case`triangle`:r.push({shape:{type:`path`,path:[{command:`M`,values:[0,i]},{command:`L`,values:[.5*n,0]},{command:`L`,values:[n,i]},{command:`Z`,values:[]}]},fill:I(e,0),stroke:M(e)});break;case`cross`:r.push({shape:{type:`path`,path:[{command:`M`,values:[.5*n,0]},{command:`L`,values:[.5*n,i]},{command:`M`,values:[0,.5*i]},{command:`L`,values:[n,.5*i]}]},stroke:R(e)});break;case`x`:r.push({shape:{type:`path`,path:[{command:`M`,values:[0,0]},{command:`L`,values:[n,i]},{command:`M`,values:[n,0]},{command:`L`,values:[0,i]}]},stroke:R(e)});break;case`kite`:r.push({shape:{type:`path`,path:[{command:`M`,values:[0,.5*i]},{command:`L`,values:[.5*n,0]},{command:`L`,values:[n,.5*i]},{command:`L`,values:[.5*n,i]},{command:`Z`,values:[]}]},fill:I(e,0),stroke:M(e)})}break}case`object`:switch(e.resource?.primitive??`sphere`){case`cone`:{let i=H(I(e,0),I(e,-.6),n?j:t),a=C(t,n);r.push({shape:a[0],fill:i},{shape:a[1],fill:i});break}case`inverted-cone`:{let n=I(e,0),i=H(n,I(e,-.6),t),a=g(t);r.push({shape:a[0],fill:i},{shape:a[1],fill:n});break}case`cube`:{let i=y(t,n);r.push({shape:i[0],fill:I(e,0)},{shape:i[1],fill:I(e,-.3)},{shape:i[2],fill:I(e,-.5)});break}case`cylinder`:{let i=H(I(e,0),I(e,-.6),n?j:t),a=w(t,n);r.push({shape:a[0],fill:i},{shape:a[1],fill:i},{shape:a[2],fill:I(e,0)});break}case`diamond`:{let n=h(t);r.push({shape:n[0],fill:I(e,-.3)},{shape:n[1],fill:I(e,0)},{shape:n[2],fill:I(e,-.3)},{shape:n[3],fill:I(e,-.7)});break}case`sphere`:{let n=H(I(e,0),I(e,-.6));n.x1=0,n.y1=0,n.x2=.25*t,n.y2=.25*t,r.push({shape:{type:`circle`,cx:0,cy:0,r:.5*t},fill:n});break}case`tetrahedron`:{let n=T(t);r.push({shape:n[0],fill:I(e,-.3)},{shape:n[1],fill:I(e,0)},{shape:n[2],fill:I(e,-.6)});break}}break}return r}function G(e){let n=typeof e?.size==`number`?e?.size:null;return n?t(n):null}function K(e){return e.type===`icon`?`multiply`:`tint`}async function q(e,n){let r=G(n),i=n?.maxSize?t(n.maxSize):null,o=n?.disableUpsampling??!1,s=e.symbolLayers,c=[],l=[],u=!1,d=0,f=0,h=0;s.forEach(a=>{if(a.type!==`icon`&&a.type!==`object`)return;a&&a.type===`icon`&&(h=Math.max(a.size&&t(a.size),h));let s=a.type===`icon`?a.size&&t(a.size):0,p=r||s?Math.ceil(Math.min(r||s,i||O)):D,g=a.type===`icon`?a.angle:null;if(n?.rotation!=null&&(g=(g??0)+n.rotation),l.push(g),a?.resource?.href){let t=N(e,a).then(e=>{let t=a?.material?.color,n=K(a);return m(e,p,t,n,o)}).then(e=>{let t=e.width,n=e.height;return d=Math.max(d,t),f=Math.max(f,n),g&&(u=!0),[{shape:{type:`image`,x:0,y:0,width:t,height:n,src:e.url},fill:null,stroke:null}]});c.push(t)}else{let e=p;a.type===`icon`&&r&&(e=p*(s/h));let t=n?.symbolConfig===`tall`||n?.symbolConfig?.isTall||a.type===`object`&&U(a);d=Math.max(d,t?j:e),f=Math.max(f,e),g&&a.resource?.primitive&&[`square`,`triangle`,`x`].includes(a.resource?.primitive)&&(u=!0),c.push(Promise.resolve(W(a,e,t)))}});let g=await Promise.allSettled(c),_=[];return g.forEach(e=>{e.status===`fulfilled`?_.push(e.value):e.reason&&a.getLogger(`esri.symbols.support.previewSymbol3D`).warn(`error while building swatchInfo!`,e.reason)}),p(_,[d,f],{node:n?.node,scale:!1,opacity:n?.opacity,ariaLabel:n?.ariaLabel,rotations:l,useRotationSize:u})}function J(e,n){let r=e.symbolLayers,i=[],a=f(e),o=G(n),s=(n?.maxSize?t(n.maxSize):null)||k,c,l=0,u=0;return r.forEach((e,t)=>{if(!e||e.type!==`line`&&e.type!==`path`)return;let n=[];switch(e.type){case`line`:{let r=V(e,0);if(r==null)break;let i=r?.width||0;t===0&&(c=i);let a=Math.min(o||i,s),d=t===0?a:o?a*(i/c):a,f=d>A/2?2*d:A;u=Math.max(u,d),l=Math.max(l,f),r.width=d,n.push({shape:{type:`path`,path:[{command:`M`,values:[0,.5*u]},{command:`L`,values:[l,.5*u]}]},stroke:r});break}case`path`:{let t=Math.min(o||D,s),r=I(e,0),i=I(e,-.2),a=z(e,-.4),c=a?{color:a,width:1}:{};if(e.profile===`quad`){let t=e.width,a=e.height,o=S(t&&a?t/a:1,a===0,t===0),s={...c,join:`bevel`};n.push({shape:o[0],fill:i,stroke:s},{shape:o[1],fill:i,stroke:s},{shape:o[2],fill:r,stroke:s})}else n.push({shape:_.pathSymbol3DLayer[0],fill:i,stroke:c},{shape:_.pathSymbol3DLayer[1],fill:r,stroke:c});u=Math.max(u,t),l=u}}i.push(n)}),Promise.resolve(p(i,[l,u],{node:n?.node,scale:a,opacity:n?.opacity,ariaLabel:n?.ariaLabel}))}async function Y(e,n){let r=e.type===`mesh-3d`,i=e.symbolLayers,a=G(n),o=n?.maxSize?t(n.maxSize):null,s=a||D,c=[],l=0,u=0,d=!1;for(let e=0;e<i.length;e++){let t=i.at(e),n=[];if(!r||t.type===`fill`){switch(t.type){case`fill`:{let e=Math.min(s,o||O);if(l=Math.max(l,e),u=Math.max(u,e),d=!0,r){let r=_.meshSymbol3DFill,i=z(t,-.4),a=B(t,.05*e)??(i?{join:`round`,color:i,width:1}:null);n.push({shape:r[0],fill:I(t,0),stroke:a},{shape:r[1],fill:I(t,-.2),stroke:a},{shape:r[2],fill:I(t,-.6),stroke:a})}else{let e=I(t,0),r=`pattern`in t?t.pattern:null,i=M(t),a=F(t);r!=null&&r.type===`style`&&r.style!==`solid`&&a&&(e=await L(r,a)),n.push({shape:_.fill[0],fill:e,stroke:i})}break}case`line`:{let e=V(t,0);if(e==null)break;let r={stroke:e,shape:_.fill[0]};l=Math.max(l,D),u=Math.max(u,D),n.push(r);break}case`extrude`:{let e=I(t,0),r=I(t,-.2),i=Math.min(s,o||O),a=x(i),c=D,d=.7*D+.5*i,f=B(t,.1*Math.min(c,d))??{join:`round`,...V(t,-.4),width:1};n.push({shape:a[0],fill:r,stroke:f},{shape:a[1],fill:r,stroke:f},{shape:a[2],fill:e,stroke:f}),l=Math.max(l,c),u=Math.max(u,d);break}case`water`:{let e=F(t),r=P(e),i=P(e,2),a=P(e,3),c=b();d=!0,n.push({shape:c[0],fill:r},{shape:c[1],fill:i},{shape:c[2],fill:a});let f=Math.min(s,o||O);l=Math.max(l,f),u=Math.max(u,f);break}}c.push(n)}}return p(c,[l,u],{node:n?.node,scale:d,opacity:n?.opacity,ariaLabel:n?.ariaLabel})}function X(t,n){if(t.symbolLayers.length===0)return Promise.reject(new e(`symbolPreview: renderPreviewHTML3D`,`No symbolLayers in the symbol.`));switch(t.type){case`point-3d`:return q(t,n);case`line-3d`:return J(t,n);case`polygon-3d`:case`mesh-3d`:return Y(t,n)}return Promise.reject(new e(`symbolPreview: swatchInfo3D`,`symbol not supported.`))}export{L as i,I as n,X as r,G as t};