const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/imageryUtils-Cn-r4wiv.js","assets/index-BqmCqmfp.js","assets/index-kIqmb12G.css","assets/originUtils-Xpg5-Q2D.js","assets/utils-yJnMCzaE.js","assets/saveUtils-DsVVlvmj.js","assets/datasetUtils-DSaKkE9z.js"])))=>i.map(i=>d[i]);
import{Ad as e,CD as t,Cw as n,Ea as r,Gi as i,J as a,Ji as o,Kb as s,Kw as c,L as l,La as u,MC as d,Mb as f,Q as p,Qw as m,Ra as h,Sw as g,Sx as _,X as v,Z as y,Zw as b,_E as x,ao as S,e_ as C,gp as w,kC as T,ka as E,rt as D,vE as O,zy as k}from"./index-BqmCqmfp.js";import"./QueueProcessor-C8_CgXms.js";import"./_commonjsHelpers-D6ht1XAa.js";import"./generateRendererUtils-BgK3c0Qk.js";import{d as A,p as j,r as M}from"./multidimensionalUtils-yEWHc_se.js";import{R as N,T as ee}from"./RasterSymbolizer-CkbjgVe_.js";import{t as te}from"./RasterJobHandlerMixin-CZVDgRFD.js";import"./pixelRangeUtils-DMjHgTK0.js";import"./colorUtils-uG2qTogT.js";import"./PixelBlock-CjVaas_l.js";import{d as ne,f as re}from"./rasterFieldUtils-BXl_hh-f.js";import{p as ie}from"./vectorFieldUtils-yzcuu25U.js";import"./datasetUtils-DSaKkE9z.js";import"./cimSymbolUtils-1FVTTBxd.js";import"./gfxUtils-DZoKCRMw.js";import"./utils-5jlQHYup.js";import"./dataUtils-lUZ4DUuE.js";import"./RawBlockCache-Dlb6yJNd.js";import"./rasterProjectionHelper-CyS9RtmF.js";import{a as P,c as F,f as ae,i as I,n as L,r as R,s as z,t as oe,u as se}from"./xmlUtilities-3WKOQFoW.js";import"./clipUtils-ZHQqHn8q.js";import"./rasterFunctionHelper-CMjb75WD.js";import{t as ce}from"./crsUtils-rYVz-Fwk.js";var le=Symbol(`isWCSGraphicOrigin`),B,ue=class extends u{get[(B=le,h)](){return this.layer}constructor(e){super(),this[B]=!0,this.type=`wcs`,this.layer=e}get id(){return this.layer.id}};function V(e){return e.endsWith(`?`)?e.slice(0,-1):e}function H(e){return e.filter(({coverageSubType:e})=>e==null||e===``||/^rectified(grid|dataset)/i.test(e))}function de(e){let t=F(e,`Service/name`),n=L(e,`Capability`),r=L(n,`GetCapabilities/Get/OnlineResource`)?.getAttribute(`xlink:href`)??``,i=L(n,`DescribeCoverage/Get/OnlineResource`)?.getAttribute(`xlink:href`)??``,a=L(n,`GetCoverage/Get/OnlineResource`)?.getAttribute(`xlink:href`)??``,o={getCapabilities:V(r),describeCoverage:V(i),getCoverage:V(a)},s=P(e,`CoverageOfferingBrief`),c=[];for(let e=0;e<s.length;e++){let t=s[e],n=F(t,`name`),r=P(t,`pos`),i=z(r[0]),a=z(r[1]),o=new _({xmin:i[0],ymin:i[1],xmax:a[0],ymax:a[1],spatialReference:{wkid:4326}});c.push({id:n,lonLatEnvelope:o})}return{name:t,onlineResources:o,coverages:c,gridCoverages:H(c),supportedVersions:[`1.0.0`],version:`1.0.0`}}function fe(e){let t={};for(let n=0;n<e.childNodes.length;n++){let r=e.childNodes[n];if(r.nodeType!==1)continue;let i=oe(r).toLowerCase();switch(i){case`title`:case`abstract`:t[i]=F(r);break;case`identifier`:t.id=F(r);break;case`wgs84boundingbox`:{let e=z(r,`LowerCorner`),n=z(r,`UpperCorner`);t.lonLatEnvelope=new _({xmin:e[0],ymin:e[1],xmax:n[0],ymax:n[1],spatialReference:{wkid:4326}})}break;case`coveragesummary`:t.coverageSummaries=t.coverageSummaries||[],t.coverageSummaries.push(fe(r))}}return t}function U(e,t){if(e.coverageSummaries)for(let n=0;n<e.coverageSummaries.length;n++)e.coverageSummaries[n].abstract=e.coverageSummaries[n].abstract||e.abstract,e.coverageSummaries[n].lonLatEnvelope=e.coverageSummaries[n].lonLatEnvelope||e.lonLatEnvelope,e.coverageSummaries[n].title=e.coverageSummaries[n].title||e.title,U(e.coverageSummaries[n],t);e.id!=null&&t.push(e)}function pe(e){let t=L(e.querySelector(`Operation[name=GetCapabilities]`),`Get`)?.getAttribute(`xlink:href`)||``,n=L(e.querySelector(`Operation[name=DescribeCoverage]`),`Get`)?.getAttribute(`xlink:href`)||``,r=L(e.querySelector(`Operation[name=GetCoverage]`),`Get`)?.getAttribute(`xlink:href`)||``;return{getCapabilities:V(t),describeCoverage:V(n),getCoverage:V(r)}}function me(e){let t=F(e,`ServiceIdentification/Title`),n=I(e,`ServiceIdentification/ServiceTypeVersion`),r=pe(L(e,`OperationsMetadata`)),i=[],a=L(e,`Contents`);for(let e=0;e<a.childNodes.length;e++){let t=a.childNodes[e];t.nodeType===1&&R(t,`CoverageSummary`)&&U(fe(t),i)}let o=I(a,`SupportedFormat`);return{name:t,onlineResources:r,coverages:i,gridCoverages:H(i),supportedVersions:n,supportedFormats:o,version:`1.1.0`}}function he(e){let t=L(e,`ServiceIdentification`),n=F(t,`Title`),r=I(t,`ServiceTypeVersion`),i=I(t,`Profile`),a=pe(L(e,`OperationsMetadata`)),o=P(e,`Contents/CoverageSummary`),s=[];for(let e=0;e<o.length;e++){let t=o[e],n=F(t,`CoverageId`),r=L(t,`WGS84BoundingBox`),i;if(r){let e=z(r,`LowerCorner`),t=z(r,`UpperCorner`);i=new _({xmin:e[0],ymin:e[1],xmax:t[0],ymax:t[1],spatialReference:{wkid:4326}})}let a=F(t,`CoverageSubtype`)||`RectifiedGridCoverage`;s.push({id:n,lonLatEnvelope:i,coverageSubType:a})}let c=L(e,`ServiceMetadata`);return{name:n,supportedVersions:r,supportedFormats:I(c,`formatSupported`),supportedInterpolations:I(c,`interpolationSupported`).concat(I(c,`InterpolationSupported`)),onlineResources:a,profiles:i,coverages:s,gridCoverages:H(s),version:`2.0.1`}}function ge(e){let t=null;t=typeof e==`string`?new DOMParser().parseFromString(e,`text/xml`):e;let n=t.documentElement.getAttribute(`version`)?.slice(0,3);return n!=null&&n<`2.1`}function _e(e,t=null){let n=null;n=typeof e==`string`?new DOMParser().parseFromString(e,`text/xml`):e;let r=n.documentElement.getAttribute(`version`);r===`1.0`?r=`1.0.0`:r===`1.1`&&(r=`1.1.0`);let i=r||t||`1.0.0`,a=i.slice(0,3),o;if(a===`2.0`)o=he(n);else if(a===`1.1`)o=me(n);else{if(a!==`1.0`)throw new x(`wcsraster:parsecapabilities`,`the capabilities version is not supported`);o=de(n)}return o.version=i,o}function W(e){e.variables.forEach(e=>e.dimensions.forEach(e=>e.values??=A(e)))}function ve(e){return{requestResponseCRSs:I(e,`requestResponseCRSs`).map(e=>e.split(`:`)[1]),nativeCRSs:I(e,`nativeCRSs`).map(e=>e.split(`:`)[1])}}function ye(e,t){let n=I(e,t===`1.0.0`?`interpolationMethod`:`InterpolationMethod`),r=t===`1.0.0`?e.getAttribute(`default`):F(e,`InterpolationMethods/Default`);return r==null?n:[r].concat(n.filter(e=>e.toLowerCase()!==r.toLowerCase()))}function G(e){return e==null?[`nearest`]:e.map(e=>{let t=e.toLowerCase();return t.includes(`nearest`)?`nearest`:t.includes(`linear`)?`bilinear`:t.includes(`cubic`)?`cubic`:null}).filter(e=>!!e)}function be(e){let t=P(e,`pos`),n=z(t[0]),r=z(t[1]);return new _({xmin:n[0],ymin:n[1],xmax:r[0],ymax:r[1],spatialReference:{wkid:4326}})}function K(e,t){let n=I(e,t);return n?.length&&n[0]!==``&&!isNaN(Number(n[0]))?n.map(e=>Number(e)):null}function xe(e){let t=z(e,`MinimumValue`),n=z(e,`MaximumValue`);return t.length&&n.length?t.map((e,t)=>({min:e,max:n[t],avg:-1,stddev:-1})):null}function q(e){return e==null?null:e.every(t=>t===e[0])?e[0]:e}function Se(e){let t=[],n=P(e,`RangeSet`),r=[];for(let e=0;e<n.length;e++){let i=F(n[e],`name`),a=F(n[e],`label`),o=[],s=K(n[e],`nullValues/singleValue`),c=P(n[e],`AxisDescription`);for(let e=0;e<c.length;e++){let t=F(c[e],`name`),n=F(c[e],`label`),i=I(c[e],`singleValue`);if(i.length===0){let t=F(c[e],`min`),n=F(c[e],`max`),r=Number(F(c[e],`res`))||1;if(t!==null&&n!==null)for(let e=parseInt(t,10);e<=parseInt(n,10);e+=r)i.push(e.toString())}t.toLowerCase()===`band`&&(r=i),o.push({name:t,label:n,values:i})}t.push({name:i,label:a,nullValues:s,axis:o})}return{rangeSet:t,bandNames:r}}function Ce(e=null){if(!e)return{resolution:null,units:null};let t=e.toUpperCase(),n=[`Y`,`M`,`D`],r=[`H`,`M`,`S`],i=[`Years`,`Months`,`Days`,`Hours`,`Minutes`,`Seconds`],a,o,s;return t.includes(`PT`)?(t=t.slice(2),s=r.findIndex(e=>t.includes(e)),a=i[3+s],o=parseFloat(t.slice(0,-1))):(t=t.slice(1),s=n.findIndex(e=>t.includes(e)),s>-1&&(a=i[s]),o=parseFloat(t.slice(0,-1))),{resolution:o,units:a}}function J(e){let t=P(e,`timeposition`);if(t.length>0){let e=[];for(let n=0;n<t.length;n++)e.push(new Date(F(t[n])));return{begin:e[0],end:e[e.length-1],values:e}}let n=L(e,`timePeriod`)||L(e,`TimePeriod`);return n?{begin:new Date(F(n,`beginPosition`)||F(n,`BeginPosition`)),end:new Date(F(n,`endPosition`)||F(n,`EndPosition`)),...Ce(F(n,`timeResolution`)||F(n,`TimeResolution`))}:null}function we(e){let t=L(e,`spatialDomain`),n=L(t,`Envelope`)||L(t,`EnvelopeWithTimePeriod`),r=n.getAttribute(`srsName`).split(`:`),i=r[r.length-1],a=P(n,`pos`),o=z(a[0]),s=z(a[1]),c=parseInt(i,10),l=isNaN(c)?null:{wkid:c},u=new _({xmin:o[0],ymin:o[1],xmax:s[0],ymax:s[1],spatialReference:l}),d=L(t,`RectifiedGrid`),f=F(d,`low`).split(` `),p=F(d,`high`).split(` `),m=parseInt(p[0],10)-parseInt(f[0],10)+1,h=parseInt(p[1],10)-parseInt(f[1],10)+1,g=z(t,`origin/pos`),v=P(t,`offsetVector`),y={envelope:u,columns:m,rows:h,offset:{x:parseFloat(F(v[0]).split(` `)[0]),y:parseFloat(F(v[1]).split(` `)[1])},origin:{x:g[0],y:g[1]}},b=L(e,`temporalDomain`)||L(e,`TemporalDomain`);return{spatialDomain:y,temporalDomain:b?J(b):null}}function Te(e){let t={version:`1.0`},n,r=[];for(let i=0;i<e.childNodes.length;i++){let a=e.childNodes[i];if(a.nodeType===1)if(R(a,`description`))t.description=F(a);else if(R(a,`name`))t.name=F(a);else if(R(a,`label`))t.label=F(a);else if(R(a,`supportedFormats`))t.supportedFormats=I(a,`formats`);else if(R(a,`supportedCRSs`))t.supportedCRSs=ve(a);else if(R(a,`supportedInterpolations`))t.supportedInterpolations=ye(a,`1.0.0`);else if(R(a,`lonLatEnvelope`))t.lonLatEnvelope=be(a);else if(R(a,`rangeSet`)){let e=Se(a);t.rangeSet=e.rangeSet,r=e.bandNames;let i=e.rangeSet[0].nullValues;i?.length&&(n=q(i))}else R(a,`domainSet`)&&(t.domainSet=we(a))}let i=G(t.supportedInterpolations),{name:a,description:o,label:s,lonLatEnvelope:c,supportedFormats:l}=t,{spatialDomain:u}=t.domainSet,d={x:Math.abs(u.offset.x),y:Math.abs(u.offset.y)},f=Ee(t.domainSet),p=new N({width:u.columns,height:u.rows,pixelSize:d,pixelType:`unknown`,extent:u.envelope,spatialReference:u.envelope.spatialReference,bandCount:r.length||1,noDataValue:n,multidimensionalInfo:f});return{id:a,title:t.name,description:o||s,lonLatEnvelope:c,rasterInfo:p,bandNames:r,supportedFormats:l,supportedInterpolations:i,coverageDescription:t,version:`1.0.0`,useEPSGAxis:!1}}function Ee(e){if(!e.temporalDomain)return null;let{begin:t,end:n,values:r,units:i,resolution:a}=e.temporalDomain,o={variables:[{name:`default`,description:``,dimensions:[{name:`StdTime`,description:``,unit:`ISO8601`,values:r?.map(e=>e.getTime()),hasRegularIntervals:!r,interval:a,intervalUnit:i,extent:[t.getTime(),n.getTime()]}]}]};return W(o),o}function De(e,t){let n=[],r=P(e,`Field`),i,a=[];for(let e=0;e<r.length;e++){let o=F(r[e],`Identifier`),s=F(r[e],`Description`),c=F(r[e],`Definition`),l=F(r[e],`Abstract`),u=F(r[e],`Title`),d=K(r[e],`NullValue`),f=L(r[e],`AllowedValues`),p=f?xe(f):null,m=ye(r[e],`1.1.0`),h=[],g=P(r[e],`Axis`);for(let e=0;e<g.length;e++){let n=g[e].getAttribute(`identifier`),r=F(g[e],`UOM`),o=F(g[e],`DataType`),s=I(g[e],`Key`);t&&!n.toLowerCase().includes(`band`)||(a=s,i=d),h.push({identifier:n,uom:r,dataType:o,values:s,bandNoDataValues:i})}n.push({identifier:o,description:s,definition:c,abstract:l,title:u,supportedInterpolations:m,axis:h,nullValues:d,statistics:p})}return{rangeSet:n,bandNames:a,bandNoDataValues:i,statistics:n[0].statistics}}function Oe(e,t){if(!t.temporalDomain)return null;let n=e.filter(e=>!e.identifier.toLowerCase().includes(`field_1`)&&!e.axis.some(e=>e.identifier.includes(`band`))),r=[];if(n.length&&n.forEach(e=>{let t=e.axis.map(e=>{let t=e.values.map(t=>e.uom===`ISO8601`?(t=t.trim()).toLowerCase().includes(`z`)?new Date(t).getTime():new Date(t+`Z`).getTime():parseFloat(t.trim())),n=[Math.min.apply(null,t),Math.max.apply(null,t)];return{name:e.identifier.trim(),description:``,field:e.identifier.trim(),unit:e.uom?e.uom.trim():``,hasRegularIntervals:!1,values:t,extent:n}});r.push({name:e.identifier.trim(),description:e.description?.trim()??``,unit:``,dimensions:t,statistics:e.statistics})}),t.temporalDomain){let{begin:e,end:n,values:i,units:a,resolution:o}=t.temporalDomain;r.some(e=>e.dimensions.some(e=>e.name.toLowerCase()===`stdtime`))||r.forEach(t=>{t.dimensions.push({name:`StdTime`,description:``,unit:`ISO8601`,values:i?.map(e=>e.getTime()),hasRegularIntervals:!i,interval:o,intervalUnit:a,extent:[e.getTime(),n.getTime()]})})}if(r.length){let e={variables:r};return W(e),e}return null}function ke(e){let t=L(e,`SpatialDomain`),n=L(t,`GridCRS`),r=F(n,`GridBaseCRS`),i=F(n,`GridOrigin`)?.split(` `).map(e=>parseFloat(e))??[0,0],a=z(n,`GridOffsets`),o=P(t,`BoundingBox`),s,c,l,u;for(let e=0;e<o.length;e++){let t=o[e].getAttribute(`crs`)?.toLowerCase();if(t!=null){if(t.includes(`imagecrs`)){let t=z(o[e],`LowerCorner`),n=z(o[e],`UpperCorner`);s=n[0]-t[0]+1,c=n[1]-t[1]+1}else if(t.indexOf(`epsg`)>0){let n=t.split(`:`);l=parseInt(n[n.length-1],10);let r=z(o[e],`LowerCorner`),i=z(o[e],`UpperCorner`);u=new _({xmin:r[0],ymin:r[1],xmax:i[0],ymax:i[1],spatialReference:{wkid:l}})}}}let d=s>c,f=u.xmax-u.xmin>u.ymax-u.ymin,p=!1;ce(l)&&(d===f?p=!1:(p=!0,u=new _({xmin:u.ymin,ymin:u.xmin,xmax:u.ymax,ymax:u.xmax,spatialReference:{wkid:l}})));let m={columns:s,rows:c,origin:{x:i[0],y:i[1]},offset:{x:a[0],y:a[a.length-1]},gridBaseCRS:r,envelope:u,useEPSGAxis:p},h=L(e,`temporalDomain`)||L(e,`TemporalDomain`);return{spatialDomain:m,temporalDomain:h?J(h):null}}function Ae(e,t){let n=[],r=[],i={supportedFormats:n,supportedCRSs:r,version:`1.1`},a,o,s=[];for(let t=0;t<e.childNodes.length;t++){let c=e.childNodes[t];if(c.nodeType!==1)continue;let l=oe(c).toLowerCase();switch(l){case`title`:case`abstract`:case`identifier`:i[l]=F(c);break;case`supportedformat`:{let e=F(c);n.includes(e)||n.push(e)}break;case`supportedcrs`:{let e=F(c);r.includes(e)||r.push(e)}break;case`range`:{let e=De(c,!!i.domain?.temporalDomain);i.range=e.rangeSet,s=e.bandNames;let{bandNoDataValues:t}=e;t?.length&&(a=q(t)),o=e.statistics}break;case`domain`:i.domain=ke(c)}}let c=G(i.range[0].supportedInterpolations),{identifier:l,abstract:u,title:d,domain:f,range:p}=i,m={x:Math.abs(f.spatialDomain.offset.x),y:Math.abs(f.spatialDomain.offset.y)},h=Oe(p,f);h&&(a=p[0].nullValues,a?.length===1&&(a=a[0]));let g=new N({width:f.spatialDomain.columns,height:f.spatialDomain.rows,pixelSize:m,pixelType:`unknown`,extent:f.spatialDomain.envelope,spatialReference:f.spatialDomain.envelope.spatialReference,bandCount:s.length||1,noDataValue:a,statistics:o,multidimensionalInfo:h});return{id:l,title:i.title,description:u||d,bandNames:s,rasterInfo:g,supportedFormats:n,supportedInterpolations:c,coverageDescription:i,version:t,useEPSGAxis:f.spatialDomain.useEPSGAxis}}function je(e){let t=L(e,`Envelope`)||L(e,`EnvelopeWithTimePeriod`),n=t.getAttribute(`srsName`),r=n.slice(n.lastIndexOf(`/`)+1),i=t.getAttribute(`axisLabels`).split(` `).map(e=>e.trim()).filter(e=>e.trim()!==``),a=z(t,`lowerCorner`),o=z(t,`upperCorner`),s=![`y`,`lat`,`latitude`,`north`,`nor`,`n`,`b`].includes(i[0].toLowerCase()),c,l=parseInt(r,10),u=isNaN(l)?null:{wkid:l};c=new _(s?{xmin:a[0],ymin:a[1],xmax:o[0],ymax:o[1],spatialReference:u}:{xmin:a[1],ymin:a[0],xmax:o[1],ymax:o[0],spatialReference:u});let d={mins:a,maxs:o},f=t.getAttribute(`uomLabels`).trim().split(` `),p,m;if(R(t,`EnvelopeWithTimePeriod`)){p=new Date(F(e,`beginPosition`)||F(e,`BeginPosition`)),m=new Date(F(e,`endPosition`)||F(e,`EndPosition`));let t=f?.findIndex(e=>e?.toLowerCase()===`oledatetime`);t>-1&&(f[t]=`ISO8601`)}return{envelope:c,axisLabels:i,uomLabels:f.length?f:null,envelopeAllDims:d,beginPosition:p,endPosition:m,isEastFirst:s}}function Me(e,t){let n=[],r=P(e,`DataRecord`),i=[],a,o=[];for(let e=0;e<r.length;e++){let s=P(r[e],`field`),c=[];for(let e=0;e<s.length;e++){let n=s[e].getAttribute(`name`),r=F(s[e],`description`)||``,l=L(s[e],`uom`)?.getAttribute(`code`)||``,u=z(s[e],`interval`),d=K(s[e],`nilValue`)?.[0];t&&!n.toLowerCase().includes(`band`)||(i.push(n),u?.length&&(a||=[],a.push({min:u[0],max:u[1],avg:-1,stddev:-1})),o.push(d)),c.push({name:n,description:r,uom:l,allowedValues:u,nilValue:d})}n.push(c)}return o.some(e=>e!=null)||(o=null),{rangeType:n,bandNames:i,bandStats:a,bandNoDataValues:o}}function Ne(e){let t=1,n=``,r=.01;return Math.abs(e-1/24)<1/24*r?n=`Hours`:Math.abs(e-1)<1*r?n=`Days`:e<1?(t=Math.round(24*e),n=`Hours`):e>28-r&&e<31+r||Math.round(e/30)<12?n=`Months`:e>365-r&&e<366+r&&(n=`Years`),{interval:t,intervalUnit:n}}function Pe(e,t,n){if(n.axisLabels.length<=2)return null;let r=[];for(let t=0;t<e.length;t++){let n=e[t];for(let e=0;e<n.length;e++)n[e].name.toLowerCase().includes(`band`)||r.push(n[e])}let i=[];if(r.length){let e=[];for(let r=2;r<n.axisLabels.length;r++){let i=t.uomLabels?.[r]?.trim()??``,a=n.axisLabels[r].toLowerCase().includes(`time`)||i.toLowerCase()===`iso8601`||i.toLowerCase()===`oledatetime`,o,s;if(a){let e=Ne(n.offset[r]);o=e.interval,s=e.intervalUnit}else o=n.offset[r],s=i;let c=[];a?(c.push(M(t.envelopeAllDims.mins[r])),c.push(M(t.envelopeAllDims.maxs[r]))):(c.push(t.envelopeAllDims.mins[r]),c.push(t.envelopeAllDims.maxs[r])),e.push({name:n.axisLabels[r].trim(),description:n.axisLabels[r].trim(),unit:a?`ISO8601`:i,hasRegularIntervals:!0,extent:c,interval:o,intervalUnit:s})}if(r.forEach(t=>{let{allowedValues:n}=t,r=n?.length===2?[{min:n[0],max:n[1],avg:-1,stddev:-1}]:null;i.push({name:t.name.trim(),description:t.description?.trim()??``,unit:t.uom.trim(),statistics:r,dimensions:[...e]})}),i.length){let e={variables:i};return W(e),e}}return null}function Fe(e,t){let n=L(e,`RectifiedGrid`),r=z(n,`low`),i=z(n,`high`),a=[];for(let e=0;e<r.length;e++)a.push(i[e]-r[e]+1);let o=F(n,`axisLabels`).split(` `),s=z(n,`origin/pos`),c=P(n,`offsetVector`),l=[];for(let e=0;e<c.length;e++){let t=z(c[e]),n=t.findIndex(e=>e!==0);l[n]=t[n]}let u=[`y`,`lat`,`latitude`,`north`,`nor`,`n`,`b`],d=!1;t?.length&&o?.length&&(d=[...t].sort((e,t)=>e<t?-1:1).join(`,`)===[...o].sort((e,t)=>e<t?-1:1).join(`,`));let f=d?o:t,p,m,h;return u.includes(f[0].toLowerCase())?(p=a[1],m=a[0],h={y:Math.abs(l[0]),x:Math.abs(l[1])}):(p=a[0],m=a[1],h={x:Math.abs(l[0]),y:Math.abs(l[1])}),{columns:p,rows:m,origin:s,offset:l,resolution:h,gridSamples:a,axisLabels:o,hasSameAxisLabelsAsBoundedBy:d}}function Ie(e){let t=L(e,`EarthObservation`);if(!t)return null;let n=L(t,`phenomenonTime`),r=n?J(n):null,i=L(t,`phenomenonTime`),a=i?J(i):null,o=F(t,`featureOfInterest/Footprint/multiExtentOf/MultiSurface/surfaceMembers/Polygon/exterior/LinearRing/posList`),s=null;if(o){let e=o.split(` `).map(e=>e.trim()).filter(e=>e!=null&&e!==``).map(Number);if(e.length){let t=[];for(let n=0;n<e.length/2;n+=2)t.push(e[n],e[n+1]);s=new C({rings:[[t]]})}}return{observation:{phenomenonTime:r,resultTime:a,footprint:s,identifier:F(e,`metaDataProperty/EarthObservationMetaData/identifier`),acquisitionType:F(e,`metaDataProperty/EarthObservationMetaData/acquisitionType`),status:F(e,`metaDataProperty/EarthObservationMetaData/status`)}}}function Le(e){let t={version:`2.0`},n,r,i=[];for(let a=0;a<e.childNodes.length;a++){let o=e.childNodes[a];if(o.nodeType===1){if(R(o,`coverageId`))t.coverageId=F(o);else if(R(o,`ServiceParameters`))t.serviceParameters={supportedFormats:I(o,`nativeFormat`)};else if(R(o,`boundedBy`))t.boundedBy=je(o);else if(R(o,`rangeType`)){let e=Me(o,t.boundedBy?.axisLabels.length>2||t.domainSet?.axisLabels.length>2);t.rangeType=e.rangeType,i=e.bandNames,n=e.bandStats;let{bandNoDataValues:a}=e;a?.length&&(r=q(a))}else if(R(o,`domainSet`))t.domainSet=Fe(o,t.boundedBy?.axisLabels);else if(R(o,`metadata`)){let e=L(o,`EOMetadata`);t.eoMetadata=e?Ie(e):null}}}let{coverageId:a,boundedBy:o,domainSet:s,rangeType:c,serviceParameters:l}=t,u=Pe(c,o,s);return!n&&u&&(n=u?.variables[0].statistics),u!=null&&(r=c[0][0].nilValue),{id:a,title:a,description:a,bandNames:i,rasterInfo:new N({width:s.columns,height:s.rows,pixelSize:s.resolution,pixelType:`unknown`,extent:o.envelope,spatialReference:o.envelope.spatialReference,bandCount:i.length||1,statistics:n,noDataValue:r,multidimensionalInfo:u}),supportedFormats:l.supportedFormats,coverageDescription:t,version:`2.0.1`,useEPSGAxis:!1}}function Re(e,t){let n=null;if(n=typeof e==`string`?new DOMParser().parseFromString(e,`text/xml`):e,t===`1.0.0`)return P(n,`CoverageOffering`).map(e=>Te(e));let r=P(n,`CoverageDescription`);return t===`1.1.0`||t===`1.1.1`||t===`1.1.2`?r.map(e=>Ae(e,t)):r.map(e=>Le(e))}async function ze(e,t){let{version:n,customParameters:r,signal:i}=t??{},a=n?.startsWith(`1.0`)?`version`:`acceptVersions`,o={service:`WCS`,request:`GetCapabilities`,[a]:n,...r};try{let{data:n}=await g(e,{query:o,responseType:`xml`,signal:i});return t?.version||ge(n)||(o[a]=`2.0.1`,{data:n}=await g(e,{query:o,responseType:`xml`,signal:i})),_e(n)}catch(e){throw b(e)?e:new x(`wcslayer:open`,`wcs capabilities is not valid or supported`)}}async function Y(e,t){let{coverageIds:n,version:r,customParameters:i,signal:a}=t,o=r.slice(0,3),s={service:`WCS`,request:`DescribeCoverage`,version:r,[o===`1.0`?`coverage`:o===`1.1`?`identifiers`:`coverageId`]:n.join(`,`),...i};try{let{data:t}=await g(e,{query:s,responseType:`xml`,signal:a});return Re(t,r)}catch(e){throw b(e)?e:new x(`wcslayer:open`,`wcs coverage description is not valid or supported`)}}function Be(e){let t=He(e);return t?{isMultipart:!0,data:t.boundary?Ve(e.data,t,0):null}:{isMultipart:!1,data:null}}function Ve(e,t,n=0){let r=`--`+t.boundary,i=[];for(let e=0;e<r.length;e++)i.push(r.charCodeAt(e));let a=[],o=`
--`+t.boundary+`--`;for(let e=0;e<o.length;e++)a.push(o.charCodeAt(e));let s=[10],c=[13,10],l=[],u=i.length,d=new Uint8Array(e,n),f=d.length-u,p=0,m=0;for(let e=0;e<f;e++){for(m=0;m<u&&d[e+m]===i[m];m++);if(m!==u)continue;let n=!1;if(p){let r=Ue(d.subarray(p,e),t);l.push(r),n=!!r.isValidImage}if(e+=u-1,d[e+1]===s[0]?e+=1:d[e+1]===c[0]&&d[e+2]===c[1]&&(e+=2),p=e+1,n)break}let h=a.length;for(let e=d.length-h-10;e<d.length-h;e++){for(m=0;m<h&&d[e+m]===a[m];m++);if(m===h){l.push(Ue(d.subarray(p,e),t));break}}return l}function He(e){let t=e.getHeader?.(`Content-Type`)?.split(`;`);if(!t||!(t[0].trim()??``).startsWith(`multipart/`))return null;let n={boundary:``,start:``,type:``};for(let e=1;e<t.length;e++){let r=t[e].indexOf(`=`);if(r>0){let i=t[e].slice(0,r).trim(),a=t[e].slice(r+1).trim();n[i]=a.startsWith(`"`)?a.slice(1,-1):a}}return n}function Ue(e,t){let n=String.fromCharCode.apply(null,e.subarray(0,Math.min(300,e.length))).split(`
`),r=Math.min(n.length,7),i={contentDisposition:`inline`},a=0;for(let o=0;o<r;o++)if(n[o].length<4)a=a+n[o].length+1;else if(n[o].slice(0,7).toLowerCase()===`content`){a=a+n[o].length+1;let e=n[o].indexOf(`:`);if(e===-1)continue;let t=n[o].slice(0,e).trim(),r=n[o].slice(e+1).trim();switch(t.toLowerCase()){case`content-type`:i.contentType=r;break;case`content-description`:i.contentDescription=r;break;case`content-transfer-encoding`:i.contentTransferEncoding=r;break;case`content-id`:i.contentID=r;break;case`content-disposition`:i.contentDisposition=r;break;case`content-location`:i.contentLocation=r}}else{if(i.contentDisposition.toLowerCase().includes(`inline`)&&n[o].length>=4&&i.contentType?.toLowerCase().includes(`image`)){let t=!0,n=e.subarray(a,e.length);if(i.contentType.toLowerCase().indexOf(`tif`)>0){if(i.contentTransferEncoding===`base64`){let e=``,t=n;for(let n=0;n<t.length;n+=65535){let r=t.subarray(n,n+65535>t.length-1?t.length-1:n+65535);e+=String.fromCharCode.apply(null,r)}let r=atob(e);n=new Uint8Array(r.length);for(let e=0;e<n.length;e++)n[e]=r.charCodeAt(e)}t=n[0]===73&&n[1]===73||n[0]===77&&n[1]===77}if(t){let t=n.buffer;i.contentTransferEncoding!==`base64`&&(t=new ArrayBuffer(e.length-a),n=new Uint8Array(t),n.set(e.subarray(a,e.length))),i.contentData=t,i.isValidImage=!0}break}if((t.start===``||i.contentID===t.start)&&i.contentType){if(i.contentType.includes(`text`)||i.contentType.includes(`xml`)){i.contentData=String.fromCharCode.apply(null,e.subarray(a,e.length));break}i.contentData=e.subarray(a,e.length)}}return i}var We=[`nearest neighbor`,`bilinear`,`bicubic`],Ge=[`nearest`,`linear`,`cubic`],Ke=`response is not a supported multipart/related mediaType with inline tiff,  switching to compatibility mode`,qe=`response is not a supported multipart mediaType with inline tiff`,Je=`response is base64 encoded which may impact layer display performance`,Ye=`server returns an exception`,X=new Set([`1.0.0`,`1.1.0`,`1.1.1`,`1.1.2`,`2.0.1`]),Z=class extends ae{constructor(){super(...arguments),this.datasetFormat=`WCSServer`,this.tileType=`Raster`}get rasterId(){return`${this.url}-${this.coverageId}-${this.version}`}async fetchRawTile(e,t,n,r={}){if(this.isBlockOutside(e,t,n))return null;let{nativePixelSize:i,spatialReference:a}=this.rasterInfo,o=2**e,s=i.x*o,c=i.y*o,{blockWidth:l,blockHeight:u}=this.getBlockWidthHeight(e),{origin:d}=this.rasterInfo.storageInfo.tileInfo,f=this.getTileExtent({x:s,y:c},t,n,d,a,[l,u]),p=this.rasterInfo.extent,m=f.xmax>p.xmax,h=f.ymin<p.ymin,g=m||h,_=f,v=l,y=u;if(g&&(_=f.clone().intersection(p),_!=null&&(m&&(v=Math.floor((_.xmax-_.xmin)/s),_.xmax=_.xmin+s*v),h&&(y=Math.floor((_.ymax-_.ymin)/c),_.ymin=_.ymax-c*y))),_==null||v<=1||y<=1)return null;let b=await this._getCoverage(_,v,y,o,r);if(!b)return null;let{coverageDescription:S}=this.coverageInfo,{noDataValue:C,multidimensionalInfo:w}=this.rasterInfo,{multidimensionalDefinition:T}=r,E;if(w!=null&&T!=null&&T.length){let e=T[0].variableName;S.version===`2.0`?E=S.rangeType[0].find(t=>t.name===e)?.nilValue:S.version===`1.1`&&(E=S.range.find(t=>t.identifier===e)?.nullValues)}let D=E??C,O=await this.decodePixelBlock(b,{width:v,height:y,planes:null,pixelType:null,tiffNoDataValue:Array.isArray(D)?D[0]:D,matchAllNoData:!0});if(O==null)return null;if(O&&(O.width!==v||O.height!==y))throw new x(`wcsraster-fetch`,`the response has unexpected dimension width: ${O.width}, height: {pixelBlock.height}`);return g?ie(O,{x:0,y:0},{width:u,height:u}):O}async _open(e){let{customFetchParameters:t}=this.ioConfig,n=e?.signal,r=await ze(this.url,{version:t?.version??this.version,customParameters:t,signal:n});if(this.capabilities=r,!this.version){let e=r.version.slice(0,3);e===`2.0`||e===`1.1`||e===`1.0`?this.version=r.version:(e=r.supportedVersions.find(e=>e===`2.0.1`)||r.supportedVersions.find(e=>e.startsWith(`2.0`))||r.supportedVersions.find(e=>e.startsWith(`1.1`))||r.supportedVersions.find(e=>e.startsWith(`1.0`))||`1.0.0`,this.version=e)}let{version:i}=this;if(!X.has(i))throw new x(`wcsraster-open`,`unsupported WCS version ${i}`);let{gridCoverages:a}=r;if(!a.length)throw new x(`wcsraster-open`,`cannot find rectified grid coverages`);this.coverageId??=a[0].id;let{coverageId:o}=this,s=a.find(e=>e.id===o);if(s==null)throw new x(`wcsraster-open`,`the coverageId ${o} does not exist in capabilities`);if(this.coverageInfo=(await Y(this.url,{coverageIds:[o],version:i,customParameters:t,signal:n}))[0],i.startsWith(`2.0`)){let{coverageInfo:e}=this;e.lonLatEnvelope=s.lonLatEnvelope,e.supportedInterpolations=G(r.supportedInterpolations),this._patchDimensionValues201(o,n)}this.datasetName=this.coverageInfo.title;let{rasterInfo:c}=this.coverageInfo;if(this.createRemoteDatasetStorageInfo(c,512,512),this._set(`rasterInfo`,c),c.spatialReference==null)throw new x(`wcsraster-open`,`coverage without spatial reference is not supported: ${o}`);let{pixelType:l,bandCount:u}=await this._getPixelTypeAndBandCount(n);c.pixelType=l,c.bandCount===1&&u>1&&(c.bandCount=u),this.updateTileInfo()}async _patchDimensionValues201(e,t){let{coverageInfo:n}=this,r=n.rasterInfo.multidimensionalInfo?.variables,i=X.has(`1.1.2`)?`1.1.2`:X.has(`1.1.1`)?`1.1.1`:X.has(`1.1.0`)?`1.1.0`:null,{customFetchParameters:a}=this.ioConfig;if(r&&i)try{let n=this.url.includes(`/ImageServer/`),o=e.length>8&&e.startsWith(`Coverage`)&&n?e.slice(8):e,s=(await Y(this.url,{coverageIds:[o??e],version:i,customParameters:a,signal:t}).catch(()=>{if(o)return Y(this.url,{coverageIds:[e],version:i,customParameters:a,signal:t})}))?.[0].rasterInfo.multidimensionalInfo?.variables;if(s)for(let e of r){let t=s.find(({name:t})=>t===e.name);if(t?.dimensions?.length)for(let r=e.dimensions.length-1;r>=0;r--){let i=e.dimensions[r],a=t.dimensions.find(({name:e})=>e===i.name);a?a.values&&a.extent?.join(`,`)===i.extent?.join(`,`)&&(e.dimensions[r]={...i,values:a.values}):n&&e.dimensions.splice(r,1)}}}catch{}}async _getPixelTypeAndBandCount(e){let{pixelSize:t,extent:n,multidimensionalInfo:r}=this.rasterInfo,i=n.center,a=new _({xmin:i.x-t.x,xmax:i.x+t.x,ymin:i.y-t.y,ymax:i.y+t.y,spatialReference:n.spatialReference}),o=[];if(r!=null){let e=r.variables[0];o=[],e.dimensions.forEach(t=>{o.push(new j({variableName:e.name,dimensionName:t.name,values:t.hasRegularIntervals?t.extent?.[0]:t.values?.[0],isSlice:!0}))})}let{coverageDescription:s}=this.coverageInfo,c={interpolation:`nearest`,multidimensionalDefinition:o,signal:e},{version:l}=s,{ioConfig:u}=this,d=l===`2.0`&&u.allowAnyMediaType==null||l===`1.1`&&u.use2GridOffsets==null,f;try{f=await this._getCoverage(a,2,2,1,c,!0)}catch(e){if(!d)throw e;if(l===`1.1`){if(!e.details?.isResolutionMismatch)throw e;u.use2GridOffsets=!0}}if(!f&&d&&(l===`2.0`&&(u.allowAnyMediaType=!0),f=await this._getCoverage(a,2,2,1,c),f&&O.getLogger(this).warn(`wcsraster:getcoverage`,Ke)),!f)throw new x(`wcsraster-open`,`unable to determine pixel type`);let p=await this.decodePixelBlock(f,{width:2,height:2,planes:null,pixelType:null});if(p==null)throw new x(`wcsraster-open`,`unable to determine pixel type`);return{pixelType:p.pixelType,bandCount:p.getPlaneCount()??0}}async _getCoverage(e,t,n,r,i,a=!1){let{coverageDescription:o}=this.coverageInfo,{version:s}=o,c=s===`2.0`?this._getCoverage201Parameters(e,t,n,r,i,o):s===`1.1`?this._getCoverage110Parameters(e,t,n,i,o):this._getCoverage100Parameters(e,t,n,i),l=s===`2.0`?await this.request(this._constructWCS201Url(c),{signal:i.signal,responseType:`array-buffer`}):await this.request(this.url,{query:c,signal:i.signal,responseType:`array-buffer`});if(s===`1.0`)return l.data;if(s===`2.0`&&!1!==this.ioConfig.allowAnyMediaType&&ee(l.data)===`tiff`)return a&&(this.ioConfig.allowAnyMediaType=!0,O.getLogger(this).warn(`wcsraster:getcoverage`,Ke)),l.data;let u=Be(l);if(u.isMultipart&&u.data){let e=u.data.find(e=>e.isValidImage);return a&&e?.contentTransferEncoding===`base64`&&O.getLogger(this).warn(`wcsraster:getcoverage`,Je),e?.contentData}let d=new Uint8Array(l.data,0,Math.min(l.data.byteLength,2e3)),f=String.fromCharCode.apply(null,d).toLowerCase().includes(`exception`),p=f&&String.fromCharCode.apply(null,d).includes(`A non-zero RESX/RESY or WIDTH/HEIGHT is required but neither was provided`);throw f?new x(`wcsraster:getcoverage`,Ye,{isResolutionMismatch:p}):new x(`wcsraster:getcoverage`,qe)}_getInterpolationIndex(e){return e&&this.coverageInfo.supportedInterpolations?.includes(e)?e===`nearest`?0:e===`bilinear`?1:e===`cubic`?2:0:0}_getCoverage100Parameters(e,t,n,r){let i=`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`,a=e.spatialReference.wkid,o=(this.coverageInfo.supportedFormats||[]).find(e=>e.toLowerCase().includes(`tiff`))||`GEOTIFF`,{bandIds:s,interpolation:c}=r,l=this._getInterpolationIndex(c),u=s?s.map(e=>this.coverageInfo.bandNames[e]):null,d=We[l],{multidimensionalDefinition:f}=r,p;if(f!=null&&this.rasterInfo.multidimensionalInfo!=null){let e=f.find(e=>e.dimensionName===`StdTime`)?.values;e&&e.length>0&&(Array.isArray(e[0])&&(e=e[0]),p=e.map(e=>Q(e)).join(`,`))}return{service:`WCS`,request:`GetCoverage`,version:this.version,coverage:this.coverageId,format:o,crs:`EPSG:${a}`,bbox:i,width:t,height:n,time:p,interpolation:d,band:u?.join(`,`)}}_getCoverage110Parameters(e,t,n,r,i){let{multidimensionalDefinition:a,bandIds:o,interpolation:s}=r,c=e.spatialReference.wkid,l=`urn:ogc:def:crs:EPSG::${c}`,u=(this.coverageInfo.supportedFormats||[]).find(e=>e.toLowerCase().includes(`tiff`))||`image/tiff`,d=this._getInterpolationIndex(s),f=Ge[d],p=s==null||this.coverageInfo.supportedInterpolations?.indexOf(s)===0,m=i.domain.spatialDomain,h=m.origin.x<=m.envelope.xmin&&m.origin.y<=m.envelope.ymin,g=e.width/t,_=e.height/n*(h?1:-1),v=h?[e.xmin,e.ymin]:[e.xmin,e.ymax],y=m.useEPSGAxis&&ce(c),b=y?`${v[1]},${v[0]}`:`${v[0]},${v[1]}`,x=this.ioConfig.use2GridOffsets,S=y?x?`${_},${g}`:`${_},0,0,${g}`:x?`${g},${_}`:`${g},0,0,${_}`,C=g/2,w=e.xmin+C,T=e.xmax-C,E=Math.abs(_)/2,D=e.ymin+E,O=e.ymax-E,k=y?`${D},${w},${O},${T},${l}`:`${w},${D},${T},${O},${l}`,A=i.range.find(e=>e.axis.some(e=>e.identifier.toLowerCase().includes(`band`))),j,M=A&&f&&o?p?`${A.identifier}[${A.axis[0].identifier}[${o.join(`,`)}]]`:`${A.identifier}:${f}[${A.axis[0].identifier}[${o.join(`,`)}]]`:null;if(a!=null&&a.length)for(let e=0;e<a.length;e++){let t=a[e].values,n=a[e].dimensionName?.toLowerCase(),r=a[e].variableName?.toLowerCase(),o=i.range.find(e=>e.identifier.toLowerCase()===r);if(t.length>0){if(Array.isArray(t[0])&&(t=t[0]),n===`stdtime`)j=t.map(e=>Q(e)).join(`,`);else if(o){let e=o.axis.find(e=>e.identifier.toLowerCase()===n);e&&(M=p?o.identifier+`[`+e.identifier+`[`+t.join(`,`)+`]]`:o.identifier+`:`+f+`[`+e.identifier+`[`+t.join(`,`)+`]]`)}}e===a.length-1&&o&&!M&&(M=p?o.identifier:o.identifier+`:`+f)}return{service:`WCS`,request:`GetCoverage`,version:this.version,identifier:this.coverageId,format:u,crs:`EPSG:${c}`,boundingbox:k,gridCS:`urn:ogc:def:cs:OGC:0.0:Grid2dSquareCS`,gridType:`urn:ogc:def:method:WCS:1.1:2dGridIn2dCrs`,gridOrigin:b,gridOffsets:S,gridBaseCRS:l,timeSequence:j,rangeSubset:M}}_getCoverage201Parameters(e,t,n,r,i,a){let{multidimensionalDefinition:o,interpolation:s}=i,c=this._getInterpolationIndex(s),l=null,{supportedInterpolations:u}=this.capabilities;if(u?.length)switch(c){case 0:l=u.find(e=>e.toLowerCase().includes(`nearest`));break;case 1:l=u.find(e=>e.toLowerCase().includes(`linear`));break;case 2:l=u.find(e=>e.toLowerCase().includes(`cubic`)||e.toLowerCase().includes(`quadratic`))}let d=(this.coverageInfo.supportedFormats||[]).find(e=>e.toLowerCase().includes(`tiff`))||`image/tiff`,{bandNames:f}=this.coverageInfo,{boundedBy:p,domainSet:m,rangeType:h}=a,g=p.isEastFirst?0:1,_=1-g,{axisLabels:v}=p,y=v[g],b=v[_],x=`http://www.opengis.net/def/crs/EPSG/0/${e.spatialReference.wkid}`,S=x,C=[];C.push(`${y}(${e.xmin},${e.xmax})`),C.push(`${b}(${e.ymin},${e.ymax})`);let w=[];if(v.length>2)for(let e=2;e<v.length;e++){let t=m.origin[e];if(v[e].toLowerCase().includes(`time`)){let n=t.toString();p.uomLabels?.[e].toLowerCase().includes(`ole`)&&(w.push(v[e]),n=Q(t,!0)),C.push(v[e]+`,http://www.opengis.net(`+n+`)`)}else C.push(v[e]+`,http://www.opengis.net(`+t+`)`)}let T=null;if(o!=null&&o.length){let e=[];h.forEach(t=>t.forEach(t=>e.push(t.name)));let t=[];for(let n=0;n<o.length;n++){let r=v.find(e=>e===o[n].dimensionName),i=e.find(e=>e===o[n].variableName);if(t.includes(i)||t.push(i),r){let e=o[n].values;if(e.length>0){Array.isArray(e[0])&&(e=e[0]);let t=``;t=r.toLowerCase().includes(`time`)?e.map(e=>Q(e)).join(`,`):e.join(`,`);let n=C.findIndex(e=>e.startsWith(r+`,http://www.opengis.net`));n===-1&&C.push(r+`,http://www.opengis.net(`+t+`)`),n===-1||C[n].includes(`(`+t+`)`)||C.splice(n,1,r+`,http://www.opengis.net(`+t+`)`)}}}t.length&&(T=t.join(`,`))}else f?.length>=2&&(T=(i.bandIds?i.bandIds.map(e=>f[e]):f).join(`,`));let E=C.join(`&subset=`),D=!a.domainSet.hasSameAxisLabelsAsBoundedBy&&!1!==this.ioConfig.allowScaleFactor,O=D?null:`${y}(${t}),${b}(${n})`,k=D?1/r:null;return{service:`WCS`,request:`GetCoverage`,version:this.version,coverageId:this.coverageId,rangesubset:T,interpolation:l,scaleSize:O,scaleFactor:k,subset:E,format:d,mediaType:this.ioConfig.allowAnyMediaType?null:`multipart/related`,outputcrs:x,subsettingcrs:S}}_constructWCS201Url(e){let t={...this.ioConfig.customFetchParameters,...e},n=[];return Object.keys(t).forEach(e=>{let r=t[e];r!=null&&(e===`subset`?typeof r==`string`&&r.split(`&subset=`).forEach(e=>{e&&n.push(`subset=${encodeURIComponent(e)}`)}):n.push(`${e}=${encodeURIComponent(r)}`))}),`${encodeURI(this.url)}?${n.join(`&`)}`}};function Q(e,t=!1){return(t?new Date(M(e)):new Date(e)).toISOString()}t([d({type:String,json:{write:!0}})],Z.prototype,`datasetFormat`,void 0),t([d({readOnly:!0})],Z.prototype,`tileType`,void 0),t([d({type:String,json:{write:!0}})],Z.prototype,`version`,void 0),t([d({type:String,json:{write:!0}})],Z.prototype,`coverageId`,void 0),t([d({readOnly:!0})],Z.prototype,`rasterId`,null),Z=t([T(`esri.layers.support.rasterDatasets.WCSRaster`)],Z);var Xe=new Set([`milliseconds`,`seconds`,`minutes`,`hours`,`days`,`weeks`,`months`,`years`,`decades`,`centuries`]),$=class extends E(v(D(p(r(se(te(a(y(S(k(f))))))))))){constructor(...e){super(...e),this.coverageId=null,this.version=null,this.isReference=null,this.graphicOrigin=new ue(this),this.legendEnabled=!0,this.noData=0,this.operationalLayerType=`WCS`,this.type=`wcs`,this.popupEnabled=!0,this.popupTemplate=null,this.fields=null,this._debouncedSaveOperations=c(async(e,t,r)=>{let{save:i,saveAs:a}=await n(async()=>{let{save:e,saveAs:t}=await import(`./imageryUtils-Cn-r4wiv.js`);return{save:e,saveAs:t}},__vite__mapDeps([0,1,2,3,4,5,6]));switch(e){case 0:return i(this,t);case 1:return a(this,r,t)}})}normalizeCtorArgs(e,t){return typeof e==`string`?{url:e,...t}:e}load(e){let t=e==null?null:e.signal;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:[`WCS`]},e).catch(m).then(()=>this._openRaster(t))),Promise.resolve(this)}get renderer(){return super.renderer}set renderer(e){super.renderer=e}get coverageInfo(){return this.raster.coverageInfo}get defaultPopupTemplate(){return this.createPopupTemplate()}get rasterFields(){let e=[ne(`Pixel Value`)],t=(this.raster?.rasterInfo??this.serviceRasterInfo)?.multidimensionalInfo;if(t){let n=re(t);e.push(...n)}return e}createPopupTemplate(e){return l({fields:this.rasterFields,title:this.title},e)}async save(e){return this._debouncedSaveOperations(0,e)}async saveAs(e,t){return this._debouncedSaveOperations(1,t,e)}async _openRaster(e){let t=new Z({url:this.url,version:this.version,coverageId:this.coverageId,ioConfig:{sampling:`closest`,...this.ioConfig,customFetchParameters:this.customParameters}});if(await t.open({signal:e}),!t.rasterInfo)throw t.destroy(),new x(`wcs-layer:load`,`cannot load resources on `+this.url);let{rasterInfo:n}=t;n.noDataValue??=this.noData,this._set(`serviceRasterInfo`,n),this._set(`spatialReference`,n.spatialReference),this.title??this.setAtOrigin(`title`,t.datasetName,`service`),this.coverageId??this.setAtOrigin(`coverageId`,t.coverageInfo.id,`service`),this.version==null&&t.version&&this.setAtOrigin(`version`,t.version,`service`),this.setAtOrigin(`tileInfo`,t.rasterInfo.storageInfo.tileInfo,`service`);let{multidimensionalInfo:r}=n;if(r!=null){let e=r.variables[0].dimensions.find(({name:e})=>e===`StdTime`);if(e){let t=e.extent?.[0]??e.values[0];Array.isArray(t)&&(t=t[0]);let n=e.extent?.[1]??e.values[e.values.length-1];Array.isArray(n)&&(n=n[1]);let r=Xe.has(e.intervalUnit?.toLowerCase())?e.intervalUnit?.toLowerCase():null;this.set(`timeInfo`,{startField:`StdTime`,fullTimeExtent:{start:t,end:n},timeZone:null,interval:r?{value:e.interval,unit:r}:null})}}this.raster=t,this._configDefaultSettings(),this.addHandles(s(()=>this.customParameters,e=>this.raster.ioConfig.customFetchParameters=e))}};t([d({type:String,nonNullable:!0,json:{name:`wcsInfo.coverageId`,write:{isRequired:!0,ignoreOrigin:!0}}})],$.prototype,`coverageId`,void 0),t([d()],$.prototype,`coverageInfo`,null),t([d({type:[`1.0.0`,`1.1.0`,`1.1.1`,`1.1.2`,`2.0.1`],nonNullable:!0,json:{name:`wcsInfo.version`,write:{isRequired:!0,ignoreOrigin:!0}}})],$.prototype,`version`,void 0),t([d({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],$.prototype,`isReference`,void 0),t([d({json:{read:!0,write:!0}})],$.prototype,`blendMode`,void 0),t([d({readOnly:!0,clonable:!1})],$.prototype,`graphicOrigin`,void 0),t([d(i)],$.prototype,`legendEnabled`,void 0),t([d({type:[`show`,`hide`]})],$.prototype,`listMode`,void 0),t([d()],$.prototype,`noData`,void 0),t([d({type:[`WCS`]})],$.prototype,`operationalLayerType`,void 0),t([d()],$.prototype,`raster`,void 0),t([d({readOnly:!0})],$.prototype,`type`,void 0),t([d(o)],$.prototype,`popupEnabled`,void 0),t([d({type:w,json:{name:`popupInfo`,write:!0}})],$.prototype,`popupTemplate`,void 0),t([d({readOnly:!0})],$.prototype,`defaultPopupTemplate`,null),t([d({readOnly:!0,type:[e]})],$.prototype,`fields`,void 0),t([d({readOnly:!0,type:[e]})],$.prototype,`rasterFields`,null),$=t([T(`esri.layers.WCSLayer`)],$);var Ze=$;export{Ze as default};