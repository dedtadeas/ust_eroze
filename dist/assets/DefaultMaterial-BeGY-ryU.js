const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DefaultMaterial.glsl-C2mhxlgQ.js","assets/DefaultMaterial.glsl-CPcjrtyI.js","assets/index-BqmCqmfp.js","assets/index-kIqmb12G.css","assets/Transform.glsl-YgD9m_jl.js","assets/Float2BindUniform-BJ75NEvo.js","assets/Uniform-DXwqrKA1.js","assets/FloatBindUniform-TDSkRzMc.js","assets/glsl-C2sn87h0.js","assets/NoParameters-CpAItLvD.js","assets/ReadShadowMap.glsl-DONMmaDt.js","assets/Emissions.glsl-DaTtsIIp.js","assets/Float3DrawUniform-UsZpj3mh.js","assets/Float3PassUniform-Co8OqiAU.js","assets/FloatPassUniform-BEwJjV4q.js","assets/Texture2DDrawUniform-hiIQoiSn.js","assets/Texture2DPassUniform-Cd7cdF1a.js","assets/AlphaCutoff-DTq90Si4.js","assets/HighlightReadBitmap.glsl-DB3CoKpG.js","assets/Texture2DBindUniform-CSngcuNV.js","assets/PiUtils.glsl-CZJ_KlHj.js","assets/Float3BindUniform-BrSuqm5i.js","assets/Float4BindUniform-CtMVDjau.js","assets/MixExternalColor.glsl-n6kVrPsi.js","assets/View.glsl-B6vOoRsw.js","assets/Matrix4BindUniform-BUS9JrUC.js","assets/VisualVariables.glsl-xWfUXTFa.js","assets/FloatsPassUniform-BT-ZsPj-.js","assets/Float4PassUniform-Bo_mhcMi.js","assets/ObjectAndLayerIdColor.glsl-CrEuv_nr.js","assets/SnowCover.glsl-CxdL6slB.js","assets/SSAO.glsl-D6CAmj04.js","assets/ScreenSpacePass.glsl-Br3vxYsG.js","assets/ReadDepth.glsl-DvJ8t0GM.js","assets/CameraSpace.glsl-cnQVTSzq.js","assets/Float2PassUniform-D4VTGzqn.js","assets/ShaderBuilder-C3C7fUwK.js","assets/SSAOBlur.glsl-Cl8tUkbE.js","assets/Float2DrawUniform-BXYGUyM9.js","assets/SceneLighting-BWVxtKEm.js","assets/sphere-CicnK0Bn.js","assets/vectorStacks-CKtslZxP.js","assets/quatf64-CJzmL3cc.js","assets/projectPointToVector-Clou1sfo.js","assets/projectVectorToVector-D-Bbb8fP.js","assets/dehydratedPoint-Dwb3orme.js","assets/frustum-DNBPrNIX.js","assets/plane-CTjDePZl.js","assets/lineSegment-uFalXigL.js","assets/orientedBoundingBox-DZQLHGx0.js","assets/quat-Bk_ZaVz9.js","assets/computeTranslationToOriginAndRotation-BC3OuSky.js","assets/spatialReferenceEllipsoidUtils-DBtdxVkA.js","assets/HUDIntersectorResult-CCf93UUm.js","assets/VertexAttributeLocations-IAhvKZqd.js","assets/VertexElementDescriptor-BGWnA0Rs.js","assets/renderState-Be6uDhGv.js","assets/BooleanBindUniform-8vtZmSI6.js","assets/IntegerPassUniform-zyEEceJY.js","assets/Matrix4PassUniform-DbEU5DCd.js","assets/MaterialUtil-DdudaLIK.js","assets/VertexColor.glsl-CHR9Q-WR.js","assets/VerticalOffset.glsl-DYy5IZ2H.js","assets/ScreenSizePerspective.glsl-CRhKUJLC.js","assets/Normals.glsl-BlytCSCC.js","assets/TerrainDepthTest.glsl-neHlKy5u.js","assets/OutputColorHighlightOID.glsl-MUXZi3dC.js","assets/RealisticTree.glsl-D-LIAP18.js","assets/RealisticTree.glsl-CbVkeEfD.js"])))=>i.map(i=>d[i]);
import{$l as e,CD as t,Cw as n,Fl as r,H_ as i,Il as a,Jg as o,Jl as s,K_ as c,Kg as l,MC as u,OC as d,Oh as f,Ol as ee,Wg as p,Wl as m,Xg as h,hD as te,jl as ne,kC as re,k_ as ie,lD as g,np as _,nu as ae,pD as oe,q_ as se,ru as ce,vt as le,wC as ue}from"./index-BqmCqmfp.js";import{T as de}from"./plane-CTjDePZl.js";import{O as v,b as y,l as b}from"./BufferView-DNaZpbJX.js";import{a as x}from"./Util-3rPi0NfK.js";import{g as S,h as C,m as w,r as fe}from"./Emissions.glsl-DaTtsIIp.js";import{r as pe}from"./VertexAttributeLocations-IAhvKZqd.js";import{t as me}from"./VertexBuffer-DL5rIQzc.js";import{a as he,n as ge,r as _e}from"./renderState-Be6uDhGv.js";import{B as ve,D as ye,F as be,L as xe,O as Se,P as T,R as E,V as D,c as O,o as k,p as A,t as j,u as Ce,z as we}from"./DefaultBufferWriter-BihhFqiH.js";import{t as Te}from"./MaterialUtil-DdudaLIK.js";import{c as M,f as Ee,o as De,s as Oe}from"./SceneLighting-BWVxtKEm.js";import{a as N,s as P}from"./FloatArray-cqhQU3FO.js";import{d as F}from"./FloatsPassUniform-BT-ZsPj-.js";import{t as I}from"./AlphaCutoff-DTq90Si4.js";import{c as ke,u as Ae}from"./MixExternalColor.glsl-n6kVrPsi.js";import{d as je}from"./SnowCover.glsl-CxdL6slB.js";import{n as Me}from"./DefaultMaterial.glsl-CPcjrtyI.js";import{n as Ne}from"./RealisticTree.glsl-CbVkeEfD.js";var Pe=class{constructor(e,t,n){this.elementSize=t.stride,this._buffer=new me(e,P(t,1)),this.resize(n)}destroy(){this._buffer.dispose()}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get usedMemory(){return this._array.byteLength+this._buffer.usedMemory}copyRange(e,t,n,r=0){let i=new Uint8Array(this.array,e*this.elementSize,(t-e)*this.elementSize);new Uint8Array(n.array,r*this.elementSize).set(i)}transferAll(){this._buffer.setData(this._array)}transferRange(e,t){let n=e*this.elementSize,r=t*this.elementSize;this._buffer.setSubData(new Uint8Array(this._array),n,n,r)}resize(e){let t=e*this.elementSize,n=new ArrayBuffer(t);this._array&&(e>=this._capacity?new Uint8Array(n).set(new Uint8Array(this._array)):new Uint8Array(n).set(new Uint8Array(this._array).subarray(0,e*this.elementSize))),this._array=n,this._buffer.setSize(t),this._capacity=e}},L=class{constructor(e){this.localTransform=e.localTransform,this.globalTransform=e.globalTransform,this.modelOrigin=e.modelOrigin,this.model=e.instanceModel,this.modelNormal=e.instanceModelNormal,this.modelScaleFactors=e.modelScaleFactors,this.boundingSphere=e.boundingSphere,this.featureAttribute=e.getField(`instanceFeatureAttribute`,y),this.color=e.getField(`instanceColor`,v),this.olidColor=e.getField(`instanceOlidColor`,v),this.state=e.getField(`state`,b),this.lodLevel=e.getField(`lodLevel`,b)}},R=class extends d{constructor(e,t){super(e),this.events=new ue,this._capacity=0,this._size=0,this._next=0,this._highlightOptionsMap=new Map,this._highlightOptionsMapPrev=new Map,this._layout=Le(t),this._capacity=64,this._buffer=this._layout.createBuffer(this._capacity),this._view=new L(this._buffer)}get capacity(){return this._capacity}get size(){return this._size}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();let e=this._findSlot();return this._view.state.set(e,1),this._size++,this.events.emit(`instances-changed`),e}removeInstance(e){let t=this._view.state;x(e>=0&&e<this._capacity&&!!(1&t.get(e)),`invalid instance handle`),this._getStateFlag(e,18)?this._setStateFlags(e,32):this.freeInstance(e),this.events.emit(`instances-changed`)}freeInstance(e){let t=this._view.state;x(e>=0&&e<this._capacity&&!!(1&t.get(e)),`invalid instance handle`),t.set(e,0),this._size--}setLocalTransform(e,t,n=!0){this._view.localTransform.setMat(e,t),n&&this.updateModelTransform(e)}getLocalTransform(e,t){this._view.localTransform.getMat(e,t)}setGlobalTransform(e,t,n=!0){this._view.globalTransform.setMat(e,t),n&&this.updateModelTransform(e)}getGlobalTransform(e,t){this._view.globalTransform.getMat(e,t)}updateModelTransform(t){let n=this._view,r=B,a=V;n.localTransform.getMat(t,H),n.globalTransform.getMat(t,U);let o=f(U,U,H);e(r,o[12],o[13],o[14]),n.modelOrigin.setVec(t,r),i(a,o),n.model.setMat(t,a);let s=de(B,o);s.sort(),n.modelScaleFactors.set(t,0,s[1]),n.modelScaleFactors.set(t,1,s[2]),c(a,a),se(a,a),n.modelNormal.setMat(t,a),this._setStateFlags(t,64),this.events.emit(`instance-transform-changed`,{index:t})}getModelTransform(e,t){let n=this._view;n.model.getMat(e,V),n.modelOrigin.getVec(e,B),t[0]=V[0],t[1]=V[1],t[2]=V[2],t[3]=0,t[4]=V[3],t[5]=V[4],t[6]=V[5],t[7]=0,t[8]=V[6],t[9]=V[7],t[10]=V[8],t[11]=0,t[12]=B[0],t[13]=B[1],t[14]=B[2],t[15]=1}applyShaderTransformation(e,t){this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,t)}getCombinedModelTransform(e,t){return this.getModelTransform(e,t),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,t),t}getCombinedLocalTransform(e,t){this._view.localTransform.getMat(e,t),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,t)}getCombinedMaxScaleFactor(e){let t=this._view.modelScaleFactors.get(e,1);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(B,this,e),t*=Math.max(B[0],B[1],B[2])),t}getCombinedMedianScaleFactor(e){let t=this._view.modelScaleFactors.get(e,0);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(B,this,e),t*=Fe(B[0],B[1],B[2])),t}getModel(e,t){this._view.model.getMat(e,t)}setFeatureAttribute(e,t){this._view.featureAttribute?.setVec(e,t)}getFeatureAttribute(e,t){this._view.featureAttribute?.getVec(e,t)}setColor(e,t){this._view.color?.setVec(e,t)}setObjectAndLayerIdColor(e,t){this._view.olidColor?.setVec(e,t)}setVisible(e,t){t!==this.getVisible(e)&&(this._setStateFlag(e,4,t),this.events.emit(`instance-visibility-changed`,{index:e}))}getVisible(e){return this._getStateFlag(e,4)}setHighlight(e,t){let{_highlightOptionsMap:n}=this,r=n.get(e);t?t!==r&&(n.set(e,t),this._setStateFlag(e,8,!0),this.events.emit(`instance-highlight-changed`)):r&&(n.delete(e),this._setStateFlag(e,8,!1),this.events.emit(`instance-highlight-changed`))}get highlightOptionsMap(){return this._highlightOptionsMap}getHighlightStateFlag(e){return this._getStateFlag(e,8)}geHighlightOptionsPrev(e){let t=this._highlightOptionsMapPrev.get(e)??null;return this._highlightOptionsMapPrev.delete(e),t}getHighlightName(e){let t=this.highlightOptionsMap.get(e)??null;return t?this._highlightOptionsMapPrev.set(e,t):this._highlightOptionsMapPrev.delete(e),t}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let t=0;for(let n=0;n<this._capacity;++n)this.getState(n)&e&&++t;return t}_setStateFlags(e,t){let n=this._view.state;t=n.get(e)|t,n.set(e,t)}_clearStateFlags(e,t){let n=this._view.state;t=n.get(e)&~t,n.set(e,t)}_setStateFlag(e,t,n){n?this._setStateFlags(e,t):this._clearStateFlags(e,t)}_getStateFlag(e,t){return!!(this._view.state.get(e)&t)}_grow(){this._capacity=Math.max(64,Math.floor(this._capacity*g)),this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer),this._view=new L(this._buffer)}_findSlot(){let e=this._view.state,t=this._next;for(;1&e.get(t);)t=t+1===this._capacity?0:t+1;return this._next=t+1===this._capacity?0:t+1,t}};function Fe(e,t,n){return Math.max(Math.min(e,t),Math.min(Math.max(e,t),n))}t([u({constructOnly:!0})],R.prototype,`shaderTransformation`,void 0),t([u()],R.prototype,`_size`,void 0),t([u({readOnly:!0})],R.prototype,`size`,null),R=t([re(`esri.views.3d.webgl-engine.lib.lodRendering.InstanceData`)],R);var Ie=N().mat4f64(`localTransform`).mat4f64(`globalTransform`).vec4f64(`boundingSphere`).vec3f64(`modelOrigin`).mat3f(`instanceModel`).mat3f(`instanceModelNormal`).vec2f(`modelScaleFactors`);function Le(e){return z(Ie.clone(),e).u8(`state`).u8(`lodLevel`)}function z(e,t){return t.instancedFeatureAttribute&&e.vec4f(`instanceFeatureAttribute`),t.instancedColor&&e.vec4u8(`instanceColor`),F()&&e.vec4u8(`instanceOlidColor`),e}var B=o(),V=ie(),H=_(),U=_(),Re=class{constructor(e){this.model=e.instanceModel,this.modelNormal=e.instanceModelNormal,this.modelOriginHi=e.instanceModelOriginHi,this.modelOriginLo=e.instanceModelOriginLo,this.featureAttribute=e.getField(`instanceFeatureAttribute`,y),this.color=e.getField(`instanceColor`,v),this.olidColor=e.getField(`instanceOlidColor`,v)}},ze=class{constructor(e,t){this._rctx=e,this._layout=t,this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){let e=this._headIndex,t=this._tailIndex;return e>=t?e-t:e+this._capacity-t}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get usedMemory(){return this._buffer?.usedMemory??0}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){x(!this._updating,`already updating`),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){x(this._updating,`not updating`),this.size<.5*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){x(this._updating,`not updating`),this.isFull&&this._grow();let e=this.headIndex;return this._captureFirstIndex&&=(this._firstIndex=e,!1),this._incrementHead(),x(this._headIndex!==this._tailIndex,`invalid pointers`),e}freeTail(){x(this._updating,`not updating`),x(this.size>0,`invalid size`);let e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}_grow(){let e=Math.max(64,Math.floor(this._capacity*g));this._resize(e)}_shrink(){let e=Math.max(64,Math.floor(this._capacity*te));this._resize(e)}_resize(e){if(x(this._updating,`not updating`),e===this._capacity)return;let t=new Pe(this._rctx,this._layout,e);if(this._buffer){this._firstIndex&&=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity;let e=this.size,n=this._compactInstances(t);x(n===e,`invalid compaction`),this._buffer.destroy(),this._tailIndex=0,this._headIndex=n,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=t,this._view=new Re(this._layout.createView(this._buffer.array))}_compactInstances(e){let t=this._headIndex,n=this._tailIndex;return n<t?(this._buffer.copyRange(n,t,e),t-n):n>t?(this._buffer.copyRange(n,this._capacity,e),t>0&&this._buffer.copyRange(0,t,e,this._capacity-n),t+(this._capacity-n)):0}_incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}_incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}_transferRange(e,t){e<t?this._buffer.transferRange(e,t):e>t&&(t>0&&this._buffer.transferRange(0,t),this._buffer.transferRange(e,this._capacity))}},Be=N().vec3f(`instanceModelOriginHi`).vec3f(`instanceModelOriginLo`).mat3f(`instanceModel`).mat3f(`instanceModelNormal`);function W(e){return z(Be.clone(),e)}var Ve=class extends Ae{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=je,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType=`normal`,this.cullFace=2,this.instanced=!1,this.instancedFeatureAttribute=!1,this.instancedColor=!1,this.instanceColorEncodesAlphaIgnore=!1,this.emissiveStrength=0,this.emissiveSource=1,this.emissiveBaseColor=p,this.instancedDoublePrecision=!1,this.normalType=0,this.receiveShadows=!0,this.receiveAmbientOcclusion=!0,this.castShadows=!0,this.ambient=l(.2,.2,.2),this.diffuse=l(.8,.8,.8),this.externalColor=le(1,1,1,1),this.colorMixMode=`multiply`,this.opacity=1,this.layerOpacity=1,this.origin=o(),this.hasSlicePlane=!1,this.offsetTransparentBackfaces=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.modelTransformation=null,this.drivenOpacity=!1,this.writeDepth=!0,this.customDepthTest=0,this.textureAlphaMode=0,this.textureAlphaCutoff=I,this.textureAlphaPremultiplied=!1,this.renderOccluded=1,this.isDecoration=!1}get hasVVSize(){return!!this.vvSize}get hasVVColor(){return!!this.vvColor}get hasVVOpacity(){return!!this.vvOpacity}},He=class extends ke{constructor(){super(...arguments),this.origin=o(),this.slicePlaneLocalOrigin=this.origin}},G=class extends Oe{constructor(e,t,r=new M(Me,()=>n(()=>import(`./DefaultMaterial.glsl-C2mhxlgQ.js`),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66])))){let i=[P(K(t))];t.instanced&&t.instancedDoublePrecision&&i.push(P(W(t))),super(e,t,r,pe(i))}_makePipeline(e,t){let{oitPass:n,output:r,transparent:i,cullFace:a,customDepthTest:o,hasOccludees:s}=e;return ge({blending:C(r)&&i?be(n):null,culling:We(e)?_e(a):null,depthTest:{func:D(n,Ue(o))},depthWrite:E(e),drawBuffers:De(r,xe(n,r)),colorWrite:he,stencilWrite:s?Ce:null,stencilTest:s?t?A:O:null,polygonOffset:ve(e)})}initializePipeline(e){return this._occludeePipelineState=this._makePipeline(e,!0),this._makePipeline(e,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};function Ue(e){switch(e){case 1:return 515;case 0:case 3:return 513;case 2:return 516}}function We(e){return e.cullFace!==0||!e.hasSlicePlane&&!e.transparent&&!e.doubleSidedMode}function K(e){let t=N().vec3f(`position`);return e.normalType===1?t.vec2i16(`normalCompressed`,{glNormalized:!0}):t.vec3f(`normal`),e.hasVertexTangents&&t.vec4f(`tangent`),e.hasTextures&&t.vec2f16(`uv0`),e.hasVertexColors&&t.vec4u8(`color`),e.hasSymbolColors&&t.vec4u8(`symbolColor`),!e.instanced&&F()&&t.vec4u8(`olidColor`),t}var q=class extends Se{constructor(e){super(),this.spherical=e,this.alphaDiscardMode=1,this.doubleSidedMode=0,this.pbrMode=0,this.cullFace=0,this.normalType=0,this.customDepthTest=0,this.emissionSource=0,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.instanced=!1,this.instancedDoublePrecision=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.hasVVSize=!1,this.hasVVColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instancedFeatureAttribute=!1,this.instancedColor=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1,this.occlusionPass=!1,this.useCustomDTRExponentForWater=!1,this.useFillLights=!0,this.draped=!1}get textureCoordinateType(){return this.hasTextures?1:0}get hasTextures(){return this.hasColorTexture||this.hasNormalTexture||this.hasMetallicRoughnessTexture||this.emissionSource===3||this.hasOcclusionTexture}get hasVVInstancing(){return this.instanced}get discardInvisibleFragments(){return this.transparent}};t([T({count:4})],q.prototype,`alphaDiscardMode`,void 0),t([T({count:3})],q.prototype,`doubleSidedMode`,void 0),t([T({count:7})],q.prototype,`pbrMode`,void 0),t([T({count:3})],q.prototype,`cullFace`,void 0),t([T({count:3})],q.prototype,`normalType`,void 0),t([T({count:3})],q.prototype,`customDepthTest`,void 0),t([T({count:8})],q.prototype,`emissionSource`,void 0),t([T()],q.prototype,`hasVertexColors`,void 0),t([T()],q.prototype,`hasSymbolColors`,void 0),t([T()],q.prototype,`hasVerticalOffset`,void 0),t([T()],q.prototype,`hasColorTexture`,void 0),t([T()],q.prototype,`hasMetallicRoughnessTexture`,void 0),t([T()],q.prototype,`hasOcclusionTexture`,void 0),t([T()],q.prototype,`hasNormalTexture`,void 0),t([T()],q.prototype,`hasScreenSizePerspective`,void 0),t([T()],q.prototype,`hasVertexTangents`,void 0),t([T()],q.prototype,`hasOccludees`,void 0),t([T()],q.prototype,`instanced`,void 0),t([T()],q.prototype,`instancedDoublePrecision`,void 0),t([T()],q.prototype,`hasModelTransformation`,void 0),t([T()],q.prototype,`offsetBackfaces`,void 0),t([T()],q.prototype,`hasVVSize`,void 0),t([T()],q.prototype,`hasVVColor`,void 0),t([T()],q.prototype,`receiveShadows`,void 0),t([T()],q.prototype,`receiveAmbientOcclusion`,void 0),t([T()],q.prototype,`textureAlphaPremultiplied`,void 0),t([T()],q.prototype,`instancedFeatureAttribute`,void 0),t([T()],q.prototype,`instancedColor`,void 0),t([T()],q.prototype,`writeDepth`,void 0),t([T()],q.prototype,`transparent`,void 0),t([T()],q.prototype,`enableOffset`,void 0),t([T()],q.prototype,`terrainDepthTest`,void 0),t([T()],q.prototype,`cullAboveTerrain`,void 0),t([T()],q.prototype,`snowCover`,void 0),t([T()],q.prototype,`hasColorTextureTransform`,void 0),t([T()],q.prototype,`hasEmissionTextureTransform`,void 0),t([T()],q.prototype,`hasNormalTextureTransform`,void 0),t([T()],q.prototype,`hasOcclusionTextureTransform`,void 0),t([T()],q.prototype,`hasMetallicRoughnessTextureTransform`,void 0);var Ge=class extends G{constructor(e,t){super(e,t,new M(Ne,()=>n(()=>import(`./RealisticTree.glsl-D-LIAP18.js`),__vite__mapDeps([67,68,4,2,3,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,65,66]))))}},Ke=class extends ye{constructor(e,t){super(e,J),this.materialType=`default`,this.supportsEdges=!0,this.intersectDraped=void 0,this.produces=new Map([[2,e=>(S(e)||w(e))&&!this.transparent],[4,e=>(S(e)||w(e))&&this.transparent&&this.parameters.writeDepth],[8,e=>(S(e)||w(e))&&this.transparent&&!this.parameters.writeDepth]]),this._layout=K(this.parameters),this._configuration=new q(t.spherical)}isVisibleForOutput(e){return e!==4&&e!==6&&e!==5||this.parameters.castShadows}get visible(){let{layerOpacity:e,colorMixMode:t,opacity:n,externalColor:r}=this.parameters;return e*(t===`replace`?1:n)*(t===`ignore`||isNaN(r[3])?1:r[3])>=I}get _hasEmissiveBase(){return!!this.parameters.emissiveTextureId||!ne(this.parameters.emissiveBaseColor,p)}get hasEmissions(){return this.parameters.emissiveStrength>0&&(this.parameters.emissiveSource===0&&this._hasEmissiveBase||this.parameters.emissiveSource===1)}getConfiguration(e,t){let{parameters:n,_configuration:r}=this,{treeRendering:i,doubleSided:a,doubleSidedType:o}=n;return super.getConfiguration(e,t,this._configuration),r.hasNormalTexture=n.hasNormalTexture,r.hasColorTexture=n.hasColorTexture,r.hasMetallicRoughnessTexture=n.hasMetallicRoughnessTexture,r.hasOcclusionTexture=n.hasOcclusionTexture,r.hasVertexTangents=!i&&n.hasVertexTangents,r.instanced=n.instanced,r.instancedDoublePrecision=n.instancedDoublePrecision,r.hasVVColor=!!n.vvColor,r.hasVVSize=!!n.vvSize,r.hasVerticalOffset=n.verticalOffset!=null,r.hasScreenSizePerspective=n.screenSizePerspective!=null,r.hasSlicePlane=n.hasSlicePlane,r.alphaDiscardMode=n.textureAlphaMode,r.normalType=i?0:n.normalType,r.transparent=this.transparent,r.writeDepth=n.writeDepth,r.customDepthTest=n.customDepthTest??0,r.hasOccludees=t.hasOccludees,r.cullFace=n.hasSlicePlane?0:n.cullFace,r.cullAboveTerrain=t.cullAboveTerrain,r.hasModelTransformation=!i&&n.modelTransformation!=null,r.hasVertexColors=n.hasVertexColors,r.hasSymbolColors=n.hasSymbolColors,r.doubleSidedMode=i?2:a&&o===`normal`?1:a&&o===`winding-order`?2:0,r.instancedFeatureAttribute=n.instancedFeatureAttribute,r.instancedColor=n.instancedColor,C(e)?(r.terrainDepthTest=t.terrainDepthTest,r.receiveShadows=n.receiveShadows,r.receiveAmbientOcclusion=n.receiveAmbientOcclusion&&t.ssao!=null):(r.terrainDepthTest=!1,r.receiveShadows=r.receiveAmbientOcclusion=!1),r.textureAlphaPremultiplied=!!n.textureAlphaPremultiplied,r.pbrMode=n.usePBR?n.isSchematic?2:1:0,r.emissionSource=n.emissionSource,r.offsetBackfaces=!(!this.transparent||!n.offsetTransparentBackfaces),r.oitPass=t.oitPass,r.enableOffset=t.camera.relativeElevation<we,r.snowCover=t.snowCover>0,r.hasColorTextureTransform=!!n.colorTextureTransformMatrix,r.hasNormalTextureTransform=!!n.normalTextureTransformMatrix,r.hasEmissionTextureTransform=!!n.emissiveTextureTransformMatrix,r.hasOcclusionTextureTransform=!!n.occlusionTextureTransformMatrix,r.hasMetallicRoughnessTextureTransform=!!n.metallicRoughnessTextureTransformMatrix,r}intersect(t,n,i,o,c,l){if(this.parameters.verticalOffset!=null){let t=i.camera;e($,n[12],n[13],n[14]);let l=null;switch(i.viewingMode){case 1:l=ee(Z,$);break;case 2:l=ce(Z,Ye)}let u=0,d=m(Xe,$,t.eye),f=ae(d),p=s(d,d,1/f),h=null;this.parameters.screenSizePerspective&&(h=a(l,p)),u+=Te(t,f,this.parameters.verticalOffset,h??0,this.parameters.screenSizePerspective,null),s(l,l,u),r(Q,l,i.transform.inverseRotation),o=m(X,o,Q),c=m(Je,c,Q)}k(t,i,o,c,Ee(i.verticalOffset),l)}createGLMaterial(e){return new qe(e)}createBufferWriter(){return new j(this._layout)}get transparent(){return Y(this.parameters)}},qe=class extends fe{constructor(e){super({...e,...e.material.parameters})}beginSlot(t){this._material.setParameters({receiveShadows:t.shadowMap.enabled});let n=this._material.parameters;this.updateTexture(n.textureId);let r=t.camera.viewInverseTransposeMatrix;return e(n.origin,r[3],r[7],r[11]),this._material.setParameters(this.textureBindParameters),this.getTechnique(n.treeRendering?Ge:G,t)}},J=class extends Ve{constructor(){super(...arguments),this.treeRendering=!1,this.hasVertexTangents=!1}get hasNormalTexture(){return!this.treeRendering&&!!this.normalTextureId}get hasColorTexture(){return!!this.textureId}get hasMetallicRoughnessTexture(){return!this.treeRendering&&!!this.metallicRoughnessTextureId}get hasOcclusionTexture(){return!this.treeRendering&&!!this.occlusionTextureId}get emissionSource(){return this.treeRendering?0:this.emissiveTextureId!=null&&this.emissiveSource===0?3:this.usePBR?this.emissiveSource===0?2:1:0}get hasTextures(){return this.hasColorTexture||this.hasNormalTexture||this.hasMetallicRoughnessTexture||this.emissionSource===3||this.hasOcclusionTexture}};function Y(e){let{drivenOpacity:t,opacity:n,externalColor:r,layerOpacity:i,texture:a,textureId:o,textureAlphaMode:s,colorMixMode:c}=e,l=r[3];return t||n<1&&c!==`replace`||l<1&&c!==`ignore`||i<1||(a!=null||o!=null)&&s!==1&&s!==2&&c!==`replace`}var X=o(),Je=o(),Ye=h(0,0,1),Z=o(),Q=o(),$=o(),Xe=o();export{ze as a,He as i,Ke as n,W as o,J as r,R as s,Y as t};