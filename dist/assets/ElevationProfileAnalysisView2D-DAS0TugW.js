const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/lengthOperator-CDbTNtoR.js","assets/UnitFactory-J9WMNXdY.js","assets/index-BqmCqmfp.js","assets/index-kIqmb12G.css","assets/Envelope2D-BNwQDrOT.js","assets/Point2D-UYEfE6HP.js","assets/OperatorDefinitions-DQQu7-BK.js","assets/SimpleGeometryCursor-CI9GIWKa.js","assets/Transformation2D-DVoPQwGC.js","assets/lengthOperator-Bek34LVo.js","assets/apiConverter-DVPFZqjR.js","assets/jsonConverter-DiNOXEUJ.js"])))=>i.map(i=>d[i]);
import{Am as e,Ax as t,Bg as n,CD as r,Cl as i,Cw as a,Dy as o,Em as s,Hb as c,Id as l,Jx as u,Kb as d,Ky as f,MC as p,Ml as m,OC as h,Qw as g,Qx as _,Ry as ee,SC as te,ST as v,TC as ne,Tv as y,Ub as b,Ux as x,Vb as S,Vg as re,Vw as ie,Vy as ae,Wy as oe,Xw as se,Yd as ce,Yw as le,Zw as ue,_E as de,_d as fe,_v as pe,aS as C,aT as me,bg as he,cT as ge,dD as _e,dT as w,fC as ve,fu as ye,gC as be,gg as xe,iT as T,jE as E,jS as Se,kC as D,lp as Ce,mT as O,nD as we,nT as Te,oT as Ee,pS as k,qb as A,qn as De,qx as Oe,ra as ke,rb as Ae,sT as je,tD as Me,vT as j,wT as Ne,wm as Pe,yg as M}from"./index-BqmCqmfp.js";import"./SimpleGeometryCursor-CI9GIWKa.js";import"./Point2D-UYEfE6HP.js";import"./Envelope2D-BNwQDrOT.js";import"./UnitFactory-J9WMNXdY.js";import"./Transformation2D-DVoPQwGC.js";import"./OperatorDefinitions-DQQu7-BK.js";import"./jsonConverter-DiNOXEUJ.js";import"./apiConverter-DVPFZqjR.js";import"./geodeticCurveType-hqCRc72W.js";import"./geodeticLengthOperator-Bd7syy7j.js";import"./Distance2DCalculator-CXhBP-8I-Xmr2hQVp.js";import"./distanceOperator-5uQbTYel.js";import"./operatorSimplify-BpM6lQIp.js";import"./simplifyOperator-CVaMEoed.js";import"./quatf64-CJzmL3cc.js";import"./quat-Bk_ZaVz9.js";import"./earcut-Drx511Ix.js";import"./vectorStacks-CKtslZxP.js";import"./plane-CTjDePZl.js";import"./projectPointToVector-Clou1sfo.js";import"./spatialReferenceEllipsoidUtils-DBtdxVkA.js";import"./dehydratedPoint-Dwb3orme.js";import"./projectVectorToVector-D-Bbb8fP.js";import"./sphere-CicnK0Bn.js";import{S as Fe,d as Ie,l as Le,o as Re}from"./elevationInfoUtils-Df_uYU_q.js";import{s as ze}from"./colorUtils-uG2qTogT.js";import{t as Be}from"./GraphicsLayer-BGvt7_Y1.js";import{t as Ve}from"./GeometryDescriptor-BAsgbvB_.js";import{t as He}from"./throttle-C7RAnISb.js";import{a as Ue,i as We,n as Ge,s as Ke}from"./geodesicUtils-DJORTTMv.js";import{a as qe}from"./createUtils-DwAaa929.js";import{t as Je}from"./mapCollectionUtils-BFnXgZfs.js";import{t as Ye}from"./getDefaultUnitForView-CBP34vcm.js";import{t as Xe}from"./SketchViewModel-BCYoa7_w.js";import"./isSupportedObject-CNmfINgj.js";import"./layerUtils-DVQFdwBE.js";import"./SketchOptions-CfisVcr8.js";import"./LineSnappingHint-BAcwqgNT.js";import"./ParallelSnappingHint-Knbe-U69.js";import"./snappingUtils-CbrwOS61.js";import"./constraints-DXu8cqG3.js";import"./SnappingCandidate-BzUm7cf4.js";import"./EdgeSnappingCandidate-C1pApw0q.js";import"./DrapedEdgeSnappingCandidate-Ck4Ob_c8.js";import"./IntersectionSnappingHint-C3U4Rx6H.js";import"./IntersectionSnappingCandidate-Cv9i7Mdt.js";import"./LineSnappingCandidate-Cp24TJlP.js";import"./RightAngleTriangleSnappingCandidate-B-XFn7NT.js";import"./RightAngleSnappingHint--LJCiSno.js";import"./viewUtils-CPzQ7QWB.js";import"./viewUtils-CtJQ47Dj.js";import"./quantityUtils-Dywg00j-.js";import"./euclideanLengthMeasurementUtils-Bhl6nD1D.js";import"./lineSegment-uFalXigL.js";import"./triangle-1kWe4-AP.js";import"./hitTestSelectUtils-CyV_4TZP.js";var N=class extends be(ne){constructor(){super(...arguments),this.parent=null,this._userInteractive=!1,this._interactiveViewModelCount=0}get interactive(){return this._interactiveViewModelCount>0||this._userInteractive}set interactive(e){this._userInteractive=e}get updating(){return!1}get visible(){return(this.parent?.visible&&!this.parent.suspended)??!0}set visible(e){this._overrideIfSome(`visible`,e)}forceInteractive(){return this._interactiveViewModelCount++,j(()=>this._interactiveViewModelCount--)}};r([p({constructOnly:!0})],N.prototype,`parent`,void 0),r([p({constructOnly:!0})],N.prototype,`view`,void 0),r([p({type:Boolean})],N.prototype,`interactive`,null),r([p()],N.prototype,`_userInteractive`,void 0),r([p({readOnly:!0})],N.prototype,`updating`,null),r([p()],N.prototype,`visible`,null),r([p()],N.prototype,`_interactiveViewModelCount`,void 0),N=r([D(`esri.views.analysis.AnalysisView`)],N);var P=class extends N{};P=r([D(`esri.views.2d.analysis.AnalysisView2D`)],P);function Ze(e){return Ne([d(()=>{let{analysis:t,sketchGraphic:n,toolState:r,visible:i}=e.analysisViewData,{geometryVisualizationVisible:a}=t.viewOptions;return{geometryVisualizationVisible:a,geometry:t.geometry,sketchGraphic:n,toolState:r,visible:i}},({geometryVisualizationVisible:t,sketchGraphic:n,toolState:r,visible:i})=>{if(e.remove(),i)return t&&n!=null&&r!==`reshaping`&&r!==`sketching`?e.show(n):void 0},A)])}var F=class extends h{constructor(e){super(e)}initialize(){this.addHandles(Ze({analysisViewData:this.analysisViewData,remove:()=>{},show:()=>{}}))}get updating(){return!1}};r([p({constructOnly:!0})],F.prototype,`view`,void 0),r([p({constructOnly:!0})],F.prototype,`analysisViewData`,void 0),r([p()],F.prototype,`updating`,null),F=r([D(`esri.views.2d.analysis.ElevationProfile.ElevationProfileInputVisualization2D`)],F);var Qe={noDataValue:-5e5,defaultQueryOptions:()=>({noDataValue:Qe.noDataValue,demResolution:`auto`,maximumAutoTileRequests:150,ignoreInvisibleLayers:!0,signal:null}),updateThrottleMillis:100,delayAfterPreviewMillis:500,defaultDemResolution:_(10,`centimeters`,`meters`),densificationMaxSamples:3e3,largeChartSamples:1e4,maxTotalSamples:1e5,maxChartRatio:300,minSlopeSampleDistance:10,formatPrecision:1,profileLinesUpdateThrottleMillis:100,hoveredPointsStyle:{size:14,borderStyle:`solid`,borderWidth:3,borderColor:`#ffffff`,boxShadow:`0px 0px 0px 5px rgba(255,255,255,0.2)`}};function I(){return Qe}var $e={progress:1,hasZ:!1,samples:[],statistics:null,spatialReference:null};function et(e,t){e??=[];let n=e.length-1,r=[],i=[];for(let t=0;t<=n;t++){let{x:a,y:o,z:s}=e[t];s!=null&&i.push([a,o,s]),t!==n&&s!=null||!i.length||(r.push(i),i=[])}return qe(r,t,!0)}var L=class extends h{constructor(e){super(e),this._graphic=new l,this._layer=new Be({listMode:`hide`,internal:!0}),this._updateGeometryThrottled=He(e=>{if(!e)return void(this._graphic.visible=!1);let t=this._layer,n=this.view.map?.layers;n&&(n.includes(t)||n.add(t),n.reorder(t,0)),this._graphic.visible=!0,this._graphic.geometry=et(e.samples,e.spatialReference)},I().profileLinesUpdateThrottleMillis)}initialize(){this._layer.add(this._graphic),this.addHandles([b(()=>!this.analysisViewData.visible,()=>{this._graphic.visible=!1}),d(()=>this._colorUpdateParameters,e=>this._updateColor(e),A),d(()=>this.analysisViewData.analysis.geometry,()=>{this._graphic.visible=!1},A),d(()=>this._geometryUpdateParameters,e=>this._updateGeometryThrottled(e),A),this._updateGeometryThrottled])}destroy(){this.view.map?.remove(this._layer),this._layer.destroy(),this._graphic.destroy()}get updating(){return this._updateGeometryThrottled.hasPendingUpdates()}get _result(){let{analysisViewData:e}=this;return e.visible?e.results.find(({available:e,computation:t,rawResult:n})=>e&&t.profile.viewOptions.lineVisible&&!0===n?.hasZ):null}get _geometryUpdateParameters(){let e=this._result;return e?.progress===1?{samples:e.samples,spatialReference:this.view.spatialReference}:null}get _colorUpdateParameters(){let e=this._result?.computation.profile.color;return e?{color:e.toArray(),contrastColor:ze(e).toArray()}:null}_updateColor(e){e&&(this._graphic.symbol=new Ce({data:{type:`CIMSymbolReference`,symbol:{type:`CIMLineSymbol`,symbolLayers:[{type:`CIMSolidStroke`,capStyle:`Butt`,color:e.color,effects:[{type:`CIMGeometricEffectDashes`,dashTemplate:[5,4],lineDashEnding:`FullGap`,controlPointEnding:`NoConstraint`}],joinStyle:`Round`,width:1.5},{type:`CIMSolidStroke`,capStyle:`Butt`,color:e.contrastColor,joinStyle:`Round`,width:1.5}]}}}))}};r([p({constructOnly:!0})],L.prototype,`view`,void 0),r([p({constructOnly:!0})],L.prototype,`analysisViewData`,void 0),r([p()],L.prototype,`updating`,null),r([p()],L.prototype,`_result`,null),r([p()],L.prototype,`_geometryUpdateParameters`,null),r([p()],L.prototype,`_colorUpdateParameters`,null),L=r([D(`esri.views.2d.analysis.ElevationProfile.ElevationProfileLineVisualization2D`)],L);var R=class extends h{constructor(e){super(e),this.position=null,this.color=new oe(`#ffffff`),this.element=tt()}initialize(){this.addHandles([d(()=>this._screenLocation,e=>{e&&(this.element.style.transform=`translate(${e.x}px, ${e.y}px)`)},A),d(()=>this.color.toCss(),e=>{this.element.style.background=e},A)]),this.view.surface?.appendChild(this.element)}destroy(){this.element.remove()}get _screenLocation(){let{position:e,view:t}=this;t.type===`3d`?(t.commitProperty(`size`),t.commitProperty(`camera`)):t.commitProperty(`center`);let n=t?.spatialReference,r=n?he(e,n).geometry:null;return r&&t?.ready?t.toScreen(r):null}};function tt(){let e=document.createElement(`div`),{size:t,borderStyle:n,borderColor:r,borderWidth:i,boxShadow:a}=I().hoveredPointsStyle,{style:o}=e;return o.display=`block`,o.position=`absolute`,o.top=`0`,o.left=`0`,o.contain=`strict`,o.boxSizing=`border-box`,o.width=`${t}px`,o.height=`${t}px`,o.marginTop=`-${t/2}px`,o.marginLeft=`-${t/2}px`,o.border=`${n} ${i}px ${r}`,o.borderRadius=`${t}px`,o.boxShadow=a,e}r([p()],R.prototype,`position`,void 0),r([p({type:oe})],R.prototype,`color`,void 0),r([p()],R.prototype,`view`,void 0),r([p()],R.prototype,`_screenLocation`,null),R=r([D(`esri.views.analysis.ElevationProfile.ElevationProfileHoveredPointVisualization`)],R);var z=class extends h{constructor(e){super(e),this._hoveredPoints=new te}initialize(){let{analysisViewData:e}=this,{analysis:t}=e;this.addHandles([d(()=>{let{hoveredPoints:n,visible:r,updating:i}=e;return r?i?null:n.map((e,n)=>{let r=t.profiles.at(n);return!0===r?.viewOptions.hoveredPointVisible&&e!=null?{hoveredPoint:e,color:r.color}:null}).filter(e=>!!e):[]},e=>this._update(e),A),d(()=>t.geometry,()=>this._update([]),A)])}destroy(){this._hoveredPoints.drain(e=>e.destroy())}get updating(){return!1}_update(e){if(!e)return;let{view:t,_hoveredPoints:n}=this,r=e.length;for(;n.length>r;)n.pop()?.destroy();for(;n.length<r;){let e=new R({view:t});n.push(e)}for(let t=0;t<r;++t){let i=e[t],a=n.at(r-1-t);a.position=i.hoveredPoint,a.color=i.color}}};r([p()],z.prototype,`view`,void 0),r([p()],z.prototype,`analysisViewData`,void 0),r([p()],z.prototype,`_hoveredPoints`,void 0),r([p()],z.prototype,`updating`,null),z=r([D(`esri.views.analysis.ElevationProfile.ElevationProfileHoveredPointsVisualization`)],z);var B=class extends h{constructor(e){super(e)}initialize(){let{view:e,analysisViewData:t}=this;this._hoveredPointsVisualization=new z({view:e,analysisViewData:t}),this._inputVisualization=new F({view:e,analysisViewData:t}),this._lineVisualization=new L({view:e,analysisViewData:t})}destroy(){this._inputVisualization.destroy(),this._hoveredPointsVisualization.destroy(),this._lineVisualization.destroy()}get updating(){return this._hoveredPointsVisualization.updating||this._inputVisualization.updating||this._lineVisualization.updating}};r([p()],B.prototype,`view`,void 0),r([p()],B.prototype,`analysisViewData`,void 0),r([p()],B.prototype,`updating`,null),B=r([D(`esri.views.2d.analysis.ElevationProfile.ElevationProfileVisualization2D`)],B);function V(e,t){let n,r=!1;function i(...i){let a=e.apply(this,i);return r&&n!==void 0&&t?.(n,a)?n:(r=!0,n=a,a)}return i}var nt=class{constructor(e){this._store=e}destroy(){this._store.destroy()}get(e){return this._store.get(e)}put(e,t){this._store.put(e,t)}},H=class extends de{constructor(e,t,n){super(e,t,n),this.name=`unknown`,this.name=e}},U=class extends H{constructor(){super(`too-complex`,`The input geometry has too many points.`)}},rt=class extends H{constructor(){super(`invalid-geometry`,`The input geometry is invalid.`)}},it=class extends H{constructor(){super(`elevation-query-error`,`Error querying elevation from provider.`)}},at=class extends H{constructor(){super(`unknown`,`Unknown error.`)}};async function ot(e,t,n,r,i,o,s){let c,l,u,d=e.spatialReference,f=d.isGeographic||d.isWebMercator,p=0;if(!f){let{execute:t}=await a(async()=>{let{execute:e}=await import(`./lengthOperator-CDbTNtoR.js`);return{execute:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]));T(s),p=t(e,{unit:`meters`}),T(s)}let m=1/C(r);if(f){await xe([{source:d,dest:r},{source:d,dest:x.WGS84}],s);let a=Ot(e);c=Ge([a],`meters`)[0];let f=st(c,i);if(At(e,c,f)>o)throw new U;let p=ct(a,t,n);({densifiedPath:l,distances:u}=xt(p,f,m)),l=M(l,r)}else{await xe([{source:d,dest:r}],s),c=p;let a=st(c,i);if(At(e,c,a)>o)throw new U;let f=ct(e,t,n);({densifiedPath:l,distances:u}=bt(f,a,m)),T(s),l=M(l,r)}return{densifiedPath:l,pathLength:c*m,distances:u}}function st(e,t){let n=e/t.densificationMaxSamples;return Math.max(t.samplingDistance,n)}function ct(e,t,r){if(t==null)return dt(e);let i=e.spatialReference,a=t.mode,o=Ie(t,i),s=null;switch(r.type){case`2d`:s=lt(e,a,o);break;case`3d`:s=ut(e,a,o,r)}return s==null?dt(e):new n({hasZ:!0,hasM:!1,spatialReference:i,paths:ft(e.paths,s)})}function lt({hasZ:e},t,n){return t===`absolute-height`?e?([e,t,r])=>[e,t,r+n]:([e,t])=>[e,t,n]:null}function ut({spatialReference:e,hasZ:t},n,r,{elevationProvider:i}){let a=(t,n,r,a)=>i?.getElevation(t,n,r,e,a)??0;switch(n){case`on-the-ground`:return([e,t])=>[e,t,a(e,t,0,`ground`)];case`absolute-height`:return t?([e,t,n])=>[e,t,n+r]:([e,t])=>[e,t,r];case`relative-to-ground`:return t?([e,t,n])=>[e,t,n+a(e,t,n,`ground`)+r]:([e,t])=>[e,t,a(e,t,0,`ground`)+r];case`relative-to-scene`:return t?([e,t,n])=>[e,t,n+a(e,t,n,`scene`)+r]:([e,t])=>[e,t,a(e,t,0,`scene`)+r];default:return null}}function dt(e){return e.hasZ?new n({hasZ:!1,hasM:!1,spatialReference:e.spatialReference,paths:ft(e.paths,([e,t])=>[e,t])}):e}function ft(e,t){let n=e.length,r=Array(n);for(let i=0;i<n;++i){let n=e[i],a=n.length,o=Array(n.length);r[i]=o;for(let e=0;e<a;++e)o[e]=t(n[e])}return r}function pt(e){return gt(e)&&e.paths.some(e=>e.length>1)}function mt(e){return ht(e)&&pt(e.geometry)}function ht(e){return _t(e)&&gt(e?.geometry)}function gt(e){return!_t(e)&&e!=null&&e.type===`polyline`}function _t(e){return e!=null&&`geometry`in e}function vt(e){let t=e?.layer;return t!=null&&t.type===`graphics`&&t.internal}function yt(e,t,r,i,a){let{spatialReference:o,hasZ:s}=e,c={from:null,to:null,distance:0,azimuth:0,reverseAzimuth:0,spatialReference:o,metersPerSR:C(o)},l=[],u=[],d=0;for(let n=0;n<e.paths.length;++n){let o=e.paths[n],s=[],p=[],m=0;for(let e=1;e<o.length;++e){let n=o[e-1],l=o[e],u=i(c,n,l),h;for(h=m;h<u.distance&&!f(h,u.distance);h+=t)s.push(a(u,h)),p.push((d+h)*r);m=h-u.distance,d+=u.distance,s.push(l),p.push(d*r)}l[n]=s,u[n]=p}return{densifiedPath:new n({spatialReference:o,hasZ:s,paths:l}),distances:u}}function bt(e,t,n){let{hasZ:r}=e;return yt(e,t,n,Ct,r?Dt:Et)}function xt(e,t,n){let{hasZ:r}=e;return yt(e,t,n,St,r?Tt:wt)}function St(e,t,n){return e.distance=0,Ue(e,t,n,e.spatialReference),e.from=t,e.to=n,e}function Ct(e,t,n){return e.from=t,e.to=n,e.distance=y(n,t)*e.metersPerSR,e}function wt({from:e,azimuth:t,spatialReference:n},r){return We([0,0],e,t,r,n)}function Tt({from:e,to:t,azimuth:n,distance:r,spatialReference:i},a){let o=a/r,s=[0,0,Ae(e[2],t[2],o)];return We(s,e,n,a,i),s}function Et({from:e,to:t,distance:n},r){return pe([0,0],e,t,r/n)}function Dt({from:e,to:t,distance:n},r){return m([0,0,0],e,t,r/n)}function Ot(e){return Ke(e.spatialReference)?e:M(e,x.WGS84)}function kt(e){return e.paths.reduce((e,t)=>e+t.length,0)}function At(e,t,n){return kt(e)+Math.floor(t/n)+Math.max(0,e.paths.reduce(e=>1+e,0)-1)}function jt(e,t){let n=e.length;if(n===0)return null;let r=e[0],i=r.sampledZ,a=i,o=i,s=0,c=0,l=null,u=null,d=i??0,f=0,p=0,m=i==null?0:1,h=0,g=0,ee=C(t),te=k(t),v=I().minSlopeSampleDistance/ee,ne=2*v,y=new It,b=new It,x=()=>{re(),y.copy(b),b.reset()},S=(e,t)=>{x(),e>0&&e-y.start<=ne&&(e=y.start+v),b.restart(e,t)},re=()=>{if(y.isHole||b.isHole)return;let e=b.avgElevation-y.avgElevation,t=b.start-y.start,n=e*te,r=t*ee,i=_(Math.atan2(n,r),`radians`,`degrees`);i>0?(f+=i,l=W(l,i),h++):i<0&&(p-=i,u=W(u,-i),g++)};r.sampledZ!=null&&S(r.distance,r.sampledZ);for(let t=1;t<n;++t){let n=e[t-1],r=e[t],i=r.sampledZ;if(i==null){b.isHole||x();continue}m++,d+=i,a=Pt(a,i),o=W(o,i),b.isHole||r.distance-b.start>=v?S(r.distance,i):b.insert(i);let l=n.sampledZ;if(l!=null){let e=i-l;e>0?s+=e:e<0&&(c-=e)}}return x(),m===0?null:{maxDistance:e[n-1].distance,minElevation:a,maxElevation:o,avgElevation:m===0?null:d/m,elevationGain:s,elevationLoss:c,maxPositiveSlope:l,maxNegativeSlope:u,avgPositiveSlope:h===0?null:f/h,avgNegativeSlope:g===0?null:p/g}}function Mt(e){let t=e.filter(we),n=t.length;if(n===0)return null;let r=t[0];if(n===1)return r;let i=r.maxDistance,a=r.minElevation,o=r.maxElevation,s=r.maxPositiveSlope,c=r.maxNegativeSlope;for(let e=1;e<t.length;++e){let n=t[e];i=W(i,n.maxDistance),a=Pt(a,n.minElevation),o=W(o,n.maxElevation),s=W(s,n.maxPositiveSlope),c=W(c,n.maxNegativeSlope)}return{maxDistance:i,minElevation:a,maxElevation:o,avgElevation:null,elevationGain:null,elevationLoss:null,maxPositiveSlope:s,maxNegativeSlope:c,avgPositiveSlope:null,avgNegativeSlope:null}}function Nt(e){let t=null,n=null,r=null;for(let i of e){if(i==null)continue;let{statistics:e,spatialReference:a}=i;if(e==null)continue;let o=C(a);t=W(t,Ft(e.maxDistance,o));let s=k(a);r=Pt(r,Ft(e.minElevation,s)),n=W(n,Ft(e.maxElevation,s))}return{minDistance:0,maxDistance:t??0,minElevation:r??0,maxElevation:n??0}}function Pt(e,t){return t==null?e:e==null?t:Math.min(e,t)}function W(e,t){return t==null?e:e==null?t:Math.max(e,t)}function Ft(e,t){return e!=null&&t!=null?e*t:null}var It=class{constructor(){this._start=0,this._totalElevation=0,this._sampleCount=0}get avgElevation(){return this._totalElevation/this._sampleCount}get isHole(){return this._sampleCount===0}get start(){return this._start}copy(e){this._start=e._start,this._sampleCount=e._sampleCount,this._totalElevation=e._totalElevation}reset(){this._start=0,this._sampleCount=0,this._totalElevation=0}restart(e,t){this._start=e,this._sampleCount=1,this._totalElevation=t}insert(e){++this._sampleCount,this._totalElevation+=e}};function Lt(e,t,n=[]){if(e>=t||(n.push(e),t-e<2))return n;let r=t-1;n.push(r);let i=Rt(e+1,r);for(;;){let e=i.next();if(e.done)break;n.push(e.value)}return n}function*Rt(e,t){if(e>=t)return;let n=e+Math.floor((t-e)/2);yield n;let r=Rt(e,n),i=Rt(n+1,t);for(;;){let e=r.next(),t=i.next();if(e.done&&t.done)break;e.done||(yield e.value),t.done||(yield t.value)}}async function*zt(e,t){let{view:n,geometry:r,elevationInfo:i,providers:a,options:o}=e,s=n.spatialReference;if(!s||r==null||!pt(r))throw new rt;let c=a.length;if(c===0)return null;let l=Math.round(o.maxTotalSamples/c);if(kt(r)>l)throw new U;let u=await ot(r,i,n,s,o,l,t);T(t);let d=0,f=Array(c),p=Array(c);for(let n=0;n<c;n++){let r=Kt(u);f[n]=r,d+=r.samples.length;let i={...e,provider:a[n],result:r,densificationResult:u};p[n]=Bt(i,t)[Symbol.iterator]()}if(d>o.maxTotalSamples)throw new U;let m=await Promise.all(p.map(e=>{let t=e.next();return!0===t.done?Promise.resolve(null):t.value}));T(t);for(let e=0;e<c;e++)f[e]=m[e];yield f,await le(e.delayAfterPreview??I().delayAfterPreviewMillis,null,t.signal),T(t);let h=[];try{let e;do{e=!1;for(let t=0;t<c;t++){let n=p[t].next();!1===n.done&&(h.push({resultPromise:n.value,index:t}),e=!0)}}while(e)}finally{p.forEach(e=>e.return?.())}for(let{resultPromise:e,index:n}of h)f[n]=await e,T(t),yield f;for(let e of f)e!=null&&(e.progress=1);yield f}function*Bt(e,t){let{densificationResult:n}=e,r={...e,abortOptions:t,densificationResult:n},i=Lt(0,r.result.samples.length),a=i.slice(0,r.provider.numSamplesForPreview);yield Vt(r,a,!0);let o=Me(i,r.provider.numSamplesPerChunk);for(let e of o)yield Vt(r,e,!1)}async function Vt({densificationResult:e,result:t,provider:n,queue:r,abortOptions:i,cache:a},o,s){let{densifiedPath:c,pathLength:l}=e,u=t.spatialReference,{samples:d}=t,f=[];for(let e=0;e<o.length;e++)f[e]=[...d[o[e]].coordinate];try{return await r.push({geometry:new re({spatialReference:u,points:f,hasZ:c.hasZ}),provider:n,indices:o,preview:s,result:t,parameters:{...I().defaultQueryOptions(),minDemResolution:s?Math.round(l/n.numSamplesForPreview):Math.round(l/d.length),cache:a}},i),{...t}}catch(e){return ue(e)?null:$e}}function Ht(e){return new i({priority:ye.ELEVATION_PROFILE,concurrency:1,scheduler:e,process:async e=>{T(e.parameters);try{await Ut(e)}catch(e){Te(e)}}})}async function Ut({geometry:e,provider:t,indices:n,preview:r,result:i,parameters:a}){if(n.length===0)return;let{hasZ:o,points:s}=(await Xt(t,e,a)).geometry,c=a.noDataValue,{samples:l}=i;for(let e=0;e<n.length;e++){let t=l[n[e]];if(t.isHole)continue;let r=o?s[e][2]:null;r===null||r===c?t.sampledZ=null:(i.hasZ=!0,t.sampledZ=r),t.sampled=!0}Wt(l),i.progress=r?0:i.progress+n.length/l.length,i.statistics=jt(i.samples,i.spatialReference)}function Wt(e){let t=e.length-1,n=0;for(let r=1;r<=t;r++)(e[r].sampled||r===t)&&(Gt(e,n,r),n=r)}function Gt(e,t,n){if(n-t===1)return;let r=e[t],i=r.sampledZ,a=e[n],o=a.sampledZ;if(i==null||o==null){for(let r=t+1;r<n;r++)e[r].sampledZ=null;return}let s=r.distance,c=a.distance-s;for(let r=t+1;r<n;r++){let t=e[r],n=(t.distance-s)/c;t.sampledZ=Ae(i,o,n)}}function Kt({densifiedPath:e,distances:t}){let n=e.spatialReference,r=Se(n),i=e.paths,a=i.length,s=[],c=null,l=0;for(let e=0;e<a;e++){let n=i[e],a=n.length,u=t[e];for(let e=0;e<a;e++){let t=n[e],i=u[e];r&&(t[0]=o(t[0],r.valid[0],r.valid[1])),c&&e===0&&qt(s,c,t,l,i),s.push(Jt(t,i)),c=t,l=i}}return{progress:0,samples:s,hasZ:!1,statistics:null,spatialReference:n}}function qt(e,t,n,r,i){e.push(Yt(t,r)),e.push(Yt(n,i))}function Jt(e,t){return{coordinate:e,distance:t,sampledZ:null,sampled:!1,isHole:!1}}function Yt(e,t){return{coordinate:e,distance:t,sampledZ:null,sampled:!0,isHole:!0}}async function Xt(e,t,n){try{return await e.queryElevation(t,n)}catch{throw new it}}function Zt(e,t,n){if(!e||e.length===0)return;let r=e.length-1,i=e[0];if(t<=n(i))return i;let a=e[r];if(t>=n(a))return a;let o=0,s=0,c=r;for(;o<c;){s=o+Math.floor((c-o)/2);let i=e[s],a=n(i);if(a===t)return i;if(t<a){if(s>0){let r=e[s-1],o=n(r);if(t>o)return t-o>=a-t?i:r}c=s}else{if(s<r){let r=e[s+1],o=n(r);if(t<o)return t-a>=o-t?r:i}o=s+1}}return e[s]}function Qt(e){return e>.999999?1:e}var G=class extends h{constructor(e){super(e),this.error=null,this._getStableEffectiveUnits=V(()=>{let e=Nt(this._activeComputations.map(e=>e.result.rawResult)),t=this.analysis.displayUnits,n=Ye(this.view);return{distance:Oe(e.maxDistance,`meters`,t.distance??n),elevation:u(e.maxElevation,`meters`,t.elevation??n)}},E),this._updateTask=null,this._queue=null,this._currentTileCache=null,this._parametersPerComputation=new Map,this._getStableUpdateParameters=V(()=>({stationary:this.view.stationary??!0,activeComputations:this._activeComputations,generationParameters:this._generationParameters}),E),this._getStableGenerationParameters=V(()=>{let{view:e,analysis:t}=this;return e?.ready&&this._queue?{view:e,geometry:t.geometry,geometryIsValid:t.valid,elevationInfo:this.elevationInfo,queue:this._queue,cache:this._tileCache,options:this._options,slicePlane:e.type===`3d`?e.slice.plane:null}:null},E),this._getStableElevationInfo=V(()=>this.analysis.elevationInfo??$t,w),this._getStableOptions=V(()=>{let{densificationMaxSamples:e,defaultDemResolution:t,maxTotalSamples:n}=I(),r=this._minDemResolution??t;return r=parseFloat(r.toFixed(2)),{samplingDistance:r,densificationMaxSamples:Math.round(e/this._activeComputations.length),maxTotalSamples:n}},E),this._updateThrottled=He(e=>this._update(e),I().updateThrottleMillis)}initialize(){this._computationsCollection=Je(()=>this.analysis.profiles,e=>this.computationFactory.create({controller:this,profile:e,onInvalidate:e=>this._invalidateComputation(e)}),{recycleItems:!0}),this.addHandles([this._computationsCollection.on(`change`,()=>{this._parametersPerComputation.clear(),this._updateThrottled(this._updateParameters)}),d(()=>this._updateParameters,e=>this._updateThrottled(e),A),this._updateThrottled]);let e=this.view.type===`3d`?this.view.resourceController:void 0;this._queue=Ht(e?.scheduler),e?.addUpdatingObject(this)}destroy(){this._abortUpdate(),this._parametersPerComputation.clear(),this._computationsCollection?.destroy(),this._queue=O(this._queue),this._currentTileCache=O(this._currentTileCache)}get effectiveDisplayUnits(){return this._getStableEffectiveUnits()}get progress(){let e=0,t=0;for(let n of this._activeComputations)e++,t+=n.progress;return Qt(e>0?t/e:0)}get updating(){let{progress:e}=this,t=!!this._queue?.updating,n=this._updateThrottled.hasPendingUpdates(),r=this._updateTask!=null&&!this._updateTask.finished;return t||n||r||e>0&&e<1}get results(){return this._computations.map(e=>e.result)}get statistics(){return Mt(this._activeComputations.map(e=>e.result.statistics))}get hoveredPoints(){return this._computations.map(e=>e.hoveredPoint)}onElevationChange(e){let{view:t}=this;return t?.type===`3d`?c(()=>t.elevationProvider,`elevation-change`,e,{onListenerAdd:e,onListenerRemove:e}):j()}get _tileCache(){this._currentTileCache=O(this._currentTileCache);let e=this.view;if(e?.type===`3d`){let t=e.basemapTerrain?.elevationQueryCache;if(t!=null)return t}return this._currentTileCache??=new nt(new De(20971520)),this._currentTileCache}get _computations(){return this._computationsCollection?.toArray()??[]}get _activeComputations(){return this._computations.filter(e=>e.profile.enabled&&e.available)}get _minDemResolution(){let e=this._minDemResolutions;return e.length>0?_e(e):null}get _minDemResolutions(){let e=[];for(let{minDemResolution:t}of this._activeComputations)t!=null&&e.push(t);return e}get _updateParameters(){return this._getStableUpdateParameters()}get _generationParameters(){return this._getStableGenerationParameters()}get elevationInfo(){return this._getStableElevationInfo()}get _options(){return this._getStableOptions()}_update({stationary:e,activeComputations:t,generationParameters:n}){this._abortUpdate(),e&&(n==null?this._clearResults():this._updateTask=ve(async e=>{this.error=null;let r=t.filter(e=>!this._isComputationValid(e,n));try{if(!n.geometryIsValid)throw new rt;let t=zt({...n,providers:r},{signal:e}),i=!1;for await(let a of t){T(e),i||=(this._clearInvalidResults(n),!0);for(let e=0;e<r.length;e++)r[e].setResult(a[e])}for(let e of r)this._parametersPerComputation.set(e,n)}catch(e){g(e),this._abortUpdate(),this.error=e instanceof H?e:new at,r.forEach(e=>{e.clearResult()})}}))}_abortUpdate(){this._updateTask=ge(this._updateTask)}_isComputationValid(e,t){return this._parametersPerComputation.has(e)&&this._parametersPerComputation.get(e)===t}_invalidateComputation(e){this._parametersPerComputation.delete(e),this._updateThrottled(this._updateParameters)}_clearInvalidResults(e){for(let t of this._computations)this._isComputationValid(t,e)||(t.clearResult(),this._parametersPerComputation.delete(t))}_clearResults(){for(let e of this._computations)e.clearResult(),this._parametersPerComputation.delete(e)}};r([p({constructOnly:!0})],G.prototype,`analysis`,void 0),r([p({constructOnly:!0})],G.prototype,`analysisViewData`,void 0),r([p({constructOnly:!0})],G.prototype,`computationFactory`,void 0),r([p({constructOnly:!0})],G.prototype,`view`,void 0),r([p()],G.prototype,`error`,void 0),r([p({readOnly:!0})],G.prototype,`effectiveDisplayUnits`,null),r([p()],G.prototype,`progress`,null),r([p()],G.prototype,`updating`,null),r([p()],G.prototype,`results`,null),r([p()],G.prototype,`statistics`,null),r([p()],G.prototype,`hoveredPoints`,null),r([p()],G.prototype,`_updateTask`,void 0),r([p()],G.prototype,`_queue`,void 0),r([p()],G.prototype,`_tileCache`,null),r([p()],G.prototype,`_computationsCollection`,void 0),r([p()],G.prototype,`_computations`,null),r([p()],G.prototype,`_activeComputations`,null),r([p({readOnly:!0})],G.prototype,`_minDemResolution`,null),r([p()],G.prototype,`_minDemResolutions`,null),r([p()],G.prototype,`_updateParameters`,null),r([p()],G.prototype,`_generationParameters`,null),r([p()],G.prototype,`elevationInfo`,null),r([p()],G.prototype,`_options`,null),G=r([D(`esri.views.analysis.ElevationProfile.ElevationProfileController`)],G);var $t=new ke({...Re});function en(e,t){if(e==null||t==null)return null;let{samples:n,spatialReference:r}=e,{distance:i,elevation:a}=t,o=C(r),s=k(r),c=n.length,l=Array(c);for(let e=0;e<c;++e){let t=n[e],r=t.sampledZ,c=t.coordinate;l[e]={x:c[0],y:c[1],z:r,distance:nn(t.distance,o,i),elevation:K(r,s,a)}}return l}function tn(e,t){if(e==null||t==null||e.statistics==null||e.spatialReference==null)return null;let{distance:n,elevation:r}=t,{statistics:i,spatialReference:a}=e,o=C(a),s=k(a);return{maxDistance:nn(i.maxDistance,o,n),minElevation:K(i.minElevation,s,r),maxElevation:K(i.maxElevation,s,r),avgElevation:K(i.avgElevation,s,r),elevationGain:K(i.elevationGain,s,r),elevationLoss:K(i.elevationLoss,s,r),maxPositiveSlope:i.maxPositiveSlope,maxNegativeSlope:i.maxNegativeSlope,avgPositiveSlope:i.avgPositiveSlope,avgNegativeSlope:i.avgNegativeSlope}}function nn(e,t,n){return e==null?null:_(e*t,`meters`,n)}function K(e,t,n){return e==null?null:_(e*t,`meters`,n)}var q=class extends ee{constructor(e){super(e),this._getSamplesMemoized=Fe((e,t)=>en(e,t)),this._getStatisticsMemoized=Fe((e,t)=>tn(e,t)),this.rawResult=null}get available(){let{computation:e}=this;return e.profile.enabled&&e.available}get profile(){return this.computation.profile}get progress(){return Qt(this.rawResult!=null&&this.computation.profile.enabled?this.rawResult.progress:0)}get samples(){return this._getSamplesMemoized(this.rawResult,this.computation.controller.effectiveDisplayUnits)}get statistics(){return this._getStatisticsMemoized(this.rawResult,this.computation.controller.effectiveDisplayUnits)}get hoveredPoint(){if(!this.computation.profile.enabled)return null;let e=this.computation.controller.analysisViewData.hoveredPosition;if(e==null)return null;let{rawResult:n,samples:r}=this;if(r==null||n==null)return null;let i=r.length;if(i===0)return null;let a=r[i-1].distance,o=Zt(r,e*a,e=>e.distance);if(o==null)return null;let{x:s,y:c,z:l}=o;return l==null?null:new t({x:s,y:c,z:l,spatialReference:n.spatialReference})}};r([p()],q.prototype,`available`,null),r([p({readOnly:!0})],q.prototype,`profile`,null),r([p({readOnly:!0})],q.prototype,`progress`,null),r([p()],q.prototype,`samples`,null),r([p()],q.prototype,`statistics`,null),r([p({constructOnly:!0})],q.prototype,`computation`,void 0),r([p()],q.prototype,`rawResult`,void 0),r([p()],q.prototype,`hoveredPoint`,null),q=r([D(`esri.views.analysis.ElevationProfile.ElevationProfileResult`)],q);var J=class extends h{constructor(e){super(e),this.result=new q({computation:this}),this.numSamplesForPreview=30,this.numSamplesPerChunk=200}initialize(){this.addHandles([d(()=>{let{geometry:e,elevationInfo:t}=this.controller.analysis;return[e,t]},()=>this.onInvalidate(this),S)])}setResult(e){this.result.rawResult=e}clearResult(){this.setResult(null)}get progress(){return this.result.progress}get hoveredPoint(){return this.result.hoveredPoint}get available(){return!0}get minDemResolution(){return I().defaultDemResolution}};r([p({constructOnly:!0})],J.prototype,`controller`,void 0),r([p({constructOnly:!0})],J.prototype,`profile`,void 0),r([p({constructOnly:!0})],J.prototype,`onInvalidate`,void 0),r([p()],J.prototype,`result`,void 0),r([p({readOnly:!0})],J.prototype,`progress`,null),r([p()],J.prototype,`hoveredPoint`,null),r([p()],J.prototype,`available`,null),r([p()],J.prototype,`numSamplesForPreview`,void 0),r([p()],J.prototype,`numSamplesPerChunk`,void 0),r([p({readOnly:!0})],J.prototype,`minDemResolution`,null),J=r([D(`esri.views.analysis.ElevationProfile.ElevationProfileLineComputation`)],J);function rn(e){if(e==null)return null;if(ae(e))return an(e);let t=e.tileInfo;if(t==null)return null;let n=t.lods?.at(-1);return n==null?null:n.resolution*C(t.spatialReference)}function an(e){if(e==null)return null;let t=e.layers.items.map(on).filter(we);return _e(t)??null}function on(e){return e&&`tileInfo`in e?rn(e):null}var Y=class extends J{constructor(){super(...arguments),this.type=`ground`,this.numSamplesForPreview=50,this.numSamplesPerChunk=1e3,this._getStableQueryElevationDependencies=V(()=>({ground:this._ground,groundLayers:this._getStableGroundLayers()}),E),this._getStableGroundLayers=V(()=>this._ground?.layers?.toArray(),E)}get minDemResolution(){return an(this._ground)}get available(){return!0===this._ground?.layers.some(e=>e.visible)}initialize(){this.addHandles([d(()=>this._queryElevationDependencies,()=>this.onInvalidate(this))])}async queryElevation(e,t){let n=this._queryElevationDependencies;if(n==null)throw Error(`${this.declaredClass}: no dependencies`);let{ground:r}=n;if(r==null)throw Error(`No ground configured in the view`);let i=await r.queryElevation(e,t),a=k(e.spatialReference),o=k(r.layers.at(0).spatialReference);if(a!==o){let e=i.geometry;e.points=e.points.map(([e,n,r])=>[e,n,r===t.noDataValue?r:r*o/a])}return i}get _queryElevationDependencies(){return this._getStableQueryElevationDependencies()}get _ground(){return this.controller.view?.map?.ground}};r([p()],Y.prototype,`minDemResolution`,null),r([p()],Y.prototype,`available`,null),r([p()],Y.prototype,`_queryElevationDependencies`,null),r([p()],Y.prototype,`_ground`,null),Y=r([D(`esri.views.analysis.ElevationProfile.ElevationProfileLineGroundComputation`)],Y);function sn(e){return e?.map?.allLayers?.toArray().filter(e=>(e.type!==`graphics`||!e.internal)&&e.visible).map(e=>e.uid)??[]}var X=class extends J{constructor(){super(...arguments),this.type=`input`,this.numSamplesForPreview=50,this.numSamplesPerChunk=500,this._getStableElevationDependencies=V(()=>{let{view:e}=this.controller;if(!e)return null;let t=this._getStableElevationInfo();return{view:e,stationary:!this._requiresElevationAlignment||e.stationary,elevationInfo:t,visibleLayerIds:this._getStableLayerIds(),spatialReference:this._getStableSpatialReference()}},E),this._getStableElevationInfo=V(()=>this.controller.elevationInfo,w),this._getStableSpatialReference=V(()=>this.controller.view?.spatialReference,w),this._getStableLayerIds=V(()=>{let{view:e}=this.controller;return e.type===`3d`?sn(e):[]},E)}initialize(){let e=()=>this.onInvalidate(this);this.addHandles([d(()=>this._queryElevationDependencies,e,S),this.controller.onElevationChange(e)])}async queryElevation(e,{noDataValue:t,signal:n}){let r=this._queryElevationDependencies;if(r==null)throw Error(`${this.declaredClass}: no dependencies`);let{view:i,spatialReference:a}=r;if(this._requiresElevationAlignment&&i.type===`3d`&&a){let r=await Ve.fromGeometry(e).project(a,n);if(!r)return{geometry:e,noDataValue:t};let o=i.elevationProvider;return r.coordinates.forEach(e=>{e.z=o.getElevation(e.x,e.y,0,a,`ground`)??0}),{geometry:r.export(),noDataValue:t}}return{geometry:e,noDataValue:t}}get _requiresElevationAlignment(){return this.controller.elevationInfo?.mode===`on-the-ground`&&this.controller.view.type===`3d`}get _queryElevationDependencies(){return this._getStableElevationDependencies()}};r([p()],X.prototype,`_queryElevationDependencies`,null),X=r([D(`esri.views.analysis.ElevationProfile.ElevationProfileLineInputComputation`)],X);var Z=class extends J{constructor(){super(...arguments),this.type=`query`,this.numSamplesForPreview=50,this.numSamplesPerChunk=500}get minDemResolution(){return rn(this.profile.source)}get available(){let{source:e}=this.profile;return!!e&&(e.visible==null||e.visible)&&(e.layers==null||e.layers.some(e=>e.visible))}initialize(){this.addHandles(d(()=>this.profile.source,()=>this.onInvalidate(this),S))}queryElevation(e,t){if(!this.profile.source)throw Error(`No source configured for the elevation profile line`);return this.profile.source.queryElevation(e,t)}};r([p({readOnly:!0})],Z.prototype,`minDemResolution`,null),r([p()],Z.prototype,`available`,null),Z=r([D(`esri.views.analysis.ElevationProfile.ElevationProfileLineQueryComputation`)],Z);var cn=class{constructor(){this._currentOperationSignal=s(null)}get currentOperationType(){return this._currentOperationSignal.value?.type??null}destroy(){this.stop()}async start(e,t,n){let r=this._currentOperationSignal.value;r?.stop();let i=new AbortController,a=n?.signal,o=AbortSignal.any([i.signal,a].filter(we)),s=ie(),c=!1,l=()=>{c||(c=!0,s.reject(me()))},u={type:e,resolve:e=>{c||(c=!0,s.resolve(e))},reject:l,promise:s.promise,stop:()=>i.abort(),handles:[]};this._currentOperationSignal.value=u,u.handles.push(Ee(a,()=>{i.abort()}),Ee(o,()=>{v(u.handles),c||l()}));try{return r&&(await r.promise.catch(()=>{}),T(o)),await t(u,o),await s.promise}finally{v(u.handles),this._currentOperationSignal.value===u&&(this._currentOperationSignal.value=null)}}stop(){this._currentOperationSignal.value?.stop()}},Q=class extends h{constructor(t){super(t),this._sketchViewModels=new te,this._updatingHandles=new e,this._operationManager=new cn}initialize(){let{view:e}=this;this._graphicsLayer=new Be({listMode:`hide`,internal:!0}),this.addHandles([d(()=>({map:e.map,internalGraphicsLayer:this._graphicsLayer,state:this.state,geometryVisualizationVisible:this._analysis.viewOptions.geometryVisualizationVisible,visible:this.analysisViewData.visible}),({map:e,internalGraphicsLayer:t,state:n,geometryVisualizationVisible:r,visible:i})=>{un(e,t);let a=this.sketchGraphic;switch(a&&(a.visible=i),n){case`idle`:case`reshaping-disabled`:a&&!r&&(a.visible=!1),this._operationManager.stop(),this._ensureUpdatedSketchGraphic();break;case`reshaping`:je(this._startReshape());break;case`awaiting-sketch`:this.analysisViewData.interactive=!0}},A),d(()=>this._analysis.elevationInfo,e=>{this._graphicsLayer.elevationInfo=e},A)])}destroy(){this._operationManager.destroy(),this._sketchViewModels.drain(e=>O(e));let e=this._graphicsLayer;this.view.map?.remove(e),e.destroy()}get sketchGraphic(){return this._get(`sketchGraphic`)}set sketchGraphic(e){e!==this._get(`sketchGraphic`)&&(this._set(`sketchGraphic`,e),this._updateAnalysisFromSketchGraphic())}get state(){let{visible:e,interactive:t}=this.analysisViewData;if(!e)return`idle`;switch(this._operationManager.currentOperationType){case`place`:return this._sketching?`sketching`:`awaiting-sketch`;case`pick-feature`:return`picking`;default:return this._analysis.geometry?t?`reshaping`:`reshaping-disabled`:`idle`}}get updating(){return this._sketchViewModels.some(e=>e.updating)||this._updatingHandles.updating}get _sketching(){return this._sketchViewModels.some(e=>e.createGraphic===this.sketchGraphic)}get _analysis(){return this.analysisViewData.analysis}get _lineSymbol(){return ln(this.view.type)}place(e){return this._operationManager.start(`place`,async t=>{let n=this._createSketchViewModel(),r=this._analysis.clone();this._ensureUpdatedSketchGraphic();let i=this.sketchGraphic,a=this._analysis.elevationInfo,o=j(()=>{this.sketchGraphic===i&&(this._graphicsLayer.elevationInfo=a)}),s=n.on(`create`,e=>{switch(e.state){case`start`:this._graphicsLayer.removeAll(),this.sketchGraphic=e.graphic,this._analysis.elevationInfo=this._graphicsLayer.elevationInfo;break;case`active`:this._updateAnalysisFromSketchGraphic();break;case`complete`:this.sketchGraphic&&(this._updateAnalysisFromSketchGraphic(),this._addSketchGraphic(this.sketchGraphic)),t.stop();break;case`cancel`:t.stop()}});t.handles.push(s,j(()=>(s.remove(),n.destroy(),this._sketchViewModels.remove(n),this._updateAnalysisFromSketchGraphic(),this._analysis.valid?se(e)||r.equals(this._analysis)?t.reject():void t.resolve({}):(this._clear(),t.reject()))),o),this._graphicsLayer.elevationInfo=dn,await this._updatingHandles.addPromise(je(n.create(`polyline`)))},e)}async pickFeature(e){return this._operationManager.start(`pick-feature`,async e=>{let{view:t}=this;t.closePopup();let n=null;e.handles.push(t.on(`immediate-click`,r=>{r.defer(async()=>{n?.abort(),n=ve(async n=>{let{results:i}=await t.hitTest(r);T(n);let a=null;for(let e of i)if(e.type===`graphic`&&mt(e.graphic)&&!vt(e.graphic)){a=e.graphic;break}a?(r.preventDefault(),r.stopPropagation(),this.sketchGraphic=null,this._analysis.geometry=a.geometry,this._analysis.elevationInfo=new ke({...Le(a)}),e.resolve({feature:a}),e.stop()):e.reject()}),await n.promise})},Pe.TOOL),t.on(`key-down`,t=>{fe(t)&&(e.reject(),e.stop())},Pe.TOOL),t.acquireCursor(`crosshair`,`high`),j(()=>{n?.abort(),e.reject()})),t.focus()},e)}_startReshape(){let e=this._createSketchViewModel();return this._sketchViewModels.add(e),this._operationManager.start(`reshape`,async t=>{let n=()=>{let t=this._ensureUpdatedSketchGraphic();return t?this._updatingHandles.addPromise(e.update(t,{tool:`reshape`})):Promise.resolve()};if(!this._ensureUpdatedSketchGraphic())return;let r=e.on(`update`,e=>{this._updateAnalysisFromSketchGraphic(),e.state===`complete`&&(this.state===`reshaping`?je(n()):t.resolve())});t.handles.push(r,j(()=>{r.remove(),this._sketchViewModels.remove(e),e.destroy(),t.resolve()})),await n()})}_createSketchViewModel(){return new Xe({layer:this._graphicsLayer,view:this.view,defaultCreateOptions:{mode:`click`,hasZ:!0},updateOnGraphicClick:!1,defaultUpdateOptions:{enableMoveAllGraphics:!1,enableRotation:!1,enableScaling:!1,enableZ:!1,highlightOptions:{enabled:!1},multipleSelectionEnabled:!1,reshapeOptions:{shapeOperation:`none`},toggleToolOnClick:!1,tool:`reshape`},polylineSymbol:this._lineSymbol,activeLineSymbol:this._lineSymbol})}_ensureUpdatedSketchGraphic(){let{geometry:e}=this._analysis;if(!e)return this.sketchGraphic=null,this._graphicsLayer.removeAll(),null;let t=this.sketchGraphic??=new l({symbol:this._lineSymbol,geometry:e});return t.geometry=e,this._addSketchGraphic(t),t}_addSketchGraphic(e){let{graphics:t}=this._graphicsLayer;t.includes(e)||t.add(e),t.length!==1&&t.removeMany(t.filter(t=>t!==e))}_clear(){this.sketchGraphic=null,this._analysis.clear()}_updateAnalysisFromSketchGraphic(){let e=this.sketchGraphic?.geometry;gt(e)||(e=null);let t=this._analysis;t.geometry!==e&&(t.geometry=e)}};function ln(e){if(e===`2d`){let e={type:`CIMSolidStroke`,enable:!0,capStyle:`Butt`,joinStyle:`Round`,width:1.5};return new Ce({data:{type:`CIMSymbolReference`,symbol:{type:`CIMLineSymbol`,symbolLayers:[{...e,effects:[{type:`CIMGeometricEffectDashes`,dashTemplate:[5,4],lineDashEnding:`FullGap`,controlPointEnding:`NoConstraint`}],color:[0,0,0,255]},{...e,color:[255,255,255,255]}]}}})}return new ce({color:[0,0,0,0]})}function un(e,t){t&&(t.removeFromParent(),e?.add(t))}r([p({constructOnly:!0})],Q.prototype,`analysisViewData`,void 0),r([p({constructOnly:!0})],Q.prototype,`view`,void 0),r([p()],Q.prototype,`sketchGraphic`,null),r([p({nonNullable:!0})],Q.prototype,`state`,null),r([p()],Q.prototype,`updating`,null),r([p()],Q.prototype,`_sketching`,null),r([p()],Q.prototype,`_analysis`,null),r([p()],Q.prototype,`_lineSymbol`,null),Q=r([D(`esri.views.analysis.ElevationProfile.ElevationProfileTool`)],Q);var dn=new ke({mode:`on-the-ground`,offset:0}),$=class extends P{constructor(e){super(e),this.type=`elevation-profile-view-2d`,this.analysis=null,this.hoveredPosition=null}initialize(){let{analysis:e,view:t}=this;this._controller=new G({analysis:e,analysisViewData:this,view:t,computationFactory:{create:e=>{switch(e.profile.type){case`ground`:return new Y(e);case`input`:return new X(e);case`query`:return new Z(e);case`scene`:throw new de(`elevation-profile-analysis-view-2d:unsupported`,`The scene profile line type is not supported in 2D views.`)}}}}),this._visualization=new B({view:t,analysisViewData:this}),this._sketchTool=new Q({view:t,analysisViewData:this})}destroy(){this._controller?.destroy(),this._visualization?.destroy(),this._sketchTool?.destroy()}get effectiveDisplayUnits(){return this._controller?.effectiveDisplayUnits??{distance:`meters`,elevation:`meters`}}get error(){return this._controller?.error}get hoveredPoints(){return this._controller?.hoveredPoints??[]}get interactive(){return super.interactive}set interactive(e){super.interactive=e}get progress(){return this._controller?.progress??0}get results(){return this._controller?.results??[]}get statistics(){return this._controller?.statistics}get updating(){return!0===this._controller?.updating||!0===this._visualization?.updating||!0===this._sketchTool?.updating}get visible(){return super.visible}set visible(e){super.visible=e}get sketchGraphic(){return this._sketchTool?.sketchGraphic}get toolState(){return this._sketchTool?.state??`idle`}place(e){return this._sketchTool.place(e)}pickFeature(e){return this._sketchTool.pickFeature(e)}};r([p({readOnly:!0})],$.prototype,`type`,void 0),r([p({constructOnly:!0,nonNullable:!0})],$.prototype,`analysis`,void 0),r([p({readOnly:!0})],$.prototype,`effectiveDisplayUnits`,null),r([p({readOnly:!0})],$.prototype,`error`,null),r([p()],$.prototype,`hoveredPosition`,void 0),r([p()],$.prototype,`hoveredPoints`,null),r([p({readOnly:!0})],$.prototype,`progress`,null),r([p({readOnly:!0})],$.prototype,`results`,null),r([p({readOnly:!0})],$.prototype,`statistics`,null),r([p({readOnly:!0})],$.prototype,`updating`,null),r([p()],$.prototype,`sketchGraphic`,null),r([p()],$.prototype,`toolState`,null),r([p()],$.prototype,`_controller`,void 0),r([p()],$.prototype,`_visualization`,void 0),r([p()],$.prototype,`_sketchTool`,void 0),$=r([D(`esri.views.2d.analysis.ElevationProfileAnalysisView2D`)],$);var fn=$;export{fn as default};