import{Do as e,Ko as t,Mo as n,To as r,Uo as i,Xo as a,Zo as o,bo as s}from"./index-BqmCqmfp.js";import{t as c}from"./guid-D8BoG5RM.js";import{n as l,p as u,r as d}from"./dom-atD5WAsR.js";import{n as f,t as p}from"./observers-Ca90Dkfx.js";import{n as m,t as h}from"./interactive-C1Xh6Lv0.js";import{t as g}from"./useSetFocus-BOgV9A-L.js";import{c as _,i as v,l as y,n as b,o as x,s as S,t as C}from"./floating-ui-bSZlirwY.js";import{t as w}from"./openCloseComponent-C1bAqVbv.js";import{t as T}from"./key-UZzOT_rp.js";import{t as E}from"./dynamicClasses-DOR4n0eL.js";var D={trigger:`trigger`},O={content:`content`,wrapper:`wrapper`,triggerContainer:`trigger-container`},k=`calcite-dropdown`,A={menuButton:e=>`${k}-${e}-menubutton`,menu:e=>`${k}-${e}-menu`},j=o`:host{--calcite-internal-color-focus: var( --calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)) )}:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:inline-block}.wrapper{--calcite-floating-ui-z-index: var(--calcite-z-index-dropdown);inline-size:max-content;display:none;max-inline-size:100vw;max-block-size:100vh;inset-block-start:0;left:0;z-index:var(--calcite-floating-ui-z-index)}@starting-style{.wrapper{opacity:0;inset-block-start:0;left:0}}.wrapper .calcite-floating-ui-anim{position:relative;transition-duration:var(--calcite-floating-ui-transition);transition-property:inset-block-start,left,opacity,display;transition-behavior:allow-discrete;opacity:0;box-shadow:0 0 16px #00000029;z-index:var(--calcite-z-index);border-radius:.25rem}.wrapper[data-placement^=bottom] .calcite-floating-ui-anim{inset-block-start:-5px}.wrapper[data-placement^=top] .calcite-floating-ui-anim{inset-block-start:5px}.wrapper[data-placement^=left] .calcite-floating-ui-anim{left:5px}.wrapper[data-placement^=right] .calcite-floating-ui-anim{left:-5px}.wrapper[data-placement] .calcite-floating-ui-anim--active{opacity:1;inset-block-start:0;left:0}@starting-style{.wrapper[data-placement] .calcite-floating-ui-anim--active{opacity:0}}.content{max-height:45vh;width:auto;overflow-y:auto;overflow-x:hidden;inline-size:var(--calcite-dropdown-width, var(--calcite-internal-dropdown-width));background-color:var(--calcite-dropdown-background-color, var(--calcite-color-foreground-1))}.trigger-container{position:relative;display:flex;height:100%;flex:1 1 auto;word-wrap:break-word;word-break:break-word}.width-s{--calcite-internal-dropdown-width: 12rem}.width-m{--calcite-internal-dropdown-width: 14rem}.width-l{--calcite-internal-dropdown-width: 16rem}@media (forced-colors: active){:host([open]) .wrapper{border:var(--calcite-border-width-sm) solid canvasText}}:host([hidden]){display:none}[hidden]{display:none}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}`,M=class extends r{constructor(){super(),this.focusLastDropdownItem=!1,this.groups=[],this.guid=c(),this.items=[],this.mutationObserver=p(`mutation`,()=>this.updateItems()),this.transitionProp=`opacity`,this.resizeObserver=p(`resize`,e=>this.resizeObserverCallback(e)),this.focusSetter=g()(this),this.closeOnSelectDisabled=!1,this.disabled=!1,this.maxItems=0,this.offsetDistance=0,this.offsetSkidding=0,this.open=!1,this.overlayPositioning=`absolute`,this.placement=v,this.scale=`m`,this.selectedItems=[],this.type=`click`,this.calciteDropdownBeforeClose=i({cancelable:!1}),this.calciteDropdownBeforeOpen=i({cancelable:!1}),this.calciteDropdownClose=i({cancelable:!1}),this.calciteDropdownOpen=i({cancelable:!1}),this.calciteDropdownSelect=i({cancelable:!1}),this.listenOn(window,`click`,this.closeCalciteDropdownOnClick),this.listen(`calciteInternalDropdownCloseRequest`,this.closeCalciteDropdownOnEvent),this.listenOn(window,`calciteDropdownOpen`,this.closeCalciteDropdownOnOpenEvent),this.listen(`pointerenter`,this.pointerEnterHandler),this.listen(`pointerleave`,this.pointerLeaveHandler),this.listen(`calciteInternalDropdownItemKeyEvent`,this.calciteInternalDropdownItemKeyEvent),this.listen(`calciteInternalDropdownItemSelect`,this.handleItemSelect)}static{this.properties={closeOnSelectDisabled:[7,{},{reflect:!0,type:Boolean}],disabled:[7,{},{reflect:!0,type:Boolean}],flipPlacements:[0,{},{attribute:!1}],maxItems:[11,{},{reflect:!0,type:Number}],offsetDistance:[11,{},{type:Number,reflect:!0}],offsetSkidding:[11,{},{reflect:!0,type:Number}],open:[7,{},{reflect:!0,type:Boolean}],overlayPositioning:[3,{},{reflect:!0}],placement:[3,{},{reflect:!0}],scale:[3,{},{reflect:!0}],selectedItems:[0,{},{attribute:!1}],type:[3,{},{reflect:!0}],widthScale:[3,{},{reflect:!0}],width:[3,{},{reflect:!0}]}}static{this.shadowRootOptions={mode:`open`,delegatesFocus:!0}}static{this.styles=j}async reposition(e=!1){let{filteredFlipPlacements:t,floatingEl:n,offsetDistance:r,offsetSkidding:i,overlayPositioning:a,placement:o,referenceEl:s}=this;return y(this,{floatingEl:n,referenceEl:s,offsetDistance:r,offsetSkidding:i,overlayPositioning:a,placement:o,flipPlacements:t,type:`menu`},e)}async setFocus(e){return this.focusSetter(()=>this.referenceEl,e)}connectedCallback(){super.connectedCallback(),this.mutationObserver?.observe(this.el,{childList:!0,subtree:!0}),this.setFilteredPlacements(),this.updateItems(),b(this)}willUpdate(e){e.has(`open`)&&(this.hasUpdated||this.open!==!1)&&this.openHandler(),e.has(`disabled`)&&(this.hasUpdated||this.disabled!==!1)&&this.handleDisabledChange(this.disabled),e.has(`flipPlacements`)&&this.flipPlacementsHandler(),e.has(`maxItems`)&&this.hasUpdated&&this.setMaxScrollerHeight(),this.hasUpdated&&(e.has(`offsetDistance`)&&this.offsetDistance!==0||e.has(`offsetSkidding`)&&this.offsetSkidding!==0||e.has(`overlayPositioning`)&&this.overlayPositioning!==`absolute`||e.has(`placement`)&&this.placement!==`bottom-start`)&&this.reposition(!0),e.has(`scale`)&&(this.hasUpdated||this.scale!==`m`)&&this.handlePropsChange()}updated(){m(this)}loaded(){this.updateSelectedItems(),b(this)}disconnectedCallback(){super.disconnectedCallback(),this.mutationObserver?.disconnect(),this.resizeObserver?.disconnect(),x(this)}openHandler(){w(this),!this.disabled&&this.reposition(!0)}handleDisabledChange(e){e||(this.open=!1)}flipPlacementsHandler(){this.setFilteredPlacements(),this.reposition(!0)}handlePropsChange(){this.updateItems(),this.updateGroupProps()}closeCalciteDropdownOnClick(e){this.disabled||!this.open||e.composedPath().includes(this.el)||this.closeCalciteDropdown(!1)}closeCalciteDropdownOnEvent(e){this.closeCalciteDropdown(),e.stopPropagation()}closeCalciteDropdownOnOpenEvent(e){e.composedPath().includes(this.el)||(this.open=!1)}pointerEnterHandler(){this.disabled||this.type!==`hover`||this.toggleDropdown()}pointerLeaveHandler(){this.disabled||this.type!==`hover`||this.closeCalciteDropdown()}getTraversableItems(){return this.items.filter(e=>!e.disabled&&!e.hidden)}calciteInternalDropdownItemKeyEvent(e){let{keyboardEvent:t}=e.detail,n=t.target,r=this.getTraversableItems();switch(t.key){case`Tab`:this.open=!1,this.updateTabIndexOfItems(n);break;case`ArrowDown`:d(r,n,`next`);break;case`ArrowUp`:d(r,n,`previous`);break;case`Home`:d(r,n,`first`);break;case`End`:d(r,n,`last`);break}e.stopPropagation()}handleItemSelect(e){this.updateSelectedItems(),e.stopPropagation(),this.calciteDropdownSelect.emit(),(!this.closeOnSelectDisabled||e.detail.requestedDropdownGroup.selectionMode===`none`)&&this.closeCalciteDropdown(),e.stopPropagation()}setFilteredPlacements(){let{el:e,flipPlacements:t}=this;this.filteredFlipPlacements=t?S(t,e):null}updateTriggers(e){this.triggers=e.target.assignedElements({flatten:!0}),this.reposition(!0)}updateItems(){this.items=this.groups.map(e=>Array.from(e?.querySelectorAll(`calcite-dropdown-item`))).reduce((e,t)=>[...e,...t],[]),this.updateSelectedItems(),this.reposition(!0),this.items.forEach(e=>e.scale=this.scale)}updateGroups(e){this.groups=e.target.assignedElements({flatten:!0}).filter(e=>e?.matches(`calcite-dropdown-group`)),this.updateItems(),this.updateGroupProps()}updateGroupProps(){this.groups.forEach((e,t)=>{e.scale=this.scale,e.position=t})}resizeObserverCallback(e){e.forEach(({target:e})=>{e===this.referenceEl?this.setDropdownWidth():e===this.scrollerEl&&this.setMaxScrollerHeight()})}setDropdownWidth(){let{referenceEl:e,scrollerEl:t}=this;!t||!e||(t.style.minWidth=`${e.clientWidth}px`)}setMaxScrollerHeight(){let{maxItems:e,items:t,scrollerEl:n}=this;if(!n)return;let r=t.length>=e&&e>0?this.getYDistanceFromScroller(t.at(e-1)):0;n.style.maxBlockSize=r>0?`${r}px`:``,this.reposition(!0)}setScrollerAndTransitionEl(e){f(this.resizeObserver,this.scrollerEl,e),this.scrollerEl=e,this.transitionEl=e}onBeforeOpen(){this.focusOnFirstActiveOrDefaultItem(),this.calciteDropdownBeforeOpen.emit()}onOpen(){this.calciteDropdownOpen.emit()}onBeforeClose(){this.calciteDropdownBeforeClose.emit()}onClose(){this.calciteDropdownClose.emit(),_(this)}setReferenceEl(e){f(this.resizeObserver,this.referenceEl,e),this.referenceEl=e,b(this)}setFloatingEl(e){this.floatingEl=e,b(this)}keyDownHandler(e){if(!e.composedPath().includes(this.referenceEl))return;let{defaultPrevented:t,key:n}=e;if(!t){if(n===`Escape`){this.closeCalciteDropdown(),e.preventDefault();return}if(this.open&&e.shiftKey&&n===`Tab`){this.closeCalciteDropdown(),e.preventDefault();return}T(n)?(this.toggleDropdown(),e.preventDefault()):(n===`ArrowDown`||n===`ArrowUp`)&&(e.preventDefault(),this.focusLastDropdownItem=n===`ArrowUp`,this.open=!0)}}updateSelectedItems(){this.selectedItems=this.items.filter(e=>e.selected)}getYDistanceFromScroller(e){let t=e.getBoundingClientRect();return e.offsetTop+t.height}closeCalciteDropdown(e=!0){this.open=!1,e&&l(this.triggers[0])}async focusOnFirstActiveOrDefaultItem(){let e=this.getTraversableItems().find(e=>e.selected)||(this.focusLastDropdownItem?this.items.at(-1):this.items[0]);this.focusLastDropdownItem=!1,e&&(await this.updateComplete,await u(),await u(),await l(e),e.scrollIntoView({block:`nearest`}))}toggleDropdown(){this.open=!this.open}updateTabIndexOfItems(e){this.items.forEach(t=>{t.tabIndex=e===t?0:-1})}render(){let{open:r,guid:i}=this;return h({disabled:this.disabled,children:a`<div class=${e(O.triggerContainer)} id=${A.menuButton(i)??t} @click=${this.toggleDropdown} @keydown=${this.keyDownHandler} ${n(this.setReferenceEl)}><slot aria-controls=${A.menu(i)??t} .ariaExpanded=${r} aria-haspopup=menu name=${D.trigger} @slotchange=${this.updateTriggers}></slot></div><div .ariaHidden=${!r} class=${e({[O.wrapper]:!0,[E(`width`,this.width,this.widthScale)]:!!(this.width||this.widthScale)})} ${n(this.setFloatingEl)}><div aria-labelledby=${A.menuButton(i)??t} class=${e({[O.content]:!0,[C.animation]:!0,[C.animationActive]:r})} id=${A.menu(i)??t} role=menu ${n(this.setScrollerAndTransitionEl)}><slot @slotchange=${this.updateGroups}></slot></div></div>`})}};s(`calcite-dropdown`,M);export{M as t};