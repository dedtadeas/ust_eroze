import{Xm as e,pl as t,rl as n}from"./index-BqmCqmfp.js";import{b as r}from"./CIMSymbolHelper-bdBsF42t.js";import{f as i}from"./rasterizingUtils-B0Pd5uE0.js";var a=.45;function o(e,t=.5){switch(e.type){case`CIMPointSymbol`:{let t=e.symbolLayers;if(!t||t.length!==1)return null;let n=t[0];return n.type===`CIMVectorMarker`?o(n):null}case`CIMVectorMarker`:{let n=e.markerGraphics;if(!n||n.length!==1)return null;let r=n[0];if(!r)return null;let i=r.geometry;if(!i)return null;let a=r.symbol;return!a||a.type!==`CIMPolygonSymbol`&&a.type!==`CIMLineSymbol`||a.symbolLayers?.some(e=>!!e.effects)?null:{type:`sdf`,geom:i,sdfPaddingRatio:t,asFill:a.type===`CIMPolygonSymbol`}}}}function s(e){return e?e.rings?e.rings:e.paths?e.paths:e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0?[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]:null:null}function c(e){let t=1/0,n=-1/0,i=1/0,a=-1/0;for(let r of e)for(let e of r)e[0]<t&&(t=e[0]),e[0]>n&&(n=e[0]),e[1]<i&&(i=e[1]),e[1]>a&&(a=e[1]);return new r(t,i,n-t,a-i)}function l(e){let t=1/0,n=-1/0,r=1/0,i=-1/0;for(let a of e)for(let e of a)e[0]<t&&(t=e[0]),e[0]>n&&(n=e[0]),e[1]<r&&(r=e[1]),e[1]>i&&(i=e[1]);return[t,r,n,i]}function u(t){return t?t.rings?l(t.rings):t.paths?l(t.paths):e(t)?[t.xmin,t.ymin,t.xmax,t.ymax]:null:null}function d(e,t){let[n,r,i,a]=u(e),o=i-n,s=a-r,c=Math.floor(.5*(128*t-4)),l=(128-2*(c+4))/Math.max(o,s),d=Math.round(o*l),f=Math.round(s*l);return{pixelDimensions:[o,s],texelDimensions:[Math.round((d+2*c)/l),Math.round((f+2*c)/l)]}}function f(e,t,n,r,i,o,s){let[c,l,u,d]=e;if(u<c||d<l)return{frameSizeRatio:0,anchorX:0,anchorY:0,widthRatio:1,sdfPaddingRatio:.5};let f=u-c,p=d-l,m=Math.max(f,p),h=.5;if(o!=null&&n!=null){!s&&t!=null&&(o*=(t.ymax-t.ymin)/n);let e=o/(o+m);e>a&&e<1&&(h=Math.min(e+.1,.99))}let g=Math.floor(.5*(128*h-4)),_=(128-2*(g+4))/m,v=Math.round(f*_)+2*g,y=Math.round(p*_)+2*g,b=1;t&&(b=y*(1-h)/((t.ymax-t.ymin)*_));let x=0,S=0,C=1;r&&(i?t&&n&&t.ymax-t.ymin>0&&(C=(t.xmax-t.xmin)/(t.ymax-t.ymin),x=r.x/(n*C),S=r.y/n):(x=r.x,S=r.y)),t&&(x=.5*(t.xmax+t.xmin)+x*(t.xmax-t.xmin),S=.5*(t.ymax+t.ymin)+S*(t.ymax-t.ymin)),x-=c,S-=l,x*=_,S*=_,x+=g,S+=g;let w=x/v-.5,T=S/y-.5;return i&&n&&(w*=n*C,T*=n),{frameSizeRatio:b,anchorX:w,anchorY:T,widthRatio:C,sdfPaddingRatio:h}}function p(e){let t=s(e.geom),n=c(t),r=Math.floor(.5*(128*e.sdfPaddingRatio-4)),i=128-2*(r+4),a=i/Math.max(n.width,n.height),o=Math.round(n.width*a)+2*r,l=Math.round(n.height*a)+2*r,u=[];for(let i of t)if(i&&i.length>1){let t=[];for(let o of i){let[i,s]=o;i-=n.x,s-=n.y,i*=a,s*=a,i+=r-.5,s+=r-.5,e.asFill?t.push([i,s]):t.push([Math.round(i),Math.round(s)])}if(e.asFill){let e=t.length-1;t[0][0]===t[e][0]&&t[0][1]===t[e][1]||t.push(t[0])}u.push(t)}let d=m(u,o,l,r);return e.asFill&&h(u,o,l,r,d),{data:g(d,r),width:o,height:l,sdfPaddingRatio:e.sdfPaddingRatio,sdfDecodeCoeff:2*r/i}}function m(e,t,n,r){let i=t*n,a=Array(i),o=r*r+1;for(let e=0;e<i;++e)a[e]=o;for(let i of e){let e=i.length;for(let o=1;o<e;++o){let e=i[o-1],s=i[o],c,l,u,d;e[0]<s[0]?(c=e[0],l=s[0]):(c=s[0],l=e[0]),e[1]<s[1]?(u=e[1],d=s[1]):(u=s[1],d=e[1]);let f=Math.floor(c)-r,p=Math.floor(l)+r,m=Math.floor(u)-r,h=Math.floor(d)+r;f<0&&(f=0),p>t&&(p=t),m<0&&(m=0),h>n&&(h=n);let g=s[0]-e[0],_=s[1]-e[1],v=g*g+_*_;for(let r=f;r<p;r++)for(let i=m;i<h;i++){let o=r+.5,c=i+.5,l,u,d=(o-e[0])*g+(c-e[1])*_;d<0?(l=e[0],u=e[1]):d>v?(l=s[0],u=s[1]):(d/=v,l=e[0]+d*g,u=e[1]+d*_);let f=(o-l)*(o-l)+(c-u)*(c-u),p=(n-i-1)*t+r;f<a[p]&&(a[p]=f)}}}for(let e=0;e<i;++e)a[e]=Math.sqrt(a[e]);return a}function h(e,t,n,r,i){for(let a of e){let e=a.length;for(let o=1;o<e;++o){let e=a[o-1],s=a[o],c,l,u,d;e[0]<s[0]?(c=e[0],l=s[0]):(c=s[0],l=e[0]),e[1]<s[1]?(u=e[1],d=s[1]):(u=s[1],d=e[1]);let f=Math.floor(c),p=Math.floor(l)+1,m=Math.floor(u),h=Math.floor(d)+1;f<r&&(f=r),p>t-r&&(p=t-r),m<r&&(m=r),h>n-r&&(h=n-r);for(let a=m;a<h;++a){if(e[1]>a==s[1]>a)continue;let o=a+.5,c=(n-a-1)*t;for(let t=f;t<p;++t)t+.5<(s[0]-e[0])*(o-e[1])/(s[1]-e[1])+e[0]&&(i[c+t]=-i[c+t]);for(let e=r;e<f;++e)i[c+e]=-i[c+e]}}}}function g(e,t){let n=2*t,r=e.length,a=new Uint8Array(4*r);for(let t=0;t<r;++t){let r=.5-e[t]/n;i(r,a,4*t)}return a}export{p as a,u as i,d as n,f as r,o as t};