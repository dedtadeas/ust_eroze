import{AE as e,An as t,Ax as n,Bg as r,ET as i,Fn as a,Nn as o,Sx as s,Vg as ee,Vn as c,_m as l,dm as u,e_ as d,fm as f,hm as p,mm as te,tm as m,vE as h}from"./index-BqmCqmfp.js";import{t as g}from"./arcadeEnvironment-DfjU7s2m.js";import{t as _}from"./ImmutableArray-C3KNQCVd.js";import{A as ne,J as v,N as y,X as b,p as re,s as x,t as S,tt as C}from"./Dictionary-B3Q9BFVY.js";import"./shared-BZhQTnH4.js";import"./number-Dq0Kt6xf.js";import{n as w,r as T,t as E}from"./Feature-Bd-5gqon.js";import"./memoryEstimations-O7VgDRVG.js";import"./OptimizedFeature-Dx4_lHip.js";import"./OptimizedGeometry-f3I9Z6C1.js";import"./OptimizedFeatureSet-DlHqIhoP.js";import"./featureConversionUtils-7vyVIZ6j.js";import"./track-CqQN9dI1.js";import"./containerUtils-vIXF8Wsj.js";import"./aiServices-BSz92p7H.js";import"./commonProperties-fyxj-C5K.js";import"./WhereClause-h6PJ6gjs.js";import"./streamLayerUtils-BMw-RtDi.js";import"./functions-WMuSJ2is.js";import"./unitConversion-BbIQHFw4.js";import{A as D,E as O,S as k,T as A,c as j,d as M,f as N,i as P,j as F,k as I,p as L,r as R,u as z}from"./arcade-D8hsF49o.js";import"./fieldStats-DP2AlUAP.js";import"./ArcadePortal-B5V7N8wX.js";import"./Attachment-CoFGJO-I.js";import{n as B}from"./isImageryGraphicOrigin-Qwa2m0c8.js";import{r as V}from"./rasterFieldUtils-BXl_hh-f.js";import{n as H}from"./isImageryTileGraphicOrigin-DkUl-5nl.js";var U=()=>h.getLogger(`esri.arcade.Pixel`);function W(e){return e.rasterFields.filter(e=>e.name.startsWith(V))}var G=class e{constructor(e,t,n){this._graphic=t,this._timeZone=n,this.arcadeDeclaredClass=`esri.arcade.Pixel`,this._values=new Map,this._fields=new Map(e.map(e=>[g(e.name),e]))}static fromImageryGraphic(t,n){if(!B(t.origin)&&!H(t.origin))throw new c(null,`InvalidParameter`,null);return new e(W(t.origin.layer),t,n)}static getDeclaredMembers(e){return W(e).map(e=>m(e.name)&&e.type===`string`?{name:e.name,type:`array`,elementType:{type:`text`}}:E(e)).filter(e=>e!=null)}keys(){return Array.from(this._fields.values()).map(e=>e.name).sort()}hasField(e){return this._fields.has(g(e))}field(e){let t=this._fields.get(g(e));if(t==null)throw new c(null,`FieldNotFound`,null,{key:e});return i(this._values,t.name,()=>{let e=this._graphic.getAttribute(t.name);return e==null?null:m(t.name)&&typeof e==`string`?new _(e.split(/,\s*|\s+/)):u(e)||ne(e)?T(e,t.type,this._timeZone??`system`):(U().warn(`Unsupported type for attribute: ${t.name}. Ignoring value.`),null)})}isEmpty(){return this._fields.size<=0}castToText(e=!1){let t={};for(let e of this._fields.values())t[e.name]=this.field(e.name);return b(t,{useNumbersForDates:e})}},K=`Voxel.Position`,q=`Voxel.LocalTime`;function J(e){let t=e.getAttribute(K);if(typeof t!=`string`)throw new c(null,`InvalidParameter`,null);let n=JSON.parse(t);if(!Array.isArray(n)||typeof n[0]!=`number`||typeof n[1]!=`number`||typeof n[2]!=`number`)throw new c(null,`InvalidParameter`,null);return new _(n)}function Y(e,t){let n=e.getAttribute(q);if(n==null)return null;if(!u(n))throw new c(null,`InvalidParameter`,null);return a.dateJSAndZoneToArcadeDate(n,t)}var X=class{constructor(e,t){this._graphic=e,this._timeZone=t,this.arcadeDeclaredClass=`esri.arcade.Voxel`,this._layer=e.sourceLayer}static getDeclaredMembers(e){return e.fields.map(e=>{switch(e.name){case K:return{name:e.name,type:`array`,elementType:{type:`number`}};case q:return{name:e.name,type:`date`};default:switch(e.type){case`string`:return{name:e.name,type:`text`};case`double`:return{name:e.name,type:`number`}}return null}}).filter(e=>e!=null)}getPosition(){return this._position===void 0?this._position=J(this._graphic):this._position}getLocalTime(){return this._localTime===void 0?this._localTime=Y(this._graphic,this._timeZone??`system`):this._localTime}keys(){return this._layer.fields.map(e=>e.name).sort()}hasField(e){return this._layer.fieldsIndex.has(e)}field(e){let t=this._layer.fieldsIndex?.get(e)?.name;if(t==null)throw new c(null,`FieldNotFound`,null,{key:e});switch(t){case K:return this.getPosition();case q:return this.getLocalTime()}return this._graphic.attributes[t]??null}isEmpty(){return this._layer.fields.length<=0}castToText(e=!1){let t={...this._graphic.attributes};t[K]=this.getPosition(),q in t&&(t[q]=this.getLocalTime());for(let e of Object.keys(t))this._layer.fieldsIndex?.has(e)||delete t[e];return b(t,{useNumbersForDates:e})}},ie={vars:{$feature:`any`,$view:`any`}};function ae(e){return e.replaceAll(/[|\\{}()[\]^$+*?.]/g,`\\$&`)}function oe(e){return e==null?null:p(e)||C(e)?`array`:v(e)?`date`:f(e)?`text`:l(e)?`boolean`:te(e)?`number`:e instanceof S?`dictionary`:re(e)?`feature`:e instanceof n?`point`:e instanceof d?`polygon`:e instanceof r?`polyline`:e instanceof ee?`multipoint`:e instanceof s?`extent`:e instanceof o?`dateOnly`:e instanceof t?`time`:x(e)?`featureSet`:y(e)?`featureSetCollection`:null}function Z(e){if(!e)return null;try{return P(e)}catch{}return null}function se(t,n){let r=typeof t==`string`?Z(t):t;if(!r)return null;try{return n||=e(ie),j(r,n)}catch{}return null}function ce(e,t,n){return{vars:{$feature:e==null?new w:w.createFromGraphic(e,n),$view:t?.view},spatialReference:t?.sr,timeZone:n??null}}function le(e,t,n){return w.createFromGraphicLikeObject(t,e,n,null)}function ue(e,t){e.vars!=null&&(e.vars.$feature=t)}function de(e,t){let n;try{n=R(e,t)}catch{n=null}return n}function fe(e,t){let n;try{n=e?e(t):null}catch{n=null}return n}function pe(e,t){try{return e?e(t):Promise.resolve(null)}catch{return Promise.resolve(null)}}var me=[`$feature`,`$aggregatedFeatures`,`$voxel`].map(e=>g(e));function he(e,t){if(!e)return[];let n=typeof e==`string`?Z(e):e;if(!n)return[];let r=new Map;if(Array.isArray(t)||t==null)for(let e of me)r.set(e,t);else for(let[e,n]of t)r.set(g(e),n);let i=N(n).flatMap(({varId:e,memberNamePattern:t})=>{if(!r.has(e))return[];if(t.includes(`*`)){let n=r.get(e);if(n==null)return[];let i=RegExp(`^${t.split(/\*+/).map(ae).join(`.*`)}$`,`i`);return n.filter(e=>i.test(e))}return t.toLowerCase()});return[...new Set(i.sort())]}function ge(e){return L(e,`$view`)}function _e(e,t){return!!e&&L(e,t)}function ve(e){if(!e||e.spatialReference==null&&(e.scale==null||e.viewingMode==null))return;let t,n,{timeProperties:r,timeZone:i}=e;if(r!=null){let{currentStart:e,currentEnd:o}=r;i==null?(t=e==null?null:a.dateJSToArcadeDate(e),n=o==null?null:a.dateJSToArcadeDate(o)):(t=e==null?null:a.dateJSAndZoneToArcadeDate(e,i),n=o==null?null:a.dateJSAndZoneToArcadeDate(o,i))}return{view:e.viewingMode&&e.scale!=null?new S({__proto__:null,viewingMode:e.viewingMode,scale:e.scale,timeProperties:t!=null||n!=null?new S({__proto__:null,currentStart:t,currentEnd:n,startIncluded:!0,endIncluded:!0}):null}):null,sr:e.spatialReference}}function ye({url:e,spatialReference:t,lrucache:n,interceptor:r}){let i=D();return i?i.createFeatureSetCollectionFromService(e,t,n,r):null}function be({layer:e,spatialReference:t,outFields:n,returnGeometry:r,lrucache:i,interceptor:a}){if(e===null)return null;let o=D();return o?o.constructFeatureSet(e,t,n,r??!0,i,a):null}function xe(e){if(e?.map===null)return null;let t=D();return t?t.createFeatureSetCollectionFromMap(e.map,e.spatialReference,e.lrucache,e.interceptor):null}function Se(e,t){return S.convertJsonToArcade(e,t)}function Ce(e,t,n=[]){return I(e,t,n)}function we(){return F()}function Te(){return M()}function Ee(e){return`type`in e&&(e.type===`class-breaks`||e.type===`dictionary`||e.type===`dot-density`||e.type===`pie-chart`||e.type===`simple`||e.type===`unique-value`)}function De(e){return e.declaredClass===`esri.layers.support.LabelClass`}function Oe(e){return e.declaredClass===`esri.PopupTemplate`}function Q(e,t){if(!e)return!1;if(typeof e==`string`)return t(e);let n=e;if(Ee(n)){if(n.type===`dot-density`){let e=n.attributes?.some(e=>t(e.valueExpression));if(e)return e}let e=n.visualVariables,r=!!e&&e.some(e=>{let n=t(e.valueExpression);return e.type===`size`&&($(e.minSize)&&(n||=t(e.minSize.valueExpression)),$(e.maxSize)&&(n||=t(e.maxSize.valueExpression))),n});return!(!(`valueExpression`in n)||!t(n.valueExpression))||r}if(De(n)){let e=n.labelExpressionInfo?.expression;return!(!e||!t(e))||!1}return!!Oe(n)&&(!!n.expressionInfos&&n.expressionInfos.some(e=>t(e.expression))||Array.isArray(n.content)&&n.content.some(e=>e.type===`expression`&&t(e.expressionInfo?.expression)))}function ke(e){let t=Z(e);return!!t&&A(t)}function Ae(e){return Q(e,ke)}function je(e){let t=Z(e);return!!t&&z(t)}function Me(e){return Q(e,je)}function Ne(e){return Q(e,e=>{let t=Z(e);return!!t&&O(t)})}function $(e){return e&&e.declaredClass===`esri.renderers.visualVariables.SizeVariable`}export{S as Dictionary,G as Pixel,X as Voxel,k as arcade,w as arcadeFeature,be as convertFeatureLayerToFeatureSet,Se as convertJsonToArcade,xe as convertMapToFeatureSetCollection,ye as convertServiceUrlToWorkspace,ce as createExecContext,le as createFeature,se as createFunction,Z as createSyntaxTree,ge as dependsOnView,Te as enableFeatureSetOperations,we as enableGeometryOperations,de as evalSyntaxTree,pe as executeAsyncFunction,fe as executeFunction,he as extractFieldNames,oe as getArcadeType,ve as getViewInfo,Ae as hasGeometryFunctions,Me as hasGeometryOperations,_e as hasVariable,Ce as loadScriptDependencies,Ne as requiresTrack,ue as updateExecContext};