import{sD as e}from"./index-BqmCqmfp.js";import{c as t,r as n}from"./memoryEstimations-O7VgDRVG.js";import{r}from"./HUDIntersectorResult-CCf93UUm.js";import{t as i}from"./Intersector-DrVIdDEe.js";import{E as a,b as o,f as s,g as c,m as l,v as u,w as d}from"./graphicUtils-BCCvOGWP.js";var f=class{constructor(e,t,n,r){this.material=e,this.buffer=t,this.numVertices=n,this.boundingInfo=r,this.bufferWriter=e.createBufferWriter()}get layout(){return this.bufferWriter.layout}get numTriangles(){return this.numVertices/3}computeUsedMemory(){return this.buffer.byteLength+145}get renderGeometry(){return this}intersect(e,t,n,r,i,a,o,s){let c=this.bufferWriter,l=this.buffer;c.intersect(l,this.material.parameters,null,e,n,r,(n,r,c)=>m(n,r,c,e,t,a,o,i,s))}},p=class{constructor(e){this.engineGeometry=e;let t=this.material,n=this.engineGeometry,r=n.attributes,i=n.boundingInfo,a=t.createBufferWriter(),o=a.layout,s=a.elementCount(r),c=o.createBuffer(s);a.write(null,null,r,null,c,0),this.renderGeometry=new f(t,c.buffer,s,i)}get material(){return this.engineGeometry.material}get numVertices(){return this.engineGeometry.indexCount}get numTriangles(){return this.numVertices/3}get boundingInfo(){return this.engineGeometry.boundingInfo}computeUsedMemory(){return Array.from(this.engineGeometry.attributes.values()).reduce((e,t)=>e+n(t.data,t.indices),0)}intersect(e,t,n,r,i,a,o,s){let c=this.engineGeometry;this.material.intersect(c,e.transform.transform,e,n,r,(n,r,c)=>m(n,r,c,e,t,a,o,i,s))}};function m(e,t,n,a,o,s,c,l,u){if(e<0||o&&!o(a.rayBegin,a.rayEnd,e))return;let d=new i(s.layerViewUid,s.graphicUid(l),n,c,u);if((a.results.min.distance==null||e<a.results.min.distance)&&a.results.min.set(3,d,e,t,a.transform.transform),(a.results.max.distance==null||e>a.results.max.distance)&&a.results.max.set(3,d,e,t,a.transform.transform),a.options.store===2){let n=new r(a.results.min.ray);n.set(3,d,e,t,a.transform.transform),a.results.all.push(n)}}var h=class{constructor(e,t=null){this.geometry=e,this.textures=t}get material(){return this.geometry.material}get numTriangles(){return this.geometry.numTriangles}},g=class{constructor(t,n,r){this.components=t,this.minScreenSpaceRadius=n,this.pivotOffset=r,this.numVertices=e(this.components.map(e=>e.geometry)).reduce((e,t)=>e+t.numVertices,0)}},_=class{constructor(e){this.levels=e,this.levels.sort((e,t)=>e.minScreenSpaceRadius===t.minScreenSpaceRadius?e.numVertices-t.numVertices:e.minScreenSpaceRadius-t.minScreenSpaceRadius)}get materialParameters(){return this.levels[0].components[0].geometry.material.parameters}getMaterials(){let t=[];return this.levels.forEach(e=>e.components.forEach(e=>t.push(e.geometry.material))),e(t)}getTextures(){let t=[];return this.levels.forEach(e=>e.components.forEach(e=>{e.textures!=null&&t.push(...e.textures)})),e(t)}getGeometries(){let t=[];return this.levels.forEach(e=>e.components.forEach(e=>{t.push(e.geometry)})),e(t)}getEngineGeometries(){return this.getGeometries().map(e=>e.engineGeometry).filter(e=>e!=null)}computeUsedMemory(){let e=this.getGeometries(),t=this.getTextures(),n=e.reduce((e,t)=>e+t.computeUsedMemory(),0);return t.reduce((e,t)=>e+t.usedMemory,0)+n}};function v(e){switch(e){case`sphere`:case`cube`:case`diamond`:case`cylinder`:case`cone`:case`inverted-cone`:case`tetrahedron`:return!0}return!1}function y(e,t){let n=(e,t,n=!1)=>new _(e.map(e=>{let r=t(e.tesselation);return n&&c(r),new g([new h(new p(r))],e.minScreenSpaceRadius)}));switch(e){case`sphere`:return n([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],e=>o(t,.5,e,!0));case`cube`:return n([{tesselation:0,minScreenSpaceRadius:0}],()=>s(t,1));case`cone`:return n(b,e=>u(t,1,.5,e,!1),!0);case`inverted-cone`:return n(b,e=>u(t,1,.5,e,!0),!0);case`cylinder`:return n(b,e=>a(t,1,.5,e,[0,0,1],[0,0,.5]));case`tetrahedron`:return n([{tesselation:0,minScreenSpaceRadius:0}],()=>d(t,1),!0);case`diamond`:return n([{tesselation:0,minScreenSpaceRadius:0}],()=>l(t,1),!0);default:return}}var b=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];export{h as a,_ as i,y as n,p as o,g as r,v as t};