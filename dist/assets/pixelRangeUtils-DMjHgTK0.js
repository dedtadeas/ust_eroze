var e=9999999e31,t=2e-7,n={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34028234663852886e22,34028234663852886e22],f64:[-Number.MAX_VALUE,Number.MAX_VALUE],unknown:void 0,c64:void 0,c128:void 0};function r(e){return n[e]??[-34028234663852886e22,34028234663852886e22]}var i={u1:1,u2:1,u4:1,u8:1,s8:1,u16:2,s16:2,u32:4,s32:4,f32:4,f64:8,unknown:4,c64:16,c128:32};function a(e){return i[e]}function o(e){return a(e.pixelType)*e.bandCount}function s(e,t){return e==null||t==null?`s32`:e<0?e>=-128&&t<128?`s8`:e>=-32768&&t<32768?`s16`:`s32`:t<256?`u8`:t<65536?`u16`:`u32`}function c(e){return(e?.startsWith(`s`)||e?.startsWith(`u`))??!1}function l(e,t,n,i){let[a,o]=r(n),s=c(n);return s&&(a-=1e-5,o+=1e-5),s?n.startsWith(`u`)?d(e,t,i,[a,o]):f(e,t,i,[a,o]):p(e,t,i,[a,o])}function u(e,t){for(let n=0;n<t.length;n++)t[n]&&isNaN(e[n])&&(t[n]=0,e[n]=0)}function d(e,t,n,r){let[i,a]=r;for(let r=0;r<t.length;r++)if(t[r]){let o=e[r];o<i||o>a?t[r]=0:n[r]=o+.5|0}}function f(e,t,n,r){let[i,a]=r;for(let r=0;r<t.length;r++)if(t[r]){let o=e[r];o<i||o>a?t[r]=0:n[r]=o+(o>0?.5:-.5)|0}}function p(e,t,n,r){let[i,a]=r;for(let r=0;r<t.length;r++)if(t[r]){let o=e[r];o<i||o>a?t[r]=0:n[r]=o}}function m(n,i,a){if(n.depthCount&&n.depthCount>1)return;let{pixels:o,statistics:s,pixelType:c}=n,l=o[0].length,u=n.bandMasks??[],d=n.mask??new Uint8Array(l).fill(255),f=c===`f32`||c===`f64`,p=r(c),m=!1;for(let n=0;n<o.length;n++){let r=typeof i==`number`?i:i[n];if(r==null)continue;let l=s?.[n]?.minValue??p[0],h=s?.[n]?.maxValue??p[1];if(l>r+2**-52||h<r-2**-52)continue;let g=u[n]||d.slice(),_=o[n],v=a?.customFloatTolerance;if(f&&v!==0){let n=v;n||=Math.abs(r)>=e?t*Math.abs(r):c===`f32`?2**-23:2**-52;for(let e=0;e<_.length;e++)g[e]&&Math.abs(_[e]-r)<n&&(_[e]=0,g[e]=0,d[e]=0,m=!0)}else for(let e=0;e<_.length;e++)g[e]&&_[e]===r&&(_[e]=0,g[e]=0,d[e]=0,m=!0);u[n]=g}if(m){let e=n.bandMasks||n.pixels.length>1?u:null;a?.matchAllNoData?n.mask=e&&e.length>1?h(e):d:(n.bandMasks=e,n.mask=d)}function h(e){if(e.length<2)return e[0];let t=e[0].length,n=new Uint8Array(t).fill(0);for(let r=0;r<e.length;r++){let i=e[r];for(let e=0;e<t;e++)i[e]&&(n[e]=255)}return n}m&&`updateStatistics`in n&&n.updateStatistics()}export{o as a,s as i,u as n,c as o,m as r,r as s,l as t};