import{CD as e,Cs as t,Hx as n,IC as r,Iw as i,Lw as a,MC as o,Wy as s,kC as c,oC as l,vC as u,zy as d}from"./index-BqmCqmfp.js";import{a as f,o as p,t as m}from"./meshCloneUtils-Akm6YUJV.js";var h,g=new WeakMap,_=0,v=class extends d(u){static{h=this}constructor(e){super(e),this.wrap=`repeat`}get url(){return this._get(`url`)||null}set url(e){this._set(`url`,e),e&&this._set(`data`,null)}get data(){return this._get(`data`)||null}set data(e){this._set(`data`,e),e&&this._set(`url`,null)}writeData(e,t,n,r){e instanceof HTMLImageElement?t[n]={type:`image-element`,src:a(e.src,r),crossOrigin:e.crossOrigin}:e instanceof HTMLCanvasElement?t[n]={type:`canvas-element`,imageData:y(e.getContext(`2d`).getImageData(0,0,e.width,e.height))}:e instanceof HTMLVideoElement?t[n]={type:`video-element`,src:a(e.src,r),autoplay:e.autoplay,loop:e.loop,muted:e.muted,crossOrigin:e.crossOrigin,preload:e.preload}:e instanceof ImageData&&(t[n]={type:`image-data`,imageData:y(e)})}readData(e){switch(e.type){case`image-element`:{let t=new Image;return t.src=e.src,t.crossOrigin=e.crossOrigin,t}case`canvas-element`:{let t=b(e.imageData),n=document.createElement(`canvas`);return n.width=t.width,n.height=t.height,n.getContext(`2d`).putImageData(t,0,0),n}case`image-data`:return b(e.imageData);case`video-element`:{let t=document.createElement(`video`);return t.src=e.src,t.crossOrigin=e.crossOrigin,t.autoplay=e.autoplay,t.loop=e.loop,t.muted=e.muted,t.preload=e.preload,t}default:return}}get transparent(){let{data:e,url:t}=this,n=e=>e?.toLowerCase().endsWith(`.png`)||e?.toLocaleLowerCase().startsWith(`data:image/png;`);return e instanceof HTMLCanvasElement?x(e.getContext(`2d`).getImageData(0,0,e.width,e.height)):e instanceof ImageData?x(e):!(!t||!n(t))||!!(e instanceof HTMLImageElement&&n(e.src))}set transparent(e){this._overrideIfSome(`transparent`,e)}get contentHash(){let e=typeof this.wrap==`string`?this.wrap:typeof this.wrap==`object`?`${this.wrap.horizontal}/${this.wrap.vertical}`:``,t=(t=``)=>`d:${t},t:${this.transparent},w:${e}`;return this.url==null?this.data==null?t():this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?t(this.data.src):(g.has(this.data)||g.set(this.data,++_),t(g.get(this.data))):t(this.url)}get memoryUsage(){let e=0;if(e+=this.url==null?0:this.url.length,this.data!=null){let t=this.data;`data`in t?e+=t.data.byteLength:t instanceof HTMLImageElement?e+=t.naturalWidth*t.naturalHeight*3:t instanceof HTMLCanvasElement&&(e+=t.width*t.height*3)}return e}clone(e){let t=p(e),n=t?.textureMap?.get(this);if(n)return n;let r=super.clone(e);return t?.textureMap?.set(this,r),r}static from(e){return typeof e==`string`?new h({url:e}):e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData||e instanceof HTMLVideoElement?new h({data:e}):r(h,e)}};function y(e){let t=``;for(let n=0;n<e.data.length;n++)t+=String.fromCharCode(e.data[n]);return{data:btoa(t),width:e.width,height:e.height}}function b(e){let n=atob(e.data),r=new Uint8ClampedArray(n.length);for(let e=0;e<n.length;e++)r[e]=n.charCodeAt(e);return t(r,e.width,e.height)}function x(e){for(let t=3;t<e.data.length;t+=4)if(e.data[t]!==255)return!0;return!1}e([o({type:String,json:{write:i}})],v.prototype,`url`,null),e([o({clonable:`reference`,json:{write:{overridePolicy(){return{enabled:!this.url}}}}})],v.prototype,`data`,null),e([l(`data`)],v.prototype,`writeData`,null),e([n(`data`)],v.prototype,`readData`,null),e([o({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden(`transparent`)}}}}})],v.prototype,`transparent`,null),e([o({json:{write:!0}})],v.prototype,`wrap`,void 0),e([o({readOnly:!0})],v.prototype,`contentHash`,null),v=h=e([c(`esri.geometry.support.MeshTexture`)],v);var S=class extends d(u){constructor(e){super(e),this.offset=[0,0],this.rotation=0,this.scale=[1,1]}};e([o({type:[Number],nonNullable:!0,json:{write:!0}})],S.prototype,`offset`,void 0),e([o({type:Number,nonNullable:!0,json:{write:!0}})],S.prototype,`rotation`,void 0),e([o({type:[Number],nonNullable:!0,json:{write:!0}})],S.prototype,`scale`,void 0),S=e([c(`esri.geometry.support.MeshTextureTransform`)],S);var C=class extends d(u){constructor(e){super(e),this.color=null,this.colorTexture=null,this.colorTextureTransform=null,this.normalTexture=void 0,this.normalTextureTransform=void 0,this.alphaMode=`auto`,this.alphaCutoff=.5,this.doubleSided=!0}clone(e){let t=f(e),n=t?.materialMap?.get(this);if(n)return n;let r=super.clone(m(e));return t?.materialMap?.set(this,r),r}get memoryUsage(){return this.getMemoryUsage()}getMemoryUsage(){let e=0;return e+=this.color==null?0:16,this.colorTexture!=null&&(e+=this.colorTexture.memoryUsage),e+=this.colorTextureTransform==null?0:20,this.normalTexture!=null&&(e+=this.normalTexture.memoryUsage),e+=this.normalTextureTransform==null?0:20,e}};e([o({type:s,json:{write:!0}})],C.prototype,`color`,void 0),e([o({type:v,json:{write:!0}})],C.prototype,`colorTexture`,void 0),e([o({type:S,json:{write:!0}})],C.prototype,`colorTextureTransform`,void 0),e([o({type:v,json:{write:!0}})],C.prototype,`normalTexture`,void 0),e([o({type:S,json:{write:!0}})],C.prototype,`normalTextureTransform`,void 0),e([o({nonNullable:!0,json:{write:!0}})],C.prototype,`alphaMode`,void 0),e([o({nonNullable:!0,json:{write:!0}})],C.prototype,`alphaCutoff`,void 0),e([o({nonNullable:!0,json:{write:!0}})],C.prototype,`doubleSided`,void 0),C=e([c(`esri.geometry.support.MeshMaterial`)],C);var w=class extends C{constructor(e){super(e),this.emissiveColor=null,this.emissiveTexture=null,this.emissiveTextureTransform=void 0,this.occlusionTexture=null,this.occlusionTextureTransform=void 0,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null,this.metallicRoughnessTextureTransform=void 0}getMemoryUsage(){let e=super.getMemoryUsage();return e+=this.emissiveColor==null?0:16,this.emissiveTexture!=null&&(e+=this.emissiveTexture.memoryUsage),e+=this.emissiveTextureTransform==null?0:20,this.occlusionTexture!=null&&(e+=this.occlusionTexture.memoryUsage),e+=this.occlusionTextureTransform==null?0:20,this.metallicRoughnessTexture!=null&&(e+=this.metallicRoughnessTexture.memoryUsage),e+=this.metallicRoughnessTextureTransform==null?0:20,e}};e([o({type:s,json:{write:!0}})],w.prototype,`emissiveColor`,void 0),e([o({type:v,json:{write:!0}})],w.prototype,`emissiveTexture`,void 0),e([o({type:S,json:{write:!0}})],w.prototype,`emissiveTextureTransform`,void 0),e([o({type:v,json:{write:!0}})],w.prototype,`occlusionTexture`,void 0),e([o({type:S,json:{write:!0}})],w.prototype,`occlusionTextureTransform`,void 0),e([o({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],w.prototype,`metallic`,void 0),e([o({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],w.prototype,`roughness`,void 0),e([o({type:v,json:{write:!0}})],w.prototype,`metallicRoughnessTexture`,void 0),e([o({type:S,json:{write:!0}})],w.prototype,`metallicRoughnessTextureTransform`,void 0),w=e([c(`esri.geometry.support.MeshMaterialMetallicRoughness`)],w);export{v as i,C as n,S as r,w as t};