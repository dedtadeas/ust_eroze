import{bD as e,xw as t}from"./index-BqmCqmfp.js";import{r as n}from"./memoryEstimations-O7VgDRVG.js";var r=4294967296,i=new TextDecoder(`utf-8`),a=e(`safari`)||e(`ios`)?6:e(`ff`)?12:32,o=class e{constructor(e,t,n=0,r=e?e.byteLength:0){this._tag=0,this._dataType=99,this._init(e,t,n,r)}_init(e,t,n,r){this._data=e,this._dataView=t,this._pos=n,this._end=r}get usedMemory(){return 64+n(this._data)}asUnsafe(){return this}clone(){return new e(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(e){this._pos=e}nextTag(e){for(;;){if(this._pos===this._end)return!1;let t=this._decodeVarint();if(this._tag=t>>3,this._dataType=7&t,!e||e===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;let e=this._decodeVarint();return this._tag=e>>3,this._dataType=7&e,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let e=4294967295;if(e=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128||(e=(e|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128)||(e=(e|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128)||(e=(e|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128)||(e=(e|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128))return e;throw Error(`Varint overflow`)}getUInt64(){return this._decodeVarint()}getSInt32(){let e=this.getUInt32();return e>>>1^-(1&e)}getSInt64(){return this._decodeSVarint()}getBool(){let e=this._data[this._pos]!==0;return this._skip(1),e}getEnum(){return this._decodeVarint()}getFixed64(){let e=this._dataView,t=this._pos,n=e.getUint32(t,!0)+e.getUint32(t+4,!0)*r;return this._skip(8),n}getSFixed64(){let e=this._dataView,t=this._pos,n=e.getUint32(t,!0)+e.getInt32(t+4,!0)*r;return this._skip(8),n}getDouble(){let e=this._dataView.getFloat64(this._pos,!0);return this._skip(8),e}getFixed32(){let e=this._dataView.getUint32(this._pos,!0);return this._skip(4),e}getSFixed32(){let e=this._dataView.getInt32(this._pos,!0);return this._skip(4),e}getFloat(){let e=this._dataView.getFloat32(this._pos,!0);return this._skip(4),e}getString(){let e=this._getLength(),t=this._pos,n=this._toString(this._data,t,t+e);return this._skip(e),n}getBytes(){let e=this._getLength(),t=this._pos,n=this._toBytes(this._data,t,t+e);return this._skip(e),n}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(e,t,n,r){let i=this.getMessage(),a=e(i,t,n,r);return i.release(),a}processMessage(e){let t=this.getMessage(),n=e(t);return t.release(),n}getMessage(){let t=this._getLength(),n=e.pool.acquire();return n._init(this._data,this._dataView,this._pos,this._pos+t),this._skip(t),n}release(){e.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case 0:this._decodeVarint();break;case 1:this._skip(8);break;case 2:this._skip(this._getLength());break;case 5:this._skip(4);break;default:throw Error(`Invalid data type!`)}}skipLen(e){this._skip(e)}_skip(e){if(this._pos+e>this._end)throw Error(`Attempt to skip past the end of buffer!`);this._pos+=e}_decodeVarint(){let e=this._data,t=this._pos,n=0,r=0;if(this._end-t>=10)do{if(r=e[t++],n|=127&r,!(128&r)||(r=e[t++],n|=(127&r)<<7,!(128&r))||(r=e[t++],n|=(127&r)<<14,!(128&r))||(r=e[t++],n|=(127&r)<<21,!(128&r))||(r=e[t++],n+=268435456*(127&r),!(128&r))||(r=e[t++],n+=34359738368*(127&r),!(128&r))||(r=e[t++],n+=4398046511104*(127&r),!(128&r))||(r=e[t++],n+=562949953421312*(127&r),!(128&r))||(r=e[t++],n+=72057594037927940*(127&r),!(128&r))||(r=e[t++],n+=0x8000000000000000*(127&r),!(128&r)))break;throw Error(`Varint too long!`)}while(0);else{let i=1;for(;t!==this._end&&(r=e[t],128&r);)++t,n+=(127&r)*i,i*=128;if(t===this._end)throw Error(`Varint overrun!`);++t,n+=r*i}return this._pos=t,n}_decodeSVarint(){let e=this._data,t,n=0,r=0,i=1&e[this._pos];if(r=e[this._pos++],n|=127&r,!(128&r)||(r=e[this._pos++],n|=(127&r)<<7,!(128&r))||(r=e[this._pos++],n|=(127&r)<<14,!(128&r))||(r=e[this._pos++],n|=(127&r)<<21,!(128&r))||(r=e[this._pos++],n+=268435456*(127&r),!(128&r))||(r=e[this._pos++],n+=34359738368*(127&r),!(128&r))||(r=e[this._pos++],n+=4398046511104*(127&r),!(128&r)))return i?-(n+1)/2:n/2;if(t=BigInt(n),r=e[this._pos++],t+=562949953421312n*BigInt(127&r),!(128&r)||(r=e[this._pos++],t+=72057594037927936n*BigInt(127&r),!(128&r))||(r=e[this._pos++],t+=9223372036854775808n*BigInt(127&r),!(128&r)))return Number(i?-(t+1n)/2n:t/2n);throw Error(`Varint too long!`)}_getLength(){if(this._dataType!==2)throw Error(`Not a delimited data type!`);return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(e,t,n){if((n=Math.min(this._end,n))-t>a){let r=e.subarray(t,n);return i.decode(r)}let r=``,o=``;for(let i=t;i<n;++i){let t=e[i];128&t?o+=`%`+t.toString(16):(r+=decodeURIComponent(o)+String.fromCharCode(t),o=``)}return o.length&&(r+=decodeURIComponent(o)),r}_toBytes(e,t,n){return n=Math.min(this._end,n),new Uint8Array(e.buffer,t,n-t)}static{this.pool=new t(()=>new e(null,null),void 0,e=>{e._data=null,e._dataView=null})}};export{o as t};