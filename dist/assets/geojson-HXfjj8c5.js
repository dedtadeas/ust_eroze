import{Jp as e,MS as t,Xp as n,_E as r}from"./index-BqmCqmfp.js";import{n as i}from"./OptimizedFeature-Dx4_lHip.js";import{t as a}from"./OptimizedGeometry-f3I9Z6C1.js";import{r as o}from"./date-DKxAu4UK.js";var s={LineString:`esriGeometryPolyline`,MultiLineString:`esriGeometryPolyline`,MultiPoint:`esriGeometryMultipoint`,Point:`esriGeometryPoint`,Polygon:`esriGeometryPolygon`,MultiPolygon:`esriGeometryPolygon`};function c(e){return s[e]}function*l(e){switch(e.type){case`Feature`:yield e;break;case`FeatureCollection`:for(let t of e.features)t&&(yield t)}}function*u(e){if(e)switch(e.type){case`Point`:yield e.coordinates;break;case`LineString`:case`MultiPoint`:yield*e.coordinates;break;case`MultiLineString`:case`Polygon`:for(let t of e.coordinates)yield*t;break;case`MultiPolygon`:for(let t of e.coordinates)for(let e of t)yield*e}}function*d(e,t={}){let{geometryType:n,objectIdField:r}=t;for(let o of e){let{geometry:e,properties:s,id:l}=o;if(e&&c(e.type)!==n)continue;let u=s||{},d;r&&(d=u[r],l==null||d||(u[r]=d=l)),yield new i(e?_(new a,e,t):null,u,null,d)}}function f(e){for(let t of e)if(t.length>2)return!0;return!1}function p(e){return!h(e)}function m(e){return h(e)}function h(e){let t=0;for(let n=0;n<e.length;n++){let r=e[n],i=e[(n+1)%e.length];t+=r[0]*i[1]-i[0]*r[1]}return t<=0}function g(e){let t=e[0],n=e[e.length-1];return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]||e.push(t),e}function _(e,t,n){switch(t.type){case`LineString`:return v(e,t,n);case`MultiLineString`:return y(e,t,n);case`MultiPoint`:return b(e,t,n);case`MultiPolygon`:return x(e,t,n);case`Point`:return S(e,t,n);case`Polygon`:return C(e,t,n)}}function v(e,t,n){return E(e,t.coordinates,n),e}function y(e,t,n){for(let r of t.coordinates)E(e,r,n);return e}function b(e,t,n){return E(e,t.coordinates,n),e}function x(e,t,n){for(let r of t.coordinates){w(e,r[0],n);for(let t=1;t<r.length;t++)T(e,r[t],n)}return e}function S(e,t,n){return O(e,t.coordinates,n),e}function C(e,t,n){let r=t.coordinates;w(e,r[0],n);for(let t=1;t<r.length;t++)T(e,r[t],n);return e}function w(e,t,n){let r=g(t);p(r)?D(e,r,n):E(e,r,n)}function T(e,t,n){let r=g(t);m(r)?D(e,r,n):E(e,r,n)}function E(e,t,n){for(let r of t)O(e,r,n);e.lengths.push(t.length)}function D(e,t,n){for(let r=t.length-1;r>=0;r--)O(e,t[r],n);e.lengths.push(t.length)}function O(e,t,n){let[r,i,a]=t;e.coords.push(r,i),n.hasZ&&e.coords.push(a||0)}function k(e){switch(typeof e){case`string`:return o(e)?`esriFieldTypeDate`:`esriFieldTypeString`;case`number`:return`esriFieldTypeDouble`;default:return`unknown`}}function A(e,n=4326){if(!e)throw new r(`geojson-layer:empty`,`GeoJSON data is empty`);if(e.type!==`Feature`&&e.type!==`FeatureCollection`)throw new r(`geojson-layer:unsupported-geojson-object`,`missing or not supported GeoJSON object type`,{data:e});let{crs:i}=e;if(!i)return;let a=typeof i==`string`?i:i.type===`name`?i.properties.name:i.type===`EPSG`?i.properties.code:null,o=t({wkid:n})?RegExp(`.*(CRS84H?|4326)$`,`i`):RegExp(`.*(${n})$`,`i`);if(!a||!o.test(a))throw new r(`geojson:unsupported-crs`,`unsupported GeoJSON 'crs' member`,{crs:i})}function j(t,r={}){let i=[],a=new Set,o=new Set,s,d=!1,p=null,m=!1,{geometryType:h=null}=r;for(let n of l(t)){let{geometry:t,properties:r,id:l}=n;if((!t||(h||=c(t.type),c(t.type)===h))&&(d||=f(u(t)),m||(m=l!=null,m&&(s=typeof l,r&&(p=Object.keys(r).filter(e=>r[e]===l)))),r&&p&&m&&l!=null&&(p.length>1?p=p.filter(e=>r[e]===l):p.length===1&&(p=r[p[0]]===l?p:[])),r))for(let t in r){if(a.has(t))continue;let n=k(r[t]);if(n===`unknown`){o.add(t);continue}o.delete(t),a.add(t);let s=e(t);s&&i.push({name:s,alias:t,type:n})}}let g=e(p?.length===1&&p[0]||null)??void 0;if(g){for(let e of i)if(e.name===g&&n(e)){e.type=`esriFieldTypeOID`;break}}return{fields:i,geometryType:h,hasZ:d,objectIdFieldName:g,objectIdFieldType:s,unknownFields:Array.from(o)}}function M(e,t){return Array.from(d(l(e),t))}export{c as i,j as n,M as r,A as t};