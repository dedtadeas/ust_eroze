import{Bg as e,Fg as t,IC as n,Ig as r,Lg as i,Qx as a,Ux as o,_E as s,e_ as c,kS as l,zS as u}from"./index-BqmCqmfp.js";function d(e){if(!e)return null;let n=e.wkid;if(n)return t[n];let r=e.wkt2??e.wkt;return r?f(r):null}function f(e){let t=i.exec(e);if(!t||t.length!==2)return null;let n=t[1].split(`,`);if(!n||n.length<3)return null;let r=parseFloat(n[1]),a=parseFloat(n[2]);return isNaN(r)||isNaN(a)?null:{a:r,f:a===0?0:1/a}}function p(e){let t=d(e);if(m(t))return t;let n=t.a*(1-t.f);return Object.assign(t,{b:n,eSq:1-(n/t.a)**2,radius:(2*t.a+n)/3,densificationRatio:1e4/((2*t.a+n)/3)})}function m(e){return e!=null&&`b`in e&&`eSq`in e&&`radius`in e}function h(e,t,n){let{a:i,eSq:a}=p(n),o=Math.sqrt(a),s=Math.sin(t[1]*r),c=i*t[0]*r,l;return l=a>0?i*((1-a)*(s/(1-a*(s*s))-1/(2*o)*Math.log((1-o*s)/(1+o*s))))*.5:i*s,e[0]=c,e[1]=l,e}function g(e){return u(e)&&!!d(e)}function _(e,t=`square-meters`){if(e.some(e=>!g(e.spatialReference)))throw new s(`geodesic-areas:invalid-spatial-reference`,`the input geometries spatial reference is not supported`);let n=[];for(let t=0;t<e.length;t++){let r=e[t],i=r.spatialReference,{radius:a,densificationRatio:o}=p(i),s=a*o;n.push(y(r,s))}let r=[],i=[0,0],o=[0,0];for(let e=0;e<n.length;e++){let{rings:s,spatialReference:c}=n[e],l=0;for(let e=0;e<s.length;e++){let t=s[e];h(i,t[0],c),h(o,t[t.length-1],c);let n=o[0]*i[1]-i[0]*o[1];for(let e=0;e<t.length-1;e++)h(i,t[e+1],c),h(o,t[e],c),n+=o[0]*i[1]-i[0]*o[1];l+=n}l=a(l,`square-meters`,t),r.push(l/-2)}return r}function v(e,t=`meters`){if(!e)throw new s(`geodesic-lengths:invalid-geometries`,`the input geometries type is not supported`);if(e.some(e=>!g(e.spatialReference)))throw new s(`geodesic-lengths:invalid-spatial-reference`,`the input geometries spatial reference is not supported`);let n=[];for(let r=0;r<e.length;r++){let i=e[r],{spatialReference:o}=i,s=i.type===`polyline`?i.paths:i.rings,c=0;for(let e=0;e<s.length;e++){let t=s[e],n=0;for(let e=1;e<t.length;e++){let r=t[e-1][0],i=t[e][0],a=t[e-1][1],s=t[e][1];if(a!==s||r!==i){let e=new b;S(e,[r,a],[i,s],o),n+=e.distance}}c+=n}c=a(c,`meters`,t),n.push(c)}return n}function y(t,r){if(t.type!==`polyline`&&t.type!==`polygon`)throw new s(`geodesic-densify:invalid-geometry`,`the input geometry is neither polyline nor polygon`);let{spatialReference:i}=t;if(!g(i))throw new s(`geodesic-densify:invalid-spatial-reference`,`the input geometry spatial reference is not supported`);let a=t.type===`polyline`?t.paths:t.rings,l=[],u=[0,0],d=new b;for(let e of a){let t=[];l.push(t),t.push([e[0][0],e[0][1]]);let n,a,o=e[0][0],s=e[0][1];for(let c=0;c<e.length-1;c++){if(n=e[c+1][0],a=e[c+1][1],o===n&&s===a)continue;let l=[o,s];S(d,[o,s],[n,a],i);let{azimuth:f,distance:p}=d,m=p/r;if(m>1){for(let e=1;e<=m-1;e++)x(u,l,f,e*r,i),t.push(u.slice());x(u,l,f,(p+Math.floor(m-1)*r)/2,i),t.push(u.slice())}x(u,l,f,p,i),t.push(u.slice()),o=u[0],s=u[1]}}let f=n(o,i);return t.type===`polyline`?new e({paths:l,spatialReference:f}):new c({rings:l,spatialReference:f})}var b=class{constructor(e=0,t=void 0,n=void 0){this.distance=e,this.azimuth=t,this.reverseAzimuth=n}};function x(e,t,n,i,a){let o=t[0],s=t[1],c=o*r,l=s*r,u=(n??0)*r,{a:d,b:f,f:m}=p(a),h=Math.sin(u),g=Math.cos(u),_=(1-m)*Math.tan(l),v=1/Math.sqrt(1+_*_),y=_*v,b=Math.atan2(_,g),x=v*h,S=x*x,C=1-S,w=C*(d*d-f*f)/(f*f),T=1+w/16384*(4096+w*(w*(320-175*w)-768)),E=w/1024*(256+w*(w*(74-47*w)-128)),D,O,k,A=i/(f*T),j=2*Math.PI;for(;Math.abs(A-j)>1e-12;)k=Math.cos(2*b+A),D=Math.sin(A),O=Math.cos(A),j=A,A=i/(f*T)+E*D*(k+E/4*(O*(2*k*k-1)-E/6*k*(4*D*D-3)*(4*k*k-3)));let M=y*D-v*O*g,N=Math.atan2(y*O+v*D*g,(1-m)*Math.sqrt(S+M*M)),P=m/16*C*(4+m*(4-3*C)),F=Math.atan2(D*h,v*O-y*D*g)-(1-P)*m*x*(A+P*D*(k+P*O*(2*k*k-1)));return e[0]=(c+F)/r,e[1]=N/r,e}function S(e,t,n,i){let a=t[0]*r,o=t[1]*r,s=n[0]*r,c=n[1]*r,{a:l,b:u,f:d,radius:f}=p(i),m=s-a,h=Math.atan((1-d)*Math.tan(o)),g=Math.atan((1-d)*Math.tan(c)),_=Math.sin(h),v=Math.cos(h),y=Math.sin(g),b=Math.cos(g),x,S,C,w,T,E,D,O,k,A,j=1e3,M=m;do{if(D=Math.sin(M),O=Math.cos(M),C=Math.sqrt(b*D*(b*D)+(v*y-_*b*O)*(v*y-_*b*O)),C===0)return e.distance=0,e.azimuth=void 0,e.reverseAzimuth=void 0,e;T=_*y+v*b*O,E=Math.atan2(C,T),k=v*b*D/C,S=1-k*k,w=T-2*_*y/S,isNaN(w)&&(w=0),A=d/16*S*(4+d*(4-3*S)),x=M,M=m+(1-A)*d*k*(E+A*C*(w+A*T*(2*w*w-1)))}while(Math.abs(M-x)>1e-12&&--j>0);if(j===0){let t=f,n=Math.acos(Math.sin(o)*Math.sin(c)+Math.cos(o)*Math.cos(c)*Math.cos(s-a))*t,i=s-a,l=Math.sin(i)*Math.cos(c),u=Math.cos(o)*Math.sin(c)-Math.sin(o)*Math.cos(c)*Math.cos(i);return e.azimuth=Math.atan2(l,u)/r,e.distance=n,e.reverseAzimuth=void 0,e}let N=S*(l*l-u*u)/(u*u),P=N/1024*(256+N*(N*(74-47*N)-128)),F=u*(1+N/16384*(4096+N*(N*(320-175*N)-768)))*(E-P*C*(w+P/4*(T*(2*w*w-1)-P/6*w*(4*C*C-3)*(4*w*w-3)))),I=Math.atan2(b*Math.sin(M),v*y-_*b*Math.cos(M)),L=Math.atan2(v*Math.sin(M),v*y*Math.cos(M)-_*b);return e.azimuth=I/r,e.distance=F,e.reverseAzimuth=L/r,e}function C(e){return g(e)?e:l(e)?o.WGS84:null}export{S as a,x as i,v as n,_ as o,b as r,g as s,C as t};