const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Compositing.glsl-BmTH8Q5-.js","assets/Compositing.glsl-BYZe6B-5.js","assets/ScreenSpacePass.glsl-Br3vxYsG.js","assets/glsl-C2sn87h0.js","assets/ReadDepth.glsl-DvJ8t0GM.js","assets/index-BqmCqmfp.js","assets/index-kIqmb12G.css","assets/Float2BindUniform-BJ75NEvo.js","assets/Uniform-DXwqrKA1.js","assets/FloatPassUniform-BEwJjV4q.js","assets/Texture2DPassUniform-Cd7cdF1a.js","assets/NoParameters-CpAItLvD.js","assets/ShaderBuilder-C3C7fUwK.js","assets/Laserlines.glsl-hkL80ocp.js","assets/Laserlines.glsl-Ba7d6LU6.js","assets/sphere-CicnK0Bn.js","assets/vectorStacks-CKtslZxP.js","assets/quatf64-CJzmL3cc.js","assets/lineSegment-uFalXigL.js","assets/plane-CTjDePZl.js","assets/Laserline.glsl-BEu4tx-q.js","assets/CameraSpace.glsl-cnQVTSzq.js","assets/Float4BindUniform-CtMVDjau.js","assets/Float3PassUniform-Co8OqiAU.js","assets/Texture2DBindUniform-CSngcuNV.js","assets/Float2PassUniform-D4VTGzqn.js","assets/Float3BindUniform-BrSuqm5i.js","assets/Float4PassUniform-Bo_mhcMi.js","assets/FloatBindUniform-TDSkRzMc.js","assets/LaserlinePath.glsl-D5pAU-bj.js","assets/LaserlinePath.glsl-Cc_iomvO.js","assets/Matrix4BindUniform-BUS9JrUC.js","assets/Matrix4PassUniform-DbEU5DCd.js","assets/ShadedColorMaterial.glsl-e7VX6t4X.js","assets/ShadedColorMaterial.glsl-CDWT6SD5.js","assets/Transform.glsl-YgD9m_jl.js","assets/View.glsl-B6vOoRsw.js","assets/Float3DrawUniform-UsZpj3mh.js","assets/AlphaCutoff-DTq90Si4.js","assets/HighlightReadBitmap.glsl-DB3CoKpG.js","assets/TerrainDepthTest.glsl-neHlKy5u.js","assets/OutputColorHighlightOID.glsl-MUXZi3dC.js","assets/Emissions.glsl-DaTtsIIp.js","assets/Texture2DDrawUniform-hiIQoiSn.js","assets/ImageMaterial.glsl-CfwPakwd.js","assets/ImageMaterial.glsl-C6_eihmD.js","assets/ObjectAndLayerIdColor.glsl-CrEuv_nr.js"])))=>i.map(i=>d[i]);
import{$h as e,$l as t,$v as n,Al as r,Am as i,Av as a,Ax as o,BC as s,Bg as c,Bh as l,Bx as u,CD as d,Cw as f,Df as p,Dh as m,Eh as h,Em as g,Ev as _,Fl as v,Gf as ee,Gh as te,Gy as ne,H_ as re,Hb as y,Hh as ie,Ih as ae,Il as oe,Iv as se,Jg as b,Jh as ce,Jl as x,Kb as S,Kf as le,MC as C,Mg as ue,Ml as de,Nh as fe,Nl as pe,OC as me,Of as he,Oh as ge,Ol as w,PC as _e,Pf as ve,Ph as ye,Pl as be,Qg as xe,RC as Se,Rh as Ce,SC as we,SS as Te,ST as Ee,St as De,TC as Oe,TT as ke,Tt as Ae,Ub as je,Ul as Me,Ux as Ne,Vb as Pe,Vh as Fe,Wb as T,Wf as Ie,Wg as Le,Wh as Re,Wl as E,Wy as D,Xg as O,Xl as ze,Yh as Be,ZC as Ve,Zf as He,Zh as Ue,_S as We,_T as k,_v as Ge,aS as Ke,ab as qe,ag as Je,au as Ye,bD as Xe,bt as Ze,bv as Qe,dT as $e,eu as et,fC as tt,fD as nt,fT as rt,fw as it,gx as at,id as ot,ih as st,ip as ct,iu as A,jh as lt,jl as ut,jv as dt,kC as j,k_ as ft,kg as pt,kh as mt,kv as ht,lT as gt,mT as M,nD as _t,ng as vt,np as N,nu as yt,ob as bt,od as xt,pS as St,pT as Ct,pg as wt,qb as Tt,ra as Et,rp as Dt,ru as P,sc as Ot,su as kt,th as At,tu as jt,vC as Mt,vD as Nt,vT as F,vd as Pt,vt as Ft,vv as It,vy as Lt,wC as Rt,wT as I,wh as zt,wv as Bt,xt as Vt,yd as Ht,yx as Ut,zb as Wt,zh as Gt,zl as Kt,zv as qt,zy as Jt}from"./index-BqmCqmfp.js";import"./memoryEstimations-O7VgDRVG.js";import"./SimpleGeometryCursor-CI9GIWKa.js";import"./Point2D-UYEfE6HP.js";import"./Envelope2D-BNwQDrOT.js";import"./UnitFactory-J9WMNXdY.js";import"./Transformation2D-DVoPQwGC.js";import"./OperatorDefinitions-DQQu7-BK.js";import"./jsonConverter-DiNOXEUJ.js";import"./apiConverter-DVPFZqjR.js";import"./Distance2DCalculator-CXhBP-8I-Xmr2hQVp.js";import"./distanceOperator-5uQbTYel.js";import"./operatorSimplify-BpM6lQIp.js";import"./simplifyOperator-CVaMEoed.js";import"./quatf64-CJzmL3cc.js";import{i as Yt}from"./quat-Bk_ZaVz9.js";import{c as Xt,s as Zt}from"./axisAngleDegrees-Di7q97jx.js";import"./MeshLocalVertexSpace-HjmVAuYa.js";import"./MeshTransform-B2p38eYR.js";import{a as Qt}from"./meshVertexSpaceUtils-Y8FeTLov.js";import"./earcut-Drx511Ix.js";import"./Indices-BsTLKVdx.js";import{a as $t,n as L,r as en,s as tn,t as R}from"./vectorStacks-CKtslZxP.js";import{a as nn,b as rn,d as an,m as on,y as sn}from"./plane-CTjDePZl.js";import"./triangulationUtils-BJbNyOeM.js";import"./deduplicate-BuZ0DaaO.js";import{n as cn}from"./projectPointToVector-Clou1sfo.js";import{n as ln}from"./computeTranslationToOriginAndRotation-BC3OuSky.js";import{D as un,N as dn}from"./BufferView-DNaZpbJX.js";import{a as fn}from"./Util-3rPi0NfK.js";import"./spatialReferenceEllipsoidUtils-DBtdxVkA.js";import"./types-BLimCzcc.js";import{n as pn}from"./dehydratedPoint-Dwb3orme.js";import{t as mn}from"./projectVectorToVector-D-Bbb8fP.js";import{C as hn,O as gn,T as _n,w as vn}from"./sphere-CicnK0Bn.js";import{i as yn}from"./orientedBoundingBox-DZQLHGx0.js";import{_ as bn,d as xn,f as Sn,h as Cn,i as wn}from"./Emissions.glsl-DaTtsIIp.js";import{n as Tn}from"./glsl-C2sn87h0.js";import"./Uniform-DXwqrKA1.js";import"./Float3DrawUniform-UsZpj3mh.js";import"./Float3PassUniform-Co8OqiAU.js";import{t as En}from"./FloatPassUniform-BEwJjV4q.js";import"./Texture2DDrawUniform-hiIQoiSn.js";import"./Texture2DPassUniform-Cd7cdF1a.js";import{t as Dn}from"./NoParameters-CpAItLvD.js";import{_ as On,b as kn,c as An,d as jn,f as Mn,g as Nn,l as Pn,m as Fn,n as In,o as Ln,u as Rn,v as zn}from"./elevationInfoUtils-Df_uYU_q.js";import{a as Bn,c as Vn,l as Hn,o as z,r as Un,s as Wn,u as Gn}from"./colorUtils-uG2qTogT.js";import"./cimSymbolUtils-1FVTTBxd.js";import"./gfxUtils-DZoKCRMw.js";import{s as Kn}from"./utils-5jlQHYup.js";import"./GraphicsLayer-BGvt7_Y1.js";import"./HUDIntersectorResult-CCf93UUm.js";import"./videoUtils-L_CLmnNC.js";import"./VertexAttributeLocations-IAhvKZqd.js";import"./VertexElementDescriptor-BGWnA0Rs.js";import{a as qn,i as Jn,r as Yn,t as Xn}from"./geodesicUtils-DJORTTMv.js";import"./createUtils-DwAaa929.js";import{t as Zn}from"./getDefaultUnitForView-CBP34vcm.js";import{t as Qn}from"./isSupportedObject-CNmfINgj.js";import{t as $n}from"./SketchOptions-CfisVcr8.js";import{s as er,t as tr,v as nr,y as rr}from"./LineSnappingHint-BAcwqgNT.js";import{n as ir}from"./ParallelSnappingHint-Knbe-U69.js";import"./snappingUtils-CbrwOS61.js";import"./constraints-DXu8cqG3.js";import"./IntersectionSnappingHint-C3U4Rx6H.js";import"./RightAngleSnappingHint--LJCiSno.js";import{t as ar}from"./viewUtils-CtJQ47Dj.js";import{f as or,i as sr,l as cr,n as lr,r as ur}from"./quantityUtils-Dywg00j-.js";import{i as dr,o as fr,s as pr}from"./euclideanLengthMeasurementUtils-Bhl6nD1D.js";import{a as mr,c as hr,d as gr,i as _r,o as vr,r as yr,u as br}from"./lineSegment-uFalXigL.js";import"./triangle-1kWe4-AP.js";import"./PointSnappingHint-0hXGrSRX.js";import{_ as xr,a as Sr,b as Cr,d as wr,f as Tr,g as Er,h as Dr,m as Or,n as kr,t as Ar,v as jr}from"./SnappingContext-BiPKdvZN.js";import{C as Mr,S as Nr,_ as Pr,b as Fr,c as Ir,d as Lr,f as Rr,g as zr,h as Br,i as Vr,l as Hr,m as Ur,n as Wr,o as Gr,p as Kr,r as qr,s as Jr,t as Yr,v as Xr,w as Zr,x as Qr,y as $r}from"./editPlaneUtils-DxRI6Xas.js";import{a as ei,b as ti,d as ni,i as ri,l as ii,o as ai,s as oi,u as si}from"./rotate-qEFO-Vf9.js";import"./dehydratedFeatureComparison-Ch8xWl-8.js";import"./angularMeasurementUtils-BFBiid4G.js";import"./unitFormatUtils-D4yCMgjI.js";import"./ReactiveSet-DIaWCgzH.js";import{a as ci,i as li,n as ui}from"./hydratedFeatures-BSV-K3yB.js";import{t as di}from"./GraphicManipulator-3bzgkt2P.js";import"./drapedUtils-p7eKCYi3.js";import{i as fi,n as pi,s as mi}from"./boundedPlane-Cn9n7acY.js";import"./VertexArrayObject-Dzn28byJ.js";import"./BufferObject-lp8QWmVQ.js";import{t as hi}from"./VertexBuffer-DL5rIQzc.js";import"./vec3f32-CZ7wi78s.js";import{t as gi}from"./ShaderBuilder-C3C7fUwK.js";import{a as _i,c as vi,n as yi,r as bi,u as xi}from"./renderState-Be6uDhGv.js";import"./requestImageUtils-Co3yn10g.js";import{f as Si,h as Ci,m as wi,p as Ti,r as Ei}from"./frustum-DNBPrNIX.js";import{B as Di,C as Oi,D as ki,E as Ai,F as ji,I as Mi,L as Ni,N as Pi,O as Fi,P as B,R as Ii,T as Li,V as Ri,c as zi,k as Bi,o as Vi,p as Hi,t as Ui,u as Wi,x as Gi,y as Ki,z as qi}from"./DefaultBufferWriter-BihhFqiH.js";import{_ as V,b as Ji,f as Yi,l as Xi,m as Zi,t as Qi,x as $i}from"./ElevationContext-Dr2dVDU-.js";import{r as ea}from"./MaterialUtil-DdudaLIK.js";import"./Octree-CJ8Y2SCh.js";import{a as ta,c as na,l as ra,m as ia,s as aa,u as oa}from"./SceneLighting-BWVxtKEm.js";import"./ScreenSpacePass.glsl-Br3vxYsG.js";import"./Float2BindUniform-BJ75NEvo.js";import"./ReadDepth.glsl-DvJ8t0GM.js";import{r as sa,t as ca}from"./Compositing.glsl-BYZe6B-5.js";import{a as la,s as ua}from"./FloatArray-cqhQU3FO.js";import{c as da,d as fa,f as pa,h as ma,n as ha,o as ga,p as _a,s as va,u as ya}from"./DefaultLayouts-CjgM05yM.js";import"./Laserline.glsl-BEu4tx-q.js";import"./Float4BindUniform-CtMVDjau.js";import"./CameraSpace.glsl-cnQVTSzq.js";import"./Texture2DBindUniform-CSngcuNV.js";import"./Float2PassUniform-D4VTGzqn.js";import"./Float3BindUniform-BrSuqm5i.js";import{t as ba}from"./Float4PassUniform-Bo_mhcMi.js";import"./FloatBindUniform-TDSkRzMc.js";import{n as xa,r as Sa}from"./Laserlines.glsl-Ba7d6LU6.js";import"./Matrix4BindUniform-BUS9JrUC.js";import"./Matrix4PassUniform-DbEU5DCd.js";import{t as Ca}from"./LaserlinePath.glsl-Cc_iomvO.js";import"./FloatsPassUniform-BT-ZsPj-.js";import"./TextureOnly.glsl-CYpLvtGi.js";import"./HighlightCellGridScreenSpacePass.glsl-BA5GfPLV.js";import"./IntegerPassUniform-zyEEceJY.js";import"./HighlightDownsample.glsl-3CRIy9lA.js";import"./HighlightReadBitmap.glsl-DB3CoKpG.js";import"./Float2DrawUniform-BXYGUyM9.js";import"./HighlightApply.glsl-zXn-nuwO.js";import"./HighlightBlur.glsl-u_RKwFOm.js";import"./HighlightToSingle.glsl-AKPfdrUQ.js";import"./NestedMap-D5qGZL0n.js";import{n as wa}from"./View.glsl-B6vOoRsw.js";import"./ObjectAndLayerIdColor.glsl-CrEuv_nr.js";import"./VisualVariables.glsl-xWfUXTFa.js";import{t as Ta}from"./AlphaCutoff-DTq90Si4.js";import"./ScreenSizePerspective.glsl-CRhKUJLC.js";import"./MarkerSizing.glsl-uoP35BjE.js";import"./RibbonLine.glsl-BtrXnCru.js";import{t as Ea}from"./Texture-BUgDxlWW.js";import{a as Da,i as Oa,n as ka,o as Aa}from"./sdfPrimitives-BFsFtiPt.js";import"./PiUtils.glsl-CZJ_KlHj.js";import"./TerrainDepthTest.glsl-neHlKy5u.js";import"./OutputColorHighlightOID.glsl-MUXZi3dC.js";import"./weather-DPdwn6Yn.js";import"./OverlayCompositing.glsl-DYGifVcT.js";import{D as ja,E as Ma,O as Na,S as Pa,c as Fa,d as Ia,h as La,l as Ra,p as za,v as Ba,x as Va,y as Ha}from"./graphicUtils-BCCvOGWP.js";import"./VerticalOffset.glsl-DYy5IZ2H.js";import"./HUDVisibility.glsl-BkjA-IFP.js";import"./BooleanBindUniform-8vtZmSI6.js";import"./HUDMaterial.glsl-CE_2EJp4.js";import"./Transform.glsl-YgD9m_jl.js";import"./VertexColor.glsl-CHR9Q-WR.js";import"./ColorMaterial.glsl-C_1k6PTy.js";import{t as Ua}from"./ShadedColorMaterial.glsl-CDWT6SD5.js";import{n as Wa,r as Ga,t as Ka}from"./SelectedVertexTooltipInfo-CuZHeWi5.js";import{t as qa}from"./TranslateTooltipInfo-Dg5jnkfm.js";import"./RenderCoordsHelper-3X105nA6.js";import{r as Ja}from"./ImageMaterial.glsl-C6_eihmD.js";import{n as Ya,r as Xa,t as Za}from"./ExtentScaleTooltipInfo-C3_coAyh.js";var Qa=e=>({vnodeSelector:``,properties:void 0,children:void 0,text:e.toString(),domNode:null}),$a=(e,t,n)=>{for(let r=0,i=t.length;r<i;r++){let i=t[r];Array.isArray(i)?$a(e,i,n):i!=null&&!1!==i&&(typeof i==`string`&&(i=Qa(i)),n.push(i))}};function eo(e,t,n){if(Array.isArray(t))n=t,t=void 0;else if(t&&(typeof t==`string`||t.hasOwnProperty(`vnodeSelector`))||n&&(typeof n==`string`||n.hasOwnProperty(`vnodeSelector`)))throw Error(`h called with invalid arguments`);let r,i;return n&&n.length===1&&typeof n[0]==`string`?r=n[0]:n&&(i=[],$a(e,n,i),i.length===0&&(i=void 0)),{vnodeSelector:e,properties:t,children:i,text:r===``?void 0:r,domNode:null}}var to={bottom:`esri-text-overlay-item-anchor-bottom`,"bottom-right":`esri-text-overlay-item-anchor-bottom-right`,"bottom-left":`esri-text-overlay-item-anchor-bottom-left`,top:`esri-text-overlay-item-anchor-top`,"top-right":`esri-text-overlay-item-anchor-top-right`,"top-left":`esri-text-overlay-item-anchor-top-left`,center:`esri-text-overlay-item-anchor-center`,right:`esri-text-overlay-item-anchor-right`,left:`esri-text-overlay-item-anchor-left`},H=class extends me{get position(){return[this.x,this.y]}set position(e){this._set(`x`,e[0]),this._set(`y`,e[1])}get _textShadowColor(){let{textColor:e,backgroundColor:t}=this,n=t.clone();return n.a*=e.a,n}get _textShadow(){let e=this._textShadowColor.toCss(!0);return`0 0 ${this._textShadowSize}px ${e}`}get padding(){return .5*this.fontSize}get borderRadius(){return this.padding}set borderRadius(e){this._overrideIfSome(`borderRadius`,e)}constructor(e){super(e),this.x=0,this.y=0,this.text=`-`,this.fontSize=14,this.anchor=`center`,this.visible=!0,this.isDecoration=!0,this.backgroundColor=new D([0,0,0,.6]),this.textColor=new D([255,255,255]),this._textShadowSize=1}render(){return eo(`div`,{classes:this._cssClasses(),styles:{left:Math.floor(this.x)+`px`,top:Math.floor(this.y)+`px`,visibility:this.visible?`visible`:`hidden`,fontSize:this.fontSize+`px`,lineHeight:this.fontSize+`px`,backgroundColor:this.backgroundColor.toCss(!0),color:this.textColor.toCss(!0),padding:this.padding+`px`,borderRadius:this.borderRadius+`px`,textShadow:this._textShadow}},[this.text])}renderCanvas(e){if(!this.visible)return;let t=e.font.replace(/^(.*?)px/,``);e.font=`${this.fontSize}px ${t}`;let{padding:n,borderRadius:r}=this,i=e.measureText(this.text).width,a=this.text===``?0:this.fontSize,o=no[this.anchor];e.textAlign=`center`,e.textBaseline=`middle`;let s=i+2*n,c=a+2*n,l=this.x+o.x*s,u=this.y+o.y*c;this._roundedRect(e,l,u,s,c,r),e.fillStyle=this.backgroundColor.toCss(!0),e.fill();let d=this.x+(o.x+.5)*s,f=this.y+(o.y+.5)*c;this._renderTextShadow(e,this.text,d,f),e.fillStyle=this.textColor.toCss(!0),e.fillText(this.text,d,f)}_renderTextShadow(e,t,n,r){e.lineJoin=`miter`,e.fillStyle=`rgba(${this._textShadowColor.r}, ${this._textShadowColor.g}, ${this._textShadowColor.b}, ${1/ro.length})`;let i=this._textShadowSize;for(let[a,o]of ro)e.fillText(t,n+i*a,r+i*o)}_roundedRect(e,t,n,r,i,a){a=Math.min(a,i/2,r/2),e.beginPath(),e.moveTo(t,n+a),e.arcTo(t,n,t+a,n,a),e.lineTo(t+r-a,n),e.arcTo(t+r,n,t+r,n+a,a),e.lineTo(t+r,n+i-a),e.arcTo(t+r,n+i,t+r-a,n+i,a),e.lineTo(t+a,n+i),e.arcTo(t,n+i,t,n+i-a,a),e.closePath()}_cssClasses(){let e={"esri-text-overlay-item":!0},t;for(t in to)e[to[t]]=this.anchor===t;return e}};d([C()],H.prototype,`x`,void 0),d([C()],H.prototype,`y`,void 0),d([C()],H.prototype,`position`,null),d([C()],H.prototype,`text`,void 0),d([C()],H.prototype,`fontSize`,void 0),d([C()],H.prototype,`anchor`,void 0),d([C()],H.prototype,`visible`,void 0),d([C()],H.prototype,`isDecoration`,void 0),d([C()],H.prototype,`backgroundColor`,void 0),d([C()],H.prototype,`textColor`,void 0),d([C()],H.prototype,`_textShadowSize`,void 0),d([C()],H.prototype,`_textShadowColor`,null),d([C()],H.prototype,`_textShadow`,null),d([C()],H.prototype,`padding`,null),d([C()],H.prototype,`borderRadius`,null),H=d([j(`esri.views.overlay.TextOverlayItem`)],H);var no={bottom:{x:-.5,y:-1,textAlign:`center`,textBaseline:`bottom`},"bottom-left":{x:0,y:-1,textAlign:`left`,textBaseline:`bottom`},"bottom-right":{x:-1,y:-1,textAlign:`right`,textBaseline:`bottom`},center:{x:-.5,y:-.5,textAlign:`center`,textBaseline:`middle`},left:{x:0,y:-.5,textAlign:`left`,textBaseline:`middle`},right:{x:-1,y:-.5,textAlign:`right`,textBaseline:`middle`},top:{x:-.5,y:0,textAlign:`center`,textBaseline:`top`},"top-left":{x:0,y:0,textAlign:`left`,textBaseline:`top`},"top-right":{x:-1,y:0,textAlign:`right`,textBaseline:`top`}},ro=[];for(let e=0;e<360;e+=360/16)ro.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);var io=3025,ao={default:15,far:25},oo=class extends me{constructor(e){super(e),this.context=null,this.stagedVertex=null,this.visible=!0,this.edgeDistance=`default`,this._messageUnitsTask=null,this._labelInfos=[],this._nextLabelIndex=0}initialize(){this.addHandles([S(()=>[this.context!=null&&this.getCameraOrExtent(this.context),this.visible,this._edgeDistancePixels,this.stagedVertex,this._messagesUnits],()=>this._update()),...[`vertex-add`,`vertex-update`,`vertex-remove`].map(e=>y(()=>this.context?.editGeometryOperations,e,()=>this._update())),S(()=>this._colors,e=>this._updateStyle(e)),Ut(()=>this._refreshMessages()),F(()=>this._messageUnitsTask?.abort())]),this._refreshMessages()}destroy(){for(this._nextLabelIndex=0;this._labelInfos.length;)this._destroyLabel(this._labelInfos.pop())}get updating(){return this._messagesUnits==null}get test(){}get _messagesUnits(){return this._messageUnitsTask?.value}get _edgeDistancePixels(){return ao[this.edgeDistance]}get _colors(){let e=this.context?.view.effectiveTheme.textColor??D.fromArray([255,255,255]);return{textColor:e,backgroundColor:Un(Wn(e,160),.6)}}_update(){if(this.destroyed)return;this._nextLabelIndex=0;let{context:e,stagedVertex:t}=this;if(!e)return this._destroyUnusedLabels();let{editGeometryOperations:n}=e,{parts:r,geometry:i,coordinateHelper:a}=n.data;if(!i)return this._destroyUnusedLabels();let o=r.length;for(let r=0;r<o;++r){let s=so(i,n,t,a,r);if(s.length<2||!co(s,e.view,e.elevationInfo,a.spatialReference))continue;let c=o===1&&!Lt(s),l=po,u=mo;this.toScreenPointArray(e,s[0],l);for(let t=1;t<s.length;++t){let n=s[t-1],r=s[t];this.toScreenPointArray(e,r,u),this._addLabel(e,n,l,r,u,c),[l,u]=[u,l]}}this._destroyUnusedLabels()}_updateStyle({textColor:e,backgroundColor:t}){let n=this._nextLabelIndex,r=this._labelInfos;for(let i=0;i<n;++i){let{label:n}=r[i];n.textColor=e,n.backgroundColor=t}}_addLabel(e,t,n,r,i,o){let{label:s}=this._getOrCreateLabel(e);if(!this.visible||It(n,i)<io)return void(s.visible=!1);let{spatialReference:c}=e.editGeometryOperations.data,l=e.automaticLengthMeasurementUtils.autoDistance2D(t,r,c),u=this._messagesUnits,d=Zn(e.view);s.text=u!=null&&l!=null?ti(u,l,d):``,s.visible=!0;let f=i[0]-n[0],p=i[1]-n[1];o?_(uo,-p,f):_(uo,p,-f),dt(uo,uo),Bt(uo,uo,this._edgeDistancePixels),Ge(fo,n,i,.5),a(fo,fo,uo),s.position=[fo[0],fo[1]],Math.abs(uo[0])>Math.abs(uo[1])?s.anchor=uo[0]>0?`left`:`right`:s.anchor=-uo[1]<0?`top`:`bottom`}_getOrCreateLabel(e){let t=this._labelInfos.length>this._nextLabelIndex,{textColor:n,backgroundColor:r}=this._colors;if(t){let e=this._labelInfos[this._nextLabelIndex++],{label:t}=e;return t.textColor=n,t.backgroundColor=r,e}let i=new H({anchor:`center`,fontSize:8,textColor:n,backgroundColor:r});e.view.overlay?.items.add(i);let a={label:i};return this._labelInfos.push(a),this._nextLabelIndex=this._labelInfos.length,a}_destroyUnusedLabels(){for(;this._labelInfos.length>this._nextLabelIndex;)this._destroyLabel(this._labelInfos.pop())}_destroyLabel({label:e}){this.context?.view.overlay?.items.remove(e),e.destroy()}_refreshMessages(){this._messageUnitsTask?.abort(),this._messageUnitsTask=tt(()=>at(`esri/core/t9n/Units`))}};function so(e,t,n,r,i){let a=[];for(let e of t.data.parts[i].iterateVertices())a.push(r.toXYZ(e.pos,R.get()));if(i===0&&n!=null&&a.push(r.toXYZ(n,R.get())),a.length<2)return a;let o=a[0],s=a[a.length-1];return e.type===`polygon`&&a.length>2&&!pe(o,s)&&a.push(o),a}function co(e,t,n,r){if(t.type===`2d`)return!0;let i=We(r)??1,a=St(r),o=e=>An(t,e,r,n,Ln)??0;for(let t=1;t<e.length;++t){let n=e[t-1],r=e[t],s=(r[0]-n[0])*i,c=(r[1]-n[1])*i,l=(o(r)-o(n))*a;if(Math.abs(l)/Math.sqrt(s*s+c*c)>lo)return!1}return!0}d([C()],oo.prototype,`context`,void 0),d([C()],oo.prototype,`stagedVertex`,void 0),d([C()],oo.prototype,`visible`,void 0),d([C()],oo.prototype,`edgeDistance`,void 0),d([C()],oo.prototype,`updating`,null),d([C()],oo.prototype,`_messageUnitsTask`,void 0),d([C()],oo.prototype,`_messagesUnits`,null),d([C()],oo.prototype,`_edgeDistancePixels`,null),d([C()],oo.prototype,`_colors`,null),oo=d([j(`esri.views.interactive.SegmentLabels`)],oo);var lo=bt(5),uo=ot(),fo=ot(),po=ce(),mo=ce(),ho=class extends oo{getCameraOrExtent({view:e}){return e.state.camera}toScreenPointArray({view:e,elevationInfo:t,editGeometryOperations:n},r,i=ce()){let{spatialReference:a}=n.data.coordinateHelper;return ar(r,a,t,e,go),e.state.camera.projectToScreen(go,i),i}};ho=d([j(`esri.views.3d.interactive.SegmentLabels3D`)],ho);var go=b(),_o=class{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1,this._renderGroup=2}destroy(){this._destroyResources()}get resources(){return this._resources?.external}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}get renderGroup(){return this._renderGroup}set renderGroup(e){this._renderGroup=e;let t=this._resources?.layerView;t&&(t.renderGroup=e)}recreate(){this.attached&&this._createResources()}recreateGeometry(){this._resourceFactory.recreateGeometry?this._resources!=null&&(this._ensureRenderGeometriesRemoved(),this._resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}forEachMaterial(e){this._resources&&this._resourceFactory.forEachMaterial(this._resources.external,e)}_createOrDestroyResources(){this._attached?this._resources??this._createResources():this._destroyResources()}_createResources(){this._destroyResources();let e=this._resourceFactory.createResources(),t=new vo({view:this._resourceFactory.view,renderGroup:this._renderGroup}),n=this._resourceFactory.view.overlayManager;this._resources={layerView:t,external:e,geometriesAdded:!1},n&&(this._resources.drapeSourceRenderer=n.registerGeometryDrapeSource(t)),this._syncGeometriesToRenderer()}_destroyResources(){if(this._resources==null)return;this._ensureRenderGeometriesRemoved();let e=this._resourceFactory.view.overlayManager;e&&e.unregisterDrapeSource(this._resources.layerView),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){this._resources?.drapeSourceRenderer!=null&&this._resources.geometriesAdded&&(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,1),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){this._resources?.drapeSourceRenderer!=null&&(this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,1),this._resources.geometriesAdded=!0))}},vo=class extends Wt(me){constructor(e){super(e),this.drapeSourceType=1,this.updatePolicy=1,this.renderGroup=2}};d([C({constructOnly:!0})],vo.prototype,`view`,void 0),d([C({readOnly:!0})],vo.prototype,`drapeSourceType`,void 0),d([C()],vo.prototype,`renderGroup`,void 0),vo=d([j(`esri.views.3d.interactive.visualElements.DrapedVisualElementResources`)],vo);var yo=class{get isDecoration(){return this._isDecoration}set isDecoration(e){this._isDecoration=e,this.forEachMaterial(t=>t?.setParameters({isDecoration:e}))}constructor(e){this._isDecoration=!1,this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=e.view,this._handle=S(()=>e.view.ready,e=>{this._resourcesCreated&&(e?this._createResources():this._destroyResources())})}applyProperties(e){let t=!1;for(let n in e)n in this&&(n===`attached`?t=!!e[n]:this[n]=e[n]);this.attached=t}destroy(){this.attached=!1,this._handle.remove()}get attached(){return this._attached}set attached(e){e!==this._attached&&this.view.stage&&(this._attached=e,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources(),this.onAttachedChange(e))}onAttachedChange(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.attached&&this.updateVisibility(e))}_createResources(){this.createResources(),this._resourcesCreated=!0,this.updateVisibility(this.visible)}_destroyResources(){this.destroyResources(),this._resourcesCreated=!1}},bo=class{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return this._resources==null?null:this._resources.object}get resources(){return this._resources==null?null:this._resources.external}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this._resourceFactory.recreateGeometry)return void this.recreate();let e=this._resourceFactory.view.stage;if(this._resources==null||!e)return;let t=this._resources.object;t.removeAllGeometries(),this._resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer)}forEachMaterial(e){this._resources&&this._resourceFactory.forEachMaterial(this._resources.external,e)}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();let e=this._resourceFactory,t=e.view,n=t.stage;if(!n)return;let r=new Ji(n,{pickable:!1,updatePolicy:1}),i=new $i({castShadow:!1}),a=e.createResources(i,r);r.add(i);let o=e.cameraChanged,s=o?S(()=>t.state.camera,e=>o(e),T):null;this._resources={layer:r,object:i,external:a,cameraHandle:s},this._syncVisible()}_destroyResources(){this._resources!=null&&(this._resources.layer.destroy(),this._resources.object.dispose(),this._resources.cameraHandle?.remove(),this._resourceFactory.destroyResources(this._resources.external),this._resources=null)}_syncVisible(){this._resources!=null&&(this._resources.object.visible=this._visible)}},xo=class extends yo{constructor(e){super(e),this._isDraped=!1,this.object3dResources=new bo(this.createObject3DResourceFactory(e.view)),this.drapedResources=new _o(this.createDrapedResourceFactory(e.view)),this.isDraped=e.isDraped??!1}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this.object3dResources.attached=this.attached&&!e,this.drapedResources.attached=this.attached&&e)}get renderGroup(){return this.drapedResources.renderGroup}set renderGroup(e){this.drapedResources.renderGroup=e}createResources(){this.object3dResources.attached=!this._isDraped,this.drapedResources.attached=this._isDraped}destroyResources(){this.object3dResources.attached=!1,this.drapedResources.attached=!1}recreate(){this.object3dResources.recreate(),this.drapedResources.recreate()}recreateGeometry(){this.object3dResources.recreateGeometry(),this.drapedResources.recreateGeometry()}destroy(){this.object3dResources.destroy(),this.drapedResources.destroy(),super.destroy()}updateVisibility(e){this.object3dResources.visible=e,this.drapedResources.visible=e}forEachMaterial(e){this.object3dResources?.forEachMaterial(e),this.drapedResources?.forEachMaterial(e)}},So=class extends aa{constructor(e,t){super(e,t,new na(ca,()=>f(()=>import(`./Compositing.glsl-BmTH8Q5-.js`),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))),ta)}initializePipeline(e){let{blitMode:t,blitEmissiveMode:n}=e,r=n?1:0;switch(t){case 0:case 3:return yi({colorWrite:_i,drawBuffers:Ni(0,r)});case 1:return yi({blending:xi,colorWrite:_i,drawBuffers:Ni(0,r)});default:return yi({blending:vi,colorWrite:_i,drawBuffers:Ni(0,r)})}}},Co=class extends Pi{constructor(){super(...arguments),this.blitMode=0,this.blitEmissiveMode=0,this.hasOpacityFactor=!1}};d([B({count:4})],Co.prototype,`blitMode`,void 0),d([B({count:4})],Co.prototype,`blitEmissiveMode`,void 0),d([B()],Co.prototype,`hasOpacityFactor`,void 0);var wo=class{constructor(e,t=0){this._techniques=e,this._parameters=new sa,this._configuration=new Co,this._configuration.blitMode=t,e.precompile(So,this._configuration),this._configuration.hasOpacityFactor=!0,e.precompile(So,this._configuration),this._configuration.hasOpacityFactor=!1}blit(e,t,n,r){this.blitTexture(e,t.getTexture(),n,r)}blitTexture(e,t,n,r){e.bindFramebuffer(n.fbo),e.setClearColor(0,0,0,1),e.clear(16384),this._parameters.texture=t;let i=this._techniques.get(So,this._configuration);e.bindTechnique(i,r,this._parameters),e.screen.draw()}blend(e,t,n,r,i=1){this._configuration.hasOpacityFactor=i<1;let a=this._techniques.get(So,this._configuration);return!!a.compiled&&(e.bindFramebuffer(n.fbo),this._parameters.texture=t.getTexture(),this._parameters.opacity=i,e.bindTechnique(a,r,this._parameters),e.screen.draw(),!0)}},To=class{constructor(e){this._renderCoordsHelper=e,this._origin=b(),this._dirty=!1,this._count=0}set vertices(e){let t=He(3*e.length),n=0;for(let r of e)t[n++]=r[0],t[n++]=r[1],t[n++]=r[2];this.buffers=[t]}set buffers(e){if(this._buffers=e,this._buffers.length>0){let e=this._buffers[0],n=3*Math.floor(e.length/3/2);t(this._origin,e[n],e[n+1],e[n+2])}else t(this._origin,0,0,0);this._dirty=!0}get origin(){return this._origin}draw(e){let t=this._ensureVAO(e);t!=null&&(e.bindVAO(t),e.drawArrays(Ot.TRIANGLES,0,this._count))}dispose(){this._vao!=null&&this._vao.dispose()}get _layout(){return this._renderCoordsHelper.viewingMode===1?ko:Ao}_ensureVAO(e){return this._buffers==null?null:(this._vao??=this._createVAO(e,this._buffers),this._ensureVertexData(this._vao,this._buffers),this._vao)}_createVAO(e,t){let n=this._createDataBuffer(t);return this._dirty=!1,new ma(e,new hi(e,ua(this._layout),n))}_ensureVertexData(e,t){if(!this._dirty)return;let n=this._createDataBuffer(t);e.buffer()?.setData(n),this._dirty=!1}_createDataBuffer(e){let n=e.reduce((e,t)=>e+Eo(t),0);this._count=n;let r=this._layout.createBuffer(n),i=this._origin,a=0,o=0,s=`startUp`in r?this._setUpVectors.bind(this,r):void 0;for(let n of e){for(let e=0;e<n.length;e+=3){let c=t(Oo,n[e],n[e+1],n[e+2]);e===0?o=this._renderCoordsHelper.getAltitude(c):this._renderCoordsHelper.setAltitude(c,o);let l=a+2*e;s?.(e,l,n,c);let u=E(Oo,c,i);if(e<n.length-3){for(let e=0;e<6;e++)r.start.setVec(l+e,u);r.extrude.setValues(l,0,-1),r.extrude.setValues(l+1,1,-1),r.extrude.setValues(l+2,1,1),r.extrude.setValues(l+3,0,-1),r.extrude.setValues(l+4,1,1),r.extrude.setValues(l+5,0,1)}if(e>0)for(let e=-6;e<0;e++)r.end.setVec(l+e,u)}a+=Eo(n)}return r.buffer}_setUpVectors(e,t,n,r,i){let a=this._renderCoordsHelper.worldUpAtPosition(i,Do);if(t<r.length-3)for(let t=0;t<6;t++)e.startUp.setVec(n+t,a);if(t>0)for(let t=-6;t<0;t++)e.endUp.setVec(n+t,a)}};function Eo(e){return 3*(2*(e.length/3-1))}var Do=b(),Oo=b(),ko=la().vec3f(`start`).vec3f(`end`).vec2f(`extrude`).vec3f(`startUp`).vec3f(`endUp`),Ao=la().vec3f(`start`).vec3f(`end`).vec2f(`extrude`),jo=class extends Dn{constructor(){super(...arguments),this.innerColor=O(1,1,1),this.innerWidth=1,this.glowColor=O(1,.5,0),this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=.75,this.globalAlphaContrastBoost=2,this.angleCutoff=bt(6),this.pointDistanceOrigin=b(),this.pointDistanceTarget=b(),this.lineVerticalPlaneSegment=gr(),this.intersectsLineSegment=gr(),this.intersectsLineRadius=3,this.heightManifoldTarget=b(),this.lineStartWorld=b(),this.lineEndWorld=b()}},Mo=class extends aa{constructor(e,t){super(e,t,new na(xa,()=>f(()=>import(`./Laserlines.glsl-hkL80ocp.js`),__vite__mapDeps([13,14,5,6,15,16,17,18,19,20,4,7,8,3,21,22,23,9,24,10,2,25,26,27,28,12]))),ta)}},No=class extends jo{constructor(){super(...arguments),this.origin=b()}},Po=class extends aa{constructor(e,t){super(e,t,new na(Ca,()=>f(()=>import(`./LaserlinePath.glsl-D5pAU-bj.js`),__vite__mapDeps([29,30,5,6,20,4,7,8,3,21,22,23,9,24,10,28,31,32,12]))),Fo)}},Fo=new Map([[`start`,0],[`end`,1],[`extrude`,2],[`startUp`,3],[`endUp`,4]]),Io=class extends Pi{constructor(){super(...arguments),this.contrastControlEnabled=!1,this.spherical=!1}};d([B()],Io.prototype,`contrastControlEnabled`,void 0),d([B()],Io.prototype,`spherical`,void 0);var Lo=class extends Io{constructor(){super(...arguments),this.heightManifoldEnabled=!1,this.pointDistanceEnabled=!1,this.lineVerticalPlaneEnabled=!1,this.intersectsLineEnabled=!1}};d([B()],Lo.prototype,`heightManifoldEnabled`,void 0),d([B()],Lo.prototype,`pointDistanceEnabled`,void 0),d([B()],Lo.prototype,`lineVerticalPlaneEnabled`,void 0),d([B()],Lo.prototype,`intersectsLineEnabled`,void 0);var Ro=class extends ra{constructor(e){super(e),this.isDecoration=!0,this.produces=oa.LASERLINES,this.consumes={required:[oa.LASERLINES,`normals`]},this.requireGeometryDepth=!0,this._configuration=new Lo,this._pathTechniqueConfiguration=new Io,this._heightManifoldEnabled=!1,this._pointDistanceEnabled=!1,this._lineVerticalPlaneEnabled=!1,this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._pathVerticalPlaneEnabled=!1,this._passParameters=new No;let t=e.view.stage.renderView.techniques,n=new Io;n.contrastControlEnabled=e.contrastControlEnabled,t.precompile(Po,n)}initialize(){this._passParameters.renderCoordsHelper=this.view.renderCoordsHelper,this._pathTechniqueConfiguration.spherical=this.view.state.viewingMode===1,this._pathTechniqueConfiguration.contrastControlEnabled=this.contrastControlEnabled,this._techniques.precompile(Po,this._pathTechniqueConfiguration),this._blit=new wo(this._techniques,2)}destroy(){this._pathVerticalPlaneData=rt(this._pathVerticalPlaneData),this._blit=null}get _techniques(){return this.view.stage.renderView.techniques}get heightManifoldEnabled(){return this._heightManifoldEnabled}set heightManifoldEnabled(e){this._heightManifoldEnabled!==e&&(this._heightManifoldEnabled=e,this.requestRender(1))}get heightManifoldTarget(){return this._passParameters.heightManifoldTarget}set heightManifoldTarget(e){P(this._passParameters.heightManifoldTarget,e),this.requestRender(1)}get pointDistanceEnabled(){return this._pointDistanceEnabled}set pointDistanceEnabled(e){e!==this._pointDistanceEnabled&&(this._pointDistanceEnabled=e,this.requestRender(1))}get pointDistanceTarget(){return this._passParameters.pointDistanceTarget}set pointDistanceTarget(e){P(this._passParameters.pointDistanceTarget,e),this.requestRender(1)}get pointDistanceOrigin(){return this._passParameters.pointDistanceOrigin}set pointDistanceOrigin(e){P(this._passParameters.pointDistanceOrigin,e),this.requestRender(1)}get lineVerticalPlaneEnabled(){return this._lineVerticalPlaneEnabled}set lineVerticalPlaneEnabled(e){e!==this._lineVerticalPlaneEnabled&&(this._lineVerticalPlaneEnabled=e,this.requestRender(1))}get lineVerticalPlaneSegment(){return this._passParameters.lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){br(e,this._passParameters.lineVerticalPlaneSegment),this.requestRender(1)}get intersectsLineEnabled(){return this._intersectsLineEnabled}set intersectsLineEnabled(e){e!==this._intersectsLineEnabled&&(this._intersectsLineEnabled=e,this.requestRender(1))}get intersectsLineSegment(){return this._passParameters.intersectsLineSegment}set intersectsLineSegment(e){br(e,this._passParameters.intersectsLineSegment),this.requestRender(1)}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){e!==this._intersectsLineInfinite&&(this._intersectsLineInfinite=e,this.requestRender(1))}get pathVerticalPlaneEnabled(){return this._pathVerticalPlaneEnabled}set pathVerticalPlaneEnabled(e){e!==this._pathVerticalPlaneEnabled&&(this._pathVerticalPlaneEnabled=e,this._pathVerticalPlaneData!=null&&this.requestRender(1))}set pathVerticalPlaneVertices(e){this._pathVerticalPlaneData??=new To(this._passParameters.renderCoordsHelper),this._pathVerticalPlaneData.vertices=e,this.pathVerticalPlaneEnabled&&this.requestRender(1)}set pathVerticalPlaneBuffers(e){this._pathVerticalPlaneData??=new To(this._passParameters.renderCoordsHelper),this._pathVerticalPlaneData.buffers=e,this.pathVerticalPlaneEnabled&&this.requestRender(1)}setParameters(e){ea(this._passParameters,e)&&this.requestRender(1)}precompile(){this._acquireTechnique()}render(e){let t=e.find(({name:e})=>e===this.produces);if(this.isDecoration&&!this.bindParameters.decorations||this._blit==null)return t;let n=this.renderingContext,r=e.find(({name:e})=>e===`normals`);this._passParameters.normals=r?.getTexture();let i=()=>{(this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled)&&this._renderUnified(),this.pathVerticalPlaneEnabled&&this._renderPath()};if(!this.contrastControlEnabled)return n.bindFramebuffer(t.fbo),i(),t;this._passParameters.colors=t.getTexture();let a=this.fboCache.acquire(t.fbo.width,t.fbo.height,`laser lines`);return n.bindFramebuffer(a.fbo),n.setClearColor(0,0,0,0),n.clear(16640),i(),n.unbindTexture(t.getTexture()),this._blit.blend(n,a,t,this.bindParameters)||this.requestRender(1),a.release(),t}_acquireTechnique(){return this._configuration.heightManifoldEnabled=this.heightManifoldEnabled,this._configuration.lineVerticalPlaneEnabled=this.lineVerticalPlaneEnabled,this._configuration.pointDistanceEnabled=this.pointDistanceEnabled,this._configuration.intersectsLineEnabled=this.intersectsLineEnabled,this._configuration.contrastControlEnabled=this.contrastControlEnabled,this._configuration.spherical=this.view.state.viewingMode===1,this._techniques.get(Mo,this._configuration)}_renderUnified(){if(!this._updatePassParameters())return;let e=this._acquireTechnique();if(e.compiled){let t=this.renderingContext;t.bindTechnique(e,this.bindParameters,this._passParameters),t.screen.draw()}else this.requestRender(1)}_renderPath(){if(this._pathVerticalPlaneData==null)return;let e=this._techniques.get(Po,this._pathTechniqueConfiguration);if(e.compiled){let t=this.renderingContext;this._passParameters.origin=this._pathVerticalPlaneData.origin,t.bindTechnique(e,this.bindParameters,this._passParameters),this._pathVerticalPlaneData.draw(t)}else this.requestRender(1)}_updatePassParameters(){if(!this._intersectsLineEnabled)return!0;let e=this.bindParameters.camera,t=this._passParameters;if(this._intersectsLineInfinite){if(Ci(_n(t.intersectsLineSegment.origin,t.intersectsLineSegment.vector),zo),zo.c0=-Number.MAX_VALUE,!Ei(e.frustum,zo))return!1;wi(zo,t.lineStartWorld),Ti(zo,t.lineEndWorld)}else P(t.lineStartWorld,t.intersectsLineSegment.origin),A(t.lineEndWorld,t.intersectsLineSegment.origin,t.intersectsLineSegment.vector);return!0}get test(){}};d([C({constructOnly:!0})],Ro.prototype,`contrastControlEnabled`,void 0),d([C()],Ro.prototype,`isDecoration`,void 0),d([C()],Ro.prototype,`produces`,void 0),d([C()],Ro.prototype,`consumes`,void 0),Ro=d([j(`esri.views.3d.webgl-engine.effects.laserlines.LaserLineRenderer`)],Ro);var zo=Si(),Bo=class extends yo{constructor(e){super(e),this._angleCutoff=Sa,this._style={},this._heightManifoldTarget=b(),this._heightManifoldEnabled=!1,this._intersectsLine=gr(),this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._lineVerticalPlaneSegment=null,this._pathVerticalPlaneBuffers=null,this._pointDistanceLine=null,this.applyProperties(e)}get testData(){}createResources(){this._ensureRenderer()}destroyResources(){this._disposeRenderer()}updateVisibility(){this._syncRenderer(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance()}get angleCutoff(){return this._angleCutoff}set angleCutoff(e){this._angleCutoff!==e&&(this._angleCutoff=e,this._syncAngleCutoff())}get style(){return this._style}set style(e){this._style=e,this._syncStyle()}get heightManifoldTarget(){return this._heightManifoldEnabled?this._heightManifoldTarget:null}set heightManifoldTarget(e){e==null?this._heightManifoldEnabled=!1:(P(this._heightManifoldTarget,e),this._heightManifoldEnabled=!0),this._syncRenderer(),this._syncHeightManifold()}set intersectsWorldUpAtLocation(e){if(e==null)return void(this.intersectsLine=null);let t=this.view.renderCoordsHelper.worldUpAtPosition(e,Vo);this.intersectsLine=vr(e,t),this.intersectsLineInfinite=!0}get intersectsLine(){return this._intersectsLineEnabled?this._intersectsLine:null}set intersectsLine(e){e==null?this._intersectsLineEnabled=!1:(br(e,this._intersectsLine),this._intersectsLineEnabled=!0),this._syncIntersectsLine(),this._syncRenderer()}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){this._intersectsLineInfinite=e,this._syncIntersectsLineInfinite()}get lineVerticalPlaneSegment(){return this._lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){this._lineVerticalPlaneSegment=e==null?null:br(e),this._syncLineVerticalPlane(),this._syncRenderer()}get pathVerticalPlane(){return this._pathVerticalPlaneBuffers}set pathVerticalPlane(e){this._pathVerticalPlaneBuffers=e,this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncRenderer()}get pointDistanceLine(){return this._pointDistanceLine}set pointDistanceLine(e){this._pointDistanceLine=e==null?null:{origin:xe(e.origin),target:e.target?xe(e.target):null},this._syncPointDistance(),this._syncRenderer()}get isDecoration(){return this._isDecoration}set isDecoration(e){this._isDecoration=e,this._renderer&&(this._renderer.isDecoration=e)}_syncRenderer(){this.attached&&this.visible&&(this._intersectsLineEnabled||this._heightManifoldEnabled||this._pointDistanceLine!=null||this._pathVerticalPlaneBuffers!=null)?this._ensureRenderer():this._disposeRenderer()}_ensureRenderer(){this._renderer??(this._renderer=new Ro({view:this.view,contrastControlEnabled:!0,isDecoration:this.isDecoration}),this._syncStyle(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncIntersectsLineInfinite(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncAngleCutoff())}_syncStyle(){this._renderer!=null&&this._renderer.setParameters(this._style)}_syncAngleCutoff(){this._renderer?.setParameters({angleCutoff:this._angleCutoff})}_syncHeightManifold(){this._renderer!=null&&(this._renderer.heightManifoldEnabled=this._heightManifoldEnabled&&this.visible,this._heightManifoldEnabled&&(this._renderer.heightManifoldTarget=this._heightManifoldTarget))}_syncIntersectsLine(){this._renderer!=null&&(this._renderer.intersectsLineEnabled=this._intersectsLineEnabled&&this.visible,this._intersectsLineEnabled&&(this._renderer.intersectsLineSegment=this._intersectsLine))}_syncIntersectsLineInfinite(){this._renderer!=null&&(this._renderer.intersectsLineInfinite=this._intersectsLineInfinite)}_syncPathVerticalPlane(){this._renderer!=null&&(this._renderer.pathVerticalPlaneEnabled=this._pathVerticalPlaneBuffers!=null&&this.visible,this._pathVerticalPlaneBuffers!=null&&(this._renderer.pathVerticalPlaneBuffers=this._pathVerticalPlaneBuffers))}_syncLineVerticalPlane(){this._renderer!=null&&(this._renderer.lineVerticalPlaneEnabled=this._lineVerticalPlaneSegment!=null&&this.visible,this._lineVerticalPlaneSegment!=null&&(this._renderer.lineVerticalPlaneSegment=this._lineVerticalPlaneSegment))}_syncPointDistance(){if(this._renderer==null)return;let e=this._pointDistanceLine,t=e!=null;this._renderer.pointDistanceEnabled=t&&e.target!=null&&this.visible,t&&(this._renderer.pointDistanceOrigin=e.origin,e.target!=null&&(this._renderer.pointDistanceTarget=e.target))}_disposeRenderer(){this._renderer!=null&&this.view.stage&&(this._renderer.destroy(),this._renderer=null)}forEachMaterial(){}},Vo=b(),Ho=class extends xo{constructor(e){super(e),this._ray=vn(),this._isWorldDown=!1,this._start=b(),this._end=O(1,0,0),this._width=1,this._color=Ft(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=Ft(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=0,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=4,this._fadedExtensions=Yo,this._laserline=new Bo({view:this.view,isDecoration:e.isDecoration}),this.applyProperties(e)}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:Uo,recreateGeometry:(e,t)=>this._recreateObject3DGeometry(e,t),cameraChanged:()=>this._updateGeometry(),forEachMaterial:(e,t)=>t(e.material)}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:Uo,recreateGeometry:e=>this._recreateDrapedGeometry(e),forEachMaterial:(e,t)=>t(e.material)}}updateVisibility(e){super.updateVisibility(e),this._laserline.visible=e}onAttachedChange(){this._laserline.attached=this._laserlineAttached}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,P(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),E(this._end,e,this._end),hn(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,ut(this._start,e)||(P(this._start,e),hn(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,ut(this._end,e)||(P(this._end,e),hn(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){De(e,this._color)||(Ae(this._color,e),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){De(e,this._innerColor)||(Ae(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){let t=e!=null!=(this._stipplePattern!=null);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){e!=null&&this._stippleOffColor!=null&&De(e,this._stippleOffColor)||(this._stippleOffColor=e==null?null:Ze(e),this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this.recreateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&this._laserlineStyle!=null&&this.attached&&!this.isDraped}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,e!=null&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===8?4:this._renderOccluded}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=e??Yo,this.recreateGeometry()}_updateMaterial(){let{materialParameters:e}=this;this.object3dResources.resources?.material.setParameters(e),this.drapedResources.resources?.material.setParameters(e)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration,writeDepth:this._writeDepthEnabled}}_createObject3DResources(e){let t=new V(this.materialParameters,this.view.state.isGlobal),n=[];return this._createObject3DGeometry(t,e,n),{material:t,geometries:n}}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,n){let r=this._createGeometry(e);n.push(r),t.addGeometry(r),this._updateVerticesObject3D(t)}_createDrapedResources(){let e=new V(this.materialParameters,this.view.state.isGlobal);return{material:e,geometries:[this._createDrapedGeometry(e)]}}_recreateDrapedGeometry(e){e.geometries=[this._createDrapedGeometry(e.material)]}_createDrapedGeometry(e){let t=this._createGeometry(e);return this._updateVerticesDraped(t),new pa(t)}_createGeometry(e){let t=this.extensionType===3,n=t?[b(),b(),b(),b()]:[b(),b()];return za(e,n,null,t?[1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]:null)}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{let e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){let t=this._lineSegment;this._updateVertexAttributesObject3D(e,t),this._laserline.intersectsLine=t}_updateVerticesDraped(e){this._updateVertexAttributesDraped(e,this._lineSegment)}get _lineSegment(){return this._extensionType===3?this._updateLineSegmentFinite(qo):this._updateLineSegmentInfinite(this._extensionType,qo)}_updateLineSegmentFinite(e){return _r(this._start,this._end,e)}_updateLineSegmentInfinite(e,t){let n=this.view.state.camera;switch(Ci(this._ray,Wo),e){case 0:Wo.c0=-Number.MAX_VALUE;break;case 1:case 2:{let e=this._ray.origin,t=this.view.elevationProvider.getElevation(e[0],e[1],e[2],this.view.renderCoordsHelper.spatialReference,`ground`)??0,n=this.view.renderCoordsHelper.getAltitude(e);this._isWorldDown&&n<t&&kt(Wo.ray.direction,Wo.ray.direction),this._extensionType===2&&t!=null&&(Wo.c1=Math.abs(n-t));break}}if(!Ei(n.frustum,Wo))return this._updateLineSegmentFinite(t);let r=wi(Wo,Go),i=Ti(Wo,Ko);return _r(r,i,t)}_updateVertexAttributesObject3D(e,t){let n=e.geometries[0].getMutableAttribute(`position`)?.data;if(!n)return;let r=0;for(let e of this._lineVertices(t))n[r++]=e[0],n[r++]=e[1],n[r++]=e[2];e.geometryVertexAttributeUpdated(e.geometries[0],`position`)}_updateVertexAttributesDraped(e,t){let n=e.getMutableAttribute(`position`)?.data;if(!n)return;let r=0;for(let e of this._lineVertices(t))n[r++]=e[0],n[r++]=e[1],n[r++]=-2;e.invalidateBoundingInfo()}*_lineVertices(e){this.extensionType===3?(yield hr(e,-this.fadedExtensions.start,Go),yield hr(e,0,Go),yield hr(e,1,Go),yield hr(e,1+this.fadedExtensions.end,Go)):(yield hr(e,0,Go),yield hr(e,1,Go))}};function Uo(e){e.geometries=[]}var Wo=Si(),Go=b(),Ko=b(),qo=gr(),Jo=1/3,Yo={start:Jo,end:Jo},Xo=class extends xo{constructor(e){super(e),this._location=b(),this._direction=O(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=Ft(1,0,1,1),this._renderOccluded=4,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:$o,recreateGeometry:(e,t)=>this._recreateObject3DGeometry(e,t),cameraChanged:()=>this._updateGeometry(),forEachMaterial:(e,t)=>t(e.material)}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:es,recreateGeometry:e=>this._recreateDrapedGeometry(e),forEachMaterial:(e,t)=>t(e.material)}}get location(){return this._location}set location(e){ut(this._location,e)||(P(this._location,e),this._updateGeometry())}get direction(){return this._direction}set direction(e){ut(this._direction,e)||(P(this._direction,e),this._updateGeometry())}setDirectionFromPoints(e,t){w(this._direction,E(this._direction,t,e)),this._updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this._updateGeometry())}get color(){return this._color}set color(e){De(e,this._color)||(Ae(this._color,e),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get isDecoration(){return this._isDecoration}set isDecoration(e){this._isDecoration=e,this._updateMaterial()}_createObject3DResources(e){let t=new V(this.materialParameters,this.view.state.isGlobal),n=[];return this._createObject3DGeometry(t,e,n),{material:t,geometries:n}}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,n){let[r,i]=Zo(e);t.addGeometry(r),t.addGeometry(i),n.push(r),n.push(i),this._updateVerticesObject3D(t)}_createDrapedResources(){let e=new V(this.materialParameters,this.view.state.isGlobal),t=S(()=>this.view.state.contentPixelRatio,()=>this.drapedResources.recreateGeometry());return{material:e,geometries:this._createDrapedGeometry(e),pixelRatioHandle:t}}_recreateDrapedGeometry(e){e.geometries=this._createDrapedGeometry(e.material)}_createDrapedGeometry(e){let t=Zo(e);return this._updateVerticesDraped(t),t.map(e=>new pa(e))}_updateMaterial(){let{materialParameters:e}=this;this.object3dResources.resources?.material.setParameters(e),this.drapedResources.resources?.material.setParameters(e)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{let e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){let t=this.view.state.camera;t.projectToScreen(this.location,ss),A(ts,this.location,this.direction),t.projectToScreen(ts,cs),dt(cs,Qe(cs,cs,ss)),this._updateVertexAttributesObject3D(t,e,0,ss,cs,1),this._updateVertexAttributesObject3D(t,e,1,ss,cs,-1)}_updateVertexAttributesObject3D(e,t,n,r,i,a){let o=t.geometries[n],s=o.getMutableAttribute(`position`)?.data;if(!s)return;let{start:c,end:l}=Qo(i,r,a,this.offset,this.width,this.length);e.unprojectFromScreen(te(c),ts),s[0]=ts[0],s[1]=ts[1],s[2]=ts[2],e.unprojectFromScreen(te(l),ts),s[3]=ts[0],s[4]=ts[1],s[5]=ts[2],t.geometryVertexAttributeUpdated(o,`position`)}_updateVerticesDraped(e){let{view:{overlayManager:t,state:{contentPixelRatio:n}}}=this,{location:r,width:i,length:a,offset:o}=this,s=ls;s.spatialReference=t.spatialReference,s.x=r[0],s.y=r[1];let c=this.view.overlayPixelSizeInMapUnits(s)*n,l=i*c,u=a*c,d=o*c;this._updateVertexAttributesDraped(e[0],l,u,d,-1),this._updateVertexAttributesDraped(e[1],l,u,d,1)}_updateVertexAttributesDraped(e,t,n,r,i){let a=e.getMutableAttribute(`position`)?.data;if(!a)return;let{location:o,direction:s}=this,{start:c,end:l}=Qo(s,o,i,r,t,n);a[0]=c[0],a[1]=c[1],a[2]=-2,a[3]=l[0],a[4]=l[1],a[5]=-2,e.invalidateBoundingInfo()}};function Zo(e){return[za(e,[b(),b()]),za(e,[b(),b()])]}function Qo(e,t,n,r,i,o){let s=Bt(ns,_(ns,e[1]*n,e[0]*-n),r+i/2),c=a(rs,a(rs,a(rs,t,Bt(rs,e,o/2)),s),s);return{start:c,end:a(os,c,Bt(os,e,-o))}}function $o(e){e.geometries.length=0}function es(e){e.pixelRatioHandle.remove(),e.geometries=[]}var ts=b(),ns=ot(),rs=ot(),os=ot(),ss=ce(),cs=ce(),ls=pn(0,0,void 0,null),us=class extends yo{constructor(e){super(e),this._resources=null,this._transform=N()}get object(){return this._resources==null?null:this._resources.object}get transform(){return this._transform}set transform(e){Ce(this._transform,e),this._resources!=null&&(this._resources.object.transformation=this._transform)}recreate(){this.attached&&this.createResources()}recreateGeometry(){if(this._resources==null)return;let e=this._resources.object;e.removeAllGeometries(),this.createGeometries(e),e.visible=this.visible}createResources(){this.destroyResources();let e=this.view.stage;if(!e)return;let t=new Ji(e,{pickable:!1,updatePolicy:1}),n=new $i({castShadow:!1});n.transformation=this._transform,this.createExternalResources(),this.createGeometries(n),t.add(n),n.visible=this.visible,this._resources={layer:t,object:n}}destroyResources(){let e=this.view.stage;this._resources!=null&&e&&(this._resources.layer.destroy(),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(e){this._resources!=null&&(this._resources.object.visible=e)}},ds=class extends us{constructor(e){super(e),this._material=null,this._texture=null,this._geometry=null,this._size=3,this._color=Ft(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive=`square`,this._outlineSize=1,this._outlineColor=Ft(1,1,1,1),this._elevationInfo=null,this.applyProperties(e)}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get size(){return this._size}set size(e){if(e!==this._size){let t=this._preferredTextureSize;this._size=e,t<this._preferredTextureSize?this.recreate():this._updateSizeAttribute()}}get color(){return this._color}set color(e){De(e,this._color)||(Ae(this._color,e),this._updateMaterial())}get pixelSnappingEnabled(){return this._pixelSnappingEnabled}set pixelSnappingEnabled(e){this._pixelSnappingEnabled!==e&&(this._pixelSnappingEnabled=e,this._updateMaterial())}get primitive(){return this._primitive}set primitive(e){this._primitive!==e&&(this._primitive=e,this.recreate())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){De(e,this._outlineColor)||(Ae(this._outlineColor,e),this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}_updateMaterial(){this._material?.setParameters(this._materialParameters)}_updateSizeAttribute(){let e=this.object;if(e==null)return;let t=e.geometries[0];if(t==null)return;let n=t.getMutableAttribute(`size`).data,r=this._geometrySize;n[0]=r,n[1]=r,e.geometryVertexAttributeUpdated(e.geometries[0],`size`)}get _materialParameters(){return{color:this._color,textureIsSignedDistanceField:!0,sampleSignedDistanceFieldTexelCenter:Da(this._primitive),distanceFieldBoundingBox:Aa,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:this._texture?.id,polygonOffset:!1,shaderPolygonOffset:0,drawAsLabel:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled,isDecoration:this.isDecoration}}get _geometrySize(){return this._size/Oa}createExternalResources(){this._texture=ka(this._primitive,this._preferredTextureSize),this._material=new Ra(this._materialParameters,this.view.state.viewingMode===1);let e=this.view.stage;this._texture.load(e.renderView.renderingContext),e.addTexture(this._texture)}destroyExternalResources(){this._texture&&=(this.view.stage.removeTexture(this._texture),this._texture.dispose(),null),this._material=null}createGeometries(e){let t=this._createRenderGeometry();t!=null&&e.addGeometry(t)}forEachMaterial(e){e(this._material)}get _preferredTextureSize(){return qe(2*this._geometrySize,16,128)}calculateMapBounds(e){let t=this.object?.geometries[0];if(!t)return!1;let n=t.attributes.get(`position`).data;return mn(n,this.view.renderCoordsHelper.spatialReference,fs,this.view.spatialReference),ee(e,fs),!0}_createRenderGeometry(){let{geometry:e,_material:n}=this;if(e==null||n==null)return null;let{renderCoordsHelper:r,elevationProvider:i}=this.view,a=Yi(e,i,Qi.fromElevationInfo(this.elevationInfo),r),o=t(R.get(),e.x,e.y,a),s=R.get();mn(o,e.spatialReference,s,r.spatialReference);let c=this._geometrySize;return La(n,{position:s,size:[c,c],centerOffsetAndDistance:[0,0,0,1]})}},fs=b(),ps=class extends xo{constructor(e){super(e),this._maxSize=0,this._position=b(),this._up=b(),this._right=b(),this._renderOccluded=4,this._color=Ft(1,0,0,1),this._outlineColor=Ft(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=16,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:()=>{},cameraChanged:()=>this._updateTransformObject3D(),forEachMaterial:(e,t)=>{t(e.outlineMaterial),t(e.quadMaterial)}}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:ms,forEachMaterial:(e,t)=>{t(e.outlineMaterial),t(e.quadMaterial)}}}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get isDecoration(){return this._isDecoration}set isDecoration(e){this._isDecoration=e,this._updateOutlineMaterial(),this._updateQuadMaterial()}get color(){return this._color}set color(e){Ae(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){Ae(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){let t=this._outlineSize===0!=(e===0);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry({previous:e,center:t,next:n}){this._maxSize=Math.min(et(t,e),et(t,n))/3,w(this._up,E(this._up,e,t)),w(this._right,E(this._right,n,t)),P(this._position,t),this.recreateGeometry()}_createObject3DResources(e){let t=new ya(this._quadMaterialParameters),n=this._outlineSize===0?void 0:new V(this._outlineMaterialParameters,this.view.state.isGlobal);return this._createObject3DGeometries(e,t,n),{quadMaterial:t,outlineMaterial:n}}_createObject3DGeometries(e,t,n){if(ut(this._up,Le)&&ut(this._right,Le))return;let r=this._createGeometries(t,n);for(let t of r)e.addGeometry(t);this._updateTransformObject3D(e)}_createDrapedResources(){let e=new ya(this._quadMaterialParameters),t=this._outlineSize===0?void 0:new V(this._outlineMaterialParameters,this.view.state.isGlobal),n=this._createGeometries(e,t).map(e=>new pa(e));return this._setTransformDraped(n),{quadMaterial:e,outlineMaterial:t,geometries:n,pixelRatioHandle:S(()=>this.view.state.contentPixelRatio,()=>this.drapedResources.recreateGeometry())}}_createGeometries(e,t){let{up:n,right:r,corner:i}=this._getVertices(),a=hs(n,r,i,e);return t?[a,za(t,[n,i,r])]:[a]}_getVertices(){let e=this._up,t=this._right,n=A(R.get(),e,t);return this.isDraped&&(e=P(R.get(),e),t=P(R.get(),t),e[2]=0,t[2]=0,n[2]=0),{up:e,right:t,corner:n}}_updateTransform(){this.isDraped?this.drapedResources.recreateGeometry():this._updateTransformObject3D()}_updateTransformObject3D(e=this.object3dResources.object){if(!e)return;let t=this.view.state.camera,n=this._size*t.computeScreenPixelSizeAt(this._position),r=Math.min(this._maxSize,n);Fe(gs,this._position),lt(gs,gs,[r,r,r]),e.transformation=gs}_setTransformDraped(e){if(e.length===0)return;let{view:{overlayManager:t,state:{contentPixelRatio:n}}}=this,{_position:r,_size:i}=this,a=P(R.get(),r);a[2]=-2;let o=_s;o.spatialReference=t.spatialReference,o.x=a[0],o.y=a[1];let s=i*(this.view.overlayPixelSizeInMapUnits(o)*n),c=Math.min(this._maxSize,s);Fe(gs,a),lt(gs,gs,[c,c,1]);for(let t of e)t.transformation=gs}get _quadMaterialParameters(){return{color:this._color,forceTransparentMode:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateQuadMaterial(){this.object3dResources.resources?.quadMaterial.setParameters(this._quadMaterialParameters),this.drapedResources.resources?.quadMaterial.setParameters(this._quadMaterialParameters)}get _outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded,isDecoration:this.isDecoration}}_updateOutlineMaterial(){this.object3dResources.resources?.outlineMaterial?.setParameters(this._outlineMaterialParameters),this.drapedResources.resources?.outlineMaterial?.setParameters(this._outlineMaterialParameters)}};function ms(e){e.pixelRatioHandle.remove(),e.geometries=[]}function hs(e,t,n,r){return new Bi(r,[[`position`,new yn([0,0,0,...t,...e,...n],[0,1,2,1,2,3],3,!0)]])}var gs=N(),_s=pn(0,0,void 0,null),vs=class extends Cr{sortUniqueHints(e){return e.sort((e,t)=>(t instanceof tr?t.length:0)-(e instanceof tr?e.length:0))}visualizeIntersectionPoint(e,t){let{spatialReference:n,view:r}=t,i=ys(t);return k(new ds({view:r,primitive:`circle`,geometry:rr(e.intersectionPoint,n),elevationInfo:e.isDraped?Fn:Ln,size:20,outlineSize:2,color:i.intersectionPointColor,outlineColor:i.intersectionPointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizePoint(e,t){let{view:n,spatialReference:r}=t,i=ys(t),a=bs(e.point,e.domain,t);return k(new ds({view:n,primitive:`circle`,geometry:rr(a,r),elevationInfo:xs(e),size:20,outlineSize:2,color:i.pointColor,outlineColor:i.pointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizeLine(e,t){let{view:n,spatialReference:r}=t,i=ys(t),a=bs(e.lineStart,e.domain,t),o=bs(e.lineEnd,e.domain,t);return k(Ss(e.type,a,o,r,xs(e),n,i,e.isDraped,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,t){let{view:n,spatialReference:r}=t,i=ys(t),{isDraped:a}=e,o=xs(e),s=bs(e.lineStart,e.domain,t),c=bs(e.lineEnd,e.domain,t),l=Cs(s,r,o,n,a),u=Cs(c,r,o,n,a),d=de(u,l,u,.5),f=new Xo({view:n,attached:!1,offset:ir.parallelLineHintOffset,length:ir.parallelLineHintLength,width:ir.parallelLineHintWidth,color:i.parallelSignColor,location:d,renderOccluded:a?4:16,isDraped:a,renderGroup:3,isDecoration:!0});return f.setDirectionFromPoints(l,d),f.attached=!0,k(f)}visualizeRightAngleQuad(e,t){let{view:n,spatialReference:r}=t,i=ys(t),a=xs(e),{isDraped:o}=e,s=bs(e.previousVertex,e.domain,t),c=bs(e.centerVertex,e.domain,t),l=bs(e.nextVertex,e.domain,t),u=Cs(s,r,a,n,o),d=Cs(c,r,a,n,o),f=Cs(l,r,a,n,o);return k(new ps({view:n,attached:!0,color:o?i.rightAngleColorDraped:i.rightAngleColor,renderOccluded:o?4:2,outlineRenderOccluded:o?4:16,outlineColor:i.rightAngleOutlineColor,outlineSize:ir.rightAngleHintOutlineSize,size:ir.rightAngleHintSize,isDraped:o,geometry:{previous:u,center:d,next:f},renderGroup:3,isDecoration:!0}))}};function ys(e){let{effectiveTheme:t}=e.view,n=D.toUnitRGBA(t.accentColor),r=[0,0,0,0];return{intersectionPointColor:r,intersectionPointOutlineColor:n,pointColor:r,pointOutlineColor:n,lineColor:n,lineOutlineColor:void 0,parallelSignColor:n,rightAngleColor:n,rightAngleColorDraped:D.toUnitRGBA(Un(t.accentColor,.5)),rightAngleOutlineColor:n}}function bs(e,t,{selfSnappingZ:n,view:r,spatialReference:i}){return 2&t&&nr(e)&&n!=null?er(e,n,r,i):e}function xs(e){return e.isDraped?Fn:Ln}function Ss(e,t,n,r,i,a,o,s=!1,c=!0,l=!0){let u=Cs(t,r,i,a,s),d=Cs(n,r,i,a,s),f=new Ho({view:a,extensionType:3,start:u,end:d,isDraped:s,color:o.lineColor,renderOccluded:s?4:16,renderGroup:3,isDecoration:!0});switch(e){case 0:f.width=ir.lineHintWidthTarget,f.fadedExtensions={start:0,end:ir.lineHintFadedExtensions};break;case 2:f.width=ir.lineHintWidthReference,f.fadedExtensions={start:0,end:0};break;case 1:f.width=ir.lineHintWidthReference,f.fadedExtensions={start:c?ir.lineHintFadedExtensions:0,end:l?ir.lineHintFadedExtensions:0}}return f.attached=!0,f}function Cs(e,t,n,r,i){let a=b();if(i){let n=r.overlayManager.spatialReference;mn(e,t,a,n)}else ar(e,t,n,r,a);return a}function ws(e){let t=e.graphic;return t?[S(()=>`visible`in e?e.visible:e.displaying,e=>{e&&t.notifyMeshTransformChanged({action:0})},{...Tt}),F(()=>t.notifyMeshTransformChanged({action:1}))]:[]}var Ts=.3;function Es(e,t){t&&Object.assign(e,t)}var Ds=class{constructor(e){this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=16,this.color=e.accent}},Os=class{constructor({colors:e,...t}){this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=e.accent,this.outlineColor=e.outline,this.renderOccluded=16,this.hoverOutlineColor=e.selectedOutline,Es(this,t)}applyColor(e){this._apply(this.color,e)}applyOutline(e){this._apply(this.outlineColor,e)}applyHoverOutline(e){this._apply(this.hoverOutlineColor,e)}_apply(e,t){t.setParameters({color:z(e),renderOccluded:this.renderOccluded})}},ks=class{constructor({colors:e,...t}){this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.renderOccluded=2,this.minSquaredEdgeLength=900,this.color=Un(e.accent,.5),this.hoverColor=e.accent,Es(this,t)}applyColor(e){this._apply(this.color,e)}applyHover(e){this._apply(this.hoverColor,e)}_apply(e,t){t.setParameters({color:z(e),renderOccluded:this.renderOccluded})}},As=class{constructor(e){this.vertex=new Os({colors:e,color:e.accent,outlineColor:e.outline}),this.edge=new Os({colors:e,color:Bn(Un(e.accent,2/3),.5),outlineColor:Un(e.outline,.5),size:8,collisionPadding:8}),this.selected=new Os({colors:e,color:e.selected,outlineColor:e.outline}),this.edgeOffset=new ks({colors:e})}},js=class{constructor({colors:e,...t}){this.width=1.5,this.stipplePattern=da(3.3),this.falloff=0,this.innerWidth=1.5,this.renderOccluded=4,this.color=e.selected,this.stippleOffColor=e.outline,this.innerColor=e.selected,Es(this,t)}apply(e){e.color=z(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=z(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=z(this.innerColor),e.renderOccluded=this.renderOccluded}},Ms=class{constructor({colors:e,...t}){this.size=4,this.outlineSize=1,this.shape=`square`,this.color=e.selected,this.outlineColor=e.outline,Es(this,t)}apply(e){e.color=z(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=z(this.outlineColor),e.primitive=this.shape}},Ns=class{constructor({colors:e,...t}){this.innerWidth=1,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=Ts,this.globalAlphaContrastBoost=1.5,this.radius=3,this.innerColor=e.selected,this.glowColor=e.accent,this.heightFillColor=e.accent,Es(this,t)}apply(e,t=1){let n={glowColor:D.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:D.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*t*this.glowColor.a,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};`style`in e?e.style=n:e.laserlineStyle=n}},Ps=class{constructor(e){this.outline=new js({colors:e,color:e.stippleOff,renderOccluded:8,stippleOffColor:e.stippleOn,innerWidth:0}),this.staged=new js({colors:e,color:e.stippleOn,renderOccluded:8,innerColor:e.stagedSolid,stippleOffColor:e.stippleOff}),this.shadowStyle=new Ns({colors:e,globalAlpha:Ts,glowColor:e.accent,glowFalloff:8,glowWidth:8,innerColor:e.selected,innerWidth:1})}},Fs=class{constructor(e){this.outline=new Ms({colors:e,color:e.selected,outlineColor:e.outline,outlineSize:1,shape:`circle`,size:4}),this.shadowStyle=new Ns({colors:e,globalAlpha:Ts,glowColor:e.accent,glowFalloff:1.5,glowWidth:6,innerColor:e.selected,innerWidth:1,radius:2})}},Is=class extends js{constructor({colors:e,...t}){super({colors:e}),this.extensionType=2,Es(this,t)}},Ls=class{constructor(e){this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,this.lineObjects=new Ps(e),this.pointObjects=new Fs(e),this.heightPlane=new Ns({colors:e,globalAlpha:Ts,glowColor:e.accent,glowFalloff:8,glowWidth:8,innerColor:e.selected,innerWidth:1}),this.heightBox=new Ns({colors:e,globalAlpha:Ts,glowColor:e.accent,glowFalloff:8,glowWidth:8,innerColor:e.selected,innerWidth:0,heightFillColor:e.accent}),this.zVerticalLine=new Is({colors:e,color:Un(e.accent,5*Ts/3),falloff:2,innerColor:Un(e.selected,0),renderOccluded:4,stipplePattern:null,width:5,extensionType:2})}},U=class extends me{constructor(e){super(e)}get colors(){let e=this.getTheme().accentColor,t=e.a;return{accent:e,contrast:Wn(e),selected:D.fromArray([255,255,255,t]),selectedOutline:D.fromArray([255,255,255,t]),staged:D.fromArray([12,207,255,t]),stagedSolid:D.fromArray([12,207,255,1]),outline:D.fromArray([0,0,0,.5*t]),stippleOn:D.fromArray([255,255,255,1]),stippleOff:D.fromArray([0,0,0,.5])}}get visualElements(){return new Ls(this.colors)}get manipulators(){return new As(this.colors)}get zManipulator(){return new Ds(this.colors)}};d([C()],U.prototype,`colors`,null),d([C()],U.prototype,`visualElements`,null),d([C()],U.prototype,`manipulators`,null),d([C()],U.prototype,`zManipulator`,null),d([C()],U.prototype,`getTheme`,void 0),U=d([j(`esri.views.3d.interactive.editingTools.settings`)],U);var Rs=class extends xo{constructor(e){super(e),this._attachmentOrigin=pn(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new Rt,this._geometry=null,this._width=1,this._color=Ft(1,0,1,1),this._innerWidth=0,this._innerColor=Ft(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=8,this._attachmentOrigin.spatialReference=e.view.spatialReference,this._laserline=new Bo({view:e.view,isDecoration:e.isDecoration}),this.applyProperties(e),this.attached=e.attached??!0}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:zs,recreateGeometry:(e,t)=>{e.geometries.length=0,this._recreateGeometry(t,e.material,e.geometries)},forEachMaterial:(e,t)=>t(e.material)}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:zs,recreateGeometry:e=>{e.geometries=this._createRenderGeometriesDraped(e.material),this._attachmentOriginChanged()},forEachMaterial:(e,t)=>t(e.material)}}get _laserlineAttached(){return this.attached&&this.visible&&this._laserlineStyle!=null&&!this.isDraped&&this.laserlineEnabled}onAttachedChange(e){this._laserline.attached=this._laserlineAttached,e&&this._attachmentOriginChanged()}get isDecoration(){return this._isDecoration}set isDecoration(e){this._isDecoration=e,this._updateMaterial()}get geometry(){return this._geometry}set geometry(e){let t=this._isClosed;this._geometry=e,this.recreateGeometry(),t!==this._isClosed&&this._updateMaterial()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){De(e,this._color)||(Ae(this._color,e),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){De(e,this._innerColor)||(Ae(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){let t=e!=null!=(this._stipplePattern!=null);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){e&&this._stippleOffColor&&De(e,this._stippleOffColor)||(this._stippleOffColor=e?Ze(e):null,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,e!=null&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get attachmentOrigin(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;let e=this.object3dResources.resources?.geometries;if(!e||e.length===0)return null;t(Vs,0,0,0);let n=0;for(let t of e)t.computeAttachmentOrigin(Bs)&&(A(Vs,Vs,Bs),n++);return n===0?null:(x(Vs,Vs,1/n),this.view.renderCoordsHelper.fromRenderCoords(Vs,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}_updateMaterial(){this.object3dResources.resources?.material.setParameters(this._materialParameters),this.drapedResources.resources?.material.setParameters(this._materialParameters)}get _isClosed(){return this.geometry!=null&&this.geometry.type===`polygon`}get _materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this._isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:`round`,hasPolygonOffset:!0,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration}}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===8?4:this._renderOccluded}_recreateGeometry(e,t,n){this._createRenderGeometries(t,n);for(let t of n)e.addGeometry(t);this._attachmentOriginChanged()}_attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit(`attachment-origin-changed`)}_createObject3DResources(e){let t=new V(this._materialParameters,this.view.state.isGlobal),n=[];return this._recreateGeometry(e,t,n),{material:t,geometries:n}}_createDrapedResources(){let e=new V(this._materialParameters,this.view.state.isGlobal);return{material:e,geometries:this._createRenderGeometriesDraped(e)}}_createRenderGeometriesDraped(e){let{geometry:t,view:n}=this,r=n.basemapTerrain.spatialReference;return t==null||r==null?[]:ga(t,r).lines.map(({position:t})=>{let i={overlayInfo:{spatialReference:r,renderCoordsHelper:n.renderCoordsHelper},attributeData:{position:t},removeDuplicateStartEnd:this._isClosed};return new pa(Na(e,i))})}calculateMapBounds(e){if(this.object3dResources.resources==null)return!1;let t=this.view.renderCoordsHelper;for(let n of this.object3dResources.resources.geometries){let r=n.attributes.get(`position`),i=He(r.data.length);pt(r.data,t.spatialReference,0,i,this.view.spatialReference,0),ee(e,i)}return!0}_createRenderGeometries(e,t){let n=this.geometry;if(n==null)return;let r=va(n,this.view.elevationProvider,this.view.renderCoordsHelper,Qi.fromElevationInfo(this.elevationInfo??new Et({mode:Nn(n,null)}))),i=[];for(let{position:n,mapPositions:a}of r.lines){let r={mapPositions:a,attributeData:{position:n},removeDuplicateStartEnd:this._isClosed};t.push(Na(e,r)),i.push(n)}this._laserline.pathVerticalPlane=i}};function zs(e){e.geometries=[]}var Bs=b(),Vs=b();function Hs(e,t,n,r,i){let a=He(3*e.length),o=He(a.length);e.forEach((e,t)=>{a[3*t]=e[0],a[3*t+1]=e[1],a[3*t+2]=e.length>2?e[2]:0});let s=Xi(a,t,0,o,0,a,0,a.length/3,n,r,i),c=s!=null;return{numVertices:e.length,position:a,mapPositions:o,projectionSuccess:c,sampledElevation:s}}var Us=class extends aa{constructor(e,t){super(e,t,new na(Ua,()=>f(()=>import(`./ShadedColorMaterial.glsl-e7VX6t4X.js`),__vite__mapDeps([33,34,5,6,35,7,8,28,3,11,36,26,37,31,38,39,24,40,4,23,27,9,41,42,43,10,12,32]))),Ws(t).locations)}initializePipeline(e){let{oitPass:t,output:n,transparent:r,cullFace:i,shadingEnabled:a}=e,o=t===0,s=t===2;return yi({blending:Cn(n)&&r?ji(t):null,culling:bi(i),depthTest:{func:s?513:a?515:513},depthWrite:Ii(e),drawBuffers:Ni(t,n),colorWrite:_i,polygonOffset:o||s?null:Mi})}};function Ws(e){let t=la().vec3f(`position`).vec3f(`normal`);return e.screenSizeEnabled&&t.vec3f(`offset`),t}var Gs=class extends Fi{constructor(){super(...arguments),this.cullFace=0,this.transparent=!1,this.writeDepth=!0,this.screenSizeEnabled=!0,this.shadingEnabled=!0,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.textureCoordinateType=0,this.emissionSource=0,this.occlusionPass=!1,this.olidColorInstanced=!1,this.draped=!1,this.overlayEnabled=!1,this.snowCover=!1}get discardInvisibleFragments(){return this.transparent}};d([B({count:3})],Gs.prototype,`cullFace`,void 0),d([B()],Gs.prototype,`transparent`,void 0),d([B()],Gs.prototype,`writeDepth`,void 0),d([B()],Gs.prototype,`screenSizeEnabled`,void 0),d([B()],Gs.prototype,`shadingEnabled`,void 0),d([B()],Gs.prototype,`terrainDepthTest`,void 0),d([B()],Gs.prototype,`cullAboveTerrain`,void 0);var Ks=class extends ki{constructor(e){super(e,Js),this._configuration=new Gs,this.supportsEdges=!0,this._pp0=O(0,0,1),this._pp1=O(0,0,0),this.produces=new Map([[2,e=>e===9||Sn(e)&&!this.parameters.transparent],[4,e=>Sn(e)&&this.parameters.transparent&&this.parameters.writeDepth],[8,e=>Sn(e)&&this.parameters.transparent&&!this.parameters.writeDepth]])}getConfiguration(e,t){return super.getConfiguration(e,t,this._configuration),this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.screenSizeEnabled=this.parameters.screenSizeEnabled,this._configuration.shadingEnabled=this.parameters.shadingEnabled,this._configuration.oitPass=t.oitPass,this._configuration.terrainDepthTest=t.terrainDepthTest&&Cn(e),this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration}get visible(){return this.parameters.color[3]>=Ta}intersect(e,t,n,r,i,a){this._intersect(e,n,r,i,a)}intersectDraped(e,t,n,r){return this._pp0[0]=this._pp1[0]=n[0],this._pp0[1]=this._pp1[1]=n[1],this._intersect(e,t,this._pp0,this._pp1,r)}_intersect(e,n,r,i,a){if(this.parameters.screenSizeEnabled){let o=e.attributes.get(`offset`);Vi(e,n,r,i,{applyToVertex:(e,r,i,a)=>{let s=t(Xs,o.data[3*a],o.data[3*a+1],o.data[3*a+2]),c=t(Zs,e,r,i);return x(s,s,this.parameters.screenSizeScale*(n.camera?.computeScreenPixelSizeAt(s)??1)),A(c,c,s),[c[0],c[1],c[2]]},applyToAabb:e=>{let t=ve(e,Xs);return p(e,this.parameters.screenSizeScale*(n.camera?.computeScreenPixelSizeAt(t)??1))}},a)}else Vi(e,n,r,i,void 0,a)}createGLMaterial(e){return new qs(e)}createBufferWriter(){return new Ys(Ws(this.parameters))}},qs=class extends wn{beginSlot(e){return this.getTechnique(Us,e)}},Js=class extends Ai{constructor(){super(...arguments),this.color=Ft(1,1,1,1),this.shadingTint=Ft(0,0,0,.25),this.shadingDirection=w(b(),[.5,-.5,-.5]),this.screenSizeScale=14,this.forceTransparentMode=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=0,this.screenSizeEnabled=!1,this.shadingEnabled=!0}get transparent(){return this.color[3]<1||this.forceTransparentMode}},Ys=class{constructor(e){this.layout=e}elementCount(e){return e.get(`position`).indices.length}write(e,t,n,r,i,a){let o=Gi(n,r,this.layout,e,t,i,a),s=i.getField(`offset`,dn);if(s&&n.has(`offset`)){let e=n.get(`offset`);fn(e.size===3),Li(e,t,s,a)}return o}},Xs=b(),Zs=b(),Qs=class extends us{constructor(e){super(e),this.view=null,this._renderOccluded=4,this._vertices=null,this._spatialReference=null,this._color=Vt([1,127/255,0,1]),this._size=11,this._outlineColor=Vt([0,0,0,.5]),this._outlineSize=1,this._elevationInfo=null,this.applyProperties(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry()}get color(){return this._color}set color(e){De(e,this._color)||(Ae(this._color,e),this._updateMaterial())}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){De(e,this._outlineColor)||(Ae(this._outlineColor,e),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get _vertexMaterialParameters(){return{color:this._color,screenSizeScale:this.size,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}get _vertexOutlineMaterialParameters(){return{color:this._outlineColor,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateMaterial(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}_createRenderGeometries(){let e=this.vertices;if(e==null||e.length===0)return[];let n=Hs(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,Qi.fromElevationInfo(this.elevationInfo)),r=[],i=n.numVertices,a=n.position;for(let e=0;e<i;++e){let n=t($s,a[3*e],a[3*e+1],a[3*e+2]),i=ec(this._vertexMaterial,.5,n),o=ec(this._vertexOutlineMaterial,.5,n);r.push({vertexGeometry:i,vertexOutlineGeometry:o})}return r}createGeometries(e){let t=this._createRenderGeometries();for(let{vertexGeometry:n,vertexOutlineGeometry:r}of t)e.addGeometry(n),e.addGeometry(r)}createExternalResources(){this._vertexMaterial=new Ks({...this._vertexMaterialParameters,writeDepth:!0,cullFace:2,screenSizeEnabled:!0}),this._vertexOutlineMaterial=new Ks({...this._vertexOutlineMaterialParameters,forceTransparentMode:!0,writeDepth:!0,cullFace:1,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}forEachMaterial(e){e(this._vertexMaterial),e(this._vertexOutlineMaterial)}},$s=b();function ec(e,t,n){return Va(e,t,16,16,{offset:n})}var tc=class extends Nr{constructor(e){super(e),this._activeVertexVisualElement=null,this._createGraphicState=null,this._outlineVisualElement=null,this._verticesVisualElement=null,this._verticalLineVisualElement=null,this._settings=new U({getTheme:()=>this.view.effectiveTheme}),this.geometryType=null,this.type=`draw-3d`}initialize(){let{mode:e,offset:t,unit:n,featureExpressionInfo:r}=this.elevationInfo;this.internalGraphicsLayer.elevationInfo=new Et({mode:e,offset:t,unit:n,featureExpressionInfo:r})}normalizeCtorArgs(e){if(!e.elevationInfo){let t=e.hasZ??!0;return{...e,elevationInfo:Mn(t)}}return e}initializeGraphic(e){let{view:t}=this,n=this._createGraphicState=new Ga({graphic:e});return I([t.maskOccludee(e),t.trackGraphicState(n),S(()=>({element:this._outlineVisualElement,isDraped:n.isDraped}),({element:e,isDraped:t})=>{e&&(e.isDraped=t)},Tt),s(()=>{ni(this.tooltipInfos.mesh,this.geometryToPlace)}),this._setupLoadingIndicator(n),...ws(n)])}makeDrawOperation(){let{geometryType:e}=this,t=e!==`circle`&&e!==`rectangle`;return new Jr({view:this.view,manipulators:this.manipulators,geometryType:Mr(e),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new Gr(this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new Vr(this.elevationInfo,this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new vs,segmentLabels:t?new ho:null,labelOptions:this.sketchOptions.labels,isDraped:this._createGraphicState?this._createGraphicState.isDraped:On(this.hasZ,this.elevationInfo)===`on-the-ground`,cursor:this.cursor,constraintsEnabled:!0,automaticLengthMeasurementUtils:this.automaticLengthMeasurementUtils})}onActiveVertexChanged(e){let{view:t}=this;if(this._activeVertexVisualElement)return this._activeVertexVisualElement.vertices=[e],this._activeVertexVisualElement.recreate(),this._updateVerticalLineVisualElement(e),F();let n=this._settings,r=n.manipulators.vertex,i=new Qs({view:t,spatialReference:t.spatialReference,vertices:[e],elevationInfo:this.internalGraphicsLayer.elevationInfo,size:r.size,outlineSize:r.outlineSize,renderOccluded:r.renderOccluded,attached:!1,isDecoration:!0});this._activeVertexVisualElement=i;let a=n.visualElements.zVerticalLine,o=new Ho({view:t,extensionType:a.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:4,isDecoration:!0});this._verticalLineVisualElement=o;let s=I([S(()=>n.visualElements.zVerticalLine,e=>e.apply(o),T),S(()=>({selectedColor:z(n.colors.selected),outlineColor:z(n.manipulators.vertex.outlineColor)}),({selectedColor:e,outlineColor:t})=>{i.color=e,i.outlineColor=t},T),F(()=>{this._activeVertexVisualElement=M(this._activeVertexVisualElement),this._verticalLineVisualElement=M(this._verticalLineVisualElement)})]);return i.attached=!0,this._updateVerticalLineVisualElement(e),s}_updateVerticalLineVisualElement(e){let n=this._verticalLineVisualElement;if(!n)return;let{renderCoordsHelper:r,elevationProvider:i}=this.view;t(rc,e[0],e[1],e[2]),nc.setFromElevationInfo(this.elevationInfo),rc[2]=Yi(rc,i,nc,r),r.toRenderCoords(rc,this.view.spatialReference,rc)?(n.setStartEndFromWorldDownAtLocation(rc),n.attached=!0):n.attached=!1}onOutlineChanged(e){if(this._outlineVisualElement)return this._outlineVisualElement.geometry=e,F();let t=this.internalGraphicsLayer.elevationInfo,{view:n}=this,r=this._settings,i=new Rs({view:n,geometry:e,elevationInfo:t,isDraped:this._createGraphicState?this._createGraphicState.isDraped:On(this.hasZ,t)===`on-the-ground`,attached:!1,isDecoration:!0});this._outlineVisualElement=i;let a=I([S(()=>r.visualElements.lineObjects.outline,e=>e.apply(i),T),S(()=>r.visualElements.lineObjects.shadowStyle,e=>e.apply(i),T),F(()=>{this._outlineVisualElement=M(this._outlineVisualElement)})]);return i.attached=!0,i.laserlineEnabled=!0,a}onRegularVerticesChanged(e){if(this._verticesVisualElement)return this._verticesVisualElement.vertices=e,F();let{view:t}=this,n=this._settings,r=n.manipulators.vertex,i=new Qs({view:t,spatialReference:t.spatialReference,vertices:e,elevationInfo:this.internalGraphicsLayer.elevationInfo,size:r.size,outlineSize:r.outlineSize,renderOccluded:r.renderOccluded,attached:!1,isDecoration:!0}),a=I([S(()=>({color:z(n.manipulators.vertex.color),outlineColor:z(n.manipulators.vertex.outlineColor)}),({color:e,outlineColor:t})=>{i.color=e,i.outlineColor=t},T),F(()=>{this._verticesVisualElement=M(this._verticesVisualElement)})]);return i.attached=!0,this._verticesVisualElement=i,a}updateGraphicGeometry(e){if(this.geometryType===`mesh`&&e?.type===`point`){let t=this.geometryToPlace;t?.centerAt(e),ni(this.tooltipInfos.mesh,t);let n=this._graphic;t&&n.geometry===t||(n.geometry=t);return}super.updateGraphicGeometry(e)}_setupLoadingIndicator(e){let{drawOperation:t}=this;if(!this.geometryToPlace||e.displaying)return t.loading=!1,null;t.loading=!0;let n=F(()=>{t.loading=!1}),r,i=()=>{r&&cancelAnimationFrame(r)};return I([je(()=>e.displaying,()=>{i(),r=requestAnimationFrame(()=>n.remove())},{...Tt,once:!0}),F(i),n])}};d([C({constructOnly:!0})],tc.prototype,`elevationInfo`,void 0),d([C({constructOnly:!0})],tc.prototype,`geometryType`,void 0),d([C()],tc.prototype,`type`,void 0),d([C({constructOnly:!0})],tc.prototype,`view`,void 0),tc=d([j(`esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D`)],tc);var nc=new Qi,rc=b();function ic(e){let t=ac(e);return xt(Math.cos(t),Math.sin(t))}function ac(e){if(e==null||e.type!==`polyline`&&e.type!==`polygon`)return 0;let t=e.type===`polyline`?e.paths:e.rings,n=se();for(let e of t)for(let t=0;t<e.length-1;t++){let r=e[t],i=e[t+1],a=r[0]-i[0],o=r[1]-i[1];if(a*a+o*o>n)return Math.atan2(i[1]-r[1],i[0]-r[0])}return 0}function W(e){return e?.operations?.data.geometry}function oc(e,t){return sc(e?.data.coordinateHelper.hasZ(),t)}function sc(e,t){return!!e&&t.mode!==`on-the-ground`&&!Rn(t)}function cc(e,t,n){function r(){let e=n(),t=e.sketchOptions.tooltips.effectiveEnabled?e.activeTooltipInfo:null;return{...e,activeTooltipInfo:t}}let i=!1;function a(e){i||=(i=!0,e(),!1)}function o({activeTooltipInfo:n,sketchOptions:r,scaleRotateTransform:i}){a(()=>{n&&(n.sketchOptions=r,dc(n,t),pc(n,i)),e.info=n})}return I([S(r,o,Tt),S(()=>{let e=r(),{activeTooltipInfo:n}=e;if(n)return{context:e,activeTooltipInfo:n,key:n.key,geometry:W(t)}},(e,n)=>{e&&n&&n.key!==e.key&&a(()=>lc(t,e.context))},Pe),t.on(`committed`,()=>{queueMicrotask(()=>o(r()))}),ei(e,{onBeforePaste:()=>{i=!0},onAfterPaste:()=>{lc(t,r()),i=!1}})])}function lc(e,{activeTooltipInfo:t,callbacks:n}){if(!t)return;n.onBeforeUpdate();let r=W(e);switch(r?.type){case`mesh`:uc(t,r.origin,e,n),`orientation`in t&&`scale`in t&&ni(t,r,n);break;case`point`:uc(t,r,e,n)}}function uc(e,t,n,r){let{dx:i,dy:a,dz:o}=ai(e,t);i===0&&a===0&&o===0||(r.onMoveStart(),n.operations?.move(i,a,o,0),r.onMove(i,a,o),r.onMoveStop())}function dc(e,t){let n=W(t),r=n?.type;if(!e||!n||r!==`mesh`&&r!==`point`)return;let i=r===`mesh`,a=i?n.origin:n;e.setLocationFromPoint(a),fc(e,a,t),e.type===`transform-mesh`&&i&&si(e,n),e.clearInputValues()}function fc(e,t,n){e.elevation.actual=fr(t),e.elevation.visible=!!n.operations?.data.coordinateHelper.hasZ(),e.elevation.readOnly=!1,e.elevation.showAsZ=!0}function pc(e,t){if(e?.type!==`transform-point`)return;if(!t)return e.orientation.actual=void 0,e.size.actual=void 0,e.orientation.visible=!1,void(e.size.visible=!1);let n=t.mode,{size:r,orientationClockwise:i}=t.adapter,{visualVariables:a}=e.sketchOptions.tooltips,o=a?.rotation,s=i!=null&&(n==null||n===`rotate`);e.orientation.actual=s?ur(i,`radians`,`geographic`):void 0,e.orientation.precision=mc(o?.valueType),e.orientation.visible=s;let c=a?.size,l=r!=null&&(n==null||n===`scale`);e.size.actual=l?lr(r,c?.unit??`meters`):void 0,e.size.precision=mc(c?.valueType),e.size.visible=l}function mc(e){switch(e){case`integer`:case`long`:return 0;default:return null}}function hc(e,t,n=vn()){return gc(e,Be(t),n),w(n.direction,n.direction),n}function gc(t,n,r){return _c(t,t.screenToRender(n,e(R.get())),r)}function _c(t,n,r){if(n==null)return null;let i=e(ht(R.get(),n));if(i[2]=0,!t.unprojectFromRenderScreen(i,r.origin))return null;let a=e(ht(R.get(),n));a[2]=1;let o=t.unprojectFromRenderScreen(a,R.get());return o==null?null:(E(r.direction,o,r.origin),r)}var G=class{constructor(e){this.metadata=void 0,this._camera=new ia,this._elevation={offset:0,override:null},this.collisionType={type:`point`},this.collisionPriority=0,this._renderObjects=[],this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=N(),this._worldFrame=null,this._renderLocation=b(),this._renderLocationDirty=!0,this._location=new o({x:0,y:0,z:0}),this._elevationAlignedLocation=new o,this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.consumesClicks=!0,this.cursor=null,this.grabCursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=0,this._focused=!1,this.events=new Rt,this._screenLocation={screenPointArray:ce(),renderScreenPointArray:vt(),pixelSize:0},this._screenLocationDirty=!0,this._engineResourcesAddedToStage=!1,this._attached=!1,this._location.spatialReference=e.view.spatialReference,Object.assign(this,e);let t=this.view.state?.camera;t&&this._camera.copyFrom(t)}destroy(){this._applyObjectTransform=Pc,this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this._camera=null}get _stage(){return this.view?.stage}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject()}get renderObjects(){return this._renderObjects}set renderObjects(e){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=e.slice(),this._updateEngineObject()}set available(e){e!==this._available&&(this._available=e,this._updateEngineObject())}get available(){return this._available}disableDisplay(){return this._noDisplayCount++,this._noDisplayCount===1&&this._updateEngineObject(),F(()=>{this._noDisplayCount--,this._noDisplayCount===0&&this._updateEngineObject()})}set radius(e){e!==this._radius&&(this._radius=e,this._updateEngineObject())}get radius(){return this._radius}set worldSized(e){e!==this._worldSized&&(this._worldSized=e,this._updateEngineObject())}get worldSized(){return this._worldSized}get modelTransform(){return this._modelTransform}set modelTransform(e){vc(e)&&(this._screenLocationDirty=!0),Ce(this._modelTransform,e),this._updateEngineObject()}get renderLocation(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||=N(),yc(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&=null),this._renderLocation}set renderLocation(e){this.view.renderCoordsHelper.fromRenderCoords(e,this._location),this.elevationAlignedLocation=this._location}get location(){return this._location}set location(e){ci(e,this._location),this._notifyLocationChanged()}_notifyLocationChanged(){this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit(`location-update`,{location:this._location})}get elevationAlignedLocation(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation}set elevationAlignedLocation(e){ci(e,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit(`location-update`,{location:this._location})}_updateElevationAlignedLocation(){let e=this._elevation.override==null?this.location.z||0:this._elevation.override;this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y,this._elevationAlignedLocation.z=e+this._elevation.offset,this._elevationAlignedLocation.spatialReference=ui(this.location.spatialReference),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1}grabbableForEvent(){return!0}get grabbing(){return this._grabbing}set grabbing(e){e!==this._grabbing&&(this._grabbing=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get hovering(){return this._hovering}set hovering(e){e!==this._hovering&&(this._hovering=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get selected(){return this._selected}set selected(e){e!==this._selected&&(this._selected=e,this._updateEngineObject(),this.events.emit(`select-changed`,{action:e?`select`:`deselect`}))}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._updateEngineObject())}updateStateEnabled(e,t){t?this.state|=e:this.state&=~e}_setFocused(e){e!==this._focused&&(this._focused=e,this.events.emit(`focus-changed`,{action:!0===e?`focus`:`unfocus`}))}get focused(){return this._focused}get screenLocation(){return this._ensureScreenLocation(),this._screenLocation}_ensureScreenLocation(){if(!this._screenLocationDirty)return;this._screenLocation.pixelSize=this._camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1;let e;if(vc(this._modelTransform)){let t=this._calculateModelTransformOffset(Mc);e=A(t,t,this.renderLocation)}else e=this.renderLocation;this._camera.projectToRenderScreen(e,this._screenLocation.renderScreenPointArray),this._camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}get applyObjectTransform(){return this._applyObjectTransform}set applyObjectTransform(e){this._applyObjectTransform=e,this._screenLocationDirty=!0,this._updateEngineObject()}get attached(){return this._attached}intersectionDistance(e,t){if(!this.available)return null;let n=Be(e,bc),i=this._getCollisionRadius(t),a=-1*this.collisionPriority;switch(this.collisionType.type){case`point`:if(It(this.screenLocation.screenPointArray,n)<i*i)return this.screenLocation.renderScreenPointArray[2]+a;break;case`line`:{let e=this.collisionType.paths,t=this._getWorldToScreenObjectScale(),o=this._calculateObjectTransform(t,Tc),s=i*this.screenLocation.pixelSize,c=gc(this._camera,n,Sc);if(c==null)return null;for(let t of e){if(t.length===0)continue;let e=r(Dc,t[0],o);for(let n=1;n<t.length;n++){let i=r(Oc,t[n],o),l=mr(_r(e,i,xc),c);if(l!=null&&l<s*s){let t=A(R.get(),e,i);x(t,t,.5);let n=Ue(R.get());if(this._camera.projectToRenderScreen(t,n))return n[2]+a}P(e,i)}}break}case`disc`:{let e=this.collisionType.direction,t=this.collisionType.offset??Le,o=this._getWorldToScreenObjectScale(),s=this._calculateObjectTransform(o,Tc),c=i*this.screenLocation.pixelSize,l=gc(this._camera,n,Sc);if(l==null)return null;let u=re(Cc,s),d=v(Ac,e,u),f=r(jc,t,s);on(f,d,Ec);let p=kc;if(nn(Ec,l,p)&&Ye(p,f)<c*c)return this.screenLocation.renderScreenPointArray[2]+a;break}case`ribbon`:{let{paths:e,direction:t}=this.collisionType,o=this._getWorldToScreenObjectScale(),s=this._calculateObjectTransform(o,Tc),c=i*this._camera.computeScreenPixelSizeAt(this.renderLocation),l=gc(this._camera,n,Sc);if(l==null)return null;let u=re(Cc,s),d=v(Ac,t,u),f=this._calculateModelTransformPosition(jc);on(f,d,Ec);let p=kc;if(!nn(Ec,l,p))break;for(let t of e){if(t.length===0)continue;let e=r(Dc,t[0],s);for(let n=1;n<t.length;n++){let i=r(Oc,t[n],s),o=yr(_r(e,i,xc),p);if(o!=null&&o<c*c){let t=A(R.get(),e,i);x(t,t,.5);let n=Ue(R.get());if(this._camera.projectToRenderScreen(t,n))return n[2]+a}P(e,i)}}break}default:Nt(this.collisionType)}return null}attach(e={manipulator3D:{}}){let t=this._stage;if(!t)return;let n=e.manipulator3D;n.engineLayerId==null?(this._engineLayer=new Ji(t,{pickable:!1,updatePolicy:1}),n.engineLayerId=this._engineLayer.id):t?.getLayer&&(this._engineLayer=t.getLayer(n.engineLayerId)),n.engineLayerReferences=(n.engineLayerReferences||0)+1,this._camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),wt(this._location.spatialReference,this.view.spatialReference)||(this.location=new o({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}detach(e={manipulator3D:{}}){let t=e.manipulator3D;t.engineLayerReferences--;let n=t.engineLayerReferences===0;this._removeResourcesFromStage(),n&&(t.engineLayerId=null,M(this._engineLayer)),this._engineResources=null,this._engineLayer=null,this._attached=!1}onViewChange(){this._camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()}onElevationChange(e){Je(this.location,Nc,e.spatialReference)&&n(e.extent,Nc)&&this._notifyLocationChanged()}_evaluateElevationAlignment(){if(this.elevationInfo==null)return;let e=null,t=0,n=jn(this.elevationInfo,this.location.spatialReference??this.view.elevationProvider.spatialReference);switch(this.elevationInfo.mode){case`on-the-ground`:e=Zi(this.view.elevationProvider,this.location,`ground`)??0;break;case`relative-to-ground`:t=(Zi(this.view.elevationProvider,this.location,`ground`)??0)+n;break;case`relative-to-scene`:t=(Zi(this.view.elevationProvider,this.location,`scene`)??0)+n;break;case`absolute-height`:t=n}(t!==this._elevation.offset||e!==this._elevation.override)&&(this._elevation.offset=t,this._elevation.override=e)}_updateEngineObject(){if(!this._attached)return;if(!this.available)return void this._removeResourcesFromStage();let e=this._getWorldToScreenObjectScale(),t=Tc;if(!0===this.autoScaleRenderObjects){let n=this._getFocusedSize(this._radius,this.focused)*e;this._calculateObjectTransform(n,t)}else this._calculateObjectTransform(e,t);let{objectsByState:n}=this._ensureEngineResources(),r=(this.focused?2:1)|(this.selected?8:4),i=this._noDisplayCount>0;for(let{stateMask:e,objects:a}of n){if(i){for(let e of a)e.visible=!1;continue}let n=!(15&e)||(r&e)===(15&e),o=!(65520&e)||(this.state&e)===(65520&e);if(n&&o)for(let e of a)e.visible=!0,e.transformation=t;else for(let e of a)e.visible=!1}}_ensureEngineResources(){if(this._engineResources==null){let e=this._engineLayer,t=[],n=new Set;this.renderObjects.forEach(({geometry:{material:e}})=>{n.has(e)||(t.push(e),n.add(e))});let r=new Map;this._renderObjects.forEach(e=>{let t=new $i({castShadow:!1,geometries:[e.geometry]}),n=r.get(e.stateMask)||[];n.push(t),r.set(e.stateMask,n)});let i=[];r.forEach((e,t)=>i.push({stateMask:t,objects:e})),this._engineResources={objectsByState:i,layer:e,materials:t}}return this._addResourcesToStage(),this._engineResources}_addResourcesToStage(){let e=this._stage;if(this._engineResourcesAddedToStage||this._engineResources==null||!e)return;let{objectsByState:t,layer:n}=this._engineResources;t.forEach(({objects:e})=>n.addMany(e)),this._engineResourcesAddedToStage=!0}_removeResourcesFromStage(){let e=this._stage;if(!this._engineResourcesAddedToStage||this._engineResources==null||!e)return;let{objectsByState:t,layer:n}=this._engineResources;t.forEach(({objects:e})=>n.removeMany(e)),this._engineResourcesAddedToStage=!1}_getCollisionRadius(e){return this._getFocusedSize(this.radius,!0)*(e===`touch`?this.touchMultiplier:1)}_getFocusedSize(e,t){return e*(t?this.focusMultiplier:1)}_getWorldToScreenObjectScale(){return this._worldSized?1:this.screenLocation.pixelSize}_calculateModelTransformPosition(e){let n=this._getWorldToScreenObjectScale(),r=this._calculateObjectTransform(n,wc);return t(e,r[12],r[13],r[14])}_calculateModelTransformOffset(e){let t=this._calculateModelTransformPosition(e);return E(e,t,this.renderLocation)}_calculateObjectTransform(e,t){return ie(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1),this._worldFrame&&ge(t,t,this._worldFrame),ge(t,t,this._modelTransform),t[12]+=this.renderLocation[0],t[13]+=this.renderLocation[1],t[14]+=this.renderLocation[2],t[15]=1,this._applyObjectTransform!=null&&this._applyObjectTransform(t),t}get test(){}};function vc(e){return e[12]!==0||e[13]!==0||e[14]!==0}function yc(e,t,n){switch(e.viewingMode){case`local`:return Gt(n),!0;case`global`:{let r=Te(e.renderCoordsHelper.spatialReference);return ue(t,0,Dc,0,r.radius),ln(bt(Dc[0]),bt(Dc[1]),n),!0}}}var bc=ce(),xc=gr(),Sc=vn(),Cc=ft(),wc=N(),Tc=N(),Ec=sn(),Dc=b(),Oc=b(),kc=b(),Ac=b(),jc=b(),Mc=b(),Nc=new o({x:0,y:0,z:0,spatialReference:null}),Pc=()=>{},Fc=class{constructor(){this.grabbingState=0,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}update(e){this.grabbingState=0,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,e.forEachManipulator((e,t)=>{if(t===0&&(this.zManipulator=e),e instanceof G&&(e.selected&&(this.numSelected===0&&(this.firstSelected=e),this.numSelected++),this.firstGrabbedXY==null&&e.grabbing&&t===1&&(this.firstGrabbedXY=e)),e.grabbing)switch(this.grabbingState|=1,t){case 0:this.grabbingState|=2;break;case 1:this.grabbingState|=4}})}};function Ic(e){let{object:t}=e,n=Lc(e),r=[n,Rc(e,n.visualElement)];return t.maskOccludee&&r.push(t.maskOccludee()),{visualElement:n.visualElement,remove:()=>Ee(r)}}function Lc(e){let{view:t,object:n}=e,r=W(n),i=new Rs({view:t,geometry:Vc(r)?r:null,elevationInfo:n.elevationInfo,attached:!1,isDecoration:!0}),a=new U({getTheme:()=>t.effectiveTheme}),o=()=>{i.attached=n.visible},s=I([S(()=>a.visualElements.lineObjects.outline,e=>e.apply(i),T),S(()=>a.visualElements.lineObjects.shadowStyle,e=>e.apply(i),T),S(()=>n.visible,o),S(()=>n.isDraped,e=>{i.isDraped=e},T),n.on(`committed`,()=>{let e=W(n);i.geometry=Vc(e)?e:null}),k(i)]);return o(),{visualElement:i,remove:()=>s.remove()}}function Rc(e,t){let{object:n,view:r}=e,i=[],a=n.elevationInfo,o=a.mode===`on-the-ground`||!a.offset&&a.mode!==`absolute-height`,s=new Fc,c=new U({getTheme:()=>r.effectiveTheme}),l=c.visualElements,u=new Ho({view:r,extensionType:l.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:4,isDecoration:!0}),d=bt(l.heightPlaneAngleCutoff),f=new Bo({view:r,attached:!1,angleCutoff:d,isDecoration:!0}),p=g(1);i.push(S(()=>({lineShadowStyle:c.visualElements.lineObjects.shadowStyle,pointShadowStyle:c.visualElements.pointObjects.shadowStyle,alpha:p.value}),({lineShadowStyle:e,pointShadowStyle:n,alpha:r})=>{e.apply(t,r),n.apply(u,r)},T));let m=g(1);i.push(S(()=>({heightPlane:c.visualElements.heightPlane,alpha:m.value}),({heightPlane:e,alpha:t})=>e.apply(f,t),T));let h=()=>{s.update(e);let r=W(n);if(!n.visible||o&&(n.isDraped||!Vc(r)||!r.hasZ))return t.laserlineEnabled=!1,u.attached=!1,void(f.attached=!1);t.laserlineEnabled=!0,p.value=4&s.grabbingState?l.laserlineAlphaMultiplier:1,m.value=2&s.grabbingState?l.laserlineAlphaMultiplier:1,zc(u,s),Bc(e,t,f,s)};i.push(S(()=>c.visualElements.zVerticalLine,e=>e.apply(u),T)),i.push(n.on(`committed`,h),S(()=>n.visible,h),t.events.on(`attachment-origin-changed`,h),k(u),k(f));let _=[],v=()=>{Ee(_),_.length=0,e.forEachManipulator(e=>_.push(e.events.on(`grab-changed`,h))),e.forEachManipulator(e=>_.push(e.events.on(`select-changed`,h))),h()};return v(),i.push(e.onManipulatorsChanged(v),ke(()=>I(_))),I(i)}function zc(e,t){let n=t.numSelected===1?t.firstSelected:t.numSelected>1&&t.firstGrabbedXY!=null?t.firstGrabbedXY:null;n==null?e.attached=!1:(e.setStartEndFromWorldDownAtLocation(n.renderLocation),e.attached=!0)}function Bc(e,n,r,i){if(i.numSelected>0){t(Hc,0,0,0);let n=0;e.forEachManipulator((e,t)=>{t===1&&e.selected&&e instanceof G&&(A(Hc,Hc,e.renderLocation),n++)}),n>0?(r.heightManifoldTarget=x(Hc,Hc,1/n),r.attached=!0):r.attached=!1}else{let t=n.attachmentOrigin;t!=null&&e.view.renderCoordsHelper.toRenderCoords(t,Hc)?(r.heightManifoldTarget=Hc,r.attached=!0):r.attached=!1}}function Vc(e){return e!=null&&(e.type===`polygon`||e.type===`polyline`)}var Hc=b();function Uc(e){let t=[],n=Gc(e,t);return Wc(e,t,n),{visualElement:n,remove:()=>Ee(t)}}function Wc(e,n,r){let{view:i,object:a}=e,o=new U({getTheme:()=>i.effectiveTheme}),s=new Ho({view:i,extensionType:o.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:4,isDecoration:!0});n.push(S(()=>o.visualElements.zVerticalLine,e=>e.apply(s),T));let c=new Bo({view:i,intersectsLineInfinite:!0,attached:!1,isDecoration:!0}),l=bt(o.visualElements.heightPlaneAngleCutoff),u=new Bo({view:i,attached:!1,angleCutoff:l,isDecoration:!0}),d=a.elevationInfo,f=Qi.fromElevationInfo(d),p=d.mode===`on-the-ground`||!d.offset&&d.mode!==`absolute-height`,m=new Fc,h=g(1);n.push(S(()=>({heightPlane:o.visualElements.heightPlane,alpha:h.value}),({heightPlane:e,alpha:t})=>e.apply(u,t),T));let _=g(1);n.push(S(()=>({shadowStyle:o.visualElements.pointObjects.shadowStyle,alpha:_.value}),({shadowStyle:e,alpha:t})=>e.apply(c,t),T));let v=()=>{m.update(e);let n=Kc(W(a)),l=p&&(a.isDraped||n==null||!n.hasZ),d=!0;if(l||n==null)d=!1;else{zn(a.elevationInfo)&&(n=n.clone(),n.z=0);let e=Yi(n,i.elevationProvider,f,i.renderCoordsHelper);t(Xc,n.x,n.y,e),mn(Xc,n.spatialReference,Xc,i.renderCoordsHelper.spatialReference),s.setStartEndFromWorldDownAtLocation(Xc),c.intersectsWorldUpAtLocation=Xc}h.value=2&m.grabbingState?o.visualElements.laserlineAlphaMultiplier:1;let g=Ie(Zc);!l&&a.visible&&r.calculateMapBounds(g)&&mn(he(g,Xc),i.spatialReference,Xc,i.renderCoordsHelper.spatialReference)?(u.heightManifoldTarget=Xc,u.attached=!0):u.attached=!1,_.value=4&m.grabbingState?o.visualElements.laserlineAlphaMultiplier:1;let v=d&&a.visible&&!l;c.attached=v,s.attached=v};n.push(S(()=>[a.visible,a.isDraped],v),a.on(`committed`,v)),e.forEachManipulator(e=>{n.push(e.events.on(`grab-changed`,v))}),n.push(k(c)),n.push(k(s)),n.push(k(u)),v()}function Gc(e,t){let{view:n,object:r}=e,i=new ds({view:n,geometry:Kc(W(r)),elevationInfo:r.elevationInfo,isDecoration:!0});return qc(e,i,t),t.push(k(i)),i}function Kc(e){return e==null?null:e.type===`point`?e:e.type===`mesh`?e.origin.clone():null}function qc(e,t,n){let{view:r,object:i}=e,a=()=>{t.attached=i.visible},o=new U({getTheme:()=>r.effectiveTheme});Jc(e,t,n),o.visualElements.pointObjects.outline.apply(t),n.push(S(()=>i.visible,a,T))}function Jc(e,t,n){let{view:r,object:i}=e,a=null,o=e=>{a!=null&&(a.remove(),a=null),i.isDraped&&e!=null&&(a=Yc(r,e,()=>{t.geometry=e}))},s=()=>{let e=Kc(W(i));e!=null&&zn(i.elevationInfo)&&(e.z=0),o(e),t.geometry=e};n.push(i.on(`committed`,s),ke(()=>a)),s()}function Yc(e,t,n){let r=e.elevationProvider.spatialReference;cn(t,Xc,r);let i=Xc[0],a=Xc[1];return e.elevationProvider.on(`elevation-change`,e=>{qt(e.extent,i,a)&&n()})}var Xc=b(),Zc=le();function Qc(e){switch(W(e.object)?.type){case`point`:case`mesh`:return Uc(e);case`polygon`:case`polyline`:return Ic(e);default:return null}}var $c=.02,el=47,tl=.5,nl=5*Math.PI/12,rl=1*Math.PI/3,il=.2,al=.3,ol=class{constructor(){this._available=!0}set location(e){this._forEachManipulator3D(t=>t.location=e)}set elevationAlignedLocation(e){this._forEachManipulator3D(t=>t.elevationAlignedLocation=e)}set elevationInfo(e){this._forEachManipulator3D(t=>t.elevationInfo=e)}get renderLocation(){let e;return this._forEachManipulator3D(t=>{e||=t.renderLocation}),e}set renderLocation(e){this._forEachManipulator3D(t=>t.renderLocation=e)}get available(){return this._available}set available(e){this._available=e,this._forEachManipulator3D(t=>t.available=e)}get hovering(){return this.someManipulator(e=>e.hovering)}get grabbing(){return this.someManipulator(e=>e.grabbing)}get dragging(){return this.someManipulator(e=>e.dragging)}get selected(){return this.someManipulator(e=>e.selected)}hasManipulator(e){return this.someManipulator(t=>t===e)}someManipulator(e){let t=!1;return this.forEachManipulator(n=>{!t&&e(n)&&(t=!0)}),t}_forEachManipulator3D(e){this.forEachManipulator((t,n)=>{t instanceof G&&e(t,n)})}},sl=class extends ol{constructor(){super(...arguments),this._interactive=!0}get interactive(){return this._interactive}set interactive(e){this._interactive!==e&&(this._interactive=e),this._updateManipulatorInteractivity()}_updateManipulatorInteractivity(){let e=!this.grabbing&&this._interactive;this.forEachManipulator(t=>{t.interactive=e||t.grabbing})}},K=class{constructor(e,t=0){this.geometry=e,this.stateMask=t}};function cl(e,t){return ul(e,()=>t)}function ll(e){return ul(e,e=>e.plane)}function ul(e,t){let n=b(),r=b(),i=!1;return a=>{let o=t(a);if(a.action===`start`){let t=Be(a.screenStart,te($t.get())),r=gc(e.state.camera,t,bl);r!=null&&(i=nn(o,r,n))}if(!i)return null;let s=Be(a.screenEnd,te($t.get())),c=gc(e.state.camera,s,bl);return c==null?null:nn(o,c,r)?{...a,renderStart:n,renderEnd:r,plane:o,ray:c}:null}}function dl(e,t,n=0,r=null,i=null){let a=null;return o=>{if(o.action===`start`&&(a=e.sceneIntersectionHelper.intersectElevationFromScreen(ce(o.screenStart.x,o.screenStart.y),t,n,i),a!=null&&r!=null&&!Je(a,a,r))||a==null)return null;let s=e.sceneIntersectionHelper.intersectElevationFromScreen(ce(o.screenEnd.x,o.screenEnd.y),t,n,i);return s!=null&&(r==null||Je(s,s,r))?{...o,mapStart:a,mapEnd:s}:null}}function fl(e,t,n,r=null,i=null){return dl(e,n,kn(t,e,n),r,i)}function pl(e,t,n,r){let i=n.toMap(e.screenStart);return i==null?null:fl(t,i,n.elevationInfo,r)}function ml(e,t){let n=vl,r=yl,i=sn();e.renderCoordsHelper.worldUpAtPosition(t,n);let a=Me(rn(i),n,E(r,t,e.state.camera.eye));return Me(a,a,n),on(t,a,i)}function hl(e,t,n){let r=null,i=new Hr;return i.next(cl(e,ml(e,t))).next(gl(e,t)).next(_l(e,n)).next(e=>{e.mapEnd.x=e.mapStart.x,e.mapEnd.y=e.mapStart.y,r=e}),e=>(r=null,i.execute(e),r)}function gl(e,t){let n=b(),r=yt(t);e.renderCoordsHelper.worldUpAtPosition(t,n);let i=b(),a=b(),o=i=>(E(i,i,t),tn(n,i,i),e.viewingMode===`global`&&yt(i)*Math.sign(oe(n,i))<.001-r&&E(i,x(i,n,.001),t),A(i,i,t),i);return e=>(e.renderStart=o(P(i,e.renderStart)),e.renderEnd=o(P(a,e.renderEnd)),e)}function _l(e,t){let n=e.renderCoordsHelper;return e=>{let r=n.fromRenderCoords(e.renderStart,new o({spatialReference:t})),i=n.fromRenderCoords(e.renderEnd,new o({spatialReference:t}));return r!=null&&i!=null?{...e,mapStart:r,mapEnd:i}:null}}ot();var vl=b(),yl=b(),bl=vn();function xl(e,t,n){let r=(n,r)=>{t({action:n,object:e,dxScreen:r.screenDeltaX,dyScreen:r.screenDeltaY})};return n((t,n,i)=>(n.next(e=>(e.action===`start`&&r(`start`,e),e)).next(Br(e)).next(e=>{switch(e.action){case`start`:case`update`:(e.translationX||e.translationY||e.translationZ)&&r(`update`,e);break;case`end`:r(`end`,e)}return e}),{steps:n,cancel:i=i.next(zr(e)).next(e=>(r(`end`,{screenDeltaX:0,screenDeltaY:0}),e))}))}function Sl(e){if(e?.axis==null)return 1;let{mapStart:t,mapEnd:n,axis:r}=e,i=[n.x-t.x,n.y-t.y];return i[0]*r[0]+i[1]*r[1]>0?1:-1}var Cl=class extends ol{constructor(e){super(),this._handles=new it,this._arrowManipulatorInfos=[],this._angle=0,this._scale=1,this._radius=70,this._updateAfterDrag=!1,this.events=new Rt,this._tool=e.tool,this._view=e.view,this._opaqueMaterial=this._createMaterial(),this._transparentMaterial=this._createMaterial(.5),e.radius!=null&&(this._radius=e.radius),this._createManipulators(),this.forEachManipulator(e=>this._tool.manipulators.add(e))}set orthogonalAvailable(e){this._arrowManipulatorInfos.length>=3&&(this._arrowManipulatorInfos[1].manipulator.available=e,this._arrowManipulatorInfos[3].manipulator.available=e)}destroy(){this._handles=M(this._handles),this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}forEachManipulator(e){for(let{manipulator:t}of this._arrowManipulatorInfos)e(t,1)}createManipulatedObjectDragPipeline(e,t,n){if(!t.operations)return F();let r=t.operations.data.spatialReference,i=t.graphic;return xl(t,n,n=>this.createDragPipeline((t,r,i,a,o)=>({steps:r,cancel:i}=e(t,r,i,a,o),n(t,r,i)),t.elevationInfo,r,i))}createDragPipeline(e,t,n,r){return I(this._arrowManipulatorInfos.map(({manipulator:i},a)=>Xr(i,(i,o,s,c,l)=>{let u=o.next(e=>({...e,manipulatorType:1})).next(Rr(this._view,i.elevationAlignedLocation)).next(fl(this._view,i.elevationAlignedLocation,t,n,r)).next(Pr(i.location,this.angle+(a+1)*Math.PI*.5)).next(Lr());e(i,u,s,c,l)})))}get angle(){return this._angle}set angle(e){this._angle=e,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get radius(){return this._radius}set radius(e){this._radius!==e&&(this._radius=e,this._updateManipulators())}_updateManipulators(){for(let e=0;e<this._arrowManipulatorInfos.length;e++)this._updateArrowManipulator(this._arrowManipulatorInfos[e],e);this._updateManipulatorTransform()}_updateArrowManipulator({manipulator:e,transform:n},r){let i=this._radius/70,a=54*i,o=a*Math.sqrt(3)/2,s=Ia(this._opaqueMaterial,o,a/2,a/2,$c);ja(s,Fe(L.get(),t(R.get(),0,-o/3,0))),e.renderObjects=[new K(s,2),new K(s.instantiate({material:this._transparentMaterial}),1)],e.radius=o/3*2*1.2;let c=zt(L.get(),r*Math.PI/2),l=Fe(L.get(),t(R.get(),0,100*i,0));ge(n,c,l)}_createManipulators(){for(let e=0;e<4;e++){let t=this._createArrowManipulator(e);this._arrowManipulatorInfos.push(t)}this._updateManipulatorTransform()}_updateManipulatorTransform(){let e=this.angle,n=l(L.get(),e,O(0,0,1));if(n==null)return;let r=mt(L.get(),t(R.get(),this.displayScale,this.displayScale,this.displayScale)),i=ge(L.get(),r,n);for(let e of this._arrowManipulatorInfos){let t=ge(L.get(),i,e.transform);e.manipulator.modelTransform=t}}_createArrowManipulator(e){let t=new G({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:`disc`,direction:O(0,0,1)}}),n={manipulator:t,transform:N()};return this._updateArrowManipulator(n,e),this._handles.add(t.events.on(`drag`,e=>{this._updateAfterDrag&&e.action===`end`&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1)})),n}_createMaterial(e=1){let t=new ya({cullFace:2,renderOccluded:2,isDecoration:!0});return this._handles.add(S(()=>D.toUnitRGBA(this._view.effectiveTheme.accentColor),n=>{n[3]*=e,t.setParameters({color:n})},T)),t}get test(){}},wl=class{constructor(){this._view=null,this._elevationInfo=null,this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&this._lastDragEvent!=null&&this._next!=null){let t=this._lastDragEvent.mapEnd,n=this._snap(this._lastDragEvent.screenEnd);if(n!=null){let r={action:`update`,mapStart:this._lastDragEvent.mapStart,mapEnd:!0===e?n:t,screenStart:this._lastDragEvent.screenEnd,screenEnd:this._lastDragEvent.screenEnd};this._next.execute(r)}}this._enabled=e}_snap(e){let t=this._view==null?null:this._view.toMap(e,{exclude:[]});return t!=null&&this._view!=null&&(t.z=kn(t,this._view,this._elevationInfo)),t}createDragEventPipelineStep(e,t){this._view=e,this._elevationInfo=t,this._lastDragEvent=null;let n=new Hr;return this._next=n,[e=>{if(this._lastDragEvent=e.action===`end`?null:{...e},this._enabled){let t=this._snap(e.screenEnd);return t==null?null:{action:e.action,mapStart:e.mapStart,mapEnd:t,screenStart:e.screenStart,screenEnd:e.screenEnd}}return{action:e.action,mapStart:e.mapStart,mapEnd:e.mapEnd,screenStart:e.screenStart,screenEnd:e.screenEnd}},n]}},Tl=class extends ol{constructor(e){super(),this._handles=new it,this._snapToScene=new wl,this._scale=1,this._radius=70,this._view=e.view,this._tool=e.tool,this._discMaterial=this._createMaterial(),this._discMaterialTransparent=this._createMaterial(.5),e.snapToScene!=null&&(this.snapToScene=e.snapToScene),e.radius!=null&&(this._radius=e.radius),this._createManipulator(),this.forEachManipulator(e=>this._tool.manipulators.add(e))}destroy(){this._handles=M(this._handles),this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(e){e(this._manipulator,1)}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get snapToScene(){return this._snapToScene.enabled}set snapToScene(e){this._snapToScene.enabled=e}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}get discManipulator(){return this._manipulator}createManipulatedObjectDragPipeline(e,t,n){if(!t.operations)return F();let r=t.graphic,i=t.elevationInfo,a=t.operations.data.spatialReference;return xl(t,n,t=>this.createDragPipeline((n,r,i,a,o)=>({steps:r,cancel:i}=e(n,r,i,a,o),t(n,r,i)),i,a,r))}createDragPipeline(e,t,n,r){let i=this._view;return Xr(this._manipulator,(a,o,s,c,l)=>{let u=o.next(Rr(i,a.elevationAlignedLocation)).next(fl(i,a.elevationAlignedLocation,t,n,r)).next(...this._snapToScene.createDragEventPipelineStep(i,t)).next(e=>({...e,manipulatorType:1})).next(Lr());e(a,u,s,c,l)})}_updateManipulatorTransform(){let e=mt(L.get(),t(R.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=e}_createManipulator(){let e=this._view;this._manipulator=new G({view:e,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:`disc`,direction:O(0,0,1)},worldOriented:!0}),this._updateManipulator()}_updateManipulator(){let e=Ma(this._discMaterial,$c,1,128,O(0,0,1),O(0,0,0));e.transformation=mt(N(),O(this._radius,this._radius,this._radius)),this._manipulator.renderObjects=[new K(e,2),new K(e.instantiate({material:this._discMaterialTransparent}),1)],this._manipulator.radius=80*(this._radius/70)}_createMaterial(e=1){let t=new ya({cullFace:2,renderOccluded:2,isDecoration:!0});return this._handles.add(S(()=>D.toUnitRGBA(this._view.effectiveTheme.accentColor),n=>{n[3]*=e,t.setParameters({color:n})},T)),t}get test(){}};function El(e,t=4,n=!0){let r=Vn(e),i=!(e[3]<1);return n?new Ks({color:r,writeDepth:i,cullFace:2,renderOccluded:t,isDecoration:!0}):new ya({color:r,writeDepth:i,cullFace:2,renderOccluded:t,isDecoration:!0})}function Dl(e,t=4){let n=Vn(e);return new ya({color:n,writeDepth:!0,cullFace:1,renderOccluded:t,isDecoration:!0})}var Ol=Object.freeze({calloutLength:40,calloutWidth:1,discRadius:27,focusMultiplier:1.1}),kl=Object.freeze({autoScaleRenderObjects:!1,worldSized:!0});function Al(e,t,n,i){let a=E(R.get(),e,n),o=jl(a,Me(R.get(),i,a),n,L.get());fe(o,o);let s=r(R.get(),t,o);return Math.atan2(s[1],s[0])}function jl(e,t,n,r){let i=w(R.get(),e),a=w(R.get(),t),o=Me(R.get(),i,a);return r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=0,r[4]=a[0],r[5]=a[1],r[6]=a[2],r[7]=0,r[8]=o[0],r[9]=o[1],r[10]=o[2],r[11]=0,r[12]=n[0],r[13]=n[1],r[14]=n[2],r[15]=1,r}function Ml(e,t){let n=e.getViewForGraphic(t);return n!=null&&`computeAttachmentOrigin`in n?n.computeAttachmentOrigin(t,e.spatialReference):null}function Nl(e,t){let n=t.origin;n==null?Pl(e,W(t)):e.elevationAlignedLocation=n}function Pl(e,t){if(t==null)return;let n=t.type===`mesh`?t.origin:Fa(t);n!=null&&(e.location=li(n))}var Fl=class extends ol{constructor(e){super(),this._radius=70,this.events=new Rt,this._tool=e.tool,this._view=e.view;let t=new U({getTheme:()=>this._view.effectiveTheme});this._settings=t,e.radius!=null&&(this._radius=e.radius);let n=this._view.effectiveTheme.accentColor;this._materials={materialUnfocused:El(Il(n,1,.25),1),materialFocused:El(Il(n,1,0),1),materialOccludedUnfocused:El(Il(n,.7,0),t.zManipulator.renderOccluded),materialOccludedFocused:El(Il(n,.85,0),t.zManipulator.renderOccluded)},this._themeHandle=S(()=>this._view.effectiveTheme.accentColor,e=>{let t=Il(e,1,.25),n=Il(e,1,0),r=Il(e,.7,0),i=Il(e,.85,0),{materialUnfocused:a,materialFocused:o,materialOccludedUnfocused:s,materialOccludedFocused:c}=this._materials;a.setParameters({color:t}),o.setParameters({color:n}),s.setParameters({color:r}),c.setParameters({color:i})}),this._createManipulator(),this.forEachManipulator(e=>this._tool.manipulators.add(e))}destroy(){this._themeHandle=gt(this._themeHandle),this._manipulator.applyObjectTransform=Bl,this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()})}forEachManipulator(e){e(this._manipulator,0)}createManipulatedObjectDragPipeline(e,t,n){if(!t.operations)return F();let r=t.operations.data.spatialReference;return xl(t,n,t=>this.createDragPipeline((n,r,i,a,o)=>({steps:r,cancel:i}=e(n,r,i,a,o),t(n,r,i)),r))}createDragPipeline(e,t){let n=this._view;return Xr(this._manipulator,(r,i,a,o,s)=>{let c=i.next(e=>({...e,manipulatorType:0})).next(hl(n,r.renderLocation,t)).next(Lr());e(r,c,a,o,s)})}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}_updateManipulator(){let e=this._settings,t=this._radius/70,n=e.zManipulator.height*t,r=e.zManipulator.coneHeight*t,i=e.zManipulator.coneWidth*t,a=e.zManipulator.width*t,o=[O(0,0,0),O(0,0,n)],s=[O(0,0,0),O(0,0,n+r)],c=(()=>{let e=N();return ye(e,e,[0,0,n]),ae(e,e,Math.PI/2),e})(),{materialUnfocused:l,materialFocused:u,materialOccludedUnfocused:d,materialOccludedFocused:f}=this._materials,p=Ha(l,o,a/2,16,!1),m=Ba(l,r,i/2,16,!1);m.transformation=c,this._manipulator.renderObjects=[new K(m,1),new K(p,1),new K(m.instantiate({material:u}),2),new K(p.instantiate({material:u}),2),new K(m.instantiate({material:d}),1),new K(p.instantiate({material:d}),1),new K(m.instantiate({material:f}),2),new K(p.instantiate({material:f}),2)],this._manipulator.radius=a/2+2,this._manipulator.collisionType={type:`line`,paths:[s]}}_createManipulator(){let e=this._view,t=new G({view:e,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:`ns-resize`,elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});t.applyObjectTransform=t=>{let n=e.state.camera,r=Ll;e.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,r);let i=Kt(n.eye,r),a=n.computeRenderPixelSizeAtDist(i),o=E(Rl,r,n.eye);w(o,o);let s=zl;e.renderCoordsHelper.worldUpAtPosition(Ll,s);let c=Math.abs(oe(o,s)),l=Me(Rl,o,s),u=Me(Rl,l,s),d=qe(c,.01,1),f=1-Math.sqrt(1-d*d)/d/n.fullWidth,p=this._settings,m=this._radius/70,h=p.zManipulator.width*m;x(u,w(u,u),(1/f-1)*i+a*h),t[12]-=Rl[0],t[13]-=Rl[1],t[14]-=Rl[2]},this._manipulator=t,this._updateManipulator()}get test(){}};function Il(e,t,n){let r=Hn(e,n);return r.a*=t,D.toUnitRGBA(r)}var Ll=b(),Rl=b(),zl=b(),Bl=()=>{},Vl=class extends sl{constructor(e){super(),this._handles=new it;let{tool:t,view:n,snapToScene:r,radius:i}=e;this._view=n,this.xyManipulation=new Tl({tool:t,view:n,snapToScene:r,radius:i}),this.xyAxisManipulation=new Cl({tool:t,view:n,radius:i}),this.zManipulation=new Fl({tool:t,view:n,radius:i}),this.xyManipulation.available=e.xyAvailable,this.xyAxisManipulation.available=e.xyAxisAvailable,this.zManipulation.available=e.zAvailable,this._autoHideXYAxis(),this.forEachManipulator(e=>this._handles.add(e.events.on(`grab-changed`,()=>this._updateManipulatorInteractivity())))}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}createManipulatedObjectDragPipeline(e,t,n){return I([this.xyManipulation.createManipulatedObjectDragPipeline((t,n,r,i,a)=>e(0,t,n,r,i,a),t,n),this.xyAxisManipulation.createManipulatedObjectDragPipeline((t,n,r,i,a)=>e(1,t,n,r,i,a),t,n),this.zManipulation.createManipulatedObjectDragPipeline((t,n,r,i,a)=>e(2,t,n,r,i,a),t,n)])}createDragPipeline(e,t,n,r){return I([this.xyManipulation.createDragPipeline((t,n,r,i,a)=>e(0,t,n,r,i,a),t,n,r),this.xyAxisManipulation.createDragPipeline((t,n,r,i,a)=>e(1,t,n,r,i,a),t,n,r),this.zManipulation.createDragPipeline((t,n,r,i,a)=>e(2,t,n,r,i,a),n)])}set snapToScene(e){this.xyManipulation.snapToScene=e}set angle(e){this.xyAxisManipulation.angle=e}set radius(e){this.xyAxisManipulation.radius=e,this.xyManipulation.radius=e,this.zManipulation.radius=e}set displayScale(e){this.xyManipulation.displayScale=e,this.xyAxisManipulation.displayScale=e}forEachManipulator(e){this.xyManipulation.forEachManipulator(t=>e(t,1)),this.xyAxisManipulation.forEachManipulator(t=>e(t,1)),this.zManipulation.forEachManipulator(t=>e(t,0))}get _xyAxisVisible(){let e=this.xyManipulation.someManipulator(e=>e.focused)||this.xyAxisManipulation.someManipulator(e=>e.focused);return this._view.inputManager&&this._view.inputManager.latestPointerInfo?.type===`touch`||e}_autoHideXYAxis(){let e=this.xyAxisManipulation,t=this.xyManipulation;if(Xe(`esri-mobile`))return;let n=[];t.forEachManipulator(e=>n.push(e)),e.forEachManipulator(e=>n.push(e));let r=()=>{let t=[];this._xyAxisVisible||e.forEachManipulator(e=>t.push(e.disableDisplay())),this._handles.remove(Hl),this._handles.add(t,Hl)};for(let e of n)this._handles.add(e.events.on(`focus-changed`,r));this._view.inputManager&&this._handles.add(je(()=>this._view.inputManager?.latestPointerInfo?.type,r)),r()}static radiusForSymbol(e){let t=e!=null&&e.type===`point-3d`&&e.symbolLayers;return t&&t.some(e=>e.type===`icon`)?el:70}},Hl=`disable-xy-axis-display`,Ul=class extends ol{constructor(e){super(),this._view=e.view,this._tool=e.tool,this._object=e.object,this._manipulator=this._object.createManipulator?.({selectable:!0,cursor:`move`}),this.forEachManipulator(e=>this._tool.manipulators.add(e))}destroy(){this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(e){this._manipulator&&e(this._manipulator,1)}createManipulatedObjectDragPipeline(e){return xl(this._object,e,e=>this.createDragPipeline(e))}createDragPipeline(e){if(!this._manipulator)return F();let t=this._view;return Xr(this._manipulator,(n,r,i,a,o)=>{let s=this._object.operations?.data.spatialReference,c=r.next(e=>s?e:null).next(pl(o,t,this._object,s)).next(Qr()).next(Lr());e(n,c,i,a,o)})}},Wl=class extends ri{constructor(e){super(e),this.type=`translate-xy`,this.distance=sr}};d([C()],Wl.prototype,`type`,void 0),d([C()],Wl.prototype,`distance`,void 0),Wl=d([j(`esri.views.interactive.tooltip.infos.TranslateXYTooltipInfo`)],Wl);var Gl=class extends ri{constructor(e){super(e),this.type=`translate-z`,this.distance=sr}clear(){this.distance=sr}};d([C()],Gl.prototype,`type`,void 0),d([C()],Gl.prototype,`distance`,void 0),Gl=d([j(`esri.views.interactive.tooltip.infos.TranslateZTooltipInfo`)],Gl);var Kl=class{constructor(e){this.objects=e,this.type=`move-start`}},ql=class{constructor(e,t,n){this.dx=e,this.dy=t,this.objects=n,this.type=`move`}},Jl=class{constructor(e){this.objects=e,this.type=`move-stop`}},Yl=Symbol(`manipulators`),Xl=Symbol(`tooltips`),q=class extends Zr{constructor(e){super(e),this._infos=new Map,this.events=new Rt,this.objects=new we,this.enableZ=!0,this.sketchOptions=new $n,this.type=`move-3d`,this._latestTooltipInfo=null,this._translateTooltipInfo=null,this._translateXYTooltipInfo=null,this._translateZTooltipInfo=null,this._updatingHandles=new i,this._moveManipulation=null}initialize(){let{view:e}=this;this.tooltip=ii(()=>({view:e,options:this.sketchOptions.tooltips})),this.addHandles([this.objects.on(`change`,e=>{e.removed.forEach(e=>this.removeHandles(e)),this._updateObjectInfos(e),this._setupFastTransformUpdates(e.added),this._refreshManipulators()}),this.objects.on(`change`,()=>this._connectTooltips())]);let t=this.objects.toArray();this._updateObjectInfos({added:t,removed:[]}),this._setupFastTransformUpdates(t),this._refreshManipulators(),this._connectTooltips(),this.finishToolCreation()}destroy(){this.tooltip=M(this.tooltip),this._moveManipulation=M(this._moveManipulation),this._set(`view`,null),this._updatingHandles.destroy()}onInputEvent(e){if(!this.destroyed&&!oi(e,this.tooltip))return super.onInputEvent(e)}get updating(){return this._updatingHandles.updating}get _shouldShowMovePointTooltip(){let{objects:e}=this;if(e.length!==1)return!1;let t=W(e.at(0))?.type;return t===`point`||t===`mesh`}get activeTooltipInfo(){return this._shouldShowMovePointTooltip?this._movePointTooltipInfo:this._latestTooltipInfo}reset(){}_updateObjectInfos({added:e,removed:t}){for(let t of e){if(Qn(t)!==0)continue;let e=new Ql(t);this._infos.set(t,e)}for(let e of t)this._infos.delete(e)}_setupFastTransformUpdates(e){for(let t of e){let e=this._infos.get(t);this.addHandles(ws(e.object),t)}}_refreshManipulators(){if(this.removeHandles(Yl),this._moveManipulation=M(this._moveManipulation),this.manipulators.removeAll(),this._infos.size===0)return;let e=Array.from(this._infos.values());this._createManipulators(e),this._createVisualElements(e),this._updateMoveManipulation(e)}_createManipulators(e){for(let t of e){let n=t.object;t.manipulationXY=new Ul({tool:this,view:this.view,object:n}),t.manipulationXY.forEachManipulator(e=>{this.addHandles([e.events.on(`immediate-click`,e=>{this.events.emit(`immediate-click`,{...e,object:n}),e.stopPropagation()}),e.events.on(`grab-changed`,({action:e})=>{e===`start`?this._showTooltip(0):this._hideTooltip()})],Yl)}),this.addHandles(t.manipulationXY.createDragPipeline((t,n,r,i)=>this._buildDragEventPipeline(e,0,t,n,r,i)),Yl)}this._createMoveManipulation(e)}_createMoveManipulation(e){let t=new Vl({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:e.length===1?Vl.radiusForSymbol(e[0].object.graphic?.symbol):70});this._moveManipulation=t,t.elevationInfo={mode:`absolute-height`,offset:0},t.forEachManipulator(e=>{this.addHandles(e.events.on(`immediate-click`,n=>{let r=this.objects.at(0);!t.zManipulation.hasManipulator(e)&&this.objects.length===1&&r&&this.events.emit(`immediate-click`,{...n,object:r}),n.stopPropagation()}),Yl)});let n=e=>t=>{this.addHandles([t.events.on(`focus-changed`,({action:t})=>{t===`focus`?this._showTooltip(e):this._hideTooltip()}),t.events.on(`grab-changed`,()=>{this._latestTooltipInfo&&(this._latestTooltipInfo.distance=sr)})],Yl)};this._moveManipulation.xyManipulation.forEachManipulator(n(0)),this._moveManipulation.xyAxisManipulation.forEachManipulator(n(1)),this._moveManipulation.zManipulation.forEachManipulator(n(2));let r=()=>this._updateMoveManipulation(e);for(let t of e)this.addHandles([t.object.on(`committed`,r),S(()=>t.object.visible,r)],Yl);let i=e[e.length-1];this.addHandles(i.object.on(`committed`,()=>this._updateMoveManipulationAngle(i)),Yl);let{object:a}=i,{operations:o}=a;if(o){let n=a.graphic;this.addHandles(t.createDragPipeline((t,n,r,i,a)=>this._buildDragEventPipeline(e,t,n,r,i,a),a.elevationInfo,o.data.spatialReference,n),Yl)}this._updateMoveManipulationAngle(i)}_createVisualElements(e){for(let t of e){let n=t.object,r=Qc({view:this.view,object:n,forEachManipulator:e=>{t.manipulationXY?.forEachManipulator(e),this._moveManipulation?.forEachManipulator(e)},onManipulatorsChanged:()=>F()});r!=null&&(t.geometryRepresentation=r.visualElement,t.geometryRepresentation instanceof Rs&&this.addHandles([t.geometryRepresentation.events.on(`attachment-origin-changed`,()=>{t.object.isDraped||this._updateMoveManipulation(e)}),S(()=>t.object.isDraped,()=>this._updateMoveManipulation(e))],Yl),this.addHandles(r,Yl))}}_updateMoveManipulationAngle(e){this._moveManipulation&&(this._moveManipulation.angle=ac(W(e.object)))}_updateMoveManipulation(e){let t=pn(0,0,0,this.view.spatialReference),n=0,r=!1,i=this._moveManipulation;if(i){for(let i of e){if(!i.object.visible)continue;this.enableZ&&oc(i.object.operations,i.object.elevationInfo)&&(r=!0);let e=i.geometryRepresentation instanceof Rs&&!i.object.isDraped?i.geometryRepresentation.attachmentOrigin:i.object.origin;if(e!=null){let{x:r,y:i,z:a}=e;t.x+=r,t.y+=i,a&&(t.z??=0,t.z+=a),n++}}n>0?(t.x/=n,t.y/=n,t.z??=0,t.z/=n,i.location=t,i.xyManipulation.available=!0,i.xyAxisManipulation.available=!0,i.zManipulation.available=r):i.available=!1}}_buildDragEventPipeline(e,t,n,r,i,a){let o=[],s=[],c=null,l=null,u=()=>{for(let e of o)e.dragging=!1;o.length=0,s.length=0,c=null,l=null,this._moveManipulation&&(this._moveManipulation.interactive=!0)};if(e.length===1&&t===0){let t=e[0].object;({steps:r,cancel:i}=this._buildSnappingPipelineSteps(t,t.elevationInfo,r,i,a))}return i=i.next(e=>l?.(e)).next(()=>(s.length&&this.events.emit(`move-stop`,new Jl(s)),this.destroyed||u(),null)),{steps:r=r.next(t=>{if(t.action===`start`){o.length=0,s.length=0;for(let t of e)t.dragging||!t.manipulationXY?.hasManipulator(n)&&t.manipulationXY?.grabbing||(o.push(t),s.push(t.object),t.dragging=!0);if(s.length!==0&&(this._moveManipulation&&(this._moveManipulation.interactive=!1),c=Kr(s),l=Fr(s),this._emitRecordUndo(),this.events.emit(`move-start`,new Kl(s)),this.destroyed))return null}return s.length===0?null:t}).next(e=>c?.(e)).next(e=>(this._updateMoveTooltip(t,e),e)).next(e=>{switch(e.action){case`start`:case`update`:if(e.translationX||e.translationY||e.translationZ){let t=this.view.toScreen(e.mapStart),n=this.view.toScreen(e.mapEnd);if(!t||!n)return null;let r=n.x-t.x,i=n.y-t.y;if(this.events.emit(`move`,new ql(r,i,s)),this.destroyed)return null}break;case`end`:if(this.events.emit(`move-stop`,new Jl(s)),this.destroyed)return null;u()}return null}),cancel:i}}_connectTooltips(){let e;if(this.removeHandles(Xl),this._shouldShowMovePointTooltip){let t=this.objects.at(0),{events:n}=this;this._movePointTooltipInfo??=new Wa({viewType:this.view.type,sketchOptions:this.sketchOptions});let r={onBeforeUpdate:()=>this.endDrag(),onMoveStart:()=>{this._emitRecordUndo(),n.emit(`move-start`,new Kl([t]))},onMove:()=>n.emit(`move`,new ql(0,0,[t])),onMoveStop:()=>n.emit(`move-stop`,new Jl([t])),onRotateStart:()=>{},onRotate:()=>{},onRotateStop:()=>{},onScaleStart:()=>{},onScale:()=>{},onScaleStop:()=>{}};e=cc(this.tooltip,t,()=>({sketchOptions:this.sketchOptions,activeTooltipInfo:this._movePointTooltipInfo,callbacks:r}))}else e=S(()=>this.sketchOptions.tooltips.effectiveEnabled?this._latestTooltipInfo:null,e=>{this.tooltip.info=e},Tt);this.addHandles(e,Xl)}_showTooltip(e){this._shouldShowMovePointTooltip||this._updateMoveTooltip(e)}_hideTooltip(){this._shouldShowMovePointTooltip||(this.tooltip?.clear(),this._latestTooltipInfo=null)}_updateMoveTooltip(e,t){if(this._shouldShowMovePointTooltip)return;let{sketchOptions:n,autoLengthMeasurementUtils:r}=this;switch(e){case 0:this._latestTooltipInfo=this._translateTooltipInfo??=new qa({sketchOptions:n}),$l(this._latestTooltipInfo,t,(e,t)=>r.autoDistanceBetweenPoints2D(Zl(e),Zl(t)));break;case 1:this._latestTooltipInfo=this._translateXYTooltipInfo??=new Wl({sketchOptions:n}),$l(this._latestTooltipInfo,t,(e,n)=>cr(r.autoDistanceBetweenPoints2D(Zl(e),Zl(n)),Sl(t)));break;case 2:this._latestTooltipInfo=this._translateZTooltipInfo??=new Gl({sketchOptions:n}),$l(this._latestTooltipInfo,t,pr)}this._latestTooltipInfo.sketchOptions=n}_emitRecordUndo(){let e=this.objects.toArray().map(e=>e.createUndoRecord?.()).filter(_t);e.length>0&&this.events.emit(`record-undo`,{updates:e})}_buildSnappingPipelineSteps(e,t,n,r,i){let a=W(e);if(a==null||a.type!==`point`&&a.type!==`mesh`)return{steps:n,cancel:r};let o=(a.type===`point`?a:a.origin).clone(),s=new Ar({elevationInfo:t,pointer:i,editGeometryOperations:kr.fromGeometry(o,this.view.state.viewingMode),visualizer:new vs,excludeFeature:e.graphic}),c=this.snappingManager,{snappingStep:l,cancelSnapping:u}=Ir({snappingContext:s,snappingManager:c,updatingHandles:this._updatingHandles});return r=r.next(u),{steps:n=n.next(t=>(o.z=In(this.view,o,e.elevationInfo,{mode:`absolute-height`,offset:0}),{...t,snapOrigin:s.coordinateHelper.pointToVector(o)})).next(...l),cancel:r}}};d([C({constructOnly:!0,nonNullable:!0})],q.prototype,`view`,void 0),d([C({constructOnly:!0})],q.prototype,`autoLengthMeasurementUtils`,void 0),d([C()],q.prototype,`objects`,void 0),d([C({constructOnly:!0,nonNullable:!0})],q.prototype,`enableZ`,void 0),d([C({constructOnly:!0,type:$n})],q.prototype,`sketchOptions`,void 0),d([C({constructOnly:!0})],q.prototype,`snappingManager`,void 0),d([C()],q.prototype,`type`,void 0),d([C()],q.prototype,`updating`,null),d([C()],q.prototype,`_latestTooltipInfo`,void 0),d([C()],q.prototype,`_shouldShowMovePointTooltip`,null),d([C()],q.prototype,`activeTooltipInfo`,null),q=d([j(`esri.views.3d.interactive.editingTools.move.MoveTool3D`)],q);var Zl=Se(o),Ql=class{constructor(e){this.object=e,this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1}};function $l(e,t,n){if(t==null||t.action===`end`)return void(e.distance=sr);let{mapStart:r,mapEnd:i}=t;e.distance=n(r,i)??sr}function eu(e,t,n){let r=n.mode===`on-the-ground`?1:0;return new Sr(e,r,t,0)}function tu(e,t,n){let r=b();if(!e.renderCoordsHelper.toRenderCoords(t,r))return null;let i=nu(e,t,rn(n.plane)),a=nu(e,t,n.edgeDirection);if(i==null||a==null)return null;let o=Me(b(),i,a);return on(r,o,sn())}function nu(e,t,n){let r=pn(t.x+n[0],t.y+n[1],t.z+n[2],t.spatialReference),i=b(),a=b();return e.renderCoordsHelper.toRenderCoords(t,i)&&e.renderCoordsHelper.toRenderCoords(r,a)?be(a,i,a):null}function ru(e,t,n){let r=rn(e),i=be(b(),t,n),a=Me(b(),i,r),o=Me(b(),i,a);return Dt(i[0],i[1],i[2],0,a[0],a[1],a[2],0,o[0],o[1],o[2],0,0,0,0,1)}function iu(e,t,n){let r=n.projectToRenderScreen(e,vt()),i=n.projectToRenderScreen(t,vt());return r!=null&&i!=null?ze(E(r,r,i)):0}function au(e,t,n,r){let{elevationInfo:i,operations:a}=n;if(!a||!e)return null;let o=r.manipulator.elevationAlignedLocation,s=kn(o,t,i),c=t.sceneIntersectionHelper.intersectElevationFromScreen(ce(e.x,e.y),i,s);return c&&Je(c,c,a.data.spatialReference)?c:null}function ou(e,t,n,{data:{coordinateHelper:r,spatialReference:i}}){let a=or(e,`meters`),o=Ke(i),s=Math.sign(a*n.selectedArrow),c=Xn(i),l=rn(n.plane),u=r.pointToXYZ(t),d=b();jt(d,u,l,s*(su/o));let f=a*n.selectedArrow/o;if(!c||!mn(u,i,u,c)||!mn(d,i,d,c))return f;let p=new Yn;if(qn(p,u,d,c),Jn(d,u,p.azimuth,a,c),!mn(d,c,d,i))return f;let m=d[0]-t.x,h=d[1]-t.y,g=Math.sqrt(m*m+h*h)*s,[_,v]=l,ee=Math.sqrt(_*_+v*v);return ee===0?0:g/ee}var su=10,cu=class extends ri{constructor(e){super(e),this.type=`reshape-edge-offset`,this.distance=Tr({lockable:!1}),this.area=Dr({visible:!1}),this.totalLength=Er({visible:!1})}get allFields(){return[this.distance,this.area,this.totalLength]}};d([C()],cu.prototype,`type`,void 0),d([C()],cu.prototype,`distance`,void 0),d([C()],cu.prototype,`area`,void 0),d([C()],cu.prototype,`totalLength`,void 0),d([C()],cu.prototype,`allFields`,null),cu=d([j(`esri.views.interactive.tooltip.infos.ReshapeEdgeOffsetTooltipInfo`)],cu);function lu(e,t){let n=t?.type;return{edgeOffset:new cu({sketchOptions:e,viewType:n}),movePoint:new Wa({sketchOptions:e,viewType:n}),selectedVertex:new Ka({sketchOptions:e,viewType:n}),translate:new qa({sketchOptions:e,viewType:n}),translateXY:new Wl({sketchOptions:e,viewType:n}),translateZ:new Gl({sketchOptions:e,viewType:n})}}function uu(e,t,n){function r(){let e=n(),t=e.sketchOptions.tooltips.effectiveEnabled?e.activeTooltipInfo:null;return{...e,activeTooltipInfo:t}}let i=!1;function a(e){i||=(i=!0,e(),!1)}function o(n){a(()=>{pu(t,n),e.info=n.activeTooltipInfo})}return I([S(r,o,Tt),S(()=>{let e=r(),{activeTooltipInfo:n}=e;if(n&&`key`in n)return{context:e,activeTooltipInfo:n,key:n.key,geometry:W(t)}},(e,n)=>{e&&n&&n.key!==e.key&&a(()=>du(t,e.context))},Pe),t.on(`committed`,()=>o(r())),ei(e,{onBeforePaste:()=>{i=!0},onAfterPaste:()=>{du(t,r()),i=!1}})])}function du(e,{activeTooltipInfo:t,selectedVertexManipulatorInfo:n,callbacks:r}){if(!t)return;r.onBeforeReshape();let i=W(e);switch(i?.type){case`mesh`:t.type===`move-point`&&uc(t,i.origin,e,r);break;case`point`:t.type===`move-point`&&uc(t,i,e,r);break;case`polyline`:case`polygon`:t.type===`selected-vertex`&&fu(t,n,e,r)}}function fu(e,t,n,r){if(!t)return;let{dx:i,dy:a,dz:o}=ai(e,t.manipulator.location);i===0&&a===0&&o===0||(r.onReshapeStart(),n.operations?.moveVertices([t.handle],i,a,o,0),r.onReshape(),r.onReshapeStop())}function pu(e,t){let{activeTooltipInfo:n,selectedVertexManipulatorInfo:r,sketchOptions:i}=t;if(n)switch(n.sketchOptions=i,n?.type){case`move-point`:dc(n,e);break;case`selected-vertex`:mu(n,r,e,t)}}function mu(e,t,n,{automaticAreaMeasurementUtils:r,automaticLengthMeasurementUtils:i}){if(!e||e.type!==`selected-vertex`)return;let a=t?.manipulator.location;e.setLocationFromPoint(a),fc(e,a,n);let o=n.operations?.data.geometry;switch(o?.type){case`polygon`:e.geometryType=`polygon`,e.totalLength.visible=!1,e.area.actual=r.autoArea2D(o);break;case`polyline`:e.geometryType=`polyline`,e.totalLength.actual=i.autoLength2D(o),e.area.visible=!1}}var hu=Se(o);function gu(e,t,{sketchOptions:n,tooltipInfos:r,automaticLengthMeasurementUtils:i}){let a=null;switch(e){case 0:a=r.translate,_u(a,t,(e,t)=>i.autoDistanceBetweenPoints2D(hu(e),hu(t)));break;case 1:a=r.translateXY,_u(a,t,(e,n)=>cr(i.autoDistanceBetweenPoints2D(hu(e),hu(n)),Sl(t)));break;case 2:a=r.translateZ,_u(a,t,pr)}return a.sketchOptions=n,a}function _u(e,t,n){if(t!=null&&t.action!==`end`){let{mapStart:r,mapEnd:i}=t;e.distance=n(r,i)??sr}else e.distance=sr}function vu({operations:e},t,{sketchOptions:n,tooltipInfos:r,automaticAreaMeasurementUtils:i,automaticLengthMeasurementUtils:a}){let o=r.edgeOffset;if(o.distance.committed=null,t!=null&&t.signedDistance!=null&&t.action!==`end`&&e!=null){let n=e.data.coordinateHelper,{start:r,end:i}=t.operation.clampedStartAndEnd(t.mapEnd),s=a.autoDistance2D(r,i,n.spatialReference),c=Math.sign(t.signedDistance*t.operation.selectedArrow);o.distance.actual=s==null?null:cr(s,c)}else o.distance.actual=sr;let s=e?.data.geometry;switch(o.area.actual=null,o.area.visible=!1,o.totalLength.actual=null,o.totalLength.visible=!1,s?.type){case`polygon`:o.area.actual=i.autoArea2D(s),o.area.visible=!0;break;case`polyline`:o.totalLength.actual=a.autoLength2D(s),o.totalLength.visible=!0}return o.sketchOptions=n,o}var yu={Left:0,Middle:1,Right:2,Back:3,Forward:4,Undefined:-1},bu=Symbol(),J=class extends me{get _operations(){return this.object.operations}constructor(e){super(e),this._selectedIndex=0,this._manipulatorHandles=new it,this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=0,this._pendingEdgeOffsetInfo=null,this._updatingHandles=new i,this._recreatingManipulators=!1,this._settings=new U({getTheme:()=>this.view.effectiveTheme}),this.events=new Rt,this.activeTooltipInfo=null,this._vertexLaserLineVisualElement=null,this._tooltipCallbacks={onBeforeReshape:()=>this.tool.endDrag(),onReshapeStart:()=>this._updateEventState(2),onReshape:()=>this.events.emit(`reshape`,{type:`reshape`,object:this.object}),onReshapeStop:()=>this._updateEventState(0,{forceEnd:!0}),onMoveStart:()=>this._updateEventState(1),onMove:()=>this.events.emit(`move`,{type:`move`,object:this.object,dx:0,dy:0}),onMoveStop:()=>this._updateEventState(0,{forceEnd:!0})}}initialize(){let{view:e}=this,t=this._settings.manipulators,n=t.vertex;this.tooltipInfos=lu(this._sketchOptions,e),this._vertexManipulatorMaterial=El(z(n.color),n.renderOccluded),this._vertexManipulatorOutlineMaterial=Dl(z(n.outlineColor),n.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=Dl(z(n.hoverOutlineColor),n.renderOccluded);let r=t.edge;this._edgeManipulatorMaterial=El(z(r.color),r.renderOccluded),this._edgeManipulatorOutlineMaterial=Dl(z(r.outlineColor),r.renderOccluded);let i=t.edgeOffset;this._edgeOffsetManipulatorMaterial=El(z(i.color),i.renderOccluded,!1),this._edgeOffsetManipulatorHoverMaterial=El(z(i.hoverColor),i.renderOccluded,!1);let a=t.selected;this._selectedManipulatorMaterial=El(z(a.color),a.renderOccluded),this._selectedManipulatorOutlineMaterial=Dl(z(a.outlineColor),a.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=Dl(z(a.hoverOutlineColor),a.renderOccluded),this.tooltip=ii(()=>({view:e,options:this._sketchOptions.tooltips})),this.addHandles([S(()=>{let e=this._settings.manipulators;return{vertexSettings:e.vertex,edgeSettings:e.edge,edgeOffsetSettings:e.edgeOffset,selectedSettings:e.selected}},({vertexSettings:e,edgeSettings:t,edgeOffsetSettings:n,selectedSettings:r})=>{e.applyColor(this._vertexManipulatorMaterial),e.applyOutline(this._vertexManipulatorOutlineMaterial),e.applyHoverOutline(this._vertexManipulatorHoverOutlineMaterial),t.applyColor(this._edgeManipulatorMaterial),t.applyOutline(this._edgeManipulatorOutlineMaterial),n.applyColor(this._edgeOffsetManipulatorMaterial),n.applyHover(this._edgeOffsetManipulatorHoverMaterial),r.applyColor(this._selectedManipulatorMaterial),r.applyOutline(this._selectedManipulatorOutlineMaterial),r.applyHoverOutline(this._selectedManipulatorHoverOutlineMaterial)}),S(()=>this.object.visible,e=>{for(let t of this._manipulatorInfos)t.manipulator.available=e,Tu(t)&&(t.edgeManipulator.available=e)}),S(()=>this._numGrabbing+this._numDragging===0,e=>this._toggleAutoHideManipulators(e)),S(()=>({labels:this._segmentLabels,enabled:this._sketchOptions.labels.enabled,edgeOffsetEnabled:this.enableEdgeOffset}),({labels:e,enabled:t,edgeOffsetEnabled:n})=>{e!=null&&(e.visible=t,e.edgeDistance=n?`far`:`default`)},T),uu(this.tooltip,this.object,()=>this._tooltipsContext),S(()=>this.tooltip.mode,(e,t)=>{t===`input`&&e!==`input`&&this._resetTooltip()}),y(()=>this._operations,`vertex-update`,e=>this._updateManipulatorPositions(e.vertices),{onListenerAdd:()=>this._recreateManipulators()}),y(()=>this._operations?.data,`change`,e=>{e.operation!==`undo`&&e.operation!==`redo`||this._recreateManipulators()})])}destroy(){this._removeManipulators(),this._updatingHandles.destroy(),this._segmentLabels=M(this._segmentLabels),this.tooltip=M(this.tooltip)}get updating(){return this._updatingHandles.updating}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get automaticAreaMeasurementUtils(){return this.tool.automaticAreaMeasurementUtils}get automaticLengthMeasurementUtils(){return this.tool.automaticLengthMeasurementUtils}get object(){return this.tool.object}get enableZShape(){return this.tool.enableZShape}get enableDeleteVertices(){return this.tool.enableDeleteVertices}get enableZVertex(){return this.tool.enableZVertex}get autoHideManipulators(){return this.tool.autoHideManipulators}get enableMoveObject(){return this.tool.enableMoveObject}get enableMidpoints(){return this.tool.enableMidpoints}get enableEdgeOffset(){return this.tool.enableEdgeOffset}get _sketchOptions(){return this.tool.sketchOptions}get _accentColor(){return this.view.effectiveTheme.accentColor}enterInputModeIfAvailable(e){return e.type===`key-down`&&e.key===Ht.enterInputMode&&(this.activeTooltipInfo?.type===`reshape-edge-offset`?this._enterInputModeDuringEdgeOffset(e):!!oi(e,this.tooltip)&&(this.tool.endDrag(),!0))}removeSelectedVertices(){let e=this._manipulatorInfos.filter(e=>e.manipulator.selected&&e.type===`vertex`);return this._removeVertices(e),e.length}onManipulatorSelectionChanged(){this.events.emit(`manipulators-changed`)}_removeManipulators(){this._manipulatorHandles.removeAll(),this._moveManipulation=M(this._moveManipulation),this._objectMoveManipulation=M(this._objectMoveManipulation),this.manipulators.removeAll(),this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0}_createManipulators(e){if(this._operations==null)return;let t=this.object.elevationInfo;for(let{vertices:n,segments:r,index:i}of this._operations.data.parts){let a=e?.byPartIndex.get(i);for(let e of n){let n=a?.has(e.index);this._createVertexOrEdgeManipulator(e,t,n)}for(let e of r)e.type===`line`&&this._createVertexOrEdgeManipulator(e,t)}this._createObjectMoveManipulation(),this._createMoveManipulation(t),this._createVisualElements()}recordUndo(e){this._operations?.recordUndo(e)}get canRedo(){return this._operations?.canRedo??!1}get canUndo(){return this._operations?.canUndo??!1}redo(){return this._operations?.redo()}undo(){return this.events.emit(`undo`),this._operations?.undo()}_recreateManipulators(){if(!this._recreatingManipulators){if(this._recreatingManipulators=!0,this._removeManipulators(),this._resetTooltip(),this._operations&&this._segmentLabels?.context?.editGeometryOperations===this._operations||(this._segmentLabels=M(this._segmentLabels)),this._createManipulators(),!this._segmentLabels&&this._operations){let e=this._sketchOptions.labels;this._segmentLabels=new ho({context:{view:this.view,editGeometryOperations:this._operations,elevationInfo:this.object.elevationInfo,labelOptions:e,automaticLengthMeasurementUtils:this.automaticLengthMeasurementUtils},visible:e.enabled})}this._recreatingManipulators=!1}}_perObjectManipulatorDragAction(e,t){if(t.action===`end`)return t;let n=0,r=[],i=this._manipulatorInfos.some(e=>e.type===`vertex`&&e.manipulator.selected),a=e===1&&i;for(let e of this._manipulatorInfos)e.type===`vertex`&&(e.manipulator.grabbing||a&&!e.manipulator.selected||r.push(e),n++);if(this._moveVertices(r,t),r.length===n){if(this._updateEventState(1),this.destroyed)return t;this.events.emit(`move`,{type:`move`,dx:t.screenDeltaX,dy:t.screenDeltaY,object:this.object})}else{if(this._updateEventState(2),this.destroyed)return t;this.events.emit(`reshape`,{type:`reshape`,object:this.object})}return t}_toggleAutoHideManipulators(e){this.autoHideManipulators&&(e?this.removeHandles(bu):this.tool.manipulators.forEach(({manipulator:e})=>{let t=e.disableDisplay?.();t&&this.addHandles(t,bu)}))}_isMultiVertexSelection(){return this._manipulatorInfos.reduce((e,t)=>t.type===`vertex`&&t.manipulator.selected?e+1:e,0)>1}_perVertexManipulatorDragAction(e){if(this._updateEventState(2),this.destroyed)return;let{mapDeltaX:t,mapDeltaY:n,mapDeltaZ:r}=e;if(!t&&!n&&!r)return;let i=[];for(let t of this._manipulatorInfos)t.type===`vertex`&&(t.manipulator.selected&&!t.manipulator.grabbing||t===e.info)&&i.push(t);this._moveVertices(i,e,1),this.events.emit(`reshape`,{type:`reshape`,object:this.object})}_updateEventState(e,t={}){if(e===this._reshapeEventState)return!1;switch(e){case 0:if(!t.forceEnd&&(this._numGrabbing!==0||this._numDragging!==0))return!1;switch(this._reshapeEventState){case 1:this.events.emit(`move`,{type:`move-stop`,dx:0,dy:0,object:this.object});break;case 2:this.events.emit(`reshape`,{type:`reshape-stop`,object:this.object})}break;case 1:switch(this._reshapeEventState){case 0:this.events.emit(`move`,{type:`move-start`,dx:0,dy:0,object:this.object});break;case 2:this.events.emit(`reshape`,{type:`reshape-stop`,object:this.object}),this.destroyed||this.events.emit(`move`,{type:`move-start`,dx:0,dy:0,object:this.object})}break;case 2:switch(this._reshapeEventState){case 0:this.events.emit(`reshape`,{type:`reshape-start`,object:this.object});break;case 1:this.events.emit(`move`,{type:`move-stop`,dx:0,dy:0,object:this.object}),this.destroyed||this.events.emit(`reshape`,{type:`reshape-start`,object:this.object})}}if(this.destroyed)return!1;let n=this._reshapeEventState!==e;return this._reshapeEventState=e,n}_createObjectMoveManipulation(){let{tool:e,view:t,object:n,_operations:r}=this;if(r){if(this._objectMoveManipulation=new Ul({tool:e,view:t,object:n}),this.enableMoveObject){let e=null;this._manipulatorHandles.add(this._objectMoveManipulation.createDragPipeline((t,n,i)=>{n.next(e=>this._trackNumDragging(e)).next(t=>(t.action===`start`&&(e=r.createUndoGroup()),t)).next(e=>this._perObjectManipulatorDragAction(0,e)).next(e=>(this._updateTranslateObjectTooltip(0,e),e)).next(t=>{t.action===`end`&&(this._resetTooltip(),e=gt(e))}),i.next(()=>this._onDragCancel(!0,()=>e=gt(e)))})),this._objectMoveManipulation.forEachManipulator(e=>this._manipulatorHandles.add(this._watchAndUpdateGrabState(e,!1)))}else this._objectMoveManipulation.forEachManipulator(e=>{e.grabbable=!1,e.cursor=null});this._objectMoveManipulation.forEachManipulator(e=>this._manipulatorHandles.add(e.events.on(`immediate-click`,e=>{this._manipulatorInfos.some(e=>e.manipulator.selected)?this._clearSelection():this.events.emit(`immediate-click`,{...e,object:this.object}),e.stopPropagation()})))}}_createMoveManipulation(e){let{object:t,tool:n,view:r,_operations:i}=this;if(!i)return;this._moveManipulation=new Vl({tool:n,view:r,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&oc(t.operations,t.elevationInfo),snapToScene:!1,radius:Vl.radiusForSymbol(t.graphic?.symbol)}),this._moveManipulation.forEachManipulator(e=>this.addHandles([e.events.on(`immediate-click`,t=>{this._moveManipulation.zManipulation.hasManipulator(e)||this._manipulatorInfos.some(e=>e.manipulator.selected)||this.events.emit(`immediate-click`,{...t,object:this.object}),t.stopPropagation()}),this._watchAndUpdateGrabState(e,!1)]));let a=e=>t=>{this.addHandles([t.events.on(`focus-changed`,({action:t})=>{t===`focus`?this._updateTranslateTooltip(e):this._resetTooltip()})])};this._moveManipulation.xyManipulation.forEachManipulator(a(0)),this._moveManipulation.xyAxisManipulation.forEachManipulator(a(1)),this._moveManipulation.zManipulation.forEachManipulator(a(2)),this._moveManipulation.elevationInfo={mode:`absolute-height`,offset:0};let o=i.data.spatialReference;this.addHandles([this._moveManipulation.createDragPipeline((r,a,o,s,c)=>{let{snappingStep:l,cancelSnapping:u}=Ir({predicate:e=>!!e.info,snappingManager:n.snappingManager,snappingContext:new Ar({editGeometryOperations:i,elevationInfo:e,pointer:c,excludeFeature:t.graphic,visualizer:new vs}),updatingHandles:this._updatingHandles,useZ:!1});return s=s.next(e=>(this._onDragCancel(),e)).next(u),{steps:o=o.next(e=>this._trackNumDragging(e)).next(e=>{let t=this._manipulatorInfos.filter(e=>e.type===`vertex`&&e.manipulator.selected);return e.manipulatorType===1&&t.length===1?{...e,info:t[0],snapOrigin:t[0].handle.pos}:e}).next(Ur(this.view,e,t.graphic??void 0)).next(...l).next(Qr()).next(e=>this._perObjectManipulatorDragAction(1,e)).next(e=>(this._updateTranslateTooltip(r,e),e)),cancel:s}},e,o,t.graphic),S(()=>t.visible,()=>this._updateMoveManipulationPosition(),T),t.on(`committed`,()=>{this._recreatingManipulators||this._updateMoveManipulationPosition()}),S(()=>t.isDraped,e=>{this._updateMoveManipulationPosition();let t=`align-move-manipulation`;e?this.addHandles(this.view.elevationProvider.on(`elevation-change`,()=>this._updateMoveManipulationPosition()),t):this.removeHandles(t)},T)])}_createVisualElements(){let{object:e,view:t}=this,n=Qc({view:t,object:e,forEachManipulator:e=>{if(!this.destroyed&&!this._recreatingManipulators){this._objectMoveManipulation.forEachManipulator(e),this._moveManipulation.forEachManipulator(e);for(let t of this._manipulatorInfos)e(t.manipulator,1)}},onManipulatorsChanged:e=>this.events.on(`manipulators-changed`,e)});n!=null&&(this._outlineVisualElement=n.visualElement instanceof Rs?n.visualElement:null);let r=this._outlineVisualElement;if(r!=null){let t=()=>{e.isDraped||this._updateMoveManipulationPosition()};this._manipulatorHandles.add(y(()=>r.events,`attachment-origin-changed`,t,{onListenerAdd:t}))}this._manipulatorHandles.add(n)}_createEdgeOffsetManipulator(e,t=this.object.elevationInfo){let n=this.view,r=this._operations;if(e.part.vertices.length<=2||!r)return null;let i=r.data.spatialReference,a=this._settings.manipulators.edgeOffset,o=a.size/2,s=o+a.collisionPadding,c=o/s,l=c/2,u=c*Math.sqrt(3)/2,{height:d,offset:f}=a,p=this._edgeOffsetManipulatorMaterial;this._edgeOffsetManipulatorGeometryInside||=Ia(p,u,l,l,d,f),this._edgeOffsetManipulatorGeometryOutside||=Ia(p,-u,l,l,d,-f);let m=[new K(this._edgeOffsetManipulatorGeometryInside.instantiate(),1),new K(this._edgeOffsetManipulatorGeometryInside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),2),new K(this._edgeOffsetManipulatorGeometryOutside.instantiate(),1),new K(this._edgeOffsetManipulatorGeometryOutside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),2)],h=new G({view:n,renderObjects:m,elevationInfo:t.mode!==`on-the-ground`||Kn(this.object.graphic?.symbol)?{mode:`absolute-height`,offset:0}:t,worldOriented:!1,focusMultiplier:1,radius:s,available:this.object.visible,collisionType:{type:`disc`,direction:O(0,0,1)},collisionPriority:1,metadata:{deleting:!1},location:wu(i)}),g=new G({view:n,worldSized:!0,worldOriented:!1,available:this.object.visible,collisionPriority:-10,cursor:this.enableMoveObject?`move`:`default`,metadata:{deleting:!1},location:wu(i)}),_={manipulator:h,handle:e,locationUpdateHandle:null,type:`edge`,selectedIndex:0,edgeManipulator:g,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(_,a.minSquaredEdgeLength);let v=()=>this._updateEdgeOffsetManipulator(_);v(),_.locationUpdateHandle=I([e.leftVertex,e.rightVertex].map(e=>this._getManipulatorInfoFromHandle(e)?.manipulator.events.on(`location-update`,v)));let ee=e=>{this._manipulatorInfos.some(e=>e.manipulator.selected)?this._clearSelection():this.events.emit(`immediate-click`,{...e,object:this.object}),e.stopPropagation()};return this._manipulatorHandles.add([_.locationUpdateHandle,this._watchAndUpdateGrabState(h,!0),this._watchAndUpdateGrabState(g,!0),Xr(h,this._createEdgeOffsetPipeline(_,t,r)),Xr(g,this._createEdgePipeline(_,t,r)),g.events.on(`immediate-click`,ee),h.events.on(`immediate-click`,ee),h.events.on(`focus-changed`,()=>this._resetTooltip()),h.events.on(`grab-changed`,({screenPoint:e,action:t})=>{_.grabMapPoint=t===`start`?au(e,this.view,this.object,_):null})],h),this._manipulatorInfos.push(_),this.manipulators.addMany([h,g]),this.events.emit(`manipulators-changed`),_}_autoHideEdgeOffsetManipulator(e,t){let n=e.manipulator,r=e.edgeManipulator,i=()=>{e.visibilityHandle=gt(e.visibilityHandle);let i=this._getManipulatorInfoFromHandle(e.handle.leftVertex),a=this._getManipulatorInfoFromHandle(e.handle.rightVertex),o=i!=null&&a!=null&&iu(i.manipulator.renderLocation,a.manipulator.renderLocation,this.view.state.camera)<t;(!n.focused&&!r.focused||o)&&(n.grabbable=!o,r.grabbable=!o,e.visibilityHandle=I([n.disableDisplay(),F(()=>{n.grabbable=!0,r.grabbable=this.enableMoveObject})]))};this._manipulatorHandles.add([n.events.on(`focus-changed`,i),r.events.on(`focus-changed`,i),F(()=>{gt(e.visibilityHandle),r.metadata.deleting=!0,this.manipulators.remove(r)})],n),i()}_updateEdgeOffsetManipulator(e){if(!this._operations)return;this._updateManipulatorPosition(e);let{coordinateHelper:t}=this._operations.data,n=tu(this.view,e.manipulator.elevationAlignedLocation,eu(t,e.handle,e.manipulator.elevationInfo)),r=this._getManipulatorInfoFromHandle(e.handle.leftVertex),i=this._getManipulatorInfoFromHandle(e.handle.rightVertex);if(r==null||i==null)return;let a=r.manipulator.renderLocation,o=i.manipulator.renderLocation,s=n==null?ct:ru(n,a,o);e.manipulator.modelTransform=s,e.edgeManipulator.elevationAlignedLocation=e.manipulator.elevationAlignedLocation,e.edgeManipulator.modelTransform=s;let c=yt(E(Du,a,o))/2;e.edgeManipulator.collisionType={type:`line`,paths:[[[-c,0,0],[c,0,0]]]}}_createEdgePipeline(e,t,n){return(r,i,a,o)=>{if(o===`touch`)this._createEdgeOffsetPipeline(e,t,n)(r,i,a);else if(this.enableMoveObject){let e=this.object.graphic,o=n.data.spatialReference,{elevationAlignedLocation:s}=r;i.next(e=>this._trackNumDragging(e)).next(Rr(this.view,s)).next(fl(this.view,s,t,o,e)).next(Lr()).next(Qr()).next(e=>this._perObjectManipulatorDragAction(0,e)).next(e=>(this._updateTranslateObjectTooltip(0,e),e)).next(e=>{e.action===`end`&&this._resetTooltip()}),a.next(()=>this._onDragCancel(!r.metadata.deleting))}}}_createEdgeOffsetPipeline(e,t,n){return(r,i,a)=>{let o=this._pendingEdgeOffsetInfo;if(o?.manipulatorInfo===e&&o.mode!==`drag`)return void a.execute({action:`cancel`});this._clearSelection();let{initializeStep:s,cleanup:c}=this._initializeEdgeOffset(e,t,n,a),l=this._applyEdgeOffsetStep(e);i.next(e=>this._trackNumDragging(e)).next(Rr(this.view,r.elevationAlignedLocation)).next(s).next(ll(this.view)).next(_l(this.view,n.data.spatialReference)).next(Qr()).next(xu()).next(e=>this._pendingEdgeOffsetInfo?e:l(e)).next(e=>{e.action!==`end`||this._pendingEdgeOffsetInfo||c()}),a.next(()=>{this._exitEdgeOffsetInputMode(),r.metadata.deleting||(c(),this._onDragCancel())})}}_initializeEdgeOffset(e,t,n,r){let{view:i,object:a}=this,o=eu(n.data.coordinateHelper,e.handle,t),s=n.createUndoGroup(),c=tu(i,e.manipulator.elevationAlignedLocation,o),l;this._splitEdgesBeforeEdgeOffset(e,o),this._selectEdgeOffsetArrow(e,o);let u=()=>{this._cleanEdgeOffsetCollapsedEdges(e,n),l=gt(l)},d=this.events.on(`undo`,u);return l=I([this._initializeEdgeOffsetVisualElement(e,a,t,n),s,d,this._connectEdgeOffsetTooltip(e,o,n,()=>{r.execute({action:`cancel`})})]),{initializeStep:e=>o==null||c==null?(u(),null):{...e,operation:o,plane:c},cleanup:u}}_initializeEdgeOffsetVisualElement(e,t,n,r){let i=()=>new c({paths:[[e.handle.leftVertex.pos,e.handle.rightVertex.pos]],spatialReference:r.data.spatialReference}),a=new Rs({view:this.view,isDraped:t.isDraped,geometry:i(),elevationInfo:n,width:this._settings.visualElements.lineObjects.outline.width,attached:!1,isDecoration:!0}),o=I([S(()=>({color:this._accentColor,draped:t.isDraped}),({color:e,draped:t})=>{a.color=z(e),a.isDraped=t},Tt),t.on(`committed`,()=>{a.geometry=i()}),k(a)]);return a.attached=!0,o}_applyEdgeOffsetStep(e){return t=>(this.destroyed||t.operation==null||!this._operations||(this._updateEventState(2),t.signedDistance==null?this._resetTooltip():((t.mapDeltaX||t.mapDeltaY||t.mapDeltaZ)&&(this._offsetEdge(e,t.operation,t.signedDistance),this.events.emit(`reshape`,{type:`reshape`,object:this.object})),this._updateEdgeOffsetTooltip(t))),t)}_cleanEdgeOffsetCollapsedEdges(e,t){let n=e.handle.leftVertex.leftSegment?.leftVertex,r=e.handle.leftVertex,i=e.handle.rightVertex.rightSegment?.rightVertex,a=e.handle.rightVertex,o=t.data.coordinateHelper,s=this.view.pixelSizeAt(o.vectorToDehydratedPoint(r.pos),o.spatialReference),c=[];if(n&&o.distance(n.pos,r.pos)<Ou){let e=this._getManipulatorInfoFromHandle(r);e!=null&&c.push(e)}if(o.distance(r.pos,a.pos)<s||i&&o.distance(i.pos,a.pos)<Ou){let e=this._getManipulatorInfoFromHandle(a);e!=null&&c.push(e)}c.length&&this._removeVertices(c)}_enterInputModeDuringEdgeOffset(e){let t=this._findActiveEdgeOffsetManipulatorInfo();return!!t&&!!oi(e,this.tooltip)&&(t.manipulator.dragging?(this._pendingEdgeOffsetInfo={manipulatorInfo:t,mode:`drag`},!0):(this._clearSelection(),this._pendingEdgeOffsetInfo={manipulatorInfo:t,mode:`hover`},this._connectEdgeOffsetTooltipOnHover(t),!0))}_exitEdgeOffsetInputMode(){this.tooltip&&(this._pendingEdgeOffsetInfo=null,this._resetTooltip(),this.tooltip.exitInputMode())}_findActiveEdgeOffsetManipulatorInfo(){return this._manipulatorInfos.filter(Tu).find(({manipulator:e})=>e.hovering||e.grabbing||e.dragging)}_connectEdgeOffsetTooltipOnHover(e){let{_operations:t,object:n}=this;if(!t)return;let{elevationInfo:r}=n,i=eu(t.data.coordinateHelper,e.handle,r);this._selectEdgeOffsetArrow(e,i),this.addHandles([this._initializeEdgeOffsetVisualElement(e,n,r,t),this._connectEdgeOffsetTooltip(e,i,t,()=>{this.removeHandles(i),this._exitEdgeOffsetInputMode()})],i)}_splitEdgesBeforeEdgeOffset(e,t){if(t.requiresSplitEdgeLeft){let t=this._getManipulatorInfoFromHandle(e.handle.leftVertex.leftSegment);t!=null&&this._splitEdgeManipulator(t,1)}if(t.requiresSplitEdgeRight){let t=this._getManipulatorInfoFromHandle(e.handle.rightVertex.rightSegment);t!=null&&this._splitEdgeManipulator(t,0)}}_selectEdgeOffsetArrow(e,t){let n=e.grabMapPoint??au(this.view.inputManager?.latestPointerInfo?.location,this.view,this.object,e);n&&t.selectArrowFromStartPoint(n)}_connectEdgeOffsetTooltip(e,t,n,r){let i=()=>this.tooltipInfos.edgeOffset.distance.actual,a=i=>{r(),queueMicrotask(()=>{this.view.focus();let r=n.createUndoGroup();this._tooltipCallbacks.onReshapeStart?.(),this._splitEdgesBeforeEdgeOffset(e,t),this._offsetEdge(e,t,ou(i,e.manipulator.location,t,n)),this._tooltipCallbacks.onReshape?.(),this._tooltipCallbacks.onReshapeStop?.(),this._cleanEdgeOffsetCollapsedEdges(e,n),r.remove()})},o=()=>{let e=i();e==null?r():a(e)};return I([je(()=>this.tooltip&&!this.tooltip.focused,()=>o(),Pe),this.tooltip.on(`discard`,r),this.tooltip.on(`commit`,e=>{e.type===`commit-and-exit`&&o()})])}_createVertexOrEdgeManipulator(e,t=this.object.elevationInfo,n=!1){let r=this.view,i=this._operations,a=this._settings;if(!i)return null;let o=i.data.type,s=i.data.spatialReference;if(e.type===`line`){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(e,t);if(!this.enableMidpoints)return null}if(this._vertexManipulatorGeometry==null||this._vertexManipulatorOutlineGeometry==null){let{size:e,outlineSize:t}=Su(a.manipulators.vertex);this._vertexManipulatorGeometry=Va(this._vertexManipulatorMaterial,e,16,16),this._vertexManipulatorOutlineGeometry=Va(this._vertexManipulatorOutlineMaterial,t,16,16)}if(this._edgeManipulatorGeometry==null||this._edgeManipulatorOutlineGeometry==null){let{size:e,outlineSize:t}=Su(a.manipulators.edge);this._edgeManipulatorGeometry=Va(this._edgeManipulatorMaterial,e,16,16),this._edgeManipulatorOutlineGeometry=Va(this._edgeManipulatorOutlineMaterial,t,16,16)}let c=o===`point`||o===`mesh`?[]:[new K(this._vertexManipulatorGeometry.instantiate(),4|ku),new K(this._vertexManipulatorOutlineGeometry.instantiate(),5|ku),new K(this._vertexManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),6|ku),new K(this._vertexManipulatorGeometry.instantiate({material:this._selectedManipulatorMaterial}),8),new K(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorOutlineMaterial}),9),new K(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorHoverOutlineMaterial}),10)];this.enableMidpoints&&c.push(new K(this._edgeManipulatorGeometry.instantiate({material:this._vertexManipulatorMaterial}),6|Au),new K(this._edgeManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),6|Au),new K(this._edgeManipulatorGeometry.instantiate(),5|Au),new K(this._edgeManipulatorOutlineGeometry.instantiate(),5|Au));let l=new G({view:r,renderObjects:c,elevationInfo:t,focusMultiplier:1,touchMultiplier:1,available:this.object.visible,metadata:{deleting:!1},location:wu(s)});l.selected=n,this._setTypeSpecificManipulatorSettings(l,e,t);let u=e.type===`vertex`?{manipulator:l,handle:e,type:`vertex`,selectedIndex:0}:{manipulator:l,handle:e,locationUpdateHandle:null,type:`edge`,selectedIndex:0};if(this._manipulatorInfos.push(u),this.manipulators.add(l),this._updateManipulatorPosition(u),u.type===`edge`){let e=[];for(let t of[u.handle.leftVertex,u.handle.rightVertex]){let n=this._getManipulatorInfoFromHandle(t);n!=null&&e.push(n.manipulator.events.on(`location-update`,()=>this._updateManipulatorPosition(u)))}u.locationUpdateHandle=I(e),this._manipulatorHandles.add(u.locationUpdateHandle,l)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(l,!0),l);let d=Xr(l,(e,n,a,o)=>{let c=null,{snappingStep:l,cancelSnapping:d}=Ir({predicate:()=>!this._isMultiVertexSelection(),snappingManager:this.tool.snappingManager,snappingContext:new Ar({editGeometryOperations:i,elevationInfo:t,pointer:o,excludeFeature:this.object.graphic,visualizer:new vs}),updatingHandles:this._updatingHandles,useZ:!1});a=a.next(t=>(this._onDragCancel(!e.metadata.deleting,()=>c=gt(c)),t)).next(d);let{elevationAlignedLocation:f}=e,p=this.object.graphic??void 0;n.next(e=>this._trackNumDragging(e)).next(e=>{if(e.action===`start`&&i&&(c=i.createUndoGroup()),u.type===`edge`){let t=this._splitEdgeManipulator(u);return{...e,info:t,snapOrigin:t.handle.pos}}return{...e,info:u,snapOrigin:u.handle.pos}}).next(Rr(r,f)).next(fl(r,f,t,s,p)).next(Ur(r,t,p)).next(...l).next(Qr()).next(e=>{this._perVertexManipulatorDragAction(e),e.action===`end`&&(c=gt(c)),this._resetTooltip()})});return this._manipulatorHandles.add([d,l.events.on(`immediate-click`,e=>this._manipulatorClickCallback(e,u)),l.events.on(`select-changed`,()=>{u.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition(),this._resetTooltip()}),l.events.on(`focus-changed`,()=>{this._resetTooltip()})],l),this.events.emit(`manipulators-changed`),u}_trackNumDragging(e){switch(e.action){case`start`:this._numDragging++;break;case`end`:this._numDragging--}return e}_onDragCancel(e=!0,t){switch(this._numDragging--,e&&this.undo(),this.tool.snappingManager?.doneSnapping(),this._resetTooltip(),this._reshapeEventState){case 0:break;case 1:this.events.emit(`move`,{type:`move`,dx:0,dy:0,object:this.object});break;case 2:this.events.emit(`reshape`,{type:`reshape`,object:this.object})}t?.(),this.destroyed||this._updateEventState(0)}_setTypeSpecificManipulatorSettings(e,t,n){let r=this._settings;switch(t.type){case`vertex`:{e.state=ku,e.selectable=!0,e.cursor=`move`,e.collisionPriority=2;let{size:t,collisionPadding:i}=r.manipulators.vertex;e.radius=t/2+i,e.elevationInfo=n;let a=this._operations?.data.type;e.interactive=a!=null&&a!==`point`&&a!==`mesh`;break}case`line`:{e.state=Au,e.selectable=!1,e.cursor=`copy`,e.collisionPriority=-1;let{size:t,collisionPadding:i}=r.manipulators.edge;e.radius=t/2+i,e.elevationInfo=n.mode!==`on-the-ground`||Kn(this.object.graphic?.symbol)?{mode:`absolute-height`,offset:0}:n;break}}}_watchAndUpdateGrabState(e,t){return e.events.on(`grab-changed`,n=>{this._onGrabStateChanged(e,t,n.action,n.pointerType)})}_onGrabStateChanged(e,t,n,r=`mouse`){if(!this._recreatingManipulators){if(n===`start`)t&&this._updateSelection(e),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(0),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing,(r!==`touch`||this.enableEdgeOffset)&&(this._manipulatorInfos.forEach(e=>{let{manipulator:t}=e,n=this._operations?.data.type;t.interactive=t.grabbing||!this._numGrabbing&&n!=null&&n!==`point`&&n!==`mesh`,Tu(e)&&(e.edgeManipulator.interactive=e.edgeManipulator.grabbing||!this._numGrabbing)}),this._objectMoveManipulation.forEachManipulator(e=>{e.interactive=e.grabbing||!this._numGrabbing}))}}_clearSelection(){for(let e of this._manipulatorInfos)e.manipulator.grabbing||(e.manipulator.selected=!1);this._pendingEdgeOffsetInfo=null}_updateSelection(e){e.grabbing&&!e.selected&&e.selectable&&(this._clearSelection(),e.selected=!0,this.events.emit(`manipulators-changed`))}_removeManipulator(e){e!=null&&(e.manipulator.metadata.deleting=!0,this.manipulators.remove(e.manipulator),this._manipulatorHandles.remove(e.manipulator),nt(this._manipulatorInfos,e),this.events.emit(`manipulators-changed`),this._resetTooltip())}_getManipulatorInfoFromHandle(e){return this._manipulatorInfos.find(t=>t.handle===e)}_updateManipulatorPositions(e){for(let t of e)this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(t))}_updateManipulatorPosition(e){let t=this._operations;if(e!=null&&t){if(e.type===`vertex`)e.manipulator.location=t.data.coordinateHelper.vectorToDehydratedPoint(e.handle.pos,Eu),e.manipulator.grabbing&&this._vertexLaserLineVisualElement!=null&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=e.manipulator.renderLocation);else if(e.type===`edge`){let n=this._getManipulatorInfoFromHandle(e.handle.leftVertex),r=this._getManipulatorInfoFromHandle(e.handle.rightVertex);if(n==null||r==null)return;let i=n.manipulator,a=r.manipulator;if(e.manipulator.elevationInfo?.mode===`on-the-ground`){let n=i.location,r=a.location,o=.5,s=n.x+o*(r.x-n.x),c=n.y+o*(r.y-n.y),l=n.hasZ&&r.hasZ?0:void 0;e.manipulator.location=pn(s,c,l,t.data.spatialReference)}else de(Du,i.renderLocation,a.renderLocation,.5),e.manipulator.renderLocation=Du}}}_splitEdgeManipulator(e,t=.5){let n=this._operations,r=n.splitSegment(e.handle,t).createdVertex;e.locationUpdateHandle=gt(e.locationUpdateHandle);let i=this.object.elevationInfo,a;this.enableEdgeOffset?(this._removeManipulator(e),a=this._createVertexOrEdgeManipulator(r)):(a=e,a.handle=r,a.type=`vertex`,this._setTypeSpecificManipulatorSettings(e.manipulator,e.handle,i)),r.leftSegment&&r.leftSegment.type===`line`&&this._createVertexOrEdgeManipulator(r.leftSegment),r.rightSegment&&r.rightSegment.type===`line`&&this._createVertexOrEdgeManipulator(r.rightSegment),this._updateManipulatorPosition(a),this.enableEdgeOffset||this._resetTooltip(),this._updateSelection(e.manipulator);let o=this._updateEventState(2),s=n.data.coordinateHelper.vectorToArray(a.handle.pos),c=n.data.parts.indexOf(r.part);return this.events.emit(`vertex-add`,{type:`vertex-add`,object:this.object,vertices:[{coordinates:s,componentIndex:c,vertexIndex:r.index}],added:s}),o&&this._updateEventState(0),a}_updateMoveManipulationPosition(){let e=t(Du,0,0,0),n=0,r=!1,i=null,a=null;for(let t of this._manipulatorInfos)t.type===`vertex`&&(t.manipulator.selected?(n++,A(e,e,t.manipulator.renderLocation),i==null||t.selectedIndex>i.selectedIndex?(a=i,i=t):(a==null||t.selectedIndex>a.selectedIndex)&&(a=t)):r=!0);let o=this.object,s=this._operations?.data.geometry;if(n===0){let e=o.visible&&this.enableMoveObject;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e,this._moveManipulation.zManipulation.available=e&&this.enableZShape&&oc(this._operations,o.elevationInfo),this._moveManipulation.angle=ac(s),this._moveManipulation.radius=Vl.radiusForSymbol(o.graphic?.symbol)}else{let e=o.visible;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.zManipulation.available=e&&this.enableZVertex&&oc(this._operations,this.object.elevationInfo),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e&&n!==1;let t=0;if(i!=null){let e=i.handle.pos,n=a==null?i.handle.leftSegment?.leftVertex?i.handle.leftSegment.leftVertex.pos:null:a.handle.pos,r=a==null&&i.handle.rightSegment?.rightVertex?i.handle.rightSegment.rightVertex.pos:null;n&&r?this._moveManipulation.xyAxisManipulation.available=!1:n?t=Cu(n,e):r&&(t=Cu(e,r))}this._moveManipulation.angle=t,this._moveManipulation.radius=el}n!==0&&r?(x(e,e,1/n),Eu.spatialReference=this._operations.data.spatialReference,Eu.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(e,Eu),this._moveManipulation.elevationAlignedLocation=Eu):this._outlineVisualElement==null||this.object.isDraped||this._outlineVisualElement.attachmentOrigin==null?Nl(this._moveManipulation,this.object):this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin}_removeVertices(e){let t=[],n=this._operations;if(n){for(let r of e){let e=r.handle.part;if(r.type===`vertex`&&n.canRemoveVertex(e)){t.push(r.handle),this._removeManipulator(r),this._removeManipulator(this._getManipulatorInfoFromHandle(r.handle.leftSegment)),this._removeManipulator(this._getManipulatorInfoFromHandle(r.handle.rightSegment));let i=n.removeVertices([r.handle]).removedVertices?.[0].createdSegment;i&&i.type===`line`?this._createVertexOrEdgeManipulator(i):this.enableEdgeOffset&&e.vertices.length<=2&&this._removeManipulator(this._getManipulatorInfoFromHandle(e.segments[0]))}}if(t.length>0){let e=t.map(e=>{let t=n.data.parts.indexOf(e.part);return{coordinates:n.data.coordinateHelper.vectorToArray(e.pos),componentIndex:t,vertexIndex:e.index}}),r=this._updateEventState(2);if(this.destroyed||(this.events.emit(`vertex-remove`,{type:`vertex-remove`,object:this.object,removed:e.map(e=>e.coordinates),vertices:e}),this.destroyed)||r&&(this._updateEventState(0),this.destroyed))return;this._updateMoveManipulationPosition()}}}_moveVertices(e,t,n=t.action===`start`?0:1){let r=this._operations;if(r){e.length>0&&r.moveVertices(e.map(e=>e.handle),t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,n);for(let t of e)this._updateManipulatorPosition(t)}}_offsetEdge(e,t,n){if(!this._operations)return;let r=t.clone();r.distance=n,this._operations.updateVertices([e.handle.leftVertex,e.handle.rightVertex],r),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.leftVertex)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.rightVertex))}_manipulatorClickCallback(e,t){e.shiftKey||this._clearSelection(),t.type===`vertex`&&(t.manipulator.selected=!t.manipulator.selected,this.enableDeleteVertices&&e.button===yu.Right&&this._removeVertices([t])),t.type===`edge`&&e.button===yu.Left&&this._splitEdgeManipulator(t),e.stopPropagation()}_updateTranslateTooltip(e,t){this._defaultTooltipInfo==null?this._updateTranslateObjectTooltip(e,t):this._resetTooltip()}_updateTranslateObjectTooltip(e,t){this._pendingEdgeOffsetInfo||(this.activeTooltipInfo=gu(e,t,this._tooltipsContext))}_updateEdgeOffsetTooltip(e){this._pendingEdgeOffsetInfo||(this.activeTooltipInfo=vu(this.object,e,this._tooltipsContext))}_resetTooltip(){let e=this.activeTooltipInfo;if(this._pendingEdgeOffsetInfo&&e?.type===`reshape-edge-offset`)return;let t=null;t=this._pendingEdgeOffsetInfo||this._findActiveEdgeOffsetManipulatorInfo()!=null?vu(this.object,null,this._tooltipsContext):this._defaultTooltipInfo,t!==e&&(e!=null&&t!=null&&this.tooltip.mode===`input`||(this.activeTooltipInfo=t))}get _defaultTooltipInfo(){switch(this._operations?.data.type){case`polyline`:case`polygon`:return this._selectedVertexManipulatorInfo?this.tooltipInfos.selectedVertex:null;case`point`:case`mesh`:return this.tooltipInfos.movePoint;default:return null}}get _selectedVertexManipulatorInfo(){let e=this._manipulatorInfos.filter(e=>e.type===`vertex`&&e.manipulator.selected);return e.length===1?e[0]:null}get _tooltipsContext(){let{tooltipInfos:e,activeTooltipInfo:t,automaticAreaMeasurementUtils:n,automaticLengthMeasurementUtils:r}=this;return{sketchOptions:this._sketchOptions,tooltipInfos:e,activeTooltipInfo:t,selectedVertexManipulatorInfo:this._selectedVertexManipulatorInfo,callbacks:this._tooltipCallbacks,automaticAreaMeasurementUtils:n,automaticLengthMeasurementUtils:r}}get test(){}};function xu(){return e=>{let{operation:t,mapEnd:n}=e;return t==null||n==null?e:{...e,signedDistance:t.signedDistanceToPoint(n)}}}function Su(e){let t=e.size/2,n=t+e.collisionPadding;return{size:t/n,outlineSize:(t+e.outlineSize)/n}}function Cu(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI/2}function wu(e){return new o({x:0,y:0,z:0,spatialReference:e})}function Tu(e){return e.type===`edge`&&`edgeManipulator`in e}d([C()],J.prototype,`_numGrabbing`,void 0),d([C()],J.prototype,`_numDragging`,void 0),d([C()],J.prototype,`_pendingEdgeOffsetInfo`,void 0),d([C()],J.prototype,`_operations`,null),d([C()],J.prototype,`_segmentLabels`,void 0),d([C({constructOnly:!0})],J.prototype,`tool`,void 0),d([C()],J.prototype,`tooltip`,void 0),d([C()],J.prototype,`activeTooltipInfo`,void 0),d([C({readOnly:!0})],J.prototype,`updating`,null),d([C()],J.prototype,`manipulators`,null),d([C()],J.prototype,`view`,null),d([C()],J.prototype,`automaticAreaMeasurementUtils`,null),d([C()],J.prototype,`automaticLengthMeasurementUtils`,null),d([C()],J.prototype,`object`,null),d([C()],J.prototype,`enableZShape`,null),d([C()],J.prototype,`enableDeleteVertices`,null),d([C()],J.prototype,`enableZVertex`,null),d([C()],J.prototype,`autoHideManipulators`,null),d([C()],J.prototype,`enableMoveObject`,null),d([C()],J.prototype,`enableMidpoints`,null),d([C()],J.prototype,`enableEdgeOffset`,null),d([C()],J.prototype,`_sketchOptions`,null),d([C()],J.prototype,`_accentColor`,null),d([C()],J.prototype,`_tooltipsContext`,null),J=d([j(`esri.views.3d.interactive.editingTools.reshape.ReshapeOperation`)],J);var Eu=pn(0,0,void 0,Ne.WGS84),Du=b(),Ou=1e-6,ku=16,Au=32,Y=class extends Zr{constructor(e){super(e),this._reshapeOperation=null,this.events=new Rt,this.enableZShape=!0,this.enableZVertex=!0,this.enableMoveObject=!0,this.enableDeleteVertices=!0,this.autoHideManipulators=!1,this.enableMidpoints=!0,this.enableEdgeOffset=!1,this.type=`reshape-3d`,this.sketchOptions=new $n,this.snappingManager=null,this.automaticManipulatorSelection=!1}initialize(){let e=this._reshapeOperation=new J({tool:this});this.addHandles([e.events.on(`reshape`,e=>this.events.emit(`reshape`,e)),e.events.on(`move`,e=>this.events.emit(`move`,e)),e.events.on(`vertex-add`,e=>this.events.emit(`vertex-add`,e)),e.events.on(`vertex-remove`,e=>this.events.emit(`vertex-remove`,e)),e.events.on(`immediate-click`,e=>this.events.emit(`immediate-click`,{...e,object:this.object})),this.view.on(`pointer-down`,[`Shift`],e=>e.stopPropagation())]),this.finishToolCreation()}destroy(){this._reshapeOperation=M(this._reshapeOperation)}get updating(){return((this.object.updating??!1)||this._reshapeOperation?.updating||this.snappingManager?.updating)??!1}get activeTooltipInfo(){return this._reshapeOperation?.activeTooltipInfo??null}get tooltip(){return this._reshapeOperation?.tooltip??null}onManipulatorSelectionChanged(){this._reshapeOperation?.onManipulatorSelectionChanged()}recordUndo(e,t){this._reshapeOperation?.recordUndo({apply:e,undo:t,accumulate:()=>!1})}get canUndo(){return this._reshapeOperation?.canUndo??!1}undo(){this.snappingManager?.doneSnapping(),this._reshapeOperation?.undo()}get canRedo(){return this._reshapeOperation?.canRedo??!1}redo(){this.snappingManager?.doneSnapping(),this._reshapeOperation?.redo()}onInputEvent(e){let t=this._reshapeOperation;t&&!t.enterInputModeIfAvailable(e)&&this.enableDeleteVertices&&e.type===`key-down`&&Pt.delete.includes(e.key)&&t.removeSelectedVertices()>0&&e.stopPropagation()}reset(){}};d([C()],Y.prototype,`_reshapeOperation`,void 0),d([C({constructOnly:!0})],Y.prototype,`view`,void 0),d([C({constructOnly:!0})],Y.prototype,`automaticAreaMeasurementUtils`,void 0),d([C({constructOnly:!0})],Y.prototype,`automaticLengthMeasurementUtils`,void 0),d([C({constructOnly:!0})],Y.prototype,`object`,void 0),d([C()],Y.prototype,`enableZShape`,void 0),d([C()],Y.prototype,`enableZVertex`,void 0),d([C()],Y.prototype,`enableMoveObject`,void 0),d([C()],Y.prototype,`enableDeleteVertices`,void 0),d([C()],Y.prototype,`autoHideManipulators`,void 0),d([C()],Y.prototype,`enableMidpoints`,void 0),d([C()],Y.prototype,`enableEdgeOffset`,void 0),d([C()],Y.prototype,`type`,void 0),d([C({type:$n})],Y.prototype,`sketchOptions`,void 0),d([C()],Y.prototype,`snappingManager`,void 0),d([C()],Y.prototype,`updating`,null),d([C()],Y.prototype,`activeTooltipInfo`,null),d([C()],Y.prototype,`tooltip`,null),d([C()],Y.prototype,`automaticManipulatorSelection`,void 0),Y=d([j(`esri.views.3d.interactive.editingTools.reshape.ReshapeTool3D`)],Y);var ju=class extends me{constructor(e){super(e),this._interactionState=null}initialize(){this.addHandles([je(()=>{let e=this._interactionState;return e&&e.angle!==e.previousAngle?{interactionState:e,angle:e.state.angle}:null},({interactionState:e})=>{this._updateMeshRotation(e)},Pe),je(()=>{let e=this._interactionState;return e&&e.scale!==e.previousScale?{interactionState:e,scale:e.state.scale}:null},({interactionState:e})=>{this._updateMeshSize(e)},Pe)])}get geometry(){let e=W(this.object);return e?.type===`mesh`?e:null}get initialAngle(){return this._interactionState?.initialAngle??0}get angle(){let e=this.geometry?.transform;if(e==null)return this._interactionState?.angle??0;let t=Zt(e.rotation)[2];return Math.abs(t)>.999999?bt(Xt(e.rotation))*Math.sign(t):0}get angleClockwise(){return-this.angle}get relativeAngle(){return this.angle-this.initialAngle}get relativeAngleClockwise(){return-this.relativeAngle}get scale(){return this._interactionState?.scale??1}startInteraction(){let e=new Mu({angle:this.angle});this._interactionState=e;let t=()=>{this._interactionState=null};return{state:e,done:t,cancel:()=>{e.cancel(),t()}}}createUndoRecord(){return this.object.createUndoRecord()}_updateMeshRotation(e){let{geometry:t}=this;if(t==null)return;let{angle:n,previousAngle:r}=e;e.previousAngle=n;let i=ne(n-r);t.rotate(0,0,i)}_updateMeshSize(e){let{geometry:t}=this;if(t==null)return;let{scale:n,previousScale:r}=e;e.previousScale=n;let i=n/r;t.scale(i)}};d([C({constructOnly:!0})],ju.prototype,`object`,void 0),d([C()],ju.prototype,`geometry`,null),d([C({constructOnly:!0})],ju.prototype,`viewingMode`,void 0),d([C()],ju.prototype,`initialAngle`,null),d([C()],ju.prototype,`angle`,null),d([C()],ju.prototype,`angleClockwise`,null),d([C()],ju.prototype,`relativeAngle`,null),d([C()],ju.prototype,`relativeAngleClockwise`,null),d([C()],ju.prototype,`scale`,null),d([C()],ju.prototype,`_interactionState`,void 0),ju=d([j(`esri.views.3d.interactive.editingTools.transform.ScaleRotateMeshAdapter`)],ju);var Mu=class extends me{get state(){let{angle:e,scale:t}=this;return{angle:e,scale:t}}constructor(e){super(e),this.angle=0,this.initialAngle=0,this.previousAngle=0,this.previousScale=1,this.scale=1,this.initialAngle=e.angle,this.previousAngle=e.angle}cancel(){this.angle=this.initialAngle,this.scale=1}};d([C()],Mu.prototype,`angle`,void 0),d([C()],Mu.prototype,`initialAngle`,void 0),d([C()],Mu.prototype,`previousAngle`,void 0),d([C()],Mu.prototype,`previousScale`,void 0),d([C()],Mu.prototype,`scale`,void 0),d([C()],Mu.prototype,`state`,null),Mu=d([j(`esri.views.3d.interactive.editingTools.transform.ScaleRotateMeshAdapter.InteractionState`)],Mu);var X=class extends me{constructor(e){super(e),this.sizeAxis=null,this._interactionState=null}initialize(){this.addHandles(je(()=>this._interactionState==null?null:this._interactionState.state,e=>{this._updateSymbol(e)},Pe))}get initialAngle(){return this._interactionState?.initialAngle??0}get angle(){return this._interactionState==null?this._orientationReferenceSymbolLayer==null?0:Nu(this._orientationReferenceSymbolLayer.heading??0):this._interactionState.angle}get angleClockwise(){return-this.angle}get orientation(){return this.angle}get orientationClockwise(){return this.angleClockwise}get relativeAngle(){return this.angle-this.initialAngle}get relativeAngleClockwise(){return-this.relativeAngle}get scale(){return this._interactionState?.scale??1}get size(){let e=this._sizeReferenceSymbolLayer;if(e==null)return null;let t=this.findLayerView(),n=this._graphicSymbol;if(t==null||n==null||n.type!==`point-3d`)return null;let r=t.getSymbolLayerSize(n,e);if(`size`in r&&r.size!=null)return r.size;let i=this.sizeAxis;return!(`width`in r)||r.width==null||i!=null&&i!==`width`&&i!==`all`&&i!==`width-and-depth`?!(`depth`in r)||e.depth==null||i!=null&&i!==`depth`&&i!==`all`&&i!==`width-and-depth`?!(`height`in r)||e.height==null||i!=null&&i!==`height`&&i!==`all`?null:r.height:r.depth:r.width}get _sizeReferenceSymbolLayer(){let e=this._graphicSymbol;return e==null||e.symbolLayers.length===0?null:e.symbolLayers.find(e=>e.type===`object`)}get _orientationReferenceSymbolLayer(){let e=this._graphicSymbol;return e==null||e.symbolLayers.length===0?null:e.symbolLayers.find(e=>e.type===`object`&&e.heading!=null)}get _graphicSymbol(){return this.graphic?.symbol!=null&&this.graphic.symbol.type===`point-3d`?this.graphic.symbol:null}set _graphicSymbol(e){this.graphic.symbol=e}startInteraction(){let e=this._graphicSymbol,t=this.findLayerView();if(this._interactionState!=null||e==null||t==null)return Pu;let n=e.symbolLayers.map(n=>n.type===`object`?t.getSymbolLayerSize(e,n):null).toArray(),r=e.clone(),i=this.angle,a=new Fu({originalSymbol:r,angle:i,initialSizes:n});this._interactionState=a;let o=()=>{this._interactionState=null};return{state:a,done:o,cancel:()=>{this._graphicSymbol=r,o()}}}createUndoRecord(){let e=this.graphic.symbol,t=null;return{undo:n=>{t=n.symbol,n.symbol=e},redo:n=>{e=n.symbol,n.symbol=t}}}_updateSymbol({scale:e,angle:t,originalSymbol:n,initialSizes:r}){let i=this._graphicSymbol;if(i==null||i.type!==`point-3d`)return;let a=i.clone(),o=-ne(t-this.initialAngle),s=!1;this._forEachObjectSymbolLayerPair(n,a,(t,n,i)=>{let a=(t.heading??0)+o;n.heading!==a&&(n.heading=a,s=!0);let c=r[i];if(c!=null&&`width`in c){c.width=this.sizeFilter(c.width),c.height=this.sizeFilter(c.height),c.depth=this.sizeFilter(c.depth);let t=c.width*e;n.width!==t&&(n.width=t,s=!0);let r=c.depth*e;n.depth!==r&&(n.depth=r,s=!0);let i=c.height*e;n.height!==i&&(n.height=i,s=!0)}}),s&&(this._graphicSymbol=a)}_forEachObjectSymbolLayerPair(e,t,n){e.symbolLayers.forEach((e,r)=>{let i=t.symbolLayers.at(r);e.type===`object`&&i.type===`object`&&n(e,i,r)})}};function Nu(e){return-bt(e)}d([C()],X.prototype,`initialAngle`,null),d([C()],X.prototype,`angle`,null),d([C()],X.prototype,`angleClockwise`,null),d([C()],X.prototype,`orientation`,null),d([C()],X.prototype,`orientationClockwise`,null),d([C()],X.prototype,`relativeAngle`,null),d([C()],X.prototype,`relativeAngleClockwise`,null),d([C()],X.prototype,`scale`,null),d([C()],X.prototype,`size`,null),d([C()],X.prototype,`sizeAxis`,void 0),d([C({constructOnly:!0})],X.prototype,`graphic`,void 0),d([C()],X.prototype,`_interactionState`,void 0),d([C({constructOnly:!0})],X.prototype,`findLayerView`,void 0),d([C({constructOnly:!0})],X.prototype,`sizeFilter`,void 0),d([C()],X.prototype,`_sizeReferenceSymbolLayer`,null),d([C()],X.prototype,`_orientationReferenceSymbolLayer`,null),d([C()],X.prototype,`_graphicSymbol`,null),X=d([j(`esri.views.3d.interactive.editingTools.transform.ScaleRotateObjectSymbol3DAdapter`)],X);var Pu={state:{angle:0,scale:0},done:()=>{},cancel:()=>{}},Fu=class extends me{get state(){let{originalSymbol:e,angle:t,initialAngle:n,scale:r,initialSizes:i}=this;return{originalSymbol:e,angle:t,initialAngle:n,scale:r,initialSizes:i}}constructor(e){super(e),this.angle=0,this.initialAngle=0,this.scale=1,this.initialAngle=e.angle}};d([C()],Fu.prototype,`originalSymbol`,void 0),d([C()],Fu.prototype,`angle`,void 0),d([C()],Fu.prototype,`initialAngle`,void 0),d([C()],Fu.prototype,`initialSizes`,void 0),d([C()],Fu.prototype,`scale`,void 0),d([C()],Fu.prototype,`state`,null),Fu=d([j(`esri.views.3d.interactive.editingTools.transform.ScaleRotateObjectSymbol3DAdapter.InteractionState`)],Fu);var Z={ScaleIn:32,ScaleOut:64,RotateLeft:128,RotateRight:256,Unlocked:1024,DelayedFocused:2048},Iu=class extends me{get angle(){return this.adapter.angle}get scale(){return this.adapter.scale}set location(e){this._ringManipulator.location=e}set elevationAlignedLocation(e){this._ringManipulator.elevationAlignedLocation=e}get grabbing(){return this._ringManipulator.grabbing}set interactive(e){this._ringManipulator.interactive=e}get updating(){return!!this._activeAnimation}constructor(e){super(e),this.mode=null,this._scaleRotateDragData=null,this._activeAnimation=null,this._ringIndicatorDelayMs=200,this.events=new Rt,this.getFocused=()=>this._ringManipulator.focused,this.getScale=()=>this._scaleRotateDragData?.mode===`scale`?this.adapter.scale:1}initialize(){this._createManipulator(),this._updateDragState(),this._updateManipulatorTransform(),this.addHandles([S(()=>{let{adapter:e}=this;return[e.angle,e.scale]},()=>this._updateManipulatorTransform())])}destroy(){this._activeAnimation?.frameTask.remove(),this._activeAnimation=null,this.tool.manipulators.remove(this._ringManipulator),this._ringManipulator=null}startAnimation(e){this.cancelActiveAnimation(),e.start();let t=Ve({update:({deltaTime:t})=>{e.update(t)&&this.cancelActiveAnimation()}});this._activeAnimation={...e,frameTask:t}}cancelActiveAnimation(){this._activeAnimation?.frameTask.remove(),this._activeAnimation=M(this._activeAnimation)}forEachManipulator(e){e(this._ringManipulator,4)}_createManipulator(){let e=this._createRingManipulator();this._ringManipulator=e,this.tool.manipulators.add(e);let t=this.tool.object,n=Xr(e,(e,n,r)=>{this._scaleRotateDragData=null;let i=this.adapter.startInteraction(),a={mode:`none`,origin:xe(e.renderLocation),initialAngle:this.adapter.angle,angle:0,angleDir:0,scaleDir:0};this._scaleRotateDragData=a,this._updateDragState();let o=R.get();this.tool.view.renderCoordsHelper.worldUpAtPosition(e.renderLocation,o),n.next(cl(this.tool.view,on(e.renderLocation,o,sn()))).next(e=>{let n=rn(e.plane),r=Al(e.renderStart,e.renderEnd,a.origin,n),o=st.shortestSignedDiff(a.angle,r);a.angleDir=qe(a.angleDir+o,-.3,al),a.angle=r;let s=Lu(a,e),c=s-this.adapter.scale;if(a.scaleDir=qe(a.scaleDir+c,-.2,.2),this._onScaleChanged(),a.mode===`none`){let n=this.mode||Ru(e,e.plane,a.origin,this.tool.view.state.camera);if(n!=null){switch(n){case`rotate`:this.tool.events.emit(`rotate-start`,{object:t,angle:0}),this.tool.events.emit(`record-undo`,{updates:[this.adapter.createUndoRecord()]});break;case`scale`:this.tool.events.emit(`scale-start`,{object:t,xScale:1,yScale:1}),this.tool.events.emit(`record-undo`,{updates:[this.adapter.createUndoRecord()]})}a.mode=n}}switch(a.mode){case`rotate`:i.state.angle=a.initialAngle+r;break;case`scale`:i.state.scale=s,this._onScaleChanged()}switch(this._updateDragState(),this._updateManipulatorTransform(),e.action){case`start`:case`update`:switch(a.mode){case`rotate`:this.tool.events.emit(`rotate`,{object:t,angle:ne(a.angle)});break;case`scale`:this.tool.events.emit(`scale`,{object:t,xScale:s,yScale:s})}break;case`end`:switch(a.mode){case`rotate`:this.tool.events.emit(`rotate-stop`,{object:t,angle:ne(a.angle)});break;case`scale`:this.tool.events.emit(`scale-stop`,{object:t,xScale:s,yScale:s})}}return e.action===`end`&&(this.startAnimation(Bu(this,()=>this._onScaleChanged())),this._scaleRotateDragData=null,this._updateDragState(),i.done()),e}),r.next(()=>{if(i.cancel(),this._scaleRotateDragData!=null){switch(this._scaleRotateDragData.mode){case`none`:break;case`rotate`:this.tool.events.emit(`rotate-stop`,{object:t,angle:0});break;case`scale`:this.tool.events.emit(`scale-stop`,{object:t,xScale:1,yScale:1})}this.startAnimation(Bu(this,()=>this._onScaleChanged())),this._scaleRotateDragData=null,this._updateDragState()}})});this.addHandles([n,e.events.on(`focus-changed`,e=>{e.action===`focus`?this.startAnimation(Vu(this,()=>this._updateDelayedFocusedState(),{delayMs:this._ringIndicatorDelayMs})):this._updateDelayedFocusedState()}),e.events.on(`immediate-click`,e=>{e.stopPropagation()}),S(()=>this.tool.object.visible,e=>this._ringManipulator.available=e,T)])}_onScaleChanged(){this.events.emit(`scale-changed`),this._updateManipulatorTransform()}_updateDelayedFocusedState(){this._ringManipulator.updateStateEnabled(Z.DelayedFocused,this.getFocused())}_updateDragState(){if(this._ringManipulator.updateStateEnabled(Z.Unlocked,!(this._scaleRotateDragData!=null&&this._scaleRotateDragData?.mode!==`none`)),this._scaleRotateDragData!=null)switch(this._scaleRotateDragData.mode){case`rotate`:this._ringManipulator.updateStateEnabled(Z.ScaleIn|Z.ScaleOut,!1),this._ringManipulator.updateStateEnabled(Z.RotateLeft,this._scaleRotateDragData.angleDir<0),this._ringManipulator.updateStateEnabled(Z.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case`scale`:this._ringManipulator.updateStateEnabled(Z.RotateLeft|Z.RotateRight,!1),this._ringManipulator.updateStateEnabled(Z.ScaleIn,this._scaleRotateDragData.scaleDir<0),this._ringManipulator.updateStateEnabled(Z.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this._ringManipulator.updateStateEnabled(Z.ScaleIn|Z.ScaleOut|Z.RotateLeft|Z.RotateRight,!1)}_updateManipulatorTransform(){let e=l(L.get(),this.adapter.angle,O(0,0,1));if(e==null)return;let n=this.getScale(),r=mt(L.get(),t(R.get(),n,n,n));this._ringManipulator.modelTransform=ge(L.get(),r,e)}_createRingManipulator(){let e=(e,t,n)=>{let r=[],i=Math.ceil(128*(t-e)/(2*Math.PI));for(let a=0;a<i+1;a++){let o=e+a*(t-e)/i;r.push(O(n*Math.cos(o),n*Math.sin(o),0))}return r},t=t=>e(0,2*Math.PI,t),n=e=>[[-e/2,0],[e/2,0],[e/2,tl/2],[-e/2,tl/2]],r=this._createMaterial(1),i=(e,t,i=r)=>Pa(i,n(t),e,[],[],!1),a=t(160),o=i(a,24),s={left:[],right:[]},c=[];for(let t=0;t<2;t++){let n=t*Math.PI-Math.PI/4,a=Math.PI/2-nl,o=n+a,l=n+Math.PI/2-a,u=e(o,l,190),d=i(u,9);c.push(u),c.push(e(o,l,213-24/2)),s.left.push(d),s.right.push(d.instantiate());for(let e=0;e<2;e++){let t=e===0,n=N();if(t){lt(n,n,[1,-1,1]),m(n,n,-o,[0,0,1]);let e=Math.round(il*(u.length-1));n[12]=u[e][0],n[13]=u[e][1],n[14]=u[e][2]}else{m(n,n,l,[0,0,1]);let e=Math.round((1-il)*(u.length-1));n[12]=u[e][0],n[13]=u[e][1],n[14]=u[e][2]}let i=Ia(r,60,0,23,tl);ja(i,n),(t?s.left:s.right).push(i)}}let l=[];for(let t=0;t<2;t++){let n=t*Math.PI-Math.PI/4,r=Math.PI/2-rl,a=n+r,o=n+Math.PI/2-r,s=e(a,o,213);l.push(i(s,9))}let u=this._createMaterial(.66),d=this._createMaterial(.5),f=this._createMaterial(.33),p=t(190),h=t(213),g=i(p,9,u),_=i(h,9,f),v=t(130),ee=t(107),te=i(v,9,u),ne=i(ee,9,f),re=[new K(o,Z.DelayedFocused),new K(o.instantiate({material:d}),0)];this.mode&&this.mode!==`scale`||(re=re.concat([...l.map(e=>new K(e,Z.DelayedFocused|Z.Unlocked)),new K(g,Z.DelayedFocused|Z.ScaleIn),new K(_,Z.DelayedFocused|Z.ScaleIn),new K(te,Z.DelayedFocused|Z.ScaleOut),new K(ne,Z.DelayedFocused|Z.ScaleOut)])),this.mode&&this.mode!==`rotate`||(re=re.concat([...s.right.map(e=>new K(e.instantiate(),Z.DelayedFocused|Z.Unlocked)),...s.left.map(e=>new K(e,Z.DelayedFocused|Z.RotateLeft)),...s.right.map(e=>new K(e,Z.DelayedFocused|Z.RotateRight))]));let y=[a,...c];return new G({view:this.tool.view,renderObjects:re,autoScaleRenderObjects:!1,worldOriented:!0,radius:24,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:this.tool.object.elevationInfo,collisionType:{type:`ribbon`,paths:y,direction:O(0,0,1)}})}_createMaterial(e){let t=new ya({cullFace:2,renderOccluded:2,isDecoration:!0});return this.addHandles(S(()=>Gn(this.tool.view.effectiveTheme.accentColor,e),e=>t.setParameters({color:e}),T)),t}get test(){}};function Lu(e,t){let n=E(R.get(),t.renderStart,e.origin),r=E(R.get(),t.renderEnd,e.origin),i=yt(n),a=yt(r);return i===0?0:a/i}function Ru(e,t,n,r){let{renderStart:i,renderEnd:a}=e,o=zu(i,r,R.get()),s=zu(a,r,R.get());if(Ye(o,s)<100)return null;let c=E(R.get(),i,n),l=Me(R.get(),c,rn(t)),u=i,d=A(R.get(),u,l),f=zu(n,r,R.get()),p=o,m=zu(d,r,R.get()),h=E(R.get(),m,p),g=E(R.get(),o,f),_=_n(p,h),v=_n(f,g);return gn(_,s)<gn(v,s)?`rotate`:`scale`}function zu(e,n,r){return n.projectToScreen(e,Hu),t(r,Hu[0],Hu[1],0)}function Bu(e,t){let n=null,r=1,i=()=>r;return{start:()=>{r=e.getScale(),n=e.getScale,e.getScale=i,t()},update:e=>(r+=((r+1)/2-r)*Math.min(e*3,1),t(),Math.abs(r-1)<.01?1:0),destroy:()=>{n&&(e.getScale=n),t()}}}function Vu(e,t,n){let r=0,i=null,a=()=>!1;return{start:()=>{i=e.getFocused,e.getFocused=a,r=0,t()},update:e=>(r+=e,!i?.()||r>=n.delayMs?1:0),destroy:()=>{i&&(e.getFocused=i),t()}}}d([C({constructOnly:!0})],Iu.prototype,`tool`,void 0),d([C({constructOnly:!0})],Iu.prototype,`adapter`,void 0),d([C({constructOnly:!0})],Iu.prototype,`sketchOptions`,void 0),d([C()],Iu.prototype,`mode`,void 0),d([C()],Iu.prototype,`_activeAnimation`,void 0),d([C()],Iu.prototype,`updating`,null),Iu=d([j(`esri.views.3d.interactive.editingTools.transform.ScaleRotateTransform`)],Iu);var Hu=ce(),Uu=class extends wr(ri){constructor(e){super(e),this.type=`transform-mesh`,this.orientation=Or(),this.scale=xr(),this.allFields.forEach(e=>{e.lockable=!1,e.setActual(null)})}get key(){return{longitude:this.longitude.actual,latitude:this.latitude.actual,x:this.x.actual,y:this.y.actual,elevation:this.elevation.actual,geographic:this.geographic,orientation:this.orientation.actual,scale:this.scale.actual}}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};d([C()],Uu.prototype,`key`,null),d([C()],Uu.prototype,`allFields`,null),Uu=d([j(`esri.views.interactive.tooltip.infos.TransformMeshTooltipInfo`)],Uu);var Wu=class extends wr(ri){constructor(e){super(e),this.type=`transform-point`,this.orientation=Or({readOnly:!0}),this.size=jr({readOnly:!0}),this.allFields.forEach(e=>{e.lockable=!1,e.setActual(null)})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.size]}};d([C()],Wu.prototype,`allFields`,null),Wu=d([j(`esri.views.interactive.tooltip.infos.TransformPointTooltipInfo`)],Wu);var Q=class extends Zr{constructor(e){super(e),this.events=new Rt,this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.sketchOptions=new $n,this.type=`transform-3d`,this._updatingHandles=new i,this._scaleRotate=null}initialize(){let{events:e,object:t,view:n}=this;this.tooltip=ii(()=>({view:n,options:this.sketchOptions.tooltips})),this._moveManipulation=new Vl({tool:this,view:n,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&oc(t.operations,t.elevationInfo),radius:Vl.radiusForSymbol(t.graphic?.symbol)}),this._moveManipulation.forEachManipulator(t=>this.addHandles(t.events.on(`immediate-click`,t=>{e.emit(`immediate-click`,{...t,object:this.object}),t.stopPropagation()})));let r=t.elevationInfo;if(this._moveManipulation.elevationInfo=r,this.addHandles(ws(t)),this._moveManipulation.createManipulatedObjectDragPipeline((e,i,a,s,c)=>{if(e===0){let{snappingStep:e,cancelSnapping:i}=Ir({snappingContext:new Ar({elevationInfo:r,pointer:c,editGeometryOperations:kr.fromGeometry(new o({spatialReference:t.operations?.data.spatialReference}),n.state.viewingMode),visualizer:new vs,excludeFeature:t.graphic}),snappingManager:this.snappingManager,updatingHandles:this._updatingHandles,useZ:!1});s=s.next(i),a=a.next($r(this.view,r)).next(...e)}return{steps:a,cancel:s}},t,t=>{let{action:n,object:r,dxScreen:i,dyScreen:a}=t,o={object:r,dxScreen:i,dyScreen:a};switch(n){case`start`:this._emitRecordUndo(),e.emit(`translate-start`,o);break;case`update`:e.emit(`translate`,o);break;case`end`:e.emit(`translate-stop`,o)}}),this._moveManipulation.angle=this._scaleRotate==null?0:this._scaleRotate.angle,this._scaleRotateAdapter=this._createScaleRotateAdapter(),this.addHandles(S(()=>this._scaleRotateAdapter.angle,()=>this._updateMoveAngle())),this.enableScaling||this.enableRotation){let e=this.enableScaling&&this.enableRotation?null:this.enableScaling?`scale`:`rotate`;this._scaleRotate=new Iu({tool:this,mode:e,adapter:this._scaleRotateAdapter,sketchOptions:this.sketchOptions}),this.addHandles(this._scaleRotate.events.on(`scale-changed`,()=>this._onScaleChanged()))}this.addHandles([Qc({view:this.view,object:t,forEachManipulator:e=>this._forEachManipulator(e),onManipulatorsChanged:()=>F()}),t.on(`committed`,()=>this._onGeometryChanged()),this._hideManipulatorsForObjectState(),S(()=>n.scale,()=>this._updateMoveAngle())].filter(_t)),this._onGeometryChanged(),this._updateMoveAngle(),this._forEachManipulator(e=>{e instanceof G&&this.addHandles(e.events.on(`grab-changed`,()=>this._updateManipulatorsInteractive()))});let i=n?.type,{sketchOptions:a}=this;this._meshTooltipInfo=new Uu({viewType:i,sketchOptions:a}),this._pointTooltipInfo=new Wu({viewType:i,sketchOptions:a});let s={object:t,dxScreen:0,dyScreen:0},c={onBeforeUpdate:()=>this.endDrag(),onMoveStart:()=>{this._emitRecordUndo(),e.emit(`translate-start`,{...s})},onMove:()=>e.emit(`translate`,{...s}),onMoveStop:()=>e.emit(`translate-stop`,{...s}),onRotateStart:n=>{this._emitRecordUndo(),e.emit(`rotate-start`,{object:t,angle:n})},onRotate:n=>e.emit(`rotate`,{object:t,angle:n}),onRotateStop:n=>e.emit(`rotate-stop`,{object:t,angle:n}),onScaleStart:(n,r)=>{this._emitRecordUndo(),e.emit(`scale-start`,{object:t,xScale:n,yScale:r})},onScale:(n,r)=>e.emit(`scale`,{object:t,xScale:n,yScale:r}),onScaleStop:(n,r)=>e.emit(`scale-stop`,{object:t,xScale:n,yScale:r})};this.addHandles(cc(this.tooltip,this.object,()=>({sketchOptions:this.sketchOptions,activeTooltipInfo:this.activeTooltipInfo,callbacks:c,scaleRotateTransform:this._scaleRotate}))),this.finishToolCreation()}destroy(){this.tooltip.destroy(),this._moveManipulation.destroy(),this._scaleRotate=M(this._scaleRotate),this._scaleRotateAdapter=M(this._scaleRotateAdapter),this._updatingHandles.destroy(),this._set(`view`,null),this._set(`object`,null)}onInputEvent(e){if(!this.destroyed&&!oi(e,this.tooltip))return super.onInputEvent(e)}_updateManipulatorsInteractive(){this._scaleRotate!=null&&(this._scaleRotate.interactive=!this._moveManipulation.grabbing,this._moveManipulation.interactive=!this._scaleRotate.grabbing)}_createScaleRotateAdapter(){return W(this.object)?.type===`mesh`?new ju({object:this.object,viewingMode:this.view.state.viewingMode}):new X({graphic:this.object.graphic,sizeFilter:e=>this._enforceNonZeroSize(e),findLayerView:()=>this.view.allLayerViews.find(e=>e.layer===this.object.graphic?.layer),sizeAxis:this.sketchOptions?.tooltips?.visualVariables?.size?.axis??null})}_forEachManipulator(e){this._moveManipulation?.forEachManipulator(e),this._scaleRotate?.forEachManipulator(e)}_hideManipulatorsForObjectState(){return S(()=>this.object.visible,e=>{this._forEachManipulator(t=>t.available=e),this._moveManipulation.zManipulation.available=e&&this.enableZ&&oc(this.object.operations,this.object.elevationInfo)})}_emitRecordUndo(){this.events.emit(`record-undo`,{updates:[this.object.createUndoRecord()]})}set snapToScene(e){this._moveManipulation&&(this._moveManipulation.snapToScene=e),this._set(`snapToScene`,e)}get updating(){return this._updatingHandles.updating||!!this._scaleRotate?.updating}get activeTooltipInfo(){return W(this.object)?.type===`mesh`?this._meshTooltipInfo:this._pointTooltipInfo}set location(e){this._moveManipulation.location=e,this._scaleRotate&&(this._scaleRotate.location=e)}set elevationAlignedLocation(e){this._moveManipulation.elevationAlignedLocation=e,this._scaleRotate&&(this._scaleRotate.elevationAlignedLocation=e)}reset(){}onHide(){this._scaleRotate?.cancelActiveAnimation()}_onScaleChanged(){this._scaleRotate!=null&&(this._moveManipulation.displayScale=this._scaleRotate.getScale())}_updateMoveAngle(){let{view:e}=this,t=e.state.viewingMode===2||e.scale<1e6;this._moveManipulation.angle=t?this._scaleRotateAdapter.angle:0}_onGeometryChanged(){Nl(this,this.object)}_enforceNonZeroSize(e){return e||this.view.state.camera.computeRenderPixelSizeAt(this._moveManipulation.renderLocation)}get test(){}};d([C({constructOnly:!0,nonNullable:!0})],Q.prototype,`view`,void 0),d([C({constructOnly:!0,nonNullable:!0})],Q.prototype,`object`,void 0),d([C({constructOnly:!0,nonNullable:!0})],Q.prototype,`enableZ`,void 0),d([C()],Q.prototype,`enableRotation`,void 0),d([C()],Q.prototype,`enableScaling`,void 0),d([C({constructOnly:!0,type:$n})],Q.prototype,`sketchOptions`,void 0),d([C({value:!1})],Q.prototype,`snapToScene`,null),d([C({constructOnly:!0})],Q.prototype,`snappingManager`,void 0),d([C({readOnly:!0})],Q.prototype,`type`,void 0),d([C({readOnly:!0})],Q.prototype,`updating`,null),d([C()],Q.prototype,`activeTooltipInfo`,null),Q=d([j(`esri.views.3d.interactive.editingTools.transform.TransformTool3D`)],Q);var Gu=class extends Jt(Mt){constructor(e){super(e),this.type=`plane`,this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}equals(e){return this.heading===e.heading&&this.tilt===e.tilt&&this.width===e.width&&this.height===e.height&&$e(this.position,e.position)}};d([C({type:[`plane`],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],Gu.prototype,`type`,void 0),d([C({type:o,json:{write:{isRequired:!0}}})],Gu.prototype,`position`,void 0),d([C({type:Number,nonNullable:!0,range:{min:0,max:360},json:{write:{isRequired:!0}}}),u(e=>At.normalize(_e(e),0,!0))],Gu.prototype,`heading`,void 0),d([C({type:Number,nonNullable:!0,range:{min:0,max:360},json:{write:{isRequired:!0}}}),u(e=>At.normalize(_e(e),0,!0))],Gu.prototype,`tilt`,void 0),d([C({type:Number,nonNullable:!0,range:{min:0},json:{write:{isRequired:!0}}})],Gu.prototype,`width`,void 0),d([C({type:Number,nonNullable:!0,range:{min:0},json:{write:{isRequired:!0}}})],Gu.prototype,`height`,void 0),Gu=d([j(`esri.analysis.SlicePlane`)],Gu),Ft(0,0,0,.04),Xe(`mac`);var Ku=1.15,qu=1.15;Math.cos(bt(45)),Math.cos(bt(5));var Ju=22.5,Yu=2.25,Xu=.3;N();function Zu(e){let t=new gi,{vertex:n,fragment:r,attributes:i,varyings:a}=t;return wa(n,e),i.add(`position`,`vec3`),i.add(`uv0`,`vec2`),a.add(`vUV`,`vec2`),n.main.add(Tn`vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);`),r.uniforms.add(new ba(`backgroundColor`,e=>e.backgroundColor),new ba(`gridColor`,e=>e.gridColor),new En(`gridWidth`,e=>e.gridWidth)).main.add(Tn`const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
fragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;`),t}Object.freeze(Object.defineProperty({__proto__:null,build:Zu},Symbol.toStringTag,{value:`Module`}));function Qu(e,t){return jl(e.basis1,e.basis2,e.origin,t)}function $u(e,t,n,r){let i=t.worldUpAtPosition(e.origin,R.get()),a=R.get();switch(n){case 1:P(a,i);break;case 2:P(a,e.basis1)}return on(e.origin,a,r)}function ed(e,n,r,i){let a=yt(i.basis1),o=yt(i.basis2),s=td(i),c=nd(i),l=t(R.get(),0,0,0);A(l,x(R.get(),i.basis1,n.direction[0]),x(R.get(),i.basis2,n.direction[1])),A(l,i.origin,l);let u=0,d=1;if(rd(n))n.direction[0]===1&&n.direction[1]===-1?u=id:n.direction[0]===1&&n.direction[1]===1?u=Math.PI:n.direction[0]===-1&&n.direction[1]===1&&(u=3*Math.PI/2),d=c;else{let e=n.direction[0]===0?2:1;u=e===1?id:0,d=(e===1?o:a)-s}let f=zt(L.get(),u);lt(f,f,t(R.get(),d,d,d)),ge(f,r,f),f[12]=0,f[13]=0,f[14]=0,e.modelTransform=f,e.renderLocation=l}function td(e){let t=yt(e.basis1),n=yt(e.basis2);return Xu*Math.min(t,n)}function nd(e){return td(e)}function rd(e){return e.direction[0]!==0&&e.direction[1]!==0}vn();var id=Math.PI/2,ad=class extends G{constructor(e,t){let n=new V({width:1,renderOccluded:4,isDecoration:!0},e.state.isGlobal),r=new ya({cullFace:2,renderOccluded:16,isDecoration:!0}),i=new ya({cullFace:2,renderOccluded:16,isDecoration:!0}),a=new ya({cullFace:2,renderOccluded:16,isDecoration:!0}),o=new ya({writeDepth:!1,cullFace:1,renderOccluded:2,isDecoration:!0});super({view:e,...od({offsetMode:t,tubeMaterial:r,tipMaterial:i,capMaterial:a,outlineMaterial:o,calloutMaterial:n})}),this._themeHandle=S(()=>e.effectiveTheme.accentColor,e=>{let t=Wn(e),s=D.toUnitRGBA(e),c=D.toUnitRGBA(t),l=D.toUnitRGBA(D.blendColors(t,e,.4)),u=D.toUnitRGBA(D.blendColors(t,e,.14));n.setParameters({color:s}),r.setParameters({color:u}),i.setParameters({color:c}),a.setParameters({color:l}),o.setParameters({color:s})},T)}destroy(){this._themeHandle.remove(),super.destroy()}};function od({offsetMode:e,tubeMaterial:t,tipMaterial:n,capMaterial:r,outlineMaterial:i,calloutMaterial:a}){let o=e===0?40:0,s=[O(o,0,-48/2),O(o,0,48/2)],c=ld(s),l=sd({vertices:s,padding:0,materials:{tube:t,tip:n,cap:r}}),u=sd({vertices:s,padding:Yu,materials:{tube:i,tip:i,cap:i}}),d=za(a,[[o,0,0],[o-40,0,0]]),f=za(a,[[o,0,0],[o-40,0,0]]);return{renderObjects:[...l.normal.map(e=>new K(e,17)),...u.normal.map(e=>new K(e,17)),new K(d,49),...l.focused.map(e=>new K(e,18)),...u.focused.map(e=>new K(e,18)),new K(f,50)],autoScaleRenderObjects:!1,collisionType:{type:`line`,paths:[c]},collisionPriority:1,radius:11,state:16}}function sd({vertices:e,padding:n,materials:r}){let i=i=>{let a=e.slice(),o=E(R.get(),a[0],a[1]);w(o,o);let s=E(R.get(),a[a.length-1],a[a.length-2]);if(w(s,s),n>0){let e=x(b(),s,-n);a[a.length-1]=A(e,e,a[a.length-1]);let t=x(b(),o,-n);a[0]=A(t,t,a[0])}let c=i?qu:1,l=Ju*c,u=11*c,d=Gt(L.get());if(n>0){let e=l/4,r=t(R.get(),0,e,0),i=1+n/e;ye(d,d,r),lt(d,d,t(R.get(),i,i,i)),ye(d,d,x(r,r,-1/i))}let f=Gt(N()),p=O(0,1,0),m=h(N(),Yt(en.get(),p,s));m[12]=a[a.length-1][0],m[13]=a[a.length-1][1],m[14]=a[a.length-1][2],ge(m,m,d);let g=r.tube,_=cd(3*(i?Ku:1)+n,a,g);_.transformation=f;let v=[_],ee=r.tip,te=Ba(ee,l,u,24,!1,!1,!0);te.transformation=m,v.push(te);let ne=r.cap,re=Ba(ne,l,u,24,!1,!0,!1);re.transformation=m,v.push(re);let y=h(N(),Yt(en.get(),p,o));return y[12]=a[0][0],y[13]=a[0][1],y[14]=a[0][2],ge(y,y,d),v.push(te.instantiate({transformation:y})),v.push(re.instantiate({transformation:y})),v};return{normal:i(!1),focused:i(!0)}}function cd(e,t,n){let r=[];for(let t=0;t<12;t++){let n=t/12*2*Math.PI;r.push([Math.cos(n)*e,Math.sin(n)*e])}return Pa(n,r,t,[],[],!1)}function ld(e,t){let n=E(b(),e[e.length-1],e[e.length-2]);w(n,n),x(n,n,Ju),A(n,n,e[e.length-1]);{let t=E(b(),e[0],e[1]);return w(t,t),x(t,t,Ju),A(t,t,e[0]),[t,...e,n]}}var ud=class{get _object(){return this._tool.object}get _operations(){return this._object.operations}constructor(e,t,n){this._tool=e,this._bounds=t,this._automaticLengthMeasurementUtils=n,this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null;let r=this._tool,i=r.view;this.moveXYObjectManipulation=new Ul({view:i,tool:r,object:this._object}),r.addHandles(this._createMoveXYObjectDragPipeline()),this.moveZManipulator=new ad(i,0),this.moveZManipulator.state|=32,r.manipulators.add(this.moveZManipulator),r.addHandles(this._createMoveZDragPipeline()),r.addHandles(r.events.on(`translate-stop`,()=>{this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null}))}destroy(){this.moveXYObjectManipulation.destroy(),this._tool.manipulators.remove(this.moveZManipulator),this.moveZManipulator.destroy()}forEachManipulator(e){this.moveXYObjectManipulation.forEachManipulator(e),e(this.moveZManipulator,0)}updateManipulators(e,t){let n=this.moveZManipulator,r=Re(L.get(),e,Math.PI);r[12]=0,r[13]=0,r[14]=0,n.modelTransform=r,n.renderLocation=E(R.get(),t.origin,t.basis1)}getUpdatedTooltipInfo(){return this.moveXYObjectManipulation.grabbing||this.moveXYObjectManipulation.dragging?this._computeMoveXYTooltipInfo():this.moveZManipulator.focused?this._computeMoveZTooltipInfo():null}_computeMoveXYTooltipInfo(){let e=this._tool,t=this._moveXYTooltipInfo??=new qa({sketchOptions:e.sketchOptions});if(this.moveXYObjectManipulation.dragging){let n=this._bounds,r=n.mapBoundsStart.origin,i=n.mapBounds.origin,{renderSpatialReference:a}=e.view;if(!a)return null;let o=this._automaticLengthMeasurementUtils.autoDistance2D(r,i,a);if(o==null)return null;t.distance=o}else t.distance=sr;return t}_computeMoveZTooltipInfo(){let e=this._tool,t=this._moveZTooltipInfo??=new Gl({sketchOptions:e.sketchOptions});if(this.moveZManipulator.dragging){let n=this._bounds,r=n.mapBoundsStart.origin,i=n.mapBounds.origin,{renderSpatialReference:a}=e.view;if(!a)return null;let o=dr(r,i,a);if(o==null)return null;t.distance=o}else t.distance=sr;return t}_createMoveXYObjectDragPipeline(){return this.moveXYObjectManipulation.createDragPipeline((e,t,n)=>this._buildMoveDragPipeline(t,n))}_createMoveZDragPipeline(){if(!this._operations)return F();let e=this._operations.data.spatialReference;return Xr(this.moveZManipulator,(t,n,r)=>{let i=xe(t.renderLocation),a=n.next(hl(this._tool.view,i,e)).next(Lr());this._buildMoveDragPipeline(a,r)})}_buildMoveDragPipeline(e,t){let{_tool:n,_object:r}=this;e.next(e=>(e.action===`start`&&(n.inputState={type:`move`},this._bounds.backupMapBounds(),n.events.emit(`translate-start`,{object:r,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY})),e)).next(Qr()).next(this._updateGeometry()).next(e=>{let t={object:r,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY};switch(e.action){case`start`:case`update`:(e.mapEnd.x-e.mapStart.x||e.mapEnd.y-e.mapStart.y||(e.mapEnd.z??0)-(e.mapStart.z??0))&&n.events.emit(`translate`,t);break;case`end`:n.inputState=null,n.events.emit(`translate-stop`,t)}return e}),t.next(()=>{n.inputState!=null&&n.events.emit(`translate-stop`,{object:r,dxScreen:0,dyScreen:0}),n.cancelDrag()})}_updateGeometry(){let e=this._tool;return t=>{if(e.inputState==null||e.inputState.type!==`move`)return t;let n=t.action===`start`?0:1;if(this._operations){let e=this._operations.move(t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,n);this._bounds.updateMapBoundsFromOperation(e)}return t}}},dd=`theme-style`;function fd(e,t){return gd(hd(pd(md(e),t)),t.size)}function pd(e,{accentColor:t,contrastColor:n}){let r=t.toHex(),i=t.a,a=n.toHex(),o=n.a,s=e.getElementsByTagNameNS(`http://www.w3.org/2000/svg`,`style`).namedItem(dd);return s&&(s.innerHTML=`\n      .contrast-fill { fill: ${a}; fill-opacity: ${o}; }\n      .contrast-stroke { stroke: ${a}; stroke-opacity: ${o};  }\n      .accent-fill { fill: ${r}; fill-opacity: ${i}; }\n      .accent-stroke { stroke: ${r}; stroke-opacity:  ${i}; }`),e}function md(e){let t=e.split(`,`)[1],n=atob(t);return new DOMParser().parseFromString(n,`image/svg+xml`)}function hd(e){let t=new XMLSerializer().serializeToString(e);return`data:image/svg+xml;base64,${btoa(t)}`}function gd(e,t){let n=new Image(t,t);return n.src=e,n}var _d=`data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NiIgaGVpZ2h0PSI1NiIgZmlsbD0ibm9uZSI+PHN0eWxlIGlkPSJ0aGVtZS1zdHlsZSI+LmNvbnRyYXN0LWZpbGx7ZmlsbDojZmZmfS5jb250cmFzdC1zdHJva2V7c3Ryb2tlOiNmZmZ9LmFjY2VudC1maWxse2ZpbGw6I2ZmN2YwMDtmaWxsLW9wYWNpdHk6LjV9PC9zdHlsZT48cGF0aCBkPSJNMjggMGEyOCAyOCAwIDEgMSAwIDU2IDI4IDI4IDAgMCAxIDAtNTYiIGNsYXNzPSJhY2NlbnQtZmlsbCIvPjxwYXRoIHN0cm9rZS13aWR0aD0iNC45OSIgZD0iTTIwLjA1IDQwLjg2YTE1LjA1IDE1LjA1IDAgMCAwIDE3LjE0LTEuNSAxNS4wNSAxNS4wNSAwIDAgMCA0LjQ3LTE2LjY1IDE1LjA1IDE1LjA1IDAgMCAwLTIyLjcyLTcuMTUgMTUuMDUgMTUuMDUgMCAwIDAtNS41IDcuMTUiIGNsYXNzPSJjb250cmFzdC1zdHJva2UiLz48cGF0aCBkPSJtMTAuOTcgMzUuNTcgNS4zOCAxMi4wNyA3Ljc5LTEzLjQ3eiIgY2xhc3M9ImNvbnRyYXN0LWZpbGwiLz48L3N2Zz4=`,vd=64;function yd(e,t){let{accentColor:n,contrastColor:r,preMultiplyAlpha:i}=t;return e.fromData(`heading-rotate:[accent:${n},contrast:${r},size:${vd}]`,()=>new Ea(fd(_d,{accentColor:n,contrastColor:r,size:vd}),{mipmap:!0,reloadable:!0,preMultiplyAlpha:i}))}function bd(e){return!!e.update}var xd=class extends aa{constructor(e,t){super(e,t,new na(Ja,()=>f(()=>import(`./ImageMaterial.glsl-CfwPakwd.js`),__vite__mapDeps([44,45,35,5,6,7,8,28,3,11,36,26,37,31,46,38,39,24,40,4,9,10,41,42,23,43,12,32]))),Sd(t).locations)}_getPipelineState(e,t){let{oitPass:n,output:r,hasOccludees:i,cullFace:a}=e;return yi({blending:Cn(r)?ji(n,!0):null,culling:bi(a),depthTest:{func:Ri(n)},depthWrite:Ii(e),drawBuffers:Ni(n,r),colorWrite:_i,stencilWrite:i?Wi:null,stencilTest:i?t?Hi:zi:null,polygonOffset:Di(e)})}initializePipeline(e){return this._occludeePipeline=this._getPipelineState(e,!0),this._getPipelineState(e,!1)}getPipeline(e){return e?this._occludeePipeline:super.getPipeline()}};function Sd(e){let t=ha;return e.perspectiveInterpolation&&(t=t.clone().f32(`perspectiveDivide`)),t}var Cd=class extends Fi{constructor(e){super(),this.draped=e,this.cullFace=0,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.perspectiveInterpolation=!0,this.textureCoordinateType=0,this.emissionSource=0,this.discardInvisibleFragments=!0,this.occlusionPass=!1,this.olidColorInstanced=!1,this.snowCover=!1}};d([B({count:3})],Cd.prototype,`cullFace`,void 0),d([B()],Cd.prototype,`enableOffset`,void 0),d([B()],Cd.prototype,`writeDepth`,void 0),d([B()],Cd.prototype,`hasOccludees`,void 0),d([B()],Cd.prototype,`terrainDepthTest`,void 0),d([B()],Cd.prototype,`cullAboveTerrain`,void 0),d([B()],Cd.prototype,`perspectiveInterpolation`,void 0);var wd=class extends fa{constructor(e){super(e,Dd),this.supportsEdges=!0,this.produces=new Map([[2,e=>bn(e)],[4,e=>xn(e)&&this.parameters.writeDepth],[8,e=>xn(e)&&!this.parameters.writeDepth],[18,e=>xn(e)||bn(e)]]),this._configuration=new Cd(e.draped)}dispose(){this.setParameters({texture:void 0})}getConfiguration(e,t){return super.getConfiguration(e,t,this._configuration),this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=t.hasOccludees,this._configuration.oitPass=t.oitPass,this._configuration.enableOffset=t.camera.relativeElevation<qi,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration.perspectiveInterpolation=this.parameters.perspectiveInterpolation,this._configuration}get visible(){return!0}createGLMaterial(e){return new Td(e)}createBufferWriter(){return new Ed(Sd(this.parameters))}},Td=class extends wn{constructor(e){super({...e,...e.material.parameters}),this.parameters=e;let t=this._material.parameters.texture;bd(t)&&e.textures.updater.add(t)}dispose(){this.parameters.textures.updater.remove(this._material.parameters.texture)}beginSlot(e){return this.getTechnique(xd,e)}},Ed=class extends Ui{write(e,t,n,r,i,a){for(let r of this.layout.fields.keys()){let o=n.get(r);if(o)if(r===`perspectiveDivide`){fn(o.size===1);let e=i.getField(r,un);e&&Ki(o,e,a)}else Oi(r,o,e,t,i,a)}return null}},Dd=class extends Ai{constructor(e,t){super(),this.texture=e,this.draped=t,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=0,this.opacity=1,this.perspectiveInterpolation=!1}get glTexture(){return this.texture.glTexture}},Od=class extends G{constructor(e,t){let n=Un(e.effectiveTheme.accentColor,.5),r=Wn(e.effectiveTheme.accentColor),i=t(n,r),a=new wd({draped:!1,texture:i.texture,writeDepth:!1,renderOccluded:16,isDecoration:!0}),o=Ol.calloutWidth,s=new V({width:o,renderOccluded:4,isDecoration:!0},e.state.isGlobal);super({view:e,...kd({imageMaterial:a,calloutMaterial:s})}),this._material=a,this._textureHandle=i,this._themeHandle=S(()=>e.effectiveTheme.accentColor,e=>{let n=Un(e,.5),r=Wn(e),i=this._textureHandle;this._textureHandle=t(n,r),a.setParameters({texture:this._textureHandle.texture}),i?.release(),s.setParameters({color:D.toUnitRGBA(e)})},T)}destroy(){this._textureHandle=Ct(this._textureHandle),this._themeHandle.remove(),this._material.dispose(),super.destroy()}};function kd({imageMaterial:e,calloutMaterial:t}){let{focusMultiplier:n,calloutLength:r,discRadius:i}=Ol,a=i*n,o=(e,t)=>{let n=[0,1,2,2,3,0];return new Bi(t,[[`position`,new yn([r-e,-e,0,r+e,-e,0,r+e,e,0,r-e,e,0],n,3,!0)],[`uv0`,new yn([0,0,1,0,1,1,0,1],n,2,!0)]])},s=za(t,[[0,0,0],[r-i,0,0]]),c=za(t,[[0,0,0],[r-a,0,0]]);return{autoScaleRenderObjects:!1,collisionPriority:1,collisionType:{type:`disc`,direction:[0,0,1],offset:[r,0,0]},focusMultiplier:n,radius:i,renderObjects:[new K(o(i,e),17),new K(s,17),new K(o(a,e),18),new K(c,18)],state:16}}var Ad=class{get _object(){return this._tool.object}get _operations(){return this._object.operations}constructor(e,t,n){this._tool=e,this._bounds=t,this._snapRotation=n,this._rotateTooltipInfo=null,this._startAngle=0,this._endAngle=0;let r=this._tool,i=r.view,a=!i.stage?.renderView.renderingContext.driverTest.svgPremultipliesAlpha.result;this.rotateManipulator=new Od(i,(e,t)=>yd(i.stage.textures,{accentColor:e,contrastColor:t,preMultiplyAlpha:a})),r.addHandles([this.rotateManipulator.events.on(`grab-changed`,e=>this._onGrabChanged(e)),this._createRotateDragPipeline(this.rotateManipulator)]),r.manipulators.add(this.rotateManipulator),r.addHandles([r.events.on(`rotate-start`,e=>this._startAngle=e.angle),r.events.on(`rotate`,e=>this._endAngle=e.angle),r.events.on(`rotate-stop`,()=>{this._startAngle=0,this._endAngle=0})])}destroy(){this._tool.manipulators.remove(this.rotateManipulator),this.rotateManipulator.destroy()}forEachManipulator(e){e(this.rotateManipulator,3)}updateManipulators(e,t){let n=this._bounds.mapBounds.plane[2]<0?Math.PI:0,r=ae(L.get(),e,n);r[12]=0,r[13]=0,r[14]=0,this.rotateManipulator.modelTransform=r,this.rotateManipulator.renderLocation=A(R.get(),t.origin,t.basis1)}getUpdatedTooltipInfo(){return this.rotateManipulator.focused?this._computeRotateTooltipInfo():null}_computeRotateTooltipInfo(){let e=this._rotateTooltipInfo??=new Xa({sketchOptions:this._tool.sketchOptions});return e.angle=this._startAngle-this._endAngle,e}_onGrabChanged({action:e,screenPoint:t}){let n=this._tool,r=this._bounds;if(e!==`start`||!t)return;let i=$u(r.displayBounds,n.view.renderCoordsHelper,1,sn()),a=hc(n.view.state.camera,t);nn(i,a,R.get())&&(r.backupMapBounds(),n.inputState={type:`rotate`,rotatePlane:i})}_createRotateDragPipeline(e){let{_tool:t,_object:n}=this;return Xr(e,(e,r,i)=>{let a=t.inputState;a!=null&&(r.next(e=>(e.action===`start`&&t.events.emit(`rotate-start`,{object:n,angle:0}),e)).next(cl(t.view,a.rotatePlane)).next(this._renderPlaneToAngle()).next(...this._snapRotation()).next(this._updateGeometry()).next(e=>{let r={object:n,angle:ne(e.rotateAngle)};switch(e.action){case`start`:case`update`:t.events.emit(`rotate`,r);break;case`end`:t.inputState=null,t.events.emit(`rotate-stop`,r)}return e}),i.next(()=>{t.inputState!=null&&t.events.emit(`rotate-stop`,{object:n,angle:0}),t.cancelDrag()}))})}_renderPlaneToAngle(){return e=>{let t=Al(e.renderStart,e.renderEnd,this._bounds.displayBounds.origin,rn(e.plane));return{...e,rotateAngle:t}}}_updateGeometry(){let e=this._bounds;return t=>{let n=P(b(),e.mapBoundsStart.origin),r=t.action===`start`?0:1;if(this._operations){let i=this._operations.rotate(n,t.rotateAngle,r,1);pi(e.mapBoundsStart,e.mapBounds),e.updateMapBoundsFromOperation(i)}return t}}},jd=class extends G{constructor(e,t){let n=rd(t),r=n?4:1,i=r*2,a={renderOccluded:4,isDecoration:!0},o=new V({...a,width:r},e.state.isGlobal),s=new V({...a,width:i},e.state.isGlobal),c=new V({...a,width:1},e.state.isGlobal);super({view:e,...kl,...Md({isCorner:n,unfocusedMaterial:o,focusedMaterial:s,outlineMaterial:c})}),this._themeHandle=S(()=>e.effectiveTheme.accentColor,e=>{let t=D.toUnitRGBA(e);o.setParameters({color:t}),s.setParameters({color:t}),c.setParameters({color:t})},T)}destroy(){this._themeHandle.remove(),super.destroy()}};function Md({isCorner:e,unfocusedMaterial:t,focusedMaterial:n,outlineMaterial:r}){let i=e?[O(1,0,0),O(0,0,0),O(0,1,0)]:[O(1,0,0),O(-1,0,0)];return{renderObjects:[new K(za(t,i),17),new K(za(n,i),18),new K(za(r,i),32)],collisionType:{type:`line`,paths:[i]},radius:e?6:4,state:16}}var Nd=class{constructor(e,t){this._tool=e,this.mapBounds=mi(),this.mapBoundsStart=mi(),this.displayBounds=mi(),e.addHandles(y(()=>e.object,`modified-externally`,()=>this._resetMapBounds(),{onListenerAdd:()=>this._resetMapBounds()})),this._onDisplayBoundsChanged=t}get displayBoundsMargin(){let{view:e,object:t}=this._tool,n=W(t),r=e.pointsOfInterest?.centerOnSurfaceFrequent.location??n?.extent?.center;return r?Pd*e.pixelSizeAt(r):0}backupMapBounds(){pi(this.mapBounds,this.mapBoundsStart)}updateDisplayBounds(){this._calculateDisplayBounds(),this._onDisplayBoundsChanged?.()}updateMapBoundsFromOperation(e){qr(e,this.mapBounds),this.updateDisplayBounds()}updateMapBoundsFromOperationInverse(e){Wr(e,this.mapBounds),this.updateDisplayBounds()}_resetMapBounds(){this._calculateMapBounds(),this.updateDisplayBounds()}_calculateMapBounds(){let{view:e,attachmentOrigin:t,object:n}=this._tool,r=n.operations?.data;if(!r)return;let i=r.geometry;this.spatialReference=i.spatialReference;let a=ic(i);Bt(a,a,-1);let o=t?e.pixelSizeAt(t,i.spatialReference):0,s=Fd*o,c=r.coordinateHelper.hasZ()&&n.elevationInfo.mode!==`on-the-ground`;Yr(a,r,s,this.mapBounds,c)}_calculateDisplayBounds(){let{view:e,attachmentOrigin:t}=this._tool,n=t?.z??Yi(this.mapBounds.origin,e.elevationProvider,Qi.fromElevationInfo(this._tool.object.elevationInfo),e.renderCoordsHelper);Id(this.mapBounds,n??0,e.renderCoordsHelper,this.spatialReference,this.displayBoundsMargin,this.displayBounds)}},Pd=10,Fd=80;function Id(e,t,n,r,i=0,a){a||=mi();let o=R.get();A(o,e.origin,e.basis1),A(o,o,e.basis2),n.toRenderCoords(o,r,o);let s=R.get();A(s,e.origin,e.basis1),E(s,s,e.basis2),n.toRenderCoords(s,r,s);let c=R.get();E(c,e.origin,e.basis1),E(c,c,e.basis2),n.toRenderCoords(c,r,c);let l=R.get();E(l,e.origin,e.basis1),A(l,l,e.basis2),n.toRenderCoords(l,r,l),A(a.origin,o,s),A(a.origin,a.origin,c),A(a.origin,a.origin,l),x(a.origin,a.origin,.25),E(o,o,a.origin),E(s,s,a.origin),E(c,c,a.origin),E(l,l,a.origin);let u=de(R.get(),o,s,.5),d=de(R.get(),c,l,.5);x(d,d,-1),de(a.basis1,u,d,.5);let f=de(R.get(),o,l,.5),p=de(R.get(),s,c,.5);x(p,p,-1),de(a.basis2,f,p,.5);let m=Me(R.get(),a.basis1,a.basis2);Me(a.basis2,m,a.basis1),w(a.basis1,a.basis1);let h=Math.max(Math.abs(oe(a.basis1,o)),Math.abs(oe(a.basis1,s)),Math.abs(oe(a.basis1,c)),Math.abs(oe(a.basis1,l)));w(a.basis2,a.basis2);let g=Math.max(Math.abs(oe(a.basis2,o)),Math.abs(oe(a.basis2,s)),Math.abs(oe(a.basis2,c)),Math.abs(oe(a.basis2,l)));x(a.basis1,a.basis1,h+i),x(a.basis2,a.basis2,g+i);let _=P(R.get(),e.origin);return _[2]=t,n.toRenderCoords(_,r,_),on(_,m,a.plane),an(a.plane,a.origin,a.origin),fi(a),a}function Ld(e,t,n,r){return E(Vd,E(Vd,e.origin,e.basis1),e.basis2),jt(Bd,Vd,e.basis1,2),jt(zd,Bd,e.basis2,2),jt(Rd,Vd,e.basis2,2),Vd[2]=Bd[2]=zd[2]=Rd[2]=t,Ya({topLeft:Rd,topRight:zd,bottomRight:Bd,bottomLeft:Vd,spatialReference:n,automaticLengthMeasurementUtils:r})}var Rd=b(),zd=b(),Bd=b(),Vd=b(),Hd=class{get _object(){return this._tool.object}get _operations(){return this._object.operations}get zMax(){if(!this._zMaxDirty||!this._operations)return this._zMax;let e=this._operations.data;if(e.geometry.hasZ){let t=e.coordinateHelper;this._zMax=-1/0;for(let n of e.parts)for(let e of n.vertices){let n=t.getZ(e.pos)??0;this._zMax=Math.max(n,this._zMax)}}else this._zMax=0;return this._zMaxDirty=!1,this._zMax}constructor(e,t,n){this._tool=e,this._bounds=t,this._preserveAspectRatioStep=n,this._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._displayBoundsStart=mi(),this._displayBoundsMarginStart=0,this._zMax=0,this._zMaxDirty=!0;let r=this._tool,i=r.view;this.resizeManipulators=this._resizeHandles.map(e=>{let t=new jd(i,e);return r.addHandles([t.events.on(`grab-changed`,e=>this._onGrabChanged(e)),this._createResizeDragPipeline(t,e)]),t}),r.manipulators.addMany(this.resizeManipulators),this._operations&&r.addHandles(this._operations.data.on(`change`,()=>{r.inputState?.type!==`resize`&&(this._zMaxDirty=!0)}))}destroy(){this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()})}forEachManipulator(e){this.resizeManipulators.forEach(t=>e(t,2))}updateManipulators(e,t){this.resizeManipulators.forEach((n,r)=>{ed(n,this._resizeHandles[r],e,t)})}getUpdatedTooltipInfo(){if(!this.resizeManipulators.some(e=>e.focused))return null;let e=this._tooltipInfo??=new Za({sketchOptions:this._tool.sketchOptions}),t=Ld(this._bounds.mapBounds,this.zMax,this._bounds.spatialReference,this._tool.automaticLengthMeasurementUtils);return t&&(e.xSize=t.xSize,e.ySize=t.ySize),this.resizeManipulators.some(e=>e.dragging)||(e.xScale=1,e.yScale=1),e}_onGrabChanged({action:e,screenPoint:t}){let n=this._tool,r=this._bounds;if(e!==`start`||!t)return;let i=hc(n.view.state.camera,t);nn(r.displayBounds.plane,i,R.get())&&(r.backupMapBounds(),pi(r.displayBounds,this._displayBoundsStart),this._displayBoundsMarginStart=r.displayBoundsMargin,n.inputState={type:`resize`})}_createResizeDragPipeline(e,t){let{_tool:n,_object:r}=this;return Xr(e,(e,i,a)=>{n.inputState!=null&&(i.next(e=>(e.action===`start`&&n.events.emit(`scale-start`,{object:r,xScale:1,yScale:1}),{...e,handle:t})).next(cl(n.view,this._displayBoundsStart.plane)).next(this._renderPlaneToFactors()).next(...this._preserveAspectRatioStep()).next(this._updateGeometry()).next(e=>{let t=this._tooltipInfo;t&&(t.xScale=e.factor1,t.yScale=e.factor2);let i={object:r,xScale:e.factor1,yScale:e.factor2};switch(e.action){case`start`:case`update`:n.events.emit(`scale`,i);break;case`end`:n.inputState=null,n.events.emit(`scale-stop`,i)}return e}),a.next(()=>{n.inputState!=null&&n.events.emit(`scale-stop`,{object:r,xScale:1,yScale:1}),n.cancelDrag()}))})}_renderPlaneToFactors(){let e=this._bounds;return t=>{let n=this._displayBoundsStart,r=t.handle.direction,i=e.displayBoundsMargin,a=this._displayBoundsMarginStart,o=P(R.get(),n.origin);jt(o,o,n.basis1,-r[0]),jt(o,o,n.basis2,-r[1]);let s=E(R.get(),t.renderEnd,o),c=E(R.get(),t.renderStart,o),l=rd(t.handle),u=nd(n),d=nd(e.displayBounds)/u,f=(e,t)=>{if(e===0)return 1;let n=yt(t),r=.5*e*oe(t,s)/n,o=r<0?-1:1;l&&(r+=(n-.5*e*oe(t,c)/n)*o*d);let u=n<1.5*a?1:Ud;return n=Math.max(n-a,Ud),o>0&&(r-=i),o*Math.max(o*(r/n),u)};return{...t,factor1:f(r[0],n.basis1),factor2:f(r[1],n.basis2)}}}_updateGeometry(){let e=this._bounds;return t=>{let n=P(b(),e.mapBoundsStart.origin);jt(n,n,e.mapBoundsStart.basis1,-t.handle.direction[0]),jt(n,n,e.mapBoundsStart.basis2,-t.handle.direction[1]);let r=_(ot(),e.mapBoundsStart.basis1[0],e.mapBoundsStart.basis1[1]);dt(r,r);let i=t.action===`start`?0:1;if(this._operations){let a=this._operations.scale(n,r,t.factor1,t.factor2,i,1);pi(e.mapBoundsStart,e.mapBounds),e.updateMapBoundsFromOperation(a)}return t}}},Ud=1e-6,Wd=class{constructor(){this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&this._lastDragEvent!=null&&this._next!=null){let t={...this._lastDragEvent,action:`update`};e&&Gd(t),this._next.execute(t)}this._enabled=e}createDragEventPipelineStep(){this._lastDragEvent=null;let e=new Hr;return this._next=e,[e=>(this._lastDragEvent=e.action===`end`?null:{...e},this._enabled&&Gd(e),e),e]}get test(){}};function Gd(e){let t=rd(e.handle)?Math.max(Math.abs(e.factor1),Math.abs(e.factor2)):e.handle.direction[0]===0?Math.abs(e.factor2):Math.abs(e.factor1);e.factor1=e.factor1<0?-t:t,e.factor2=e.factor2<0?-t:t}var Kd=class{constructor(){this._lastDragEvent=null,this._next=null,this.incrementRadians=bt(5),this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&this._lastDragEvent!=null&&this._next!=null){let t={...this._lastDragEvent,action:`update`};e&&this._adjustRotation(t),this._next.execute(t)}this._enabled=e}createDragEventPipelineStep(){this._lastDragEvent=null;let e=new Hr;return this._next=e,[e=>(this._lastDragEvent=e.action===`end`?null:{...e},this._enabled&&this._adjustRotation(e),e),e]}_adjustRotation(e){e.rotateAngle=Math.round(e.rotateAngle/this.incrementRadians)*this.incrementRadians}},$=class extends Zr{get updating(){return!!this.object.updating}constructor(e){super(e),this.events=new Rt,this.enableZ=!0,this.enableScaling=!0,this.enableRotation=!0,this.sketchOptions=new $n,this._preserveAspectRatio=new Wd,this._snapRotation=new Kd,this.grabbing=!1,this.inputState=null,this._attachmentOrigin=null,this.type=`transform-3d`,this._outlineVisualElement=null}initialize(){let{view:e,object:t}=this,n=this._bounds=new Nd(this,()=>this._updateManipulators());this._extentMove=new ud(this,n,this.automaticLengthMeasurementUtils),this._extentScale=new Hd(this,n,()=>this._preserveAspectRatio.createDragEventPipelineStep()),this._extentRotate=new Ad(this,n,()=>this._snapRotation.createDragEventPipelineStep()),this.addHandles([S(()=>this.enableZ,()=>this._updateManipulatorAvailability(this._extentMove.moveZManipulator,0)),S(()=>this.enableScaling,()=>this._extentScale.forEachManipulator(e=>this._updateManipulatorAvailability(e,2))),S(()=>this.enableRotation,()=>this._updateManipulatorAvailability(this._extentRotate.rotateManipulator,3))]),this._updateManipulators(),this._updateAllManipulatorAvailability();let r=Qc({view:e,object:t,forEachManipulator:e=>this._forEachManipulator(e),onManipulatorsChanged:()=>F()});if(r!=null){let{visualElement:e}=r;e instanceof Rs&&(this._outlineVisualElement=e,this.addHandles(e.events.on(`attachment-origin-changed`,()=>this._bounds.updateDisplayBounds()))),this.addHandles(r)}this.addHandles([t.on(`committed`,()=>this._onGeometryChanged()),S(()=>this.object.visible,()=>this._updateAllManipulatorAvailability()),S(()=>this.object.isDraped,()=>this._graphicDrapedChanged(),T),S(()=>e.pointsOfInterest?.centerOnSurfaceFrequent.location,()=>n.updateDisplayBounds())]),this._forEachManipulator(e=>{this.addHandles(e.events.on(`grab-changed`,()=>{this.grabbing=e.grabbing,this._updateAllManipulatorAvailability()}))}),this._forEachManipulator((e,n)=>{this.addHandles(e.events.on(`immediate-click`,e=>{n===1&&this.events.emit(`immediate-click`,{...e,object:t}),e.stopPropagation()}))}),this._initializeTooltip(),this.finishToolCreation()}destroy(){this._extentMove.destroy(),this._extentScale.destroy(),this._extentRotate.destroy(),this.tooltip.destroy(),this._set(`view`,null),this._set(`object`,null)}_initializeTooltip(){let{view:e}=this;this.tooltip=ii(()=>({view:e,options:this.sketchOptions.tooltips}));let t=()=>{this.tooltip.info=this._getUpdatedTooltipInfo()};this.addHandles([S(()=>this.sketchOptions.tooltips.effectiveEnabled,t),S(()=>this.preserveAspectRatio,t)]),this._forEachManipulator(e=>{this.addHandles([e.events.on([`focus-changed`,`grab-changed`],t),e.events.on(`drag`,e=>{e.action===`cancel`?this.tooltip.clear():t()})])})}_getUpdatedTooltipInfo(){return this.sketchOptions.tooltips.effectiveEnabled?this._extentMove.getUpdatedTooltipInfo()??this._extentScale.getUpdatedTooltipInfo()??this._extentRotate.getUpdatedTooltipInfo():null}_onGeometryChanged(){this._bounds.updateDisplayBounds()}_graphicDrapedChanged(){this.removeHandles(qd),this._bounds.updateDisplayBounds(),this.object.isDraped&&this.addHandles(this.view.elevationProvider.on(`elevation-change`,e=>{this._attachmentOrigin!=null&&qt(e.extent,this._attachmentOrigin.x,this._attachmentOrigin.y)&&this._bounds.updateDisplayBounds()}),qd)}_updateManipulators(){if(!this.visible)return;let e=this._bounds.displayBounds,t=Qu(e,L.get());this._extentMove.updateManipulators(t,e),this._extentScale.updateManipulators(t,e),this._extentRotate.updateManipulators(t,e)}_updateAllManipulatorAvailability(){this._forEachManipulator((e,t)=>this._updateManipulatorAvailability(e,t))}_updateManipulatorAvailability(e,t){let n=this.grabbing&&!e.grabbing;if(e.interactive=!n,e instanceof G){let r=this.object.visible,i=this.enableZ&&oc(this.object.operations,this.object.elevationInfo);switch(t){case 3:e.available=r&&this.enableRotation;break;case 2:e.available=r&&(this.enableScaling||this.enableRotation||i),e.interactive=!n&&this.enableScaling,e.state=this.enableScaling?16:32;break;case 0:e.available=r&&i;break;default:e.available=r}}}_forEachManipulator(e){this._extentMove.forEachManipulator(e),this._extentScale.forEachManipulator(e),this._extentRotate.forEachManipulator(e)}get preserveAspectRatio(){return this._preserveAspectRatio.enabled}set preserveAspectRatio(e){this._preserveAspectRatio.enabled=e,this._set(`preserveAspectRatio`,e)}get snapRotation(){return this._snapRotation.enabled}set snapRotation(e){this._snapRotation.enabled=e,this._set(`snapRotation`,e)}get attachmentOrigin(){return this._attachmentOrigin=(this.object.isDraped?null:this._outlineVisualElement?.attachmentOrigin)??this.object.origin??W(this.object)?.extent?.center,this._attachmentOrigin}reset(){}cancelDrag(){if(this.canUndo){let e=this.object.operations?.undo();e&&this._bounds.updateMapBoundsFromOperationInverse(e)}this.inputState=null}get canUndo(){return!!this.object.operations?.canUndo}undo(){if(this.inputState!=null)this.view.activeTool=null;else if(this.canUndo){let e=this.object.operations?.undo();e&&this._bounds.updateMapBoundsFromOperationInverse(e)}}get canRedo(){return!!this.object.operations?.canRedo}redo(){if(this.canRedo){let e=this.object.operations?.redo();e&&this._bounds.updateMapBoundsFromOperation(e)}}get test(){}};d([C()],$.prototype,`updating`,null),d([C({constructOnly:!0,nonNullable:!0})],$.prototype,`view`,void 0),d([C({constructOnly:!0})],$.prototype,`automaticLengthMeasurementUtils`,void 0),d([C({constructOnly:!0,nonNullable:!0})],$.prototype,`object`,void 0),d([C()],$.prototype,`enableZ`,void 0),d([C()],$.prototype,`enableScaling`,void 0),d([C()],$.prototype,`enableRotation`,void 0),d([C({constructOnly:!0,type:$n})],$.prototype,`sketchOptions`,void 0),d([C()],$.prototype,`preserveAspectRatio`,null),d([C()],$.prototype,`snapRotation`,null),d([C()],$.prototype,`grabbing`,void 0),d([C()],$.prototype,`inputState`,void 0),d([C({readOnly:!0})],$.prototype,`type`,void 0),d([C()],$.prototype,`tooltip`,void 0),$=d([j(`esri.views.3d.interactive.editingTools.transform.ExtentTransformTool`)],$);var qd=`draped-elevation-changes`;function Jd(e){return e!=null&&e.type===`mesh`?Yd(e):Xd(e)}function Yd(e){return Qt(e.vertexSpace)?Zd(e,e.transform,e.vertexSpace):Qd(e)}function Xd(e){let t=e,n=null;return{undo(e){n=e.geometry,e.geometry=t},redo(e){t=e.geometry,e.geometry=n}}}function Zd(e,t,n){let r=t?.clone(),i=xe(n.origin),a=null,o=null;return{undo:()=>{a=e.transform?.clone(),o=xe(n.origin),e.transform=r,e.vertexSpace.origin=i},redo:()=>{r=e.transform?.clone(),i=xe(n.origin),e.transform=a,e.vertexSpace.origin=o}}}function Qd(e){let t,n=e.vertexAttributes.clonePositional();return{undo:()=>{t=e.vertexAttributes.clonePositional(),e.vertexAttributes=n},redo:()=>{n=e.vertexAttributes.clonePositional(),e.vertexAttributes=t}}}var $d=Symbol(),ef=class extends Oe{get operations(){return this._operations}get updating(){return this._updatingHandles.updating}get elevationInfo(){return Pn(this.graphic)}get visible(){return this._graphicState.displaying}get isDraped(){return this._graphicState.isDraped}get origin(){return Ml(this.view,this.graphic)}constructor(e){super(e),this._updatingHandles=new i}destroy(){this._operations=M(this._operations),this._updatingHandles.destroy()}initialize(){this._graphicState=new Ga({graphic:this.graphic}),this._graphicState.on(`changed`,()=>this.emit(`committed`)),this.addHandles(this.view.trackGraphicState(this._graphicState)),this.addHandles(this._updatingHandles.add(()=>this.graphic.geometry,e=>{let t=this._operations?.data.geometry;if(e!==t){if(!e||e?.type===`multipoint`||e?.type===`extent`)return M(this._operations),this.removeHandles($d),void(this._operations=null);if(this._operations?.trySetGeometry(e))this.emit(`modified-externally`);else{M(this._operations),this.removeHandles($d);let t=kr.fromGeometry(e,this.view.state.viewingMode);this._operations=t,this.addHandles(t.data.on(`change`,()=>this.graphic.geometry=t.data.geometry),$d)}}},Tt))}createManipulator(e){return new di({view:this.view,graphic:this.graphic,...e})}maskOccludee(){return this.view.maskOccludee(this.graphic)}endInteraction(){this.graphic.geometry?.type===`mesh`&&this.graphic.notifyMeshTransformChanged({action:2})}toMap(e){return this.view.toMap(e,{include:[this.graphic]})}createUndoRecord(){let{graphic:{geometry:e}}=this;return Jd(e)}};d([C({constructOnly:!0})],ef.prototype,`view`,void 0),d([C({constructOnly:!0})],ef.prototype,`graphic`,void 0),d([C()],ef.prototype,`_operations`,void 0),d([C()],ef.prototype,`operations`,null),d([C()],ef.prototype,`updating`,null),ef=d([j(`esri.views.3d.interactive.editingTools.ManipulatedObject3DGraphic`)],ef);export{tc as DrawGraphicTool3D,$ as ExtentTransformTool,ef as ManipulatedObject3DGraphic,q as MoveTool3D,Y as ReshapeTool3D,Q as TransformTool3D};