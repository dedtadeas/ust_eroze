import{$y as e,Tn as t,ab as n,tl as r,vE as i}from"./index-BqmCqmfp.js";function a(e,t,r=0){let i=n(e,0,l);for(let e=0;e<4;e++)t[r+e]=Math.floor(256*u(i*s[e]))}function o(e,t=0){let n=0;for(let r=0;r<4;r++)n+=e[t+r]*c[r];return n}var s=[1,256,65536,16777216],c=[1/256,1/65536,1/16777216,1/4294967296],l=o(new Uint8ClampedArray([255,255,255,255]));o(new Uint8ClampedArray([255,255,255,0]));function u(e){return e-Math.floor(e)}var d=15.5,f=4,p=64,m=1024,h={outlineWidth:.75,referenceWidth:.75,cap:t.CIMSolidStroke.capstyle,join:t.CIMSolidStroke.joinstyle,miterLimit:t.CIMSolidStroke.miterlimit},g=()=>i.getLogger(`esri.symbols.cim.rasterizingUtils`),_=32,v=e=>e===`vertical`||e===`horizontal`||e===`cross`||e===`esriSFSCross`||e===`esriSFSVertical`||e===`esriSFSHorizontal`;function y(t,n,r){let i=n.style,a=e(Math.ceil(r)),o=v(i)?8*a:16*a,s=2*a;t.width=o,t.height=o;let c=t.getContext(`2d`);c.strokeStyle=`#ffffff`,c.lineWidth=a,c.beginPath(),i!==`vertical`&&i!==`cross`&&i!==`esriSFSCross`&&i!==`esriSFSVertical`||(c.moveTo(o/2,-s),c.lineTo(o/2,o+s)),i!==`horizontal`&&i!==`cross`&&i!==`esriSFSCross`&&i!==`esriSFSHorizontal`||(c.moveTo(-s,o/2),c.lineTo(o+s,o/2)),i!==`backward-diagonal`&&i!==`diagonal-cross`&&i!==`esriSFSDiagonalCross`&&i!==`esriSFSBackwardDiagonal`||(c.moveTo(-s,-s),c.lineTo(o+s,o+s),c.moveTo(o-s,-s),c.lineTo(o+s,s),c.moveTo(-s,o-s),c.lineTo(s,o+s)),i!==`forward-diagonal`&&i!==`diagonal-cross`&&i!==`esriSFSForwardDiagonal`&&i!==`esriSFSDiagonalCross`||(c.moveTo(o+s,-s),c.lineTo(-s,o+s),c.moveTo(s,-s),c.lineTo(-s,s),c.moveTo(o+s,o-s),c.lineTo(o-s,o+s)),c.stroke();let l=c.getImageData(0,0,t.width,t.height),u=new Uint8Array(l.data),d;for(let e=0;e<u.length;e+=4)d=u[e+3]/255,u[e]=u[e]*d,u[e+1]=u[e+1]*d,u[e+2]=u[e+2]*d;return[u,t.width,t.height,a]}function b(e){e.length%2==1&&(e=[...e,...e]);let t=e.reduce((e,t)=>e+t,0),n=Math.round(t*4),r=new Float32Array(n*1),i=0,o=0,s=.5,c=!0;for(let t of e){for(i=o,o+=t*4;s<=o;){let e=s-.5,t=Math.min(Math.abs(s-i),Math.abs(s-o));r[e]=c?-t:t,s++}c=!c}let l=r.length,u=new Uint8Array(4*l);for(let e=0;e<l;++e){let t=r[e]/4;a(t/64*.5+.5,u,4*e)}return[u,n,1]}function x(e,t){e??=[];let n=t===`Butt`,r=t===`Square`,i=!n&&!r;e.length%2==1&&(e=[...e,...e]);let o=d,s=2*o,c=0;for(let t of e)c+=t;let l=Math.round(c*o),u=new Float32Array(l*s),f=.5*o,p=0,m=0,h=.5,g=!0;for(let t of e){for(p=m,m+=t*o;h<=m;){let e=.5;for(;e<s;){let t=(e-.5)*l+h-.5,a=i?(e-o)*(e-o):Math.abs(e-o);u[t]=g?n?Math.max(Math.max(p+f-h,a),Math.max(h-m+f,a)):a:i?Math.min((h-p)*(h-p)+a,(h-m)*(h-m)+a):r?Math.min(Math.max(h-p,a),Math.max(m-h,a)):Math.min(Math.max(h-p+f,a),Math.max(m+f-h,a)),e++}h++}g=!g}let _=u.length,v=new Uint8Array(4*_);for(let e=0;e<_;++e){let t=(i?Math.sqrt(u[e]):u[e])/o;a(t,v,4*e)}return[v,l,s]}function S(e,n){let{colorRamp:r,gradientType:i}=n,a=r.type===`CIMFixedColorRamp`,o=n.interval||t.CIMGradientFill.interval,s=T(r);return a&&(s=E(s,o)),i===`Discrete`||a?O(e,s,o):D(e,s)}var C;function w(e,n){let{colorRamp:r,gradientType:i}=n,a=T(r),o=r.type===`CIMFixedColorRamp`;if(i===`Continuous`&&!o)return k(e,a);let s=n.interval??t.CIMGradientFill.interval;if(o)return k(e,E(a,s));let c=[];C??=document.createElement(`canvas`),A(C,a,s,1,0);let l=C.getContext(`2d`).getImageData(0,0,s,1).data;for(let e=0,t=0;e<s;e++,t=4*e){let n=[l[t+0],l[t+1],l[t+2],l[t+3]];c.push({offset:e/s,color:n}),c.push({offset:(e+1)/s,color:n})}return k(e,c)}function T(e){let t=[];switch(e.type){case`CIMPolarContinuousColorRamp`:case`CIMLinearContinuousColorRamp`:{e.type===`CIMPolarContinuousColorRamp`&&g().warnOnce(`CIMPolarContinuousColorRamp is currently unsupported. Falling back to CIMLinearContinuousColorRamp.`);let n=e;t.push({offset:0,color:[n.fromColor[0],n.fromColor[1],n.fromColor[2],n.fromColor[3]/255]}),t.push({offset:1,color:[n.toColor[0],n.toColor[1],n.toColor[2],n.toColor[3]/255]});break}case`CIMFixedColorRamp`:{let n=e,r=1/(n.colors.length-1),i=0;for(let e of n.colors)t.push({offset:i,color:[e[0],e[1],e[2],e[3]/255]}),i+=r;break}case`CIMMultipartColorRamp`:{let n=e,r=n.weights.reduce((e,t)=>e+t,0),i=0;for(let e=0;e<n.colorRamps.length;e++){let a=n.colorRamps[e],o=n.weights[e],s=T(a);for(let e of s)t.push({offset:(i+e.offset*o)/r,color:e.color});i+=o}break}default:g().error(`Color ramp "${e.type}" currently unsupported.`)}return t}function E(e,t){let n=[],r=(e.length-1)/(t-1);for(let i=0;i<t;i++){let a=e[Math.round(i*r)].color;n.push({offset:i/t,color:a}),n.push({offset:(i+1)/t,color:a})}return n}function D(e,t){return A(e,t,_,1,1),j(e)}function O(e,t,n){return A(e,t,n,1,1),j(e)}function k(e,t,n=0){for(let{offset:r,color:i}of t)e.addColorStop(Math.min(Math.max(r,n),1-n),`rgba(${i[0]}, ${i[1]}, ${i[2]}, ${i[3]})`)}function A(e,t,n,r,i){let a=n+2*i;e.width=a,e.height=r;let o=(i+1)/a,s=e.getContext(`2d`,{willReadFrequently:!0});if(t.length>0){let e=s.createLinearGradient(0,0,a,r);k(e,t,o),s.fillStyle=e}else s.fillStyle=`rgba(128, 128, 128, 1)`;s.fillRect(0,0,a,r)}function j(e){let{width:t,height:n}=e,r=e.getContext(`2d`).getImageData(0,0,t,n),i=new Uint8Array(r.data);for(let e=0;e<i.length;e+=4){let t=i[e+3]/255;i[e]*=t,i[e+1]*=t,i[e+2]*=t}return[i,t,n]}function M(e){let t=e[0]?.[0]?.[0]??0,n=e[0]?.[0]?.[1]??0,r={ymin:n,xmin:t,ymax:n,xmax:t,width:0,height:0};for(let t=0;t<e.length;t++){let n=e[t];for(let e=0;e<n.length;e++){let t=n[e][0],i=n[e][1];t<r.xmin&&(r.xmin=t),t>r.xmax&&(r.xmax=t),i<r.ymin&&(r.ymin=i),i>r.ymax&&(r.ymax=i)}}return r.width=Math.abs(r.xmax-r.xmin),r.height=Math.abs(r.ymax-r.ymin),r}function N(e,t){let n=M(e),r=n.width===0?1:n.width,i=n.height===0?1:n.height,a=[];for(let o=0;o<e.length;o++){let s=e[o],c=[];for(let e=0;e<s.length;e++){let a=Math.round(s[e][0]-n.xmin),o=Math.round(s[e][1]-n.ymin);if(a=t.xmin+a*t.width/r,o=t.ymin+o*t.height/i,isNaN(a)||isNaN(o))throw Error(`Scaled shape has NaN values`);c.push([a,o])}a.push(c)}return a}function P(e,t,n){let r=[];for(let i=0;i<e.length;i++){let a=e[i],o=[];for(let e=0;e<a.length;e++){let r=a[e][0]+t,i=a[e][1]+n;if(isNaN(r)||isNaN(i))throw Error(`Scaled shape has NaN values`);o.push([r,i])}r.push(o)}return r}export{b as a,f as c,m as d,a as f,S as i,h as l,N as n,w as o,y as r,x as s,P as t,p as u};