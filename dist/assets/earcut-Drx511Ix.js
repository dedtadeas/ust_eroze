function e(e,n,i){i||=2;var a,o,s,l,u,d,f,p=n&&n.length,m=p?n[0]*i:e.length,h=t(e,0,m,i,!0),g=[];if(!h||h.next===h.prev)return g;if(p&&(h=c(e,n,h,i)),e.length>80*i){a=s=e[0],o=l=e[1];for(var _=i;_<m;_+=i)(u=e[_])<a&&(a=u),(d=e[_+1])<o&&(o=d),u>s&&(s=u),d>l&&(l=d);f=(f=Math.max(s-a,l-o))===0?0:1/f}return r(h,g,i,a,o,f),g}function t(e,t,n,r,i){var a,o;if(i===M(e,t,n,r)>0)for(a=t;a<n;a+=r)o=k(a,e[a],e[a+1],o);else for(a=n-r;a>=t;a-=r)o=k(a,e[a],e[a+1],o);if(o&&x(o,o.next)){var s=o.next;A(o),o=s}return o}function n(e,t){if(!e)return e;t||=e;var n,r=e;do if(n=!1,r.steiner||!x(r,r.next)&&b(r.prev,r,r.next)!==0)r=r.next;else{var i=r.prev;if(A(r),(r=t=i)===r.next)break;n=!0}while(n||r!==t);return t}function r(e,t,c,l,u,d,f){if(e){!f&&d&&m(e,l,u,d);for(var p,h,g=e;e.prev!==e.next;)if(p=e.prev,h=e.next,d?a(e,l,u,d):i(e))t.push(p.i/c),t.push(e.i/c),t.push(h.i/c),A(e),e=h.next,g=h.next;else if((e=h)===g){f?f===1?r(e=o(n(e),t,c),t,c,l,u,d,2):f===2&&s(e,t,c,l,u,d):r(n(e),t,c,l,u,d,1);break}}}function i(e){var t=e.prev,n=e,r=e.next;if(b(t,n,r)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(v(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&b(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function a(e,t,n,r){var i=e.prev,a=e,o=e.next;if(b(i,a,o)>=0)return!1;for(var s=i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,c=i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,l=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,u=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,d=g(s,c,t,n,r),f=g(l,u,t,n,r),p=e.prevZ,m=e.nextZ;p&&p.z>=d&&m&&m.z<=f;){if(p!==e.prev&&p!==e.next&&v(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&b(p.prev,p,p.next)>=0||(p=p.prevZ,m!==e.prev&&m!==e.next&&v(i.x,i.y,a.x,a.y,o.x,o.y,m.x,m.y)&&b(m.prev,m,m.next)>=0))return!1;m=m.nextZ}for(;p&&p.z>=d;){if(p!==e.prev&&p!==e.next&&v(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&b(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;m&&m.z<=f;){if(m!==e.prev&&m!==e.next&&v(i.x,i.y,a.x,a.y,o.x,o.y,m.x,m.y)&&b(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function o(e,t,r){var i=e;do{var a=i.prev,o=i.next.next;!x(a,o)&&S(a,i,i.next,o)&&E(a,o)&&E(o,a)&&(t.push(a.i/r),t.push(i.i/r),t.push(o.i/r),A(i),A(i.next),i=e=o),i=i.next}while(i!==e);return n(i)}function s(e,t,i,a,o,s){var c=e;do{for(var l=c.next.next;l!==c.prev;){if(c.i!==l.i&&y(c,l)){var u=O(c,l);c=n(c,c.next),u=n(u,u.next),r(c,t,i,a,o,s),r(u,t,i,a,o,s);return}l=l.next}c=c.next}while(c!==e)}function c(e,r,i,a){var o,s,c,u=[];for(o=0,s=r.length;o<s;o++)(c=t(e,r[o]*a,o<s-1?r[o+1]*a:e.length,a,!1))===c.next&&(c.steiner=!0),u.push(_(c));for(u.sort(l),o=0;o<u.length;o++)i=n(i=d(u[o],i),i.next);return i}function l(e,t){return e.x-t.x}function u(e){if(e.next.prev===e)return e;let t=e;for(;;){let n=t.next;if(n.prev===t||n===t||n===e)break;t=n}return t}function d(e,t){var r=f(e,t);if(!r)return t;var i=O(r,e),a=n(r,r.next);let o=u(i);return n(o,o.next),a=u(a),u(t===r?a:t)}function f(e,t){var n,r=t,i=e.x,a=e.y,o=-1/0;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var s=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>o){if(o=s,s===i){if(a===r.y)return r;if(a===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(i===o)return n;var c,l=n,u=n.x,d=n.y,f=1/0;r=n;do i>=r.x&&r.x>=u&&i!==r.x&&v(a<d?i:o,a,u,d,a<d?o:i,a,r.x,r.y)&&(c=Math.abs(a-r.y)/(i-r.x),E(r,e)&&(c<f||c===f&&(r.x>n.x||r.x===n.x&&p(n,r)))&&(n=r,f=c)),r=r.next;while(r!==l);return n}function p(e,t){return b(e.prev,e,t.prev)<0&&b(t.next,e,e.next)<0}function m(e,t,n,r){var i=e;do i.z===null&&(i.z=g(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,h(i)}function h(e){var t,n,r,i,a,o,s,c,l=1;do{for(n=e,e=null,a=null,o=0;n;){for(o++,r=n,s=0,t=0;t<l&&(s++,r=r.nextZ);t++);for(c=l;s>0||c>0&&r;)s!==0&&(c===0||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,c--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;n=r}a.nextZ=null,l*=2}while(o>1);return e}function g(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function _(e){var t=e,n=e;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==e);return n}function v(e,t,n,r,i,a,o,s){return(i-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(r-s)-(n-o)*(t-s)>=0&&(n-o)*(a-s)-(i-o)*(r-s)>=0}function y(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!T(e,t)&&(E(e,t)&&E(t,e)&&D(e,t)&&(b(e.prev,e,t.prev)||b(e,t.prev,t))||x(e,t)&&b(e.prev,e,e.next)>0&&b(t.prev,t,t.next)>0)}function b(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function x(e,t){return e.x===t.x&&e.y===t.y}function S(e,t,n,r){var i=w(b(e,t,n)),a=w(b(e,t,r)),o=w(b(n,r,e)),s=w(b(n,r,t));return i!==a&&o!==s||!(i!==0||!C(e,n,t))||!(a!==0||!C(e,r,t))||!(o!==0||!C(n,e,r))||!(s!==0||!C(n,t,r))}function C(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function w(e){return e>0?1:e<0?-1:0}function T(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&S(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}function E(e,t){return b(e.prev,e,e.next)<0?b(e,t,e.next)>=0&&b(e,e.prev,t)>=0:b(e,t,e.prev)<0||b(e,e.next,t)<0}function D(e,t){var n=e,r=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do n.y>a!=n.next.y>a&&n.next.y!==n.y&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next;while(n!==e);return r}function O(e,t){var n=new j(e.i,e.x,e.y),r=new j(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}function k(e,t,n,r){var i=new j(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function A(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function j(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function M(e,t,n,r){for(var i=0,a=t,o=n-r;a<n;a+=r)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}e.deviation=function(e,t,n,r){var i=t&&t.length,a=i?t[0]*n:e.length,o=Math.abs(M(e,0,a,n));if(i)for(var s=0,c=t.length;s<c;s++){var l=t[s]*n,u=s<c-1?t[s+1]*n:e.length;o-=Math.abs(M(e,l,u,n))}var d=0;for(s=0;s<r.length;s+=3){var f=r[s]*n,p=r[s+1]*n,m=r[s+2]*n;d+=Math.abs((e[f]-e[m])*(e[p+1]-e[f+1])-(e[f]-e[p])*(e[m+1]-e[f+1]))}return o===0&&d===0?0:Math.abs((d-o)/o)},e.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var a=0;a<e[i].length;a++)for(var o=0;o<t;o++)n.vertices.push(e[i][a][o]);i>0&&(r+=e[i-1].length,n.holes.push(r))}return n};export{e as t};