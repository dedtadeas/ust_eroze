import{cn as e,dn as t,in as n,kt as r,wn as i}from"./Point2D-UYEfE6HP.js";import{t as a}from"./Envelope2D-BNwQDrOT.js";import{An as o,b as s}from"./UnitFactory-J9WMNXdY.js";function c(){return l(new r,-1,NaN)}function l(e,t,n){return{m_coordinate:e.clone(),m_vertexIndex:t,m_geometryIndex:0,m_distance:n,m_bRightSide:!1,isEmpty:u}}function u(){return Number.isNaN(this.m_distance)}function d(n,r,i=-1,o=-1){if(n.isEmpty())return 3;let s=n.getGeometryType();if(t(s))return f(n,r,i,o);if(s===e.enumPolygon)return p(n,r,i,o);if(s===e.enumPolyline)return m(n,r,i,o);if(s===e.enumEnvelope){let e=new a;return n.queryEnvelope(e),e.contains(r)?e.containsExclusive(r)?1:2:0}return 3}function f(e,t,i,a){if(i>=0||a>=0)return n(``);if(e.isDegenerate(0))return e.getStartXY().equals(t)?2:3;if(!e.isCurve()){let n=r.orientationRobust(t,e.getStartXY(),e.getEndXY());return n<0?1:n>0?0:2}let o=e.getClosestCoordinate(t,!1),s=e.getTangent(o),c=e.getCoord2D(o),l=r.orientationRobust(t,c,c.add(s));return l<0?1:l>0?0:2}function p(e,t,r,i){(r>=0||i>=0)&&n(``);let o=new a;e.queryEnvelope(o);let c=s(e,t,0);return c===0?0:c===1?1:2}function m(e,t,i,a){(i<0&&a>=0||i>=0&&a<0)&&n(``);let o=e.querySegmentIterator();if(i<0){let e=Number.MAX_VALUE,n=0;for(;o.nextPath();)for(;o.hasNextSegment();){let s=o.nextSegment(),c=s.getClosestCoordinate(t,!1),l=s.getCoord2D(c),u=r.sqrDistance(l,t);u<e?(n=1,i=o.getStartPointIndex(),a=o.getPathIndex(),e=u):u===e&&n++}if(n===0)return 3;if(n===1)return o.resetToVertex(i,a),d(o.nextSegment(),t)}let s=v(t,o,i,a);if(s.i1!==-1&&s.i2===-1)return s.bRight1?1:0;if(s.i1!==-1&&s.i2!==-1){if(s.bRight1===s.bRight2)return s.bRight1?1:0;{o.resetToVertex(s.i1,-1);let e=o.nextSegment().getTangent(1);o.resetToVertex(s.i2,-1);let t=o.nextSegment().getTangent(0);return e.crossProduct(t)>=0?1:0}}return o.resetToVertex(i,a),d(o.nextSegment(),t)}function h(e,t,n){for(e.resetToVertex(t,n);e.hasNextSegment();)if(!e.nextSegment().isDegenerate(0))return e.getStartPointIndex();for(e.resetToVertex(t,n);e.hasPreviousSegment();)if(!e.previousSegment().isDegenerate(0))return e.getStartPointIndex();return-1}function g(e,t){for(e.resetToVertex(t,-1),e.nextSegment();e.hasNextSegment();)if(!e.nextSegment().isDegenerate(0))return e.getStartPointIndex();return-1}function _(e,t){for(e.resetToVertex(t,-1);e.hasPreviousSegment();)if(!e.previousSegment().isDegenerate(0))return e.getStartPointIndex();return-1}function v(e,t,n,i){let a={i1:-1,i2:-1,bRight1:!1,bRight2:!1};if(a.i1=h(t,n,i),a.i1!==-1){t.resetToVertex(a.i1,-1);let n=t.nextSegment(),i=n.getClosestCoordinate(e,!1),o=n.getCoord2D(i),s=r.sqrDistance(o,e);{let t=o.clone();t.subThis(n.getStartXY());let r=e.clone();r.subThis(n.getStartXY()),a.bRight1=t.crossProduct(r)<0}if(a.i2=g(t,a.i1),a.i2!==-1){t.resetToVertex(a.i2,-1);let n=t.nextSegment(),i=n.getClosestCoordinate(e,!1),o=n.getCoord2D(i);if(r.sqrDistance(o,e)>s)a.i2=-1;else{let t=o.clone();t.subThis(n.getStartXY());let r=e.clone();r.subThis(n.getStartXY()),a.bRight2=t.crossProduct(r)<0}}if(a.i2===-1&&(a.i2=_(t,a.i1),a.i2!==-1)){t.resetToVertex(a.i2,-1);let n=t.nextSegment(),i=n.getClosestCoordinate(e,!1),o=n.getCoord2D(i);if(r.sqrDistance(o,e)>s)a.i2=-1;else{let t=o.clone();t.subThis(n.getStartXY());let r=e.clone();r.subThis(n.getStartXY()),a.bRight2=t.crossProduct(r)<0;let i=a.i1;a.i1=a.i2,a.i2=i;let s=a.bRight1;a.bRight1=a.bRight2,a.bRight2=s}}}return a}var y=class{getOperatorType(){return 10500}accelerateGeometry(e,t,n){return!1}canAccelerateGeometry(e){return!1}supportsCurves(){return!0}getNearestCoordinate(t,r,a,o){if(r.isNAN()&&n(`NAN xy coordinates are not allowed`),t.isEmpty())return c();switch(t.getGeometryType()){case e.enumPoint:return this.pointGetNearestVertex(t,r);case e.enumMultiPoint:return this.multiVertexGetNearestVertex(t,r);case e.enumPolyline:case e.enumPolygon:return this.multiPathGetNearestCoordinate(t,r,a,o);default:i(``)}}getNearestVertex(t,r){if(r.isNAN()&&n(`NAN xy coordinates are not allowed`),t.isEmpty())return c();switch(t.getGeometryType()){case e.enumPoint:return this.pointGetNearestVertex(t,r);case e.enumMultiPoint:case e.enumPolyline:case e.enumPolygon:return this.multiVertexGetNearestVertex(t,r);default:i(``)}}getNearestVertices(t,r,a,o){if(o===0&&n(``),r.isNAN()&&n(`NAN xy coordinates are not allowed`),t.isEmpty())return[];switch(t.getGeometryType()){case e.enumPoint:return this.pointGetNearestVertices(t,r,a,o);case e.enumMultiPoint:case e.enumPolyline:case e.enumPolygon:return this.multiVertexGetNearestVertices(t,r,a,o);default:i(``)}}multiPathGetNearestCoordinate(t,i,c,u){if(t.getGeometryType()===e.enumPolygon&&c){let e=new a;t.queryEnvelope(e);let n=o(null,e,!1),r;if(r=s(t,i,u?0:n),r!==0){let e=l(i,-1,0);return u&&(e.m_bRightSide=!0),e}}let f=t.querySegmentIterator(),p=new r,m=-1,h=-1,g=Number.MAX_VALUE,_=0;for(;f.nextPath();)for(;f.hasNextSegment();){let e=f.nextSegment(),t=e.getClosestCoordinate(i,!1),n=e.getCoord2D(t),a=r.sqrDistance(n,i);a<g?(_=1,p.assign(n),m=f.getStartPointIndex(),h=f.getPathIndex(),g=a):a===g&&_++}m===-1&&n(``);let v=l(p,m,Math.sqrt(g));if(u)if(t.getGeometryType()!==e.enumPolygon){let e=!1;if(_>1){let n=d(t,i,m,h);e=n!==0&&n!==3}else{f.resetToVertex(m,h);let t=f.nextSegment();e=d(t,i)!==0}v.m_bRightSide=e}else c||s(t,i,0)!==0&&(v.m_bRightSide=!0);return v}pointGetNearestVertex(e,t){let n=e.getXY(),i=r.distance(n,t);return l(n,0,i)}multiVertexGetNearestVertex(e,t){let n=e.getAttributeStreamRef(0),i=e.getPointCount(),a=-1,o=new r,s=Number.MAX_VALUE,c=new r;for(let e=0;e<i;e++){n.queryPoint2D(2*e,c);let i=r.sqrDistance(c,t);i<s&&(o.assign(c),a=e,s=i)}return l(o,a,Math.sqrt(s))}pointGetNearestVertices(e,t,n,i){let a=[];if(i!==0){let i=n*n,o=e.getXY(),s=r.sqrDistance(o,t);s<=i&&a.push(l(o,0,Math.sqrt(s)))}return a}multiVertexGetNearestVertices(e,t,n,i){let a=[];if(i!==0){let o=e.getAttributeStreamRef(0),s=e.getPointCount();a.length=i+1;let c=n*n;for(let e=0;e<s;e++){let n=o.read(2*e),i=o.read(2*e+1),s=t.x-n,u=t.y-i,d=s*s+u*u;d<=c&&a.push(l(r.construct(n,i),e,Math.sqrt(d)))}a.sort((e,t)=>e.m_distance-t.m_distance)}return a.slice(0,i)}};export{y as t};