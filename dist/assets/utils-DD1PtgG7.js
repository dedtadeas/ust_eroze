import{Fp as e,am as t,ax as n,cx as r,ex as i,ix as a,lm as o,mx as s,ox as c,qp as l,rx as u,tx as d}from"./index-BqmCqmfp.js";var f=`,`,p={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864e5},m=new Set([`integer`,`small-integer`]),h=null;function g(n){return e(n)||l(n)||t(n)}async function _(e){let{field:t,field2:n,field3:r,normalizationField:i,valueExpression:a,fields:s}=e,c=[];if(a){if(!h){let{arcadeUtils:e}=await o();h=e}c=h.extractFieldNames(a)}return t&&c.push(t),n&&c.push(n),r&&c.push(r),i&&c.push(i),s&&c.push(...s),c}function v(e){return String(e).padStart(2,`0`)}function y(e,t,n){let r;return t===`date`||t===`number`?(t===`number`&&(e=new Date(e)),r=`TIMESTAMP'${n?e.getFullYear():e.getUTCFullYear()}-${v((n?e.getMonth():e.getUTCMonth())+1)}-${v(n?e.getDate():e.getUTCDate())} ${v(n?e.getHours():e.getUTCHours())}:${v(n?e.getMinutes():e.getUTCMinutes())}:${v(n?e.getSeconds():e.getUTCSeconds())}'`):r=e,r}function b(e,t,n,r){let{hasQueryEngine:i}=e,a=`(${y(n,x(e,n),i)} - ${y(t,x(e,t),i)})`,o=p[r],s=`/`;return o<1&&(o=1/o,s=`*`),{sqlExpression:o===1?a:`(${a} ${s} ${o})`,sqlWhere:null}}function x(t,n){if(n instanceof Date)return`date`;if(typeof n==`number`)return`number`;if(typeof n==`string`){let r=t.getField(n);if(n.toLowerCase()===`<now>`)return;if(e(r))return`field`}}function S(e,t){let n=t&&e.getField(t);return!!n&&m.has(n.type)}function C(e){return`cast(${e} as float)`}function w(e,t){let{format:o,fieldFormat:s,timeZoneOptions:l,fieldType:f}=t??{},p=s?i(s):null,m,h;if(l&&({timeZone:m,timeZoneName:h}=r(l.layerTimeZone,l.datesInUnknownTimezone,l.viewTimeZone,p||d(o||`short-date-short-time`),f)),typeof e==`string`&&isNaN(Date.parse(f===`time-only`?`1970-01-01T${e}Z`:e)))return e;switch(f){case`date-only`:{let t=p||d(o||`short-date`);return typeof e==`string`?c(e,{...t}):n(e,{...t,timeZone:`UTC`})}case`time-only`:{let t=p||d(o||`short-time`);return typeof e==`string`?u(e,t):n(e,{...t,timeZone:`UTC`})}case`timestamp-offset`:{if(!m&&typeof e==`string`&&new Date(e).toISOString()!==e)return e;let t=o||p||l?p||d(o||`short-date-short-time`):void 0,r=t?{...t,timeZone:m,timeZoneName:h}:void 0;return typeof e==`string`?a(e,r):n(e,r)}default:{let t=o||p||l?p||d(o||`short-date-short-time`):void 0;return n(typeof e==`string`?new Date(e):e,t?{...t,timeZone:m,timeZoneName:h}:void 0)}}}export{f as a,g as i,S as n,_ as o,C as r,w as s,b as t};