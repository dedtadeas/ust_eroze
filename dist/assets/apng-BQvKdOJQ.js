import{iT as e,tw as t}from"./index-BqmCqmfp.js";import{n}from"./_commonjsHelpers-D6ht1XAa.js";var r,i={exports:{}};i.exports;function a(){return r||(r=1,e=function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}return n.m=e,n.c=t,n.p=``,n(0)}([function(e,t,n){Object.defineProperty(t,`__esModule`,{value:!0}),t.isNotPNG=c,t.isNotAPNG=l,t.default=d;var r=a(n(1)),i=n(2);function a(e){return e&&e.__esModule?e:{default:e}}var o=Error(`Not a PNG`),s=Error(`Not an animated PNG`);function c(e){return e===o}function l(e){return e===s}var u=new Uint8Array([137,80,78,71,13,10,26,10]);function d(e){var t=new Uint8Array(e);if(Array.prototype.some.call(u,function(e,n){return e!==t[n]}))return o;var n=!1;if(f(t,function(e){return!(n=e===`acTL`)}),!n)return s;var r=[],a=[],c=null,l=null,d=0,p=new i.APNG;if(f(t,function(e,t,n,o){var s=new DataView(t.buffer);switch(e){case`IHDR`:c=t.subarray(n+8,n+8+o),p.width=s.getUint32(n+8),p.height=s.getUint32(n+12);break;case`acTL`:p.numPlays=s.getUint32(n+8+4);break;case`fcTL`:l&&(p.frames.push(l),d++),(l=new i.Frame).width=s.getUint32(n+8+4),l.height=s.getUint32(n+8+8),l.left=s.getUint32(n+8+12),l.top=s.getUint32(n+8+16);var u=s.getUint16(n+8+20),f=s.getUint16(n+8+22);f===0&&(f=100),l.delay=1e3*u/f,l.delay<=10&&(l.delay=100),p.playTime+=l.delay,l.disposeOp=s.getUint8(n+8+24),l.blendOp=s.getUint8(n+8+25),l.dataParts=[],d===0&&l.disposeOp===2&&(l.disposeOp=1);break;case`fdAT`:l&&l.dataParts.push(t.subarray(n+8+4,n+8+o));break;case`IDAT`:l&&l.dataParts.push(t.subarray(n+8,n+8+o));break;case`IEND`:a.push(h(t,n,12+o));break;default:r.push(h(t,n,12+o))}}),l&&p.frames.push(l),p.frames.length==0)return s;var m=new Blob(r),v=new Blob(a);return p.frames.forEach(function(e){var t=[];t.push(u),c.set(_(e.width),0),c.set(_(e.height),4),t.push(g(`IHDR`,c)),t.push(m),e.dataParts.forEach(function(e){return t.push(g(`IDAT`,e))}),t.push(v),e.imageData=new Blob(t,{type:`image/png`}),delete e.dataParts,t=null}),p}function f(e,t){var n=new DataView(e.buffer),r=8,i=void 0,a=void 0,o=void 0;do a=n.getUint32(r),o=t(i=p(e,r+4,4),e,r,a),r+=12+a;while(!1!==o&&i!=`IEND`&&r<e.length)}function p(e,t,n){var r=Array.prototype.slice.call(e.subarray(t,t+n));return String.fromCharCode.apply(String,r)}function m(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}function h(e,t,n){var r=new Uint8Array(n);return r.set(e.subarray(t,t+n)),r}var g=function(e,t){var n=e.length+t.length,i=new Uint8Array(n+8),a=new DataView(i.buffer);a.setUint32(0,t.length),i.set(m(e),4),i.set(t,8);var o=(0,r.default)(i,4,n);return a.setUint32(n+4,o),i},_=function(e){return new Uint8Array([e>>>24&255,e>>>16&255,e>>>8&255,255&e])}},function(e,t){Object.defineProperty(t,`__esModule`,{value:!0}),t.default=function(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=-1,i=t,a=t+(arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.length-t);i<a;i++)r=r>>>8^n[255&(r^e[i])];return-1^r};for(var n=new Uint32Array(256),r=0;r<256;r++){for(var i=r,a=0;a<8;a++)i=1&i?3988292384^i>>>1:i>>>1;n[r]=i}},function(e,t,n){Object.defineProperty(t,`__esModule`,{value:!0}),t.Frame=t.APNG=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,`value`in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=a(n(3));function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw TypeError(`Cannot call a class as a function`)}t.APNG=function(){function e(){o(this,e),this.width=0,this.height=0,this.numPlays=0,this.playTime=0,this.frames=[]}return r(e,[{key:`createImages`,value:function(){return Promise.all(this.frames.map(function(e){return e.createImage()}))}},{key:`getPlayer`,value:function(e){var t=this,n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return this.createImages().then(function(){return new i.default(t,e,n)})}}]),e}(),t.Frame=function(){function e(){o(this,e),this.left=0,this.top=0,this.width=0,this.height=0,this.delay=0,this.disposeOp=0,this.blendOp=0,this.imageData=null,this.imageElement=null}return r(e,[{key:`createImage`,value:function(){var e=this;return this.imageElement?Promise.resolve():new Promise(function(t,n){var r=URL.createObjectURL(e.imageData);e.imageElement=document.createElement(`img`),e.imageElement.onload=function(){URL.revokeObjectURL(r),t()},e.imageElement.onerror=function(){URL.revokeObjectURL(r),e.imageElement=null,n(Error(`Image creation error`))},e.imageElement.src=r})}}]),e}()},function(e,t,n){Object.defineProperty(t,`__esModule`,{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,`value`in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw TypeError(`Cannot call a class as a function`)}function o(e,t){if(!e)throw ReferenceError(`this hasn't been initialised - super() hasn't been called`);return!t||typeof t!=`object`&&typeof t!=`function`?e:t}function s(e,t){if(typeof t!=`function`&&t!==null)throw TypeError(`Super expression must either be null or a function, not `+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.default=function(e){function t(e,n,r){a(this,t);var i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.playbackRate=1,i._currentFrameNumber=0,i._ended=!1,i._paused=!0,i._numPlays=0,i._rafId=null,i._apng=e,i.context=n,i.stop(),r&&i.play(),i}return s(t,e),r(t,[{key:`renderNextFrame`,value:function(){this._currentFrameNumber=(this._currentFrameNumber+1)%this._apng.frames.length,this._currentFrameNumber===this._apng.frames.length-1&&(this._numPlays++,this._apng.numPlays!==0&&this._numPlays>=this._apng.numPlays&&(this._ended=!0,this._paused=!0)),this._prevFrame&&this._prevFrame.disposeOp==1?this.context.clearRect(this._prevFrame.left,this._prevFrame.top,this._prevFrame.width,this._prevFrame.height):this._prevFrame&&this._prevFrame.disposeOp==2&&this.context.putImageData(this._prevFrameData,this._prevFrame.left,this._prevFrame.top);var e=this.currentFrame;this._prevFrame=e,this._prevFrameData=null,e.disposeOp==2&&(this._prevFrameData=this.context.getImageData(e.left,e.top,e.width,e.height)),e.blendOp==0&&this.context.clearRect(e.left,e.top,e.width,e.height),this.context.drawImage(e.imageElement,e.left,e.top),this.emit(`frame`,this._currentFrameNumber),this._ended&&this.emit(`end`)}},{key:`play`,value:function(){var e=this;this._rafId&&cancelAnimationFrame(this._rafId),this.emit(`play`),this._ended&&this.stop(),this._paused=!1;var t=performance.now()+this.currentFrame.delay/this.playbackRate;this._rafId=requestAnimationFrame(function n(r){if(!e._ended&&!e._paused){if(r>=t){for(;r-t>=e._apng.playTime/e.playbackRate;)t+=e._apng.playTime/e.playbackRate,e._numPlays++;do e.renderNextFrame(),t+=e.currentFrame.delay/e.playbackRate;while(!e._ended&&!e._paused&&r>t)}e._rafId=requestAnimationFrame(n)}})}},{key:`pause`,value:function(){this._paused||=(this._rafId&&=(cancelAnimationFrame(this._rafId),null),this.emit(`pause`),!0)}},{key:`stop`,value:function(){this._rafId&&=(cancelAnimationFrame(this._rafId),null),this.emit(`stop`),this._numPlays=0,this._ended=!1,this._paused=!0,this._currentFrameNumber=-1,this.context.clearRect(0,0,this._apng.width,this._apng.height),this.renderNextFrame()}},{key:`currentFrameNumber`,get:function(){return this._currentFrameNumber}},{key:`currentFrame`,get:function(){return this._apng.frames[this._currentFrameNumber]}},{key:`paused`,get:function(){return this._paused}},{key:`ended`,get:function(){return this._ended}}]),t}(i(n(4)).default)},function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return typeof e==`function`}function i(e){return typeof e==`number`}function a(e){return typeof e==`object`&&!!e}function o(e){return e===void 0}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!i(e)||e<0||isNaN(e))throw TypeError(`n must be a positive number`);return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,i,s,c,l;if(this._events||={},e===`error`&&(!this._events.error||a(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var u=Error(`Uncaught, unspecified "error" event. (`+t+`)`);throw u.context=t,u}if(o(n=this._events[e]))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),n.apply(this,s)}else if(a(n))for(s=Array.prototype.slice.call(arguments,1),i=(l=n.slice()).length,c=0;c<i;c++)l[c].apply(this,s);return!0},n.prototype.addListener=function(e,t){var i;if(!r(t))throw TypeError(`listener must be a function`);return this._events||={},this._events.newListener&&this.emit(`newListener`,e,r(t.listener)?t.listener:t),this._events[e]?a(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,a(this._events[e])&&!this._events[e].warned&&(i=o(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&i>0&&this._events[e].length>i&&(this._events[e].warned=!0,console.error(`(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.`,this._events[e].length),typeof console.trace==`function`&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){if(!r(t))throw TypeError(`listener must be a function`);var n=!1;function i(){this.removeListener(e,i),n||(n=!0,t.apply(this,arguments))}return i.listener=t,this.on(e,i),this},n.prototype.removeListener=function(e,t){var n,i,o,s;if(!r(t))throw TypeError(`listener must be a function`);if(!this._events||!this._events[e])return this;if(o=(n=this._events[e]).length,i=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit(`removeListener`,e,t);else if(a(n)){for(s=o;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){i=s;break}if(i<0)return this;n.length===1?(n.length=0,delete this._events[e]):n.splice(i,1),this._events.removeListener&&this.emit(`removeListener`,e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[e]&&delete this._events[e],this;if(arguments.length===0){for(t in this._events)t!==`removeListener`&&this.removeAllListeners(t);return this.removeAllListeners(`removeListener`),this._events={},this}if(r(n=this._events[e]))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}}])},i.exports=e()),i.exports;var e}var o=n(a());async function s(n,r){let i=o(n);if(i instanceof Error)throw i;await i.createImages(),e(r);let{frames:a,width:s,height:c}=i,l=document.createElement(`canvas`);l.width=s,l.height=c;let u=l.getContext(`2d`,{willReadFrequently:!0}),d=[],f=[],p=0;for(let e of a){let n=t(e.delay||100);f.push(n),p+=n;let r=e.imageElement;e.blendOp===0?u.globalCompositeOperation=`copy`:u.globalCompositeOperation=`source-over`;let i=e.disposeOp===2?u.getImageData(e.left,e.top,e.width,e.height):void 0;u.drawImage(r,e.left,e.top);let a=u.getImageData(0,0,s,c);d.push(a),e.disposeOp===0||(e.disposeOp===1?u.clearRect(e.left,e.top,e.width,e.height):e.disposeOp===2&&u.putImageData(i,e.left,e.top))}return{frameCount:a.length,duration:p,frameDurations:f,getFrame:e=>d[e],width:s,height:c}}var c=[137,80,78,71,13,10,26,10];function l(e){let t=new Uint8Array(e);return!c.some((e,n)=>e!==t[n])}function u(e){if(!l(e))return!1;let t=new DataView(e),n=new Uint8Array(e),r,i=8;do{let e=t.getUint32(i);if(r=String.fromCharCode.apply(String,Array.prototype.slice.call(n.subarray(i+4,i+8))),r===`acTL`)return!0;i+=12+e}while(r!==`IEND`&&i<n.length);return!1}export{u as isAnimatedPNG,l as isPNG,s as parseApng};