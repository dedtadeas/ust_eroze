import{wD as e,xD as t}from"./index-BqmCqmfp.js";import{n,t as r}from"./SimpleGeometryCursor-CI9GIWKa.js";import{$ as i,$t as a,A as o,At as s,B as c,Bt as l,C as u,Cn as d,Ct as f,D as p,Dt as m,E as h,Et as g,F as _,Ft as v,G as y,Gt as b,H as x,Ht as S,I as C,It as w,J as T,Jt as E,K as D,Kt as O,L as k,Lt as A,M as j,Mt as M,N,Nt as P,O as ee,Ot as te,P as F,Pt as ne,Q as re,R as ie,Rt as ae,S as oe,Sn as se,St as ce,T as le,Tt as ue,U as de,Ut as I,V as fe,Vt as pe,W as me,X as he,Xt as ge,Y as _e,Yt as ve,Z as ye,Zt as be,_ as xe,_n as Se,_t as Ce,a as we,an as Te,at as Ee,b as De,bn as Oe,bt as ke,c as Ae,cn as L,ct as je,d as Me,dn as Ne,dt as Pe,en as Fe,f as Ie,fn as Le,ft as Re,g as ze,gn as Be,gt as Ve,h as He,hn as Ue,ht as We,i as Ge,in as R,it as Ke,j as qe,jt as Je,k as Ye,kt as z,l as Xe,ln as B,lt as Ze,m as Qe,mn as $e,mt as et,n as tt,nt,on as rt,ot as it,p as at,pn as V,pt as ot,q as st,qt as ct,r as lt,rn as ut,rt as dt,s as ft,sn as pt,st as H,t as mt,tn as ht,tt as gt,ut as _t,v as vt,vn as U,vt as yt,w as bt,wn as xt,wt as St,x as Ct,xn as wt,xt as Tt,y as Et,yn as Dt,yt as Ot,z as W,zt as kt}from"./Point2D-UYEfE6HP.js";import{t as G}from"./Envelope2D-BNwQDrOT.js";import{t as At}from"./Transformation2D-DVoPQwGC.js";import{t as jt}from"./OperatorDefinitions-DQQu7-BK.js";var Mt=[0,0,NaN,0,0,0,0,0,-1,-1,0,0,0,0],Nt=[2,1,1,1,3,1,2,3,2,4,1,1,2,1],Pt=[1,1,1,0,2,1,1,1,0,0,0,0,0,1],Ft=[1,1,1,2,0,0,0,0,2,2,4,2,2,1],It=[4,8,4,8,1];function Lt(){return H(25,NaN)}var Rt=class e{getAttributeCount(){return this.m_attributeCount}getSemantics(e){return this.m_indexToSemantics[e]}getSemanticsBitArray(){return this.m_semanticsBitArray}getAttributeIndex(e){return this.m_semanticsToIndexMap[e]}static getInterpolation(e){return Pt[e]}static getPersistence(e){return Ft[e]}static getPersistenceSize(e){return It[e]}static getPersistenceSizeFromSemantics(t){return e.getPersistenceSize(e.getPersistence(t))*e.getComponentCount(t)}static getComponentCount(e){return Nt[e]}static maxComponentCount(){return 4}static isInteger(e){return e===2||e===3||e===4}static isIntegerSemantics(t){return e.isInteger(e.getPersistence(t))}static isTexture(e){return e===5||e===6||e===7}hasAttribute(e){return!!(this.m_semanticsBitArray&1<<e)}hasAttributesFrom(e){return(this.m_semanticsBitArray&e.m_semanticsBitArray)===e.m_semanticsBitArray}hasZ(){return this.hasAttribute(1)}hasM(){return this.hasAttribute(2)}hasID(){return this.hasAttribute(3)}getTotalComponentCount(){return this.m_totalComponentCount}static getDefaultValue(e){return Mt[e]}static isDefaultValue(e,t){return te(Mt[e],t)}equals(e){return this===e}getDefaultPointAttributes(){return this.m_defaultPointAttributes}getPointAttributeOffset(e){return this.m_pointAttributeOffsets[e]}constructor(t){this.m_semanticsBitArray=t,this.m_attributeCount=0,this.m_totalComponentCount=0,this.m_semanticsToIndexMap=new Int32Array(14),this.m_indexToSemantics=new Int32Array(14),this.m_pointAttributeOffsets=new Int32Array(14),this.m_defaultPointAttributes=H(25,NaN),this.m_semanticsToIndexMap.fill(-1),this.m_indexToSemantics.fill(-1);let n=0,r=1,i=14;for(;n<i;n++)t&r&&(this.m_semanticsToIndexMap[n]=this.m_attributeCount,this.m_indexToSemantics[this.m_attributeCount]=n,this.m_attributeCount++,this.m_totalComponentCount+=e.getComponentCount(n)),r<<=1;let a=0;for(n=0,i=this.getAttributeCount();n<i;n++){let t=this.getSemantics(n),r=e.getComponentCount(t),i=e.getDefaultValue(t);this.m_pointAttributeOffsets[n]=a;for(let e=0;e<r;e++)this.m_defaultPointAttributes[a]=i,a++}}},zt=Rt;function Bt(){return H(14,0)}var Vt=class e{static getInstance(){return e.s_thisInstance}constructor(){this.m_map=new Map,this.m_vd2D=new zt(1),this.m_map.set(1,this.m_vd2D),this.m_vd3D=new zt(3),this.m_map.set(3,this.m_vd2D)}GetVD2D(){return this.m_vd2D}GetVD3D(){return this.m_vd3D}FindOrAdd(e){if(e===1)return this.GetVD2D();if(e===3)return this.GetVD3D();let t=this.m_map.get(e);if(t)return t;let n=new zt(e);return this.m_map.set(e,n),n}};function Ht(e){return Vt.getInstance().FindOrAdd(e)}function Ut(e,t){if(!e||!t)return t||e;let n=e.getSemanticsBitArray()|t.getSemanticsBitArray();return(n&e.getSemanticsBitArray())===n?e:(n&t.getSemanticsBitArray())===n?t:Ht(n)}function Wt(e,t){let n=e.getSemanticsBitArray()|1<<t;return(n&e.getSemanticsBitArray())===n?e:Ht(n)}function Gt(e,t){let n=(e.getSemanticsBitArray()|1<<t)-(1<<t);return n===e.getSemanticsBitArray()?e:Ht(n)}function Kt(){return Vt.getInstance().GetVD2D()}function qt(){return Vt.getInstance().GetVD3D()}function Jt(e,t,n){if(n.fill(-1),e!==null&&t!==null)for(let r=0,i=e.getAttributeCount();r<i;r++)n[r]=t.getAttributeIndex(e.getSemantics(r))}Vt.s_thisInstance=new Vt;var K=class e{static construct(t,n,r){return new e(t,n,r)}constructor(e,t,n){e===void 0?this.x=this.y=this.z=NaN:(this.x=e,this.y=t,this.z=n)}get 0(){return this.x}get 1(){return this.y}get 2(){return this.z}set 0(e){this.x=e}set 1(e){this.y=e}set 2(e){this.z=e}clone(){return new e(this.x,this.y,this.z)}assign(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}setCoords(e,t,n){return this.x=e,this.y=t,this.z=n,this}setCoordsPoint2DZ(e,t){return this.setCoords(e.x,e.y,t)}setCoordsPoint3D(e){this.x=e.x,this.y=e.y,this.z=e.z}setZero(){this.x=0,this.y=0,this.z=0}setNormalized(e){this.assign(e),this.normalizeThis()}normalizeThis(){let e=this.length();return e?(this.x/=e,this.y/=e,this.z/=e):(this.x=1,this.y=0,this.z=0),this}getUnitVector(){let t=new e;return t.setNormalized(this),t}sqrLength(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthXY(){return U(0),0}static sqrDistance(e,t){return Ct(e.x-t.x)+Ct(e.y-t.y)+Ct(e.z-t.z)}static sqrDistanceCoords(e,t,n,r,i,a){return Ct(e-r)+Ct(t-i)+Ct(n-a)}static distance(t,n){return Math.sqrt(e.sqrDistance(t,n))}isEqual(e,t){return t===void 0&&(t=0),Math.abs(this.x-e.x)<=t&&Math.abs(this.y-e.y)<=t&&et(this.z,e.z,t)}static compareByLength(e,t,n,r){return U(0),0}isEqualCoords(e,t,n,r){return U(0),this.x===e&&this.y===t&&this.z===n}isEqualsTols(e,t,n){return U(0),!1}isEqualCoordsTols(e,t,n,r,i){return U(0),!1}static st_isEqual(e,t,n,r){return U(0),!1}equals(e,t){return this.isEqual(e,t)}equalsTols(e,t,n){return U(0),!1}divThis(e){return this.x/=e,this.y/=e,this.z/=e,this}subThis(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}setSub(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}sub(t){return e.construct(this.x-t.x,this.y-t.y,this.z-t.z)}addThis(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}add(e){return this.clone().addThis(e)}setAdd(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}mul(t){return e.construct(this.x*t,this.y*t,this.z*t)}dotProduct(e){return this.x*e.x+this.y*e.y+this.z*e.z}crossProductVector(t){let n=this.y*t.z-t.y*this.z,r=t.x*this.z-this.x*t.z,i=this.x*t.y-t.x*this.y;return new e(n,r,i)}setCrossProductVector(e,t){let n=e.y*t.z-t.y*e.z,r=t.x*e.z-e.x*t.z,i=e.x*t.y-t.x*e.y;return this.x=n,this.y=r,this.z=i,this}setScaled(e,t){return this.x=e*t.x,this.y=e*t.y,this.z=e*t.z,this}scaleThis(e){return this.x*=e,this.y*=e,this.z*=e,this}scaleZThis(e){return this.z*=e,this}setNAN(){return U(0),this}isNAN(){return Number.isNaN(this.x)||Number.isNaN(this.y)||Number.isNaN(this.z)}static getNAN(){return e.construct(NaN,NaN,NaN)}isFinite(){return U(0),!1}isZero(){return this.x===0&&this.y===0&&this.z===0}norm(e){return U(0),0}sqrDistanceFromCenterToSpheroidSurface(e,t){return U(0),0}distanceFromCenterToSpheroidSurface(e,t){return Math.sqrt(this.sqrDistanceFromCenterToSpheroidSurface(e,t))}static getClosestCoordinate(e,t,n,r=!1){return U(0),0}compare(e){return this.y<e.y?-1:this.y>e.y?1:this.x<e.x?-1:this.x>e.x?1:this.z<e.z?-1:this.z>e.z?1:0}compareXYZ(e){return U(0),0}negateThis(){this.x=-this.x,this.y=-this.y,this.z=-this.z}static averageFast(e,t){return U(0),{}}static average(e,t){return U(0),{}}static size(){return e.dimensions}static lerp(t,n,r){let i=new e;return f(t,n,r,i),i}static slerp(e,t,n){return U(0),{}}static compareVectors(e,t){return U(0),0}static selectRightHandedBasisFromNormal(t,n,r){let i=t.getUnitVector(),a=i.createAPerpendicular(),o=new e;o.setCrossProductVector(i,a),o.normalizeThis(),n.setCoordsPoint3D(a),r.setCoordsPoint3D(o)}createAPerpendicular(){let t=[this.crossProductVector(new e(0,0,1)),this.crossProductVector(new e(1,0,0)),this.crossProductVector(new e(0,1,0))],n=[t[0].sqrLength(),t[1].sqrLength(),t[2].sqrLength()],r=t[n.reduce((e,t,r)=>n[e]>n[r]?e:r,0)];return r.normalizeThis(),r}calculateAngle(e){return U(0),0}static crossDotSign(e,t,n){return U(0),0}static isBisectorRobust(e,t,n){return U(0),0}static compareZOrder(e,t){return U(0),!1}};K.dimensions=3;var Yt=class e{static constructEmpty(){return new e(NaN,NaN,NaN,NaN,NaN,NaN)}constructor(e,t,n,r,i,a){this.m_EnvelopeType=3,this.xmin=e,this.ymin=t,this.zmin=n,this.xmax=r,this.ymax=i,this.zmax=a,this.normalize()}inflate(e){this.inflateCoords(e,e,e)}inflateCoords(e,t,n){U(0)}getEnvelope2D(){return new G(this.xmin,this.ymin,this.xmax,this.ymax)}getEnvelopeZs(){return new I(this.zmin,this.zmax)}setEmptyZ(){this.zmin=NaN,this.zmax=NaN}normalize(){let e=!1;this.xmin<=this.xmax||(this.xmax=W(this.xmin,this.xmin=this.xmax),e=!0),this.ymin<=this.ymax||(this.ymax=W(this.ymin,this.ymin=this.ymax),e=!0),!e||this.xmin<=this.xmax&&this.ymin<=this.ymax?this.zmin<=this.zmax||(this.zmax=W(this.zmin,this.zmin=this.zmax),this.zmin<=this.zmax||this.setEmptyZ()):this.setEmpty()}isEmpty(){return Number.isNaN(this.xmin)||Number.isNaN(this.ymin)||Number.isNaN(this.xmax)||Number.isNaN(this.ymax)}isEmptyZ(){return Number.isNaN(this.zmin)||Number.isNaN(this.zmax)}setEmpty(){this.xmin=NaN,this.ymin=NaN,this.zmin=NaN,this.xmax=NaN,this.ymax=NaN,this.zmax=NaN}mergeEnv3D(e){e.isEmpty()||(this.mergeCoords(e.xmin,e.ymin,e.zmin),this.mergeCoords(e.xmax,e.ymax,e.zmax))}mergeNe(e){this.mergeNeCoords(e.x,e.y,e.z)}mergeNeCoords(e,t,n){this.xmin>e?this.xmin=e:this.xmax<e&&(this.xmax=e),this.ymin>t?this.ymin=t:this.ymax<t&&(this.ymax=t),this.zmin>n?this.zmin=n:this.zmax<n&&(this.zmax=n)}mergeCoords(e,t,n){this.isEmpty()?(this.xmin=e,this.xmax=e,this.ymin=t,this.ymax=t,this.zmin=n,this.zmax=n):(this.isEmptyZ()&&(this.zmin=n,this.zmax=n),this.mergeNeCoords(e,t,n))}setCoords(e,t,n,r,i,a){this.xmin=e,this.ymin=t,this.zmin=n,this.xmax=r,this.ymax=i,this.zmax=a,this.normalize()}sqrDistanceEnvelope3DAndPoints(e,t,n,r=1){return U(0),0}sqrMaxDistance(e,t=1){return U(0),0}},Xt=-559038737,Zt=Rt;function Qt(e,t,n){switch(e){case 0:return new cn(t,n);case 1:return new ln(t,n);case 2:return new sn(t,n);case 3:throw Error(`64 bit int attribute stream not implemented`);case 4:return new on(t,n);default:R(``)}}function $t(e,t){let n=Zt.getComponentCount(e);return Qt(Zt.getPersistence(e),t*n,Zt.getDefaultValue(e))}function en(e,t){let n=Zt.getComponentCount(e);return Qt(Zt.getPersistence(e),t*n)}function tn(e,t){return new sn(e,t)}function nn(e,t){return new on(e,t)}function rn(e,t){return new ln(e,t)}var an=class e{size(){return this.m_size}checkResize(e,t){e>this.m_size&&this.resize(e,t)}resize(t,n){if((t=Math.trunc(t))===this.m_size)return;let r=!!n||Number.isNaN(n);if(t<this.m_a.length)this.m_a.length>e.s_resizeMin&&1.25*t<this.m_a.length&&(this.m_a=this.m_a.slice(0,t)),r&&t>this.m_size&&this.m_a.fill(n,this.m_size,t);else if(t>=this.m_a.length){let e=1.25*t,i=new this.m_a.constructor(e);i.set(this.m_a),this.m_a=i,r&&this.m_a.fill(n,this.m_size,t)}this.m_size=t}resizeRounded(e,t){return this.resize(e,t)}reserve(e){}read(e){return this.m_a[e]}readAsDbl(e){return this.read(e)}write(e,t){this.m_a[e]=t}writeAsDbl(e,t){this.write(e,t)}setRange(e,t,n){(t<0||n<0||n+t>this.size())&&R(),this.m_a.fill(e,t,t+n)}add(e){this.resize(this.m_size+1),this.m_a[this.m_size-1]=e}addArray(e,t){let n=this.m_size;t===void 0?(this.resize(this.m_size+e.length),this.m_a.set(e,n)):(this.resize(this.m_size+t),this.m_a.set(e.slice(0,t),n))}equals(e,t,n,r){return this.getPersistence()===e.getPersistence()?un(this,e,t,n,r):!1}insertRange(e,t,n,r){let i=this.m_size;this.checkResize(Math.max(0,r)+n),this.m_a.copyWithin(e+n,e,r>=0?r:i),this.m_a.fill(t,e,e+n)}readRange(e,t){return this.m_a.slice(e,e+t)}insertRangeFromStream(e,t,n,r,i,a,o){U(this.getPersistence()===t.getPersistence());let s=t,c=this.m_size;r&&this.checkResize(Math.max(0,o)+r),this.m_a.copyWithin(e+r,e,o>=0?o:c),this.m_a.set(s.readRange(n,r),e),i||this.reverseRange(e,r,a)}writeRange(e,t,n,r,i,a){U(this.getPersistence()===n.getPersistence());let o=n;if((e<0||t<0||r<0)&&R(),o.size()<r+t&&R(),t===0)return;this.size()<t+e&&this.resize(t+e);let s=o.m_a.subarray(r,r+t);dn(this.m_a,e,t,s)}insertAttributes(e,t,n,r){let i=Zt.getComponentCount(n);this.m_a.copyWithin(e+i,e,r>=0?r:this.m_size);for(let r=0;r<i;r++)this.m_a[e+r]=t.getAttributeAsDbl(n,r)}insertAttributesFromPoints(e,t,n,r,i){U(Zt.getPersistence(r)===this.getPersistence());let a=Zt.getComponentCount(r),o=this.m_size;if(this.checkResize(Math.max(0,i)+a*n),this.m_a.copyWithin(e+a*n,e,i>=0?i:o),r===0){let r=new z;for(let i=e,a=0;a<n;a++,i+=2)t[a].queryXY(r),this.m_a[i]=r.x,this.m_a[i+1]=r.y}else if(a===1)for(let i=e,a=0;a<n;a++,i++)this.m_a[i]=t[a].getAttributeAsDbl(r,0);else for(let i=e,o=0;o<n;o++,i+=a)for(let e=0;e<a;e++)this.m_a[i+e]=t[o].getAttributeAsDbl(r,e)}eraseRange(e,t,n){this.m_size<e+t&&R(),this.m_a.copyWithin(e,e+t),this.m_size-=t}reverseRange(e,t,n){if((n<1||t%n!==0)&&R(),this.m_a.subarray(e,e+t).reverse(),n>1)for(let r=e,i=e+t;r<i;r+=n){let e=r,t=r+n-1;for(;e<t;){let n=this.m_a[e];this.m_a[e]=this.m_a[t],this.m_a[t]=n,e++,t--}}}rotate(e,t,n){(t<e||t>n||e>n)&&E(`rotate`),t!==e&&t!==n&&(this.reverseRange(e,t-e,1),this.reverseRange(t,n-t,1),this.reverseRange(e,n-e,1))}sort(e,t,n){this.m_a.subarray(e,t).sort(n)}constructor(t){if(t.move)this.m_a=t.move.m_a,this.m_size=t.move.m_size,t.move.m_a=t.move.m_a.slice(0,0),t.move.m_size=0;else if(t.copy)this.m_size=t.copy.m_size,t.maxSize&&(this.m_size=Math.min(t.maxSize,this.m_size)),this.m_a=t.copy.m_a.slice(0,this.m_size);else{let n=Math.max(t.size,e.s_constructMin);this.m_a=new t.ctor(n),(t.defaultValue||Number.isNaN(t.defaultValue))&&this.m_a.fill(t.defaultValue),this.m_size=t.size}}};an.s_constructMin=2,an.s_resizeMin=30;var on=class e extends an{setBits(e,t){this.m_a[e]|=t}clearBits(e,t){this.m_a[e]&=~t}getPersistence(){return 4}clone(){return new e({ctor:Int8Array,copy:this})}restrictedClone(t){return new e({ctor:Int8Array,copy:this,maxSize:t})}constructor(e,t){super(typeof e==`number`?{ctor:Int8Array,size:e,defaultValue:t}:e)}},sn=class e extends an{getPersistence(){return 2}clone(){return new e({ctor:Int32Array,copy:this})}restrictedClone(t){return new e({ctor:Int32Array,copy:this,maxSize:t})}write(e,t){U(t<=Ve()),super.write(e,t)}constructor(e,t){super(typeof e==`number`?{ctor:Int32Array,size:e,defaultValue:t}:e)}},cn=class e extends an{getPersistence(){return 0}clone(){return new e({ctor:Float32Array,copy:this})}restrictedClone(t){return new e({ctor:Float32Array,copy:this,maxSize:t})}constructor(e,t){super(typeof e==`number`?{ctor:Float32Array,size:e,defaultValue:t}:e)}},ln=class e extends an{getPersistence(){return 1}getArray(){return this.m_a}applyTransformation(e,t,n){(1&t||t+2*n>this.size())&&R();let r=t===0?this.m_a:this.m_a.subarray(t);e.transformInterleavedPoints(r,n,r)}readPoint2D(e){let t=this.m_a[e],n=this.m_a[e+1];return new z(t,n)}queryPoint2D(e,t){return t.x=this.m_a[e],t.y=this.m_a[e+1],t}writePoint2D(e,t){this.write(e,t.x),this.write(e+1,t.y)}insert(e,t,n){this.checkResize(n+2),this.m_a.copyWithin(e+2,e,n),this.m_a[e]=t.x,this.m_a[e+1]=t.y}insertRangeFromPoints(e,t,n,r,i,a){let o=this.m_size;if(this.checkResize(Math.max(a,0)+2*r),this.m_a.copyWithin(e+2*r,e,a>=0?a:o),i)for(let i=n,a=e,o=0;o<r;++o,++i){let e=t[i];this.m_a[a++]=e.x,this.m_a[a++]=e.y}else for(let i=n+r-1,a=e,o=0;o<r;++o,--i){let e=t[i];this.m_a[a++]=e.x,this.m_a[a++]=e.y}}queryRange(e,t,n,r,i){if((e<0||t<0)&&R(),!r&&(i<=0||t%i!==0)&&R(),t===0)return;if(t===1)return void(n[0]=this.m_a[e]);let a=this.m_a.subarray(e,e+t);n.set(a)}writeRangeFromArray(e,t,n,r,i){if((e<0||t<0)&&R(),t===0)return;if(t===1)return void(this.m_a[e]=n[0]);let a=n;t<n.length&&(a=n.subarray(0,t)),this.m_a.set(a,e)}clone(){return new e({ctor:Float64Array,copy:this})}restrictedClone(t){return new e({ctor:Float64Array,copy:this,maxSize:t})}constructor(e,t){super(typeof e==`number`?{ctor:Float64Array,size:e,defaultValue:t}:e)}};function un(e,t,n,r,i){if(e.getPersistence()!==t.getPersistence())return!1;let a=e.getPersistence()<=1,o=e.size(),s=t.size();if(r>o||r>s)return!1;if(i)if(a){for(let a=n;a<r;a++)if(!et(e.read(a),t.read(a),i))return!1}else for(let a=n;a<r;a++){let n=e.read(a)-t.read(a);if(n<0&&(n=-n),n>i)return!1}else for(let i=n;i<r;i++){let n=e.read(i),r=t.read(i);if(n!==r){if(a&&Number.isNaN(n)&&Number.isNaN(r))continue;return!1}}return!0}function dn(e,t,n,r,i,a){if((t<0||n<0)&&R(),n===0)return;if(n===1)return void(e[t]=r[0]);let o=r;n<r.length&&(o=r.subarray(0,n)),e.set(o,t)}var fn=class e{constructor(){this.m_minValue=-1,this.m_maxValue=-1,this.m_dy=NaN,this.m_buckets=new sn(0),this.m_bucketedIndices=new sn(0)}static sortEx(t,n,r,i,a=32){if(r-n<=a)return void i.userSort(n,r,t);new e().sort(t,n,r,i,a)}sort(e,t,n,r,i=32){if(n-t<=i)return void r.userSort(t,n,e);let a=!0,o=1/0,s=-1/0;for(let i=t;i<n;i++){let t=r.getValue(e.read(i));t<o&&(o=t),t>s&&(s=t)}if(this.reset(n-t,o,s,n-t)){for(let i=t;i<n;i++){let n=e.read(i),a=r.getValue(n),o=this.getBucket(a);this.m_buckets.write(o,this.m_buckets.read(o)+1),this.m_bucketedIndices.write(i-t,n)}let i=this.m_buckets.read(0);this.m_buckets.write(0,0);for(let e=1,t=this.m_buckets.size();e<t;e++){let t=this.m_buckets.read(e);this.m_buckets.write(e,i),i+=t}for(let i=t;i<n;i++){let n=this.m_bucketedIndices.read(i-t),a=r.getValue(n),o=this.getBucket(a),s=this.m_buckets.read(o);e.write(s+t,n),this.m_buckets.write(o,s+1)}a=!1}if(a)return void r.userSort(t,n,e);let c=0;for(let n=0,i=this.m_buckets.size();n<i;n++){let i=c;c=this.m_buckets.read(n),c>i&&r.userSort(t+i,t+c,e)}this.m_buckets.size()>100&&(this.m_buckets.resize(0),this.m_bucketedIndices.resize(0))}reset(t,n,r,i){if(t<2||r===n)return!1;let a=Math.min(e.c_maxBuckets,t);return this.m_buckets.resize(a),this.m_buckets.setRange(0,0,this.m_buckets.size()),this.m_minValue=n,this.m_maxValue=r,this.m_bucketedIndices.resize(i),this.m_dy=(r-n)/(a-1),!0}getBucket(e){return Math.trunc((e-this.m_minValue)/this.m_dy)}getBucketCount(){return this.m_buckets.size()}};fn.c_maxBuckets=65536;var pn=class{capacity(){return this.capacity_}constructor(e){this.m_buffer=new Int32Array,this.m_firstFree=-1,this.m_last=0,this.size_=0,this.capacity_=0,this.stride=e}size(){return this.size_}deleteElement(e){e<this.m_last?(this.m_buffer[e*this.stride]=this.m_firstFree,this.m_firstFree=e):this.m_last--,this.size_--}getField(e,t){return this.m_buffer[e*this.stride+t]}setField(e,t,n){this.m_buffer[e*this.stride+t]=n}elementToIndex(e){return e}newElement(){let e=this.m_firstFree;if(e===-1){if(this.m_last===this.capacity_){let e=this.capacity_===0?1:Math.trunc(3*(this.capacity_+1)/2);if(e>2**53-1&&(e=2**53-1),e===this.capacity_)throw Error(`index out of bounds`);this.grow_(e)}e=this.m_last,this.m_last++}else this.m_firstFree=this.m_buffer[e*this.stride];this.size_++;for(let t=e*this.stride;t<e*this.stride+this.stride;t++)this.m_buffer[t]=-1;return e}newElementPset(e){let t=this.m_firstFree;if(t===-1){if(this.m_last===this.capacity_){let e=this.capacity_===0?1:Math.trunc(3*(this.capacity_+1)/2);if(e>2**53-1&&(e=2**53-1),e===this.capacity_)throw Error(`index out of bounds`);this.grow_(e)}t=this.m_last,this.m_last++}else this.m_firstFree=this.m_buffer[t*this.stride];this.size_++;let n=t*this.stride;for(let t=0;t<e.length;t++)this.m_buffer[n+t]=e[t];return t}deleteAll(e){this.m_firstFree=-1,this.m_last=0,this.size_=0,e&&(this.m_buffer=new Int32Array,this.capacity_=0)}setCapacity(e){e>this.capacity_&&this.grow_(e)}swap(e,t){let n=e*this.stride,r=t*this.stride;for(let e=0;e<this.stride;e++){let t=this.m_buffer[r+e];this.m_buffer[r+e]=this.m_buffer[n+e],this.m_buffer[n+e]=t}}swapField(e,t,n){let r=this.m_buffer[this.stride*t+n];this.m_buffer[this.stride*t+n]=this.m_buffer[this.stride*e+n],this.m_buffer[this.stride*e+n]=r}static impossibleIndex2(){return-2}static impossibleIndex3(){return-3}static isValidElement(e){return e>=0}grow_(e){this.m_buffer??=new Int32Array;let t=this.stride*e,n=new Int32Array(t);n.set(this.m_buffer,0),this.m_buffer=n,this.capacity_=e}};function mn(e,t){return{element:e,box:t.clone()}}var hn=class e{constructor(e,t,n){this.m_extent=new G,this.m_dataExtent=new G,this.m_childExtents=[new G,new G,new G,new G],this.m_elementNodes=new pn(4),this.m_data=[],this.m_freeData=[],this.m_root=-1,this.m_height=8,n===void 0&&(n=!1),this.m_quadTreeNodes=new pn(n?11:10),this.m_bStoreDuplicates=n,this.reset_(e,t)}reset(e,t){this.m_quadTreeNodes.deleteAll(!1),this.m_elementNodes.deleteAll(!1),this.m_data.length=0,this.m_freeData.length=0,this.reset_(e,t)}insert(e,t){if(this.m_root===-1&&this.createRoot_(),this.m_bStoreDuplicates){let n=this.insertDuplicates_(e,t,0,this.m_extent,this.m_root,!1,-1);return n!==-1&&(this.m_dataExtent.isEmpty()?this.m_dataExtent.setCoords({env2D:t}):this.m_dataExtent.mergeEnvelope2D(t)),n}let n=this.insert_(e,t,0,this.m_extent,this.m_root,!1,-1);return n!==-1&&(this.m_dataExtent.isEmpty()?this.m_dataExtent.setCoords({env2D:t}):this.m_dataExtent.mergeEnvelope2D(t)),n}insertEx(e,t,n){if(this.m_root===-1&&this.createRoot_(),this.m_bStoreDuplicates){let n=this.insertDuplicates_(e,t,0,this.m_extent,this.m_root,!1,-1);return n!==-1&&(this.m_dataExtent.isEmpty()?this.m_dataExtent.setCoords({env2D:t}):this.m_dataExtent.mergeEnvelope2D(t)),n}let r;r=n===-1?this.m_root:this.getQuad_(n);let i=this.getHeight(r),a=this.getExtent(r),o=this.insert_(e,t,i,a,r,!1,-1);return o!==-1&&(this.m_dataExtent.isEmpty()?this.m_dataExtent.setCoords({env2D:t}):this.m_dataExtent.mergeEnvelope2D(t)),o}removeElement(e){U(0)}getElement(e){return this.getElementValue_(this.getData_(e))}getElementAtIndex(e){return U(0),0}getElementExtent(e){let t=this.getData_(e);return this.getBoundingBoxValue_(t).clone()}getElementExtentAtIndex(e){return U(0),{}}getDataExtent(){return this.m_dataExtent.clone()}getQuadTreeExtent(){return U(0),{}}getHeight(t){return this.m_quadTreeNodes.getField(t,6)>>e.m_heightBitShift}getMaxHeight(){return this.m_height}getExtent(e){let t=new G;if(t.setCoords({env2D:this.m_extent}),e===this.m_root)return t;let n=[],r=e;do n.push(this.getQuadrant_(r)),r=this.getParent_(r);while(r!==this.m_root);let i=n.length;for(let e=0;e<i;e++){let e=n.at(-1);n.pop(),e===0?(t.xmin=.5*(t.xmin+t.xmax),t.ymin=.5*(t.ymin+t.ymax)):e===1?(t.xmax=.5*(t.xmin+t.xmax),t.ymin=.5*(t.ymin+t.ymax)):e===2?(t.xmax=.5*(t.xmin+t.xmax),t.ymax=.5*(t.ymin+t.ymax)):(t.xmin=.5*(t.xmin+t.xmax),t.ymax=.5*(t.ymin+t.ymax))}return t}getQuad(e){return this.getQuad_(e)}getElementCount(){return this.m_root===-1?0:this.getSubTreeElementCount_(this.m_root)}getSubTreeElementCount(e){return this.getSubTreeElementCount_(e)}getContainedSubTreeElementCount(e){return this.m_bStoreDuplicates?this.getContainedSubTreeElementCount_(e):this.getSubTreeElementCount_(e)}getIntersectionCount(t,n,r){if(this.m_root===-1)return 0;let i=new G;i.setCoords({env2D:t}),i.inflateCoords(n,n);let a=[],o=[];a.push(this.m_root),o.push(this.m_extent.clone());let s=C(G,4),c=0;for(;a.length>0;){let t=!1,n=a.at(-1),l=o.at(-1);if(a.pop(),o.pop(),i.containsEnvelope(l)){if(c+=this.getSubTreeElementCount(n),r>0&&c>=r)return r}else if(i.isIntersecting(l)){for(let e=this.getFirstElement_(n);e!==-1;e=this.getNextElement_(e)){let t=this.getData_(e);if(this.getBoundingBoxValue_(t).isIntersecting(i)&&(c++,r>0&&c>=r))return r}t=this.getHeight(n)+1<=this.m_height}if(t){e.setChildExtents_(l,s);for(let e=0;e<4;e++){let t=this.getChild_(n,e);t!==-1&&this.getSubTreeElementCount_(t)>0&&i.isIntersecting(s[e])&&(a.push(t),o.push(s[e].clone()))}}}return c}hasData(e,t){return this.getIntersectionCount(e,t,1)>=1}getIterator(e,t){return new gn(this,e,t)}getIteratorForQT(){return new gn(this)}getSortedIterator(e,t){return new _n(this.getIterator(e,t))}getSortedIteratorForQT(){return new _n(this.getIteratorForQT())}visitLeavesNearest(e,t,n,r){U(0)}reset_(e,t){(t<0||t>127)&&R(`invalid height`),this.m_height=t,this.m_extent.setCoords({env2D:e}),this.m_dataExtent.setEmpty(),this.m_root=-1}insert_(t,n,r,i,a,o,s){if(!i.containsEnvelope(n))return r===0?-1:this.insert_(t,n,0,this.m_extent,this.m_root,o,s);if(!o)for(let e=a;e!==-1;e=this.getParent_(e))this.setSubTreeElementCount_(e,this.getSubTreeElementCount_(e)+1);let c=new G;c.setCoords({env2D:i});let l,u=a;for(l=r;l<this.m_height&&this.canPushDown_(u);l++){e.setChildExtents_(c,this.m_childExtents);let t=!1;for(let e=0;e<4;e++)if(this.m_childExtents[e].containsEnvelope(n)){t=!0;let n=this.getChild_(u,e);n===-1&&(n=this.createChild_(u,e)),this.setSubTreeElementCount_(n,this.getSubTreeElementCount_(n)+1),u=n,c.setCoords({env2D:this.m_childExtents[e]});break}if(!t)break}return this.insertAtQuad_(t,n,l,c,u,o,a,s,-1)}insertDuplicates_(t,n,r,i,a,o,s){if(!o){if(!i.containsEnvelope(n))return-1;this.setSubTreeElementCount_(a,this.getSubTreeElementCount_(a)+1),this.setContainedSubTreeElementCount_(a,this.getContainedSubTreeElementCount_(a)+1)}let c=Math.max(n.width(),n.height()),l=-1,u=[],d=[],f=[];u.push(a),d.push(i.clone()),f.push(r);let p=C(G,4);for(;u.length>0;){let r=!1,i=u.at(-1),m=d.at(-1),h=f.at(-1);if(u.pop(),d.pop(),f.pop(),h+1<this.m_height&&this.canPushDown_(i)&&c<=Math.max(m.width(),m.height())/2&&(r=!0),r){e.setChildExtents_(m,p);let t=!1;for(let e=0;e<4;e++)if(t=p[e].containsEnvelope(n),t){let t=this.getChild_(i,e);t===-1&&(t=this.createChild_(i,e)),u.push(t),d.push(p[e].clone()),f.push(h+1),this.setSubTreeElementCount_(t,this.getSubTreeElementCount_(t)+1),this.setContainedSubTreeElementCount_(t,this.getContainedSubTreeElementCount_(t)+1);break}if(!t){for(let e=0;e<4;e++)if(p[e].isIntersecting(n)){let t=this.getChild_(i,e);t===-1&&(t=this.createChild_(i,e)),u.push(t),d.push(p[e].clone()),f.push(h+1),this.setSubTreeElementCount_(t,this.getSubTreeElementCount_(t)+1)}}}else l=this.insertAtQuad_(t,n,h,m,i,o,a,s,l),o=!1}return 0}insertAtQuad_(e,t,n,r,i,a,o,s,c){this.getFirstElement_(i);let l=this.getLastElement_(i),u=-1;if(a){if(i===o)return s;this.disconnectElementHandle_(s),u=s}else c===-1?(u=this.createElement_(),this.setDataValues_(this.getData_(u),e,t)):u=this.createElementFromDuplicate_(c);return this.setQuad_(u,i),l===-1?this.setFirstElement_(i,u):(this.setPrevElement_(u,l),this.setNextElement_(l,u)),this.setLastElement_(i,u),this.setLocalElementCount_(i,this.getLocalElementCount_(i)+1),this.canFlush_(i)&&this.flush_(n,r,i),u}static setChildExtents_(e,t){let n=.5*(e.xmin+e.xmax),r=.5*(e.ymin+e.ymax);t[0].setCoords({xmin:n,ymin:r,xmax:e.xmax,ymax:e.ymax}),t[1].setCoords({xmin:e.xmin,ymin:r,xmax:n,ymax:e.ymax}),t[2].setCoords({xmin:e.xmin,ymin:e.ymin,xmax:n,ymax:r}),t[3].setCoords({xmin:n,ymin:e.ymin,xmax:e.xmax,ymax:r})}disconnectElementHandle_(e){let t=this.getQuad_(e),n=this.getFirstElement_(t),r=this.getLastElement_(t),i=this.getPrevElement_(e),a=this.getNextElement_(e);n===e?(a===-1?this.setLastElement_(t,-1):this.setPrevElement_(a,-1),this.setFirstElement_(t,a)):r===e?(this.setNextElement_(i,-1),this.setLastElement_(t,i)):(this.setPrevElement_(a,i),this.setNextElement_(i,a)),this.setPrevElement_(e,-1),this.setNextElement_(e,-1),this.setLocalElementCount_(t,this.getLocalElementCount_(t)-1)}canFlush_(t){return this.getLocalElementCount_(t)===e.m_flushingCount&&!this.hasChildren_(t)}flush_(e,t,n){let r,i=new G,a=this.getFirstElement_(n),o=-1,s=-1;do s=this.getData_(a),r=this.getElementValue_(s),i.setCoords({env2D:this.getBoundingBoxValue_(s)}),o=this.getNextElement_(a),this.m_bStoreDuplicates?this.insertDuplicates_(r,i,e,t,n,!0,a):this.insert_(r,i,e,t,n,!0,a),a=o;while(a!==-1)}canPushDown_(t){return this.getLocalElementCount_(t)>=e.m_flushingCount||this.hasChildren_(t)}hasChildren_(e){return this.getChild_(e,0)!==-1||this.getChild_(e,1)!==-1||this.getChild_(e,2)!==-1||this.getChild_(e,3)!==-1}createChild_(e,t){let n=this.m_quadTreeNodes.newElement();return this.setChild_(e,t,n),this.setSubTreeElementCount_(n,0),this.setLocalElementCount_(n,0),this.setParent_(n,e),this.setHeightAndQuadrant_(n,this.getHeight_(e)+1,t),this.m_bStoreDuplicates&&this.setContainedSubTreeElementCount_(n,0),n}createRoot_(){this.m_root=this.m_quadTreeNodes.newElement(),this.setSubTreeElementCount_(this.m_root,0),this.setLocalElementCount_(this.m_root,0),this.setHeightAndQuadrant_(this.m_root,0,0),this.m_bStoreDuplicates&&this.setContainedSubTreeElementCount_(this.m_root,0)}createElement_(){let e=this.m_elementNodes.newElement(),t;return this.m_freeData.length>0?(t=this.m_freeData.at(-1),this.m_freeData.pop()):(t=this.m_data.length,this.m_data.length=t+1),this.setData_(e,t),e}createElementFromDuplicate_(e){let t=this.m_elementNodes.newElement(),n=this.getData_(e);return this.setData_(t,n),t}freeElementAndBoxNode_(e){U(0)}getChild_(e,t){return this.m_quadTreeNodes.getField(e,t)}setChild_(e,t,n){this.m_quadTreeNodes.setField(e,t,n)}getFirstElement_(e){return this.m_quadTreeNodes.getField(e,4)}setFirstElement_(e,t){this.m_quadTreeNodes.setField(e,4,t)}getLastElement_(e){return this.m_quadTreeNodes.getField(e,5)}setLastElement_(e,t){this.m_quadTreeNodes.setField(e,5,t)}getQuadrant_(t){return this.m_quadTreeNodes.getField(t,6)&e.m_quadrantMask}getHeight_(t){return this.m_quadTreeNodes.getField(t,6)>>e.m_heightBitShift}setHeightAndQuadrant_(t,n,r){let i=n<<e.m_heightBitShift|r;this.m_quadTreeNodes.setField(t,6,i)}getLocalElementCount_(e){return this.m_quadTreeNodes.getField(e,7)}setLocalElementCount_(e,t){this.m_quadTreeNodes.setField(e,7,t)}getSubTreeElementCount_(e){return this.m_quadTreeNodes.getField(e,8)}setSubTreeElementCount_(e,t){this.m_quadTreeNodes.setField(e,8,t)}getParent_(e){return this.m_quadTreeNodes.getField(e,9)}setParent_(e,t){this.m_quadTreeNodes.setField(e,9,t)}getContainedSubTreeElementCount_(e){return this.m_quadTreeNodes.getField(e,10)}setContainedSubTreeElementCount_(e,t){this.m_quadTreeNodes.setField(e,10,t)}getData_(e){return this.m_elementNodes.getField(e,0)}setData_(e,t){this.m_elementNodes.setField(e,0,t)}getPrevElement_(e){return this.m_elementNodes.getField(e,1)}getNextElement_(e){return this.m_elementNodes.getField(e,2)}setPrevElement_(e,t){this.m_elementNodes.setField(e,1,t)}setNextElement_(e,t){this.m_elementNodes.setField(e,2,t)}getQuad_(e){return this.m_elementNodes.getField(e,3)}setQuad_(e,t){this.m_elementNodes.setField(e,3,t)}getElementValue_(e){return this.m_data[e].element}getBoundingBoxValue_(e){return this.m_data[e].box}setDataValues_(e,t,n){this.m_data[e]=mn(t,n)}};hn.m_quadrantMask=3,hn.m_heightBitShift=2,hn.m_flushingCount=5;var gn=class{constructor(e,t,n){this.m_bLinear=!1,this.m_queryStart=new z,this.m_queryEnd=new z,this.m_queryBox=new G,this.m_tolerance=0,this.m_currentElementHandle=-1,this.m_nextElementHandle=-1,this.m_quadsStack=[],this.m_extentsStack=[],this.m_childExtents=[new G,new G,new G,new G],this.m_quadTree=e,t&&this.resetIterator(t,n)}resetIterator(e,t){if(t===void 0&&(t=0),e instanceof G)return this.m_quadsStack.length=0,this.m_extentsStack.length=0,this.m_currentElementHandle=-1,this.m_queryBox.setCoords({env2D:e}),this.m_queryBox.inflateCoords(t,t),this.m_tolerance=NaN,void(this.m_quadTree.m_root!==-1&&this.m_queryBox.isIntersecting(this.m_quadTree.m_extent)?(this.m_quadsStack.push(this.m_quadTree.m_root),this.m_extentsStack.push(this.m_quadTree.m_extent.clone()),this.m_nextElementHandle=this.m_quadTree.getFirstElement_(this.m_quadTree.m_root),this.m_bLinear=!1):this.m_nextElementHandle=-1);if(this.m_quadsStack.length=0,this.m_extentsStack.length=0,this.m_currentElementHandle=-1,e.queryLooseEnvelope(this.m_queryBox),this.m_queryBox.inflateCoords(t,t),this.m_quadTree.m_root!==-1&&this.m_queryBox.isIntersecting(this.m_quadTree.m_extent)){if(this.m_bLinear=e.getGeometryType()===L.enumLine,this.m_bLinear){let n=e;this.m_queryStart.assign(n.getStartXY()),this.m_queryEnd.assign(n.getEndXY()),this.m_tolerance=t}else this.m_tolerance=NaN;this.m_quadsStack.push(this.m_quadTree.m_root),this.m_extentsStack.push(this.m_quadTree.m_extent.clone()),this.m_nextElementHandle=this.m_quadTree.getFirstElement_(this.m_quadTree.m_root)}else this.m_nextElementHandle=-1}next(){if(this.m_quadsStack.length===0)return-1;this.m_currentElementHandle=this.m_nextElementHandle;let e=new z,t=new z,n=new G,r=!1;for(;!r;){for(;this.m_currentElementHandle!==-1;){let i=this.m_quadTree.getData_(this.m_currentElementHandle);if(n.setCoords({env2D:this.m_quadTree.getBoundingBoxValue_(i)}),n.isIntersecting(this.m_queryBox)){if(!this.m_bLinear){r=!0;break}if(e.setCoordsPoint2D(this.m_queryStart),t.setCoordsPoint2D(this.m_queryEnd),n.inflateCoords(this.m_tolerance,this.m_tolerance),n.clipLine(e,t)>0){r=!0;break}}this.m_currentElementHandle=this.m_quadTree.getNextElement_(this.m_currentElementHandle)}if(this.m_currentElementHandle===-1){let n=this.m_quadsStack.at(-1),r=this.m_extentsStack.at(-1);hn.setChildExtents_(r,this.m_childExtents),this.m_quadsStack.pop(),this.m_extentsStack.pop();for(let r=0;r<4;r++){let i=this.m_quadTree.getChild_(n,r);if(i!==-1&&this.m_quadTree.getSubTreeElementCount(i)>0&&this.m_childExtents[r].isIntersecting(this.m_queryBox))if(this.m_bLinear){e.setCoordsPoint2D(this.m_queryStart),t.setCoordsPoint2D(this.m_queryEnd);let n=new G;n.setCoords({env2D:this.m_childExtents[r]}),n.inflateCoords(this.m_tolerance,this.m_tolerance),n.clipLine(e,t)>0&&(this.m_quadsStack.push(i),this.m_extentsStack.push(this.m_childExtents[r].clone()))}else this.m_quadsStack.push(i),this.m_extentsStack.push(this.m_childExtents[r].clone())}if(this.m_quadsStack.length===0)return-1;this.m_currentElementHandle=this.m_quadTree.getFirstElement_(this.m_quadsStack.at(-1))}}return this.m_nextElementHandle=this.m_quadTree.getNextElement_(this.m_currentElementHandle),this.m_currentElementHandle}clone(){return U(0),{}}},_n=class{constructor(e){this.m_bucketSort=new fn,this.m_sortedHandles=new sn(0),this.m_index=-1,this.m_quadTreeIteratorImpl=e}resetIterator(e,t){this.m_quadTreeIteratorImpl.resetIterator(e,t),this.m_sortedHandles.resize(0),this.m_index=-1}next(){if(this.m_index===-1){let e=-1;for(;(e=this.m_quadTreeIteratorImpl.next())!==-1;)this.m_sortedHandles.add(e);let t=this;this.m_bucketSort.sort(this.m_sortedHandles,0,this.m_sortedHandles.size(),{userSort(e,n,r){r.sort(e,n,(e,n)=>t.m_quadTreeIteratorImpl.m_quadTree.getElement(e)-t.m_quadTreeIteratorImpl.m_quadTree.getElement(n))},getValue:e=>t.m_quadTreeIteratorImpl.m_quadTree.getElement(e)})}return this.m_index===this.m_sortedHandles.size()-1?-1:(this.m_index++,this.m_sortedHandles.read(this.m_index))}clone(){return U(0),{}}},vn=class{constructor(e=!1){this.m_bNotifyOnActions=e}onDelete(e){}onSet(e){}onEndSearch(e){}onAddUniqueElementFailed(e){}onDeleteImpl(e,t){this.m_bNotifyOnActions&&this.onDelete(e.getElement(t))}onSetImpl(e,t){this.m_bNotifyOnActions&&this.onSet(e.getElement(t))}onAddUniqueElementFailedImpl(e){this.m_bNotifyOnActions&&this.onAddUniqueElementFailed(e)}onEndSearchImpl(e){this.m_bNotifyOnActions&&this.onEndSearch(e)}},yn=class e{static st_nullNode(){return-1}constructor(){this.m_defaultTreap=-1,this.m_random=124234251,this.m_comparator=null,this.m_treapData=new pn(7),this.m_treapCount=0,this.m_maxDepthEver=0,this.m_bBalancing=!0}setComparator(e){this.m_comparator=e}getComparator(){return this.m_comparator}disableBalancing(){this.m_bBalancing=!1}enableBalancing(){this.m_bBalancing||=(U(this.m_treapCount<=1),this.rebalance(-1),!0)}isAutoBalancing(){return this.m_bBalancing}rebalance(e){if(this.m_bBalancing||(e===-1&&(e=this.m_defaultTreap),this.size(e)===0))return;let t=[];for(let n=this.getFirst(e);n!==-1;n=this.getNext(n))t.push(n),this.setParent_(n,-1),this.setRight_(n,-1),this.setLeft_(n,-1);this.setRoot_(-1,e),this.setFirst_(-1,e),this.setLast_(-1,e),this.setSize_(0,e),this.m_bBalancing=!0;for(let n of t)this.addBiggestElement_(n,e);this.m_bBalancing=!1}setCapacity(e){this.m_treapData.setCapacity(e)}createTreap(e){let t=this.m_treapData.newElement();return this.setSize_(0,t),this.setTreapData_(e,t),this.m_treapCount++,t}deleteTreap(e){this.m_treapData.deleteElement(e),this.m_treapCount--}addElement(t,n=-1){return n===-1&&(this.m_defaultTreap===e.st_nullNode()&&(this.m_defaultTreap=this.createTreap(-1)),n=this.m_defaultTreap),this.addElement_(t,0,n)}addUniqueElement(t,n=-1){return n===-1&&(this.m_defaultTreap===e.st_nullNode()&&(this.m_defaultTreap=this.createTreap(-1)),n=this.m_defaultTreap),this.addElement_(t,1,n)}addBiggestElement(t,n=-1){n===-1&&(this.m_defaultTreap===e.st_nullNode()&&(this.m_defaultTreap=this.createTreap(-1)),n=this.m_defaultTreap);let r=this.newNode_(t);return this.addBiggestElement_(r,n),r}addElementAtPosition(t,n,r,i,a,o=-1){if(o===-1&&(this.m_defaultTreap===e.st_nullNode()&&(this.m_defaultTreap=this.createTreap(-1)),o=this.m_defaultTreap),this.getRoot_(o)===e.st_nullNode()){let e=this.newNode_(r);return this.setRoot_(e,o),this.addToList_(-1,e,o),e}let s,c,l,u,d;if(a?(s=n===e.st_nullNode()?-1:this.m_comparator.compare(this,r,n),c=t===e.st_nullNode()?1:this.m_comparator.compare(this,r,t)):(s=-1,c=1),i&&(s===0||c===0)){this.m_comparator.onAddUniqueElementFailedImpl(r);let e=s===0?n:t;return this.setDuplicateElement_(e,o),-1}d=n!==e.st_nullNode()&&t!==e.st_nullNode()?this.m_random>D(this.m_random)>>1:n!==e.st_nullNode(),d?(u=s,l=n):(u=c,l=t);let f=-1,p=-1,m=!0;for(;;){if(u<0){let t=this.getLeft(l);if(t===e.st_nullNode()){p=l,f=this.newNode_(r),this.setLeft_(l,f),this.setParent_(f,l);break}l=t}else{let t=this.getRight(l);if(t===e.st_nullNode()){p=this.getNext(l),f=this.newNode_(r),this.setRight_(l,f),this.setParent_(f,l);break}l=t}m&&=(u*=-1,!1)}return this.bubbleUp_(f),this.getParent(f)===e.st_nullNode()&&this.setRoot_(f,o),this.addToList_(p,f,o),f}replaceElementAtPosition(t,n,r,i,a=-1){if(i){let i=this.getNext(t),o=-1;i!==e.st_nullNode()&&(o=this.m_comparator.compare(this,n,i));let s=this.getPrev(t),c=-1;if(s!==e.st_nullNode()&&(c=this.m_comparator.compare(this,n,s)),r&&(o===0||c===0)){this.m_comparator.onAddUniqueElementFailedImpl(n);let t=o===0?i:s;return a===e.st_nullNode()&&(this.m_defaultTreap===e.st_nullNode()&&(this.m_defaultTreap=this.createTreap(-1)),a=this.m_defaultTreap),this.setDuplicateElement_(t,a),-1}}return this.setElement_(t,n),t}getDuplicateElement(e=-1){return e===-1?this.getDuplicateElement_(this.m_defaultTreap):this.getDuplicateElement_(e)}deleteNode(e,t=-1){this.m_comparator&&this.m_comparator.onDeleteImpl(this,e),t===-1&&(t=this.m_defaultTreap),this.m_bBalancing?this.deleteNode_(e,t):this.unbalancedDelete_(e,t)}search(t,n=-1){let r=this.getRoot(n);for(;r!==e.st_nullNode();){let e=this.m_comparator.compare(this,t,r);if(!e)return r;r=e<0?this.getLeft(r):this.getRight(r)}return this.m_comparator.onEndSearchImpl(t),e.st_nullNode()}searchLowerBound(t,n=-1){let r=this.getRoot(n),i=-1;for(;r!==e.st_nullNode();){let e=t.compare(this,r);if(!e)return r;e<0?r=this.getLeft(r):(i=r,r=this.getRight(r))}return i}searchUpperBound(t,n=-1){let r=this.getRoot(n),i=-1;for(;r!==e.st_nullNode();){let e=t.compare(this,r);if(!e)return r;e<0?(i=r,r=this.getLeft(r)):r=this.getRight(r)}return i}getElement(e){return this.m_treapData.getField(e,3)}getLeft(e){return this.m_treapData.getField(e,0)}getRight(e){return this.m_treapData.getField(e,1)}getParent(e){return this.m_treapData.getField(e,2)}getNext(e){return this.m_treapData.getField(e,6)}getPrev(e){return this.m_treapData.getField(e,5)}getFirst(e=-1){return e===-1?this.getFirst_(this.m_defaultTreap):this.getFirst_(e)}getLast(e=-1){return e===-1?this.getLast_(this.m_defaultTreap):this.getLast_(e)}getTreapData(e=-1){return e===-1?this.getTreapData_(this.m_defaultTreap):this.getTreapData_(e)}setElement(e,t){this.m_comparator!==null&&this.m_comparator.onSetImpl(this,e),this.setElement_(e,t)}getRoot(e=-1){return e===-1?this.getRoot_(this.m_defaultTreap):this.getRoot_(e)}clear(){this.m_treapData.deleteAll(!1),this.m_defaultTreap=e.st_nullNode(),this.m_treapCount=0,this.m_maxDepthEver=0}addToList_(e,t,n){let r;e===-1?r=this.getLast_(n):(r=this.getPrev(e),this.setPrev_(e,t)),this.setPrev_(t,r),r!==-1&&this.setNext_(r,t),this.setNext_(t,e),e===this.getFirst_(n)&&this.setFirst_(t,n),e===-1&&this.setLast_(t,n),this.setSize_(this.getSize_(n)+1,n)}size(e=-1){return e===-1?this.getSize_(this.m_defaultTreap):this.getSize_(e)}getMaxDepth(e=-1){return this.getMaxDepthHelper_(this.getRoot(e))}getMaxDepthEver(){return this.m_maxDepthEver}static st_isValidNode(e){return pn.isValidElement(e)}dbgCheck_(e){}getPriority_(e){return this.m_treapData.getField(e,4)}bubbleDown_(t){let n=this.getLeft(t),r=this.getRight(t),i=this.getPriority_(t);for(;n!==e.st_nullNode()||r!==e.st_nullNode();){let a=n===e.st_nullNode()?kt():this.getPriority_(n),o=r===e.st_nullNode()?kt():this.getPriority_(r);if(i<=Math.min(a,o))return;a<=o?this.rotateRight_(n):this.rotateLeft_(t),n=this.getLeft(t),r=this.getRight(t)}}bubbleUp_(t){if(!this.m_bBalancing)return;let n=this.getPriority_(t),r=this.getParent(t);for(;r!==e.st_nullNode()&&this.getPriority_(r)>n;)this.getLeft(r)===t?this.rotateRight_(t):this.rotateLeft_(r),r=this.getParent(t)}rotateLeft_(t){let n=t,r=this.getRight(t),i;this.setParent_(r,this.getParent(n)),this.setParent_(n,r),i=this.getLeft(r),this.setRight_(n,i),i!==e.st_nullNode()&&this.setParent_(i,n),this.setLeft_(r,n),i=this.getParent(r),i!==e.st_nullNode()&&(this.getLeft(i)===n?this.setLeft_(i,r):this.setRight_(i,r))}rotateRight_(t){let n=this.getParent(t),r=t,i;this.setParent_(r,this.getParent(n)),this.setParent_(n,r),i=this.getRight(r),this.setLeft_(n,i),i!==e.st_nullNode()&&this.setParent_(i,n),this.setRight_(r,n),i=this.getParent(r),i!==e.st_nullNode()&&(this.getLeft(i)===n?this.setLeft_(i,r):this.setRight_(i,r))}setParent_(e,t){this.m_treapData.setField(e,2,t)}setLeft_(e,t){this.m_treapData.setField(e,0,t)}setRight_(e,t){this.m_treapData.setField(e,1,t)}setPriority_(e,t){this.m_treapData.setField(e,4,t)}setPrev_(e,t){this.m_treapData.setField(e,5,t)}setNext_(e,t){this.m_treapData.setField(e,6,t)}setRoot_(e,t){this.m_treapData.setField(t,0,e)}setFirst_(e,t){this.m_treapData.setField(t,1,e)}setLast_(e,t){this.m_treapData.setField(t,2,e)}setDuplicateElement_(e,t){this.m_treapData.setField(t,3,e)}setSize_(e,t){this.m_treapData.setField(t,4,e)}setTreapData_(e,t){this.m_treapData.setField(t,5,e)}getRoot_(t){return t===-1?e.st_nullNode():this.m_treapData.getField(t,0)}getFirst_(t){return t===-1?e.st_nullNode():this.m_treapData.getField(t,1)}getLast_(t){return t===-1?e.st_nullNode():this.m_treapData.getField(t,2)}getDuplicateElement_(t){return t===-1?e.st_nullNode():this.m_treapData.getField(t,3)}getSize_(e){return e===-1?0:this.m_treapData.getField(e,4)}getTreapData_(e){return this.m_treapData.getField(e,5)}newNode_(e){let t=this.m_treapData.newElement();return this.setPriority_(t,this.generatePriority_()),this.setElement_(t,e),t}freeNode_(t,n){t!==e.st_nullNode()&&this.m_treapData.deleteElement(t)}generatePriority_(){return this.m_random=D(this.m_random),this.m_random&kt()>>1}maxPriority(){return U(0),0}getMaxDepthHelper_(t){return t===e.st_nullNode()?0:1+Math.max(this.getMaxDepthHelper_(this.getLeft(t)),this.getMaxDepthHelper_(this.getRight(t)))}addElement_(t,n,r){if(this.getRoot(r)===e.st_nullNode()){let e=this.newNode_(t);return this.setRoot_(e,r),this.addToList_(-1,e,r),this.m_maxDepthEver=Math.max(this.m_maxDepthEver,1),e}let i=this.getRoot_(r),a=-1,o=-1,s=1;for(;;){let c=n===-1?1:this.m_comparator.compare(this,t,i);if(c<0){let n=this.getLeft(i);if(n===e.st_nullNode()){o=i,a=this.newNode_(t),this.setLeft_(i,a),this.setParent_(a,i);break}i=n}else{if(n===1&&c===0)return this.m_comparator.onAddUniqueElementFailedImpl(t),this.setDuplicateElement_(i,r),-1;let s=this.getRight(i);if(s===e.st_nullNode()){o=this.getNext(i),a=this.newNode_(t),this.setRight_(i,a),this.setParent_(a,i);break}i=s}s++}return this.bubbleUp_(a),this.getParent(a)===e.st_nullNode()&&this.setRoot_(a,r),this.addToList_(o,a,r),this.m_maxDepthEver=Math.max(s,this.m_maxDepthEver),a}removeFromList_(e,t){let n=this.getPrev(e),r=this.getNext(e);n===-1?this.setFirst_(r,t):this.setNext_(n,r),r===-1?this.setLast_(n,t):this.setPrev_(r,n),this.setSize_(this.getSize_(t)-1,t)}unbalancedDelete_(e,t){this.removeFromList_(e,t);let n=this.getLeft(e),r=this.getRight(e),i=this.getParent(e),a=e;if(n!==-1&&r!==-1){let o;this.m_random=D(this.m_random),o=this.m_random>kt()>>1?this.getNext(e):this.getPrev(e);let s=this.getParent(o)===e;this.m_treapData.swapField(e,o,0),this.m_treapData.swapField(e,o,1),this.m_treapData.swapField(e,o,2),i===-1?this.setRoot_(o,t):this.getLeft(i)===e?this.setLeft_(i,o):this.setRight_(i,o),s?(n===o?(this.setLeft_(o,e),this.setParent_(r,o)):r===o&&(this.setRight_(o,e),this.setParent_(n,o)),this.setParent_(e,o),i=o):(this.setParent_(n,o),this.setParent_(r,o),i=this.getParent(e),a=o),n=this.getLeft(e),r=this.getRight(e),n!==-1&&this.setParent_(n,e),r!==-1&&this.setParent_(r,e)}let o=n===-1?r:n;i===-1?this.setRoot_(o,t):this.getLeft(i)===a?this.setLeft_(i,o):this.setRight_(i,o),o!==-1&&this.setParent_(o,i),this.freeNode_(e,t)}deleteNode_(t,n){this.setPriority_(t,kt());let r=e.st_nullNode(),i=e.st_nullNode(),a=this.getRoot_(n),o=a===t;if(o&&(r=this.getLeft(a),i=this.getRight(a),r===e.st_nullNode()&&i===e.st_nullNode()))return this.removeFromList_(a,n),this.freeNode_(a,n),void this.setRoot_(e.st_nullNode(),n);this.bubbleDown_(t);let s=this.getParent(t);s!==e.st_nullNode()&&(this.getLeft(s)===t?this.setLeft_(s,e.st_nullNode()):this.setRight_(s,e.st_nullNode())),this.removeFromList_(t,n),this.freeNode_(t,n),o&&this.setRoot_(r===e.st_nullNode()||this.getParent(r)!==e.st_nullNode()?i:r,n)}setElement_(e,t){this.m_treapData.setField(e,3,t)}addBiggestElement_(t,n){if(this.getRoot_(n)===e.st_nullNode())return this.setRoot_(t,n),void this.addToList_(-1,t,n);let r=this.getLast_(n);this.setRight_(r,t),this.setParent_(t,r),this.bubbleUp_(t),this.getParent(t)===e.st_nullNode()&&this.setRoot_(t,n),this.addToList_(-1,t,n)}},bn=class e{constructor(t){this.m_lists=new pn(6),this.m_listOfLists=e.st_nullNode(),t===void 0?(this.m_listNodes=new pn(3),this.m_bStoreListIndexWithNode=!1):(this.m_listNodes=new pn(t?4:3),this.m_bStoreListIndexWithNode=t)}freeNode_(e){this.m_listNodes.deleteElement(e)}newNode_(){return this.m_listNodes.newElement()}freeList_(e){U(0)}newList_(){return this.m_lists.newElement()}setPrev_(e,t){this.m_listNodes.setField(e,1,t)}setNext_(e,t){this.m_listNodes.setField(e,2,t)}setData_(e,t){U(0)}setList_(e,t){return this.m_listNodes.setField(e,3,t)}setListSize_(e,t){this.m_lists.setField(e,4,t)}setNextList_(e,t){U(0)}setPrevList_(e,t){this.m_lists.setField(e,2,t)}createList(t){let n=this.newList_();return this.m_lists.setField(n,3,this.m_listOfLists),this.m_lists.setField(n,4,0),this.m_lists.setField(n,5,t),this.m_listOfLists!==e.st_nullNode()&&this.setPrevList_(this.m_listOfLists,n),this.m_listOfLists=n,n}deleteList(t){this.clear(t);let n=this.m_lists.getField(t,2),r=this.m_lists.getField(t,3);return n===e.st_nullNode()?this.m_listOfLists=r:this.setNextList_(n,r),r!==e.st_nullNode()&&this.setPrevList_(r,n),this.freeList_(t),r}reserveLists(e){U(0)}getListData(e){return this.m_lists.getField(e,5)}getList(e){return U(0),0}setListData(e,t){this.m_lists.setField(e,5,t)}addElement(e,t){return this.insertElement(e,-1,t)}insertElement(t,n,r){let i=this.newNode_(),a=-1;if(n!==e.st_nullNode()&&(a=this.getPrev(n),this.setPrev_(n,i)),this.setNext_(i,n),a!==e.st_nullNode()&&this.setNext_(a,i),n===this.m_lists.getField(t,0)&&this.m_lists.setField(t,0,i),n===e.st_nullNode()){let e=this.m_lists.getField(t,1);this.setPrev_(i,e),e!==-1&&this.setNext_(e,i),this.m_lists.setField(t,1,i)}return this.setData(i,r),this.setListSize_(t,this.getListSize(t)+1),this.m_bStoreListIndexWithNode&&this.setList_(i,t),i}deleteElement(t,n){let r=this.getPrev(n),i=this.getNext(n);return r===e.st_nullNode()?this.m_lists.setField(t,0,i):this.setNext_(r,i),i===e.st_nullNode()?this.m_lists.setField(t,1,r):this.setPrev_(i,r),this.freeNode_(n),this.setListSize_(t,this.getListSize(t)-1),i}reserveNodes(e){this.m_listNodes.setCapacity(e)}getData(e){return this.m_listNodes.getField(e,0)}getElement(e){return this.getData(e)}setData(e,t){this.m_listNodes.setField(e,0,t)}getNext(e){return this.m_listNodes.getField(e,2)}getPrev(e){return this.m_listNodes.getField(e,1)}getFirst(e){return this.m_lists.getField(e,0)}getLast(e){return this.m_lists.getField(e,1)}static st_nullNode(){return-1}clear(t){if(t!==void 0){let n=this.getLast(t);for(;n!==e.st_nullNode();){let e=n;n=this.getPrev(e),this.freeNode_(e)}this.m_lists.setField(t,0,-1),this.m_lists.setField(t,1,-1),this.setListSize_(t,0);return}for(let e=this.getFirstList();e!==-1;)e=this.deleteList(e)}isEmpty(e){return U(0),!1}getNodeCount(){return this.m_listNodes.size()}getListCount(){return this.m_lists.size()}getListSize(e){return this.m_lists.getField(e,4)}getFirstList(){return this.m_listOfLists}getNextList(e){return this.m_lists.getField(e,3)}},xn=class extends vn{constructor(e){super(),this.m_intervalTree=e}compare(e,t,n){let r=e.getElement(n),i=this.m_intervalTree.getValue_(t),a=this.m_intervalTree.getValue_(r);return i<a?-1:i===a?Sn.isLeft_(t)&&Sn.isRight_(r)?-1:Sn.isLeft_(r)&&Sn.isRight_(t)?1:0:1}},Sn=class e{constructor(e){this.m_bEnvelopesRef=!1,this.m_intervals=[],this.m_envelopesRef=null,this.m_intervalNodes=new pn(3),this.m_intervalHandles=[],this.m_endIndicesUnique=[],this.m_cCount=-1,this.m_root=-1,this.m_bSortIntervals=!1,this.m_bConstructing=!1,this.m_bConstructionEnded=!1,this.m_bOfflineDynamic=e,this.m_tertiaryNodes=new pn(this.m_bOfflineDynamic?5:4),this.m_secondaryTreaps=new yn,this.m_secondaryTreaps.setComparator(new xn(this)),this.m_secondaryLists=new bn}addEnvelopesRef(e){this.reset_(!0,!0),this.m_bEnvelopesRef=!0,this.m_envelopesRef=e,this.m_bConstructing=!1,this.m_bConstructionEnded=!0,this.m_bOfflineDynamic||(this.insertIntervalsStatic_(),this.m_cCount=this.m_envelopesRef.length)}startConstruction(){this.reset_(!0,!1)}addInterval(e){this.m_bConstructing||ge(``),this.m_intervals.push(e.clone())}addIntervalCoords(e,t){U(0)}endConstruction(){this.m_bConstructing||ge(``),this.m_bConstructing=!1,this.m_bConstructionEnded=!0,this.m_bOfflineDynamic||(this.insertIntervalsStatic_(),this.m_cCount=this.m_intervals.length)}insert(e){if(this.m_bOfflineDynamic&&this.m_bConstructionEnded||ge(``),this.m_root===-1){let e=this.m_bEnvelopesRef?this.m_envelopesRef.length:this.m_intervals.length;if(this.m_bSortIntervals){let t=new sn(0);this.querySortedEndPointIndices_(t),this.m_endIndicesUnique.length=0,this.querySortedDuplicatesRemoved_(t),this.m_intervalHandles.length=e,this.m_intervalHandles.fill(-1),this.m_bSortIntervals=!1}else this.m_intervalHandles.fill(-1,0,e);this.m_root=this.createRoot_()}let t=this.insertIntervalEnd_(e<<1,this.m_root),n=this.getSecondaryFromInterval_(t),r=this.m_secondaryTreaps.addElement(1+(e<<1),n);this.setRightEnd_(t,r),this.m_intervalHandles[e]=t,this.m_cCount++}remove(e){this.m_bOfflineDynamic&&this.m_bConstructionEnded||ge(``);let t=this.m_intervalHandles[e],n;t===-1&&R(`the interval does not exist in the interval tree`),this.m_intervalHandles[e]=-1,this.m_cCount--;let r=this.getSecondaryFromInterval_(t),i=-1;i=this.m_secondaryTreaps.getTreapData(r),this.m_secondaryTreaps.deleteNode(this.getLeftEnd_(t),r),this.m_secondaryTreaps.deleteNode(this.getRightEnd_(t),r),n=this.m_secondaryTreaps.size(r),n===0&&(this.m_secondaryTreaps.deleteTreap(r),this.setSecondaryToTertiary_(i,-1)),this.m_intervalNodes.deleteElement(t);let a=this.getPptr_(i),o=this.getLptr_(i),s=this.getRptr_(i);for(;!(n>0||i===this.m_root||o!==-1&&s!==-1);)i===this.getLptr_(a)?o===-1?s===-1?(this.setLptr_(a,-1),this.setPptr_(i,-1)):(this.setLptr_(a,s),this.setPptr_(s,a),this.setRptr_(i,-1),this.setPptr_(i,-1)):(this.setLptr_(a,o),this.setPptr_(o,a),this.setLptr_(i,-1),this.setPptr_(i,-1)):o===-1?s===-1?(this.setRptr_(a,-1),this.setPptr_(i,-1)):(this.setRptr_(a,s),this.setPptr_(s,a),this.setRptr_(i,-1),this.setPptr_(i,-1)):(this.setRptr_(a,o),this.setPptr_(o,a),this.setLptr_(i,-1),this.setPptr_(i,-1)),this.m_tertiaryNodes.deleteElement(i),i=a,r=this.getSecondaryFromTertiary_(i),n=r===-1?0:this.m_secondaryTreaps.size(r),o=this.getLptr_(i),s=this.getRptr_(i),a=this.getPptr_(i)}size(){return this.m_cCount}getIteratorQuery(e,t){return e instanceof I?new Cn(this,e,t):(U(0),{})}getIterator(){return new Cn(this)}querySortedEndPointIndices_(e){let t=this.m_bEnvelopesRef?this.m_envelopesRef.length:this.m_intervals.length;for(let n=0;n<2*t;n++)e.add(n);this.sortEndIndices_(e,0,2*t)}querySortedDuplicatesRemoved_(e){let t=NaN;for(let n=0;n<e.size();n++){let r=e.read(n),i=this.getValue_(r);i!==t&&(this.m_endIndicesUnique.push(r),t=i)}}insertIntervalsStatic_(){let e=this.m_bEnvelopesRef?this.m_envelopesRef.length:this.m_intervals.length,t=new sn(0);this.querySortedEndPointIndices_(t),this.m_endIndicesUnique.length=0,this.querySortedDuplicatesRemoved_(t),this.m_intervalNodes.setCapacity(e),this.m_secondaryLists.reserveNodes(2*e);let n=H(e,-1);this.m_root=this.createRoot_();for(let e=0;e<t.size();e++){let r=t.read(e),i=n[r>>1];if(i!==-1){let e=this.getSecondaryFromInterval_(i);this.setRightEnd_(i,this.m_secondaryLists.addElement(e,r))}else i=this.insertIntervalEnd_(r,this.m_root),n[r>>1]=i}}createRoot_(){let e=this.calculateDiscriminantIndex1_(0,this.m_endIndicesUnique.length-1);return this.createTertiaryNode_(e)}insertIntervalEnd_(e,t){let n=-1,r=t,i=-1,a=-1,o=0,s=this.m_endIndicesUnique.length-1,c=0,l=e>>1,u=NaN,d=NaN,f=!0,p=this.getMin_(l),m=this.getMax_(l),h=-1;for(;f;){c=o+(s-o>>1),h=this.calculateDiscriminantIndex1_(o,s);let t=this.getDiscriminantFromIndex1_(h);if(m<t){if(r!==-1){if(h===this.getDiscriminantIndex1_(r))n=r,u=t,r=this.getLptr_(r),d=r===-1?NaN:this.getDiscriminant_(r);else if(d>t){let e=this.createTertiaryNode_(h);t<u?this.setLptr_(n,e):this.setRptr_(n,e),this.setRptr_(e,r),this.m_bOfflineDynamic&&(this.setPptr_(e,n),this.setPptr_(r,e)),n=e,u=t,r=-1,d=NaN}}s=c;continue}if(p>t){if(r!==-1){if(h===this.getDiscriminantIndex1_(r))n=r,u=t,r=this.getRptr_(r),d=r===-1?NaN:this.getDiscriminant_(r);else if(d<t){let e=this.createTertiaryNode_(h);t<u?this.setLptr_(n,e):this.setRptr_(n,e),this.setLptr_(e,r),this.m_bOfflineDynamic&&(this.setPptr_(e,n),this.setPptr_(r,e)),n=e,u=t,r=-1,d=NaN}}o=c+1;continue}let l=-1;l=r===-1||h!==this.getDiscriminantIndex1_(r)?this.createTertiaryNode_(h):r,i=this.getSecondaryFromTertiary_(l),i===-1&&(i=this.createSecondary_(l),this.setSecondaryToTertiary_(l,i));let g=this.addEndIndex_(i,e);a=this.createIntervalNode_(),this.setSecondaryToInterval_(a,i),this.setLeftEnd_(a,g),r!==-1&&h===this.getDiscriminantIndex1_(r)||(t<u?this.setLptr_(n,l):this.setRptr_(n,l),this.m_bOfflineDynamic&&this.setPptr_(l,n),r!==-1&&(d<t?this.setLptr_(l,r):this.setRptr_(l,r),this.m_bOfflineDynamic&&this.setPptr_(r,l))),f=!1;break}return a}createTertiaryNode_(e){let t=this.m_tertiaryNodes.newElement();return this.setDiscriminantIndex1_(t,e),t}createSecondary_(e){return this.m_bOfflineDynamic?this.m_secondaryTreaps.createTreap(e):this.m_secondaryLists.createList(e)}createIntervalNode_(){return this.m_intervalNodes.newElement()}reset(){this.m_bOfflineDynamic&&this.m_bConstructionEnded||ge(``),this.reset_(!1,this.m_bEnvelopesRef)}reset_(e,t){e?(this.m_bEnvelopesRef=!1,this.m_envelopesRef=null,this.m_bSortIntervals=!0,this.m_bConstructing=!0,this.m_bConstructionEnded=!1,this.m_endIndicesUnique.length=0,t?(this.m_intervals.length=0,this.m_bEnvelopesRef=!0):this.m_intervals.length=0):this.m_bSortIntervals=!1,this.m_bOfflineDynamic?this.m_secondaryTreaps.clear():this.m_secondaryLists.clear(),this.m_intervalNodes.deleteAll(!1),this.m_tertiaryNodes.deleteAll(!1),this.m_root=-1,this.m_cCount=0}getDiscriminant_(e){let t=this.getDiscriminantIndex1_(e);return this.getDiscriminantFromIndex1_(t)}getDiscriminantFromIndex1_(e){if(e===-1)return NaN;if(e>0){let t=e-2,n=this.m_endIndicesUnique[t],r=this.m_endIndicesUnique[t+1];return .5*(this.getValue_(n)+this.getValue_(r))}let t=-e-2,n=this.m_endIndicesUnique[t];return this.getValue_(n)}calculateDiscriminantIndex1_(e,t){let n;return n=e<t?e+(t-e>>1)+2:-(e+2),n}setDiscriminantIndex1_(e,t){this.m_tertiaryNodes.setField(e,0,t)}setSecondaryToTertiary_(e,t){this.m_tertiaryNodes.setField(e,1,t)}setLptr_(e,t){this.m_tertiaryNodes.setField(e,2,t)}setRptr_(e,t){this.m_tertiaryNodes.setField(e,3,t)}setPptr_(e,t){this.m_tertiaryNodes.setField(e,4,t)}setSecondaryToInterval_(e,t){this.m_intervalNodes.setField(e,0,t)}addEndIndex_(e,t){let n=-1;return n=this.m_bOfflineDynamic?this.m_secondaryTreaps.addElement(t,e):this.m_secondaryLists.addElement(e,t),n}setLeftEnd_(e,t){this.m_intervalNodes.setField(e,1,t)}setRightEnd_(e,t){this.m_intervalNodes.setField(e,2,t)}getFirst_(e){return this.m_bOfflineDynamic?this.m_secondaryTreaps.getFirst(e):this.m_secondaryLists.getFirst(e)}getLast_(e){return this.m_bOfflineDynamic?this.m_secondaryTreaps.getLast(e):this.m_secondaryLists.getLast(e)}static isLeft_(e){return!(1&e)}static isRight_(e){return!(1&~e)}getDiscriminantIndex1_(e){return this.m_tertiaryNodes.getField(e,0)}getSecondaryFromTertiary_(e){return this.m_tertiaryNodes.getField(e,1)}getLptr_(e){return this.m_tertiaryNodes.getField(e,2)}getRptr_(e){return this.m_tertiaryNodes.getField(e,3)}getPptr_(e){return this.m_tertiaryNodes.getField(e,4)}getSecondaryFromInterval_(e){return this.m_intervalNodes.getField(e,0)}getLeftEnd_(e){return this.m_intervalNodes.getField(e,1)}getRightEnd_(e){return this.m_intervalNodes.getField(e,2)}getMin_(e){return this.m_bEnvelopesRef?this.m_envelopesRef[e].xmin:this.m_intervals[e].vmin}getMax_(e){return this.m_bEnvelopesRef?this.m_envelopesRef[e].xmax:this.m_intervals[e].vmax}sortEndIndices_(e,t,n){let r=this;new fn().sort(e,t,n,{userSort(e,t,n){r.sortEndIndicesHelper_(n,e,t)},getValue:e=>r.getValue_(e)})}sortEndIndicesHelper_(t,n,r){t.sort(n,r,(t,n)=>{let r=this.getValue_(t),i=this.getValue_(n);return r<i||r===i&&e.isLeft_(t)&&e.isRight_(n)?-1:1})}getValue_(t){if(!this.m_bEnvelopesRef){let n=this.m_intervals[t>>1];return e.isLeft_(t)?n.vmin:n.vmax}let n=this.m_envelopesRef[t>>1];return e.isLeft_(t)?n.xmin:n.xmax}},Cn=class{constructor(e,t,n){this.m_query=I.constructEmpty(),this.m_tertiaryHandle=-1,this.m_nextTertiaryHandle=-1,this.m_forkedHandle=-1,this.m_currentEndHandle=-1,this.m_nextEndHandle=-1,this.m_tertiaryStack=[],this.m_functionIndex=0,this.m_intervalTree=e,this.m_functionStack=[,,],this.m_functionStack[0]=this.nullFunc_,this.m_functionStack[1]=this.nullFunc_,t!==void 0&&this.resetIterator(t,n)}nullFunc_(){return B(`should not be called`),!1}resetIterator(e,t){if(typeof e==`number`){let n=new I;n.setCoords(e,e),this.resetIterator(n,t)}else t===void 0&&(t=0),this.m_query.vmin=e.vmin-t,this.m_query.vmax=e.vmax+t,this.m_tertiaryStack.length=0,this.m_functionIndex=0,this.m_functionStack[0]=this.initialize_}next(){if(this.m_intervalTree.m_bConstructionEnded||ge(``),this.m_functionIndex<0)return-1;for(;this.m_fi=this.m_functionStack[this.m_functionIndex],this.m_fi(););return this.m_currentEndHandle===-1?-1:this.getCurrentEndIndex_()>>1}initialize_(){return this.m_tertiaryHandle=-1,this.m_nextTertiaryHandle=-1,this.m_forkedHandle=-1,this.m_currentEndHandle=-1,this.m_intervalTree.m_tertiaryNodes.size()>0?(this.m_functionStack[0]=this.pIn_,this.m_nextTertiaryHandle=this.m_intervalTree.m_root,!0):(this.m_functionIndex=-1,!1)}pIn_(){if(this.m_tertiaryHandle=this.m_nextTertiaryHandle,this.m_tertiaryHandle===-1)return this.m_functionIndex=-1,this.m_currentEndHandle=-1,!1;let e=this.m_intervalTree.getDiscriminant_(this.m_tertiaryHandle);if(this.m_query.vmax<e){let e=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);return this.m_nextTertiaryHandle=this.m_intervalTree.getLptr_(this.m_tertiaryHandle),e!==-1&&(this.m_nextEndHandle=this.m_intervalTree.getFirst_(e),this.m_functionStack[++this.m_functionIndex]=this.left_),!0}if(e<this.m_query.vmin){let e=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);return this.m_nextTertiaryHandle=this.m_intervalTree.getRptr_(this.m_tertiaryHandle),e!==-1&&(this.m_nextEndHandle=this.m_intervalTree.getLast_(e),this.m_functionStack[++this.m_functionIndex]=this.right_),!0}this.m_functionStack[this.m_functionIndex]=this.pL_,this.m_forkedHandle=this.m_tertiaryHandle;let t=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);return this.m_nextTertiaryHandle=this.m_intervalTree.getLptr_(this.m_tertiaryHandle),t!==-1&&(this.m_nextEndHandle=this.m_intervalTree.getFirst_(t),this.m_functionStack[++this.m_functionIndex]=this.all_),!0}pL_(){if(this.m_tertiaryHandle=this.m_nextTertiaryHandle,this.m_tertiaryHandle===-1)return this.m_functionStack[this.m_functionIndex]=this.pR_,this.m_nextTertiaryHandle=this.m_intervalTree.getRptr_(this.m_forkedHandle),!0;if(this.m_intervalTree.getDiscriminant_(this.m_tertiaryHandle)<this.m_query.vmin){let e=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);return this.m_nextTertiaryHandle=this.m_intervalTree.getRptr_(this.m_tertiaryHandle),e!==-1&&(this.m_nextEndHandle=this.m_intervalTree.getLast_(e),this.m_functionStack[++this.m_functionIndex]=this.right_),!0}let e=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);this.m_nextTertiaryHandle=this.m_intervalTree.getLptr_(this.m_tertiaryHandle),e!==-1&&(this.m_nextEndHandle=this.m_intervalTree.getFirst_(e),this.m_functionStack[++this.m_functionIndex]=this.all_);let t=this.m_intervalTree.getRptr_(this.m_tertiaryHandle);return t!==-1&&this.m_tertiaryStack.push(t),!0}pR_(){if(this.m_tertiaryHandle=this.m_nextTertiaryHandle,this.m_tertiaryHandle===-1)return this.m_functionStack[this.m_functionIndex]=this.pT_,!0;let e=this.m_intervalTree.getDiscriminant_(this.m_tertiaryHandle);if(this.m_query.vmax<e){let e=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);return this.m_nextTertiaryHandle=this.m_intervalTree.getLptr_(this.m_tertiaryHandle),e!==-1&&(this.m_nextEndHandle=this.m_intervalTree.getFirst_(e),this.m_functionStack[++this.m_functionIndex]=this.left_),!0}let t=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);this.m_nextTertiaryHandle=this.m_intervalTree.getRptr_(this.m_tertiaryHandle),t!==-1&&(this.m_nextEndHandle=this.m_intervalTree.getFirst_(t),this.m_functionStack[++this.m_functionIndex]=this.all_);let n=this.m_intervalTree.getLptr_(this.m_tertiaryHandle);return n!==-1&&this.m_tertiaryStack.push(n),!0}pT_(){if(this.m_tertiaryStack.length===0)return this.m_functionIndex=-1,this.m_currentEndHandle=-1,!1;this.m_tertiaryHandle=this.m_tertiaryStack.at(-1),this.m_tertiaryStack.pop();let e=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);return e!==-1&&(this.m_nextEndHandle=this.m_intervalTree.getFirst_(e),this.m_functionStack[++this.m_functionIndex]=this.all_),this.m_intervalTree.getLptr_(this.m_tertiaryHandle)!==-1&&this.m_tertiaryStack.push(this.m_intervalTree.getLptr_(this.m_tertiaryHandle)),this.m_intervalTree.getRptr_(this.m_tertiaryHandle)!==-1&&this.m_tertiaryStack.push(this.m_intervalTree.getRptr_(this.m_tertiaryHandle)),!0}left_(){return this.m_currentEndHandle=this.m_nextEndHandle,this.m_currentEndHandle!==-1&&Sn.isLeft_(this.getCurrentEndIndex_())&&this.m_intervalTree.getValue_(this.getCurrentEndIndex_())<=this.m_query.vmax?(this.m_nextEndHandle=this.getNext_(),!1):(this.m_functionIndex--,!0)}right_(){return this.m_currentEndHandle=this.m_nextEndHandle,this.m_currentEndHandle!==-1&&Sn.isRight_(this.getCurrentEndIndex_())&&this.m_intervalTree.getValue_(this.getCurrentEndIndex_())>=this.m_query.vmin?(this.m_nextEndHandle=this.getPrev_(),!1):(this.m_functionIndex--,!0)}all_(){return this.m_currentEndHandle=this.m_nextEndHandle,this.m_currentEndHandle!==-1&&Sn.isLeft_(this.getCurrentEndIndex_())?(this.m_nextEndHandle=this.getNext_(),!1):(this.m_functionIndex--,!0)}getNext_(){return this.m_intervalTree.m_bOfflineDynamic?this.m_intervalTree.m_secondaryTreaps.getNext(this.m_currentEndHandle):this.m_intervalTree.m_secondaryLists.getNext(this.m_currentEndHandle)}getPrev_(){return this.m_intervalTree.m_bOfflineDynamic?this.m_intervalTree.m_secondaryTreaps.getPrev(this.m_currentEndHandle):this.m_intervalTree.m_secondaryLists.getPrev(this.m_currentEndHandle)}getCurrentEndIndex_(){return this.m_intervalTree.m_bOfflineDynamic?this.m_intervalTree.m_secondaryTreaps.getElement(this.m_currentEndHandle):this.m_intervalTree.m_secondaryLists.getData(this.m_currentEndHandle)}},wn=class{constructor(){this.m_tolerance=0,this.m_sweepIndexRed=-1,this.m_sweepIndexBlue=-1,this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_intervalTreeRed=null,this.m_intervalTreeBlue=null,this.m_iteratorRed=null,this.m_iteratorBlue=null,this.m_envelopesRed=[],this.m_envelopesBlue=[],this.m_elementsRed=[],this.m_elementsBlue=[],this.m_sortedEndIndicesRed=new sn(0),this.m_sortedEndIndicesBlue=new sn(0),this.m_queuedListRed=-1,this.m_queuedListBlue=-1,this.m_queuedEnvelopes=new bn,this.m_queuedIndicesRed=[],this.m_queuedIndicesBlue=[],this.m_bAddRed=!1,this.m_bAddBlue=!1,this.m_bAddRedRed=!1,this.m_bDone=!0,this.m_function=this.nullFunc_,this.reset_()}startConstruction(){this.reset_(),this.m_bAddRedRed=!0,this.m_elementsRed.length=0,this.m_envelopesRed.length=0}addEnvelope(e,t){this.m_bAddRedRed||ge(``),this.m_elementsRed.push(e),this.m_envelopesRed.push(new G(t))}endConstruction(){this.m_bAddRedRed||ge(``),this.m_bAddRedRed=!1,this.m_envelopesRed.length>0&&(this.m_function=this.initialize_,this.m_bDone=!1)}startRedConstruction(){this.reset_(),this.m_bAddRed=!0,this.m_elementsRed.length=0,this.m_envelopesRed.length=0}addRedEnvelope(e,t){this.m_bAddRed||ge(``),this.m_elementsRed.push(e),this.m_envelopesRed.push(t.clone())}endRedConstruction(){this.m_bAddRed||ge(``),this.m_bAddRed=!1,this.m_envelopesRed.length>0&&this.m_envelopesBlue.length>0&&(this.m_function===this.nullFunc_||this.m_function===this.initializeBlue_?this.m_function=this.initializeRedBlue_:this.m_function!==this.initializeRedBlue_&&(this.m_function=this.initializeRed_),this.m_bDone=!1)}startBlueConstruction(){this.reset_(),this.m_bAddBlue=!0,this.m_elementsBlue.length=0,this.m_envelopesBlue.length=0}addBlueEnvelope(e,t){this.m_bAddBlue||ge(``),this.m_elementsBlue.push(e),this.m_envelopesBlue.push(t.clone())}endBlueConstruction(){this.m_bAddBlue||ge(``),this.m_bAddBlue=!1,this.m_envelopesRed.length>0&&this.m_envelopesBlue.length>0&&(this.m_function===this.nullFunc_||this.m_function===this.initializeRed_?this.m_function=this.initializeRedBlue_:this.m_function!==this.initializeRedBlue_&&(this.m_function=this.initializeBlue_),this.m_bDone=!1)}next(){if(this.m_bDone)return!1;for(;this.m_function(););return!this.m_bDone}getHandleA(){return this.m_envelopeHandleA}getHandleB(){return this.m_envelopeHandleB}setTolerance(e){this.m_tolerance=e}getElement(e){return this.m_elementsRed[e]}getRedEnvelope(e){return this.m_envelopesRed[e]}getBlueEnvelope(e){return this.m_envelopesBlue[e]}getRedElement(e){return this.m_elementsRed[e]}getBlueElement(e){return this.m_elementsBlue[e]}isTop_(e){return!(1&~e)}isBottom_(e){return!(1&e)}reset_(){this.m_bAddRed=!1,this.m_bAddBlue=!1,this.m_bAddRedRed=!1,this.m_sweepIndexRed=-1,this.m_sweepIndexBlue=-1,this.m_queuedListRed=-1,this.m_queuedListBlue=-1,this.m_bDone=!0}initialize_(){if(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_envelopesRed.length<10)return this.m_sweepIndexRed=this.m_envelopesRed.length,this.m_function=this.sweepBruteForce_,!0;this.m_intervalTreeRed||=new Sn(!0),this.m_intervalTreeRed.addEnvelopesRef(this.m_envelopesRed),this.m_iteratorRed===null&&(this.m_iteratorRed=this.m_intervalTreeRed.getIterator()),this.m_sortedEndIndicesRed.resize(0);for(let e=0;e<2*this.m_envelopesRed.length;e++)this.m_sortedEndIndicesRed.add(e);return this.sortYEndIndices_(this.m_sortedEndIndicesRed,0,2*this.m_envelopesRed.length,!0),this.m_sweepIndexRed=2*this.m_envelopesRed.length,this.m_function=this.sweep_,!0}initializeRed_(){if(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_envelopesRed.length<10||this.m_envelopesBlue.length<10)return this.m_sweepIndexRed=this.m_envelopesRed.length,this.m_function=this.sweepRedBlueBruteForce_,!0;this.m_intervalTreeRed||=new Sn(!0),this.m_intervalTreeRed.addEnvelopesRef(this.m_envelopesRed),this.m_iteratorRed===null&&(this.m_iteratorRed=this.m_intervalTreeRed.getIterator()),this.m_sortedEndIndicesRed.resize(0);for(let e=0;e<2*this.m_envelopesRed.length;e++)this.m_sortedEndIndicesRed.add(e);return this.sortYEndIndices_(this.m_sortedEndIndicesRed,0,this.m_sortedEndIndicesRed.size(),!0),this.m_sweepIndexRed=this.m_sortedEndIndicesRed.size(),this.m_queuedListRed!==-1&&(this.m_queuedEnvelopes.deleteList(this.m_queuedListRed),this.m_queuedIndicesRed.length=0,this.m_queuedListRed=-1),this.m_function=this.sweepRedBlue_,this.resetBlue_()}initializeBlue_(){if(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_envelopesRed.length<10||this.m_envelopesBlue.length<10)return this.m_sweepIndexRed=this.m_envelopesRed.length,this.m_function=this.sweepRedBlueBruteForce_,!0;this.m_intervalTreeBlue||=new Sn(!0),this.m_intervalTreeBlue.addEnvelopesRef(this.m_envelopesBlue),this.m_iteratorBlue??=this.m_intervalTreeBlue.getIterator(),this.m_sortedEndIndicesBlue.resize(0);for(let e=0;e<2*this.m_envelopesBlue.length;e++)this.m_sortedEndIndicesBlue.add(e);return this.sortYEndIndices_(this.m_sortedEndIndicesBlue,0,this.m_sortedEndIndicesBlue.size(),!1),this.m_sweepIndexBlue=this.m_sortedEndIndicesBlue.size(),this.m_queuedListBlue!==-1&&(this.m_queuedEnvelopes.deleteList(this.m_queuedListBlue),this.m_queuedIndicesBlue.length=0,this.m_queuedListBlue=-1),this.m_function=this.sweepRedBlue_,this.resetRed_()}initializeRedBlue_(){if(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_envelopesRed.length<10||this.m_envelopesBlue.length<10)return this.m_sweepIndexRed=this.m_envelopesRed.length,this.m_function=this.sweepRedBlueBruteForce_,!0;this.m_intervalTreeRed||=new Sn(!0),this.m_intervalTreeBlue||=new Sn(!0),this.m_intervalTreeRed.addEnvelopesRef(this.m_envelopesRed),this.m_intervalTreeBlue.addEnvelopesRef(this.m_envelopesBlue),this.m_iteratorRed===null&&(this.m_iteratorRed=this.m_intervalTreeRed.getIterator()),this.m_iteratorBlue===null&&(this.m_iteratorBlue=this.m_intervalTreeBlue.getIterator()),this.m_sortedEndIndicesRed.resize(0),this.m_sortedEndIndicesBlue.resize(0);for(let e=0;e<2*this.m_envelopesRed.length;e++)this.m_sortedEndIndicesRed.add(e);for(let e=0;e<2*this.m_envelopesBlue.length;e++)this.m_sortedEndIndicesBlue.add(e);return this.sortYEndIndices_(this.m_sortedEndIndicesRed,0,this.m_sortedEndIndicesRed.size(),!0),this.sortYEndIndices_(this.m_sortedEndIndicesBlue,0,this.m_sortedEndIndicesBlue.size(),!1),this.m_sweepIndexRed=this.m_sortedEndIndicesRed.size(),this.m_sweepIndexBlue=this.m_sortedEndIndicesBlue.size(),this.m_queuedListRed!==-1&&(this.m_queuedEnvelopes.deleteList(this.m_queuedListRed),this.m_queuedIndicesRed.length=0,this.m_queuedListRed=-1),this.m_queuedListBlue!==-1&&(this.m_queuedEnvelopes.deleteList(this.m_queuedListBlue),this.m_queuedIndicesBlue.length=0,this.m_queuedListBlue=-1),this.m_function=this.sweepRedBlue_,!0}sweep_(){let e=this.m_sortedEndIndicesRed.read(--this.m_sweepIndexRed),t=e>>1;if(this.isBottom_(e))return this.m_intervalTreeRed.remove(t),this.m_sweepIndexRed!==0||(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_bDone=!0,!1);let n=I.construct(this.m_envelopesRed[t].xmin,this.m_envelopesRed[t].xmax);return this.m_iteratorRed.resetIterator(n,this.m_tolerance),this.m_envelopeHandleA=t,this.m_function=this.iterate_,!0}sweepBruteForce_(){return--this.m_sweepIndexRed===-1?(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_bDone=!0,!1):(this.m_envelopeHandleA=this.m_sweepIndexRed,this.m_sweepIndexBlue=this.m_sweepIndexRed,this.m_function=this.iterateBruteForce_,!0)}sweepRedBlueBruteForce_(){return--this.m_sweepIndexRed===-1?(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_bDone=!0,!1):(this.m_envelopeHandleA=this.m_sweepIndexRed,this.m_sweepIndexBlue=this.m_envelopesBlue.length,this.m_function=this.iterateRedBlueBruteForce_,!0)}sweepRedBlue_(){let e=this.m_sortedEndIndicesRed.read(this.m_sweepIndexRed-1),t=this.m_sortedEndIndicesBlue.read(this.m_sweepIndexBlue-1),n=this.getAdjustedValue_(e,!0),r=this.getAdjustedValue_(t,!1);return n>r?this.sweepRed_():n<r?this.sweepBlue_():this.isTop_(e)?this.sweepRed_():this.isTop_(t)?this.sweepBlue_():this.sweepRed_()}sweepRed_(){let e=this.m_sortedEndIndicesRed.read(--this.m_sweepIndexRed),t=e>>1;if(this.isBottom_(e))return this.m_queuedListRed!==-1&&this.m_queuedIndicesRed[t]!==-1?(this.m_queuedEnvelopes.deleteElement(this.m_queuedListRed,this.m_queuedIndicesRed[t]),this.m_queuedIndicesRed[t]=-1):this.m_intervalTreeRed.remove(t),this.m_sweepIndexRed!==0||(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_bDone=!0,!1);if(this.m_queuedListBlue!==-1&&this.m_queuedEnvelopes.getListSize(this.m_queuedListBlue)>0){let e=this.m_queuedEnvelopes.getFirst(this.m_queuedListBlue);for(;e!==-1;){let t=this.m_queuedEnvelopes.getData(e);this.m_intervalTreeBlue.insert(t),this.m_queuedIndicesBlue[t]=-1;let n=this.m_queuedEnvelopes.getNext(e);this.m_queuedEnvelopes.deleteElement(this.m_queuedListBlue,e),e=n}}if(this.m_intervalTreeBlue.size()>0){let e=I.construct(this.m_envelopesRed[t].xmin,this.m_envelopesRed[t].xmax);this.m_iteratorBlue.resetIterator(e,this.m_tolerance),this.m_envelopeHandleA=t,this.m_function=this.iterateBlue_}else this.m_queuedListRed===-1&&(xe(this.m_queuedIndicesRed,this.m_envelopesRed.length,-1),this.m_queuedListRed=this.m_queuedEnvelopes.createList(1)),this.m_queuedIndicesRed[t]=this.m_queuedEnvelopes.addElement(this.m_queuedListRed,t),this.m_function=this.sweepRedBlue_;return!0}sweepBlue_(){let e=this.m_sortedEndIndicesBlue.read(--this.m_sweepIndexBlue),t=e>>1;if(this.isBottom_(e))return this.m_queuedListBlue!==-1&&this.m_queuedIndicesBlue[t]!==-1?(this.m_queuedEnvelopes.deleteElement(this.m_queuedListBlue,this.m_queuedIndicesBlue[t]),this.m_queuedIndicesBlue[t]=-1):this.m_intervalTreeBlue.remove(t),this.m_sweepIndexBlue!==0||(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_bDone=!0,!1);if(this.m_queuedListRed!==-1&&this.m_queuedEnvelopes.getListSize(this.m_queuedListRed)>0){let e=this.m_queuedEnvelopes.getFirst(this.m_queuedListRed);for(;e!==-1;){let t=this.m_queuedEnvelopes.getData(e);this.m_intervalTreeRed.insert(t),this.m_queuedIndicesRed[t]=-1;let n=this.m_queuedEnvelopes.getNext(e);this.m_queuedEnvelopes.deleteElement(this.m_queuedListRed,e),e=n}}if(this.m_intervalTreeRed.size()>0){let e=I.construct(this.m_envelopesBlue[t].xmin,this.m_envelopesBlue[t].xmax);this.m_iteratorRed.resetIterator(e,this.m_tolerance),this.m_envelopeHandleB=t,this.m_function=this.iterateRed_}else this.m_queuedListBlue===-1&&(xe(this.m_queuedIndicesBlue,this.m_envelopesBlue.length,-1),this.m_queuedListBlue=this.m_queuedEnvelopes.createList(0)),this.m_queuedIndicesBlue[t]=this.m_queuedEnvelopes.addElement(this.m_queuedListBlue,t),this.m_function=this.sweepRedBlue_;return!0}iterate_(){if(this.m_envelopeHandleB=this.m_iteratorRed.next(),this.m_envelopeHandleB!==-1)return!1;let e=this.m_sortedEndIndicesRed.read(this.m_sweepIndexRed)>>1;return this.m_intervalTreeRed.insert(e),this.m_function=this.sweep_,!0}iterateRed_(){if(this.m_envelopeHandleA=this.m_iteratorRed.next(),this.m_envelopeHandleA!==-1)return!1;this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1;let e=this.m_sortedEndIndicesBlue.read(this.m_sweepIndexBlue)>>1;return this.m_intervalTreeBlue.insert(e),this.m_function=this.sweepRedBlue_,!0}iterateBlue_(){if(this.m_envelopeHandleB=this.m_iteratorBlue.next(),this.m_envelopeHandleB!==-1)return!1;let e=this.m_sortedEndIndicesRed.read(this.m_sweepIndexRed)>>1;return this.m_intervalTreeRed.insert(e),this.m_function=this.sweepRedBlue_,!0}iterateBruteForce_(){if(--this.m_sweepIndexBlue===-1)return this.m_function=this.sweepBruteForce_,!0;let e=this.m_envelopesRed[this.m_sweepIndexRed].clone(),t=this.m_envelopesRed[this.m_sweepIndexBlue];return e.inflateCoords(this.m_tolerance,this.m_tolerance),!e.isIntersecting(t)||(this.m_envelopeHandleB=this.m_sweepIndexBlue,!1)}iterateRedBlueBruteForce_(){if(--this.m_sweepIndexBlue===-1)return this.m_function=this.sweepRedBlueBruteForce_,!0;let e=this.m_envelopesRed[this.m_sweepIndexRed].clone(),t=this.m_envelopesBlue[this.m_sweepIndexBlue];return e.inflateCoords(this.m_tolerance,this.m_tolerance),!e.isIntersecting(t)||(this.m_envelopeHandleB=this.m_sweepIndexBlue,!1)}resetRed_(){return this.m_sweepIndexRed=this.m_sortedEndIndicesRed.size(),this.m_intervalTreeRed.size()>0&&this.m_intervalTreeRed.reset(),this.m_queuedListRed!==-1&&(this.m_queuedEnvelopes.deleteList(this.m_queuedListRed),this.m_queuedIndicesRed.length=0,this.m_queuedListRed=-1),this.m_bDone=!1,!0}resetBlue_(){return this.m_sweepIndexBlue=this.m_sortedEndIndicesBlue.size(),this.m_intervalTreeBlue.size()>0&&this.m_intervalTreeBlue.reset(),this.m_queuedListBlue!==-1&&(this.m_queuedEnvelopes.deleteList(this.m_queuedListBlue),this.m_queuedIndicesBlue.length=0,this.m_queuedListBlue=-1),this.m_bDone=!1,!0}nullFunc_(){return B(`should not be called`),!1}sortYEndIndices_(e,t,n,r){let i=this;new fn().sort(e,t,n,{userSort(e,t,n){i.sortYEndIndicesHelper_(n,e,t,r)},getValue:e=>i.getAdjustedValue_(e,r)})}sortYEndIndicesHelper_(e,t,n,r){e.sort(t,n,(e,t)=>{let n=this.getAdjustedValue_(e,r),i=this.getAdjustedValue_(t,r);return n<i||n===i&&this.isBottom_(e)&&this.isTop_(t)?-1:1})}getAdjustedValue_(e,t){let n=.5*this.m_tolerance;if(t){let t=this.m_envelopesRed[e>>1];return this.isBottom_(e)?t.ymin-n:t.ymax+n}let r=this.m_envelopesBlue[e>>1];return this.isBottom_(e)?r.ymin-n:r.ymax+n}},Tn=Rt,En=class e{constructor(e,t){this.tolerance=e===void 0?NaN:e,this.resolution=t===void 0?NaN:t}add(t){return new e(this.tolerance+t,this.resolution)}scale(t){return new e(this.tolerance*t,this.resolution*t)}total(){return this.tolerance+this.resolution}};function Dn(e,t,n,r,i){let a=r*r,o=e.sub(t),s=n.sub(t),c=o.sqrLength(),l=s.sqrLength();if(c<=a||l<=a)return!0;let u=Ct(o.crossProduct(s));return u<=a*c||u<=a*l?o.dotProduct(s)>=0:!1}function On(e,t,n){return r=>n===0?(r+e)*t:1*(r-e*t)/t}function kn(e,t){let n=new G;return e.queryLooseEnvelope(n),n.mergeEnvelope2D(t),n}function An(e,t){let n=G.constructEmpty();e.queryLooseEnvelope(n);let r=G.constructEmpty();return t.queryLooseEnvelope(r),n.mergeEnvelope2D(r),n}function jn(e,t){return(Number.isFinite(e)||Number.isNaN(e))&&(Number.isFinite(t)||Number.isNaN(t))}function Mn(e,t){return Number.isFinite(e)&&Number.isFinite(t)}function Nn(e,t,n){let r=G.constructEmpty();return r.setFromPoints(e,t),Bn(0,null,r.calculateToleranceFromEnvelope(),n,!1)}function Pn(e,t,n){return Bn(0,e,t.calculateToleranceFromEnvelope(),n,!1)}function Fn(e,t,n){return Bn(1,e,t.calculateToleranceFromEnvelope(),n,!1)}function In(e,t,n){return Fn(e,t.queryInterval(1,0),n)}function Ln(e,t,n){let r=G.constructEmpty();return t.queryEnvelope(r),Pn(e,r,n)}function Rn(e,t,n=!1){return Bn(0,e,t.calculateToleranceFromEnvelope(),n,!0).total()}function zn(e,t,n){let r=G.constructEmpty();return t.queryEnvelope(r),Rn(e,r,n)}function Bn(e,t,n,r,i){let a=new En(0,0);return t!==null&&(a.tolerance=t.getTolerance(e),(!i||r)&&t!==null)&&(a.resolution=t.getResolution(e),r&&(a.resolution*=2)),r&&(n*=4,a.tolerance*=1.01,a.resolution*=1.01),a.total()<n?new En(n,0):a}function Vn(e){return Math.sqrt(2)*(2*e.tolerance+e.resolution)}function Hn(e){return Math.sqrt(2)*(e.tolerance+e.resolution)}function Un(e){return e>=3}function Wn(e,t){return e.getImpl().getIsSimple(t,[0])>=3}function Gn(e,t){e.getImpl().setIsSimple(3,t)}function Kn(e,t,n,r){if(Ct(t.x-e.x)+Ct(t.y-e.y)<=n*n){let n=e.z,i=t.z;return et(n,i,r)}return!1}function qn(e){return e>=4}function Jn(e,t){return e===L.enumPolygon?Un(t):t>=1}function Yn(e,t,n){let r=G.constructEmpty(),i=G.constructEmpty();e.queryLooseEnvelope(r),t.queryLooseEnvelope(i),r.inflateCoords(n,n),i.inflateCoords(n,n);let a=G.constructEmpty();a.setCoords({env2D:r}),a.intersect(i);let o=e.querySegmentIterator(),s=t.querySegmentIterator(),c=G.constructEmpty(),l=G.constructEmpty(),u=new wn;u.setTolerance(n);let d=!1;for(u.startRedConstruction();o.nextPath();)for(;o.hasNextSegment();)o.nextSegment().queryLooseEnvelope(c),c.isIntersecting(a)&&(d=!0,u.addRedEnvelope(o.getStartPointIndex(),c));if(u.endRedConstruction(),!d)return null;let f=!1;for(u.startBlueConstruction();s.nextPath();)for(;s.hasNextSegment();)s.nextSegment().queryLooseEnvelope(l),l.isIntersecting(a)&&(f=!0,u.addBlueEnvelope(s.getStartPointIndex(),l));return u.endBlueConstruction(),f?u:null}function Xn(e,t,n,r,i){e.getGeometryType(),t.getGeometryType();let a=G.constructEmpty(),o=G.constructEmpty();e.queryLooseEnvelope(a),t.queryLooseEnvelope(o),a.inflateCoords(n,n),o.inflateCoords(n,n);let s=G.constructEmpty();s.setCoords({env2D:a}),s.intersect(o);let c=new wn;c.setTolerance(n);let l=!1;c.startRedConstruction();for(let t=0,n=e.getPathCount();t<n;t++)e.queryLoosePathEnvelope(t,a),a.isIntersecting(s)&&(l=!0,c.addRedEnvelope(t,a));if(c.endRedConstruction(),!l)return null;let u=!1;c.startBlueConstruction();for(let e=0,n=t.getPathCount();e<n;e++)t.queryLoosePathEnvelope(e,o),o.isIntersecting(s)&&(u=!0,c.addBlueEnvelope(e,o));return c.endBlueConstruction(),u?c:null}function Zn(e,t,n){let r=G.constructEmpty(),i=G.constructEmpty();e.queryLooseEnvelope(r),t.queryEnvelope(i),r.inflateCoords(n,n),i.inflateCoords(n,n);let a=G.constructEmpty();a.setCoords({env2D:r}),a.intersect(i);let o=e.querySegmentIterator(),s=new wn;s.setTolerance(n);let c=!1;for(s.startRedConstruction();o.nextPath();)for(;o.hasNextSegment();)o.nextSegment().queryLooseEnvelope(r),r.isIntersecting(a)&&(c=!0,s.addRedEnvelope(o.getStartPointIndex(),r));if(s.endRedConstruction(),!c)return null;let l=!1;s.startBlueConstruction();for(let e=0,n=t.getPointCount();e<n;e++){let n=t.getXY(e);a.contains(n)&&(l=!0,s.addBlueEnvelope(e,G.construct(n.x,n.y,n.x,n.y)))}return s.endBlueConstruction(),l?s:null}function Qn(e,t,n){let r=G.constructEmpty(),i=G.constructEmpty();e.queryEnvelope(r),t.queryEnvelope(i),r.inflateCoords(n,n),i.inflateCoords(n,n);let a=G.constructEmpty();a.setCoords({env2D:r}),a.intersect(i);let o=new wn;o.setTolerance(n);let s=!1;o.startRedConstruction();let c=new z;for(let t=0,n=e.getPointCount();t<n;t++)e.queryXY(t,c),a.contains(c)&&(s=!0,o.addRedEnvelope(t,G.construct(c.x,c.y,c.x,c.y)));if(o.endRedConstruction(),!s)return null;let l=!1;o.startBlueConstruction();let u=new z;for(let e=0,n=t.getPointCount();e<n;e++)t.queryXY(e,u),a.contains(u)&&(l=!0,o.addBlueEnvelope(e,G.construct(u.x,u.y,u.x,u.y)));return o.endBlueConstruction(),l?o:null}function $n(e){let t=new G;return e.queryLooseEnvelope(t),t.inflateCoords(1,1),er(e,t)}function er(e,t,n){let r=new G;if(e.queryLooseEnvelope(r),r.isEmpty())return null;e.getGeometryType();let i=new hn(r,8),a=-1,o=new G,s=!1;do for(let n=0,c=e.getPathCount();n<c;n++)if(e.queryLoosePathEnvelope(n,o),o.isIntersecting(t)){if(a=i.insertEx(n,o,a),a===-1){s&&B(`build_quad_tree_for_paths`),r.assign(e.calculateEnvelope2D(!1)),s=!0,i.reset(r,8);break}s=!1}while(s);return i}function tr(e,t){if(!t){let t=new G;e.queryLooseEnvelope(t);let n=new hn(t,8),r=-1,i=new G,a=e.querySegmentIterator(),o=!1;for(;a.nextPath();)for(;a.hasNextSegment();){let s=a.nextSegment(),c=a.getStartPointIndex();if(s.queryLooseEnvelope(i),r=n.insertEx(c,i,r),r===-1){o&&B(``),t.assign(e.calculateEnvelope2D(!1)),o=!0,n.reset(t,8),a.resetToFirstPath();break}}return n}let n=new G;e.queryLooseEnvelope(n);let r=new hn(n,8),i=-1,a=new G,o=e.querySegmentIterator(),s=!1;for(;o.nextPath();)for(;o.hasNextSegment();){let c=o.nextSegment(),l=o.getStartPointIndex();if(c.queryLooseEnvelope(a),a.isIntersecting(t)&&(i=r.insertEx(l,a,i),i===-1)){s&&B(``),n.assign(e.calculateEnvelope2D(!1)),s=!0,r.reset(n,8),o.resetToFirstPath();break}}return r}function nr(e,t){if(t){let n=new hn(t,8),r=new z,i=new G,a=!1;for(let o=0;o<e.getPointCount();o++)r.setCoordsPoint2D(e.getXY(o)),t.contains(r)&&(i.setCoords({pt:r}),n.insert(o,i)!==-1||(a&&B(``),a=!0,n.reset(e.calculateEnvelope2D(),8),o=-1));return n}return xt(`no-extent version not yet impl`),null}function rr(e,t,n,r,i){let a=!1,o=i.vmin,s=i.vmax;for(let i=n;i<t;i+=r){let t=e.read(i);t<o?(a=!0,e.write(i,o)):t>s&&(a=!0,e.write(i,s))}return a}function ir(e,t,n,r){if(!e.hasAttribute(n))return!1;let i=e.getGeometryType();if(i===L.enumGeometryCollection){let i=e,a=i.getGeometryCount(),o=0;for(let e=0;e<a;++e)o|=ir(i.getGeometry(e),t,n,r)?1:0;return!!o}if(d(i)){let i=e,a=Tn.getPersistence(n),o=Tn.getComponentCount(n),s=i.getPointCount();if(a===1){let e=rr(i.getAttributeStreamRef(n),s*o,r,o,t);return e&&i.notifyModified(),e}if(a===2){let e=rr(i.getAttributeStreamRef(n),s*o,r,o,t);return e&&i.notifyModified(),e}B(`snap_coordinate not implemented`)}if(i===L.enumEnvelope){let i=e,a=i.queryInterval(n,r),o=!1;return a.vmin<t.vmin&&(o=!0,a.vmin=t.vmin),a.vmax>t.vmax&&(o=!0,a.vmax=t.vmax),o&&i.setIntervalEnvelope(n,r,a),o}if(i===L.enumPoint){let i=e,a=i.getAttributeAsDbl(n,r),o=!1;return a<t.vmin&&(o=!0,a=t.vmin),a>t.vmax&&(o=!0,a=t.vmax),o&&i.setAttributeBasic(n,r,a),o}if(Ne(i)){let i=e,a=i.getStartAttributeAsDbl(n,r),o=!1;return a<t.vmin&&(o=!0,a=t.vmin),a>t.vmax&&(o=!0,a=t.vmax),o&&i.setStartAttribute(n,r,a),a=i.getEndAttributeAsDbl(n,r),a<t.vmin&&(o=!0,a=t.vmin),a>t.vmax&&(o=!0,a=t.vmax),o&&i.setEndAttribute(n,r,a),o}B(`snap_coordinate not implemented`)}var ar=Rt,q=class e{constructor(e){if(this.m_description=null,this.x=NaN,this.y=NaN,this.m_attribs=null,e){if(!e.copy)return e.move?(this.m_description=e.move.m_description,e.move.m_description=null,this.m_attribs=e.move.m_attribs,e.move.m_attribs=null,this.x=e.move.x,void(this.y=e.move.y)):e.vd?(this.m_description=e.vd,void(e.attribBuffer?(this.m_attribs=e.attribBuffer,e.initDefaultValues&&this.setDefaultAttributeValues()):this.ensureAttributes())):e.pt?(this.m_description=Kt(),void this.setXY(e.pt)):void(`x`in e&&(`z`in e?(this.m_description=qt(),this.ensureAttributes(),this.setXYZ(new K(e.x,e.y,e.z))):(this.m_description=Kt(),this.setXYCoords(e.x,e.y))));e.copy.copyTo(this)}else this.m_description=Kt()}assignCopy(e){return this.m_attribs=null,e.copyTo(this),this}assignMove(e){return this.m_attribs=null,e.copyTo(this),e.setEmpty(),this}getXY(){return new z(this.x,this.y)}queryXY(e){e.x=this.x,e.y=this.y}setXY(e){this.x=e.x,this.y=e.y}setXYCoords(e,t){this.x=e,this.y=t}getXYZ(){let e=new K;return e.x=this.x,e.y=this.y,e.z=this.getZ(),e}setXYZ(e){this.addAttribute(1),this.x=e.x,this.y=e.y,this.m_attribs[0]=e.z}getX(){return this.x}setX(e){this.x=e}getY(){return this.y}setY(e){this.y=e}getZ(){return this.m_description.hasZ()?this.m_attribs[0]:ar.getDefaultValue(1)}setZ(e){this.addAttribute(1),this.m_attribs[0]=e}getM(){return this.getAttributeAsDbl(2,0)}setM(e){this.addAttribute(2),this.m_description.hasZ()?this.m_attribs[1]=e:this.m_attribs[0]=e}getID(){return this.getAttributeAsInt(3,0)}setID(e){this.setAttributeBasic(3,0,e)}isEqualXY(e,t){return t===void 0&&(t=0),Math.abs(e.x-this.x)<=t&&Math.abs(e.y-this.y)<=t}isEqualXYCoords(e,t,n){return n===void 0&&(n=0),Math.abs(e-this.x)<=n&&Math.abs(t-this.y)<=n}getAttributeAsDbl(e,t){if(e===0){if(t===0)return this.x;if(t===1)return this.y;E(``)}let n=ar.getComponentCount(e);(t<0||t>=n)&&E(``);let r=this.m_description.getAttributeIndex(e);return r>=0?this.m_attribs[this.m_description.getPointAttributeOffset(r)-2+t]:ar.getDefaultValue(e)}getAttributeAsInt(e,t){return Math.trunc(this.getAttributeAsDbl(e,t))}setAttributeBasic(e,t,n){if(e===0)return void(t===0?this.x=n:t===1?this.y=n:E(``));let r=ar.getComponentCount(e);(t<0||t>=r)&&E(``);let i=this.m_description.getAttributeIndex(e);i<0&&(this.addAttribute(e),i=this.m_description.getAttributeIndex(e)),this.m_attribs[this.m_description.getPointAttributeOffset(i)-2+t]=n}copyAttributesFrom(e,t){if(this===e)return;let n=e.getDescription();for(let r=t&&n.hasZ()?2:1,i=n.getAttributeCount();r<i;++r){let t=n.getSemantics(r),i=ar.getComponentCount(t);for(let n=0;n<i;++n){let r=e.getAttributeAsDbl(t,n);this.setAttributeBasic(t,n,r)}}}getAttributeArray(){return this.m_attribs}getDescription(){return this.m_description}assignVertexDescription(e){this.m_description!==e&&this.assignVertexDescriptionImpl(e)}mergeVertexDescription(e){this.m_description!==e&&(this.m_description.hasAttributesFrom(e)||this.mergeVertexDescriptionImpl(e))}hasAttribute(e){return this.m_description.hasAttribute(e)}addAttribute(e){if(this.m_description.hasAttribute(e))return;let t=Wt(this.m_description,e);this.assignVertexDescription(t)}dropAttribute(e){if(!this.m_description.hasAttribute(e))return;let t=Gt(this.m_description,e);this.assignVertexDescription(t)}dropAllAttributes(){let e=Kt();e!==this.m_description&&this.assignVertexDescription(e)}getGeometryType(){return L.enumPoint}getDimension(){return 0}queryEnvelope(e){if(e instanceof lr)return e.setEmpty(),e.assignVertexDescription(this.m_description),void e.merge(this);if(e instanceof Yt){if(this.isEmpty())return void e.setEmpty();let t=this.getXYZ();e.xmin=t.x,e.ymin=t.y,e.zmin=t.z,e.xmax=t.x,e.ymax=t.y,e.zmax=t.z;return}this.isEmpty()?e.setEmpty():(e.xmin=this.x,e.ymin=this.y,e.xmax=this.x,e.ymax=this.y)}queryLooseEnvelope(e){this.queryEnvelope(e)}queryInterval(e,t){let n=new I;if(this.isEmpty())return n.setEmpty(),n;let r=this.getAttributeAsDbl(e,t);return n.vmin=r,n.vmax=r,n}applyTransformation(e){if(!this.isEmpty()){if(e.m_TransformationType===1){let t=this.getXY();e.transformInPlace(t),this.setXY(t);return}xt(`3d not impl`)}}transformAttribute(e,t,n,r,i){if(this.isEmpty())return;this.addAttribute(e);let a=this.getAttributeAsDbl(e,t),o=On(n,r,i);this.setAttributeBasic(e,t,o(a))}createInstance(){return new e({vd:this.m_description})}copyTo(e){if(this===e)return;e.getGeometryType()!==L.enumPoint&&R();let t=e;t.x=this.x,t.y=this.y,this.m_attribs?(t.assignVertexDescription(this.m_description),t.m_attribs=this.m_attribs.slice()):(t.releaseAttributes(),t.assignVertexDescription(this.m_description))}isEmpty(){return Number.isNaN(this.x)||Number.isNaN(this.y)}setEmpty(){this.m_description||(this.m_description=Kt(),this.releaseAttributes()),this.x=NaN,this.y=NaN,this.m_attribs&&Qe(this.m_attribs,this.m_description.getDefaultPointAttributes(),0,2,this.m_description.getTotalComponentCount()-2)}calculateArea2D(){return 0}calculateLength2D(){return 0}calculateLength3D(e){return 0}equals(e,t){if(e===this)return!0;if(e.getGeometryType()!==L.enumPoint)return!1;let n=e;if(this.m_description!==n.m_description||this.isEmpty()!==n.isEmpty())return!1;if(this.isEmpty())return!0;if(t===void 0&&(t=0),Math.abs(this.x-n.x)>t||Math.abs(this.y-n.y)>t)return!1;for(let e=0,r=this.m_description.getTotalComponentCount()-2;e<r;e++)if(!et(this.m_attribs[e],n.m_attribs[e],t))return!1;return!0}getBoundary(){return null}clone(){let t=new e({vd:this.m_description});return this.copyTo(t),t}swap(e){if(this===e)return;e.getGeometryType()!==L.enumPoint&&R(`wrong geometry type`);let t=e;t.m_description=W(this.m_description,this.m_description=t.m_description),t.x=W(this.x,this.x=t.x),t.y=W(this.y,this.y=t.y),t.m_attribs=W(this.m_attribs,this.m_attribs=t.m_attribs)}replaceNaNs(e,t){if(this.addAttribute(e),this.isEmpty())return;let n=ar.getComponentCount(e);for(let r=0;r<n;r++){let n=this.getAttributeAsDbl(e,r);Number.isNaN(n)&&this.setAttributeBasic(e,r,t)}}lerp(e,t,n){if(e.getDescription()!==t.getDescription()&&R(`Point.lerp`),this.assignVertexDescription(e.getDescription()),e.isEmpty()||t.isEmpty())return this.setEmpty(),this;this.ensureAttributes();let r=Lt();e.queryValues(r,r.length);let i=Lt();t.queryValues(i,i.length);let a=Lt(),o=r,s=i,c=a,l=0;for(let e=0,t=this.m_description.getAttributeCount();e<t;e++){let t=this.m_description.getSemantics(e),r=ar.getInterpolation(t),i=ar.getComponentCount(t),a=ar.getDefaultValue(t);S(r,o,s,c,l,i,n,a),o=o.slice(i),s=s.slice(i),l+=i}return this.setValues(a,l),this}static lerp(e,t,n,r){r.lerp(e,t,n)}setDefaultAttributeValues(){let e=this.m_description.getTotalComponentCount()-2;e>0&&(this.m_attribs?Qe(this.m_attribs,this.m_description.getDefaultPointAttributes(),0,2,e):this.m_attribs=this.m_description.getDefaultPointAttributes().slice(2))}static sqrDistance2D(e,t){return z.sqrDistanceCoords(e.x,e.y,t.x,t.y)}getImpl(){return this}mergeVertexDescriptionImpl(e){let t=Ut(this.getDescription(),e);this.assignVertexDescription(t)}releaseAttributes(){this.m_attribs=null}assignVertexDescriptionImpl(e){this.m_description||=Kt();let t=Bt();Jt(e,this.m_description,t);let n=null;e.getTotalComponentCount()-2>0&&(n=e.getDefaultPointAttributes().slice(2));for(let r=1,i=e.getAttributeCount();r<i;r++){let i=t[r];if(i!==-1){let t=this.m_description.getPointAttributeOffset(i)-2,a=e.getPointAttributeOffset(r)-2,o=ar.getComponentCount(e.getSemantics(r));for(let e=0;e<o;e++)n[a+e]=this.m_attribs[t+e]}}this.m_attribs=n,this.m_description=e}ensureAttributes(){this.m_description.getTotalComponentCount()-2>0&&this.m_attribs===null&&(this.m_attribs=this.m_description.getDefaultPointAttributes().slice(2))}queryValues(e,t){let n=this.m_description.getTotalComponentCount();U(n<=t),e[0]=this.x,e[1]=this.y,Qe(e,this.m_attribs,2,0,n-2)}copyCommonAttributesTo(e){e.x=this.x,e.y=this.y;let t=e.getDescription();if(t===this.m_description)this.m_attribs&&Qe(e.m_attribs,this.m_attribs,0,0,this.m_description.getTotalComponentCount()-2);else{let n=0;for(let r=1,i=t.getAttributeCount();r<i;r++){let i=t.getSemantics(r),a=ar.getComponentCount(i);if(this.m_description.hasAttribute(i)){let t=this.m_description.getPointAttributeOffset(this.m_description.getAttributeIndex(i))-2;for(;a!==0;)e.m_attribs[n++]=this.m_attribs[t++],a--}else{let t=ar.getDefaultValue(i);for(;a!==0;)e.m_attribs[n++]=t,a--}}}}setValues(e,t){let n=this.m_description.getTotalComponentCount();U(n<=t),this.x=e[0],this.y=e[1],Qe(this.m_attribs,e,0,2,n-2)}dbgDefaultAttribs(){}};q.type=L.enumPoint;var or=Rt;function sr(e,t){return t*(e.getTotalComponentCount()-2)}var cr=class{constructor(e){if(this.m_attributes=null,e)if(e.xmin!==void 0)this.m_envelope2D=new G(e.xmin,e.ymin,e.xmax,e.ymax);else if(e.env2D!==void 0)this.m_envelope2D=new G(e.env2D);else if(e.move)this.m_envelope2D=new G(e.move.m_envelope2D),this.m_attributes=e.move.m_attributes,e.move.m_attributes=null;else{if(!e.moveEnv)throw Error(`unrecognized EnvelopeData constructor options`);{let t=e.moveEnv.accessEnvelopeData();this.m_envelope2D=new G(t.m_envelope2D),this.m_attributes=t.m_attributes,t.m_attributes=null}}else this.m_envelope2D=G.constructEmpty()}ensureAttributes(e){let t=e.getTotalComponentCount()-2;!this.m_attributes&&t&&(this.m_attributes=H(2*t,NaN),this.m_attributes.fill(NaN))}copyTo(e,t){let n=t,r=e.getTotalComponentCount()-2;if(n.m_description!==e&&(n.releaseAttributes_(),n.m_description=e,r&&(n.m_data.m_attributes=H(2*r,NaN))),r){U(this.m_attributes&&n.m_data.m_attributes);let e=2*r;Qe(n.m_data.m_attributes,this.m_attributes,0,0,e)}n.m_data.m_envelope2D=new G(this.m_envelope2D)}copyToIfNotNull(e,t){t.m_envelope2D=new G(this.m_envelope2D),t.releaseAttributes(),e.getTotalComponentCount()-2&&this.m_attributes&&(t.m_attributes=this.m_attributes.slice())}releaseAttributes(){this.m_attributes=null}isEmpty(){return this.m_envelope2D.isEmpty()}transformAttribute(e,t,n,r,i){U(0)}queryInterval(e,t,n,r){if(this.isEmpty())return void r.setEmpty();if(t===0)return void(n===0?this.m_envelope2D.queryIntervalX(r):n===1?this.m_envelope2D.queryIntervalY(r):E(``));let i=or.getComponentCount(t);(n<0||n>=i)&&E(``);let a=e.getAttributeIndex(t);if(a>=0)return r.vmin=this.m_attributes[sr(e,0)+e.getPointAttributeOffset(a)-2+n],void(r.vmax=this.m_attributes[sr(e,1)+e.getPointAttributeOffset(a)-2+n]);{let e=or.getDefaultValue(t);r.setCoords(e,e);return}}queryEnvelope3D(e,t){let n=new I;this.queryInterval(e,1,0,n),t.setCoords(this.m_envelope2D.xmin,this.m_envelope2D.ymin,n.vmin,this.m_envelope2D.xmax,this.m_envelope2D.ymax,n.vmax)}setEmpty(e){this.m_envelope2D.setEmpty();let t=e.getTotalComponentCount()-2;t&&(this.m_attributes?this.dbgAssertSize(t):this.m_attributes=H(2*t,NaN),this.m_attributes.fill(NaN))}dbgAssertSize(e){}},lr=class e{constructor(e){if(this.m_EnvelopeType=4,this.m_description=Kt(),e===void 0)this.m_data=new cr;else if(e.vd!==void 0)this.m_description=e.vd,this.m_data=new cr,this.ensureAttributes_();else if(e?.env2D)this.m_data=new cr({env2D:e.env2D});else if(e.xmin!==void 0)this.m_data=new cr({xmin:e.xmin,ymin:e.ymin,xmax:e.xmax,ymax:e.ymax});else if(e.copy)this.m_data=new cr,e.copy.copyTo(this);else if(e.move)this.m_description=e.move.m_description,e.move.m_description=null,this.m_data=new cr({move:e.move.m_data});else{if(!e.centerPoint)throw Error(`unrecognized Envelope constructor options`);this.m_description=e.centerPoint.getDescription(),this.m_data=new cr,this.ensureAttributes_(),this.setFromPoint(e.centerPoint,e.width,e.height)}}accessEnvelopeData(){return this.m_description=null,this.m_data}assignMove(e){return this===e||(this.m_description=e.m_description,e.m_description=null,this.m_data=new cr({move:e.m_data})),this}assignCopy(e){return this===e||e.copyTo(this),this}transformAttribute(e,t,n,r,i){U(0)}setAttributeBasic(e,t,n){if(this.addAttribute(e),this.m_data.isEmpty())return;let r=this.queryInterval(e,t);r.vmin=n,r.vmax=n,this.setIntervalEnvelope(e,t,r)}mergeVertexDescriptionImpl(e){let t=Ut(this.getDescription(),e);this.assignVertexDescription(t)}asEnvelope2D(){return new G(this.m_data.m_envelope2D)}assignVertexDescription(e){this.m_description!==e&&this.assignVertexDescriptionImpl(e)}getGeometryType(){return L.enumEnvelope}getDimension(){return 2}getXMin(){return this.m_data.m_envelope2D.xmin}getYMin(){return this.m_data.m_envelope2D.ymin}getXMax(){return this.m_data.m_envelope2D.xmax}getYMax(){return this.m_data.m_envelope2D.ymax}width(){return this.m_data.isEmpty()?NaN:this.m_data.m_envelope2D.width()}height(){return this.m_data.isEmpty()?NaN:this.m_data.m_envelope2D.height()}getCenterXY(){return this.m_data.isEmpty()?new z:this.m_data.m_envelope2D.getCenter()}getCenter(e){if(e.assignVertexDescription(this.m_description),this.m_data.isEmpty())return void e.setEmpty();let t=this.m_description.getAttributeCount();for(let n=1;n<t;n++){let t=this.m_description.getSemantics(n),r=or.getComponentCount(t);for(let n=0;n<r;n++){let r=.5*(this.getAttributeAsDblImpl(0,t,n)+this.getAttributeAsDblImpl(1,t,n));e.setAttributeBasic(t,n,r)}}e.setXY(this.m_data.m_envelope2D.getCenter())}setCoords(e,t,n,r){this.m_data.m_envelope2D.setCoords({xmin:e,ymin:t,xmax:n,ymax:r})}setEnvelope(e){if(e instanceof G)this.m_data.m_envelope2D=new G(e),this.m_data.m_envelope2D.normalize();else{this.addAttribute(1),this.m_data.m_envelope2D=e.getEnvelope2D(),this.m_data.m_envelope2D.normalize();let t=I.constructEmpty();t.setCoords(e.zmin,e.zmax),this.setInterval(1,0,t.vmin,t.vmax)}}merge(t){if(t instanceof G)return t.isValid()||R(``),void this.m_data.m_envelope2D.mergeEnvelope2D(t);if(t instanceof e){if(t.m_data.isEmpty())return;let e=t.getDescription();this.mergeVertexDescription(e),this.m_data.m_envelope2D.mergeEnvelope2D(t.m_data.m_envelope2D);for(let n=1,r=e.getAttributeCount();n<r;n++){let r=e.getSemantics(n),i=or.getComponentCount(r);for(let e=0;e<i;e++){let n=t.queryInterval(r,e),i=this.queryInterval(r,e);i.merge(n),this.setIntervalEnvelope(r,e,i)}}return}if(t instanceof q){let e=t;if(e.isEmpty())return;let n=e.getDescription();if(this.mergeVertexDescription(n),this.m_data.isEmpty())return void this.setFromPoint(e);this.m_data.m_envelope2D.merge(e.getXY());for(let t=1,r=n.getAttributeCount();t<r;t++){let r=n.getSemantics(t),i=or.getComponentCount(r);for(let t=0;t<i;t++){let n=e.getAttributeAsDbl(r,t),i=this.queryInterval(r,t);i.mergeCoordinate(n),this.setIntervalEnvelope(r,t,i)}}return}xt(`unrecognized type for envelope.merge`)}intersect(e){if(!this.m_data.m_envelope2D.intersect(e.m_data.m_envelope2D))return this.setEmpty(),!1;let t=e.getDescription();this.mergeVertexDescription(t);for(let t=1,n=this.m_description.getAttributeCount();t<n;t++){let n=this.m_description.getSemantics(t),r=or.getComponentCount(n);for(let t=0;t<r;t++){let r=e.queryInterval(n,t),i=this.queryInterval(n,t);i.intersect(r),this.setIntervalEnvelope(n,t,i)}}return!0}intersectCommonAttributes(e){if(!this.m_data.m_envelope2D.intersect(e.m_data.m_envelope2D))return this.setEmpty(),!1;let t=e.getDescription();for(let n=1,r=this.m_description.getAttributeCount();n<r;n++){let r=this.m_description.getSemantics(n);if(!t.hasAttribute(r))continue;let i=or.getComponentCount(r);for(let t=0;t<i;t++){let n=e.queryInterval(r,t),i=this.queryInterval(r,t);i.intersect(n),this.setIntervalEnvelope(r,t,i)}}return!0}move(e,t){this.m_data.m_envelope2D.move(e,t)}centerAt(e,t){this.m_data.m_envelope2D.centerAtCoords(e,t)}centerAtPoint(e){this.m_data.m_envelope2D.centerAt(e)}reaspect(e,t){this.m_data.m_envelope2D.reaspect(e,t)}inflateCoords(e,t){this.m_data.m_envelope2D.inflateCoords(e,t)}containsCoords(e,t){return this.m_data.m_envelope2D.containsCoords(e,t)}contains(e){return this.m_data.m_envelope2D.contains(e)}containsPoint(e){return!e.isEmpty()&&this.m_data.m_envelope2D.contains(e.getXY())}containsEnvelope(e){return this.m_data.m_envelope2D.containsEnvelope(e.m_data.m_envelope2D)}setIntervalEnvelope(e,t,n){if(this.addAttribute(e),this.m_data.isEmpty())return;let r=new I(n);if(r.normalize(),e===0){if(r.isEmpty())return void this.setEmpty();t===0?(this.m_data.m_envelope2D.xmin=r.vmin,this.m_data.m_envelope2D.xmax=r.vmax):t===1?(this.m_data.m_envelope2D.ymin=r.vmin,this.m_data.m_envelope2D.ymax=r.vmax):E(``)}else this.setAttributeAsDblImpl(0,e,t,r.vmin),this.setAttributeAsDblImpl(1,e,t,r.vmax)}setInterval(e,t,n,r){this.setIntervalEnvelope(e,t,new I(n,r))}queryInterval(e,t){let n=new I;return this.m_data.queryInterval(this.m_description,e,t,n),n}queryEnvelope(e){e.m_EnvelopeType===2?e.setCoords({env2D:this.m_data.m_envelope2D}):e.m_EnvelopeType===3?this.m_data.queryEnvelope3D(this.m_description,e):e.m_EnvelopeType===4?this.copyTo(e):xt(`unrecognized type for queryEnveloper`)}applyTransformation(e){e.m_TransformationType===1?e.transformEnvInPlace(this.m_data.m_envelope2D):U(0)}createInstance(){return new e({vd:this.m_description})}copyTo(e){e!==this&&this.m_data.copyTo(this.m_description,e)}isEmpty(){return this.m_data.isEmpty()}setEmpty(){this.m_description||=Kt(),this.m_data.setEmpty(this.m_description)}calculateArea2D(){return this.m_data.m_envelope2D.getArea()}calculateLength2D(){return this.m_data.m_envelope2D.getLength()}calculateLength3D(e){return U(0),0}equals(e,t){if(e===this)return!0;let n=e;if(this.m_description!==n.m_description||this.m_data.isEmpty()!==n.m_data.isEmpty())return!1;if(this.m_data.isEmpty())return!0;if(t===void 0&&(t=0),Math.abs(this.m_data.m_envelope2D.xmin-n.m_data.m_envelope2D.xmin)>t||Math.abs(this.m_data.m_envelope2D.ymin-n.m_data.m_envelope2D.ymin)>t||Math.abs(this.m_data.m_envelope2D.xmax-n.m_data.m_envelope2D.xmax)>t||Math.abs(this.m_data.m_envelope2D.ymax-n.m_data.m_envelope2D.ymax)>t)return!1;for(let e=0,r=2*(this.m_description.getTotalComponentCount()-2);e<r;e++)if(!et(this.m_data.m_attributes[e],n.m_data.m_attributes[e],t))return!1;return!0}getBoundary(){return xt(`getBoundary not available in this context. Use the boundary operator with an envelope parameter`),null}clone(){return new e({copy:this})}swap(e){if(this===e)return;e.getGeometryType()!==L.enumEnvelope&&R(`wrong geometry type`);let t=e;t.m_description=W(this.m_description,this.m_description=t.m_description),t.m_data.m_envelope2D=W(this.m_data.m_envelope2D,this.m_data.m_envelope2D=t.m_data.m_envelope2D),t.m_data.m_attributes=W(this.m_data.m_attributes,this.m_data.m_attributes=t.m_data.m_attributes)}queryCoordinates(e){this.m_data.isEmpty()&&R(``),this.m_data.m_envelope2D.queryCorners(e)}queryCornerByVal(e,t){(e<0||e>3)&&E(``),t.assignVertexDescription(this.m_description);let n=this.getDescription().getAttributeCount();for(let r=1;r<n;r++){let n=this.m_description.getSemantics(r),i=or.getComponentCount(n);for(let r=0;r<i;r++)t.setAttributeBasic(n,r,this.getAttributeAsDblImpl(e%2,n,r))}t.setXY(this.m_data.m_envelope2D.queryCorner(e))}queryCorner(e,t){t.assign(this.m_data.m_envelope2D.queryCorner(e))}getDescription(){return this.m_description}mergeVertexDescription(e){this.m_description!==e&&(this.m_description&&this.m_description.hasAttributesFrom(e)||this.mergeVertexDescriptionImpl(e))}hasAttribute(e){return this.m_description.hasAttribute(e)}addAttribute(e){if(this.m_description.hasAttribute(e))return;let t=Wt(this.m_description,e);this.assignVertexDescription(t)}dropAttribute(e){if(!this.m_description.hasAttribute(e))return;let t=Gt(this.m_description,e);this.assignVertexDescription(t)}dropAllAttributes(){let e=Kt();e!==this.m_description&&this.assignVertexDescription(e)}queryLooseEnvelope(e){this.queryEnvelope(e)}replaceNaNs(e,t){if(this.addAttribute(e),this.m_data.isEmpty())return;let n=or.getComponentCount(e);for(let r=0;r<n;r++){let n=this.queryInterval(e,r);n.isEmpty()&&(n.vmin=t,n.vmax=t,this.setIntervalEnvelope(e,r,n))}}getImpl(){return this}setFromPoint(e,t,n){this.m_data.m_envelope2D.setCoords({center:e.getXY(),width:t??0,height:n??0});let r=e.getDescription();for(let t=1,n=r.getAttributeCount();t<n;t++){let n=r.getSemantics(t),i=or.getComponentCount(n);for(let t=0;t<i;t++){let r=e.getAttributeAsDbl(n,t);this.setInterval(n,t,r,r)}}}assignVertexDescriptionImpl(e){let t=Bt();Jt(e,this.m_description,t);let n=null,r=e.getTotalComponentCount()-2,i=this.m_description?this.m_description.getTotalComponentCount()-2:0;r>0&&(n=H(2*r,NaN));for(let a=1;a<e.getAttributeCount();a++){let o=t[a];if(o!==-1){let t=e.getPointAttributeOffset(a)-2,s=or.getComponentCount(e.getSemantics(a)),c=this.m_description.getPointAttributeOffset(o)-2;Qe(n,this.m_data.m_attributes,t,c,s),Qe(n,this.m_data.m_attributes,r+t,i+c,s)}}this.releaseAttributes_(),this.m_data.m_attributes=n,this.m_description=e}getAttributeAsDblImpl(e,t,n){if(this.m_data.isEmpty()&&se(``),t===0)return e?n?this.m_data.m_envelope2D.ymax:this.m_data.m_envelope2D.xmax:n?this.m_data.m_envelope2D.ymin:this.m_data.m_envelope2D.xmin;n>=or.getComponentCount(t)&&E(``);let r=this.m_description.getAttributeIndex(t);return r>=0?this.m_data.m_attributes[sr(this.m_description,e)+this.m_description.getPointAttributeOffset(r)-2+n]:Rt.getDefaultValue(t)}setAttributeAsDblImpl(e,t,n,r){t===0&&(e?n===1?this.m_data.m_envelope2D.ymax=r:n===0?this.m_data.m_envelope2D.xmax=r:E(``):n===1?this.m_data.m_envelope2D.ymin=r:n===0?this.m_data.m_envelope2D.xmin=r:E(``));let i=or.getComponentCount(t);(n<0||n>=i)&&E(``),this.addAttribute(t);let a=this.m_description.getAttributeIndex(t);this.m_data.m_attributes[sr(this.m_description,e)+this.m_description.getPointAttributeOffset(a)-2+n]=r}releaseAttributes_(){this.m_data.releaseAttributes()}ensureAttributes_(){this.m_data.ensureAttributes(this.m_description)}};lr.type=L.enumEnvelope,Object.freeze(Object.defineProperty({__proto__:null,Envelope:lr,EnvelopeData:cr},Symbol.toStringTag,{value:`Module`}));var ur=class extends n{constructor(e,t){super(),this.m_index=-1,this.gc=e,this.dim=t}next(){for(;;){if(this.m_index>=this.gc.getGeometryCount()||(this.m_index++,this.m_index===this.gc.getGeometryCount()))return null;let e=this.gc.getGeometry(this.m_index);if(this.dim===-1||1<<e.getDimension()&this.dim)return e}return null}getGeometryID(){return this.m_index}tock(){return!0}getRank(){return 1}},dr=class e{constructor(e){this.m_geoms=[],this.m_description=Kt(),e&&(e.vd?this.m_description=e.vd:e.copy?e.copy.copyTo(this):R(`constructor argument not recognized`))}getGeometryCount(){return this.m_geoms.length}reserve(e){}addGeometry(e){if(e.getGeometryType()===L.enumGeometryCollection){let t=e;for(let e=0,n=t.getGeometryCount();e<n;e++)this.addGeometry(t.getGeometry(e))}else this.m_geoms.push(e.clone()),this.mergeVertexDescription(e.getDescription())}addCursor(e){for(let t=e.next();t!==null;t=e.next())this.addGeometry(t)}getGeometry(e){return(e<0||e>=this.m_geoms.length)&&R(`Geometry_collection.get_geometry`),this.m_geoms[e]}modifiedElementIndex(e){this.mergeVertexDescription(this.getGeometry(e).getDescription())}modifiedElement(e){this.mergeVertexDescription(e.getDescription())}getGeometryType(){return L.enumGeometryCollection}getDimension(){let e=0;for(let t of this.m_geoms)e=Math.max(e,t.getDimension());return e}getDescription(){return this.m_description}assignVertexDescription(e){this.m_description!==e&&this.assignVertexDescriptionImpl(e)}assignVertexDescriptionImpl(e){for(let t of this.m_geoms)t.assignVertexDescription(e);this.m_description=e}mergeVertexDescription(e){this.m_description!==e&&(this.m_description.hasAttributesFrom(e)||this.mergeVertexDescriptionImpl(e))}hasAttribute(e){return this.m_description.hasAttribute(e)}addAttribute(e){if(this.m_description.hasAttribute(e))return;let t=Wt(this.m_description,e);this.assignVertexDescription(t)}dropAttribute(e){if(!this.m_description.hasAttribute(e))return;let t=Gt(this.m_description,e);this.assignVertexDescription(t)}dropAllAttributes(){let e=Kt();e!==this.m_description&&this.assignVertexDescription(e)}queryInterval(e,t){let n=new I,r=new I;r.setEmpty();for(let i of this.m_geoms)n=i.queryInterval(e,t),r.merge(n);return r}queryEnvelope(e){if(e.m_EnvelopeType===4){let t=new lr;e.setEmpty(),e.assignVertexDescription(this.m_description);for(let n of this.m_geoms)n.queryEnvelope(t),e.merge(t)}else if(e.m_EnvelopeType===2){let t=new G;e.setEmpty();for(let n of this.m_geoms)n.queryEnvelope(t),e.mergeEnvelope2D(t)}xt(`3d envelope case not implemented`)}queryLooseEnvelope(e){if(e.m_EnvelopeType===2){let t=new G;e.setEmpty();for(let n of this.m_geoms)n.queryLooseEnvelope(t),e.mergeEnvelope2D(t)}xt(`3d not impl`)}isEmpty(){return this.m_geoms.length===0}setEmpty(){this.m_geoms.length=0}applyTransformation(e){if(e.m_TransformationType===1)for(let t of this.m_geoms)t.applyTransformation(e);xt(`3d xform not impl`)}transformAttribute(e,t,n,r,i){for(let a of this.m_geoms)a.transformAttribute(e,t,n,r,i)}createInstance(){return new e({vd:this.getDescription()})}copyTo(e){e.getGeometryType()!==L.enumGeometryCollection&&R(``);let t=e;if(t!==this){t.m_geoms.length=0,t.assignVertexDescription(this.m_description);for(let e of this.m_geoms)t.m_geoms.push(e.clone())}}calculateArea2D(){let e=new s(0);for(let t of this.m_geoms)e.pe(t.calculateArea2D());return e.getResult()}calculateLength2D(){let e=new s(0);for(let t of this.m_geoms)e.pe(t.calculateLength2D());return e.getResult()}calculateLength3D(e){return U(0),0}getBoundary(){let e=this.createInstance(),t=e;for(let e of this.m_geoms){let n=e.getBoundary();n&&t.m_geoms.push(n)}return e}clone(){return new e({copy:this})}equals(e,t){if(e===this)return!0;if(e.getGeometryType()!==L.enumGeometryCollection)return!1;let n=e;if(this.m_description!==n.m_description||this.m_geoms.length!==n.m_geoms.length)return!1;for(let e=0;e<this.m_geoms.length;++e)if(!this.m_geoms[e].equals(n.m_geoms[e],t))return!1;return!0}swap(e){e.getGeometryType()!==L.enumGeometryCollection&&R(``);let t=e;t!==this&&(this.m_geoms=W(t.m_geoms,t.m_geoms=this.m_geoms))}setAttributeBasic(e,t,n){for(let r of this.m_geoms)r.setAttributeBasic(e,t,n)}replaceNaNs(e,t){for(let n of this.m_geoms)n.replaceNaNs(e,t)}getImpl(){return this}mergeVertexDescriptionImpl(e){let t=this.getDescription(),n=Ut(t,e);this.assignVertexDescription(n)}};function fr(e,t=-1){return new ur(e,t)}dr.type=L.enumGeometryCollection;var pr=class e{constructor(){this.m_EnvelopeType=5,this.envAabb=G.constructEmpty(),this.envRot=G.constructEmpty()}static constructEmpty(){return new e}width(){return this.envAabb.width()}height(){return this.envAabb.height()}maxDim(){return Math.max(this.width(),this.height())}setEmpty(){this.envAabb.setEmpty(),this.envRot.setEmpty()}setCoords(e){this.envAabb.setCoords(e),this.envRot.setCoords({x:gr(e),y:_r(e)})}setFromPoints(e,t){this.setEmpty(),this.mergePoints(e,t)}mergeNe(e){this.envAabb.mergeNe(e),this.envRot.mergeNeCoords(gr(e),_r(e))}mergePoints(e,t){this.envAabb.mergePoints(e,t);for(let n=0;n<t;){if(!this.envRot.isEmpty()){for(let r=n;r<t;r++){let t=gr(e[r]),n=_r(e[r]);this.envRot.mergeNeCoords(t,n)}break}{let t=gr(e[n]),r=_r(e[n]);this.envRot.setCoords({x:t,y:r}),n++}}}isIntersectingPoint2D(e){return!(!this.envAabb.contains(e)||!this.envRot.containsCoords(gr(e),_r(e)))}isIntersectingW(e){return this.envAabb.isIntersecting(e.envAabb)&&this.envRot.isIntersecting(e.envRot)}containsW(e){return!(!this.envAabb.containsEnvelope(e.envAabb)||!this.envRot.containsEnvelope(e.envRot))}containsPoint2D(e){return this.isIntersectingPoint2D(e)}intersectW(e){let t=this.envAabb.intersect(e.envAabb),n=this.envRot.intersect(e.envRot);return t&&!n&&this.envAabb.setEmpty(),n&&!t&&this.envRot.setEmpty(),t&&n}inflate(t){this.envAabb.inflateCoords(t,t);let n=t*Et();this.envRot.inflateCoords(n,n),n<0&&e.st_reduceEmpty(this)}static st_reduceEmpty(e){let t=e.envAabb.isEmpty(),n=e.envRot.isEmpty();t&&!n?e.envRot.setEmpty():n&&!t&&e.envAabb.setEmpty()}sqrMaxMinDistance(e){let t=this.envAabb.sqrMaxMinDistance(e),n=this.envRot.sqrMaxMinDistance(vr(e))/2;return Math.max(t,n)}sqrMinDistance(e){let t=this.envAabb.sqrMinDistance(e),n=this.envRot.sqrMinDistance(vr(e))/2;return Math.max(t,n)}sqrMaxDistance(e){let t=this.envAabb.sqrMaxDistance(e),n=this.envRot.sqrMaxDistance(vr(e))/2;return Math.max(t,n)}getEnvelope2D(){return this.envAabb}getRotatedEnvelope2D(){return this.envRot}xyRot(e,t){let n=mr(e.x,e.y),r=hr(e.x,e.y);t.setCoords(n,r)}};function mr(e,t){return e-t}function hr(e,t){return e+t}function gr(e){return e.x-e.y}function _r(e){return e.x+e.y}function vr(e){return new z(gr(e),_r(e))}var J=class e{constructor(){this.x=P.getNAN(),this.y=P.getNAN()}static getNAN(){return new e}static constructPoint2D(t){let n=new e;return n.x.set(t.x),n.y.set(t.y),n}static constructCoords(t,n){let r=new e;return r.x.set(t),r.y.set(n),r}static constructCoordsE(t,n){let r=new e;return r.setCoordsE(t,n),r}get 0(){return this.x.clone()}set 0(e){this.x.setE(e)}get 1(){return this.y.clone()}set 1(e){this.y.setE(e)}clone(){return new e().setE(this)}scaleThis(e){return this.x.mulThisE(e),this.y.mulThisE(e),this}setCoords(e,t){return this.x.set(e),this.y.set(t),this}setCoordsE(e,t){return this.x.setE(e),this.y.setE(t),this}set(e){return this.x.set(e.x),this.y.set(e.y),this}setE(e){return this.x.setE(e.x),this.y.setE(e.y),this}setWithEps(e,t){return this.x.setWithEps(e.x,t),this.y.setWithEps(e.y,t),this}getUnitVector(){let e=this.clone();return e.normalize(),e}sqrLength(){return this.x.sqr().addE(this.y.sqr())}length(){return this.sqrLength().sqrt()}mulE(t){let n=new e;return n.setCoordsE(this.x.mulE(t),this.y.mulE(t)),n}mul(t){let n=new e;return n.setCoordsE(this.x.mul(t),this.y.mul(t)),n}mulThis(e){return this.x.mulThis(e),this.y.mulThis(e),this}mulThisE(e){return this.x.mulThisE(e),this.y.mulThisE(e),this}divE(e){return this.clone().divThisE(e)}divThisE(e){return this.x.divThisE(e),this.y.divThisE(e),this}normalize(){let e=this.length();e.value()===0?(this.x=pe.clone(),this.y=bt.clone()):(this.x.divThisE(e),this.y.divThisE(e))}addE(e){return this.clone().addThisE(e)}addThisE(e){return this.x.addThisE(e.x),this.y.addThisE(e.y),this}subE(e){return this.clone().subThisE(e)}subThisE(e){return this.x.subThisE(e.x),this.y.subThisE(e.y),this}static distance(e,t){return e.subE(t).length()}negateThis(){return this.x.negateThis(),this.y.negateThis(),this}eq(e){return this.x.eq(e.x)&&this.y.eq(e.y)}isZero(){return this.x.isZero()&&this.y.isZero()}isTrueZero(){return!this.x.value()&&!this.y.value()}rotateDirect(e,t){let n=this.x.mulE(e).subThisE(this.y.mulE(t)),r=this.x.mulE(t).addThisE(this.y.mulE(e));return this.x.setE(n),this.y.setE(r),this}rotateReverse(e,t){let n=this.x.mulE(e).addThisE(this.y.mulE(t)),r=this.x.negate().mulThisE(t).addThisE(this.y.mulE(e));return this.x.setE(n),this.y.setE(r),this}dotProduct(e){return this.x.mulE(e.x).addE(this.y.mulE(e.y))}crossProduct(e){return this.x.mulE(e.y).subE(this.y.mulE(e.x))}value(){return z.construct(this.x.value(),this.y.value())}},yr=class e{constructor(){this.a11=new P(1),this.a12=new P(0),this.a21=new P(0),this.a22=new P(1)}clone(){let t=new e;return t.a11.setE(this.a11),t.a12.setE(this.a12),t.a21.setE(this.a21),t.a22.setE(this.a22),t}assign(e){return this.a11.setE(e.a11),this.a12.setE(e.a12),this.a21.setE(e.a21),this.a22.setE(e.a22),this}mulThis(e){let t=this.a11.mulE(e.a11).addThisE(this.a12.mulE(e.a21)),n=this.a11.mulE(e.a12).addThisE(this.a12.mulE(e.a22)),r=this.a21.mulE(e.a11).addThisE(this.a22.mulE(e.a21)),i=this.a21.mulE(e.a12).addThisE(this.a22.mulE(e.a22));return this.a11=t,this.a12=n,this.a21=r,this.a22=i,this}mulLeftThis(e){let t=e.clone();return this.assign(t.mulThis(this)),this}det(){return this.a11.mulE(this.a22).subThisE(this.a12.mulE(this.a21))}invertThis(){let e=this.det();if(e.value()!==0){let t=this.a22.divE(e),n=this.a12.negate().divThisE(e),r=this.a21.negate().divThisE(e),i=this.a11.divE(e);this.a11=t,this.a12=n,this.a21=r,this.a22=i}else this.setZero();return!e.isZero()}transposeThis(){return this.a21=W(this.a12,this.a12=this.a21),this}eigenSymmetric(e,t){let n=this.a12.clone();n.addThisE(this.a21),n.mulThisByPower2(.5);let r=new P(1),i=new P(0);if(n.isZero())e[0].setE(this.a11),e[1].setE(this.a22);else{let t=new P(1);if(this.a11.ne(this.a22)){let a=this.a11.subE(this.a22).divE(n);a.mulThisByPower2(.5);let o=a.sqr();t.setE(a),t.absThis(),t.subThisE(o.add(1).sqrtThis()),a.gt(bt)&&t.negateThis();let s=t.sqr().addThis(1).sqrtThis().invThis();i=t.mulE(s),r.setE(s);let c=t.mulE(n);e[0]=this.a11.addE(c),e[1]=this.a22.subE(c)}else r=new P(1/Math.sqrt(2)),i=r.clone(),e[0]=this.a11.addE(n),e[1]=this.a22.subE(n)}t[0].x=r.toDouble(),t[0].y=i.toDouble(),t[1].x=i.negate().toDouble(),t[1].y=r.toDouble(),Math.abs(e[0].toDouble())>Math.abs(e[1].toDouble())&&(e[1]=W(e[0],e[0]=e[1]),t[1]=W(t[0],t[0]=t[1]))}setZero(){this.a11.set(0),this.a21.set(0),this.a12.set(0),this.a22.set(0)}},br=class e{static constructPoint2D(t){return new e(A.constructDouble(t.x),A.constructDouble(t.y))}constructor(e,t){if(e===void 0)return this.x=new A().setNAN(),void(this.y=new A().setNAN());this.x=e.clone(),this.y=t.clone()}assignPoint2D(e){return this.x.setDouble(e.x),this.y.setDouble(e.y),this}setCoords(e,t){return this.x.setThis(e),this.y.setThis(t),this}asPoint2D(){return new z(this.x.value(),this.y.value())}crossProduct(e){return this.x.mul(e.y).sub(this.y.mul(e.x))}leftPerpendicularThis(){let e=this.x.clone();this.x=this.y.clone().negate(),this.y=e}clone(){return new e(this.x,this.y)}dotProduct(e){return this.x.mul(e.x).add(this.y.mul(e.y))}add(t){return new e(this.x.add(t.x),this.y.add(t.y))}sub(t){return new e(this.x.sub(t.x),this.y.sub(t.y))}sqrLength(){return this.x.sqr().addThis(this.y.sqr())}mulThis(e){return this.x.mulThis(e),this.y.mulThis(e),this}mul(e){return this.clone().mulThis(e)}subThis(e){return this.x.subThis(e.x),this.y.subThis(e.y),this}addThis(e){return this.x.addThis(e.x),this.y.addThis(e.y),this}},xr=Rt;function Sr(e){let t=!1;for(let n=0;n<2;n++){let r=yt(e[0][n],e[3][n]);r>0?(yt(e[0][n],e[1][n])<0&&(e[1][n]=e[0][n],t=!0),yt(e[1][n],e[3][n])<0&&(e[1][n]=e[3][n],t=!0),yt(e[0][n],e[2][n])<0&&(e[2][n]=e[0][n],t=!0),yt(e[2][n],e[3][n])<0&&(e[2][n]=e[3][n],t=!0),yt(e[1][n],e[2][n])<0&&(e[2][n]=e[1][n],t=!0)):r<0?(yt(e[0][n],e[1][n])>0&&(e[1][n]=e[0][n],t=!0),yt(e[1][n],e[3][n])>0&&(e[1][n]=e[3][n],t=!0),yt(e[0][n],e[2][n])>0&&(e[2][n]=e[0][n],t=!0),yt(e[2][n],e[3][n])>0&&(e[2][n]=e[3][n],t=!0),yt(e[1][n],e[2][n])>0&&(e[2][n]=e[1][n],t=!0)):e[1][n]===e[0][n]&&e[2][n]===e[0][n]||(e[1][n]=e[0][n],e[2][n]=e[0][n],t=!0)}return t}function Cr(e){let t=yt(e[0].y,e[1].y),n=yt(e[1].y,e[2].y),r=yt(e[2].y,e[3].y);if(t>=0&&n>=0&&r>=0||t<=0&&n<=0&&r<=0){let t=yt(e[0].x,e[1].x),n=yt(e[1].x,e[2].x),r=yt(e[2].x,e[3].x);if(t>=0&&n>=0&&r>=0||t<=0&&n<=0&&r<=0)return!0}return!1}function wr(e,t){let n=e.getStartXY();if(n.equals(t.getStartXY())||n.equals(t.getEndXY()))return!0;let r=e.getEndXY();return!!r.equals(t.getStartXY())||!!r.equals(t.getEndXY())}function Tr(e,t){let n=e.calculateLowerLength2D();return!(n>t)&&(!!e.isLine()||(n=e.calculateUpperLength2D(),n<=t||t!==0&&e.calculateLength2D()<=t))}function Er(e,t,n){let r=C(z,4),i=e.queryControlPointsHelper(r),a=C(z,4),o=t.queryControlPointsHelper(a);r[0].equals(a[0])||Ue(``);let s=e.getGeometryType();if(s===t.getGeometryType()&&r.map((e,t)=>a[t].equals(e)).reduce((e,t)=>e&&t)){if(s!==L.enumRationalBezier2)return 0;{let n=t,r=[0,0,0],i=[0,0,0];if(e.queryWeights(r),n.queryWeights(i),r.map((e,t)=>i[t]===e).reduce((e,t)=>e&&t))return 0}}for(;i>2&&r[1].equals(r[0]);)r.splice(1,1),i--;for(;o>2&&a[1].equals(a[0]);)a.splice(1,1),o--;(r[1].equals(r[0])||a[1].equals(r[0]))&&Ue(``);let c=z.compareVectorsOrigin(r[0],r[1],a[1]);if(c===0){let n=br.constructPoint2D(r[0]),i=new br;e.queryCoord2DMP(1e-16,i),i.sub(n);let a=new br;return t.queryCoord2DMP(1e-16,a),a.sub(n),a.crossProduct(i).sign()}return c}function Dr(e,t,n,r,i,a,o,s){let l=e.calculateUpperLength2D(),u=t.calculateUpperLength2D(),d=e,f=t,p=!1;l>u&&(f=W(d,d=f),r=W(n,n=r),u=W(l,l=u),p=!0);let m=n===0;{o[0]=m?1:0;let e=d.getCoord2D(o[0]);s[0]=f.getClosestCoordinate(e,!1);let t=f.getCoord2D(s[0]);if(z.distance(e,t)<=i){let t=[.5,.75,.25,.1,.9],n=!0;for(let r=0;r<t.length;r++)if(e.assign(d.getCoord2D(t[r])),!f.isCloserThanDistance(e,new I(0,1),i)){n=!1;break}if(n)return p&&(s[0]=W(o[0],o[0]=s[0])),1}}if(l<=3*i)return 0;let h=_e(Math.max(i/l,.1),0,.5),g=.01*i,_=0,v=0,y=h,b=-1,x=0,S=1/32;for(let e=0;;e++){U(e<4095);let t=m?h:1-h,n=d.getCoord2D(t),l=f.getClosestCoordinate(n,!1);if(l===r)return x;let u=f.getCoord2D(l),C=z.distance(n,u);if(e===0&&(b=C),C<=g?(S=.5,v=C,_=h):(y=h,b=C),Math.abs(v-b)>.1*g&&y-_>1e-16)h=c(_,y,S);else{if(o[x]=t,s[x]=l,p&&(s[x]=W(o[x],o[x]=s[x])),a===1||x===1)return x===1&&o[0]>o[1]&&(o[1]=W(o[0],o[0]=o[1]),s[1]=W(s[0],s[0]=s[1])),x+1;x++,_=y,v=b,y=.8,b=-1,h=.8,S=1/32,g=10*i,e=0}}}function Or(e,t,n,r,i,a,o,s,c){if(re(n,0,1)&&re(r,0,1)&&z.distance(e.getCoord2D(n),t.getCoord2D(r))===0){let c=1e-12,l=new J,u=fe();if(e.queryDerivative(new P(n,u),l),l.isTrueZero()){let t=n===1?-1e-12:c;e.queryDerivative(new P(n,u).add(t),l)}n===1&&l.negateThis();let d=new J;if(t.queryDerivative(new P(r,u),d),d.isTrueZero()){let e=n===1?-1e-12:c;t.queryDerivative(new P(r,u).add(e),d)}r===1&&d.negateThis(),l.isZero()||l.normalize(),d.isZero()||d.normalize();let f=l.dotProduct(d),p=l.crossProduct(d);if(p.scaleError(3),f.ge(bt)&&(p.isZero()||Math.abs(p.value())<(()=>{{let n=e.calculateUpperLength2D(),r=t.calculateUpperLength2D();return Math.min(.01*i/Math.min(n,r),1e-10)}})()))return Dr(e,t,n,r,i,a,o,s)}return 0}function kr(e,t,n){return U(e.isCurve()||t.isCurve()),!!(e.getStartXY().equals(t.getStartXY())&&Or(e,t,0,0,n,2,[0,0],[0,0])||e.getEndXY().equals(t.getEndXY())&&Or(e,t,1,1,n,2,[0,0],[0,0])||e.getStartXY().equals(t.getEndXY())&&Or(e,t,0,1,n,2,[0,0],[0,0])||e.getEndXY().equals(t.getStartXY())&&Or(e,t,1,0,n,2,[0,0],[0,0]))}function Ar(e,t){e.m_XStart=t.x,e.m_YStart=t.y}function jr(e,t,n){e.m_XStart=t,e.m_YStart=n}function Mr(e,t){e.m_XEnd=t.x,e.m_YEnd=t.y}function Nr(e,t,n){e.m_XEnd=t,e.m_YEnd=n}function Pr(e,t,n){t?e.m_XEnd===n.x&&e.m_YEnd===n.y||(e.m_XEnd=n.x,e.m_YEnd=n.y,e.endPointModified()):e.m_XStart===n.x&&e.m_YStart===n.y||(e.m_XStart=n.x,e.m_YStart=n.y,e.endPointModified())}function Fr(e,t){let n=new K;return t?(n.x=e.m_XEnd,n.y=e.m_YEnd):(n.x=e.m_XStart,n.y=e.m_YStart),n.z=Ir(e,t),n}function Ir(e,t){return e.m_description.hasZ()?e.m_attributes[t*(e.m_description.getTotalComponentCount()-2)]:xr.getDefaultValue(1)}function Lr(e,t,n){e.m_description.hasZ()||e.addAttribute(1),t?e.m_XEnd===n.x&&e.m_YEnd===n.y||(e.m_XEnd=n.x,e.m_YEnd=n.y,e.endPointModified()):e.m_XStart===n.x&&e.m_YStart===n.y||(e.m_XStart=n.x,e.m_YStart=n.y,e.endPointModified()),e.m_attributes[(e.m_description.getTotalComponentCount()-2)*t]=n.z}function Rr(e,t,n){n.assignVertexDescription(e.m_description);let r=t===0?e.m_XStart:e.m_XEnd,i=t===0?e.m_YStart:e.m_YEnd;n.setXYCoords(r,i);for(let r=1;r<e.m_description.getAttributeCount();r++){let i=e.m_description.getSemantics(r);for(let r=0,a=xr.getComponentCount(i);r<a;r++){let a=Br(e,t,i,r);n.setAttributeBasic(i,r,a)}}}function zr(e,t,n){n.isEmpty()&&se(``),Pr(e,t,n.getXY());let r=n.getDescription();r!==e.m_description&&e.mergeVertexDescription(r);for(let i=1,a=r.getAttributeCount();i<a;i++){let a=r.getSemantics(i),o=xr.getComponentCount(a);for(let r=0;r<o;r++)Vr(e,t,a,r,n.getAttributeAsDbl(a,r))}}function Br(e,t,n,r){if((t<0||t>1)&&E(``),n===0)return(r<0||r>=2)&&E(``),t===0?r===0?e.m_XStart:e.m_YStart:r===0?e.m_XEnd:e.m_YEnd;let i=xr.getComponentCount(n);(r<0||r>=i)&&E(``);let a=e.m_description.getAttributeIndex(n);return a>=0?e.m_attributes[t*(e.m_description.getTotalComponentCount()-2)+e.m_description.getPointAttributeOffset(a)-2+r]:xr.getDefaultValue(n)}function Vr(e,t,n,r,i){if((t<0||t>1)&&E(``),n===0)return t===0?r===0?e.m_XStart=i:r===1?e.m_YStart=i:E(``):t===1?r===0?e.m_XEnd=i:r===1?e.m_YEnd=i:E(``):E(``),void e.endPointModified();let a=xr.getComponentCount(n);(r<0||r>=a)&&E(``);let o=e.m_description.getAttributeIndex(n);o<0&&(e.addAttribute(n),o=e.m_description.getAttributeIndex(n)),e.m_attributes[t*(e.m_description.getTotalComponentCount()-2)+e.m_description.getPointAttributeOffset(o)-2+r]=i}function Hr(e,t){if(e===t)return;t.isEmpty()&&se(``);let n=t.getDescription();n!==e.m_description&&e.mergeVertexDescription(n);for(let r=1,i=n.getAttributeCount();r<i;r++){let i=n.getSemantics(r),a=xr.getComponentCount(i);for(let n=0;n<a;n++){let r=Br(t,0,i,n);Vr(e,0,i,n,r),r=Br(t,1,i,n),Vr(e,1,i,n,r)}}}function Ur(e,t){let n=Bt();Jt(t,e.m_description,n);let r=null,i=t.getTotalComponentCount()-2,a=e.m_description?e.m_description.getTotalComponentCount()-2:0;if(i>0&&(r=H(2*i,NaN),Qe(r,t.getDefaultPointAttributes(),0,2,i),Qe(r,t.getDefaultPointAttributes(),i,2,i),e.m_description!==null))for(let o=1;o<t.getAttributeCount();o++){let s=n[o];if(s!==-1){let n=e.m_description.getPointAttributeOffset(s)-2,c=t.getPointAttributeOffset(o)-2,l=xr.getComponentCount(t.getSemantics(o));for(let t=0;t<l;++t)r[c]=e.m_attributes[n],r[i+c]=e.m_attributes[a+n]}}e.m_attributes=r,e.m_description=t}function Wr(e){return e.absNorm()*j()}function Gr(e,t){return Math.max(e.absNorm(),t.absNorm())*j()}function Kr(e,t,n){let r=new pr;e.queryEnvelopeW(I.unit(),r);let i=new pr;return t.queryEnvelopeW(I.unit(),i),i.inflate(n),!r.isIntersectingW(i)}function qr(e,t,n){let r=x(e,n),i=x(t,n);r.sort((e,t)=>e.compare(t)),i.sort((e,t)=>e.compare(t));for(let e=0;e<3;e++){if(r[e].compare(i[e])<0)return-1;if(r[e].compare(i[e])!==0)return 1}return 0}var Jr=Rt,Yr=class{constructor(e){if(e.copy)this.m_XStart=e.copy.m_XStart,this.m_YStart=e.copy.m_YStart,this.m_XEnd=e.copy.m_XEnd,this.m_YEnd=e.copy.m_YEnd,this.m_description=e.copy.m_description,this.m_attributes=null,this.m_description&&this.m_description.getTotalComponentCount()-2&&(this.m_attributes=e.copy.m_attributes.slice());else{if(e.move)return this.m_description=e.move.m_description,e.move.m_description=null,this.m_attributes=e.move.m_attributes,e.move.m_attributes=null,this.m_XStart=e.move.m_XStart,this.m_YStart=e.move.m_YStart,this.m_XEnd=e.move.m_XEnd,void(this.m_YEnd=e.move.m_YEnd);if(e.XStart!==void 0)return this.m_XStart=e.XStart,this.m_YStart=e.YStart,this.m_XEnd=e.XEnd,this.m_YEnd=e.YEnd,this.m_attributes=null,this.m_description=e.vd?e.vd:Kt(),void(e.vd&&this.setDefaultAttributeValues());if(e.ZStart!==void 0)return this.m_XStart=e.XStart,this.m_YStart=e.YStart,this.m_XEnd=e.XEnd,this.m_YEnd=e.YEnd,this.m_description=e.vd?e.vd:qt(),void(e.vd?(this.setDefaultAttributeValues(),this.addAttribute(1),this.m_attributes[0]=e.ZStart,this.m_attributes[this.m_description.getTotalComponentCount()-2]=e.ZEnd):this.m_attributes=[e.ZStart,e.ZEnd]);if(e.start)return this.m_XStart=e.start.x,this.m_YStart=e.start.y,this.m_XEnd=e.end.x,this.m_YEnd=e.end.y,this.m_attributes=null,void(this.m_description=Kt());if(e.start3D)return this.m_XStart=e.start3D.x,this.m_YStart=e.start3D.y,this.m_XEnd=e.end3D.x,this.m_YEnd=e.end3D.y,this.m_description=e.vd?e.vd:qt(),void(e.vd?(this.setDefaultAttributeValues(),this.addAttribute(1),this.m_attributes[0]=e.start3D.z,this.m_attributes[this.m_description.getTotalComponentCount()-2]=e.end3D.z):this.m_attributes=[e.start3D.z,e.end3D.z]);B(`bad constructor params`),this.m_XStart=this.m_YStart=this.m_XEnd=this.m_YEnd=NaN}}setDefaultAttributeValues(){let e=this.m_description.getTotalComponentCount()-2;e>0&&(this.m_attributes===null&&(this.m_attributes=H(2*e,NaN)),Qe(this.m_attributes,this.m_description.getDefaultPointAttributes(),0,2,e),Qe(this.m_attributes,this.m_description.getDefaultPointAttributes(),e,2,e))}absNormXYZ(e){return xt(`not implemented`),0}queryWeights(e){}snapControlPoints3D(){return xt(`not implemented`),!1}setCoordsForIntersector3D(e,t,n){xt(`not implemented`)}transformAttribute(e,t,n,r,i){xt(``)}mergeVertexDescriptionImpl(e){let t=this.getDescription(),n=Ut(t,e);this.assignVertexDescription(n)}changeEndPoints(e,t){let n=e.getXY(),r=t.getXY();this.changeEndPoints2D(n,r);let i=e.getDescription();i!==this.getDescription()&&this.mergeVertexDescription(i),i=t.getDescription(),i!==this.getDescription()&&this.mergeVertexDescription(i);for(let n=1,r=i.getAttributeCount();n<r;n++){let r=i.getSemantics(n),a=Jr.getComponentCount(r);for(let n=0;n<a;n++)Vr(this,0,r,n,e.getAttributeAsDbl(r,n)),Vr(this,1,r,n,t.getAttributeAsDbl(r,n))}}getStartXY(){return new z(this.m_XStart,this.m_YStart)}setStartXY(e){this.m_XStart=e.x,this.m_YStart=e.y,this.endPointModified()}setStartXYCoords(e,t){this.m_XStart=e,this.m_YStart=t,this.endPointModified()}getStartXYZ(){return Fr(this,0)}setStartXYZ(e){Lr(this,0,e)}setStartXYZCoords(e,t,n){Lr(this,0,K.construct(e,t,n))}queryStart(e){Rr(this,0,e)}setStart(e){zr(this,0,e)}setStart2D(e){this.setStartXY(e)}getStartAttributeAsDbl(e,t){return Br(this,0,e,t)}getStartAttributeAsInt(e,t){return U(0),0}setStartAttribute(e,t,n){Vr(this,0,e,t,n)}setStartAttributesFromPoint(e,t){let n=e.getDescription();for(let r=t&&n.hasZ()?2:1,i=n.getAttributeCount();r<i;++r){let t=n.getSemantics(r),i=Jr.getComponentCount(t);for(let n=0;n<i;++n){let r=e.getAttributeAsDbl(t,n);this.setStartAttribute(t,n,r)}}}setEndAttributesFromPoint(e,t){let n=e.getDescription();for(let r=t&&n.hasZ()?2:1,i=n.getAttributeCount();r<i;++r){let t=n.getSemantics(r),i=Jr.getComponentCount(t);for(let n=0;n<i;++n){let r=e.getAttributeAsDbl(t,n);this.setEndAttribute(t,n,r)}}}getStartX(){return this.m_XStart}getStartY(){return this.m_YStart}getStartZ(){return U(0),0}getEndX(){return this.m_XEnd}getEndY(){return this.m_YEnd}getEndZ(){return U(0),0}getEndXY(){return new z(this.m_XEnd,this.m_YEnd)}setEndXY(e){this.m_XEnd=e.x,this.m_YEnd=e.y,this.endPointModified()}setEndXYCoords(e,t){this.m_XEnd=e,this.m_YEnd=t,this.endPointModified()}getEndXYZ(){return Fr(this,1)}setEndXYZ(e){Lr(this,1,e)}setEndXYZCoords(e,t,n){Lr(this,1,K.construct(e,t,n))}queryEnd(e){Rr(this,1,e)}setEnd(e){zr(this,1,e)}setEnd2D(e){this.setEndXY(e)}getEndAttributeAsDbl(e,t){return Br(this,1,e,t)}getEndAttributeAsInt(e,t){return U(0),0}setEndAttribute(e,t,n){Vr(this,1,e,t,n)}getDimension(){return 1}copyTo(e){if(this===e)return;e.getGeometryType()!==this.getGeometryType()&&R(``);let t=e;t.assignVertexDescription(this.m_description),t.m_attributes&&Qe(t.m_attributes,this.m_attributes,0,0,2*(this.m_description.getTotalComponentCount()-2)),t.m_XStart=this.m_XStart,t.m_YStart=this.m_YStart,t.m_XEnd=this.m_XEnd,t.m_YEnd=this.m_YEnd,this.copyToImpl(t)}isEmpty(){return this.isEmptyImpl()}isClosed(){return this.m_XStart===this.m_XEnd&&this.m_YStart===this.m_YEnd}setEmpty(){}calculateArea2D(){return 0}queryInterval(e,t){let n=I.constructEmpty();return n.vmin=Br(this,0,e,t),n.vmax=n.vmin,n.mergeNeCoordinate(Br(this,1,e,t)),n}calculateLength3D(e){return U(0),0}getCoord3D(e){return U(0),{}}getCoord2D(e){let t=z.getNAN();return this.queryCoord2D(e,t),t}queryCoord3D(e,t){U(0)}getCoordZ(e){return U(0),0}queryCoord(e,t){t.assignVertexDescription(this.m_description),t.setXY(this.getCoord2D(e));for(let n=1,r=this.m_description.getAttributeCount();n<r;n++){let r=this.m_description.getSemantics(n),i=Jr.getComponentCount(r);for(let n=0;n<i;n++){let i=this.getAttributeAsDbl(e,r,n);t.setAttributeBasic(r,n,i)}}}isCloserThanDistance(e,t,n){let r=G.constructEmpty();if(this.queryLooseEnvelopeOnInterval(t,r),r.distance(e)>n)return!1;let i=this.getClosestCoordinateOnInterval(e,t,n);return!Number.isNaN(i)&&z.distance(e,this.getCoord2D(i))<=n}isMonotoneQuickAndDirty(){return!1}isTrue3D(){return!1}getReversed(){let e=this.clone();return e.reverse(),e}reverse(){this.m_XEnd=W(this.m_XStart,this.m_XStart=this.m_XEnd),this.m_YEnd=W(this.m_YStart,this.m_YStart=this.m_YEnd),this.reverseImpl();for(let e=1,t=this.m_description.getAttributeCount();e<t;e++){let t=this.m_description.getSemantics(e);for(let e=0,n=Jr.getComponentCount(t);e<n;e++){let n=Br(this,0,t,e);Vr(this,0,t,e,Br(this,1,t,e)),Vr(this,1,t,e,n)}}return this.afterCompletedModification(),this}isEmptyImpl(){return!1}isCircular(){return!1}distance(e,t,n,r){if(!t&&this.isIntersecting(e,0,!1)){if(n!==null||r!==null){let t=H(9,NaN),i=H(9,NaN),a=this.intersect(e,null,t,i,0);U(a<=9),a===0&&B(``),n!==null&&(n[0]=t[0]),r!==null&&(r[0]=i[0])}return 0}let i,a=Number.MAX_VALUE,o=-1,s=a;return i=this.getStartXY(),o=e.getClosestCoordinate(i,!1),i.subThis(e.getCoord2D(o)),s=i.length(),s<a&&(a=s,r!==null&&(r[0]=o),n!==null&&(n[0]=0)),i=this.getEndXY(),o=e.getClosestCoordinate(i,!1),i.subThis(e.getCoord2D(o)),s=i.length(),s<a&&(a=s,r!==null&&(r[0]=o),n!==null&&(n[0]=1)),i=e.getStartXY(),o=this.getClosestCoordinate(i,!1),i.subThis(this.getCoord2D(o)),s=i.length(),s<a&&(a=s,n!==null&&(n[0]=o),r!==null&&(r[0]=0)),i=e.getEndXY(),o=this.getClosestCoordinate(i,!1),i.subThis(this.getCoord2D(o)),s=i.length(),s<a&&(a=s,n!==null&&(n[0]=o),r!==null&&(r[0]=1)),a}calculateSubLengthFromStart(e){return this.tToLength(e)}calculateSubLength(e,t){return t===e?0:this.tToLength(t)-this.tToLength(e)}static recalculateParentT(e,t,n){return c(e,t,n)}moveTo(e){let t=this.isClosed(),n=new At;n.setShift(e.sub(this.getStartXY())),this.applyTransformation(n),t?this.changeEndPoints2D(e,e):this.changeEndPoints2D(e,this.getEndXY())}moveTo3D(e){U(0)}getDescription(){return this.m_description}assignVertexDescription(e){Ur(this,e)}mergeVertexDescription(e){this.m_description!==e&&(this.m_description.hasAttributesFrom(e)||this.mergeVertexDescriptionImpl(e))}hasAttribute(e){return this.m_description.hasAttribute(e)}addAttribute(e){if(this.m_description.hasAttribute(e))return;let t=Wt(this.m_description,e);this.assignVertexDescription(t)}dropAttribute(e){if(!this.m_description.hasAttribute(e))return;let t=Gt(this.m_description,e);this.assignVertexDescription(t)}dropAllAttributes(){let e=Kt();e!==this.m_description&&this.assignVertexDescription(e)}swap(e){if(this===e)return;e.getGeometryType()!==this.getGeometryType()&&R(`wrong geometry type`);let t=e;t.m_description=W(this.m_description,this.m_description=t.m_description),t.m_XStart=W(this.m_XStart,this.m_XStart=t.m_XStart),t.m_YStart=W(this.m_YStart,this.m_YStart=t.m_YStart),t.m_XEnd=W(this.m_XEnd,this.m_XEnd=t.m_XEnd),t.m_YEnd=W(this.m_YEnd,this.m_YEnd=t.m_YEnd),t.m_attributes=W(this.m_attributes,this.m_attributes=t.m_attributes),this.swapImpl(t)}equals(e,t){if(this.getGeometryType()!==e.getGeometryType())return!1;let n=t===void 0;n&&(t=0);let r=e;if(this===r)return!0;if(this.m_description!==r.m_description||Math.abs(this.m_XStart-r.m_XStart)>t||Math.abs(this.m_XEnd-r.m_XEnd)>t||Math.abs(this.m_YStart-r.m_YStart)>t||Math.abs(this.m_YEnd-r.m_YEnd)>t)return!1;for(let e=0,n=2*(this.m_description.getTotalComponentCount()-2);e<n;e++)if(!et(this.m_attributes[e],r.m_attributes[e],t))return!1;return n?this.equalsImpl(r):this.equalsImplTol(r,t)}getImpl(){return this}setAttributeBasic(e,t,n){if(this.addAttribute(e),e===0&&this.isCurve()){(t<0||t>1)&&R(``);let e=new At,r=t===0?n:0,i=t===1?n:0;e.setShiftCoords(r,i),t===0?e.xx=0:e.yy=0,this.applyTransformation(e)}else this.setStartAttribute(e,t,n),this.setEndAttribute(e,t,n)}replaceNaNs(e,t){if(this.addAttribute(e),this.isEmpty())return;let n=Jr.getComponentCount(e);for(let r=0;r<n;r++){let n=this.getStartAttributeAsDbl(e,r);Number.isNaN(n)&&this.setStartAttribute(e,r,t);let i=this.getEndAttributeAsDbl(e,r);Number.isNaN(i)&&this.setEndAttribute(e,r,t)}}};Yr.s_maxMonotonicPartParams=8;var Xr=class{constructor(){this.posStream=null,this.streams=null}get(e){return e>0?this.streams[e-1]:this.posStream}set(e,t){e>0?this.streams[e-1]=t:this.posStream=t}destroyAndSetSize(e){if(this.streams=null,e>1){this.streams=Array(e-1);for(let t=0;t<e-1;++t)this.streams[t]=null}this.posStream=null}swap(e){[this.streams,e.streams]=[e.streams,this.streams],[this.posStream,e.posStream]=[e.posStream,this.posStream]}empty(){return this.posStream===null&&this.streams===null}};function Zr(e,t,n,r,i){(t<0||n<0||r<1||t+r*(n-1)+1>e.size())&&R(`Index out of bound`);for(let a=t,o=t+r*(n-1)+1;a<o;a+=r)e.writeAsDbl(a,i(e.readAsDbl(a)))}function Qr(e,t,n){if(e)for(let e=t.length-1;e>=0;--e)n(t[e]);else t.forEach(n)}function $r(e,t){let n=D(e),r=t.length/Ve();for(let e=0;e<t.length;++e){let e=Math.trunc(n*r);n=D(n);let i=Math.trunc(n*r),a=t[e];t[e]=t[i],t[i]=a}}function ei(e,t,n){let r=e.getDescription().getTotalComponentCount();e.setX(t[0]),e.setY(t[1]),Qe(e.getAttributeArray(),t,0,2,r-2)}var ti=Rt,ni=`can not assign an empty point to a vertex`,ri=class{constructor(e){this.m_accelerators=null,e!==void 0&&e.move?(this.m_description=e.move.m_description,e.move.m_description=Kt(),this.m_vertexAttributes=e.move.m_vertexAttributes,e.move.m_vertexAttributes=new Xr,this.m_envelopeData=e.move.m_envelopeData,e.move.m_envelopeData=new cr,this.m_pointCount=e.move.m_pointCount,this.m_reservedPointCount=e.move.m_reservedPointCount,this.m_flags=e.move.m_flags,this.m_bFillRule=e.move.m_bFillRule,this.m_bPathStarted=e.move.m_bPathStarted,this.m_bPolygon=e.move.m_bPolygon,this.m_simpleTolerance=e.move.m_simpleTolerance):(this.m_description=e!==void 0&&e.vd?e.vd:Kt(),this.m_vertexAttributes=new Xr,this.m_envelopeData=new cr,this.m_pointCount=0,this.m_reservedPointCount=-1,this.m_flags=4063,this.m_bFillRule=this.m_bPathStarted=this.m_bPolygon=!1,this.m_simpleTolerance=0,e!==void 0&&e.copy&&e.copy.copyTo(this))}equalsBase(e,t){if(!d(e.getGeometryType()))return!1;let n=e;if(this===n)return!0;if(!this.m_description.equals(n.getDescription())||this.isEmptyImpl()!==n.isEmptyImpl())return!1;if(this.isEmptyImpl())return!0;let r=this.getPointCount();if(r!==n.getPointCount())return!1;for(let e=0;e<this.m_description.getAttributeCount();e++){let i=this.m_description.getSemantics(e),a=this.getAttributeStreamRef(i),o=n.getAttributeStreamRef(i),s=ti.getComponentCount(i);if(!a.equals(o,0,r*s,t))return!1}if(t){if(!this.equalsImplTol(e,t))return!1}else if(!this.equalsImpl(e))return!1;return!0}transformAttribute(e,t,n,r,i){if(this.addAttribute(e),!this.isEmpty()&&(n!==0||r!==1)){if(e===0){let e=new At;i===0?t===0?(e.setShiftCoords(n,0),e.scale(r,1)):t===1?(e.setShiftCoords(0,n),e.scale(1,r)):R(``):t===0?(e.setScaleCoords(1/r,1),e.shiftCoords(-n,0)):t===1?(e.setScaleCoords(1,1/r),e.shiftCoords(0,-n)):R(``),this.applyTransformation(e);return}Zr(this.getAttributeStreamRef(e),t,this.getPointCount(),ti.getComponentCount(e),On(n,r,i)),this.notifyModified()}}getDescription(){return this.m_description}assignVertexDescription(e){this.m_description!==e&&this.assignVertexDescriptionImpl(e)}mergeVertexDescriptionImpl(e){let t=this.getDescription(),n=Ut(t,e);this.assignVertexDescription(n)}mergeVertexDescription(e){this.m_description!==e&&(this.m_description.hasAttributesFrom(e)||this.mergeVertexDescriptionImpl(e))}hasAttribute(e){return this.m_description.hasAttribute(e)}addAttribute(e){if(this.m_description.hasAttribute(e))return;let t=Wt(this.m_description,e);this.assignVertexDescription(t)}dropAttribute(e){if(!this.m_description.hasAttribute(e))return;let t=Gt(this.m_description,e);this.assignVertexDescription(t)}dropAllAttributes(){let e=Kt();e!==this.m_description&&this.assignVertexDescription(e)}getAttributeStreamRef(e){this.throwIfEmpty(),this.m_description.hasAttribute(e)||R(`AttributeStream : Geometry does not have the attribute`);let t=this.m_description.getAttributeIndex(e);return this.m_vertexAttributes.get(t)}setAttributeStreamRef(e,t){t||R(`stream`),t&&ti.getPersistence(e)!==t.getPersistence()&&R(``),this.addAttribute(e);let n=this.m_description.getAttributeIndex(e);this.m_vertexAttributes.empty()&&this.m_vertexAttributes.destroyAndSetSize(this.m_description.getAttributeCount()),this.m_vertexAttributes.set(n,t),this.notifyModifiedFlags(2001)}notifyModifiedFlags(e){e===65535&&(this.m_reservedPointCount=-1,this.notifyModifiedAllImpl()),this.setDirtyFlagProtected(e,!0),this.clearAccelerators(),32&e&&this.verifyAllStreamsAfterSizeChange()}notifyModified(){this.notifyModifiedFlags(2001)}getPointCount(){return this.m_pointCount}getPointByVal(e,t){let n=t;n.assignVertexDescription(this.m_description);for(let t=0;t<this.m_description.getAttributeCount();t++){let r=this.m_description.getSemantics(t);for(let i=0,a=ti.getComponentCount(r);i<a;i++){let o=this.m_vertexAttributes.get(t).readAsDbl(a*e+i);n.setAttributeBasic(r,i,o)}}}setPointByValNoCurves(e,t){let n=t;n.isEmpty()&&R(ni);let r=n.getDescription();r!==this.m_description&&this.mergeVertexDescription(r);let i=this.m_vertexAttributes.get(0);i.write(2*e,n.getX()),i.write(2*e+1,n.getY());for(let t=1,r=this.m_description.getAttributeCount();t<r;t++){let r=this.m_description.getSemantics(t),i=ti.getComponentCount(r);for(let a=0;a<i;a++){let o=n.getAttributeAsDbl(r,a);this.m_vertexAttributes.get(t).writeAsDbl(e*i+a,o)}}this.notifyModifiedFlags(2001)}setPointByValFromArrayNoCurves(e,t,n,r){U(0)}getPointByValAsArray(e,t,n,r){U(0)}isEmpty(){return this.isEmptyImpl()}isEmptyImpl(){return this.m_pointCount===0}getAttributeAsDbl(e,t,n){let r=ti.getComponentCount(e);n>=r&&E(``);let i=this.m_description.getAttributeIndex(e);return i>=0?this.m_vertexAttributes.get(i).readAsDbl(t*r+n):ti.getDefaultValue(e)}queryAttributeAsDbl(e,t,n,r){let i=ti.getComponentCount(e);r<i&&E(``);let a=this.m_description.getAttributeIndex(e);if(a>=0){let e=t*i,r=this.m_vertexAttributes.get(a);for(let t=0;t<i;t++)n[t]=r.readAsDbl(e+t)}else{let t=ti.getDefaultValue(e);for(let e=0;e<i;e++)n[e]=t}}getAttributeAsInt(e,t,n){return Math.trunc(this.getAttributeAsDbl(e,t,n))}queryAttributeAsInt(e,t,n,r){U(0)}setAttributeNoCurves(e,t,n,r){let i=ti.getComponentCount(e);n>=i&&E(``),this.addAttribute(e);let a=this.m_description.getAttributeIndex(e);this.notifyModifiedFlags(2001),this.m_vertexAttributes.get(a).writeAsDbl(t*i+n,r)}setAttributeFromArrayNoCurves(e,t,n,r){(t<0||t>=this.m_pointCount)&&E(``);let i=ti.getComponentCount(e);r<i&&E(``),this.addAttribute(e);let a=this.m_description.getAttributeIndex(e);this.notifyModifiedFlags(2001);let o=this.m_vertexAttributes.get(a);for(let e=0;e<i;++e)o.writeAsDbl(t*i+e,n[e])}getXY(e){return this.m_vertexAttributes.get(0).readPoint2D(2*e)}queryXY(e,t){return this.m_vertexAttributes.get(0).queryPoint2D(2*e,t)}setXYNoCurves(e,t){this.m_vertexAttributes.get(0).writePoint2D(2*e,t),this.notifyModifiedFlags(2001)}setXYCoordsNoCurves(e,t,n){let r=this.m_vertexAttributes.get(0);r.write(2*e,t),r.write(2*e+1,n),this.notifyModifiedFlags(2001)}getXYZ(e){let t=this.m_vertexAttributes.get(0),n=K.getNAN();return n.x=t.read(2*e),n.y=t.read(2*e+1),this.m_description.hasAttribute(1)?n.z=this.m_vertexAttributes.get(1).read(e):n.z=ti.getDefaultValue(1),n}setXYZNoCurves(e,t){this.addAttribute(1),this.notifyModifiedFlags(2001);let n=this.m_vertexAttributes.get(0);n.write(2*e,t.x),n.write(2*e+1,t.y),this.m_vertexAttributes.get(1).write(e,t.z)}queryEnvelope(e){e instanceof G||e instanceof Yt?this.updateEnvelope(e):(this.updateAllDirtyIntervals(!0),this.m_envelopeData.copyTo(this.m_description,e))}queryLooseEnvelope(e){this.updateLooseEnvelope(e)}queryInterval(e,t){let n=I.constructEmpty();return this.isEmptyImpl()||(this.updateAllDirtyIntervals(!0),this.m_envelopeData.queryInterval(this.m_description,e,t,n)),n}setAttributeBasic(e,t,n){this.setAttributeImpl(e,t,n)}setAttributeImpl(e,t,n){if(this.addAttribute(e),this.isEmpty())return;let r=!1,i=ti.getComponentCount(e),a=this.getAttributeStreamRef(e),o=Number.isNaN(n);if(a.getPersistence()===1){let e=a;for(let a=t,s=this.m_pointCount*i;a<s;a+=i){let t=e.read(a);(o||t===n)&&Number.isNaN(t)||(e.write(a,n),r=!0)}}else for(let e=t,o=this.m_pointCount*i;e<o;e+=i)a.readAsDbl(e)!==n&&(a.writeAsDbl(e,n),r=!0);r&&this.notifyModifiedFlags(2001)}replaceNaNs(e,t){if(this.addAttribute(e),this.isEmpty())return;let n=!1,r=ti.getComponentCount(e),i=this.getAttributeStreamRef(e);for(let e=0;e<r;e++)if(i.getPersistence()===1){let e=i;for(let i=0,a=this.m_pointCount*r;i<a;i++){let r=e.read(i);Number.isNaN(r)&&(e.write(i,t),n=!0)}}else for(let e=0,a=this.m_pointCount*r;e<a;e++){let r=i.readAsDbl(e);Number.isNaN(r)&&(i.writeAsDbl(e,t),n=!0)}n&&this.notifyModifiedFlags(2001)}calculateLength3D(e){return U(0),0}setEnvelopeForImport(e){this.m_description.equals(e.getDescription())||R(``),this.m_envelopeData=new cr({moveEnv:e}),this.setDirtyFlagProtected(192,!1)}copyTo(e){e.getGeometryType()!==this.getGeometryType()&&R(``),this!==e&&this.copyToUnchecked(e,!1)}queryCoordinates(e,t,n,r){let i=r<0?this.m_pointCount:r;if(i=Math.min(i,n+t),(n<0||i<n||this.m_pointCount>0&&n>=this.m_pointCount)&&R(``),this.m_pointCount===0)return i;let a=this.getAttributeStreamRef(0);for(let t=2*n,r=2*i,o=0;t<r;t+=2,o++)a.queryPoint2D(t,e[o]);return i}queryCoordinates3D(e,t,n,r){let i=r<0?this.m_pointCount:r;if(i=Math.min(i,n+t),(n<0||i<n||this.m_pointCount>0&&n>=this.m_pointCount)&&R(``),this.m_pointCount===0)return i;let a=this.getAttributeStreamRef(0),o=null,s=ti.getDefaultValue(1),c=this.m_description.hasAttribute(1);c&&(o=this.getAttributeStreamRef(1));let l=0;for(let t=n;t<i;t++,l++)e[l].x=a.read(2*t),e[l].y=a.read(2*t+1),e[l].z=c?o.read(t):s;return i}clearAndSetDirtyFlagProtected(e,t){let n=0,r=e&~t,i=t|r;n=this.m_flags,(n&i)!==t&&(this.m_flags=n&~r|t)}getIsSimple(e,t){t[0]=0;let n=-1,r=this.m_flags,i=this.m_simpleTolerance;return 1&r||(n=(14&r)>>1,t[0]=i,i<e&&(n=-1)),n}setIsSimple(e,t,n=!1){if(e===2?U(this.getGeometryType()===L.enumPolyline):e===1?U(this.getGeometryType()===L.enumMultiPoint||this.getGeometryType()===L.enumPolyline):e===3&&U(this.getGeometryType()===L.enumPolygon),e===-1)this.setDirtyFlagProtected(17,!0);else{let r=e<<1;n||(r|=16),this.clearAndSetDirtyFlagProtected(31,r),this.m_simpleTolerance!==t&&(this.m_simpleTolerance=t)}}attributeStreamIsAllocated(e){this.throwIfEmpty();let t=this.m_description.getAttributeIndex(e);return t>=0&&this.m_vertexAttributes.get(t)!==null}capacity(){return this.m_reservedPointCount===-1&&this.m_pointCount===0?0:this.m_reservedPointCount}getDescriptionImpl(){return this.m_description}copyToUnchecked(e,t=!1){t&&this.hasDirtyFlag(32)&&rt(`Cannot do shallow clone on unprepared geometry`);let n=e,r=this.getGeometryType(),i=n.getGeometryType();U(r===i||r===L.enumPolygon&&i===L.enumPolyline,`failure in copyToUnchcked`),n.clearAccelerators(),n.m_description=this.m_description,n.m_vertexAttributes.destroyAndSetSize(0),n.m_envelopeData.releaseAttributes();let a=this.m_description.getAttributeCount(),o=new Xr;if(!this.m_vertexAttributes.empty()){o.destroyAndSetSize(a);for(let e=0;e<a;e++)if(this.m_vertexAttributes.get(e))if(t)o.set(e,this.m_vertexAttributes.get(e));else{let t=ti.getComponentCount(this.m_description.getSemantics(e));o.set(e,this.m_vertexAttributes.get(e).restrictedClone(this.getPointCount()*t))}}if(this.m_envelopeData.copyToIfNotNull(this.m_description,n.m_envelopeData),n.m_flags=this.m_flags,n.m_simpleTolerance=this.m_simpleTolerance,r!==i){let e=[NaN];n.getIsSimple(0,e)>=3?n.setIsSimple(1,e[0]):n.setIsSimple(-1,0)}n.m_vertexAttributes.swap(o),o.destroyAndSetSize(0),n.m_pointCount=this.m_pointCount,n.hasDirtyFlag(32)||n.m_vertexAttributes.empty()?(U(!t||n.m_pointCount===0),n.m_reservedPointCount=-1):n.m_reservedPointCount=n.m_pointCount;try{this.copyToImpl(n,t)}catch(e){throw n.setEmpty(),e}n.verifyAllStreamsAfterSizeChange()}buildRasterizedGeometryAccelerator(e,t){return!1}getAccelerators(){return this.m_accelerators}clearAccelerators(){this.m_accelerators&&this.m_accelerators.release(),this.m_accelerators=null}ensureUniqueAccelerators(){if(this.m_accelerators&&!this.m_accelerators.uniqueUse()){let e=this.m_accelerators.clone();this.m_accelerators.release(),this.m_accelerators=e}}interpolateTwoVertices(e,t,n,r){(e<0||e>=this.m_pointCount)&&E(``),(t<0||t>=this.m_pointCount)&&E(``),r.assignVertexDescription(this.m_description);let i=H(ti.maxComponentCount(),NaN),a=H(ti.maxComponentCount(),NaN),o=Lt(),s=0;for(let r=0;r<this.m_description.getAttributeCount();r++){let c=this.m_description.getSemantics(r),l=ti.getInterpolation(c),u=ti.getComponentCount(c),d=ti.getDefaultValue(c);this.queryAttributeAsDbl(c,e,i,u),this.queryAttributeAsDbl(c,t,a,u),U(s+u<=25),S(l,i,a,o,s,u,n,d),s+=u}ei(r,o)}getShortestDistance(e,t){return z.distance(this.getXY(e),this.getXY(t))}getShortestSqrDistance(e,t){return z.sqrDistance(this.getXY(e),this.getXY(t))}resizeImpl(e){if(e<0&&R(),(e=Math.ceil(e))===this.m_pointCount)return;this.m_pointCount=e;let t=this.m_pointCount<=this.m_reservedPointCount?2001:4095;this.notifyModifiedFlags(t)}assignVertexDescriptionImpl(e){if(!this.m_vertexAttributes.empty()){let t=Bt();Jt(e,this.m_description,t);let n=new Xr;n.destroyAndSetSize(e.getAttributeCount());for(let r=0;r<e.getAttributeCount();r++){let e=t[r];e===-1?this.m_reservedPointCount=-1:n.set(r,this.m_vertexAttributes.get(e))}n.swap(this.m_vertexAttributes)}this.m_description=e,this.m_envelopeData.releaseAttributes(),this.notifyModifiedFlags(4095)}hasDirtyFlag(e){return(this.m_flags&e)!==0}setDirtyFlagProtected(e,t){t?this.m_flags|=e:this.m_flags&=~e}notifyModifiedAllImpl(){}verifyAllStreamsAfterSizeChange(){this.hasDirtyFlag(32)&&this.verifyAllStreamsAfterSizeChangeImpl()}verifyAllStreamsAfterSizeChangeImpl(){if(this.hasDirtyFlag(32)){if(this.m_reservedPointCount<this.m_pointCount){this.m_vertexAttributes.empty()&&this.m_vertexAttributes.destroyAndSetSize(this.m_description.getAttributeCount()),this.m_reservedPointCount=-1;let e=2**53-1,t=0;t=this.m_pointCount<4?3:this.m_pointCount<=128?2*this.m_pointCount:Math.trunc((4*this.m_pointCount+2)/3);for(let n=0;n<this.m_description.getAttributeCount();n++){let r=this.m_description.getSemantics(n),i=0;if(this.m_vertexAttributes.get(n)!==null){let e=ti.getComponentCount(r);i=this.m_vertexAttributes.get(n).size()/e,i<this.m_pointCount&&(this.m_vertexAttributes.get(n).resize(t*e,ti.getDefaultValue(r)),i=t)}else this.m_vertexAttributes.set(n,$t(r,t)),i=t;i<e&&(e=i)}this.m_reservedPointCount=e}this.verifyStreamsAfterSizeChangeExtraImpl(),this.setDirtyFlagProtected(32,!1)}}verifyStreamsAfterSizeChangeExtraImpl(){}updateAllDirtyIntervals(e){if(e?this.hasDirtyFlag(192):this.hasDirtyFlag(128)){if(this.isEmpty())return this.hasDirtyFlag(192)&&this.m_envelopeData.setEmpty(this.m_description),void this.setDirtyFlagProtected(192,!1);let t=this.updateXYImpl(e),n=new lr({vd:this.m_description});n.setEnvelope(t);for(let e=1;e<this.m_description.getAttributeCount();e++){let t=this.m_description.getSemantics(e),r=ti.getComponentCount(t),i=this.m_vertexAttributes.get(e);for(let e=0;e<r;e++){let a=new I;a.setEmpty();for(let t=0;t<this.m_pointCount;t++){let n=i.readAsDbl(t*r+e);a.mergeCoordinate(n)}n.setIntervalEnvelope(t,e,a)}}(e?this.hasDirtyFlag(192):this.hasDirtyFlag(128))&&(this.m_envelopeData=new cr({moveEnv:n}),this.clearDirtyIntervalsFlag(e))}}updateXYImpl(e){let t=G.constructEmpty(),n=this.m_vertexAttributes.get(0);return t.mergePointsInterleaved(n,0,this.m_pointCount),t}updateEnvelope3D(e){U(0)}updateLooseEnvelope(e){this.updateAllDirtyIntervals(!1),e instanceof G?e.assign(this.m_envelopeData.m_envelope2D):this.m_envelopeData.queryEnvelope3D(this.m_description,e)}updateEnvelope(e){this.updateAllDirtyIntervals(!0),e.assign(this.m_envelopeData.m_envelope2D)}setEmptyImpl(){this.m_pointCount=0,this.m_reservedPointCount=-1,this.m_vertexAttributes.destroyAndSetSize(0),this.notifyModifiedFlags(4095)}clearDirtyIntervalsFlag(e){this.setDirtyFlagProtected(192,!1)}reserveImpl(e,t){if(e<0&&R(``),e===0)return;let n=e=Math.ceil(e);if(this.m_reservedPointCount<n){this.m_vertexAttributes.empty()&&this.m_vertexAttributes.destroyAndSetSize(this.m_description.getAttributeCount()),t?(this.m_vertexAttributes.get(0)===null&&this.m_vertexAttributes.set(0,en(0,0)),this.m_vertexAttributes.get(0).resizeRounded(2*n),n=this.m_vertexAttributes.get(0).size()>>1):this.m_vertexAttributes.get(0)===null?this.m_vertexAttributes.set(0,en(0,n)):this.m_vertexAttributes.get(0).resize(2*n);for(let e=1;e<this.m_description.getAttributeCount();e++){let t=this.m_description.getSemantics(e),r=ti.getComponentCount(t);this.m_vertexAttributes.get(e)===null?this.m_vertexAttributes.set(e,en(t,n)):this.m_vertexAttributes.get(e).resize(n*r)}this.reserveImplImpl(n,t),this.m_reservedPointCount=n}}reserveRounded(e){e<0&&R(),e=Math.ceil(e),this.reserveImpl(e,!0)}reserveImplImpl(e,t){}throwIfEmpty(){this.isEmptyImpl()&&se(``)}},ii=class e extends ri{constructor(e){super(e),e&&(e.points?this.addPoints2D(e.points,e.pointsSize,0,-1):e.point&&this.add(e.point))}assignCopy(e){return e.copyTo(this),this}assignMove(e){return e.copyTo(this),e.setEmpty(),this}insertPoint2D(e,t){e>this.getPointCount()&&R(`invalid point index`),e<0&&(e=this.getPointCount());let n=this.m_pointCount;this.resizeNoInit(this.m_pointCount+1);for(let r=0,i=this.m_description.getAttributeCount();r<i;r++){let i=this.m_description.getSemantics(r),a=Rt.getComponentCount(i);if(i===0)this.m_vertexAttributes.get(r).insert(a*e,t,a*n);else{let t=Rt.getDefaultValue(i);this.m_vertexAttributes.get(r).insertRange(a*e,t,a,a*n)}}this.notifyModifiedFlags(2001)}insertPoint(e,t){t.isEmpty()&&R(ni),e<0&&(e=this.getPointCount()),this.mergeVertexDescription(t.getDescription());let n=this.m_pointCount;this.resizeNoInit(this.m_pointCount+1);for(let r=0,i=this.m_description.getAttributeCount();r<i;r++){let i=this.m_description.getSemantics(r),a=Rt.getComponentCount(i);if(t.hasAttribute(i))this.m_vertexAttributes.get(r).insertAttributes(a*e,t,i,a*n);else{let t=Rt.getDefaultValue(i);this.m_vertexAttributes.get(r).insertRange(a*e,t,a,a*n)}}this.notifyModifiedFlags(2001)}insertPoints(e,t,n){if((e>this.getPointCount()||n<0)&&E(``),e<0&&(e=this.getPointCount()),n===0)return;let r=t[0].getDescription();this.mergeVertexDescription(r);let i=this.m_pointCount;this.resizeNoInit(this.m_pointCount+n);for(let a=0,o=this.m_description.getAttributeCount();a<o;a++){let o=this.m_description.getSemantics(a),s=Rt.getComponentCount(o);if(this.m_vertexAttributes.get(a))if(r.hasAttribute(o))this.m_vertexAttributes.get(a).insertAttributesFromPoints(e*s,t,n,o,i*s);else{let t=Rt.getDefaultValue(o);this.m_vertexAttributes.get(a).insertRange(s*e,t,s*n,s*i)}}this.notifyModifiedFlags(2001)}insertPoints2D(e,t,n){if((e>this.getPointCount()||n<0)&&R(`invalid point index`),e<0&&(e=this.getPointCount()),n===0)return;let r=this.m_pointCount;this.resizeNoInit(this.m_pointCount+n);for(let i=0,a=this.m_description.getAttributeCount();i<a;i++){let a=this.m_description.getSemantics(i),o=Rt.getComponentCount(a);if(this.m_vertexAttributes.get(i))if(a===0)this.m_vertexAttributes.get(i).insertRangeFromPoints(o*e,t,0,n,!0,o*r);else{let t=Rt.getDefaultValue(a);this.m_vertexAttributes.get(i).insertRange(o*e,t,o,o*r)}}this.notifyModifiedFlags(2001)}removePoints(e,t){if((e<0||t<0||e+t>this.getPointCount())&&E(`remove_points`),t!==0){for(let n=0,r=this.m_description.getAttributeCount();n<r;n++)if(this.m_vertexAttributes.get(n)){let r=this.m_description.getSemantics(n),i=Rt.getComponentCount(r);this.m_vertexAttributes.get(n).eraseRange(i*e,i*t,i*this.m_pointCount)}this.m_pointCount-=t,this.m_reservedPointCount>0&&(this.m_reservedPointCount-=t),this.notifyModifiedFlags(2001)}}removePoint(e){for(let t=0,n=this.m_description.getAttributeCount();t<n;t++)if(this.m_vertexAttributes.get(t)){let n=this.m_description.getSemantics(t),r=Rt.getComponentCount(n);this.m_vertexAttributes.get(t).eraseRange(r*e,r,r*this.m_pointCount)}this.m_pointCount--,this.m_reservedPointCount>0&&this.m_reservedPointCount--,this.notifyModifiedFlags(2001)}calculateEnvelope2D(){return this.updateXYImpl(!0)}resizeNoInit(e){this.resizeImpl(e)}resizeAndInitNonPositionAttributes(e){let t=this.m_pointCount;if(this.resizeImpl(e),this.m_pointCount>t)for(let e=1,n=this.m_description.getAttributeCount();e<n;e++){let n=this.m_description.getSemantics(e),r=Rt.getDefaultValue(n),i=Rt.getComponentCount(n);this.m_vertexAttributes.get(e).insertRange(i*t,r,i*(this.m_pointCount-t),i*t)}}queryCoordinates3D(e,t,n,r){let i=r<0?this.m_pointCount:r;if(i=Math.min(i,n+t),(n<0||i<n||this.m_pointCount>0&&n>=this.m_pointCount)&&R(``),this.m_pointCount===0)return i;let a=this.getAttributeStreamRef(0),o=null,s=Rt.getDefaultValue(1),c=this.m_description.hasAttribute(1);c&&(o=this.getAttributeStreamRef(1));let l=0;for(let t=n;t<i;t++,l++)e[l].x=a.read(2*t),e[l].y=a.read(2*t+1),e[l].z=c?o.read(t):s;return i}queryAttributeAsInt(e,t,n,r){U(0)}add(e){e.isEmpty()&&R(ni),this.resizeAndInitNonPositionAttributes(this.m_pointCount+1),this.setPointByValNoCurves(this.m_pointCount-1,e)}addXY(e,t){this.resizeAndInitNonPositionAttributes(this.m_pointCount+1);let n=new z(e,t);this.setXYNoCurves(this.m_pointCount-1,n)}addXYZ(e,t,n){this.resizeAndInitNonPositionAttributes(this.m_pointCount+1);let r=new K;r.setCoords(e,t,n),this.setXYZNoCurves(this.m_pointCount-1,r)}addPoint2D(e){this.addXY(e.x,e.y)}addPoint3D(e){this.addXYZ(e.x,e.y,e.z)}addPoints(e,t,n){this===e&&R(`Multi_point_impl.add`);let r=n<0?e.getPointCount():n;if((t<0||t>e.getPointCount()||r<t)&&R(``),t===r)return;let i=e.getDescription();this.mergeVertexDescription(i);let a=r-t,o=this.m_pointCount;this.resizeNoInit(this.m_pointCount+a);for(let n=0,r=this.m_description.getAttributeCount();n<r;n++){let r=this.m_description.getSemantics(n),s=Rt.getComponentCount(r),c=this.getAttributeStreamRef(r);if(i.hasAttribute(r)){let n=e.getAttributeStreamRef(r);c.insertRangeFromStream(o*s,n,t*s,a*s,!0,1,o*s)}else{let e=Rt.getDefaultValue(r);c.insertRange(o*s,e,a*s,o*s)}}}addPoints2D(e,t,n,r){let i=t,a=r<0?i:r;if((i<0||n<0||n>i||a<n)&&R(``),n===a)return;i=a-n;let o=this.m_pointCount;this.resizeAndInitNonPositionAttributes(this.m_pointCount+i);let s=this.getAttributeStreamRef(0);for(let t=0;t<i;++t)s.writePoint2D(2*(o+t),e[n+t]);this.notifyModifiedFlags(2001)}addPoints3D(e,t,n,r){let i=t,a=r<0?i:r;if((i<0||n<0||n>i||a<n)&&R(``),this.addAttribute(1),n===a)return;i=a-n;let o=this.m_pointCount;this.resizeAndInitNonPositionAttributes(this.m_pointCount+i);let s=this.getAttributeStreamRef(0),c=new z;for(let t=0;t<i;t++)c.x=e[n+t].x,c.y=e[n+t].y,s.writePoint2D(2*(o+t),c);let l=this.getAttributeStreamRef(1);for(let t=0;t<i;t++)l.write(o+t,e[n+t].z);this.notifyModifiedFlags(2001)}setPointByVal(e,t){this.setPointByValNoCurves(e,t)}setXY(e,t){this.setXYNoCurves(e,t)}setXYCoords(e,t,n){this.setXYCoordsNoCurves(e,t,n)}setXYZ(e,t){this.setXYZNoCurves(e,t)}setAttribute(e,t,n,r){this.setAttributeNoCurves(e,t,n,r)}getGeometryType(){return L.enumMultiPoint}getDimension(){return 0}createInstance(){return new e({vd:this.getDescription()})}setEmpty(){this.setEmptyImpl()}applyTransformation(e){if(this.isEmpty()||e.isIdentity())return;let t=this.m_vertexAttributes.get(0);e.m_TransformationType===1?t.applyTransformation(e,0,this.m_pointCount):xt(`3d xform not impl`),this.notifyModifiedFlags(2001)}calculateArea2D(){return 0}calculateLength2D(){return 0}calculateLength3D(e){return 0}equals(e,t){return e.getGeometryType()===L.enumMultiPoint&&this.equalsBase(e,t)}queryEnvelope(e){e.m_EnvelopeType===4?(this.updateAllDirtyIntervals(!0),this.m_envelopeData.copyTo(this.m_description,e)):e.m_EnvelopeType===2?this.updateEnvelope(e):xt(``)}getImpl(){return this}getBoundary(){return null}reserve(e){this.reserveImpl(e)}clone(){let e=this.createInstance();return this.copyTo(e),e}swap(e){U(0)}buildQuadTreeAccelerator(e){return!1}getHashCodeImpl(){return U(0),0}equalsImpl(e){return!0}equalsImplTol(e,t){return!0}copyToImpl(e,t){}};ii.type=L.enumMultiPoint;var ai=class extends Yr{constructor(e){super(e)}},oi=class extends ai{isTrue3D(){return!0}constructor(e){super(e)}};function si(e,t,n){ci(t,e.getStartXY(),e.getEndXY(),n)}function ci(e,t,n,r){Ee(t,n,e,r)}function li(e,t){return c(e.m_XStart,e.m_XEnd,t)}function ui(e,t){return c(e.m_YStart,e.m_YEnd,t)}function di(e,t){let n=e.getStartZ(),r=e.getEndZ();return c(n,r,t)}function fi(e,t,n){let r=J.constructPoint2D(e.getStartXY()),i=J.constructPoint2D(e.getEndXY());n.setCoordsE(i.x.subE(r.x),i.y.subE(r.y))}function pi(e,t,n){t.value()<=.5?F(2,J.constructPoint2D(e.getStartXY()),J.constructPoint2D(e.getEndXY()),t,n):vt(2,J.constructPoint2D(e.getStartXY()),J.constructPoint2D(e.getEndXY()),t,n)}function mi(e,t,n){e.m_XStart=t.x,e.m_YStart=t.y,e.m_XEnd=n.x,e.m_YEnd=n.y,e.afterCompletedModification()}function hi(e,t){let n=e.getStartXYZ();n.z*=t;let r=e.getEndXYZ();return r.z*=t,n.norm(1)+r.norm(1)}function gi(e){if(e.m_YEnd<e.m_YStart||e.m_YEnd===e.m_YStart&&e.m_XEnd<e.m_XStart){e.m_XEnd=W(e.m_XStart,e.m_XStart=e.m_XEnd),e.m_YEnd=W(e.m_YStart,e.m_YStart=e.m_YEnd);for(let t=0,n=e.m_description.getTotalComponentCount()-2;t<n;t++)e.m_attributes[t+n]=W(e.m_attributes[t],e.m_attributes[t]=e.m_attributes[t+n])}}function _i(e,t,n,r){let i=0;if((e.m_XStart===t.m_XStart&&e.m_YStart===t.m_YStart||e.m_XStart===t.m_XEnd&&e.m_YStart===t.m_YEnd)&&(i++,!r))return 1;if(e.m_XEnd===t.m_XStart&&e.m_YEnd===t.m_YStart||e.m_XEnd===t.m_XEnd&&e.m_YEnd===t.m_YEnd){if(i++,i===2)return 2;if(!r)return 1}return t.isIntersectingPoint(e.getStartXY(),n,!0)||t.isIntersectingPoint(e.getEndXY(),n,!0)||e.isIntersectingPoint(t.getStartXY(),n,!0)||e.isIntersectingPoint(t.getEndXY(),n,!0)?4:r&&i?0:bi(e,t)?4:0}function vi(e,t,n,r,i,a,o,s){r!==null&&xe(r,2,NaN),i!==null&&xe(i,2,NaN),n!==null&&N(n,z,2);let c=yi(e,t,2,n,r,i,a,o,s);return r&&(r.length=c),i&&(i.length=c),n&&(n.length=c),c}function yi(e,t,n,r,i,a,o,s,c){let l=xi(e,t.getStartXY(),o,!1),u=xi(e,t.getEndXY(),o,!1),d=xi(t,e.getStartXY(),o,!1),f=xi(t,e.getEndXY(),o,!1),p=0,m=0;if(!Number.isNaN(l)){let n=!1;s&&re(l,0,1)&&e.getCoord2D(l).isEqualPoint2D(t.getStartXY())&&(p++,n=!0),n||(i&&(i[m]=l),a&&(a[m]=0),r&&r[m].setCoords(t.m_XStart,t.m_YStart),m++)}if(!Number.isNaN(u)){let o=!1;s&&re(u,0,1)&&e.getCoord2D(u).isEqualPoint2D(t.getEndXY())&&(p++,o=!0),o||(n>m&&(i&&(i[m]=u),a&&(a[m]=1),r&&r[m].setCoords(t.m_XEnd,t.m_YEnd)),m++)}if(m!==2&&!Number.isNaN(d)&&!(l===0&&d===0||u===0&&d===1)){let o=!1;s&&re(d,0,1)&&t.getCoord2D(d).isEqualPoint2D(e.getStartXY())&&(p++,o=!0),o||(n>m&&(i&&(i[m]=0),a&&(a[m]=d),r&&r[m].setCoords(e.m_XStart,e.m_YStart)),m++)}if(m!==2&&!Number.isNaN(f)&&!(l===1&&f===0||u===1&&f===1)){let o=!1;s&&re(f,0,1)&&t.getCoord2D(f).isEqualPoint2D(e.getEndXY())&&(p++,o=!0),o||(n>m&&(i&&(i[m]=1),a&&(a[m]=f),r&&r[m].setCoords(t.m_XEnd,t.m_YEnd)),m++)}if(m>0)return c&&(a=W(i,i=a)),m===2&&n>=2&&i&&i[0]>i[1]&&(i[1]=W(i[0],i[0]=i[1]),a&&(a[1]=W(a[0],a[0]=a[1])),r&&(r[1]=W(r[0],r[0]=r[1]))),m;if(p>0)return 0;let h=Ei(e,t,o);return Number.isNaN(h.x)?0:(r&&(r[0]=e.getCoord2D(h.x)),i&&(i[0]=h.x),a&&(a[0]=h.y),1)}function bi(e,t){let n=Si(e,t.m_XStart,t.m_YStart),r=Si(e,t.m_XEnd,t.m_YEnd);if(n<0&&r<0||n>0&&r>0)return!1;let i=Si(t,e.m_XStart,e.m_YStart),a=Si(t,e.m_XEnd,e.m_YEnd);return i<0&&a<0||i>0&&a>0?!1:Ti(e)>Ti(t)?wi(e,t):wi(t,e)}function xi(e,t,n,r){let i=z.getNAN(),a=z.getNAN(),o=!1;e.m_YEnd<e.m_YStart||e.m_YEnd===e.m_YStart&&e.m_XEnd<e.m_XStart?(i.setCoords(e.m_XEnd,e.m_YEnd),a.setCoords(e.m_XStart,e.m_YStart),o=!0):(i.setCoords(e.m_XStart,e.m_YStart),a.setCoords(e.m_XEnd,e.m_YEnd));let s=o?1:0,c=o?0:1,l=z.getNAN();l.setSub(t,i);let u=l.length(),d=3*u*fe();if(u<=Math.max(n,d))return r&&u===0?NaN:s;if(l.setSub(t,a),u=l.length(),d=3*u*fe(),u<=Math.max(n,d))return r&&u===0?NaN:c;l.setCoords(a.x-i.x,a.y-i.y);let f=l.length();if(f>0){let e=1/f;l.scale(e);let r=z.getNAN();r.setSub(t,i);let u=r.dotProduct(l),d=8*r.dotProductAbs(l)*fe();l.leftPerpendicularThis();let p=r.dotProduct(l),m=8*r.dotProductAbs(l)*fe(),h=Math.max(n,d);if(u<-h||u>f+h)return NaN;let g=Math.max(n,m);if(Math.abs(p)<=g){let r=u*e;r=_e(r,0,1);let l=z.getNAN();if(ci(r,i,a,l),z.distance(l,t)<=n){if(r<.5){if(z.distance(l,i)<=n&&z.distance(t,i)<=n)return s}else if(z.distance(l,a)<=n&&z.distance(t,a)<=n)return c;return o?1-r:r}}}return NaN}function Si(e,t,n){let r=z.getNAN();r.setCoords(t,n),r.subThis(e.getStartXY());let i=z.getNAN();i.setSub(e.getEndXY(),e.getStartXY());let a=i.crossProduct(r),o=4*fe()*(Math.abs(i.x*r.y)+Math.abs(i.y*r.x));return a>o?-1:a<-o?1:0}function Ci(e,t,n,r){let i=r?e.m_XStart:e.m_XEnd,a=r?e.m_YStart:e.m_YEnd,o=z.getNAN();return o.x=t.getEndX()-i,o.y=t.getEndY()-a,n.dotProduct(o)>3*fe()*n.dotProductAbs(o)?(o.x=t.getStartX()-i,o.y=t.getStartY()-a,n.dotProduct(o)<=3*fe()*n.dotProductAbs(o)):!0}function wi(e,t){let n=z.getNAN();return n.x=e.m_XEnd-e.m_XStart,n.y=e.m_YEnd-e.m_YStart,!!Ci(e,t,n,!1)&&(n.negateThis(),!!Ci(e,t,n,!0))}function Ti(e){let t=e.m_XStart-e.m_XEnd,n=e.m_YStart-e.m_YEnd;return t*t+n*n}function Ei(e,t,n){let r=e.m_XEnd-e.m_XStart,i=e.m_YEnd-e.m_YStart,a=t.m_XEnd-t.m_XStart,o=t.m_YEnd-t.m_YStart,s=a*i-r*o;if(s===0)return z.getNAN();let c=4*fe()*(Math.abs(a*i)+Math.abs(r*o)),l=t.m_XStart-e.m_XStart,u=t.m_YStart-e.m_YStart,d=a*u-l*o,f=4*fe()*(Math.abs(a*u)+Math.abs(l*o)),p=d/s,m=Math.abs(s),h=(f*m+c*Math.abs(d))/(s*s)+fe()*Math.abs(p);if(p<-h||p>1+h)return z.getNAN();let g=r*u-l*i,_=g/s,v=(4*fe()*(Math.abs(r*u)+Math.abs(l*i))*m+c*Math.abs(g))/(s*s)+fe()*Math.abs(_);if(_<-v||_>1+v)return z.getNAN();let y=_e(p,0,1),b=_e(_,0,1),x=z.getNAN();si(e,y,x);let S=z.getNAN();if(si(t,b,S),!n||z.distance(x,S)>n){let r=z.getNAN();Ee(x,S,.5,r),y=e.getClosestCoordinate(r,!1),b=t.getClosestCoordinate(r,!1);let i=z.getNAN();si(e,y,i);let a=z.getNAN();si(t,b,a),i.subThis(a);let o=i.length(),s=(e.absNorm()+t.absNorm())*j();if(o>Math.max(n,s))return z.getNAN()}return new z(y,b)}var Di=class{constructor(e){if(this.m_segFlagStream=null,this.m_xyStream=null,this.m_bCirculator=!1,this.m_currentSegmentIndex=-1,this.m_nextSegmentIndex=0,this.m_nextPathIndex=0,this.m_currentPathIndex=-1,this.m_parent=e.parent,this.m_buffer=new this.m_parent.m_segmentBufferCTor,this.m_description=e.parent.getDescription(),this.m_segmentCount=this.getSegmentCount(this.m_nextPathIndex),e.pointIndex!==void 0){(e.pointIndex<0||e.pointIndex>=e.parent.getPointCount())&&E(``);let t=e.parent.getPathIndexFromPointIndex(e.pointIndex);this.m_currentPathIndex=t,this.m_nextPathIndex=t+1,this.m_nextSegmentIndex=e.pointIndex-e.parent.getPathStart(t),this.m_segmentCount=this.getSegmentCount(this.m_currentPathIndex)}else if(e.pathIndex!==void 0){(e.pathIndex<0||e.pathIndex>=e.parent.getPathCount()||e.segmentIndex<0)&&E(``);let t=e.parent.isClosedPath(e.pathIndex)?0:1;e.segmentIndex>=e.parent.getPathSize(e.pathIndex)-t&&E(``),this.m_nextSegmentIndex=e.segmentIndex,this.m_currentPathIndex=e.pathIndex,this.m_nextPathIndex=this.m_nextSegmentIndex+1,this.m_segmentCount=this.getSegmentCount(this.m_nextPathIndex)}this.prepare(),this.m_pathBegin=-1,this.m_bCurrentPathClosed=!1,this.m_bStripAttributes=!1,this.m_prevPathIndex=-1,this.m_prevSegmentIndex=-1,this.m_bNeedsUpdate=!1,this.m_currentPathIndex>-1&&(this.m_pathBegin=this.m_parent.getPathStart(this.m_currentPathIndex),this.m_bCurrentPathClosed=this.m_parent.isClosedPath(this.m_currentPathIndex))}stripAttributes(){this.m_bStripAttributes=!0}prepare(){this.m_bCirculator=!1,this.m_parent.isEmptyImpl()?(this.m_segFlagStream=null,this.m_xyStream=null):(this.m_segFlagStream=this.m_parent.getSegmentFlagsStreamRef(),this.m_xyStream=this.m_parent.getAttributeStreamRef(0))}nextPath(){return this.m_currentPathIndex=this.m_nextPathIndex,!(this.m_currentPathIndex>=this.m_parent.getPathCount())&&(this.m_currentSegmentIndex=-1,this.m_nextSegmentIndex=0,this.m_segmentCount=this.getSegmentCount(this.m_currentPathIndex),this.m_pathBegin=this.m_parent.getPathStart(this.m_currentPathIndex),this.m_bCurrentPathClosed=this.m_parent.isClosedPath(this.m_currentPathIndex),this.m_nextPathIndex++,!0)}previousPath(){return this.m_nextPathIndex!==0&&(this.m_nextPathIndex--,this.m_currentSegmentIndex=-1,this.m_nextSegmentIndex=0,this.m_segmentCount=this.getSegmentCount(this.m_nextPathIndex),this.m_currentPathIndex=this.m_nextPathIndex,this.m_pathBegin=this.m_parent.getPathStart(this.m_currentPathIndex),this.m_bCurrentPathClosed=this.m_parent.isClosedPath(this.m_currentPathIndex),this.resetToLastSegment(),!0)}getSegmentCount(e){return this.m_parent.isEmptyImpl()?0:this.m_parent.getSegmentCountPath(e)}resetToFirstPath(){this.m_currentSegmentIndex=-1,this.m_nextSegmentIndex=-1,this.m_segmentCount=-1,this.m_nextPathIndex=0,this.m_currentPathIndex=-1,this.m_pathBegin=-1,this.m_bCurrentPathClosed=!1}resetToLastPath(){this.m_nextPathIndex=this.m_parent.getPathCount(),this.m_currentPathIndex=-1,this.m_currentSegmentIndex=-1,this.m_nextSegmentIndex=-1,this.m_segmentCount=-1,this.m_pathBegin=-1}resetToPath(e){(e<0||e>this.m_parent.getPathCount())&&E(``),this.m_nextPathIndex=e,this.m_currentPathIndex=-1,this.m_currentSegmentIndex=-1,this.m_nextSegmentIndex=-1,this.m_segmentCount=-1,this.m_pathBegin=-1,this.m_bCurrentPathClosed=!1}isLastPath(){return this.m_currentPathIndex===this.m_parent.getPathCount()-1}isFirstSegmentInPath(){return this.m_currentSegmentIndex===0}isLastSegmentInPath(){return this.m_currentSegmentIndex===this.m_segmentCount-1}resetToFirstSegment(){this.m_currentSegmentIndex=-1,this.m_nextSegmentIndex=0}resetToLastSegment(){this.m_nextSegmentIndex=this.m_segmentCount,this.m_currentSegmentIndex=-1}resetTo(e){this.m_parent!==e.m_parent&&ge(``),this.m_currentSegmentIndex=e.m_currentSegmentIndex,this.m_nextSegmentIndex=e.m_nextSegmentIndex,this.m_currentPathIndex=e.m_currentPathIndex,this.m_nextPathIndex=e.m_nextPathIndex,this.m_segmentCount=e.m_segmentCount,this.m_bCirculator=e.m_bCirculator,this.m_pathBegin=e.m_pathBegin,this.m_bCurrentPathClosed=e.m_bCurrentPathClosed,this.m_bStripAttributes=e.m_bStripAttributes,this.m_description=e.m_description}resetToVertex(e,t){if(this.m_currentPathIndex>=0&&this.m_currentPathIndex<this.m_parent.getPathCount()){let t=this.getPathBegin();if(e>=t&&e<this.m_parent.getPathEnd(this.m_currentPathIndex))return this.m_currentSegmentIndex=-1,void(this.m_nextSegmentIndex=e-t)}let n;n=t>=0&&t<this.m_parent.getPathCount()&&e>=this.m_parent.getPathStart(t)&&e<this.m_parent.getPathEnd(t)?t:this.m_parent.getPathIndexFromPointIndex(e),this.m_nextPathIndex=n+1,this.m_currentPathIndex=n,this.m_currentSegmentIndex=-1,this.m_nextSegmentIndex=e-this.m_parent.getPathStart(n),this.m_segmentCount=this.getSegmentCount(n),this.m_pathBegin=this.m_parent.getPathStart(this.m_currentPathIndex),this.m_bCurrentPathClosed=this.m_parent.isClosedPath(this.m_currentPathIndex)}hasNextSegment(){return this.m_nextSegmentIndex<this.m_segmentCount}hasPreviousSegment(){return this.m_nextSegmentIndex>0}nextSegment(){return this.m_currentSegmentIndex!==this.m_nextSegmentIndex&&this.updateSegment(),this.m_bCirculator?this.m_nextSegmentIndex=(this.m_nextSegmentIndex+1)%this.m_segmentCount:(this.m_nextSegmentIndex===this.m_segmentCount&&E(`Segment_iterator_impl::next_segment`),this.m_nextSegmentIndex++),this.m_buffer.get()}previousSegment(){return this.m_bCirculator?this.m_nextSegmentIndex=(this.m_segmentCount+this.m_nextSegmentIndex-1)%this.m_segmentCount:(this.m_nextSegmentIndex===0&&E(``),this.m_nextSegmentIndex--),this.m_nextSegmentIndex!==this.m_currentSegmentIndex&&this.updateSegment(),this.m_buffer.get()}nextCurve(){if(!this.m_parent.hasNonLinearSegments())return this.resetToLastSegment(),null;let e=0;for(;;){if(this.m_nextSegmentIndex===this.m_segmentCount||e===this.m_segmentCount)return null;let t=this.getPathBegin()+this.m_nextSegmentIndex;if((31&this.m_segFlagStream.read(t))!=1){this.updateSegment();break}this.m_bCirculator?this.m_nextSegmentIndex=(this.m_nextSegmentIndex+1)%this.m_segmentCount:this.m_nextSegmentIndex++,e++}return this.m_currentSegmentIndex!==this.m_nextSegmentIndex&&this.updateSegment(),this.m_bCirculator?this.m_nextSegmentIndex=(this.m_nextSegmentIndex+1)%this.m_segmentCount:(this.m_nextSegmentIndex===this.m_segmentCount&&E(``),this.m_nextSegmentIndex++),this.m_buffer.get()}getPathBegin(){return this.m_pathBegin}getPathIndex(){return this.m_currentPathIndex}getStartPointIndex(){return this.getPathBegin()+this.m_currentSegmentIndex}getEndPointIndex(){return this.isClosingSegment()?this.getPathBegin():this.getStartPointIndex()+1}updateSegment(){(this.m_nextSegmentIndex<0||this.m_nextSegmentIndex>=this.m_segmentCount||this.m_currentPathIndex<0)&&E(``),this.m_currentSegmentIndex=this.m_nextSegmentIndex,this.m_parent.getSegmentFromPath(this.m_currentPathIndex,this.m_currentSegmentIndex,this.m_buffer,this.m_bStripAttributes)}isClosingSegment(){return this.m_bCurrentPathClosed&&this.m_currentSegmentIndex===this.m_segmentCount-1}isCurve(){return this.m_segFlagStream===null?!1:(31&this.m_segFlagStream.read(this.m_currentSegmentIndex))!=1}isPathClosed(){return this.m_bCurrentPathClosed}setCirculator(e){this.m_bCirculator=e}getImpl(){return this}},Oi=class e{constructor(e){this.m_rasterizedGeometry=null,this.m_quadTree=null,this.m_quadTreeForPaths=null,this.m_refCount=1,e&&e.copyTo(this)}getRasterizedGeometry(){return this.m_rasterizedGeometry}copyTo(e){e!==this&&(U(e.uniqueUse()),e.m_quadTree=this.m_quadTree,e.m_quadTreeForPaths=this.m_quadTreeForPaths,e.m_rasterizedGeometry=this.m_rasterizedGeometry)}clone(){let t=new e;return this.copyTo(t),t}uniqueUse(){return this.m_refCount===1}addRef(){++this.m_refCount}release(){--this.m_refCount===0&&(this.m_rasterizedGeometry=null,this.m_quadTree=null,this.m_quadTreeForPaths=null)}setRasterizedGeometry(e){U(this.uniqueUse())}setQuadTree(e){U(this.uniqueUse()),this.m_quadTree=e}setQuadTreeForPaths(e){U(this.uniqueUse()),this.m_quadTreeForPaths=e}getQuadTree(){return this.m_quadTree}getQuadTreeForPaths(){return this.m_quadTreeForPaths}};function ki(e){return!(e.isEmpty()||e.getGeometryType()!==L.enumPolyline&&e.getGeometryType()!==L.enumPolygon)&&!(e.getPointCount()<20)}function Ai(e){return!(e.isEmpty()||e.getGeometryType()!==L.enumPolyline&&e.getGeometryType()!==L.enumPolygon)&&!(e.getPointCount()<20)}function ji(e,t){return e.readPoint2D(t+4)}function Mi(e){let t=e.getGeometryType();return t===L.enumEllipticArc?10:t===L.enumBezier?4:t===L.enumRationalBezier2?5:t===L.enumBezier2?2:void B(``)}function Ni(e){let t=31&e;return t===4?10:t===2?4:t===8?5:t===16?2:0}function Pi(e,t,n,r){let i=e.getPathStart(t),a=e.getPathEnd(t);if(a-i<3)return;let o=2*i,s=z.getNAN();n.queryPoint2D(o,s);let c=s.x,l=s.y,u=z.getNAN();n.queryPoint2D(o+2,u);let d=z.getNAN();for(let e=o+4,t=2*a;e<t;e+=2)n.queryPoint2D(e,d),r.pe((d.x-s.x)*(u.y-l)),s.setCoordsPoint2D(u),u.setCoordsPoint2D(d);r.pe((c-s.x)*(u.y-l))}function Fi(e,t,n){for(;t.hasNextSegment();){let e=t.nextCurve();if(e===null)break;n.pe(2*e.calculateArea2DHelper())}}var Ii=Rt,Li=class{static toSegType(e){let t=0;switch(e){case L.enumLine:t=1;break;case L.enumBezier:t=2;break;case L.enumEllipticArc:t=4;break;case L.enumRationalBezier2:t=8;break;case L.enumBezier2:t=16;break;default:B(``)}return t}constructor(){this.m_segmentFlags=null,this.m_segmentParamIndex=null,this.m_segmentParams=null,this.m_curveCount=0,this.m_bezierCount=0,this.m_arcCount=0,this.m_rbezier2Count=0,this.m_bezier2Count=0,this.m_curveParamWritePoint=0}assignCopy(e){return this.m_segmentFlags=e.m_segmentFlags,this.m_segmentParamIndex=e.m_segmentParamIndex,this.m_segmentParams=e.m_segmentParams,this.m_curveCount=e.m_curveCount,this.m_bezierCount=e.m_bezierCount,this.m_arcCount=e.m_arcCount,this.m_rbezier2Count=e.m_rbezier2Count,this.m_bezier2Count=e.m_bezier2Count,this.m_curveParamWritePoint=e.m_curveParamWritePoint,this}},Ri=class e extends ri{constructor(e){super(e),this.m_cachedRingAreas2D=null,this.m_paths=null,this.m_pathFlags=null,this.m_curveData=null,e.move?(this.m_bPolygon=e.move.m_bPolygon,this.m_cachedLength2D=e.move.m_cachedLength2D,this.m_cachedArea2D=e.move.m_cachedArea2D,this.m_currentPathIndex=e.move.m_currentPathIndex,this.m_cachedRingAreas2D=e.move.m_cachedRingAreas2D,this.m_paths=e.move.m_paths,this.m_pathFlags=e.move.m_pathFlags,this.m_curveData=e.move.m_curveData,e.move.m_curveData=null,e.move.setEmpty()):(this.m_bPolygon=e.bPolygon,this.m_cachedLength2D=0,this.m_cachedArea2D=0,this.m_currentPathIndex=0)}getGeometryType(){return this.m_bPolygon?L.enumPolygon:L.enumPolyline}getDimension(){return this.m_bPolygon?2:1}changeRingStartPoint(e){U(this.m_bPolygon);let t=this.getPathIndexFromPointIndex(e),n=this.getPathStart(t);if(n===e)return;let r=this.getPathEnd(t);(e>=r||e<n)&&R(`change_ring_start_point`);for(let t=0,i=this.m_description.getAttributeCount();t<i;t++){let i=this.m_description.getSemantics(t),a=Ii.getComponentCount(i);this.m_vertexAttributes.get(t).rotate(n*a,e*a,r*a)}this.hasNonLinearSegments()&&(this.m_curveData.m_segmentFlags.rotate(n,e,r),this.m_curveData.m_segmentParamIndex.rotate(n,e,r))}setFillRule(e){this.m_bFillRule=e===1}getFillRule(){return this.m_bFillRule?1:0}isExteriorRingOGC(e){return!!this.m_bPolygon&&(this.updateOGCFlagsProtected(),!!(8&this.m_pathFlags.read(e)))}isExteriorRing(e){return this.calculateRingArea2D(e)>0}calculateRingArea2D(e){return this.m_bPolygon?(this.updateRingAreas2DProtected(),this.m_cachedRingAreas2D.read(e)):0}updateRingAreas2DProtected(){if(!this.hasDirtyFlag(1024))return;let e=this.getPathCount();if(e===0)return this.hasDirtyFlag(1024)&&(this.m_cachedArea2D=0),void this.setDirtyFlagProtected(1024,!1);let t=new ln(e),n=new s(0),r=new s(0);if(this.m_pointCount!==0){let i=this.getAttributeStreamRef(0);if(this.hasNonLinearSegments()){let e=new Di({parent:this});for(e.stripAttributes();e.nextPath();){r.reset();let a=e.getPathIndex();Pi(this,a,i,r),Fi(this,e,r);let o=.5*r.getResult();n.add(o),t.write(a,o)}}else for(let a=0;a<e;a++){r.reset(),Pi(this,a,i,r);let e=.5*r.getResult();n.add(e),t.write(a,e)}}this.hasDirtyFlag(1024)&&(this.m_cachedArea2D=n.getResult(),this.m_cachedRingAreas2D=t,this.setDirtyFlagProtected(1024,!1))}getOGCPolygonCount(){if(!this.m_bPolygon)return 0;this.updateOGCFlagsProtected();let e=0,t=this.getPathCount();for(let n=0;n<t;n++)8&this.m_pathFlags.read(n)&&e++;return e}getHashCodeImpl(){return U(0),0}equalsImpl(t){let n=t,r=this.getPathCount();if(r!==n.getPathCount())return!1;let i=this.hasNonLinearSegments();if(i!==n.hasNonLinearSegments()||i&&(this.m_curveData.m_curveCount!==n.m_curveData.m_curveCount||this.m_curveData.m_bezierCount!==n.m_curveData.m_bezierCount)||this.m_paths&&!this.m_paths.equals(n.m_paths,0,r+1)||this.m_bFillRule!==n.m_bFillRule||!this.m_bPolygon&&this.m_pathFlags&&!this.m_pathFlags.equals(n.m_pathFlags,0,r))return!1;if(this.hasNonLinearSegments()){if(!this.m_curveData.m_segmentFlags.equals(n.m_curveData.m_segmentFlags,0,this.getPointCount()))return!1;for(let t=0,r=this.getPointCount();t<r;t++){let r=this.m_curveData.m_segmentFlags.read(t);if(!e.isNonLinearSegmentFlag(r))continue;let i=this.m_curveData.m_segmentParamIndex.read(t),a=n.m_curveData.m_segmentParamIndex.read(t),o=Ni(r);for(let e=0;e<o;e++){let t=this.m_curveData.m_segmentParams.read(i+e),r=n.m_curveData.m_segmentParams.read(a+e);if(!te(t,r))return!1}}}return!0}equalsImplTol(e,t){let n=e,r=this.getPathCount();if(r!==n.getPathCount())return!1;let i=this.hasNonLinearSegments();if(i!==n.hasNonLinearSegments()||i&&(this.m_curveData.m_curveCount!==n.m_curveData.m_curveCount||this.m_curveData.m_bezierCount!==n.m_curveData.m_bezierCount)||this.m_paths&&!this.m_paths.equals(n.m_paths,0,r+1)||this.m_bFillRule!==n.m_bFillRule||!this.m_bPolygon&&this.m_pathFlags&&!this.m_pathFlags.equals(n.m_pathFlags,0,r))return!1;if(!i)return!0;if(!this.m_curveData.m_segmentFlags.equals(n.m_curveData.m_segmentFlags,0,this.getPointCount()))return!1;let a=this.querySegmentIterator(),o=n.querySegmentIterator();for(;a.nextPath();){if(!o.nextPath())return!1;for(;a.hasNextSegment();){let e=a.nextCurve(),n=o.nextCurve();if(!(e&&n&&e.equals(n,t))){if(!e&&!n)break;return!1}}}return!0}reserveImplImpl(e,t){this.m_curveData&&this.m_curveData.m_segmentFlags&&(this.m_curveData.m_segmentFlags.resize(e,1),this.m_curveData.m_segmentParamIndex.resize(e,-1),this.checkCompactSegmentParams())}verifyStreamsAfterSizeChangeExtraImpl(){this.m_paths||(this.m_paths=tn(1,0),this.m_pathFlags=nn(1,0)),this.m_curveData&&this.m_curveData.m_segmentFlags&&(this.m_curveData.m_segmentFlags.resize(this.m_reservedPointCount,1),this.m_curveData.m_segmentParamIndex.resize(this.m_reservedPointCount,-1),this.checkCompactSegmentParams())}copyToImpl(e,t){let n=e;n.m_bPathStarted=!1,n.m_bFillRule=this.m_bFillRule,this.m_paths?n.m_paths=t?this.m_paths:this.m_paths.clone():n.m_paths=null,this.m_pathFlags?n.m_pathFlags=t?this.m_pathFlags:this.m_pathFlags.clone():n.m_pathFlags=null,this.m_curveData&&(n.m_curveData||=new Li,n.m_curveData.assignCopy(this.m_curveData),n.m_curveData.m_curveCount=0,n.updateCurveCounter(this.m_curveData.m_curveCount),t||(this.m_curveData.m_segmentParamIndex?n.m_curveData.m_segmentParamIndex=this.m_curveData.m_segmentParamIndex.clone():n.m_curveData.m_segmentParamIndex=null,this.m_curveData.m_segmentFlags?n.m_curveData.m_segmentFlags=this.m_curveData.m_segmentFlags.clone():n.m_curveData.m_segmentFlags=null,this.m_curveData.m_segmentParams?n.m_curveData.m_segmentParams=this.m_curveData.m_segmentParams.clone():n.m_curveData.m_segmentParams=null)),n.hasDirtyFlag(512)||(n.m_cachedLength2D=this.m_cachedLength2D),n.m_cachedRingAreas2D=null,n.hasDirtyFlag(1024)||(n.m_cachedArea2D=this.m_cachedArea2D,this.m_cachedRingAreas2D!==null&&(n.m_cachedRingAreas2D=t?this.m_cachedRingAreas2D:this.m_cachedRingAreas2D.clone()))}calculateArea2D(){return this.m_bPolygon?(this.updateRingAreas2DProtected(),this.m_cachedArea2D):0}calculateLength2D(){if(!this.hasDirtyFlag(512))return this.m_cachedLength2D;let e=this.querySegmentIterator(),t=new s(0);for(;e.nextPath();)for(;e.hasNextSegment();)t.add(e.nextSegment().calculateLength2D());return this.hasDirtyFlag(512)&&(this.m_cachedLength2D=t.getResult()),this.setDirtyFlagProtected(512,!1),t.getResult()}calculatePathLength2D(e){let t=this.querySegmentIteratorAtVertex(this.getPathStart(e)),n=new s(0);for(;t.hasNextSegment();)n.add(t.nextSegment().calculateLength2D());return n.getResult()}calculateLength3D(e){return U(0),0}calculatePathLength3D(e,t){return U(0),0}copyTo(e){V(e.getGeometryType())||R(``),this!==e&&super.copyTo(e)}swap(e){U(0)}setPointByVal(e,t){this.setPointByValWithCurves(e,t)}setPointByValWithCurves(e,t){if(this.hasNonLinearSegments()){let n=t.getXY();if(this.setXYCoordsWithCurves(e,n.x,n.y),this.m_description.getAttributeCount()===1)return}this.setPointByValNoCurves(e,t)}setXYCoordsWithCurves(t,n,r){if(this.hasNonLinearSegments()){let i=e.getPathIndexFromPointIndexImpl(this.m_paths,this.getPathCount(),t,this.m_currentPathIndex);this.m_currentPathIndex=i;let a=this.getPrevSegmentTypeFromPath(i,t),o=this.getNextSegmentType(t);if(a!==1||o!==1){let e=t-1,s=new Q;a!==1&&(this.isClosedPath(i)&&t===this.getPathStart(i)&&(e=this.getPathEnd(i)-1),this.getSegmentBuffer(e,s,!0));let c=new Q;o!==1&&this.getSegmentBuffer(t,c,!0);let l=t+1;this.setXYCoordsNoCurves(t,n,r);let u=new z(n,r);a!==1&&(s.get().changeEndPoints2D(s.get().getStartXY(),u),this.replaceSegmentImpl(e,t,s.get(),!0)),o!==1&&(c.get().changeEndPoints2D(u,c.get().getEndXY()),this.replaceSegmentImpl(t,l,c.get(),!0));return}}this.setXYCoordsNoCurves(t,n,r)}setXYZWithCurves(e,t){this.hasNonLinearSegments()?(this.setXYCoordsWithCurves(e,t.x,t.y),this.setAttributeNoCurves(1,e,0,t.z)):this.setXYZNoCurves(e,t)}setAttributeWithCurves(e,t,n,r){if(e===0&&this.hasNonLinearSegments()){let e=this.getXY(t);n===0?e.x=r:e.y=r,this.setXYCoordsWithCurves(t,e.x,e.y)}else this.setAttributeNoCurves(e,t,n,r)}setXY(e,t){this.setXYCoordsWithCurves(e,t.x,t.y)}setXYCoords(e,t,n){this.setXYCoordsWithCurves(e,t,n)}setXYZ(e,t){this.setXYZWithCurves(e,t)}setAttribute(e,t,n,r){this.setAttributeWithCurves(e,t,n,r)}setAttributeWithCurvesFromArray(e,t,n,r){if(e===0&&this.hasNonLinearSegments()){r<2&&E(``);let e=this.getXY(t);e.x=n[0],e.y=n[1],this.setXYCoordsWithCurves(t,e.x,e.y)}else this.setAttributeFromArrayNoCurves(e,t,n,r)}setAttributeFromArray(e,t,n,r){this.setAttributeWithCurvesFromArray(e,t,n,r)}hasNonLinearSegments(){return this.getCurveCount()!==0}getSegmentCount(){let e=this.getPointCount();if(!this.m_bPolygon){e-=this.getPathCount();for(let t=0,n=this.getPathCount();t<n;t++)this.isClosedPath(t)&&e++}return e}getSegmentCountPath(e){let t=this.getPathSize(e);return!this.isClosedPath(e)&&t>0&&t--,t}add(e,t){this===e&&R(`Multi_path_impl::add`);for(let n=0,r=e.getPathCount();n<r;n++)this.addPath(e,n,!t)}addPath(e,t,n){this.insertPath(-1,e,t,n)}addPathPoint2D(e,t,n){this.insertPath2D(-1,e,0,t,n)}addPathMultiPoint(e,t,n,r){n<0&&(n=e.getPointCount()-t),this.insertPointsFromMultipoint(-1,0,e,t,n,r)}addSegmentsFromPath(t,n,r,i,a){if(this===t&&R(`Multi_path_impl.add_segments_from_path`),a||this.getPathCount()!==0||(a=!0),n<0&&(n=t.getPathCount()-1),(n>=t.getPathCount()||r<0||i<0||r+i>t.getSegmentCountPath(n))&&E(`add_segments_from_path`),i===0)return;let o=t.getPathStart(n),s=t.isClosedPath(n)&&r+i===t.getSegmentCountPath(n);this.m_bPathStarted=!1,this.mergeVertexDescription(t.getDescription());let c=i,l=o+r,u=l+1;a&&(c++,u--),!a&&t.hasNonLinearSegments()&&t.m_curveData.m_segmentFlags.read(l)!==1&&(t.getXY(l).equals(this.getXY(this.m_pointCount-1))||R(`add_segments_from_path: start point mismatch`));let d=this.m_pointCount;if(this.resizeImpl(this.m_pointCount+c),this.verifyAllStreamsAfterSizeChange(),a){if(c===0)return;this.m_paths.add(this.m_pointCount);let e=t.m_pathFlags.read(n);this.m_bPolygon&&(e|=1),this.m_pathFlags.write(this.m_pathFlags.size()-1,e),this.m_pathFlags.add(0)}else this.m_paths.write(this.m_pathFlags.size()-1,this.m_pointCount);let f=s?c-1:c;for(let e=0,n=this.m_description.getAttributeCount();e<n;e++){let n=this.m_description.getSemantics(e),r=Ii.getComponentCount(n),i=t.m_description.getAttributeIndex(n);if(f>0){if(i<0||!t.m_vertexAttributes.get(i)){let t=Ii.getDefaultValue(n);this.m_vertexAttributes.get(e).insertRange(r*d,t,f*r,r*d),s&&this.m_vertexAttributes.get(e).insertRange(r*d+f*r,t,r,r*d);continue}this.m_vertexAttributes.get(e).insertRangeFromStream(r*d,t.m_vertexAttributes.get(i),r*u,f*r,!0,r,r*d)}s&&this.m_vertexAttributes.get(e).insertRangeFromStream(r*(d+f),t.m_vertexAttributes.get(i),r*o,r,!0,r,r*(d+f))}if(this.hasNonLinearSegments()&&this.initSegmentData(0),t.hasNonLinearSegments()){let n=0;for(let e=0,r=l;e<i;e++)n+=Ni(t.m_curveData.m_segmentFlags.read(r)),r++;if(n>0){this.initSegmentData(n);let r=l,o=d-(a?0:1),s=0;for(let n=0;n<i;n++){let n=t.m_curveData.m_segmentFlags.read(r);if(this.m_curveData.m_segmentFlags.write(o,n),e.isNonLinearSegmentFlag(n)){s++;let e=t.m_curveData.m_segmentParamIndex.read(r),i=Ni(n);this.m_curveData.m_segmentParamIndex.write(o,this.m_curveData.m_curveParamWritePoint);for(let n=0;n<i;n++){let n=t.m_curveData.m_segmentParams.read(e);this.m_curveData.m_segmentParams.write(this.m_curveData.m_curveParamWritePoint,n),this.m_curveData.m_curveParamWritePoint++,e++}this.incCurveType(n,1)}else this.m_curveData.m_segmentParamIndex.write(o,-1);o++,r++}this.modifyCurveCounter(s)}}if(s){let e=this.getPathCount()-1,t=this.getPathStart(e),n=this.getPathEnd(e)-1,r=this.getXY(t),i=this.getXY(n);r.isEqualPoint2D(i)&&(--this.m_pointCount,this.m_paths.write(e+1,this.m_pointCount))}this.notifyModifiedFlags(2001)}reverseAllPaths(){for(let e=0,t=this.getPathCount();e<t;e++)this.reversePath(e)}reversePath(t){t>=this.getPathCount()&&R(``);let n=this.getPathSize(t);if(n===0)return;let r=this.getPathStart(t),i=this.isClosedPath(t);if(this.hasNonLinearSegments()){let t=r,a=new this.m_segmentBufferCTor,o=!1;for(let r=0;r<n;r++,t++){let n=this.m_curveData.m_segmentFlags.read(t);if(!e.isNonLinearSegmentFlag(n))continue;o=!0,this.querySegment(t,a,!0),a.get().reverse();let r=this.m_curveData.m_segmentParamIndex.read(t);a.get().writeInBufferStream(this.m_curveData.m_segmentParams,r)}if(o){let e=i?0:1;this.m_curveData.m_segmentFlags.reverseRange(r,n-e,1),this.m_curveData.m_segmentParamIndex.reverseRange(r,n-e,1)}}let a=i?1:0;for(let e=0,t=this.m_description.getAttributeCount();e<t;e++)if(this.m_vertexAttributes.get(e)){let t=this.m_description.getSemantics(e),i=Ii.getComponentCount(t);this.m_vertexAttributes.get(e).reverseRange(i*(r+a),i*(n-a),i)}let o=6&this.m_pathFlags.read(t);if(o){let e=0;4&o&&(e|=2),2&o&&(e|=4),this.m_pathFlags.clearBits(t,6),this.m_pathFlags.setBits(t,e)}this.notifyModifiedFlags(1233)}removePath(t){let n=this.getPathCount();t<0&&(t=n-1),t>=n&&R(``);let r=this.getPathStart(t),i=this.getPathSize(t);for(let e=0,t=this.m_description.getAttributeCount();e<t;e++)if(this.m_vertexAttributes.get(e)){let t=this.m_description.getSemantics(e),n=Ii.getComponentCount(t);this.m_vertexAttributes.get(e).eraseRange(n*r,n*i,n*this.m_pointCount)}if(this.hasNonLinearSegments()){let t=0;for(let n=r,a=r+i;n<a;n++){let r=this.m_curveData.m_segmentFlags.read(n);e.isNonLinearSegmentFlag(r)&&(this.incCurveType(r,-1),t++)}this.modifyCurveCounter(-t),this.m_curveData.m_segmentFlags.eraseRange(r,i,this.m_pointCount),this.m_curveData.m_segmentParamIndex.eraseRange(r,i,this.m_pointCount)}for(let e=t+1;e<=n;e++){let t=this.m_paths.read(e);this.m_paths.write(e-1,t-i)}if(this.m_pathFlags)for(let e=t+1;e<=n;e++){let t=this.m_pathFlags.read(e);this.m_pathFlags.write(e-1,t)}this.m_paths.resize(n),this.m_pathFlags.resize(n),this.m_pointCount-=i,this.m_reservedPointCount-=i,t===n-1&&(this.m_bPathStarted=!1),this.notifyModifiedFlags(2001),this.checkCompactSegmentParams(),this.dbgVerifyCurves()}dbgVerifyCurves(){}insertPath(t,n,r,i){this===n&&R(`Multi_path_impl::insert_path`);let a=this.getPathCount();if(!i&&n.hasNonLinearSegmentsPath(r))return t=this.insertPath(t,n,r,!0),this.reversePath(t),t;r>=n.getPathCount()&&R(``),t>a&&R(``),t<0&&(t=a),r<0&&(r=n.getPathCount()-1),this.m_bPathStarted=!1,this.mergeVertexDescription(n.getDescription());let o=n.getPathStart(r),s=n.getPathSize(r);if(s===0)return this.insertPath2D(t,null,0,0,!0);let c=this.m_pointCount,l=n.isClosedPath(r)&&!i?1:0;this.resizeImpl(this.m_pointCount+s),this.verifyAllStreamsAfterSizeChange();let u=t<a?this.getPathStart(t):c;for(let e=0,t=this.m_description.getAttributeCount();e<t;e++){let t=this.m_description.getSemantics(e),r=n.getDescription().getAttributeIndex(t),a=Ii.getComponentCount(t);if(r>=0&&n.m_vertexAttributes.get(r))l!==0&&this.m_vertexAttributes.get(e).insertRangeFromStream(u*a,n.m_vertexAttributes.get(r),a*o,a,!0,a,a*c),this.m_vertexAttributes.get(e).insertRangeFromStream((u+l)*a,n.m_vertexAttributes.get(r),a*(o+l),a*(s-l),i,a,a*(c+l));else{let n=Ii.getDefaultValue(t);this.m_vertexAttributes.get(e).insertRange(u*a,n,a*s,a*c)}}let d=c+s;this.m_paths.add(d);for(let e=a;e>=t+1;e--){let t=this.m_paths.read(e-1);this.m_paths.write(e,t+s)}this.m_pathFlags.add(0);for(let e=a-1;e>=t+1;e--){let t=this.m_pathFlags.read(e);t&=-9,this.m_pathFlags.write(e+1,t)}let f=n.getPathFlagsStreamRef().read(r);if(f&=-9,this.m_bPolygon&&(f|=1),this.m_pathFlags.write(t,f),n.hasNonLinearSegments()){this.initSegmentData(0);let t=o,r=0;for(let e=0;e<s;e++)r+=Ni(n.m_curveData.m_segmentFlags.read(t)),t++;if(r>0){this.m_curveData.m_segmentFlags===null?(this.m_curveData.m_segmentFlags=nn(this.m_pointCount,1),this.m_curveData.m_segmentParamIndex=tn(this.m_pointCount,-1)):(this.m_curveData.m_segmentFlags.insertRange(u,1,s,c),this.m_curveData.m_segmentParamIndex.insertRange(u,-1,s,c)),this.m_curveData.m_segmentParams?this.m_curveData.m_segmentParams.resize(this.m_curveData.m_curveParamWritePoint+r):this.m_curveData.m_segmentParams=rn(r),t=o;let i=u,a=0;for(let r=0;r<s;r++){let r=n.m_curveData.m_segmentFlags.read(t);if(e.isNonLinearSegmentFlag(r)){this.m_curveData.m_segmentFlags.write(i,r),this.m_curveData.m_segmentParamIndex.write(i,this.m_curveData.m_curveParamWritePoint);let e=Ni(r),o=n.m_curveData.m_segmentParamIndex.read(t);for(let t=0;t<e;t++){let e=n.m_curveData.m_segmentParams.read(o);this.m_curveData.m_segmentParams.write(this.m_curveData.m_curveParamWritePoint,e),this.m_curveData.m_curveParamWritePoint++,o++}a++,this.incCurveType(r,1)}t++,i++}this.modifyCurveCounter(a)}}return this.notifyModifiedFlags(2001),t}insertPath2D(e,t,n,r,i){let a=this.getPathCount();(e>a||n<0)&&R(``),e<0&&(e=a),this.m_bPathStarted=!1;let o=this.m_pointCount;this.resizeImpl(this.m_pointCount+r),r===0&&this.notifyModifiedFlags(32),this.verifyAllStreamsAfterSizeChange();let s=e<a?this.getPathStart(e):o;if(t)this.m_vertexAttributes.get(0).insertRangeFromPoints(2*s,t,n,r,i,2*o);else{let e=Ii.getDefaultValue(0);this.m_vertexAttributes.get(0).insertRange(2*s,e,2*r,2*o)}for(let e=1,t=this.m_description.getAttributeCount();e<t;e++){let t=this.m_description.getSemantics(e),n=Ii.getComponentCount(t),i=Ii.getDefaultValue(t);this.m_vertexAttributes.get(e).insertRange(s*n,i,n*r,n*o)}this.m_paths.add(this.m_pointCount);for(let t=a;t>=e+1;t--){let e=this.m_paths.read(t-1);this.m_paths.write(t,e+r)}this.m_pathFlags.add(0);for(let t=a-1;t>=e+1;t--){let e=this.m_pathFlags.read(t);e&=-9,this.m_pathFlags.write(t+1,e)}return this.m_bPolygon&&this.m_pathFlags.write(e,1),this.hasNonLinearSegments()&&(this.m_curveData.m_segmentFlags.insertRange(s,1,r,o),this.m_curveData.m_segmentParamIndex.insertRange(s,-1,r,o)),this.notifyModifiedFlags(2001),e}insertPathFromMultipoint(e,t,n,r,i){let a=t.getImpl(),o=this.getPathCount();(e>o||n<0)&&R(``);let s=r<0?a.getPointCount()-n:r;if(s>a.getPointCount()&&R(``),n>=a.getPointCount()&&R(`pointsOffset`),e<0&&(e=o),this.m_bPathStarted=!1,this.mergeVertexDescription(a.getDescription()),s===0)return void this.insertPath2D(e,null,0,0,!0);let c=this.m_pointCount,l=n;this.resizeImpl(this.m_pointCount+s),this.verifyAllStreamsAfterSizeChange();let u=e<o?this.getPathStart(e):c;for(let e=0,t=this.m_description.getAttributeCount();e<t;e++){let t=this.m_description.getSemantics(e),n=a.getDescription().getAttributeIndex(t),r=Ii.getComponentCount(t);if(n>=0){let n=a.getAttributeStreamRef(t);this.m_vertexAttributes.get(e).insertRangeFromStream(u*r,n,r*l,r*s,i,r,r*c)}else{let n=Ii.getDefaultValue(t);this.m_vertexAttributes.get(e).insertRange(u*r,n,r*s,r*c)}}let d=c+s;this.m_paths.add(d);for(let t=o;t>=e+1;t--){let e=this.m_paths.read(t-1);this.m_paths.write(t,e+s)}this.m_pathFlags.add(0);for(let t=o-1;t>=e+1;t--){let e=this.m_pathFlags.read(t);e&=-9,this.m_pathFlags.write(t+1,e)}let f=0;this.m_bPolygon&&(f|=1),this.m_pathFlags.write(e,f),this.notifyModifiedFlags(2001)}insertPoints(e,t,n,r,i,a,o){if(this===n&&R(`Multi_path_impl.insert_points`),e<0&&(e=this.getPathCount()),r<0&&(r=n.getPathCount()-1),(e>this.getPathCount()||t>=0&&t>this.getPathSize(e)||r>=n.getPathCount()||a>n.getPathSize(r))&&E(``),!a)return;if(this.mergeVertexDescription(n.m_description),e===this.getPathCount()){this.m_paths.add(this.m_pointCount);let e=n.m_pathFlags.read(r);e&=-9,this.m_bPolygon?this.m_pathFlags.add(1|e):this.m_pathFlags.add(e)}t<0&&(t=this.getPathSize(e));let s=this.m_pointCount;this.resizeImpl(this.m_pointCount+a),this.verifyAllStreamsAfterSizeChange();let c=this.getPathStart(e),l=c+t;a<0&&(a=n.getPathSize(r));let u=n.getPathStart(r),d=u+a;for(let e=0,r=this.m_description.getAttributeCount();e<r;e++){let r=this.m_description.getSemantics(e),f=Ii.getComponentCount(r),p=n.m_description.getAttributeIndex(r);if(p<0||!n.m_vertexAttributes.get(p)){let t=Ii.getDefaultValue(r);this.m_vertexAttributes.get(e).insertRange(f*l,t,d*f,f*s);continue}this.m_vertexAttributes.get(e)?.insertRangeFromStream(f*(c+t),n.m_vertexAttributes.get(p),f*(u+i),a*f,o,f,f*s)}this.hasNonLinearSegments()&&(this.m_curveData.m_segmentFlags.insertRange(c+t,1,a,s),this.m_curveData.m_segmentParamIndex.insertRange(c+t,-1,a,s),t>0&&this.isNonLinearSegment(c+t-1)&&(this.incCurveType(this.m_curveData.m_segmentFlags.read(c+t-1),-1),this.m_curveData.m_segmentFlags.write(c+t-1,1),this.m_curveData.m_segmentParamIndex.write(c+t-1,-1),this.modifyCurveCounter(-1)));for(let t=e+1,n=this.getPathCount();t<=n;t++){let e=this.m_paths.read(t);this.m_paths.write(t,e+a)}this.notifyModifiedFlags(2001)}insertPointsFromPoints(e,t,n,r,i,a){if(e<0&&(e=this.getPathCount()),(e>this.getPathCount()||t>this.getPathSize(e)||r<0)&&E(``),!i)return;e===this.getPathCount()&&(this.m_paths.add(this.m_pointCount),this.m_bPolygon?this.m_pathFlags.add(1):this.m_pathFlags.add(0)),t<0&&(t=this.getPathSize(e));let o=this.m_pointCount;this.resizeImpl(this.m_pointCount+i),this.verifyAllStreamsAfterSizeChange();let s=this.getPathStart(e);this.m_vertexAttributes.get(0).insertRangeFromPoints(2*(s+t),n,r,i,a,2*o);for(let e=1,n=this.m_description.getAttributeCount();e<n;e++){let n=this.m_description.getSemantics(e),r=Ii.getComponentCount(n),a=Ii.getDefaultValue(n);this.m_vertexAttributes.get(e).insertRange((s+t)*r,a,r*i,r*o)}this.hasNonLinearSegments()&&(this.m_curveData.m_segmentFlags.insertRange(s+t,1,i,o),this.m_curveData.m_segmentParamIndex.insertRange(s+t,-1,i,o),t>0&&this.isNonLinearSegment(s+t-1)&&(this.incCurveType(this.m_curveData.m_segmentFlags.read(s+t-1),-1),this.m_curveData.m_segmentFlags.write(s+t-1,1),this.m_curveData.m_segmentParamIndex.write(s+t-1,-1),this.modifyCurveCounter(-1)));for(let t=e+1,n=this.getPathCount();t<=n;t++)this.m_paths.write(t,this.m_paths.read(t)+i);this.notifyModifiedFlags(2001)}insertPointsFromMultipoint(e,t,n,r,i,a){let o=n.getImpl(),s=this.getPathCount();e<0&&(e=this.getPathCount());let c=o.getPointCount();if((r<0||r>c)&&E(``),(i<0||r+i>c)&&(i=c-r),t<0&&(t=e<s?this.getPathSize(e):0),(e>s||e<s&&t>this.getPathSize(e)||e===s&&t>0||i<0)&&E(``),!i)return;this.mergeVertexDescription(o.getDescription()),e===s&&(this.m_paths.add(this.m_pointCount),this.m_bPolygon?this.m_pathFlags.add(1):this.m_pathFlags.add(0)),t<0&&(t=this.getPathSize(e));let l=this.m_pointCount;this.resizeImpl(this.m_pointCount+i),this.verifyAllStreamsAfterSizeChange();let u=this.getPathStart(e),d=u+t,f=0+i;for(let e=0,n=this.m_description.getAttributeCount();e<n;e++){let n=this.m_description.getSemantics(e),s=Ii.getComponentCount(n);if(o.getDescription().getAttributeIndex(n)<0){let t=Ii.getDefaultValue(n);this.m_vertexAttributes.get(e).insertRange(s*d,t,f*s,s*l);continue}let c=o.getAttributeStreamRef(n);this.m_vertexAttributes.get(e).insertRangeFromStream(s*(u+t),c,s*(0+r),i*s,a,s,s*l)}this.hasNonLinearSegments()&&(this.m_curveData.m_segmentFlags.insertRange(u+t,1,i,l),this.m_curveData.m_segmentParamIndex.insertRange(u+t,-1,i,l),t>0&&this.isNonLinearSegment(u+t-1)&&(this.incCurveType(this.m_curveData.m_segmentFlags.read(u+t-1),-1),this.m_curveData.m_segmentFlags.write(u+t-1,1),this.m_curveData.m_segmentParamIndex.write(u+t-1,-1),this.modifyCurveCounter(-1)));for(let t=e+1,n=this.getPathCount();t<=n;t++){let e=this.m_paths.read(t);this.m_paths.write(t,e+i)}this.notifyModifiedFlags(2001)}insertPoint2D(e,t,n){let r=this.getPathCount();e<0&&(e=r),(e>r||e<r&&t>this.getPathSize(e))&&E(``),e===r&&this.addPathPoint2D(null,0,!0);let i=this.m_pointCount;this.resizeImpl(this.m_pointCount+1),this.verifyAllStreamsAfterSizeChange();let a=this.getPathStart(e),o=t<0?this.getPathSize(e)+a:t+a,s=this.m_vertexAttributes.get(0);if(o===i)this.m_paths.write(e+1,i+1),s.writePoint2D(2*o,n);else{s.insert(2*o,n,2*i);for(let e=1,t=this.m_description.getAttributeCount();e<t;e++){let t=this.m_description.getSemantics(e),n=Ii.getComponentCount(t),r=Ii.getDefaultValue(t);this.m_vertexAttributes.get(e).insertRange(n*o,r,n,n*i)}this.m_curveData&&this.m_curveData.m_segmentFlags&&(this.m_curveData.m_segmentFlags.insertRange(o,1,1,i),this.m_curveData.m_segmentParamIndex.insertRange(o,-1,1,i));for(let t=e+1,n=r;t<=n;t++)this.m_paths.write(t,this.m_paths.read(t)+1)}this.m_curveData&&this.m_curveData.m_segmentFlags&&o>a&&this.isNonLinearSegment(o-1)&&(this.incCurveType(this.m_curveData.m_segmentFlags.read(o-1),-1),this.modifyCurveCounter(-1),this.m_curveData.m_segmentFlags.write(o-1,1),this.m_curveData.m_segmentParamIndex.write(o-1,-1)),this.notifyModifiedFlags(2001)}insertPoint(e,t,n){let r=this.getPathCount();e<0&&(e=r),(e>r||e<r&&t>this.getPathSize(e))&&E(``),e===r&&this.addPathPoint2D(null,0,!0);let i=this.m_pointCount;this.resizeImpl(this.m_pointCount+1),this.verifyAllStreamsAfterSizeChange();let a=this.getPathStart(e),o=t<0?this.getPathSize(e)+a:t+a;if(o===i)this.m_paths.write(e+1,i+1),this.setPointByValNoCurves(o,n);else{let t=n.getDescription();this.m_description!==t&&this.mergeVertexDescription(t);for(let e=0,r=this.m_description.getAttributeCount();e<r;e++){let r=this.m_description.getSemantics(e),a=Ii.getComponentCount(r);if(t.hasAttribute(r))this.m_vertexAttributes.get(e).insertAttributes(a*o,n,r,a*i);else{let t=Ii.getDefaultValue(r);this.m_vertexAttributes.get(e).insertRange(a*o,t,a,a*i)}}this.m_curveData&&this.m_curveData.m_segmentFlags&&(this.m_curveData.m_segmentFlags.insertRange(o,1,1,i),this.m_curveData.m_segmentParamIndex.insertRange(o,-1,1,i));for(let t=e+1,n=r;t<=n;t++)this.m_paths.write(t,this.m_paths.read(t)+1)}this.m_curveData&&this.m_curveData.m_segmentFlags&&o>a&&this.isNonLinearSegment(o-1)&&(this.incCurveType(this.m_curveData.m_segmentFlags.read(o-1),-1),this.modifyCurveCounter(-1),this.m_curveData.m_segmentFlags.write(o-1,1),this.m_curveData.m_segmentParamIndex.write(o-1,-1)),this.notifyModifiedFlags(2001)}removePointFromPath(e,t){let n=this.getPathCount();e<0&&(e=n-1),(e>=n||t>=this.getPathSize(e))&&E(`Multi_path.remove_point`);let r=this.getPathStart(e),i=this.isClosedPath(e);t<0&&(t=this.getPathSize(e)-1),t<0&&E(`Multi_path.remove_point`);let a=r+t;for(let e=0,t=this.m_description.getAttributeCount();e<t;e++)if(this.m_vertexAttributes.get(e)){let t=this.m_description.getSemantics(e),n=Ii.getComponentCount(t);this.m_vertexAttributes.get(e).eraseRange(n*a,n,n*this.m_pointCount)}if(this.m_curveData&&this.m_curveData.m_segmentFlags){this.checkCompactSegmentParams();let t=0;if(a>r&&this.isNonLinearSegment(a-1))t+=1,this.incCurveType(this.m_curveData.m_segmentFlags.read(a-1),-1),this.m_curveData.m_segmentFlags.write(a-1,1),this.m_curveData.m_segmentParamIndex.write(a-1,-1);else{let n=this.getPathEnd(e);i&&r+1<n&&this.isNonLinearSegment(n-1)&&(this.incCurveType(this.m_curveData.m_segmentFlags.read(n-1),-1),this.m_curveData.m_segmentFlags.write(n-1,1),this.m_curveData.m_segmentParamIndex.write(n-1,-1),t+=1)}this.isNonLinearSegment(a)&&(this.incCurveType(this.m_curveData.m_segmentFlags.read(a),-1),t+=1),t>0&&this.modifyCurveCounter(-t),this.m_curveData.m_segmentFlags.eraseRange(a,1,this.m_pointCount),this.m_curveData.m_segmentParamIndex.eraseRange(a,1,this.m_pointCount)}for(let t=n;t>=e+1;t--){let e=this.m_paths.read(t);this.m_paths.write(t,e-1)}this.m_pointCount--,this.m_reservedPointCount--,this.notifyModifiedFlags(2001)}removePoint(e){let t;t=e<0?this.getPathCount()-1:this.getPathIndexFromPointIndex(e),this.removePointFromPath(t,e-this.getPathStart(t))}getNextSegmentType(e){return this.hasNonLinearSegments()?this.m_curveData.m_segmentFlags.read(e):1}getPrevSegmentTypeFromPath(e,t){if(!this.hasNonLinearSegments())return 1;let n=this.getPathStart(e);if(t>n)return this.m_curveData.m_segmentFlags.read(t-1);if(t===n){if(this.isClosedPath(e)){let t=this.getPathEnd(e);return this.m_curveData.m_segmentFlags.read(t-1)}return 1}B(``)}getNumberOfCurves(t){if(!this.hasNonLinearSegments())return 0;let n=0;for(let r=this.getPathStart(t),i=this.getPathEnd(t);r<i;r++)e.isNonLinearSegmentFlag(this.m_curveData.m_segmentFlags.read(r))&&++n;return n}getPathCount(){return this.m_paths?this.m_paths.size()-1:0}getPathSize(e){return this.m_paths.read(e+1)-this.m_paths.read(e)}getPathStart(e){return this.m_paths.read(e)}getPathEnd(e){return this.m_paths.read(e+1)}getPathIndexFromPointIndex(t,n=-1){n===-1&&(n=this.m_currentPathIndex);let r=this.getPathCount(),i=e.getPathIndexFromPointIndexImpl(this.m_paths,r,t,n);return this.m_currentPathIndex=i,i}startPathCoords(e,t){this.startPathPoint(new q({x:e,y:t}))}startPath(e){this.startPathPoint(new q({pt:e}))}startPath3D(e){this.startPathPoint(new q({x:e.x,y:e.y,z:e.z}))}startPath3DCoords(e,t,n){this.startPathPoint(new q({x:e,y:t,z:n}))}startPathPoint(e){e.isEmpty()&&R(``);let t=e.getDescription(),n;if(this.m_description!==t){this.mergeVertexDescription(t);let r=new q({vd:this.m_description});e.copyCommonAttributesTo(r),n=r}else n=e;this.m_bPathStarted?this.setPointByValNoCurves(this.m_pointCount-1,n):(this.insertPoint(-1,-1,n),this.m_bPathStarted=!0)}beforeNewSegmentHelper2(){this.m_paths=tn(2),this.m_paths.write(0,0),this.m_pathFlags=nn(2,0),this.m_bPolygon&&this.m_pathFlags.write(0,1)}beforeNewSegmentHelper1(){this.m_paths===null?this.beforeNewSegmentHelper2():(this.m_paths.add(0),this.m_pathFlags.add(0),this.m_bPolygon&&this.m_pathFlags.write(this.m_pathFlags.size()-2,1))}beforeNewSegment(e){this.m_pointCount!==0||this.m_bPathStarted||this.startPathCoords(0,0);let t=this.m_pointCount,n=this.m_paths.size()-1,r=t+e;this.m_paths.write(n,r),this.resizeImpl(r),this.m_bPathStarted&&=!1}finishLineTo(){if(this.hasNonLinearSegments()){let e=this.m_curveData.m_segmentFlags.read(this.m_pointCount-1);e!==1&&(this.m_curveData.m_segmentFlags.write(this.m_pointCount-1,1),this.m_curveData.m_segmentParamIndex.write(this.m_pointCount-1,-1),this.modifyCurveCounter(-1),this.incCurveType(e,-1))}}lineToCoords(e,t){if(this.beforeNewSegment(1),this.m_description.getAttributeCount()===1)this.setXYCoordsNoCurves(this.m_pointCount-1,e,t);else{let n=Lt(),r=new q({vd:this.m_description,attribBuffer:n,initDefaultValues:!0});r.setXYCoords(e,t),this.setPointByValNoCurves(this.m_pointCount-1,r)}this.finishLineTo()}lineTo(e){this.lineToCoords(e.x,e.y)}lineTo3D(e){this.beforeNewSegment(1);let t=Ut(this.m_description,qt()),n=Lt(),r=new q({vd:t,attribBuffer:n,initDefaultValues:!0});r.setXYZ(e),this.setPointByValNoCurves(this.m_pointCount-1,r),this.finishLineTo()}lineTo3DCoords(e,t,n){this.lineTo3D(new K(e,t,n))}lineToPoint(e){if(this.beforeNewSegment(1),this.m_description===e.getDescription())this.setPointByValNoCurves(this.m_pointCount-1,e);else{this.mergeVertexDescription(e.getDescription());let t=Lt(),n=new q({vd:this.m_description,attribBuffer:t,initDefaultValues:!1});e.copyCommonAttributesTo(n),this.setPointByValNoCurves(this.m_pointCount-1,n)}this.finishLineTo()}openPathAndDuplicateStartVertex(e){this.m_bPolygon&&B(``);let t=this.getPathCount();if(e>t&&R(``),!this.isClosedPath(e))return;this.m_pathFlags||B(``);let n=this.m_pointCount,r=this.getPathStart(e),i=this.getPathEnd(e);if(i-r!==0){this.resizeImpl(this.m_pointCount+1),this.verifyAllStreamsAfterSizeChange();for(let e=0,t=this.m_description.getAttributeCount();e<t;e++)if(this.m_vertexAttributes.get(e)){let t=this.m_description.getSemantics(e),a=Ii.getComponentCount(t);this.m_vertexAttributes.get(e).insertRangeFromStream(a*i,this.m_vertexAttributes.get(e),a*r,a,!0,1,a*n)}for(let n=t;n>e;n--){let e=this.m_paths.read(n);this.m_paths.write(n,e+1)}this.hasNonLinearSegments()&&(this.m_curveData.m_segmentFlags.insertRange(i,1,1,n),this.m_curveData.m_segmentParamIndex.insertRange(i,-1,1,n)),this.m_pathFlags.clearBits(e,1)}}openPath(e){this.m_bPolygon&&B(``),e>this.getPathCount()&&R(``),this.m_pathFlags||B(``),this.m_pathFlags.clearBits(e,1)}isStrongPathStart(e){return!!(2&this.m_pathFlags.read(e))}setStrongPathStart(e,t){t?this.m_pathFlags.setBits(e,2):this.m_pathFlags.clearBits(e,2)}isStrongPathEnd(e){return!!(4&this.m_pathFlags.read(e))}setStrongPathEnd(e,t){t?this.m_pathFlags.setBits(e,4):this.m_pathFlags.clearBits(e,4)}clearStrongPathEnds(){for(let e=0,t=this.getPathCount();e<t;++e)this.m_pathFlags.clearBits(e,6)}openAllPathsAndDuplicateStartVertex(){if(this.m_bPolygon&&B(``),this.isEmpty())return;this.m_pathFlags||B(``);let e=0,t=this.getPathCount();for(let n=0;n<t;n++)this.isClosedPath(n)&&(this.getPathSize(n)>0?e++:this.m_pathFlags.clearBits(n,1));if(e===0)return;let n=this.hasNonLinearSegments(),r=0,i=this.getPathCount(),a=this.m_description.getAttributeCount(),o=Array(a),s=null,c=null;for(let t=0;t<i;++t){let i=this.getPathStart(t),l=this.getPathSize(t),u=this.isClosedPath(t);if(l>0){let t=i+r;for(let n=0;n<a;n++)if(this.m_vertexAttributes.get(n)){let r=this.m_description.getSemantics(n),a=Ii.getComponentCount(r);if(!o[n]){let t=a*(this.m_pointCount+e);o[n]=en(r,t)}o[n].writeRange(t*a,l*a,this.m_vertexAttributes.get(n),i*a,!0,1),u&&o[n].writeRange((t+l)*a,a,this.m_vertexAttributes.get(n),i*a,!0,1)}if(n){if(s===null){let t=this.m_pointCount+e;s=nn(t),c=tn(t)}s.writeRange(t,l,this.m_curveData.m_segmentFlags,i,!0,1),c.writeRange(t,l,this.m_curveData.m_segmentParamIndex,i,!0,1),u&&(s.write(t+l,1),c.write(t+l,-1))}}this.m_paths.write(t,i+r),u&&(this.m_pathFlags.clearBits(t,1),++r)}this.m_paths.write(i,this.m_pointCount+e),this.m_pathFlags.clearBits(i,1);for(let e=0;e<a;e++)this.m_vertexAttributes.get(e)&&this.m_vertexAttributes.set(e,o[e]);n&&(this.m_curveData.m_segmentFlags=s,this.m_curveData.m_segmentParamIndex=c),this.m_pointCount+=e,this.m_reservedPointCount>0&&(this.m_reservedPointCount=this.m_pointCount)}closePathWithLine(e){e===void 0&&(e=this.getPathCount()-1),this.throwIfEmpty(),(e<0||e>=this.getPathCount())&&R(`close_path_with_line`),e===this.getPathCount()-1&&(this.m_bPathStarted=!1);let t=this.m_pathFlags.read(e);if(1&t||this.m_pathFlags.write(e,1|t),this.m_curveData&&this.m_curveData.m_segmentFlags){let t=this.getPathEnd(e)-1,n=this.m_curveData.m_segmentFlags.read(t);n!==1&&(this.m_curveData.m_segmentFlags.write(t,1),this.m_curveData.m_segmentParamIndex.write(t,-1),this.incCurveType(n,-1),this.modifyCurveCounter(-1))}this.notifyModifiedFlags(2001)}closeLastPathWithSegment(e){this.closePathWithSegment(this.getPathCount()-1,e)}closePathWithSegment(e,t){if(this.throwIfEmpty(),(e<0||e>=this.getPathCount())&&R(`close_path_with_line`),t.getEndXY().equals(this.getXY(this.getPathStart(e)))||R(`close_path_with_segment: end point mismatch`),e===this.getPathCount()-1)this.m_bPathStarted=!1,this.addSegment(t,!1),--this.m_pointCount,this.m_paths.write(e+1,this.m_pointCount);else{this.mergeVertexDescription(t.getDescription());let n=t.getStartXY(),r=this.getPathEnd(e)-1;n.equals(this.getXY(r))||R(`close_path_with_segment: start point mismatch`);let i=t.getGeometryType();if(i===L.enumLine)return void this.closePathWithLine(e);{let e=Mi(t);this.initSegmentData(e);let n=Li.toSegType(i),a=this.m_curveData.m_segmentFlags.read(r);if(a!==n)this.m_curveData.m_segmentParamIndex.write(r,this.m_curveData.m_curveParamWritePoint),t.writeInBufferStream(this.m_curveData.m_segmentParams,this.m_curveData.m_curveParamWritePoint),this.m_curveData.m_curveParamWritePoint+=e,this.incCurveType(n,1),a===1?this.modifyCurveCounter(1):this.incCurveType(a,-1);else{let e=this.m_curveData.m_segmentParamIndex.read(r);t.writeInBufferStream(this.m_curveData.m_segmentParams,e)}this.m_curveData.m_segmentFlags.write(r,n)}}let n=this.m_pathFlags.read(e);1&n||this.m_pathFlags.write(e,1|n),this.notifyModifiedFlags(2001)}closeAllPaths(){if(this.m_bPolygon||this.isEmptyImpl())return;this.m_bPathStarted=!1;let e=!1;for(let t=0,n=this.m_paths.size()-1;t<n;t++){if(this.isClosedPath(t))continue;let n=this.m_pathFlags.read(t);this.m_pathFlags.write(t,1|n),e=!0}e&&this.notifyModifiedFlags(512)}isClosedPath(e){return!!(1&this.m_pathFlags.read(e))}isClosedPathInXYPlane(e){if(this.isClosedPath(e))return!0;let t=this.getPathStart(e),n=this.getPathEnd(e)-1;if(t>n)return!1;let r=this.getXY(t),i=this.getXY(n);return r.isEqualPoint2D(i)}isClosedPathIn3D(e){return U(0),!1}hasNonLinearSegmentsPath(t){if(!this.hasNonLinearSegments())return!1;for(let n=this.getPathStart(t),r=this.getPathEnd(t);n<r;n++)if(e.isNonLinearSegmentFlag(this.m_curveData.m_segmentFlags.read(n)))return!0;return!1}isNonLinearSegment(e){return!(1&this.getSegmentFlags(e))}addEnvelope(e,t){if(e.isEmpty())return;let n=this.m_pointCount===0;if(e instanceof G)this.startPathCoords(e.xmin,e.ymin),t?(this.lineToCoords(e.xmax,e.ymin),this.lineToCoords(e.xmax,e.ymax),this.lineToCoords(e.xmin,e.ymax)):(this.lineToCoords(e.xmin,e.ymax),this.lineToCoords(e.xmax,e.ymax),this.lineToCoords(e.xmax,e.ymin));else{let n=e.getDescription(),r=Lt(),i=new q({vd:n,attribBuffer:r,initDefaultValues:!1});for(let n=0;n<4;n++){let r=t?4-n-1:n;e.queryCornerByVal(r,i),n===0?this.startPathPoint(i):this.lineToPoint(i)}}this.closePathWithLine(),this.m_bPathStarted=!1,n&&!t&&(this.setDirtyFlagProtected(256,!1),this.m_bPolygon&&Math.min(e.width(),e.height())>0&&this.setIsSimple(3,0))}addPathFromClosedSegment(e,t){if(e.isClosed()||R(`add_path_from_closedSegment: segment must be closed`),t){let t=e.getReversed(),n=new q;t.queryStart(n),this.startPathPoint(n),this.closeLastPathWithSegment(t)}else{let t=new q;e.queryStart(t),this.startPathPoint(t),this.closeLastPathWithSegment(e)}}addSegment_(e,t){let n=e.getDescription();this.mergeVertexDescription(n);let r=Lt(),i=new q({vd:n,attribBuffer:r,initDefaultValues:!1}),a=e.getGeometryType();if(a===L.enumLine)(t||this.isEmptyImpl())&&(e.queryStart(i),this.startPathPoint(i)),e.queryEnd(i),this.lineToPoint(i);else{let n=!1;if((t||this.isEmptyImpl())&&(n=!0),!n&&(e.getStartXY().equals(this.getXY(this.m_pointCount-1))||R(`add_segment: start point mismatch`)),n&&(e.queryStart(i),this.startPathPoint(i)),this.beforeNewSegment(1),e.queryEnd(i),i.getDescription()===this.m_description)this.setPointByVal(this.m_pointCount-1,i);else{let e=Lt(),t=new q({vd:this.m_description,attribBuffer:e,initDefaultValues:!1});i.copyCommonAttributesTo(t),this.setPointByVal(this.m_pointCount-1,t)}let r=Mi(e);this.initSegmentData(r),this.m_curveData.m_segmentParamIndex.write(this.m_pointCount-2,this.m_curveData.m_curveParamWritePoint),e.writeInBufferStream(this.m_curveData.m_segmentParams,this.m_curveData.m_curveParamWritePoint),this.m_curveData.m_curveParamWritePoint+=r;let o=Li.toSegType(a);this.incCurveType(o,1),this.modifyCurveCounter(1),this.m_curveData.m_segmentFlags.write(this.m_pointCount-2,o)}}addSegment(e,t,n){n?t?this.addPathFromClosedSegment(e,!1):this.closeLastPathWithSegment(e):this.addSegment_(e,t)}interpolateAttributesRange(e,t,n,r){for(let t=e;t<n-1;t++)this.isClosedPath(t)&&R(`cannot interpolate across closed paths`);let i=this.m_description.getAttributeCount();if(i===1)return;let a=this.calculateSubLength2D(e,t,n,r);if(a!==0)for(let o=1;o<i;o++){let i=this.m_description.getSemantics(o);this.interpolateAttributesSemanticsImpl(i,e,t,n,r,a)}}interpolateAttributesSemantics(e,t,n,r,i){if(e===0)return;this.hasAttribute(e)||R(`does not have the given attribute`),Ii.getInterpolation(e)===2&&R(`angular interpolation`);for(let e=t;e<r-1;e++)this.isClosedPath(e)&&R(`cannot interpolate across closed paths`);let a=this.calculateSubLength2D(t,n,r,i);a!==0&&this.interpolateAttributesSemanticsImpl(e,t,n,r,i,a)}interpolateAttributesPath(e,t,n){let r=this.m_description.getAttributeCount();if(r===1||t===n)return;let i=this.calculatePathSubLength2D(e,t,n);for(let a=1;a<r;a++){let r=this.m_description.getSemantics(a);this.interpolateAttributesSemanticsPathImpl(r,e,t,n,i)}}interpolateAttributesSemanticsPath(e,t,n,r){if(e===0)return;this.hasAttribute(e)||R(`does not have the given attribute`),Ii.getInterpolation(e)===2&&R(`angular interpolation`);let i=this.calculatePathSubLength2D(t,n,r);i!==0&&this.interpolateAttributesSemanticsPathImpl(e,t,n,r,i)}interpolateAttributesSemanticsImpl(e,t,n,r,i,a){let o=this.querySegmentIterator(),s=this.getPathStart(t)+n,c=this.getPathStart(r)+i,l=Ii.getComponentCount(e),u=H(Ii.maxComponentCount(),NaN);this.queryAttributeAsDbl(e,s,u,l);let d=H(Ii.maxComponentCount(),NaN);this.queryAttributeAsDbl(e,c,d,l);let f=H(Ii.maxComponentCount(),NaN);Qe(f,u,0,0,l);let p=0,m=Ii.getDefaultValue(e),h=Ii.getInterpolation(e);o.resetToVertex(s,t);do if(o.hasNextSegment()){if(o.nextSegment(),o.getStartPointIndex()===c)return;this.setAttributeFromArray(e,o.getStartPointIndex(),f,l),o.previousSegment();do{let t=o.nextSegment();if(o.getEndPointIndex()===c)return;p+=t.calculateLength2D(),S(h,u,d,f,0,l,p/a,m),o.isClosingSegment()||this.setAttributeFromArray(e,o.getEndPointIndex(),f,l)}while(o.hasNextSegment())}while(o.nextPath())}interpolateAttributesSemanticsPathImpl(e,t,n,r,i){U(e!==0);let a=this.querySegmentIterator(),o=Ii.getInterpolation(e),c=this.getPathStart(t)+n,l=this.getPathStart(t)+r;if(l===c)return;let u=Ii.getComponentCount(e),d=H(Ii.maxComponentCount(),NaN);this.queryAttributeAsDbl(e,c,d,u);let f=H(Ii.maxComponentCount(),NaN);this.queryAttributeAsDbl(e,l,f,u);let p=new s(0);a.resetToVertex(c,t),a.setCirculator(this.isClosedPath(t));let m=Ii.getDefaultValue(e),h=H(Ii.maxComponentCount(),NaN);Qe(h,d,0,0,u);let g=i===0,_=.5;do{let t=a.nextSegment();if(this.setAttributeFromArrayNoCurves(e,a.getStartPointIndex(),h,u),!g){let e=t.calculateLength2D();p.pe(e),_=p.getResult()/i}S(o,d,f,h,0,u,_,m)}while(a.getEndPointIndex()!==l)}querySegment(e,t,n){let r=this.getPathIndexFromPointIndex(e),i=e-this.getPathStart(r);i>=this.getSegmentCountPath(r)&&R(`get_segment`),this.getSegmentFromPath(r,i,t,n)}getSegment(e,t){let n=new this.m_segmentBufferCTor;return this.getSegmentBuffer(e,n,t),n.releaseSegment()}getSegmentType(e){let t=this.getPathIndexFromPointIndex(e),n=e-this.getPathStart(t);return n>=this.getSegmentCountPath(t)&&R(`get_segment`),this.getSegmentTypeFromPath(t,n)}getSegmentFromPath(t,n,r,i){let a=this.getPathStart(t)+n,o=this.getSegmentFlagsStreamRef(),s=1;switch(o&&(s=31&o.read(a)),s){case 1:r.createLine();break;case 2:r.createCubicBezier();break;case 4:r.createEllipticArc();break;case 8:r.createQuadraticRationalBezier();break;case 16:r.createQuadraticBezier();break;default:B(``)}let c=r.get(),l,u=null;if(i?(u=Kt(),c.assignVertexDescription(u)):c.assignVertexDescription(this.m_description),l=a===this.getPathEnd(t)-1&&this.isClosedPath(t)?this.getPathStart(t):a+1,Ar(c,this.getXY(a)),Mr(c,this.getXY(l)),!i)for(let e=1,t=this.m_description.getAttributeCount();e<t;e++){let t=this.m_description.getSemantics(e),n=Ii.getComponentCount(t);for(let e=0;e<n;e++){let n=this.getAttributeAsDbl(t,a,e);c.setStartAttribute(t,e,n);let r=this.getAttributeAsDbl(t,l,e);c.setEndAttribute(t,e,r)}}if(e.isNonLinearSegmentFlag(s)){let e=this.m_curveData.m_segmentParamIndex.read(a);c.readFromBufferStream(this.m_curveData.m_segmentParams,e)}}replaceLinearEllipticalArcsWithTrueLines(){if(!this.hasNonLinearSegments()||this.m_curveData.m_arcCount===0)return!1;let e=!1;for(let t=0,n=this.getPointCount();t<n;t++)if(this.m_curveData.m_segmentFlags.read(t)===4){let n=this.m_curveData.m_segmentParamIndex.read(t);ji(this.m_curveData.m_segmentParams,n).isNAN()&&(this.m_curveData.m_segmentFlags.write(t,1),this.m_curveData.m_segmentParamIndex.write(t,-1),this.incCurveType(4,-1),this.modifyCurveCounter(-1),e=!0)}return e&&this.checkCompactSegmentParams(),e}queryPointAlongPath(e,t,n,r=!1){let i={iSegment:-1},a=r?i:{tSegment:0};if(n.setEmpty(),this.isEmpty()||((e<0||e>=this.getPathCount())&&R(`query_point_along_path`),t<0))return i;let o=this.getPathSize(e);if(o===0)return i;if(o===1)return this.getPointByVal(this.getPathStart(e),n),a.tSegment=0,i.iSegment=this.getPathStart(e),i;let c=this.querySegmentIteratorAtVertex(this.getPathStart(e)),l=new s(0);for(;c.hasNextSegment();){let e=c.nextSegment(),r=e.calculateLength2D(),o=l.getResult();if(l.add(r),l.getResult()>=t){let s=t-o;s>r&&(s=r);let l=e.lengthToT(s);return e.queryCoord(l,n),a.tSegment=l,i.iSegment=c.getStartPointIndex(),i}}if(this.isClosedPath(e)){let t=this.getPathStart(e);return this.getPointByVal(t,n),a.tSegment=1,i.iSegment=this.getPathEnd(e)-1,i}{let t=this.getPathEnd(e)-1;return this.getPointByVal(t,n),this.getPathSize(e)>1?(a.tSegment=1,i.iSegment=this.getPathEnd(e)-2,i):(a.tSegment=0,i.iSegment=this.getPathStart(e),i)}}queryPointsAlongPath(e,t,n,r,i,a){{let e=0;for(let o=0;o<t;++o)r&&r[o].setEmpty(),i&&(i[o]=-1),a&&(a[o]=0),e>n[o]&&R(`query_points_along`),e=n[o]}let o=this.getPathSize(e);if(t===0||o===0)return 0;if(o===1){let t=this.getPathStart(e);return r&&this.getPointByVal(t,r[0]),a&&(a[0]=0),i&&(i[0]=t),1}let c=this.getPathStart(e),l=new s(0),u=this.querySegmentIteratorAtVertex(c),d=0,f=0,p=n[d];for(;u.hasNextSegment();){let e=u.nextSegment(),o=e.calculateLength2D(),s=l.getResult();for(l.add(o);l.getResult()>=p;){let c=p-s;c>o&&(c=o);let l=e.lengthToT(c);if(r&&e.queryCoord(l,r[f]),a&&(a[f]=l),i&&(i[f]=u.getStartPointIndex()),f++,d++,p=n[d],d===t)return f}}if(this.isClosedPath(e)){let t=this.getPathStart(e);r&&this.getPointByVal(t,r[f]),a&&(a[f]=0),i&&(i[f]=t),f++}else if(this.getPathSize(e)>1){let t=this.getPathEnd(e)-2;r&&this.getPointByVal(t+1,r[f]),a&&(a[f]=1),i&&(i[f]=t),f++}return f}queryPointsAlong(e,t,n,r,i){{let a=0;for(let o=0;o<e;++o)n&&n[o].setEmpty(),r&&(r[o]=-1),i&&(i[o]=0),a>t[o]&&R(`query_points_along`),a=t[o]}if(e===0)return 0;let a=new s(0),o=this.querySegmentIterator(),c=-1,l=0,u=0,d=t[l];for(;o.nextPath();)for(;o.hasNextSegment();){c=o.getPathIndex();let s=o.nextSegment(),f=s.calculateLength2D(),p=a.getResult();for(a.add(f);a.getResult()>=d;){let a=d-p;a>f&&(a=f);let c=s.lengthToT(a);if(n&&s.queryCoord(c,n[u]),i&&(i[u]=c),r&&(r[u]=o.getStartPointIndex()),u++,l++,d=t[l],l===e)return u}}if(c<0)return 0;if(this.isClosedPath(c)){let e=this.getPathStart(c);n&&this.getPointByVal(e,n[u]),i&&(i[u]=0),r&&(r[u]=e),u++}else if(this.getPathSize(c)>1){let e=this.getPathEnd(c)-2;n&&this.getPointByVal(e+1,n[u]),i&&(i[u]=1),r&&(r[u]=e),u++}return u}querySegmentIterator(){return new Di({parent:this})}querySegmentIteratorAtVertex(e){return new Di({parent:this,pointIndex:e})}queryPathEnvelope(e,t){this.queryPathEnvelopeImpl(e,t,!0)}queryLoosePathEnvelope(e,t){this.queryPathEnvelopeImpl(e,t,!1)}queryPathEnvelopeImpl(e,t,n){if(t instanceof lr&&U(0,`not implemented for Envelope`),t instanceof Yt&&U(0,`not implemented for Envelope3D`),(e>=this.getPathCount()||e<0)&&R(``),this.isEmpty())return void t.setEmpty();let r=this.getAttributeStreamRef(0),i=G.constructEmpty();i.setEmpty();for(let t=2*this.getPathStart(e),n=2*this.getPathEnd(e);t<n;){let e=n-t;U(!(1&e)),i.mergePointsInterleaved(r,t/2,e/2),t+=e}if(t.setCoords({env2D:i}),this.hasNonLinearSegmentsPath(e)){let r=this.querySegmentIterator();if(r.resetToPath(e),r.nextPath())for(;r.hasNextSegment();){let e=r.nextCurve();if(!e)break;{let r=G.constructEmpty();n?e.queryEnvelope(r):e.queryLooseEnvelope(r),t.mergeEnvelope2D(r)}}else U(0)}}checkCompactSegmentParams(){if(!this.m_curveData||this.m_curveData.m_segmentParams===null||this.m_curveData.m_segmentParams.size()<=this.m_vertexAttributes.get(0).size())return!1;let e=Ni(4)*this.m_curveData.m_arcCount+Ni(2)*this.m_curveData.m_bezierCount+Ni(8)*this.m_curveData.m_rbezier2Count+Ni(16)*this.m_curveData.m_bezier2Count;return this.m_curveData.m_segmentParams.size()>Math.max(3*e>>1,10)?(this.forceCompactSegmentParams(),!0):(this.m_pointCount===0&&(this.m_curveData.m_curveParamWritePoint=0),!1)}forceCompactSegmentParams(){let t=0;for(let n=0,r=this.getPointCount();n<r;n++){let r=this.m_curveData.m_segmentFlags.read(n);e.isNonLinearSegmentFlag(r)&&(t+=Ni(r))}let n=rn(t),r=0;for(let t=0,i=this.getPointCount();t<i;t++){let i=this.m_curveData.m_segmentFlags.read(t);if(e.isNonLinearSegmentFlag(i)){let e=this.m_curveData.m_segmentParamIndex.read(t);this.m_curveData.m_segmentParamIndex.write(t,r);let a=Ni(i);for(let t=0;t<a;t++)n.write(r,this.m_curveData.m_segmentParams.read(e)),r++,e++}}this.m_curveData.m_segmentParams=n,this.m_curveData.m_curveParamWritePoint=r}setEmpty(){this.m_curveData&&=(this.removeAllCurvesFromGlobalCounter(),null),this.m_bPathStarted=!1,this.m_paths=null,this.m_pathFlags=null,this.setEmptyImpl()}applyTransformation(e){this.applyTransformationToPath(e,-1)}applyTransformation3D(e){U(0)}getImpl(){return this}reserve(e){this.reserveImpl(e),e>0&&!this.m_paths&&(this.m_paths=tn(0),this.m_pathFlags=nn(0),this.m_paths.reserve(2),this.m_pathFlags.reserve(2),this.m_paths.resize(1,0),this.m_pathFlags.resize(1,this.m_bPolygon?1:0))}reserveParts(e,t){this.reserveImpl(e),t>0&&(this.m_paths?(this.m_paths.reserve(t+1),this.m_pathFlags.reserve(t+1)):(this.m_paths=tn(0),this.m_pathFlags=nn(0),this.m_paths.reserve(t+1),this.m_pathFlags.reserve(t+1),this.m_paths.resize(1,0),this.m_pathFlags.resize(1,this.m_bPolygon?1:0)))}clone(){let e=this.createInstance();return this.copyTo(e),e}queryLimitedSegmentIterator(e){return new zi(this,e)}getPathStreamRef(){return this.throwIfEmpty(),this.m_paths}setPathStreamRef(e){this.m_paths=e}getSegmentFlagsStreamRef(){return this.throwIfEmpty(),this.m_curveData==null?null:this.m_curveData.m_segmentFlags}getPathFlagsStreamRef(){return this.throwIfEmpty(),this.m_pathFlags}setPathFlagsStreamRef(e){this.m_pathFlags=e}getSegmentIndexStreamRef(){return this.throwIfEmpty(),this.m_curveData===null?null:this.m_curveData.m_segmentParamIndex}getSegmentDataStreamRef(){return this.throwIfEmpty(),this.m_curveData===null?null:this.m_curveData.m_segmentParams}setSegmentData(e,t,n,r){this.m_curveData||=new Li,this.m_curveData.m_segmentFlags=n,this.m_curveData.m_segmentParams=t,this.m_curveData.m_segmentParamIndex=e,this.m_curveData.m_curveParamWritePoint=r}static getPathIndexFromPointIndexImpl(e,t,n,r){if(r>=0&&r<t){if(n>=e.read(r)){if(n<e.read(r+1))return r;r++}else r--;if(r>=0&&r<t&&n>=e.read(r)&&n<e.read(r+1))return r}if(t<5){for(let r=0;r<t;r++)if(n<e.read(r+1))return r;Oe(``)}let i=0,a=t-1;for(;a>i;){let t=i+(a-i>>1);if(n<e.read(t))a=t-1;else{if(!(n>=e.read(t+1)))return t;i=t+1}}return i}getHighestPointIndex(e){U(e>=0&&e<this.getPathCount());let t=this.getAttributeStreamRef(0),n=this.getPathEnd(e),r=this.getPathStart(e),i=-1,a=new z;a.y=-1/0,a.x=-1/0;for(let e=r+0;e<n;e++){let n=t.readPoint2D(2*e);a.compare(n)===-1&&(i=e,a.setCoordsPoint2D(n))}return i}applyTransformationToPath(e,t){if(t>=this.getPathCount()&&R(`apply_transformation`),this.isEmpty()||e.isIdentity())return;let n=this.m_vertexAttributes.get(0);if(!(t<0?this.hasNonLinearSegments():this.hasNonLinearSegmentsPath(t))){let r,i;t<0?(r=0,i=this.m_pointCount):(r=this.getPathStart(t),i=this.getPathEnd(t)),n.applyTransformation(e,2*r,i-r),this.notifyModifiedFlags(2001);return}let r=new this.m_segmentBufferCTor,i=this.getPathCount(),a=t<0?0:t;do{let i=this.getPathStart(a),o=this.getPathEnd(a),s=this.isClosedPath(a),c=n.readPoint2D(2*i);if(!this.hasNonLinearSegmentsPath(a)){n.applyTransformation(e,2*i,o-i);continue}let l=z.getNAN();for(let t=i;t<o;++t){if((31&this.m_curveData.m_segmentFlags.read(t))!=1){let a=s&&t+1===o;a&&n.writePoint2D(2*i,c),this.getSegmentBuffer(t,r,!0),r.get().applyTransformation(e);let l=this.m_curveData.m_segmentParamIndex.read(t);r.get().writeInBufferStream(this.m_curveData.m_segmentParams,l),n.writePoint2D(2*t,r.get().getStartXY()),a&&n.writePoint2D(2*i,r.get().getEndXY());continue}let a=2*t;n.queryPoint2D(a,l),e.transformInPlace(l),n.writePoint2D(a,l)}if(a===t)break}while(++a<i);this.notifyModifiedFlags(2001)}calculateSubLength2D(e,t,n,r){let i=this.getPathStart(e)+t,a=this.getPathStart(n)+r;(a<i||i<0||a>this.getPointCount()-1)&&ge(``);let o=this.querySegmentIterator(),s=0;o.resetToVertex(i,e);do{for(;o.hasNextSegment();){let e=o.nextSegment();if(o.getStartPointIndex()===a)break;s+=e.calculateLength2D()}if(o.getStartPointIndex()===a)break}while(o.nextPath());return s}calculatePathSubLength2D(e,t,n){let r=this.getPathStart(e)+t,i=this.getPathStart(e)+n;(r<0||i>this.getPointCount()-1)&&ge(``);let a=this.querySegmentIterator();if(r>i&&(this.isClosedPath(e)||R(`cannot iterate across an open path`),a.setCirculator(!0)),r===i)return 0;let o=0,s=0;a.resetToVertex(r,e);do s+=o,o=a.nextSegment().calculateLength2D();while(a.getStartPointIndex()!==i);return s}calculateEnvelope2D(e){return this.updateXYImpl(e)}updateXYImpl(e){let t=super.updateXYImpl(e);if(this.hasNonLinearSegments()){let n=G.constructEmpty(),r=this.querySegmentIterator();for(;r.nextPath();)for(;r.hasNextSegment();){let i=r.nextCurve();if(!i)break;e?i.queryEnvelope(n):i.queryLooseEnvelope(n),t.mergeEnvelope2D(n)}}return t}notifyModifiedAllImpl(){this.m_paths!==null&&this.m_paths.size()?this.m_pointCount=this.m_paths.read(this.m_paths.size()-1):this.m_pointCount=0}setDirtyOGCFlags(e){this.setDirtyFlagProtected(16,e)}hasDirtyOGCStartFlags(){return this.hasDirtyFlag(16)}setDirtyRingAreas2D(e){this.setDirtyFlagProtected(1024,e)}hasDirtyRingAreas2D(){return this.hasDirtyFlag(1024)}static isNonLinearSegmentFlag(e){return!(1&e)}addAndExplicitlyOpenAllPaths(e,t){this===e&&R(`Multi_path_impl::add`);let n=this.getPathCount();for(let r=0,i=e.getPathCount();r<i;r++)this.addPath(e,r,!t),this.openPathAndDuplicateStartVertex(n),n++}getSegmentFlags(e){return this.m_curveData!==null&&this.m_curveData.m_segmentFlags!==null?this.m_curveData.m_segmentFlags.read(e):1}getSegmentBuffer(e,t,n){let r=this.getPathIndexFromPointIndex(e),i=e-this.getPathStart(r);i>=this.getSegmentCountPath(r)&&R(`getSegmentBuffer`),this.getSegmentFromPath(r,i,t,n)}getSegmentTypeFromPath(e,t){let n=this.getPathStart(e)+t,r=this.getSegmentFlagsStreamRef(),i=1;switch(r&&(i=31&r.read(n)),i){case 1:return L.enumLine;case 2:return L.enumBezier;case 4:return L.enumEllipticArc;case 8:return L.enumRationalBezier2;case 16:return L.enumBezier2;default:B(``)}}ensureXYMonotoneSegments(){if(!this.m_curveData)return!1;let e=!1;for(let t=0,n=this.getPathCount();t<n;t++){let n=this.getPathStart(t),r=this.getPathEnd(t),i=r-n;for(let t=n;t<r;t++){let r=31&this.m_curveData.m_segmentFlags.read(t);if(r===1)continue;r!==2&&xt(`ensure_xy_monotone_segments`);let a=(t-n+1)%i+n,o=this.m_curveData.m_segmentParamIndex.read(t),s=C(z,4);s[0]=this.getXY(t),s[3]=this.getXY(a),s[1].x=this.m_curveData.m_segmentParams.read(o),s[1].y=this.m_curveData.m_segmentParams.read(o+1),s[2].x=this.m_curveData.m_segmentParams.read(o+2),s[2].y=this.m_curveData.m_segmentParams.read(o+3),Sr(s)&&(e=!0,this.m_curveData.m_segmentParams.write(o,s[1].x),this.m_curveData.m_segmentParams.write(o+1,s[1].y),this.m_curveData.m_segmentParams.write(o+2,s[2].x),this.m_curveData.m_segmentParams.write(o+3,s[2].y))}}return e&&this.notifyModifiedFlags(2001),e}buildRasterizedGeometryAccelerator(e,t){return!1}buildQuadTreeAccelerator(e){if(this.m_accelerators||=new Oi,this.m_accelerators.getQuadTree()!==null)return!0;this.ensureUniqueAccelerators(),this.m_accelerators.setQuadTree(null);let t=tr(this);return this.m_accelerators.setQuadTree(t),!0}buildQuadTreeForPathsAccelerator(e){if(this.m_accelerators||=new Oi,this.m_accelerators.getQuadTreeForPaths()!==null)return!0;this.ensureUniqueAccelerators(),this.m_accelerators.setQuadTreeForPaths(null);let t=$n(this);return this.m_accelerators.setQuadTreeForPaths(t),!0}updateCurveCounter(e){this.modifyCurveCounter(e-this.getCurveCount())}removeAllCurvesFromGlobalCounter(){this.m_curveData&&(e.st_totalCurveCount-=this.m_curveData.m_curveCount,this.m_curveData.m_curveCount=0,this.m_curveData.m_bezierCount=0,this.m_curveData.m_arcCount=0,this.m_curveData.m_bezier2Count=0,this.m_curveData.m_rbezier2Count=0,this.m_curveData.m_curveParamWritePoint=0)}modifyCurveCounter(t){t&&(this.m_curveData||=new Li,e.st_totalCurveCount+=t,this.m_curveData.m_curveCount+=t)}getCurveCount(){return this.m_curveData?this.m_curveData.m_curveCount:0}incCurveType(e,t){this.m_curveData||=new Li,2&e?this.m_curveData.m_bezierCount+=t:4&e?this.m_curveData.m_arcCount+=t:8&e?this.m_curveData.m_rbezier2Count+=t:16&e&&(this.m_curveData.m_bezier2Count+=t)}getCurveWritePoint(){return this.m_curveData===null?0:this.m_curveData.m_curveParamWritePoint}initSegmentData(e){this.m_curveData===null&&(this.m_curveData=new Li);let t=this.m_reservedPointCount>0?this.m_reservedPointCount:this.m_pointCount;this.m_curveData.m_segmentParamIndex===null&&(this.m_curveData.m_segmentFlags=nn(t,1),this.m_curveData.m_segmentParamIndex=tn(t,-1));let n=this.m_curveData.m_curveParamWritePoint+e;this.m_curveData.m_segmentParams===null?this.m_curveData.m_segmentParams=rn(n):n!==this.m_curveData.m_segmentParams.size()&&this.m_curveData.m_segmentParams.resize(n,0),this.m_curveData.m_segmentFlags.size()<t&&(this.m_curveData.m_segmentFlags.resize(t,1),this.m_curveData.m_segmentParamIndex.resize(t,-1))}updateCurveWritePoint(e){this.m_curveData===null&&(this.m_curveData=new Li),this.m_curveData.m_curveParamWritePoint=e}updateOGCFlagsHelper(){let e=this.getPathCount();if(e===0)return;let t=this.m_pathFlags,n=0;for(let r=0;r<e;r++){let e=this.m_cachedRingAreas2D.read(r);n===0&&(n=Ye(e)),e*n>0||n===0?t.setBits(r,8):t.clearBits(r,8)}}updateOGCFlagsProtected(){this.hasDirtyFlag(16)&&(this.updateRingAreas2DProtected(),this.updateOGCFlagsHelper(),this.setDirtyFlagProtected(16,!1))}replaceSegment(e,t,n){(e<0||e>=this.getPointCount())&&R(`Multi_path_impl.replace_segment`),U(t.isCurve());let r=this.getPathIndexFromPointIndex(e),i=this.getPathStart(r),a=(e-i+1)%this.getPathSize(r)+i;{let n=this.getXY(e),r=this.getXY(a),i=!n.isEqualPoint2D(t.getStartXY())||!r.isEqualPoint2D(t.getEndXY());U(!i)}this.replaceSegmentImpl(e,a,t,n)}replaceSegmentImpl(e,t,n,r){let i=n.getDescription();this.mergeVertexDescription(i);let a=H(32,NaN),o=new q({vd:i,attribBuffer:a,initDefaultValues:!1}),s=this.m_curveData===null?1:31&this.m_curveData.m_segmentFlags.read(e),c=Ni(s),l=Mi(n),u,d=!1;c>=l?(U(this.m_curveData!==null),d=!0,u=this.m_curveData.m_segmentParamIndex.read(e)):(this.initSegmentData(l),d=!1,u=this.m_curveData.m_curveParamWritePoint);let f=n.getGeometryType(),p=Li.toSegType(f);r||(n.queryStart(o),this.setPointByValNoCurves(e,o),n.queryEnd(o),this.setPointByValNoCurves(t,o)),this.m_curveData.m_segmentParamIndex.write(e,p===1?-1:u),this.m_curveData.m_segmentFlags.write(e,p),p!==1&&n.writeInBufferStream(this.m_curveData.m_segmentParams,u),d||(this.m_curveData.m_curveParamWritePoint+=l),s!==p&&(this.incCurveType(s,-1),this.incCurveType(p,1),this.modifyCurveCounter(s===1?1:-1))}setAttributeImpl(e,t,n){if(this.addAttribute(e),!this.isEmpty())if(this.hasNonLinearSegments()&&e===0){(t<0||t>1)&&R(``);let e=new At,r=t===0?n:0,i=t===0?0:1;e.setShiftCoords(r,i),t===0?e.xx=0:e.yy=0,this.applyTransformation(e)}else super.setAttributeImpl(e,t,n)}};Ri.st_totalCurveCount=0;var zi=class{constructor(e,t){this.m_segIter=null,this.m_quadTree=null,this.m_qtIter=null,this.m_extentOfInterest=new G(t),this.m_bfirst=!0,this.m_prevIndex=-100,this.m_parent=e}nextSegment(){return this.m_bfirst&&this.prepare_(),this.m_quadTree?this.nextSegmentQt():this.nextSegmentNoQt()}getPathIndex(){return this.m_segIter.getPathIndex()}getStartPointIndex(){return this.m_segIter.getStartPointIndex()}getEndPointIndex(){return this.m_segIter.getEndPointIndex()}isClosingSegment(){return this.m_segIter.isClosingSegment()}isPathClosed(){return this.m_segIter.isPathClosed()}prepare_(){let e=this.m_parent.getAccelerators();e&&(this.m_quadTree=e.getQuadTree(),this.m_quadTree&&(this.m_qtIter=this.m_quadTree.getSortedIterator(this.m_extentOfInterest,0))),this.m_segIter=this.m_parent.querySegmentIterator()}nextSegmentQt(){this.m_bfirst=!1;let e=this.m_qtIter.next();if(e===-1)return null;let t=this.m_quadTree.getElement(e);return(t!==this.m_prevIndex+1||this.m_segIter.isLastSegmentInPath())&&(this.m_segIter.resetToVertex(t,this.m_segIter.getPathIndex()),this.m_prevIndex=t),this.m_segIter.nextSegment()}nextSegmentNoQt(){for(;;){if(!this.m_bfirst&&this.m_segIter.hasNextSegment()){let e=this.m_segIter.nextSegment(),t=G.constructEmpty();if(e.queryLooseEnvelope(t),!t.isIntersecting(this.m_extentOfInterest))continue;return e}if(this.m_bfirst=!1,!this.m_segIter.nextPath())return null}}},Bi=class e extends Ri{constructor(e){e?e.vd?(super({vd:e.vd,bPolygon:!1}),this.m_segmentBufferCTor=Q):e.copy?(super({vd:e.copy.getDescription(),bPolygon:!1}),this.m_segmentBufferCTor=Q,e.copy.copyTo(this)):e.move?(super({move:e.move}),this.m_segmentBufferCTor=Q):e.start?(super({vd:e.start.getDescription(),bPolygon:!1}),this.m_segmentBufferCTor=Q,this.startPathPoint(e.start),this.lineToPoint(e.end)):e.path?(super({bPolygon:!1}),this.m_segmentBufferCTor=Q,this.addPathPoint2D(e.path,e.pointCount,e.bForward)):B(`bad constructor arg`):(super({bPolygon:!1}),this.m_segmentBufferCTor=Q)}getBoundary(){return Ui(this)}assignCopy(e){return this!==e&&e.copyTo(this),this}assignMove(e){return e.copyTo(this),this}getGeometryType(){return e.type}getDimension(){return 1}createInstance(){return new e({vd:this.getDescription()})}equals(e,t){return this.equalsBase(e,t)}};Bi.type=L.enumPolyline;var Vi=L;function Hi(e,t){if(e.isEmpty())return!1;let n=e.getGeometryType();if(n===Vi.enumPolygon)return e.calculateArea2D()!==0;if(n===Vi.enumPolyline)return Wi(e.getImpl(),t,!0).bNotEmpty;if(n===Vi.enumEnvelope)return!0;if(Ne(n))return!!e.isClosed();if(Be(n))return!1;if(n===Vi.enumGeometryCollection){let n=e;for(let e=0,r=n.getGeometryCount();e<r;e++)if(Hi(n.getGeometry(e),t))return!0;return!1}xt(``)}function Ui(e,t){let n=e.getGeometryType();if(n===Vi.enumPolygon){let t=new Bi({vd:e.getDescription()});return e.isEmpty()||e.copyToUnchecked(t),t}if(n===Vi.enumPolyline)return Wi(e.getImpl(),t,!1).boundary;if(n===Vi.enumEnvelope){let t=new Bi({vd:e.getDescription()});return e.isEmpty()||t.addEnvelope(e,!1),t}if(Ne(n)){let t=new ii({vd:e.getDescription()});if(!e.isEmpty()&&!e.isClosed()){let n=new q;t.reserve(2),e.queryStart(n),t.add(n),e.queryEnd(n),t.add(n)}return t}if(n===Vi.enumGeometryCollection){let n=e,r=null;for(let i=0,a=n.getGeometryCount();i<a;i++){let a=Ui(n.getGeometry(i),t);if(a!==null){r===null&&(r=e.createInstance());let t=a;r.addGeometry(t)}}return r}if(Be(n))return new q({vd:e.getDescription()});xt(``)}function Wi(e,t,n){let r=e,i=null;if(n||(i=new ii({vd:r.getDescription()})),!r.isEmpty()){let e=new sn(0);for(let t=0,n=r.getPathCount();t<n;t++)if(r.getPathSize(t)>0&&!r.isClosedPathInXYPlane(t)){let n=r.getPathStart(t);e.add(n);let i=r.getPathEnd(t)-1;e.add(i)}if(e.size()>0){let t=new fn,a=r.getAttributeStreamRef(0);t.sort(e,0,e.size(),{userSort(e,t,n){let r=z.getNAN(),i=z.getNAN();n.sort(e,t,(e,t)=>(a.queryPoint2D(2*e,r),a.queryPoint2D(2*t,i),r.compare(i)))},getValue:e=>a.read(2*e+1)});let o=a.readPoint2D(2*e.read(0)),s=0,c=1,l=new q;for(let t=1,r=e.size();t<r;t++){let r=a.readPoint2D(2*e.read(t));if(r.isEqualPoint2D(o))e.read(s)>e.read(t)?(e.write(s,kt()),s=t):e.write(t,kt()),c++;else{if(1&c){if(n)return{bNotEmpty:!0,boundary:new ii({})}}else e.write(s,kt());o=r,s=t,c=1}}if(1&c){if(n)return{bNotEmpty:!0,boundary:new ii({})}}else e.write(s,kt());if(!n){e.sort(0,e.size());for(let t=0,n=e.size();t<n&&e.read(t)!==kt();t++)r.getPointByVal(e.read(t),l),i.add(l)}}}return n?{bNotEmpty:!1,boundary:new ii({})}:{bNotEmpty:!1,boundary:i}}function Gi(e,t,n,r){let i=4*fe()*(Math.abs(t.vmin)+Math.abs(t.vmax)),a=fe();if(e.getMaxDerivative()===1){U(n>0);let a=Qi(e,0,t,fe(),i);return r[0]=a.root,a.cRoots}let o,s=[],c=new I(t.vmin-i,t.vmax+i);s.push(new z(c.vmin,c.vmax));let l=0;for(let c=e.getMaxDerivative()-1;c>=0;c--){o=s,s=[];for(let u=0,d=o.length;u<d;u++){if(o[u][0]<o[u][1]){let d,f,p;if(c===e.getMaxDerivative()-1?{root:d,funcAtRoot:f,cRoots:p}=Qi(e,c,I.construct(o[u][0],o[u][1]),a,.5*i):{root:d,funcAtRoot:f,cRoots:p}=$i(e,c,I.construct(o[u][0],o[u][1]),a,.5*i),p===1){if(c===0)l<n&&(o[u][0]<=t.vmin&&o[u][1]>=t.vmin&&d!==t.vmin&&e.getValue(0,t.vmin)===0&&(d=t.vmin),o[u][0]<=t.vmax&&o[u][1]>=t.vmax&&d!==t.vmax&&e.getValue(0,t.vmax)===0&&(d=t.vmax),r[l]=t.snapClip(d),l>0?r[l]-r[l-1]>i&&l++:l++);else{let e=z.getNAN();e[0]=o[u][0],e[1]=d,s.push(e);let t=z.getNAN();t[0]=d,t[1]=o[u][1],s.push(t)}continue}}s.push(o[u])}}return l}function Ki(e,t,n,r){let i=new P,a=na(new P(e),new P(t),n,i);return r[0]=i.value(),a}function qi(e,t,n,r,i,a){let o=C(P,2),s=ra(new P(e),new P(t),new P(n),r,i,o);return a[0]=o[0].value(),a[1]=o[1].value(),s}function Ji(e,t,n,r,i,a,o){let s=C(P,3),c=ia(new P(e),new P(t),new P(n),new P(r),i,a,s);return o[0]=s[0].value(),o[1]=s[1].value(),o[2]=s[2].value(),c}function Yi(e,t,n,r,i,a,o,s){return Zi(e,t,n,r,i,a,o,s)}function Xi(e,t,n,r,i,a){return ta(e,t,n,r,i,a)}function Zi(e,t,n,r,i,a,o,s){let c=H(n*n,NaN);c.fill(0),Qe(s,r,0,0,n);let l=H(n,NaN),u=H(n,NaN),d=H(n,NaN),f=e(s,n,t),p=0;for(p=0;p<100;p++){let r=f;for(let e=0;e<n;++e)u[e]=s[e];if(p%n===0){c.fill(0);for(let e=0;e<n;e++)c[e*n+e]=1}let o=0,m=0;for(let r=0;r<n;++r){for(let e=0;e<n;++e)l[e]=c[r*n+e];let u=f;f=ea(e,t,s,l,i,a,n);let d=u-f;d>o&&(m=r,o=d)}for(let e=0;e<n;e++)l[e]=s[e]-u[e],d[e]=s[e]+(s[e]-u[e]);let h=e(d,n,t);if(h<r&&2*(r-2*f+h)*Ct(r-f-o)<Ct(r-h)*o){f=ea(e,t,s,l,i,a,n);for(let e=0;e<n;++e)c[m*n+e]=c[(n-1)*n+e],c[(n-1)*n+e]=l[e]}if(r<=f)return e(s,n,t)}return f}function Qi(e,t,n,r,i){let a={root:0,funcAtRoot:0,cRoots:0},o=n.vmin,s=n.vmax,l=0,u=Number.MAX_VALUE,d=e.getValue(t,o),f=e.getValue(t,s),p=0,m=0,h=0;if(d>=0&&f>=0||d<=0&&f<=0)return Math.abs(d)<Math.abs(f)?(a.funcAtRoot=d,a.root=o,a.cRoots=d===0?1:0,a):(a.funcAtRoot=f,a.root=s,a.cRoots=f===0?1:0,a);Math.abs(d)<Math.abs(f)&&(s=W(o,o=s),f=W(d,d=f)),l=o,p=d;let g=!0,_=0;for(;f!==0&&Math.abs(o-s)>r*Math.abs(s)+i;_++){let n=_>64;if(!n){m=d!==p&&f!==p?o*f*p/((d-f)*(d-p))+s*d*p/((f-d)*(f-p))+l*d*f/((p-d)*(p-f)):s-f*(s-o)/(f-d);let e=(3*o+s)/4;if(n=!(m>e&&m<s||m>s&&m<e),!n){let e=r*Math.abs(s)+i;if(g){let t=Math.abs(s-l);n=Math.abs(m-s)>=.5*t||t<e}else{let t=Math.abs(l-u);n=Math.abs(m-s)>=.5*t||t<e}}}if(n?(m=(o+s)/2,g=!0):g=!1,h=e.getValue(t,m),h===0)return a.root=m,a.funcAtRoot=h,a.cRoots=1,a;if(!n){let n=o-m,r=m-s;if(Math.abs(n)>10*Math.abs(r)){let n=s+3*r;for(let r=0;r<2;r++){let r=e.getValue(t,n);Ye(d)*Ye(r)>0?(o=n,d=r):n=c(o,s,.75)}}else if(Math.abs(r)>10*Math.abs(n)){let r=o-3*n;for(let n=0;n<2;++n){let n=e.getValue(t,r);Ye(f)*Ye(n)>0?(s=r,f=n):r=c(o,s,.25)}}}u=l,l=s,p=f,Ye(d)*Ye(h)<0?(s=m,f=h):(o=m,d=h),Math.abs(d)<Math.abs(f)&&(s=W(o,o=s),f=W(d,d=f)),_===128&&B(`Root_finder iterations exceeded`)}return a.root=s,a.funcAtRoot=f,a.cRoots=1,a}function $i(e,t,n,r,i){let a={root:0,funcAtRoot:0,cRoots:0},o=n.vmin,s=e.getValue(t,o),c=n.vmax,l=e.getValue(t,c);if(s>=0&&l>=0||s<=0&&l<=0)return Math.abs(s)<Math.abs(l)?(a.funcAtRoot=s,a.root=o,a.cRoots=s===0?1:0,a):(a.funcAtRoot=l,a.root=c,a.cRoots=l===0?1:0,a);l<0&&(l=W(s,s=l),c=W(o,o=c));let u=.5*(o+c),d=Math.abs(c-o),f=d,p=e.getValue(t,u),m=e.getValue(t+1,u),h=4,g=1,_=0,v=0,y=1,b=0;for(;++b<100;){let n;b>32||m===0||y===2&&_>1||y===1&&h<4?(y=1,g>1&&g--):(y=2,v>1&&Math.abs(2*p)>Math.abs(d*m)&&g++),d=f;let r=!1;if(y===1)do{if(v>2){let e=16*Math.abs(d);if(.5*Math.abs(o-c)>e){let t=Math.min(o,c),r=Math.max(o,c);if(u===t){n=u,u=t+e,f=u-n;break}if(u===r){n=u,u=r-e,f=u-n;break}}}f=.5*(c-o),n=u,u=o+f,r=o===u||c===u}while(0);else for(;;){f=g*p/m,n=u,u-=f,r=u===n;let e=Math.min(o,c),t=Math.max(o,c);if(u<e){if(g>1){u=n,g--;continue}f=n-e,u=e}else if(u>t){if(g>1){u=n,g--;continue}f=n-t,u=t}break}if(r||Math.abs(f)<i){n!==u&&(p=e.getValue(t,u));break}p=e.getValue(t,u),m=e.getValue(t+1,u);let a=o,x=c;p<0?(s=p,o=u):(l=p,c=u),y===2&&(o===a&&c===x||v>1&&Math.abs(f)>=.5001*Math.abs(d))?_++:_=0,y===1?(h++,v=0):(h=0,v++)}return b===100&&B(`Root_finder iterations exceeded`),a.root=u,a.funcAtRoot=p,a.cRoots=1,a}function ea(e,t,n,r,i,a,o){let s=r.slice(0,o),c=0;for(let e=0;e<o;e++)c+=r[e]*r[e];if(c=Math.sqrt(c),c>0)for(let e=0;e<o;e++)s[e]/=c;let l=-1/0,u=1/0;{let e=H(o,0);for(let t=0;t<o;t++)e[t]=t;e.sort((e,t)=>{let n=Math.abs(s[e]),r=Math.abs(s[t]);return n<r?-1:n>r?1:0});for(let t=0;t<o;t++){let r=e[t];if(s[r]===0)continue;let o=(i[r]-n[r])/s[r],c=(a[r]-n[r])/s[r];c<o&&(c=W(o,o=c)),o>l&&(l=o),c<u&&(u=c)}}let d=0,f=(Math.abs(l)+Math.abs(u))*fe()*100,p=H(o,NaN),m=s.slice();function h(r,i){for(let e=0,t=o;e<t;e++)p[e]=n[e]+r*m[e];return e(p,o,t)}f>0&&(d=Xi(h,null,l,0,u,f));let g=h(d);for(let e=0,t=o;e<t;e++)n[e]=_e(p[e],i[e],a[e]);return g}function ta(e,t,n,r,i,a){let o=_(),s=r,c=e(s,t),l=n,u=i,d=e(l,t),f=e(u,t);c>d&&(c=d,s=l),c>f&&(c=f,s=u);let p=l,m=u,h=d,g=f;h>g&&(h=W(g,g=h),m=W(p,p=m));let v=s-p,y=p-m,b=.5*Math.min(a,u-l),x=2*b,S,C=0;for(S=0;S<100&&!(u-l<=x);++S){let n=l+.5*(u-l),r=C>0;if(!r&&Math.abs(y)<=b&&(r=!0,C=3),!r){let e=s-p,t=s-m,n=e*(c-g),i=t*(c-h),a=t*i-e*n;i=2*(i-n),i>0&&(a=-a),i=Math.abs(i),i===0||Math.abs(a)>=Math.abs(i*y/2)||a<=i*(l-s)||a>=i*(u-s)?(r=!0,C=3):(y=v,v=a/i)}r&&(y=s>=n?l-s:u-s,v=o*y,C--);let i=s+v;i<l+b?i=l+b:i>u-b&&(i=u-b);let a=e(i,t);a<c?(i>=s?(l=s,d=c):(u=s,f=c),m=p,p=s,s=i,g=h,h=c,c=a):(i<s?(l=i,d=a):(u=i,f=a),a<=h||p===s?(m=p,p=i,g=h,h=a):(a<=g||m===s||m===p)&&(m=i,g=a))}return s}function na(e,t,n,r){return e.isZero()?t.isZero()?-1:0:(r.setE(t.clone().negateThis().divThisE(e)),n.containsCoordinate(r.value())?1:0)}function ra(e,t,n,r,i,a){if(e.value()===0)return i?(a[0].set(1),r.containsCoordinate(a[0].value())?1:0):na(t,n,r,a[0]);if(i){let t=2;return a[0].set(1),a[1].setE(n).divThisE(e),a[1].eq(a[0])&&(a[1].set(1),t=1),r.containsCoordinate(a[1].value())||(t=1),r.containsCoordinate(a[0].value())||(t--,a[0].setE(a[1])),t===2&&a[0].value()>a[1].value()&&(a[1]=W(a[0],a[0]=a[1])),t}let o=t.clone().sqrThis().subThisE(e.clone().mulThisE(n).mulThisE(Ie));if(o.lt(bt))return 0;let s=new P(t.value()>=0?1:-1),c=o.clone().sqrtThis(),l=new P(-.5).mulThisE(t.clone().addThisE(s.clone().mulThisE(c))),u=0;a[0].setE(l.divE(e));let d=new P(a[0].value()),f=new P(e.value()).mulE(d).addE(new P(t.value()).mulE(d).addE(new P(n.value())));return f.isZero()||da(a[0],e,t,n,a[0]),r.containsCoordinate(a[0].value())&&u++,c.value()!==0&&l.value()!==0?(a[u].assign(n.divE(l)),d.set(a[u].value()),f.assign(new P(e.value()).mulE(d).addE(new P(t.value()).mulE(d).addE(new P(n.value())))),f.isZero()||da(a[u],e,t,n,a[u]),r.containsCoordinate(a[u].value())&&u++,u===2&&a[0].value()>a[1].value()&&(a[1]=W(a[0],a[0]=a[1])),u):u}function ia(e,t,n,r,i,a,o){if(e.value()===0)return ra(t,n,r,i,a,o);if(a){let n=1;o[0].set(1);let a=o.slice(n),s=ra(e,t.addE(e),r.negate(),i,!1,a);if(s>0){n+=s;for(let e=1;e<n;e++)o[e].eq(pe)&&(o[n-1]=W(o[e],o[e]=o[n-1]),n--)}let c=o.slice(0,n);c.sort((e,t)=>e.value()<t.value()?-1:e.value()>t.value()?1:0);for(let e=0;e<n;++e)o[e]=c[e];return n}return fa(e,t,n,r,i,o)}function aa(e,t,n,r,i,a){return(a<t||t<0)&&R(`nth_degree_real_roots`),pa(e,t,n,r,i)}function oa(e,t,n,r){return{coef0:e.clone(),coef1:t.clone(),coef2:n.clone(),coef3:r.clone(),calcF(e){return this.coef0.clone().mulThis(e).addThisE(this.coef1).mulThis(e).addThisE(this.coef2).mulThis(e).addThisE(this.coef3)},calcDF(e){return this.coef0.clone().mulThis(3).mulThis(e).addThisE(this.coef1.clone().mulThisByPower2(2)).mulThis(e).addThisE(this.coef2)},estimateError(e){let t=Math.abs(e),n=((this.coef0.eps()*t+this.coef1.eps())*t+this.coef2.eps())*t+this.coef3.eps()+this.calcF(e).eps(),r=this.coef0.clone().mulThis(e).mulThis(3).addThisE(this.coef1.clone().mulThis(2)).mulThis(e).addThisE(this.coef2);if(r.isZero()){let t=this.coef0.clone().mulThis(e).mulThis(6).addThisE(this.coef1.clone().mulThis(2));if(t.isZero()){let e=this.coef0.clone().mulThis(6);return(6*n/Math.abs(e.value()))**(1/3)}return Math.sqrt(2*n/Math.abs(t.value()))}return n/Math.abs(r.value())}}}var sa=class{updateCoefs(e){if(this.lastDeriv1===e)return this.curCoefs=this.derivCoefs1,void(this.lastUsed=1);if(this.lastDeriv2===e)return this.curCoefs=this.derivCoefs2,void(this.lastUsed=2);let t;this.lastUsed===1?(t=this.derivCoefs2,this.lastDeriv2=e,this.lastUsed=2):(t=this.derivCoefs1,this.lastDeriv1=e,this.lastUsed=1),t.length=0;for(let n=0,r=this.truePower-e;n<=r;++n){t.push(this.coefs[n+e].clone());let r=n+e,i=r--;for(let t=1;t<e;t++)i*=r--;t[n].mulThis(i)}this.curCoefs=t}constructor(e,t,n,r){this.derivCoefs1=[],this.derivCoefs2=[],this.lastDeriv1=-1,this.lastDeriv2=-1,this.lastUsed=-1,this.curCoefs=null,this.coefs=e,this.power=t,this.truePower=0;for(let e=t;e>=1;e--)if(this.coefs[e].value()!==0){this.truePower=e;break}}getMaxDerivative(){return this.truePower+1}getValue(e,t){let n=this.coefs;e===0?n=this.coefs:(this.updateCoefs(e),n=this.curCoefs);let r=new s(0),i=1;for(let a=0,o=this.truePower-e;a<=o;++a)r.pe(i*n[a].value()),i*=t;return r.getResult()}getError(e){let t=Math.abs(e),n=new s(0),r=new P(1),i=new P(0);for(let e=0,a=this.power;e<=a;++e)i.addThisE(this.coefs[e].mulE(r)),n.pe(r.value()*this.coefs[e].eps()),r.mulThis(t);n.pe(i.eps());let a=1;for(let t=1;t<=this.truePower;++t){a*=t,this.updateCoefs(t);let r=new P(1),i=new P(0);for(let n=0,a=this.truePower-t;n<=a;++n)i.addThisE(this.curCoefs[n].mulE(r)),r.mulThis(e);if(!i.isZero())return(a*n.getResult()/Math.abs(i.value()))**(1/t)}return 0}};function ca(e,t,n,r,i,a){let o=e,s=t,c=s-o;if(!a){let n=r.calcF(e).value(),i=r.calcF(t).value();if((n>0||n>i)&&(s=W(o,o=s),i=W(n,n=i)),n>=0||i<=0)return!1}let l,u=!1,d=n,f=0;for(;f<100;f++){let e=r.calcF(d);if(l=r.calcDF(d),l.isZero())return!1;if(!e.value()||f>3&&e.isZero()){u=!0;break}a||(e.value()<0?o=d:s=d);let t=e.value()/l.value(),n=d-t;a||(n>=o&&n<=s||n>=s&&n<=o)&&Math.abs(t)<=.5*c?(d=n,c=Math.abs(t)):(c=Math.abs(.5*(s-o)),d=.5*(o+s))}return!!u&&(i.set(d,r.estimateError(d)),!0)}function la(e,t,n,r,i,a,o,s){return ca(e,t,n.value(),oa(r,i,a,o),s,!1)}var ua=class{constructor(e,t,n){this.coefs=C(P,3),this.coefs[0].setE(e),this.coefs[1].setE(t),this.coefs[2].setE(n)}calcF(e){let t=new P(e);return this.coefs[0].mulE(t).addE(this.coefs[1]).mulE(t).addE(this.coefs[2])}calcDF(e){let t=new P(e);return P.st_mulByPower2(this.coefs[0],2).mulE(t).addE(this.coefs[1])}estimateError(e){let t=Math.abs(e),n=(this.coefs[0].eps()*t+this.coefs[1].eps())*t+this.coefs[2].eps()+this.calcF(e).eps(),r=new P(2).mulE(this.coefs[0]).mul(e).addE(this.coefs[1]);if(r.isZero()){let e=this.coefs[0].value();return Math.sqrt(n/Math.abs(e))}return n/Math.abs(r.value())}};function da(e,t,n,r,i){return ca(0,0,e.value(),new ua(t,n,r),i,!0)}function fa(e,t,n,r,i,a){let o=C(P,3),s=0,c=t.negate().divThisE(e.clone().mulThis(3));i.containsCoordinate(c.value())&&(o[0].setE(c),s=1);let l=C(P,2),u=ra(e.mul(3),t.mul(2),n,i,!1,l);if(u<0)return r.isZero()?-1:0;for(let e=0;e<u;e++)i.containsCoordinate(l[e].value())&&o[s++].setE(l[e]);Ze(o,0,s,(e,t)=>e.value()<t.value()?-1:e.value()>t.value()?1:0);let d=C(P,5);d[0].set(i.vmin);for(let e=0;e<s;e++)d[1+e].setE(o[e]);d[1+s].set(i.vmax);let f=s+2,p=1,m=0;{let i=d[0].clone();if(e.clone().mulThisE(i).addThisE(t).mulThisE(i).addThisE(n).mulThisE(i).addThisE(r).isZero()){let o=oa(e,t,n,r);i.setError(o.estimateError(i.value())),a[m]=i,m++,p++}}for(let o=p;o<f;o++){let s=d[o].clone(),c=e.clone().mulThisE(s).addThisE(t).mulThisE(s).addThisE(n).mulThisE(s).addThisE(r).isZero();if(c||!d[o].eq(d[o-1])){if(c||la(d[o-1].value(),d[o].value(),d[o-1].clone().addThisE(d[o]).divThisByPower2(2),e,t,n,r,s)){if(m>0&&s.eq(a[m-1]))continue;if(m>=3&&B(`cubic_polynomial_solver_too_many_roots`),c){let i=oa(e,t,n,r);s.setError(i.estimateError(s.value()))}a[m]=s,m++}if(d[o].value()===i.vmax)break;c&&o++}}return m}function pa(e,t,n,r,i,a){let o=new sa(e,t,n,fe()),s=0;if(o.truePower===2)s=ra(e[2],e[1],e[0],n,r,i);else if(o.truePower===1)s=na(e[1],e[0],n,i[0]);else{if(o.truePower===0)return e[0].value()?0:-1;{let e=[];e.length=t,s=Gi(o,n,t,e);for(let t=0;t<s;t++)i[t].set(e[t])}}for(let e=0;e<s;e++)i[e].setError(o.getError(i[e].value()));return s}var ma=Rt,ha=class e extends ai{constructor(e){e===void 0||ue(e,`vd`)?(super({vd:e?.vd,XStart:0,YStart:0,XEnd:0,YEnd:0}),this.m_cp=new z(0,0),this.m_weights=[1,0,1]):(e.fromPoint&&e.weight?e={fromPoint:e.fromPoint,controlPoint1:e.controlPoint1,toPoint:e.toPoint,weight0:1,weight1:e.weight,weight2:1}:e.points&&e.weight?e={fromPoint:e.points[0],controlPoint1:e.points[1],toPoint:e.points[2],weight0:1,weight1:e.weight,weight2:1}:e.points&&e.weights&&(e={fromPoint:e.points[0],controlPoint1:e.points[1],toPoint:e.points[2],weight0:e.weights[0],weight1:e.weights[1],weight2:e.weights[2]}),e.fromPoint&&e.weight0?(super({start:e.fromPoint,end:e.toPoint}),(e.weight0<=0||e.weight1<0||e.weight2<=0)&&R(`weights`),this.m_cp=e.controlPoint1.clone(),this.m_weights=[e.weight0,e.weight1,e.weight2]):e.copy?(super(e),this.m_cp=e.copy.m_cp.clone(),this.m_weights=e.copy.m_weights.slice()):e.move?(super(e),this.m_cp=e.move.m_cp.clone(),this.m_weights=e.move.m_weights.slice()):xt(`unexpected constructor param`))}getBoundary(){return Ui(this)}assignMove(e){return this}assignCopy(e){return e.copyTo(this),this}construct(e,t,n,r){this.dropAllAttributes(),this.setCpsAndWeights(e,t,n,1,r,1),Qc(this)}constructWeights(e,t,n,r,i,a){this.dropAllAttributes(),this.setCpsAndWeights(e,t,n,r,i,a),Qc(this)}constructArray(e,t){this.construct(e[0],e[1],e[2],t)}constructArrayWeights(e,t){this.dropAllAttributes(),this.setCpsAndWeightsArray(e,t),Qc(this)}convertToStandardForm(){}getStandardFormWeight(){return this.m_weights[1]/Math.sqrt(this.m_weights[0]*this.m_weights[2])}getGeometryType(){return L.enumRationalBezier2}queryEnvelope(e){if(e instanceof G){if(e.setCoords(this.getStartXY()),e.mergeNe(this.getEndXY()),e.contains(this.m_cp))return;let t=wl(this);if(t!==null){let n=new z;for(let r of t.specialPoints)this.queryCoord2D(r,n),e.mergeNe(n)}else{let t=[],n=C(z,3);this.queryControlPoints(n),tl(n,this.m_weights,t);let r=new z;for(let n of t)this.queryCoord2D(n,r),e.mergeNe(r)}}}applyTransformation(e){if(e instanceof At){let t=C(z,3);this.queryControlPoints(t),e.transformPoints2D(t,3,t),this.setStartXY(t[0]),this.m_cp.assign(t[1]),this.setEndXY(t[2]),this.afterCompletedModification();return}}createInstance(){return new e({vd:this.m_description})}calculateLength2D(){return nl(this,1,!1)}calculateLowerLength2D(){return z.distance(this.getStartXY(),this.getEndXY())}calculateUpperLength2D(){return this.calculateUpperLength2D_()}calculateUpperLength2D_(){return this.m_weights[1]>0?z.distance(this.getStartXY(),this.m_cp)+z.distance(this.getEndXY(),this.m_cp):z.distance(this.getStartXY(),this.getEndXY())}queryCoord2D(e,t){return this.queryCoord2DExtension(e,t,!0)}queryCoord2DE(e,t){Ql(this,e,t)}queryCoord2DExtension(e,t,n){if(n){if(e<0){si(new Z({start:this.getStartXY(),end:this.getStartXY().add(this.getTangent(0).getUnitVector())}),e,t);return}if(e>1){si(new Z({start:this.getEndXY(),end:this.getEndXY().add(this.getTangent(1).getUnitVector())}),e-1,t);return}}let r=C(z,3);this.queryControlPoints(r),nu(r,this.m_weights,e,t)}getCoordX(e){let t=new z;return this.queryCoord2DExtension(e,t,!0),t.x}getCoordY(e){let t=new z;return this.queryCoord2DExtension(e,t,!0),t.y}cut(e,t,n){let r=new Q;return this.queryCut(e,t,r,n),r.releaseSegment()}queryCut(e,t,n,r){let i=n.createQuadraticRationalBezier();if(this.cutBezierIgnoreAttributes(e,t,i),r)return;i.assignVertexDescription(this.m_description);let a=this.m_description.getAttributeCount();if(a>1){for(let t=1;t<a;t++){let n=this.m_description.getSemantics(t),r=ma.getComponentCount(n);for(let t=0;t<r;t++){let r=this.getAttributeAsDbl(e,n,t);i.setStartAttribute(n,t,r)}}for(let e=1;e<a;e++){let n=this.m_description.getSemantics(e),r=ma.getComponentCount(n);for(let e=0;e<r;e++){let r=this.getAttributeAsDbl(t,n,e);i.setEndAttribute(n,e,r)}}}}queryDerivative(e,t){fl(this,e,t)}cutBezierIgnoreAttributes(e,t,n){(e<0||t>1||e>t)&&R(`Quadratic_rational_bezier.cut_bezier_ignore_attributes`);let r=C(z,3);this.queryControlPoints(r);let i=[0,0,0];Ll(r,this.m_weights,e,t,r,i),n.setControlPointsAndWeights(r,i)}splitBezierIgnoreAttributes(e,t,n){}getAttributeAsDbl(e,t,n){if(t===0)return n===0?this.getCoordX(e):this.getCoordY(e);let r=this.calculateLength2D(),i=r>0?this.tToLength(e)/r:0,a=ma.getInterpolation(t),o=this.getStartAttributeAsDbl(t,n),s=this.getEndAttributeAsDbl(t,n);return le(a,o,s,i,ma.getDefaultValue(t))}getClosestCoordinate(e,t){return El(this,e,I.unit(),t,-1)}getClosestCoordinateOnInterval(e,t,n=-1){return El(this,e,t,!1,n)}getYMonotonicParts(e,t){return this.getMonotonicParts(e,t)}getMonotonicParts(e,t){e.length<2&&R(``);let n=el(this),r=0;if(n.specialPointsCount()===2)return 0;U(e.length>=n.specialPointsCount()-1);for(let i=1,a=n.specialPointsCount();i<a;++i)this.queryCut(n.specialPoints[i-1],n.specialPoints[i],e[r],t),r++;for(let t=0;t<r;++t)Nl(e[t].get());return r}intersectionWithAxis2D(e,t,n,r){n&&(n.length=9),r&&(r.length=9);let i=[,,,],a=C(P,2),o=new I(0,1),s=0,c=C(z,3);if(this.queryControlPoints(c),e){if(i[0]=new P(c[0].y).sub(t).mul(this.m_weights[0]),i[1]=new P(c[1].y).sub(t).mul(this.m_weights[1]),i[2]=i[0].subE(i[1].mul(2)).addE(new P(c[2].y).sub(t).mul(this.m_weights[2])),i[1]=i[1].subE(i[0]).mulThisByPower2(2),s=ra(i[2],i[1],i[0],o,!1,a),n)for(let e=0;e<s;e++)n[e]=this.getCoordX(a[e].value())}else if(i[0]=new P(c[0].x).sub(t).mul(this.m_weights[0]),i[1]=new P(c[1].x).sub(t).mul(this.m_weights[1]),i[2]=i[0].subE(i[1].mul(2)).addE(new P(c[2].x).sub(t).mul(this.m_weights[2])),i[1]=i[1].subE(i[0]).mulThisByPower2(2),s=ra(i[2],i[1],i[0],o,!1,a),n)for(let e=0;e<s;e++)n[e]=this.getCoordY(a[e].value());if(r)for(let e=0;e<s;e++)r[e]=a[e].value();else n&&Ze(n,0,s,Me);return s}intersectionOfYMonotonicWithAxisX(e,t){if(this.m_YStart===this.m_YEnd)return e===this.m_YStart?t:NaN;if(e===this.m_YStart)return this.m_XStart;if(e===this.m_YEnd)return this.m_XEnd;let n=[NaN,NaN],r=this.intersectionWithAxis2D(!0,e,n,null);return U(r!==2),r===-1?t:n[0]}isCurve(){return!0}isDegenerate(e){return Tr(this,e)}isDegenerate3D(e,t){return!1}queryLooseEnvelope(e){if(e instanceof G)return e.setCoords({pt:this.getStartXY()}),e.mergeNe(this.m_cp),void e.mergeNe(this.getEndXY())}clone(e){let t=this.createInstance();return this.copyTo(t),t}queryInterval(e,t){if(e===0){let e=G.constructEmpty();this.queryEnvelope(e);let n=I.constructEmpty();return t===0?e.queryIntervalX(n):e.queryIntervalY(n),n}return super.queryInterval(e,t)}queryLooseEnvelopeOnInterval(e,t){let n=C(z,3);this.queryControlPoints(n),Ll(n,this.m_weights,e.vmin,e.vmax,n,[0,0,0]),t.setFromPoints(n,3)}changeEndPoints2D(e,t){if(e.isEqual(this.m_XStart,this.m_YStart)&&t.isEqual(this.m_XEnd,this.m_YEnd))return;let n=this.m_cp.isEqual(this.m_XStart,this.m_YStart),r=this.m_cp.isEqual(this.m_XEnd,this.m_YEnd);this.setStartXY(e),this.setEndXY(t),n?this.m_cp.setCoordsPoint2D(e):r&&this.m_cp.setCoordsPoint2D(t),this.normalizeAfterEndpointChange()}tToLength(e){return nl(this,e,!0)}lengthToT(e){return gl(this,e)}calculateWeightedAreaCentroid2D(e){let t=bl(this),n=_l(this);return t.x+=(this.getStartX()-e.x)*n,t.y+=(this.getStartY()-e.y)*n,t}calculateWeightedCentroid2D(){let e=new z;return this.isDegenerate(0)?(e.setCoords(0,0),e):Cl(this)?(e.assign(this.getCoord2D(.5).mul(this.calculateLength2D())),e):(e.assign(Fl(this,1)),e)}getControlPoint1(){return this.m_cp.clone()}setControlPoint1(e){this.m_cp.setCoordsPoint2D(e),this.afterCompletedModification()}queryWeights(e){for(let t=0;t<3;++t)e[t]=this.m_weights[t]}queryCoord2DMP(e,t){let n=C(z,3);return this.queryControlPoints(n),eu(n.map(e=>br.constructPoint2D(e)),this.m_weights.map(e=>A.constructDouble(e)),A.constructDouble(e),t)}setWeights(e){}queryControlPoints(e){e[0].assign(this.getStartXY()),e[1].assign(this.m_cp),e[2].assign(this.getEndXY())}queryControlPointsHelper(e){return this.queryControlPoints(e),3}setControlPointsAndWeights(e,t){this.setCpsAndWeightsArray(e,t),this.afterCompletedModification()}getTangent(e){let t=C(z,3);return this.queryControlPoints(t),ml(t,this.m_weights,e)}getDerivative(e){let t=_e(e,0,1),n=C(z,4);return rl(this,1,t,n),n[1]}getCurvature(e){let t=C(z,4);rl(this,2,e,t);let n=t[1].sqrLength();return n===0?NaN:(t[1].divThis(Math.sqrt(n)),t[1].crossProduct(t[2])/n)}isIntersecting(e,t,n){return!1}isIntersectingPoint(e,t,n){return!1}isIntersectingPoint3D(e,t,n,r,i=1){return!1}isMonotoneQuickAndDirty(){let e=C(z,3);return this.queryControlPoints(e),Ml(e)}getMonotonicPartParams(e,t){let n=el(this),r=n.specialPointsCount();if(!t)return n.specialPointsCount();e<r&&R(``);for(let e=0;e<r;e++)t[e]=n.specialPoints[e];return r}normalizeAfterEndpointChange(){return!1}orientBottomUp(){if(this.m_YEnd<this.m_YStart||this.m_YEnd===this.m_YStart&&this.m_XEnd<this.m_XStart){this.m_XEnd=W(this.m_XStart,this.m_XStart=this.m_XEnd),this.m_YEnd=W(this.m_YStart,this.m_YStart=this.m_YEnd),this.m_weights[2]=W(this.m_weights[0],this.m_weights[0]=this.m_weights[2]);for(let e=0,t=this.m_description.getTotalComponentCount()-2;e<t;e++)this.m_attributes[e+t]=W(this.m_attributes[e],this.m_attributes[e]=this.m_attributes[e+t]);this.m_cachedValues=null}}isLine(){return!1}isDegenerateToLineHelper(e){let t=C(z,3);this.queryControlPoints(t);let n=t[2].sub(t[0]),r=n.length();if(z.distance(t[0],t[1])+z.distance(t[2],t[1])-r>e)return!1;let i=e,a=t[1].clone();return a.subThis(t[0]),!(Math.abs(a.crossProduct(n))/r>i)}copyIgnoreAttributes(e){let t=C(z,3);this.queryControlPoints(t);let n=[0,0,0];this.queryWeights(n),e.setControlPointsAndWeights(t,n)}calculateArea2DHelper(){return _l(this)}absNorm(){return this.getStartXY().norm(1)+this.getEndXY().norm(1)+this.m_cp.norm(1)}absNormXYZ(e){return U(0),0}queryEnvelopeW(e,t){Al(this,e,t)}setSegmentFromCoordsForStitcher(e,t){let n=[0,0,0];this.queryWeights(n),this.constructWeights(e[0],this.getControlPoint1(),e[t-1],n[0],n[1],n[2])}writeInBufferStream(e,t){let n=new Float64Array(5);return n[0]=this.m_cp.x,n[1]=this.m_cp.y,n[2]=this.m_weights[0],n[3]=this.m_weights[1],n[4]=this.m_weights[2],e.writeRangeFromArray(t,n.length,n,!0,1),t+n.length}readFromBufferStream(e,t){let n=new Float64Array(5);e.queryRange(t,n.length,n,!0,1),this.m_cp.x=n[0],this.m_cp.y=n[1],this.m_weights[0]=n[2],this.m_weights[1]=n[3],this.m_weights[2]=n[4],this.m_cachedValues=null}snapControlPoints(e){let t=C(z,3);this.queryControlPoints(t);let n=z.sqrDistance(t[1],t[0]),r=z.sqrDistance(t[1],t[2]),i=t[0].clone(),a=n;n>r&&(i=t[2].clone(),a=r);let o=!1;return a<=e&&a!==0&&(o=!0,this.setControlPoint1(i)),o}needsSnapControlPoints(e){if(!e)return!1;let t=C(z,3);this.queryControlPoints(t);let n=z.sqrDistance(t[1],t[0]),r=z.sqrDistance(t[1],t[2]);t[0].clone();let i=n;return n>r&&(t[2].clone(),i=r),i<=e&&i!==0}calculateSpecialPointsForCracking(e,t){return 0}ensureXYMonotone(){return Nl(this)}setCoordsForIntersector(e,t,n){zl(this,e,t,n)}copyToImpl(e){let t=e;t.m_cp.setCoordsPoint2D(this.m_cp),t.m_weights[0]=this.m_weights[0],t.m_weights[1]=this.m_weights[1],t.m_weights[2]=this.m_weights[2],Tl(t,wl(this))}reverseImpl(){this.m_weights[2]=W(this.m_weights[0],this.m_weights[0]=this.m_weights[2])}equalsImpl(e){let t=e;if(!this.m_cp.equals(t.m_cp))return!1;for(let e=0;e<3;e++)if(this.m_weights[e]!==t.m_weights[e])return!1;return!0}equalsImplTol(e,t){let n=e;if(!this.m_cp.isEqualPoint2D(n.m_cp,t))return!1;let r=C(z,3);this.queryControlPoints(r);let i=C(z,3);n.queryControlPoints(i);let a=[n.m_weights[0],n.m_weights[1],n.m_weights[2]];for(let e=0;e<3;e++){let n=new K;n.setCoordsPoint2DZ(r[e].mul(this.m_weights[e]),this.m_weights[e]);let o=new K;if(o.setCoordsPoint2DZ(i[e].mul(a[e]),a[e]),!n.isEqual(o,t))return!1}return!0}swapImpl(e){let t=e;t.m_cp=W(this.m_cp,this.m_cp=t.m_cp),t.m_weights=W(this.m_weights,this.m_weights=t.m_weights),$c(this,t)}afterCompletedModification(){Qc(this)}intersect(e,t,n,r,i){return Bd(!1,this,e,t,n,r,i)}intersectPoint(e,t,n){return kl(this,e,t,n)}endPointModified(){Qc(this)}clearEndPointModified(){}setCpsAndWeights(e,t,n,r,i,a){(r<=0||a<=0||i<0)&&R(`weights`),(e.isNAN()||t.isNAN()||n.isNAN())&&R(`NAN control points in bezier are not supported`),this.setStartXY(e),this.m_cp.assign(t),this.m_weights[0]=r,this.m_weights[1]=i,this.m_weights[2]=a,this.setEndXY(n)}setCpsAndWeightsArray(e,t){this.setCpsAndWeights(e[0],e[1],e[2],t[0],t[1],t[2])}};ha.type=L.enumRationalBezier2;var ga=Rt,_a=class e extends ai{constructor(e){e===void 0||ue(e,`vd`)?(super({vd:e?.vd,XStart:0,YStart:0,XEnd:0,YEnd:0}),this.m_cp=new z(0,0)):e.from?(super({XStart:e.from.x,YStart:e.from.y,XEnd:e.to.x,YEnd:e.to.y,...e.vd}),this.m_cp=e.cp.clone()):e.points?(super({XStart:e.points[0].x,YStart:e.points[0].y,XEnd:e.points[2].x,YEnd:e.points[2].y,...e.vd}),this.m_cp=e.points[1].clone()):e.copy?(super(e),this.m_cp=e.copy.m_cp.clone()):B(`unexpected constructor args`)}getBoundary(){return Ui(this)}assignCopy(e){return this!==e&&e.copyTo(this),this}construct(e,t,n){this.setStartXY(e),this.m_cp.assign(t),this.setEndXY(n),qa(this)}constructPoints(e){this.setStartXY(e[0]),this.m_cp.assign(e[1]),this.setEndXY(e[2]),qa(this)}getGeometryType(){return L.enumBezier2}queryEnvelope(e){if(e.m_EnvelopeType===2){if(e.setCoords(this.getStartXY()),e.mergeNe(this.getEndXY()),e.contains(this.m_cp))return;let t=co(this);if(t!==null){let n=new z;for(let r of t.specialPoints)this.queryCoord2D(r,n),e.mergeNe(n)}else{let t=[];Xa(this,t);let n=new z;for(let r of t)this.queryCoord2D(r,n),e.mergeNe(n)}return}xt(`env type not impl`)}applyTransformation(e){if(e.m_TransformationType===1){let t=C(z,3);this.queryControlPoints(t),e.transformPoints2D(t,3,t),this.setStartXY(t[0]),this.m_cp.assign(t[1]),this.setEndXY(t[2]),this.afterCompletedModification();return}U(0)}createInstance(){return new e({vd:this.m_description})}calculateLength2D(){return Za(this,1,!1)}calculateLowerLength2D(){return z.distance(this.getStartXY(),this.getEndXY())}calculateUpperLength2D(){return this.calculateUpperLength2D_()}calculateUpperLength2D_(){return z.distance(this.getStartXY(),this.m_cp)+z.distance(this.getEndXY(),this.m_cp)}queryCoord2D(e,t){this.queryCoord2DExtended(e,t,!1)}queryCoord2DExtended(e,t,n){let r=C(z,3);this.queryControlPoints(r),Fo(r,e,t,n)}queryCoord2DE(e,t){Io(this,e,t)}queryCoord2DMP(e,t){U(!1,`bernstein polynomials not ported`)}getCoordX(e){if(e<0||e>1){let t=new z;return this.queryCoord2DExtended(e,t,!0),t.x}if(e<=.5){let t=ye(this.getStartX(),this.m_cp.x,e),n=ye(this.m_cp.x,this.getEndX(),e);return ye(t,n,e)}{let t=T(this.getStartX(),this.m_cp.x,e),n=T(this.m_cp.x,this.getEndX(),e);return T(t,n,e)}}getCoordY(e){if(e<0||e>1){let t=new z;return this.queryCoord2DExtended(e,t,!0),t.y}if(e<=.5){let t=ye(this.getStartX(),this.m_cp.x,e),n=ye(this.m_cp.x,this.getEndX(),e);return ye(t,n,e)}{let t=T(this.getStartY(),this.m_cp.y,e),n=T(this.m_cp.y,this.getEndY(),e);return T(t,n,e)}}cut(e,t,n){let r=new Q;return this.queryCut(e,t,r,n),r.releaseSegment()}queryCut(e,t,n,r){let i=n.createQuadraticBezier();if(this.cutBezierIgnoreAttributes(e,t,i),r)return;i.assignVertexDescription(this.m_description);let a=this.m_description.getAttributeCount();if(a>1){for(let t=1;t<a;t++){let n=this.m_description.getSemantics(t),r=ga.getComponentCount(n);for(let t=0;t<r;t++){let r=this.getAttributeAsDbl(e,n,t);i.setStartAttribute(n,t,r)}}for(let e=1;e<a;e++){let n=this.m_description.getSemantics(e),r=ga.getComponentCount(n);for(let e=0;e<r;e++){let r=this.getAttributeAsDbl(t,n,e);i.setEndAttribute(n,e,r)}}}}queryDerivative(e,t){Ro(this,e,t)}cutBezierIgnoreAttributes(e,t,n){if((e<0||t>1||e>t)&&R(`Quadratic_bezier.cut_bezier_ignore_attributes`),e===0&&t===1)return n.setStartXY(this.getStartXY()),n.m_cp.assign(this.m_cp),void n.setEndXY(this.getEndXY());let r=C(z,3);this.queryControlPoints(r),xo(r,e,t,r),n.constructPoints(r)}splitBezierIgnoreAttributes(e,t,n){U(0)}getAttributeAsDbl(e,t,n){if(t===0)return n===0?this.getCoordX(e):this.getCoordY(e);let r=this.calculateLength2D(),i=r>0?this.tToLength(e)/r:0,a=ga.getInterpolation(t),o=this.getStartAttributeAsDbl(t,n),s=this.getEndAttributeAsDbl(t,n);return le(a,o,s,i,ga.getDefaultValue(t))}getClosestCoordinate(e,t){return uo(this,e,I.unit(),t)}getClosestCoordinateOnInterval(e,t,n=-1){return uo(this,e,t,!1)}getYMonotonicParts(e,t){return this.getMonotonicParts(e,t)}getMonotonicParts(e,t){e.length<2&&R(``);let n=Ya(this),r=0;if(n.specialPointsCount()===2)return 0;U(e.length>=n.specialPointsCount()-1);for(let i=1,a=n.specialPointsCount();i<a;++i)this.queryCut(n.specialPoints[i-1],n.specialPoints[i],e[r],t),r++;for(let t=0;t<r;++t)_o(e[t].get());return r}intersectionWithAxis2D(e,t,n,r){let i=C(P,3),a=C(P,2),o=new I(0,1),s=0;if(e){if(i[0]=new P(this.getStartY()).sub(t),i[1]=new P(this.m_cp.y).subE(new P(this.getStartY())).mulThisByPower2(2),i[2]=new P(this.getStartY()).add(this.getEndY()).subE(new P(this.m_cp.y).mulThisByPower2(2)),s=ra(i[2],i[1],i[0],o,!1,a),n)for(let e=0;e<s;e++)n[e]=this.getCoordX(a[e].value())}else if(i[0]=new P(this.getStartX()).sub(t),i[1]=new P(this.m_cp.x).subE(new P(this.getStartX())).mulThisByPower2(2),i[2]=new P(this.getStartX()).add(this.getEndX()).subE(new P(this.m_cp.x).mulThisByPower2(2)),s=ra(i[2],i[1],i[0],o,!1,a),n)for(let e=0;e<s;e++)n[e]=this.getCoordY(a[e].value());if(r)for(let e=0;e<s;e++)r[e]=a[e].value();else n&&ct(n,s);return s}intersectionOfYMonotonicWithAxisX(e,t){if(this.m_YStart===this.m_YEnd)return e===this.m_YStart?t:NaN;if(e===this.m_YStart)return this.m_XStart;if(e===this.m_YEnd)return this.m_XEnd;let n=[0,0],r=this.intersectionWithAxis2D(!0,e,n,null);return U(r!==2),r===-1?t:n[0]}isCurve(){return!0}isLine(){return!1}isDegenerate(e){return Tr(this,e)}isDegenerate3D(e,t){return U(0),!1}queryLooseEnvelope(e){if(e.m_EnvelopeType===2)return e.setCoords(this.getStartXY()),e.mergeNe(this.m_cp),void e.mergeNe(this.getEndXY());U(0)}clone(e){let t=this.createInstance();return this.copyTo(t),t}queryInterval(e,t){if(e===0){let e=new G;this.queryEnvelope(e);let n=new I;return t===0?e.queryIntervalX(n):e.queryIntervalY(n),n}return super.queryInterval(e,t)}queryLooseEnvelopeOnInterval(e,t){let n=C(z,4);this.queryControlPoints(n),xo(n,e.vmin,e.vmax,n),t.setFromPoints(n,4)}changeEndPoints2D(e,t){if(e.isEqual(this.m_XStart,this.m_YStart)&&t.isEqual(this.m_XEnd,this.m_YEnd))return;let n=this.m_cp.isEqual(this.m_XStart,this.m_YStart),r=this.m_cp.isEqual(this.m_XEnd,this.m_YEnd);this.setStartXY(e),this.setEndXY(t),n?this.m_cp.setCoordsPoint2D(e):r&&this.m_cp.setCoordsPoint2D(t),this.normalizeAfterEndpointChange()}tToLength(e){return Za(this,e,!0)}lengthToT(e){return io(this,e)}calculateWeightedAreaCentroid2D(e){let t=C(z,3);jo(this,t);let n=t[2],r=t[1],i=new z,a=n.y*r.x-n.x*r.y;i.x=-(4*n.x+5*r.x)*a/60,i.y=-(4*n.y+5*r.y)*a/60;let o=ao(this);return i.x+=(t[0].x-e.x)*o,i.y+=(t[0].y-e.y)*o,i}calculateWeightedCentroid2D(){let e=new z;return this.isDegenerate(0)?(e.setCoords(0,0),e):so(this)?(e.assign(this.getCoord2D(.5).mul(this.calculateLength2D())),e):(e.assign(yo(this,1)),e)}getControlPoint1(){return this.m_cp.clone()}setControlPoint1(e){this.m_cp.setCoordsPoint2D(e),this.afterCompletedModification()}queryControlPoints(e){e[0].assign(this.getStartXY()),e[1].assign(this.m_cp),e[2].assign(this.getEndXY())}queryControlPointsHelper(e){return this.queryControlPoints(e),3}setControlPoints(e){for(let t=0;t<3;t++)e[t].isNAN()&&R(`NaN control points in bezier are not supported`);this.m_XStart=e[0].x,this.m_YStart=e[0].y,this.m_cp.setCoordsPoint2D(e[1]),this.m_XEnd=e[2].x,this.m_YEnd=e[2].y,this.afterCompletedModification()}getTangent(e){let t=_e(e,0,1),n=to(this,1,t);return n.isZero()&&(n=to(this,2,t),t===1&&n.negateThis()),n}getDerivative(e){return to(this,1,_e(e,0,1))}getCurvature(e){let t=to(this,1,e),n=to(this,2,e),r=t.sqrLength();return r===0?NaN:(t.divThis(Math.sqrt(r)),t.crossProduct(n)/r)}isIntersecting(e,t,n){return Id(!1,this,e,t,n)!==0}isIntersectingPoint(e,t,n){if(n&&(e.isEqualPoint2D(this.getStartXY())||e.isEqualPoint2D(this.getEndXY())))return!1;let r=new G;if(this.queryLooseEnvelope(r),r.inflateCoords(t,t),!r.contains(e))return!1;let i=this.getClosestCoordinate(e,!1),a=new z;return this.queryCoord2D(i,a),z.distance(a,e)<=t}isIntersectingPoint3D(e,t,n,r,i=1){return U(0),!1}isMonotoneQuickAndDirty(){return!1}getMonotonicPartParams(e,t){let n=Ya(this),r=n.specialPointsCount();if(!t)return n.specialPointsCount();e<r&&R(``);for(let e=0;e<r;e++)t[e]=n.specialPoints[e];return r}normalizeAfterEndpointChange(){return!1}orientBottomUp(){if(this.m_YEnd<this.m_YStart||this.m_YEnd===this.m_YStart&&this.m_XEnd<this.m_XStart){W(this.m_XStart,this.m_XStart=this.m_XEnd),W(this.m_YStart,this.m_YStart=this.m_YEnd);for(let e=0,t=this.m_description.getTotalComponentCount()-2;e<t;e++)this.m_attributes[e+t]=W(this.m_attributes[e],this.m_attributes[e]=this.m_attributes[e+t]);this.m_cachedValues=null}}isDegenerateToLineHelper(e){let t=C(z,3);this.queryControlPoints(t);let n=t[2].sub(t[0]),r=n.length();if(z.distance(t[0],t[1])+z.distance(t[2],t[1])-r>e)return!1;let i=e,a=t[1].clone();return a.subThis(t[0]),!(Math.abs(a.crossProduct(n))/r>i)}copyIgnoreAttributes(e){let t=C(z,3);this.queryControlPoints(t),e.setControlPoints(t)}calculateArea2DHelper(){return ao(this)}absNorm(){return Co(this)}queryEnvelopeW(e,t){let n=C(z,3);this.queryControlPoints(n),ho(n,e,t)}setSegmentFromCoordsForStitcher(e,t){this.construct(e[0],this.getControlPoint1(),e[t-1])}snapControlPoints(e){return Vo(this,e)}writeInBufferStream(e,t){let n=new Float64Array(2);return n[0]=this.m_cp.x,n[1]=this.m_cp.y,e.writeRangeFromArray(t,n.length,n,!0,1),t+n.length}readFromBufferStream(e,t){let n=new Float64Array(2);e.queryRange(t,n.length,n,!0,1),this.m_cp.x=n[0],this.m_cp.y=n[1],this.m_cachedValues=null}needsSnapControlPoints(e){return Ho(this,e)}calculateSpecialPointsForCracking(e,t){return 0}ensureXYMonotone(){return _o(this)}setCoordsForIntersector(e,t,n){So(this,e,t,n)}copyToImpl(e){let t=e;t.m_cp.setCoordsPoint2D(this.m_cp),lo(t,co(this))}reverseImpl(){}equalsImplTol(e,t){let n=e;return!!this.m_cp.isEqualPoint2D(n.m_cp,t)}equalsImpl(e){let t=e;return!!this.m_cp.equals(t.m_cp)}swapImpl(e){let t=e;t.m_cp=W(this.m_cp,this.m_cp=t.m_cp),Ja(this,t)}afterCompletedModification(){qa(this)}intersect(e,t,n,r,i){return Bd(!1,this,e,t,n,r,i)}intersectPoint(e,t,n){return po(this,e,t.length,t,n)}endPointModified(){qa(this)}clearEndPointModified(){}};_a.type=L.enumBezier2;var va=class{constructor(e){e.coefsT?(this.m_zeroCtor=e.zeroCtor,this.m_elements=e.coefsT.map(e=>e.clone()),U(this.m_elements.length===e.power+1),this.updatePower()):e.coef0?(this.m_zeroCtor=e.zeroCtor,this.m_elements=[e.coef0.clone()]):e.copy?(this.m_zeroCtor=e.copy.m_zeroCtor,this.m_elements=e.copy.m_elements.map(e=>e.clone())):(this.m_zeroCtor=e.zeroCtor,this.m_elements=[new this.m_zeroCtor])}construct(e,t){return this.m_elements=e.map(e=>e.clone()),this.updatePower(),this}construct0(e){return this.m_elements.length=0,this.m_elements.push(e.clone()),this.updatePower(),this}assignCopy(e){return this.m_elements=e.m_elements.map(e=>e.clone()),this.updatePower(),this}assignMove(e){return this.m_elements=e.m_elements,e.m_elements=[],this.updatePower(),this}power(){return this.m_elements.length-1}addElement(e){this.m_elements.push(e.clone())}scaleRangeToUnitInterval(e,t){let n=t;n.subThis(e);let r=this.power();for(let t=0;t<=r;t++){let i=new this.m_zeroCtor;for(let n=t;n<=r;n++){let r=this.m_elements[n];r.mulDoubleThis(ke(n,t));let a=e.pow(n-t);r.mulThis(a),i.addThis(r)}let a=n.pow(t);i.mulThis(a),this.m_elements[t]=i}}fmSubThis(e,t){return U(0),this}addThis(e){let t=Math.min(this.power(),e.power());for(let n=0;n<=t;++n)this.m_elements[n].addThis(e.m_elements[n]);let n=e.power();this.m_elements.length=Math.max(this.power(),e.power())+1;for(let r=t+1;r<=n;++r)this.m_elements[r]=e.m_elements[r];return this.updatePower(),this}add0(e){return this.m_elements[0].addThis(e),this.updatePower(),this}addNumber0(e){return U(0),this}sub(e){let t=Math.min(this.power(),e.power());for(let n=0;n<=t;++n)this.m_elements[n].subThis(e.m_elements[n]);let n=e.power();this.m_elements.length=Math.max(this.power(),e.power())+1;for(let r=t+1;r<=n;++r)this.m_elements[r]=e.m_elements[r].clone(),this.m_elements[r].negateThis();return this.updatePower(),this}sub0(e){return U(0),this}subNumber0(e){return U(0),this}subShifted(e,t){let n=this.power(),r=e.power()+t,i=Math.min(this.power(),r),a=0;for(let n=t;n<=i;++n)this.m_elements[n].subThis(e.m_elements[a]),a++;if(r<=n)return this.updatePower(),this;this.m_elements.length=r+1;for(let e=n+1;e<this.m_elements.length;++e)this.m_elements[e]=new this.m_zeroCtor;for(let t=i+1;t<=r;++t)this.m_elements[t].subThis(e.m_elements[a++]);return this.updatePower(),this}subShiftedWithCoef(e,t,n){let r=this.power(),i=e.power()+n,a=Math.min(this.power(),i),o=0;for(let r=n;r<=a;++r)this.m_elements[r].fmSubThis(e.m_elements[o],t),o++;if(i<=r)return this.updatePower(),this;this.m_elements.length=i+1;for(let e=r+1;e<this.m_elements.length;++e)this.m_elements[e]=new this.m_zeroCtor;for(let n=a+1;n<=i;++n)this.m_elements[n].fmSubThis(e.m_elements[o++],t);return this.updatePower(),this}mulThis(e){if(this.constructor===e.constructor){let t=e,n=[];for(let e=0,r=this.power();e<=r;e++)for(let r=0,i=t.power();r<=i;r++){let i=this.m_elements[e].clone();i.mulThis(t.m_elements[r]),e+r<n.length?n[e+r].addThis(i):n.push(i)}this.m_elements=n}else for(let t=0,n=this.power();t<=n;t++)this.m_elements[t].mulThis(e);return this.updatePower(),this}mulElementThis(e){for(let t=0,n=this.power();t<=n;t++)this.m_elements[t].mulThis(e);return this.updatePower(),this}mulDoubleThis(e){for(let t=0,n=this.power();t<=n;t++)this.m_elements[t].mulDoubleThis(e);return this.updatePower(),this}mulNumber0(e){return U(0),this}mulBigint0(e){return U(0),this}mulBigIntThis(e){return U(0),this}mulInt320(e){return U(0),this}div0(e){return U(0),this}absThis(){return U(0),this}div(e,t,n){if(this.power()<e.power())return n.assignCopy(this),void t.setZero();n.setZero(),t.setZero();let r=e.getElement(e.power()),i=this.clone(),a=i.power(),o=i.power()-e.power(),s=o;for(t.m_elements=C(t.m_zeroCtor,o+1);;){if(a<e.power()){n.assignMove(i);break}if(a===i.power()){let n=i.getElement(i.power());n.divThis(r),i.subShiftedWithCoef(e,n,i.power()-e.power()),t.m_elements[s]=n.clone()}s--,a--}n.updatePower(),t.updatePower()}divThis(e){return U(0),this}subThis(e){let t=Math.min(this.power(),e.power());for(let n=0;n<=t;++n)this.m_elements[n].subThis(e.m_elements[n]);let n=e.power();this.m_elements.length=Math.max(this.power(),e.power())+1;for(let r=t+1;r<=n;++r)this.m_elements[r]=e.m_elements[r].clone(),this.m_elements[r].negateThis();return this.updatePower(),this}sub0This(e){return this.m_elements[0].subThis(e),this.updatePower(),this}subFrom(e,t){U(0)}isZero(){return this.power()===0&&this.m_elements[0].isZero()}negateThis(){for(let e=this.m_elements.length-1;e>=0;e--)this.m_elements[e].negateThis();return this}getElement(e){return this.m_elements[e].clone()}setElement(e,t){return this.m_elements[e]=t.clone(),this}evaluate(e){let t=this.power(),n=this.m_elements[t].clone();for(let r=t-1;r>=0;--r)n.mulThis(e),n.addThis(this.m_elements[r]);return n}equals(e){if(this===e)return!0;if(this.power()!==e.power())return!1;for(let t=this.m_elements.length-1;t>=0;t--)if(!this.m_elements[t].equals(e.m_elements[t]))return!1;return!0}updatePower(){for(let e=this.m_elements.length-1;e>0&&this.m_elements[e].isZero();e--)this.m_elements.pop();return this}setZero(){return this.m_elements.length=1,this.m_elements[0]=new this.m_zeroCtor,this.updatePower(),this}derivative(e){if(this.power()<e)return this.clone().setZero();if(e===0)return this.clone();let t=new this.constructor({coefsT:this.m_elements.slice(e),power:this.power()-e});for(let n=e,r=this.power();n<=r;n++){let r=BigInt(n);for(let t=n-1,i=n-e;t>i;--t)r*=BigInt(t);t.m_elements[n-e].mulBigIntThis(r)}return t.updatePower(),t}derivative1This(){if(this.m_elements.length>1){this.m_elements=this.m_elements.slice(1);for(let e=1,t=this.power();e<=t;e++)this.m_elements[e].mulThis(A.constructInt32(e+1))}else this.m_elements.length=0,this.m_elements.push(new this.m_zeroCtor);return this}limitPrecisionThis(e){for(let t=this.power();t>=0;--t)this.m_elements[t].limitPrecisionThis(e);return this.updatePower(),this}hiBitIndex(){return this.m_elements.reduce((e,t)=>{let n=t.hiBitIndex();return e<n?n:e},0)}shiftRight(e){return this.m_elements.splice(0,e),this.updatePower(),this}evaluateDerivative(e){let t=this.power(),n=this.m_elements[t];n.mulDoubleThis(t);for(let r=t-1;r>=1;--r){n.mulThis(e);let t=this.m_elements[r];t.mulDoubleThis(r),n.addThis(t)}return n}static evaluateCoefs(e,t,n){let r=e.power();n.construct0(e.getElement(0).evaluate(t));for(let i=1;i<=r;++i)n.addElement(e.getElement(i).evaluate(t));n.updatePower()}},Y=class e extends va{constructor(e){super(e===void 0?{zeroCtor:A}:{...e,zeroCtor:A})}clone(){return new e({copy:this})}absEvaluate(e){let t=this.power(),n=this.m_elements[t].clone();n.absThis();let r=e.clone();r.absThis();for(let e=t-1;e>=0;--e)n.mulThis(r),n.addThis(this.m_elements[e].abs());return n}},ya=class e extends va{constructor(e){super(e===void 0?{zeroCtor:Y}:{...e,zeroCtor:Y})}clone(){return new e({copy:this})}constructFromMPValues(e,t){this.m_elements.length=0;for(let n=0;n<=t;++n)this.m_elements.push(new Y({coef0:e[n]}));return this.updatePower(),this}};function ba(){return{polypoly1:new ya,polypoly2:new ya,polyX2:new Y,polyY2:new Y,polyX2Deriv:new Y,polyY2Deriv:new Y,polypolyX1:new ya,polypolyY1:new ya,polypolyX1Deriv:new ya,polypolyY1Deriv:new ya,lazyPolypolyD1:new ya,lazyPolypolyD1Deriv:new ya,lazyPolyD2:new Y,lazyPolyD2Deriv:null,polypoly11:new ya,polypoly12:new ya,tempPp:new ya,tempPp1:new ya,tempPp2:new ya,tempP:new Y,tempP1:new Y,tempP2:new Y}}function xa(e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h,g,_,v,y=!1){let b=ba();b.polyX2.construct(o,s),b.polyY2.construct(c,l),b.polypolyX1.constructFromMPValues(e,t),b.polypolyY1.constructFromMPValues(n,r),b.polypoly11.assignCopy(b.polypolyX1),b.polypoly12.assignCopy(b.polypolyY1),u&&(b.lazyPolyD2.construct(u,d),b.polypoly11.mulElementThis(b.lazyPolyD2),b.polypoly12.mulElementThis(b.lazyPolyD2)),i?(b.lazyPolypolyD1.constructFromMPValues(i,a),b.lazyPolypolyD1Deriv=new ya({copy:b.lazyPolypolyD1}),b.lazyPolypolyD1Deriv.derivative1This(),b.tempPp.assignCopy(b.lazyPolypolyD1),b.tempPp.mulElementThis(b.polyX2),b.polypoly11.subThis(b.tempPp),b.tempPp.assignCopy(b.lazyPolypolyD1),b.tempPp.mulElementThis(b.polyY2),b.polypoly12.subThis(b.tempPp)):(b.polypoly11.sub0This(b.polyX2),b.polypoly12.sub0This(b.polyY2)),b.polypolyX1Deriv.assignCopy(b.polypolyX1),b.polypolyX1Deriv.derivative1This(),b.polypolyY1Deriv.assignCopy(b.polypolyY1),b.polypolyY1Deriv.derivative1This(),i&&(b.polypolyX1Deriv.mulThis(b.lazyPolypolyD1),b.tempPp2.assignCopy(b.lazyPolypolyD1Deriv),b.tempPp2.mulThis(b.polypolyX1),b.polypolyX1Deriv.subThis(b.tempPp2),b.polypolyY1Deriv.mulThis(b.lazyPolypolyD1),b.tempPp2.assignCopy(b.lazyPolypolyD1Deriv),b.tempPp2.mulThis(b.polypolyY1),b.polypolyY1Deriv.subThis(b.tempPp2)),b.polyX2Deriv.assignCopy(b.polyX2),b.polyX2Deriv.derivative1This(),b.polyY2Deriv.assignCopy(b.polyY2),b.polyY2Deriv.derivative1This(),u&&(U(b.lazyPolyD2Deriv===null),b.lazyPolyD2Deriv=new Y({copy:b.lazyPolyD2}),b.lazyPolyD2Deriv.derivative1This(),b.polyX2Deriv.mulThis(b.lazyPolyD2),b.tempP1.assignCopy(b.lazyPolyD2Deriv),b.tempP1.mulThis(b.polyX2),b.polyX2Deriv.subThis(b.tempP1),b.polyY2Deriv.mulThis(b.lazyPolyD2),b.tempP1.assignCopy(b.lazyPolyD2Deriv),b.tempP1.mulThis(b.polyY2),b.polyY2Deriv.subThis(b.tempP1)),b.polypoly1.assignCopy(b.polypoly11),b.polypoly1.mulElementThis(b.polyX2Deriv),b.tempPp.assignCopy(b.polypoly12),b.tempPp.mulElementThis(b.polyY2Deriv),b.polypoly1.addThis(b.tempPp),b.polypoly2.assignCopy(b.polypolyX1Deriv),b.polypoly2.mulElementThis(b.polyY2Deriv),b.tempPp.assignCopy(b.polypolyY1Deriv),b.tempPp.mulElementThis(b.polyX2Deriv),b.polypoly2.subThis(b.tempPp);let x=[],S=[];g||=[],h||=[],ja(b.polypoly11,b.polypoly12,b.tempP);let C=ce.ldexp(-59).toDouble(),w=[],T=Ma(b.tempP,f,m,C,64,w,_,_);if(T<0)return-1;for(let e=0;e<T;e++){let t=b.tempP1,n=b.tempP2;Y.evaluateCoefs(b.polypoly11,w[e],t);let r=He(t.m_elements,t.power()+1);r.sort((e,t)=>e.compare(t)),Y.evaluateCoefs(b.polypoly12,w[e],n);let i=He(n.m_elements,n.power()+1);i.sort((e,t)=>e.compare(t));let a=r[0],o=r.at(-1),s=i[0],c=i.at(-1);o.subThis(a),c.subThis(s);let l=o.subThis(c).GEZ(),u=ce.ldexp(-59).toDouble(),d=[],m;if(m=Ma(l?t:n,f,p,u,58,d,_,_),m<0&&B(`mp_curve_proximity`),m>0){let r=l?n:t;for(let t=0;t<m;t++){let n;if(l){let r=b.tempP;Y.evaluateCoefs(b.polypoly12,w[e].addDouble(2**-52),r),n=r.evaluate(d[t])}else{let r=b.tempP;Y.evaluateCoefs(b.polypoly11,w[e].addDouble(2**-52),r),n=r.evaluate(d[t])}let i=r.evaluateDerivative(d[t]).abs().mulDoubleThis(2**-52),a=r.evaluate(d[t]);i.addThis(n.sub(a).absThis()),i.ldexpThis(3),a.absThis(),a.lt(i)?S.push(lt(d[t].toDouble(),w[e].toDouble())):U(a.gte(i))}}}T=S.length,ja(b.polypoly1,b.polypoly2,b.tempP);let E=[],D=Ma(b.tempP,f,m,C,64,E);D<0&&(D=0);for(let e=0;e<D;e++){Y.evaluateCoefs(b.polypoly1,E[e],b.tempP1);let t=[],n=Ma(b.tempP1,f,p,C,64,t);if(n!==0)if(Y.evaluateCoefs(b.polypoly2,E[e],b.tempP2),n<0){if(n=Ma(b.tempP2,f,p,C,64,t),n<0)continue;for(let r=0;r<n;r++)x.push(lt(t[r].toDouble(),E[e].toDouble()))}else{let r=b.tempP2.absEvaluate(ce);r.mulThis(A.constructDouble(1e-12));for(let i=0;i<n;i++){let n=b.tempP2.evaluate(t[i]);n.absThis(),n.lt(r)&&x.push(lt(t[i].toDouble(),E[e].toDouble()))}}}if(D=x.length,T===0&&D===0)return 0;x=x.concat(S),x.sort((e,t)=>y?Me(e.second,t.second):Me(e.first,t.first));let O=Xe(x,(e,t)=>e.first===t.first&&e.second===t.second);x=x.slice(0,O),h.length=0,g.length=0;for(let e of x)h.push(e.first),g.push(e.second);return U(h.length===g.length),g.length}function Sa(e,t,n,r,i,a,o){if(e.power()===0)return e.isZero()?-1:0;let s=e.evaluate(A.constructInt32(1)).isZero();if(e.power()===1){let n=Ta(e.getElement(1),e.getElement(0),t,a.at(0));return a[0].limitPrecisionThis(r),n===1?(a[0].limitPrecisionThis(r),1):0}return e.power()===2?Ea(e.getElement(2),e.getElement(1),e.getElement(0),r,t,s,a):e.power()===3?Da(e.getElement(3),e.getElement(2),e.getElement(1),e.getElement(0),r,t,s,a):e.power()===4?Oa(e.getElement(4),e.getElement(3),e.getElement(2),e.getElement(1),e.getElement(0),r,t,s,a):La(e,t,n,r,s,i,a,o)}function Ca(){return{polyIntersect:new Y,polyX1:new Y,polyY1:new Y,polyX1Deriv:new Y,polyY1Deriv:new Y,lazyPolyD1:new Y,lazyPolyD1Deriv:new Y,tempP:new Y,tempP1:new Y,tempP2:new Y,polypoly1Proximity:new ya,polypoly2Proximity:new ya}}function wa(e,t,n,r,i,a,o,s,c,l,u,d,f){let p=Ca();p.polyX1.construct(e,t),p.polyY1.construct(n,r),p.polyX1Deriv.assignCopy(p.polyX1),p.polyX1Deriv.derivative1This(),p.polyY1Deriv.assignCopy(p.polyY1),p.polyY1Deriv.derivative1This(),p.polyIntersect.assignCopy(p.polyX1),p.polyIntersect.mulThis(p.polyX1),p.polyIntersect.mulElementThis(o[0]),p.tempP.assignCopy(p.polyY1),p.tempP.mulThis(p.polyY1),p.tempP.mulElementThis(o[1]),p.polyIntersect.addThis(p.tempP),i?(p.lazyPolyD1.construct(i,a),p.tempP.assignCopy(p.lazyPolyD1),p.tempP.mulThis(p.lazyPolyD1),p.tempP.mulElementThis(o[2]),p.polyIntersect.addThis(p.tempP)):p.polyIntersect.add0(o[2]);{let i=o[0].clone(),a=i.clone();a.sqrThis();let s=o[1].clone(),c=s.clone();c.sqrThis();let l=o[2].clone(),u=i.clone();u.subThis(s),p.polyX1.construct(e,t),p.polyX1Deriv.assignCopy(p.polyX1),p.polyX1Deriv.derivative1This(),p.polyY1.construct(n,r),p.polyY1Deriv.assignCopy(p.polyY1),p.polyY1Deriv.derivative1This(),p.tempP.assignCopy(p.polyX1),p.tempP.mulThis(p.polyX1),p.tempP.mulElementThis(c),p.tempP.mulElementThis(l),p.polypoly1Proximity.construct0(p.tempP),p.tempP.assignCopy(p.polyX1),p.tempP.mulThis(s.mul(u).mul(l).ldexpThis(1)),p.polypoly1Proximity.addElement(p.tempP),p.tempP.assignCopy(p.polyX1),p.tempP.mulThis(p.polyX1),p.tempP.mulElementThis(i.mul(c)),p.tempP1.assignCopy(p.polyY1),p.tempP1.mulThis(p.polyY1),p.tempP1.mulElementThis(a.mul(s)),p.tempP.addThis(p.tempP1),p.tempP.add0(u.mul(u).mul(l)),p.polypoly1Proximity.addElement(p.tempP),p.tempP.assignCopy(p.polyX1),p.tempP.mulElementThis(u.mul(i).mul(s).ldexpThis(1)),p.polypoly1Proximity.addElement(p.tempP),p.tempP.construct0(i.mul(u).mul(u)),p.polypoly1Proximity.addElement(p.tempP),p.polypoly1Proximity.updatePower(),p.tempP.construct0(Ce),p.polypoly2Proximity.construct0(p.tempP),p.tempP.assignCopy(p.polyX1),p.tempP.mulThis(p.polyX1Deriv),p.tempP1.assignCopy(p.polyY1),p.tempP1.mulThis(p.polyY1Deriv),p.tempP.addThis(p.tempP1),p.tempP.mulElementThis(i.mul(s)),p.polypoly2Proximity.addElement(p.tempP),p.tempP.assignCopy(p.polyX1Deriv),p.tempP.mulElementThis(u.mul(i)),p.polypoly2Proximity.addElement(p.tempP),p.polypoly2Proximity.updatePower()}let m=[],h=[];u===null&&(u=[]);let g=2*p.polyIntersect.power()+58,_=.5*2**-52,y=[],b=Ma(p.polyIntersect,s,c,_,g,y,d,d);if(b<0)return-1;for(let e of y)h.push(e.toDouble());ja(p.polypoly1Proximity,p.polypoly2Proximity,p.tempP),g=2*p.tempP.power()+58,y.length=0;let x=Ma(p.tempP,s,c,_,g,y);if(x<0&&(x=0),b===0&&x===0)return 0;for(let e of y)m.push(e.toDouble());let S=m.concat(h);return u.length=S.length,Qe(u,S,0,0,S.length),v(u),u.length=Xe(u,(e,t)=>Me(e,t)===0),u.length}function Ta(e,t,n,r){return e.isZero()?t.isZero()?-1:0:(r.setThis(t),r.negateThis(),r.divThis(e),n.isEmpty()||n.containsCoordinate(r.value())?1:0)}function Ea(e,t,n,r,i,a,o){if(e.isZero())return a?(o[0].setInt32(1),i.containsCoordinate(1)?1:0):Ta(t,n,i,o[0]);if(a){let t=2;return o[0].setInt32(1),n.equals(e)?(o[1].setInt32(1),t=1):o[1].setThis(n.div(e)),i.containsCoordinate(o[1].value())||(t=1),i.containsCoordinate(o[0].value())||(t--,o[0].setThis(o[1])),t===2&&o[0].value()>o[1].value()&&(o[1]=W(o[0],o[0]=o[1])),t}let s=t.clone();s.sqrThis();let c=e.clone();if(c.mulThis(n).ldexpThis(2).negateThis().addThis(s),c.LZ())return 0;let l=r+2,u=A.sqrt(c,l),d=u.clone();t.LZ()&&d.negateThis(),d.addThis(t).limitPrecisionThis(l).ldexpThis(-1).negateThis();let f=0;return o[0].setThis(d).divThis(A.constructAssign(e,l)).limitPrecisionThis(r),(i.isEmpty()||i.containsCoordinate(o[0].value()))&&f++,u.isZero()||d.isZero()||(o[f].setThis(n).divThis(d).limitPrecisionThis(r),(i.isEmpty()||i.containsCoordinate(o[f].value()))&&f++,f===2&&o[0].gt(o[1])&&(o[1]=W(o[0],o[0]=o[1]))),f}function Da(e,t,n,r,i,a,o,s){if(e.isZero())return Ea(t,n,r,i,a,o,s);let c=(e,t)=>{if(e>0){let n=t+e;for(let e=1;e<n;e++)s[e].equals(s[0])&&(s[n-1]=W(s[e],s[e]=s[n-1]),n--);t=n}return Ze(s,0,t,(e,t)=>e.compare(t)),t};if(r.isZero()){let r=0;return a.containsCoordinate(0)&&(s[0].setInt32(0),r=1),c(Ea(e,t,n,i,a,o,s.slice(1)),r)}if(o){let n=0;a.containsCoordinate(1)&&(s[0].setInt32(1),n=1);let o=t.add(e),l=r.negate(),u=e.add(o).add(l).isZero();return c(Ea(e,o,l,i,a,u,s.slice(n)),n)}let l=new A,u=new A,d=new A,f=t.clone();if(f.isZero())u.setThis(n),u.divThis(e),d.setThis(r),d.divThis(e);else{f.divThis(e).divDoubleThis(3).negateThis();let i=t.clone();i.sqrThis();let a=e.clone();a.sqrThis(),u.setThis(e),u.mulThis(n).mulDoubleThis(3).subThis(i).divThis(a).divDoubleThis(3),d.setThis(i),d.mulThis(t),d.ldexpThis(1),l.setThis(e),l.mulThis(t).mulThis(n).mulDoubleThis(9),d.subThis(l),l.setThis(a),l.mulThis(r).mulDoubleThis(27),d.addThis(l),d.divThis(a).divThis(e).divDoubleThis(27)}if(u.isZero()){let e=d.clone();return e.negateThis(),e.isZero()?(s[0].setThis(f),za(a,i,s,1)):(s[0].setThis(A.cubicRoot(e,i).add(f)),za(a,i,s,1))}let p=d.clone();if(p.sqrThis().ldexpThis(-2),l.setThis(u.clone()),l.sqrThis().mulThis(u).divDoubleThis(27),p.addThis(l),p.isZero())return s[0].setThis(d),s[0].mulDoubleThis(3).divThis(u),s[1].setThis(s[0]),s[1].negateThis(),s[1].ldexpThis(-1),s[0].addThis(f),s[1].addThis(f),za(a,i,s,2);if(p.GZ())return p.setThis(A.sqrt(p,i+8)),l.setThis(d),l.ldexpThis(-1).negateThis(),l.addThis(p),s[0].setThis(A.cubicRoot(l,i+8)),l.setThis(d),l.ldexpThis(-1).negateThis(),l.subThis(p),s[0].addThis(A.cubicRoot(l,i+8)),s[0].addThis(f),za(a,i,s,1);l.setThis(u),l.divDoubleThis(3).negateThis(),U(l.GEZ());let m=A.sqrt(l,i+8),h=m.clone();h.negateThis(),h.addThis(f),m.addThis(f);let g=A.constructDouble(a.isEmpty()?-Number.MAX_VALUE:a.vmin),_=A.constructDouble(a.isEmpty()?Number.MAX_VALUE:a.vmax),v=new Y({zeroCtor:A});v.construct0(r),v.addElement(n),v.addElement(t),v.addElement(e);let y=new Y({copy:v});y.derivative1This();let b=0,x=C(A,4);x[b++].setThis(g),h.gt(g)&&h.lt(_)&&x[b++].setThis(h),m.gt(g)&&m.lt(_)&&x[b++].setThis(m),x[b++].setThis(_);let S=3*i,w=52,T=2**-52;for(;w<S;)2*w<=S?(T*=T,w*=2):(T*=2**-52,w+=52);w+=2;let E=0,D=!1;for(let e=1;e<b;e++)if(Fa(v,y,x[e-1],x[e],T,w,s[0])){E=1,D=e+1<b;break}if(!E)return 0;if(D){let e=new Y({zeroCtor:A,coef0:s[0]});e.negateThis(),e.addElement(ce);let t=new Y({zeroCtor:A}),n=new Y({zeroCtor:A});v.div(e,t,n),U(t.power()===2),U(n.power()===0);let r=Ea(t.getElement(2),t.getElement(1),t.getElement(0),i,a,!1,s.slice(1));U(r>=0&&r<=2),E+=r}return za(a,i,s,E)}function Oa(e,t,n,r,i,a,o,s,c){if(e.isZero())return Da(t,n,r,i,a,o,s,c);let l=(e,t)=>{if(e>0){let n=t+e;for(let e=1;e<n;e++)c[e].equals(c[0])&&(c[n-1]=W(c[e],c[e]=c[n-1]),n--);t=n}return Ze(c,0,t,(e,t)=>e.compare(t)),t};if(i.isZero()){let i=0;return o.containsCoordinate(0)&&(c[0].setInt32(0),i=1),l(Da(e,t,n,r,a,o,s,c.slice(i)),i)}let u=new Y({zeroCtor:A,coef0:i});if(u.addElement(r),u.addElement(n),u.addElement(t),u.addElement(e),s){let e=0;o.containsCoordinate(1)&&(c[0].setInt32(1),e=1);let t=new Y({zeroCtor:A,coef0:A.constructInt32(-1)});t.addElement(A.constructInt32(1));let n=new Y({zeroCtor:A}),r=new Y({zeroCtor:A});return u.div(t,n,r),l(Da(n.power()===3?n.getElement(3):Ce.clone(),n.power()>=2?n.getElement(2):Ce.clone(),n.power()>=1?n.getElement(1):Ce.clone(),n.getElement(0),a,o,n.evaluate(ce).isZero(),c.slice(e)),e)}if(u.getElement(0).isZero()){let e=0;for(o.containsCoordinate(0)&&(e=1,c[0].setDouble(0));u.getElement(0).isZero()&&u.power()>0;)u.shiftRight(1);let t=Da(u.power()===3?u.getElement(3):Ce.clone(),u.power()>=2?u.getElement(2):Ce.clone(),u.power()>=1?u.getElement(1):Ce.clone(),u.getElement(0),a,o,!1,c.slice(e));return t>0&&(e+=t),Ze(c,0,e,(e,t)=>e.compare(t)),e}let d=52,f=2**-52;for(;d<a;)2*d<=a?(f*=f,d*=2):(f*=2**-52,d+=52);d+=2;let p=Ra(u),m=A.constructDouble(Math.max(Math.abs(o.vmax),Math.abs(o.vmin)));return f=(p.lt(m)?p:m).mul(A.constructDouble(f)).toDouble(),La(u,o,f,d,s,!1,c,4)}function ka(e,t){let n=e,r=t;r.power()>n.power()&&(r=W(n,n=r));let i=n.power()-r.power(),a=new Y({copy:n.getElement(n.power())});n.mulThis(r.getElement(r.power()));for(let e=0,t=n.power();e<t;e++)if(e>=i){let t=new Y({copy:r.getElement(e-i)});t.mulThis(a);let o=n.getElement(e).sub(t);n.setElement(e,o)}n.setElement(n.power(),n.getElement(n.power()).setZero()),n.updatePower(),Aa(n)}function Aa(e){let t=0;for(;t<e.power()&&e.getElement(t).isZero();)t++;return t>0&&(e.shiftRight(t),!0)}function ja(e,t,n){let r=e.clone(),i=t.clone();for(Aa(r),Aa(i);r.power()!==0||i.power()!==0;)ka(r,i);n.assignMove(r.getElement(0))}function Ma(e,t,n,r,i,a,o=!1,s=!1){a.length=0;let c=e.power(),l=C(A,2*c+4),u=Sa(e,n||I.unit(),r,i,!1,l,l.length);if(u>0){a.length=0;for(let e=0;e<u;e++){let t=l[e];e>0&&t.lte(a.at(-1))||a.push(t.clone())}return a.length}return u}function Na(e,t,n){if(U(n>=1),e.power()===0)return e.isZero()?-1:0;let r=e.getElement(0);return r.negateThis(),r.divThis(e.getElement(1)),t[0].setThis(r),1}function Pa(e,t,n,r){if(e.power()<2)return Na(e,n,r);U(r>=1);let i=e.getElement(1);i.mulThis(e.getElement(1));let a=e.getElement(0);if(a.mulThis(e.getElement(2)),a.ldexpThis(2),i.subThis(a),i.LZ())return 0;if(i.isZero()){let r=e.getElement(1);return r.negateThis(),r.divThis(e.getElement(2)),r.ldexpThis(-1),r.limitPrecisionThis(t),n[0].setThis(r),1}U(r>=2),i=A.sqrt(i,t+8);let o=e.getElement(1);o.negateThis();let s=o.clone();s.subThis(i),s.divThis(e.getElement(2)),s.ldexpThis(-1),s.limitPrecisionThis(t);let c=o.clone();return c.addThis(i),c.divThis(e.getElement(2)),c.ldexpThis(-1),c.limitPrecisionThis(t),s.lt(c)?(n[0].setThis(s),n[1].setThis(c)):(n[1].setThis(s),n[0].setThis(c)),2}function Fa(e,t,n,r,i,a,o){let s=n.clone(),c=r.clone();s.limitPrecisionThis(a),c.limitPrecisionThis(a);let l=e.evaluate(s);l.limitPrecisionThis(a+2);let u=e.evaluate(c);if(u.limitPrecisionThis(a+2),l.GEZ()&&u.GEZ()||l.LEZ()&&u.LEZ())return l.absLessAbs(u)?(o=s,l.isZero()):(o=c,u.isZero());let d=u.LZ();d&&(u=W(l,l=u),c=W(s,s=c));let f=d?c:s,p=d?s:c,m=s.add(c).ldexpThis(-1);m.limitPrecisionThis(a);let h=c.sub(s);h.limitPrecisionThis(a),h.absThis();let g=h.clone(),_=e.evaluate(m),v=t.evaluate(m),y=new Y({copy:e}),b=new Y({copy:t});{let n=Math.max(e.hiBitIndex(),t.hiBitIndex()),r=ce.clone();r.ldexpThis(-(a+2));for(let i=64;i<n;){y.limitPrecisionThis(i),b.limitPrecisionThis(i);let a=y.evaluate(m),o=b.evaluate(m),s=a.sub(_),c=o.sub(v);if(s.divThis(_).absThis().lt(r)&&(v.isZero()||c.divThis(v).absThis().lt(r)))break;y.assignCopy(e),b.assignCopy(t),i=Math.min(i+64,n)}_.limitPrecisionThis(a+2),v.limitPrecisionThis(a+2)}let x=4,S=1,C=0,w=0,T=1,E=A.constructDouble(.25*i),D=A.constructDouble(.5001),O=0;for(;++O<300;){if(O>32&&C>0||v.isZero()||T===2&&C>1||T===1&&x<4)T=1,S>1&&S--;else if(T=2,w>1){let e=h.mul(v);e.absThis(),e.ldexpThis(-3),e.absLessAbs(_)&&S++}h.setThis(g);let e=new A,t=!1;if(T===1)do{if(w>2){let t=h.clone();if(t.absThis(),t.ldexpThis(4),p.sub(f).ldexpThis(-1).gt(t)){if(m.equals(f)){e.setThis(m),m.setThis(f.add(t)),m.limitPrecisionThis(a),g.setThis(m.sub(e));break}if(m.equals(p)){e.setThis(m),m.setThis(p.sub(t)),m.limitPrecisionThis(a),g.setThis(m.sub(e));break}}}g.setThis(c.sub(s)),g.ldexpThis(-1),g.limitPrecisionThis(a),e.setThis(m),m.setThis(s.add(g)),m.limitPrecisionThis(a),m.lt(f)?m.setThis(f):m.gt(p)&&m.setThis(p),t=s.equals(m)||c.equals(m)}while(0);else for(;;){if(g.setThis(_.div(v)),g.limitPrecisionThis(a),S!==1&&g.mulDoubleThis(S),e.setThis(m),m.subThis(g),m.limitPrecisionThis(a),t=m.equals(e),m.lt(f)){if(S>1){m.setThis(e),S--;continue}g.setThis(e.sub(f)),m.setThis(f)}else if(m.gt(p)){if(S>1){m.setThis(e),S--;continue}g.setThis(e.sub(p)),m.setThis(p)}break}if(t||g.absLessAbs(E)){e.equals(m)||(_=y.evaluate(m),_.limitPrecisionThis(a+2));break}_=y.evaluate(m),_.limitPrecisionThis(a+2),v=b.evaluate(m),v.limitPrecisionThis(a+2);let n=s.clone(),r=c.clone();_.LZ()?(l.setThis(_),s.setThis(m)):(u.setThis(_),c.setThis(m)),T===2&&(s.equals(n)&&c.equals(r)||w>1&&!g.absLessAbs(D.mul(h)))?C++:C=0,T===1?(x++,w=0):(x=0,w++)}return O>=300&&B(`Root_finder iterations exceeded`),o.setThis(m),!0}function Ia(e,t,n,r,i){let a=e.evaluate(n);if(a.isZero())return!0;let o=A.constructDouble(.5*r),s=n.clone();s.subThis(o);let c=e.evaluate(s),l=n.clone();l.addThis(o);let u=e.evaluate(l);if(c.LZ()&&u.GZ()||c.GZ()&&u.LZ()||(a.GZ()?c.LEZ()||u.LEZ():c.GEZ()||u.GEZ()))return!0;let d=c.LEZ()&&u.LEZ(),f=c.GEZ()&&u.GEZ(),p=!1;return d?a.gt(c)&&a.gt(u)&&(p=!0):f&&a.lt(c)&&a.lt(u)&&(p=!0),!!p&&a.absThis().lt(A.constructDouble(1e-17))}function La(e,t,n,r,i,a,o,s){U(n>0),U(s>=e.power());let c=o,l=[],u=[],d=new Y({zeroCtor:e.m_zeroCtor}),f=new Y({zeroCtor:e.m_zeroCtor}),p=new Y({zeroCtor:e.m_zeroCtor}),m=A.constructDouble(n),h=A.constructDouble(t.vmin),g=A.constructDouble(t.vmax),_=h.sub(m),v=g.add(m),y=Ra(e),b=y.clone();if(b.negateThis(),_.lt(b))_.setThis(b.sub(m));else if(_.gt(y))return 0;if(v.gt(y))v.setThis(y.add(m));else if(v.lt(b))return 0;let x=e,S=null;if(i){let t=new Y({coef0:A.constructInt32(-1)});t.addElement(ce),S=new Y,x=S;let n=new Y,r=new Y;for(e.div(t,n,r),S.assignCopy(n);x.evaluate(ce).isZero();)x.div(t,n,r),S.assignCopy(n)}let C=!1;if(x.power()>0&&x.getElement(0).isZero())for(C=!0,S||(S=new Y({copy:x}),x=S);x.getElement(0).isZero();)S.shiftRight(1);let w=r+2*x.power()+2,T=n/2**(x.power()+2),E=w;if(Ce.gt(_)&&Ce.lt(v)){for(let e=0,t=x.power();e<t;e++)if(x.getElement(e).isZero()){l.push(Ce.clone());break}}for(let e=x.power()-1;e>0;e--){if(T*=2,w-=2,E-=2,x.power()-e===1){f.assignMove(x.derivative(e)),Na(f,c,s)===1&&(c[0].gt(_)&&c[0].lt(v)&&!c[0].isZero()&&l.push(c[0].clone()),d.assignMove(f),p.assignMove(x.derivative(e-1)));continue}if(x.power()-e===2){f.assignMove(x.derivative(e));let t=Pa(f,w,c,s);U(t>=0&&t<=2);for(let e=0;e<t;e++)c[e].gt(_)&&c[e].lt(v)&&!c[e].isZero()&&l.push(c[e].clone());if(l.length>1&&l.sort((e,t)=>e.compare(t)),l.length>0){let e=l[0].sub(m);e.limitPrecisionThis(E),u.push(lt(_.clone(),e));let t=l.length===1?v.clone():l[1].sub(m);e=l[0].add(m),e.limitPrecisionThis(E),t.limitPrecisionThis(E),u.push(lt(e,t)),l.length>1&&(t=l.length===2?v.clone():l[2].sub(m),t.limitPrecisionThis(E),e=l[1].add(m),e.limitPrecisionThis(E),u.push(lt(e,t)),l.length>2&&(e=l[2].add(m),e.limitPrecisionThis(E),u.push(lt(e,v.clone()))))}else u.push(lt(_.clone(),v.clone()));d.assignCopy(f),p.assignMove(x.derivative(e-1));continue}{f.assignMove(p),p.assignMove(x.derivative(e-1));let t=[];for(let e=0,n=u.length;e<n;++e)if(u[e].first.lte(u[e].second)){let n=new A;if(Fa(f,d,u[e].first,u[e].second,T,w,n)){l.push(n);let r=n.sub(m);r.limitPrecisionThis(E),t.push(lt(u[e].first,r)),r=n.add(m),r.limitPrecisionThis(E),t.push(lt(r,u[e].second))}else t.push(u[e])}u=t,t=[],d.assignMove(f)}}l.sort((e,t)=>e.compare(t)),u.length===0&&(d.assignMove(x.derivative(x.power())),d.isZero()||u.push(lt(_.clone(),v.clone())));let D=0,O=0,k=0,j=new A;for(;;){if(O<u.length){if(u[O].first.gt(u[O].second)){O++;continue}let e=!1;if(k<l.length&&l[k].lt(u[O].first)&&(e=!0),!e){Fa(x,d,u[O].first,u[O].second,n,r,j)&&(j.lt(h)?c[D++].setThis(h):j.gt(g)?c[D++].setThis(g):c[D++].setThis(j)),O++;continue}}if(!(k<l.length))break;k!==0&&l[k-1].equals(l[k])||Ia(x,d,l[k],n)&&(j.setThis(l[k]),j.lt(h)?j.setThis(h):j.gt(g)&&j.setThis(g),D!==0&&c[D].equals(j)||c[D++].setThis(j)),k++}return C&&Ce.gt(_)&&Ce.lt(v)&&(c[D++].setThis(Ce),Ze(c,0,D,(e,t)=>e.compare(t))),i&&ce.gt(_)&&ce.lt(v)&&(c[D++].setThis(ce),Ze(c,0,D,(e,t)=>e.compare(t))),D}function Ra(e){let t=e.getElement(e.power());t.limitPrecisionThis(53),t.absThis();let n=Ce.clone();for(let t=0,r=e.power();t<r;t++){let r=e.getElement(t);r.limitPrecisionThis(53),r.gt(n)&&n.setThis(r)}return n.divThis(t),n.addThis(ce),n.mulThis(A.constructDouble(1+100*2**-52)),n}function za(e,t,n,r){let i=r;if(!e.isEmpty()){i=0;for(let t=0;t<r;++t)e.containsCoordinate(n[t].value())&&(i!==t&&n[i].setThis(n[t]),i++)}i>1&&(n[0].gt(n[1])&&(n[1]=W(n[0],n[0]=n[1])),i>2&&(n[0].gt(n[2])&&(n[2]=W(n[0],n[0]=n[2])),n[1].gt(n[2])&&(n[2]=W(n[1],n[1]=n[2]))));for(let e=0;e<i;++e)n[e].limitPrecisionThis(t);return i}function Ba(e,t,n,r,i,a){return Ua(e,t,n,a,r,i)}function Va(e,t,n,r,i,a){let o=i;if(r)return a[0]=1,o=.5*(t-e)*(n(e)+n(t)),o;let c=a[0],l=(t-e)/c,u=e,d=new s(0);for(let e=1;e<=a[0];++e){let t=(e-.5)*l;d.add(n(u+t))}return o=.5*(o+(t-e)*d.getResult()/c),a[0]*=2,o}function Ha(e,t,n,r,i,a,o){let s=0,c=Math.abs(i-n[e]),l=H(t,NaN),u=H(t,NaN);for(let a=0;a<t;++a){let t=Math.abs(i-n[e+a]);t<c&&(s=a,c=t),l[a]=r[e+a],u[a]=r[e+a]}let d=0,f=0,p=0;a[0]=r[e+s],s--;for(let r=1;r<t;r++){for(let a=0;a<t-r;a++){if(f=n[e+a]-i,p=n[e+a+r]-i,d=f-p,d===0)return!1;let t=(l[a+1]-u[a])/d;l[a]=f*t,u[a]=p*t}if(2*(s+1)<t-r){let e=s+1;o[0]=l[e]}else o[0]=u[s],s--;a[0]+=o[0]}return!0}function Ua(e,t,n,r,i,a){if(n<t&&R(`xTo < xFrom`),n===t)return 0;let o=[0],s=Number.MAX_VALUE,c=[Number.MAX_VALUE],l=0,u=H(33,NaN),d=H(33,NaN),f=[0];u[0]=1;let p=0,m=0;for(let h=0;h<32;h++){if(l=Va(t,n,r,h===0,l,f),d[h]=l,h+1>=e){Ha(h+1-e,e,u,d,0,o,c)||B(`polynomial_interpolation`);let t=i*Math.abs(o[0])+a,n=Math.abs(s-o[0]);if(n<=t&&Math.abs(c[0])<=t){if(p++,p>1&&(n<=.1*m||m===0||p>2))return o[0]}else p=0;m=n,s=o[0]}d[h+1]=d[h],u[h+1]=.25*u[h]}return o[0]}var Wa=class{constructor(){this.area=NaN,this.centroid_x=NaN,this.centroid_y=0,this.specialPoints=[],this.specialPointsLength=[]}specialPointsCount(){return this.specialPoints.length}},Ga=class{constructor(e,t){this.b=e,this.len=t}getMaxDerivative(){return 1}getValue(e,t){return e===0?this.len-Za(this.b,t,!1):0}getError(e){return U(0),0}};function Ka(e,t,n,r,i){let a=!0,o=C(z,3);e.queryControlPoints(o);let s=a?0:1,c=o[1][s]-o[0][s],l=o[2][s]-o[0][s],u=Ba(5,t,n,r,i,e=>{let t;if(e<=.5){let n=ye(0,c,e),r=ye(c,l,e);t=ye(n,r,e)}else{let n=T(0,c,e),r=T(c,l,e);t=T(n,r,e)}return t*no(o,1,e).length()});a=!1,s=a?0:1,c=o[1][s]-o[0][s],l=o[2][s]-o[0][s];let d=Ba(5,t,n,r,i,e=>{let t;if(e<=.5){let n=ye(0,c,e),r=ye(c,l,e);t=ye(n,r,e)}else{let n=T(0,c,e),r=T(c,l,e);t=T(n,r,e)}return t*no(o,1,e).length()});return new z(u,d)}function qa(e){e.m_cachedValues=null}function Ja(e,t){t.m_cachedValues=W(e.m_cachedValues,e.m_cachedValues=t.m_cachedValues)}function Ya(e){if(e.m_cachedValues)return e.m_cachedValues;let t=new Wa;return Xa(e,t.specialPoints),lo(e,t),t}function Xa(e,t){let n=C(z,3);e.queryControlPoints(n);let r=C(P,8);r[0].set(0);let i=1;{let e=C(P,3);Mo(n,e,!1);let t=C(P,2),a=new I(0,1),o=na(e[2].mul(2),e[1],a,t[0]);o<0&&(o=0);for(let e=0;e<o;e++)re(t[e].value(),0,1)||(r[i]=t[e],i++)}{let e=C(P,3);No(n,e,!1);let t=C(P,2),a=new I(0,1),o=na(e[2].mul(2),e[1],a,t[0]);o<0&&(o=0);for(let e=0;e<o;e++)re(t[e].value(),0,1)||(r[i]=t[e],i++)}if(r[i].set(1),i++,i>2){Ze(r,0,i,(e,t)=>e.value()-t.value());let e=0,t=r[0].value(),n=1;for(let a=1;a<i;a++)r[a].eq(r[a-1])?(t+=r[a].value(),n++):(n>1&&(t/=n,r[e].set(t)),e++,r[e]=r[a],t=r[a].value(),n=1);e++,i=e}r[0].set(0),r[i-1].set(1),t.length=i;for(let e=0;e<i;e++)t[e]=r[e].value()}function Za(e,t,n){let r=C(z,3);return e.queryControlPoints(r),Qa(r,t,n)}function Qa(e,t,n){if(n){if(t<0)return t;if(t>1)return t-1+Qa(e,1,!1)}if(t===1)return $a(e);let r=C(z,3);return bo(e,t,r,null),$a(r)}function $a(e){if(e[0].equals(e[1]))return z.distance(e[2],e[0]);if(e[1].equals(e[2]))return z.distance(e[0],e[2]);let t=z.distance(e[0],e[1])+z.distance(e[2],e[1]),n=z.distance(e[0],e[2]);if(t-n<=t*2**-52)return n;let r=C(z,3);Ao(e,r,!0);let i=4*(Ct(r[2].x)+Ct(r[2].y)),a=2*(r[2].x*r[1].x+r[2].y*r[1].y),o=Ct(r[1].x)+Ct(r[1].y);if(1e-14*(Math.abs(a)+Math.abs(o))>=Math.abs(i))return 1e-14*Math.abs(o)>=Math.abs(a)?Math.sqrt(o)*1:2/(3*a)*((a*1+o)**1.5-o**1.5);let s=a/i,c=o/i,l=c-s*s,u=1+s;if(l===0)return s>=0&&u>=0||s<=0&&u<=0?Math.abs(.5*Math.sqrt(i)*(u*u-s*s)):.5*Math.sqrt(i)*(u*u+s*s);let d=Math.sqrt(l+u*u),f=Math.sqrt(c);return .5*Math.sqrt(i)*(u*d-s*f+l*Math.log(Math.abs((u+d)/(s+f))))}function eo(e,t){let n=_e(t,0,1),r=no(e,1,n);return r.isZero()&&(r=no(e,2,n)),r}function to(e,t,n){let r=C(z,3);return e.queryControlPoints(r),no(r,t,n)}function no(e,t,n){if(t===1){let t=e[1].sub(e[0]).mul(1-n).add(e[2].sub(e[1]).mul(n));return t.mulThis(2),t}return t===2?e[2].sub(e[1]).sub(e[1].sub(e[0]).mul(2)):z.construct(0,0)}function ro(e,t,n){{let t=J.constructPoint2D(e[1]).subE(J.constructPoint2D(e[0])),r=new P(1).subE(n),i=J.constructPoint2D(e[2]).subE(J.constructPoint2D(e[1])),a=t.mulE(r).addE(i.mulE(n));return a.mulThisE(new P(2)),a}}function io(e,t,n){let r=Za(e,1,!1);if(t<=0)return t;if(t>=r)return t-r+1;let i=[0];return Gi(new Ga(e,t),I.unit(),1,i)!==1&&B(``),i[0]}function ao(e){let t=C(z,3);return e.queryControlPoints(t),oo(t)}function oo(e){return-e[1].sub(e[0]).crossProduct(e[2].sub(e[0]))/3}function so(e){let t=z.distance(e.getStartXY(),e.getEndXY()),n=e.calculateUpperLength2D();return n-t<=8*2**-52*n}function co(e){return e.m_cachedValues}function lo(e,t){e.m_cachedValues=t}function uo(e,t,n,r,i){be(I.unit().contains(n),`QuadraticBezierHelper::getClosestCoordinateSegment`);let a=C(z,3);e.queryControlPoints(a);let o=Number.MAX_VALUE,s=[0],c=fo(a,t,s);if(n.containsCoordinate(s[0]))o=z.distance(t,c);else{s[0]=n.vmin,Fo(a,s[0],c),o=z.distance(c,t);let e=new z;Fo(a,n.vmax,e);let r=z.distance(e,t);o>r&&(c.setCoordsPoint2D(e),s[0]=n.vmax,o=r)}if(!r)return s[0];if(n.vmin<=0){let r=new z;e.queryCoord2DExtended(-1,r,!0);let i=new z;e.queryCoord2D(n.vmin,i);let a=new Z({start:r,end:i}),l=a.getClosestCoordinate(t,!0);if(l<1){let e=a.getCoord2D(l),n=z.distance(e,t);n<o&&(o=n,s[0]=l-1,c.assign(e))}}if(n.vmin>=1){let r=new z;e.queryCoord2DExtended(2,r,!0);let i=new z;e.queryCoord2D(n.vmax,i);let a=new Z({start:i,end:r}),l=a.getClosestCoordinate(t,!0);if(l>0){let e=a.getCoord2D(l),n=z.distance(e,t);n<o&&(o=n,s[0]=1+l,c.assign(e))}}return s[0]}function fo(e,t,n){let r=e[2].sub(e[1]).sub(e[1].sub(e[0])),i=e[1].sub(e[0]),a=e[0].sub(t),o=a.dotProduct(i),s=a.dotProduct(r)+2*i.dotProduct(i),c=3*i.dotProduct(r),l=r.dotProduct(r),u=H(3,NaN),d=Ji(l,c,s,o,I.unit(),!1,u),f=e[0].clone(),p=0,m=z.sqrDistance(e[0],t),h=z.sqrDistance(e[2],t);h<m&&(p=1,f.assign(e[2]),m=h);for(let n=0;n<d;n++){let r=new z;Fo(e,u[n],r),h=z.sqrDistance(r,t),h<m&&(m=h,f.assign(r),p=u[n])}return n&&(n[0]=p),f}function po(e,t,n,r,i,a){let o=new pr;if(mo(e,I.unit(),o),o.inflate(i),!o.isIntersectingPoint2D(t))return 0;let s=new z,c=uo(e,t,I.unit(),!1);return e.queryCoord2D(c,s),z.distance(s,t)<=i?(r&&(r[0]=c),1):0}function mo(e,t,n){let r=C(z,3);e.queryControlPoints(r),ho(r,t,n)}function ho(e,t,n){if(t.equalsRange(0,1))return void n.setFromPoints(e,3);let r=C(z,3);xo(e,t.vmin,t.vmax,r),n.setFromPoints(r,3)}function go(e,t,n){n.setEmpty();let r=[];r.push(new I(0,1));let i=.5*Math.max(t.width(),t.height());for(;r.length;){let a=r.at(-1);r.pop();let o=new pr;if(ho(e,a,o),o.isIntersectingW(t)){let e=Math.max(o.width(),o.height());if(t.containsW(o)||e<=i||a.width()<1e-12)n.merge(a);else{let e=a.getCenter();r.push(I.construct(a.vmin,e)),r.push(I.construct(e,a.vmax))}}}}function _o(e){let t=C(z,3);e.queryControlPoints(t);let n=vo(t);return n&&(e.m_cp.setCoordsPoint2D(t[1]),e.afterCompletedModification()),n}function vo(e){let t=!1;for(let n=0;n<2;n++){let r=yt(e[0][n],e[2][n]);r>0?(yt(e[0][n],e[1][n])<0&&(e[1][n]=e[0][n],t=!0),yt(e[1][n],e[2][n])<0&&(e[1][n]=e[2][n],t=!0)):r<0?(yt(e[0][n],e[1][n])>0&&(e[1][n]=e[0][n],t=!0),yt(e[1][n],e[2][n])>0&&(e[1][n]=e[2][n],t=!0)):e[1][n]!==e[0][n]&&(e[1][n]=e[0][n],t=!0)}return t}function yo(e,t,n){n===void 0&&(n=t,t=0);let r=new z;if(t<0||n>1)return r.setNAN(),r;if(t>n&&R(`calculate_sub_weighted_centroid`),t===n||e.isDegenerate(0))return r.setCoords(0,0),r;let i=Ya(e),a=Wr(e),o=Math.min(a/e.calculateUpperLength2D(),1e-7),s=t,c=0;for(let e=1,n=i.specialPointsCount();e<n;e++)if(t<i.specialPoints[e]){c=e-1;break}r.setCoords(0,0);for(let t=c+1,l=i.specialPointsCount();t<l;t++){let c=Math.min(i.specialPoints[t],n),l=Ka(e,s,c,o,a);if(r.addThis(l),s=c,n<=i.specialPoints[t])break}return r.add(e.getStartXY().mul(e.calculateLength2D()))}function bo(e,t,n,r){new z().setCoordsPoint2D(e[0]),new z().setCoordsPoint2D(e[1]),new z().setCoordsPoint2D(e[2]);let i=new z,a=new z,o=new z;if(Ee(e[0],e[1],t,i),Ee(e[1],e[2],t,a),Ee(i,a,t,o),n&&(n[0].assign(e[0]),n[1].assign(i),n[2].assign(o)),r){let t=e[2];r[0].assign(o),r[1].assign(a),r[2].assign(t)}}function xo(e,t,n,r){if(t===n){let n=new z;Fo(e,t,n),r[0]=n,r[1]=n,r[2]=n;return}let i=C(z,3);bo(e,n,i,null),bo(i,t/n,null,i),Fo(e,t,i[0]),Fo(e,n,i[2]),r[0].setCoordsPoint2D(i[0]),r[1].setCoordsPoint2D(i[1]),r[2].setCoordsPoint2D(i[2])}function So(e,t,n,r){if(t.isEqual(e.m_XStart,e.m_YStart)&&n.isEqual(e.m_XEnd,e.m_YEnd))return;let i=!!r&&e.isMonotoneQuickAndDirty(),a=new At,o=C(z,3);o[0].setCoords(e.m_XStart,e.m_YStart),o[2].setCoords(e.m_XEnd,e.m_YEnd);let s=new z;s.setSub(o[2],o[0]),s.leftPerpendicularThis(),o[1].setAdd(o[0],s);let c=C(z,3);c[0].setCoordsPoint2D(t),c[2].setCoordsPoint2D(n),s.setSub(c[2],c[0]),s.leftPerpendicularThis(),c[1].setAdd(c[0],s),a.setFromTwoTriangles(o,c)?a.transformInPlace(e.m_cp):Ee(t,n,.5,e.m_cp),e.changeEndPoints2D(t,n),i&&_o(e)}function Co(e){return e.getStartXY().norm(1)+e.getEndXY().norm(1)+e.m_cp.norm(1)}function wo(e,t,n,r,i){if(i){if(Rd(t,n)!==0)return e?4:2}else if(wr(t,n))return 1;return Do(e,t,n,null,null,null,r,i??!1,!0,!1)===0?0:4}function To(e,t,n,r,i){if(i){if(Rd(t,n)!==0)return e?4:2}else if(wr(t,n))return 1;return Oo(e,t,n,null,null,null,r,i??!1,!0,!1)===0?0:4}function Eo(e,t,n,r,i){if(i){if(Rd(t,n)!==0)return 2}else if(wr(t,n))return 1;return ko(e,t,n,null,null,null,r,i??!1,!0,!1)===0?0:4}function Do(e,t,n,r,i,a,o,s,c,l){if(i!=null&&(i.length=0),a!==null&&(a.length=0),r!==null&&(r.length=0),n.isDegenerate(0)){let e=[0,0],s=t.intersectPoint(n.getStartXY(),e,o);if(s>0){if(i!==null)for(let t=0;t<s;t++)i.push(e[t]);if(a!==null)for(let e=0;e<s;e++)a.push(0);if(r!==null)for(let n=0;n<s;n++){let i=new z;t.queryCoord2D(e[n],i),r.push(i)}}return s}let u=Gr(t,n);if(o=Math.max(o,u),t.isDegenerateToLineHelper(u)){let e=new Z({start:t.getStartXY(),end:t.getEndXY()}),c=vi(e,n,r,i,a,o,s,l);if(i)for(let n=0;n<c;++n){let r=e.getCoord2D(i[n]);i[n]=t.getClosestCoordinate(r,!1)}return c}if(Kr(t,n,o))return 0;let d=br.constructPoint2D(n.getStartXY()),f=br.constructPoint2D(n.getEndXY()).sub(d),p=f.clone();p.leftPerpendicularThis();let m=br.constructPoint2D(t.m_cp).sub(br.constructPoint2D(t.getStartXY())),h=br.constructPoint2D(t.getEndXY()).sub(br.constructPoint2D(t.m_cp)),g=m.dotProduct(p).toDouble(),_=h.sub(m).dotProduct(p).toDouble(),v=H(12,NaN),y=H(12,NaN),b=Ki(_,g,I.unit(),v);b<0&&(v[0]=0,v[1]=1,b=2);let x,S=0;for(let e=0,r=S;e<b;++e){let i=t.getCoord2D(v[e+r]);y[S]=n.getClosestCoordinate(i,!1),z.distance(i,n.getCoord2D(y[S]))<=o&&(v[S]=v[e+r],S++)}let w=C(z,3);t.queryControlPoints(w);{let e=C(br,3);if(Po(w,e,!1),e[0]=e[0].sub(d),f.x.abs().gte(f.y.abs())){let t=f.y.div(f.x);_=e[2].y.sub(e[2].x.mul(t)).toDouble(),g=e[1].y.sub(e[1].x.mul(t)).toDouble(),x=e[0].y.sub(e[0].x.mul(t)).toDouble()}else{let t=f.x.div(f.y);_=e[2].x.sub(e[2].y.mul(t)).toDouble(),g=e[1].x.sub(e[1].y.mul(t)).toDouble(),x=e[0].x.sub(e[0].y.mul(t)).toDouble()}}let T=t.getEndXY().equals(n.getStartXY())||t.getEndXY().equals(n.getEndXY()),E=[0,0];b=qi(_,g,x,I.unit(),T,E);for(let e=0,r=S;e<b;++e){v[e+r]=E[e];let i=t.getCoord2D(v[e+r]);y[S]=n.getClosestCoordinate(i,!1),z.distance(i,n.getCoord2D(y[S]))<=o&&(v[S]=v[e+r],S++)}U(S<v.length+4),b=t.intersectPoint(n.getStartXY(),E,o);for(let e=0;e<b;e++)v[S]=E[e],y[S++]=0;b=t.intersectPoint(n.getEndXY(),E,o);for(let e=0;e<b;e++)v[S]=E[e],y[S++]=1;b=n.intersectPoint(t.getStartXY(),E,o);for(let e=0;e<b;e++)y[S]=E[e],v[S++]=0;b=n.intersectPoint(t.getEndXY(),E,o);for(let e=0;e<b;e++)y[S]=E[e],v[S++]=0;return S===0?0:Ud(e,t,n,v,y,S,r,i,a,o,s,c,l)}function Oo(e,t,n,r,i,a,o,s,c,l){if(td(n))return Do(e,t,new Z({start:n.getStartXY(),end:n.getEndXY()}),r,i,a,o,s,c,l);let u=Gr(t,n);if(Kr(t,n,o=Math.max(o,u)))return 0;let d=[],f=[],p=C(z,3);{t.queryControlPoints(p);let e=C(z,3),r=new At;n.canonicToWorldTransformation(r);let i=new At;i.setInvert(r),i.transformPoints2D(p,3,e);let a=C(br,3);Po(e,a);let c=[a[0].x,a[1].x,a[2].x],l=[a[0].y,a[1].y,a[2].y],u=C(A,3);u[0].setDouble(n.getSemiMinorAxis()),u[0].sqrThis(),u[1].setDouble(n.getSemiMajorAxis()),u[1].sqrThis(),u[2]=u[0],u[2].mul(u[1]),u[2].negate();let m=wa(c,2,l,2,null,0,u,!0,I.unit(),I.unit(),d,s);if(m>0){let e=0;for(let r=0;r<m;r++){let i=new z;t.queryCoord2D(d[r],i);let a=n.getClosestCoordinate(i,!1),s=new z;n.queryCoord2D(a,s),z.distance(i,s)<=o&&(d[e]=d[r],f.push(a),e++)}d.length=e}}let m=[0,1];for(let e=0;e<2;e++){let t=e===0?n.getStartXY():n.getEndXY(),r=[0];fo(p,t,r);let i=new z;Fo(p,r[0],i),z.distance(t,i)<=o&&(d.push(r[0]),f.push(m[e]))}for(let e=0;e<2;e++){let t=[0,2];{let r=n.getClosestCoordinate(p[t[e]],!1),i=new z;n.queryCoord2D(r,i),z.distance(p[t[e]],i)<=o&&(d.push(m[e]),f.push(r))}}return Ud(e,t,n,d,f,d.length,r,i,a,o,s,c,l)}function ko(e,t,n,r,i,a,o,s,c,l){let u=C(z,3);t.queryControlPoints(u);let d=C(z,3);if(n.queryControlPoints(d),qr(u,d,3)<0)return ko(e,n,t,r,a,i,o,s,c,!l);let f=Gr(t,n);if(Kr(t,n,o=Math.max(o,f)))return 0;if(Uo(t,n,r,i,a,o,s,c,l))return 2;let p=new I(0,1),m=new I(0,1);{let e=new pr;ho(u,I.unit(),e);let t=new pr;ho(d,I.unit(),t);let n=Math.max(e.maxDim(),t.maxDim());if(e.inflate(3*o),t.inflate(3*o),!e.intersectW(t))return 0;if(e.maxDim()<.1*n){if(go(u,e,p),go(d,e,m),p.isEmpty()||m.isEmpty())return 0;xo(u,p.vmin,p.vmax,u),xo(d,m.vmin,m.vmax,d)}}let h=Gd(u,2,d,2,o);if(h===0)return 0;let g=[],_=[];if(h===-1){let e=C(br,3);Po(u,e);let t=[e[0].x,e[1].x,e[2].x],n=[e[0].y,e[1].y,e[2].y],r=C(br,3);Po(d,r);let i=xa(t,2,n,2,null,0,[r[0].x,r[1].x,r[2].x],2,[r[0].y,r[1].y,r[2].y],2,null,0,!0,I.unit(),I.unit(),g,_,l,s,l);if(i>0){let e=0;for(let t=0;t<i;t++){let n=new z,r=new z;Fo(d,_[t],r),Fo(u,g[t],n),z.distance(n,r)<=o&&(g[e]=g[t],_[e]=_[t],e++)}g.length=e,_.length=e}}for(let e=0;e<2;e++){let t=e===0?u:d,n=e===0?d:u;for(let r=0;r<2;r++){let i=r===0?0:2,a=[0];fo(n,t[i],a);let s=new z;Fo(n,a[0],s),z.distance(t[i],s)<=o&&(e===0?(g.push(i===0?0:1),_.push(a[0])):(_.push(i===0?0:1),g.push(a[0])))}}if(g.length===0)return 0;if(!p.equalsRange(0,1))for(let e=0;e<g.length;++e)g[e]=_a.recalculateParentT(p.vmin,p.vmax,g[e]);if(!m.equalsRange(0,1))for(let e=0;e<_.length;++e)_[e]=_a.recalculateParentT(m.vmin,m.vmax,_[e]);return Ud(e,t,n,g,_,g.length,r,i,a,o,s,c,l)}function Ao(e,t,n=!1){let r=e[1].sub(e[0]);t[1].assign(r.mul(2)),t[2].assign(e[2].sub(e[1]).sub(r)),n?t[0].setCoords(0,0):t[0].assign(e[0])}function jo(e,t,n=!1){let r=C(z,3);e.queryControlPoints(r),Ao(r,t,n)}function Mo(e,t,n=!1){let r=new P(e[1][0]).subE(new P(e[0][0]));t[1]=r.mul(2),t[2]=new P(e[2][0]).subE(new P(e[1][0])).subE(r),n?t[0].set(0):t[0].set(e[0][0])}function No(e,t,n=!1){let r=new P(e[1][1]).subE(new P(e[0][1]));t[1]=r.mul(2),t[2]=new P(e[2][1]).subE(new P(e[1][1])).subE(r),n?t[0].set(0):t[0].set(e[0][1])}function Po(e,t,n=!1){let r=br.constructPoint2D(e[1]),i=r.sub(br.constructPoint2D(e[0]));t[1]=i.mul(A.constructInt32(2)),t[2]=br.constructPoint2D(e[2]).sub(r).sub(i),t[0]=n?new br(Ce,Ce):br.constructPoint2D(e[0])}function Fo(e,t,n,r){if(r){if(t<0){si(new Z({start:e[0],end:e[0].add(eo(e,0).getUnitVector())}),t,n);return}if(t>1){si(new Z({start:e[2],end:e[2].add(eo(e,1).getUnitVector())}),t-1,n);return}}if(t<=.5){let r=e[1].clone(),i=new z;g(2,e[0],r,t,i);let a=new z;g(2,r,e[2],t,a);let o=new z;g(2,i,a,t,o),n.assign(o)}else{let r=e[1].clone(),i=new z;ze(2,e[0],r,t,i);let a=new z;ze(2,r,e[2],t,a);let o=new z;ze(2,i,a,t,o),n.assign(o)}}function Io(e,t,n){let r=C(z,3);e.queryControlPoints(r),Lo(r,t,n)}function Lo(e,t,n){if(t.value()<=.5){let r=J.constructPoint2D(e[1]),i=new J;F(2,J.constructPoint2D(e[0]),r,t,i);let a=new J;F(2,r,J.constructPoint2D(e[2]),t,a);let o=new J;F(2,i,a,t,o),n.setE(o)}else{let r=J.constructPoint2D(e[1]),i=new J;vt(2,J.constructPoint2D(e[0]),r,t,i);let a=new J;vt(2,r,J.constructPoint2D(e[2]),t,a);let o=new J;vt(2,i,a,t,o),n.setE(o)}}function Ro(e,t,n){let r=C(z,4);e.queryControlPoints(r),zo(r,t,n)}function zo(e,t,n){t.value()<0&&t.set(0,t.eps()),t.value()>1&&t.set(1,t.eps()),n.setE(ro(e,1,t))}function Bo(e,t){t[0].assign(e[0]),t[3].assign(e[2]),Ee(e[0],e[1],2/3,t[1]),Ee(e[1],e[2],1/3,t[2])}function Vo(e,t){let n=C(z,3);e.queryControlPoints(n);let r=z.sqrDistance(n[1],n[0]),i=z.sqrDistance(n[1],n[2]),a=n[0].clone(),o=r;r>i&&(a=n[2].clone(),o=i);let s=!1;return o<=t&&o!==0&&(s=!0,e.setControlPoint1(a)),s}function Ho(e,t){if(!t)return!1;let n=C(z,3);e.queryControlPoints(n);let r=z.sqrDistance(n[1],n[0]),i=z.sqrDistance(n[1],n[2]);n[0].clone();let a=r;return r>i&&(n[2].clone(),a=i),a<=t&&a!==0}function Uo(e,t,n,r,i,a,o,s,c){let l=C(z,3);e.queryControlPoints(l);let u=C(z,3);if(t.queryControlPoints(u),l[0].equals(u[0])){if(l[1].equals(u[1])&&l[2].equals(u[2]))return n&&(n.length=0,n.push(l[0]),n.push(l[2])),r&&(r.length=0,r.push(0),r.push(1)),i&&(i.length=0,i.push(0),i.push(1)),!0;if(!l[0].equals(u[2]))return!1}return!!(l[0].equals(u[2])&&l[1].equals(u[1])&&l[2].equals(u[0]))&&(r&&(r.length=0,r.push(0),r.push(1),c&&(r[1]=W(r[0],r[0]=r[1]))),i&&(i.length=0,i.push(1),i.push(0),c&&(i[1]=W(i[0],i[0]=i[1]))),n&&(n.length=0,n.push(l[0]),n.push(l[2]),c&&(n[1]=W(n[0],n[0]=n[1]))),!0)}var Wo=[[.33998104358485626,.6521451548625461],[.8611363115940526,.34785484513745385]],Go=[[.1834346424956498,.362683783378362],[.525532409916329,.31370664587788727],[.7966664774136267,.22238103445337448],[.9602898564975363,.10122853629037626]],Ko=[[.09501250983763744,.1894506104550685],[.2816035507792589,.18260341504492358],[.45801677765722737,.16915651939500254],[.6178762444026438,.14959598881657674],[.755404408355003,.12462897125553388],[.8656312023878318,.09515851168249279],[.9445750230732326,.062253523938647894],[.9894009349916499,.027152459411754096]],qo=[[.04830766568773832,.0965400885147278],[.1444719615827965,.09563872007927486],[.23928736225213706,.09384439908080457],[.33186860228212767,.09117387869576389],[.42135127613063533,.08765209300440381],[.5068999089322294,.08331192422694675],[.5877157572407623,.07819389578707031],[.6630442669302152,.0723457941088485],[.7321821187402897,.06582222277636185],[.7944837959679424,.058684093478535544],[.84936761373257,.050998059262376175],[.8963211557660521,.04283589802222668],[.9349060759377397,.03427386291302143],[.9647622555875064,.02539206530926206],[.9856115115452684,.01627439473090567],[.9972638618494816,.007018610009470096]],Jo=[[.024350292663424433,.048690957009139724],[.07299312178779904,.04857546744150343],[.12146281929612056,.048344762234802954],[.16964442042399283,.04799938859645831],[.21742364374000708,.04754016571483031],[.2646871622087674,.04696818281621002],[.31132287199021097,.046284796581314416],[.3572201583376681,.04549162792741814],[.4022701579639916,.044590558163756566],[.4463660172534641,.04358372452932345],[.48940314570705296,.04247351512365359],[.5312794640198946,.04126256324262353],[.571895646202634,.03995374113272034],[.6111553551723933,.038550153178615626],[.6489654712546573,.03705512854024005],[.6852363130542333,.035472213256882386],[.7198818501716109,.033805161837141606],[.7528199072605319,.03205792835485155],[.7839723589433414,.030234657072402478],[.8132653151227975,.028339672614259483],[.8406292962525803,.02637746971505466],[.8659993981540928,.024352702568710874],[.8893154459951141,.022270173808383253],[.9105221370785028,.02013482315353021],[.9295691721319396,.017951715775697343],[.9464113748584028,.015726030476024718],[.9610087996520538,.013463047896718643],[.973326827789911,.011168139460131128],[.983336253884626,.008846759826363947],[.9910133714767443,.006504457968978363],[.9963401167719553,.004147033260562468],[.9993050417357722,.001783280721696433]],Yo=[[.012223698960615764,.024446180196262518],[.03666379096873349,.024431569097850044],[.06108196960413957,.02440235563384958],[.08546364050451549,.024358557264690626],[.10979423112764375,.024300200167971867],[.13405919946118777,.02422731922281525],[.15824404271422493,.024139957989019287],[.18233430598533718,.024038168681024052],[.2063155909020792,.023922012136703457],[.23017356422666,.023791557781003402],[.2538939664226943,.023646883584447616],[.2774626201779044,.02348807601653591],[.3008654388776772,.02331522999406276],[.32408843502441337,.023128448824387027],[.3471177285976355,.022927844143686846],[.369939555349859,.02271353585023646],[.39254027503326744,.022485652032744968],[.414906379552275,.022244328893799764],[.43702450103710416,.02198971066846049],[.4588814198335522,.021721949538052076],[.48046407240417205,.02144120553920846],[.5017595591361445,.02114764646822135],[.5227551520511755,.02084144778075115],[.5434383024128103,.02052279248696007],[.5637966482266181,.020191871042130043],[.5838180216287631,.01984888123283086],[.6034904561585486,.019494028058706602],[.6228021939105849,.019127523609950944],[.6417416925623075,.01874958694054471],[.660297632272646,.01836044393733134],[.6784589224477192,.017960327185008687],[.6962147083695144,.017549475827117706],[.7135543776835874,.01712813542311138],[.7304675667419088,.016696557801589205],[.746944166797062,.016255000909785187],[.7629743300440948,.015803728659399347],[.7785484755064119,.015343010768865144],[.7936572947621933,.014873122602147314],[.8082917575079137,.014394345004166847],[.8224431169556439,.013906964132951985],[.8361029150609068,.013411271288616333],[.8492629875779689,.012907562739267348],[.8619154689395485,.012396139543950923],[.8740527969580318,.01187730737274028],[.8856677173453972,.011351376324080417],[.8967532880491582,.010818660739503076],[.9073028834017568,.010279479015832158],[.9173101980809605,.009734153415006806],[.9267692508789478,.009183009871660874],[.9356743882779164,.00862637779861675],[.9440202878302202,.008064589890486059],[.9518019613412644,.0074979819256347285],[.9590147578536999,.006926892566898814],[.9656543664319652,.006351663161707189],[.9717168187471366,.005772637542865698],[.9771984914639074,.00519016183267633],[.9820961084357185,.004604584256702955],[.9864067427245862,.004016254983738642],[.9901278184917344,.0034255260409102157],[.9932571129002129,.0028327514714579912],[.9957927585349812,.0022382884309626186],[.997733248625514,.0016425030186690294],[.9990774599773758,.0010458126793403489],[.9998248879471319,.00044938096029209035]];function Xo(e,t,n,r){let i=.5*(r-n),a=n+i,o=new s(0);for(let n=0,r=Math.trunc(e/2);n<r;++n){let r,s;switch(e){case 4:r=Wo[n][0],s=Wo[n][1];break;case 8:r=Go[n][0],s=Go[n][1];break;case 16:r=Ko[n][0],s=Ko[n][1];break;case 32:r=qo[n][0],s=qo[n][1];break;case 64:r=Jo[n][0],s=Jo[n][1];break;case 128:r=Yo[n][0],s=Yo[n][1];break;default:throw Error(`Quadrature_integral: invalid n`)}let c=ae(-.5,r,a),l=ae(i,r,a);o.pe(t(c)*s),o.pe(t(l)*s)}return o.getResult()*i}var X=class e extends Ri{constructor(e){e?e.vd?(super({vd:e.vd,bPolygon:!0}),this.m_segmentBufferCTor=Q):e.copy?(super({vd:e.copy.getDescription(),bPolygon:!0}),this.m_segmentBufferCTor=Q,e.copy.copyTo(this)):e.move?(super({move:e.move}),this.m_segmentBufferCTor=Q):e.envelope?xt(`envelope constructor not impl`):B(`bad arg to polygon constructor`):(super({bPolygon:!0}),this.m_segmentBufferCTor=Q)}assignMove(e){return e.copyTo(this),this}assignCopy(e){return e.copyTo(this),this}getBoundary(){return Ui(this)}getExteriorRingCount(){return this.getOGCPolygonCount()}getGeometryType(){return e.type}getDimension(){return 2}createInstance(){return new e({vd:this.getDescription()})}equals(e,t){return this.equalsBase(e,t)}};function Zo(e,t){let n,r=t,i=null;switch(r||=(i=Le(e)?qt():Kt(),i),e){case L.enumPoint:n=new q({vd:r});break;case L.enumLine:n=new Z({vd:r});break;case L.enumBezier:n=new Gc({vd:r});break;case L.enumEllipticArc:n=new xu({vd:r});break;case L.enumRationalBezier2:n=new ha({vd:r});break;case L.enumBezier2:n=new _a({vd:r});break;case L.enumEnvelope:n=new lr({vd:r});break;case L.enumMultiPoint:n=new ii({vd:r});break;case L.enumPolyline:n=new Bi({vd:r});break;case L.enumPolygon:n=new X({vd:r});break;case L.enumMultipatch:xt(`multipatch not impl`);break;case L.enumGeometryCollection:n=new dr({vd:r});break;default:R(`Geometry.create`)}return n}X.type=L.enumPolygon;var Qo=Rt,$o=-1,es=class{constructor(e){this.m_shape=e}userSort(e,t,n){this.m_shape.sortVerticesSimpleByYHelper(n,e,t)}getValue(e){return this.m_shape.getY(e)}};function ts(e){return e.parent!==void 0}var ns=class e{constructor(e){ts(e)?(this.m_parent=e.parent,this.m_geometry=e.geometry,this.m_path=e.path,this.m_vertex=e.vertex,this.m_firstVertex=e.firstVertex,this.m_index=e.selection?0:e.index,this.m_bSkipMultiPoints=e.bSkipMultiPoints,this.m_selection=e.selection,this.m_bOneGeom=e.bOneGeom,this.m_bFirst=!0):(this.m_parent=e.copy.m_parent,this.m_geometry=e.copy.m_geometry,this.m_path=e.copy.m_path,this.m_vertex=e.copy.m_vertex,this.m_index=e.copy.m_index,this.m_bSkipMultiPoints=e.copy.m_bSkipMultiPoints,this.m_firstVertex=e.copy.m_firstVertex,this.m_bFirst=!0,this.m_selection=e.copy.m_selection,this.m_bOneGeom=e.copy.m_bOneGeom)}moveToNextHelper(){for(this.m_path=this.m_parent.getNextPath(this.m_path),this.m_index=0;this.m_geometry!==-1;){for(;this.m_path!==-1;this.m_path=this.m_parent.getNextPath(this.m_path))if(this.m_vertex=this.m_parent.getFirstVertex(this.m_path),this.m_firstVertex=this.m_vertex,this.m_vertex!==-1)return this.m_vertex;if(this.m_bOneGeom)return-1;if(this.m_geometry=this.m_parent.getNextGeometry(this.m_geometry),this.m_geometry===-1)break;this.m_bSkipMultiPoints&&!V(this.m_parent.getGeometryType(this.m_geometry))||(this.m_path=this.m_parent.getFirstPath(this.m_geometry))}return-1}nextSelection(){for(;this.m_index<this.m_parent.m_selectedVertices.length;){let e=this.m_parent.m_selectedVertices[this.m_index++];if(e!==-1&&(this.m_path=this.m_parent.getPathFromVertex(e),!this.m_bOneGeom||this.m_geometry===this.m_parent.getGeometryFromPath(this.m_path)))return this.m_geometry=this.m_parent.getGeometryFromPath(this.m_path),e}return-1}next(){return this.m_selection?this.nextSelection():this.m_bFirst?(this.m_bFirst=!1,this.m_vertex):this.m_vertex===-1?-1:(this.m_vertex=this.m_parent.getNextVertex(this.m_vertex),this.m_index++,this.m_vertex!==-1&&this.m_vertex!==this.m_firstVertex?this.m_vertex:this.moveToNextHelper())}currentGeometry(){return this.m_geometry}currentPath(){return this.m_path}static create_(t,n,r,i,a,o,s,c,l){return new e({parent:t,geometry:n,path:r,vertex:i,firstVertex:a,index:o,bSkipMultiPoints:s,selection:c,bOneGeom:l})}},rs=class{constructor(e){this.parentage=e}equals(e){return this.parentage===e.parentage}},os=class e{setPrevPath(e,t){this.m_pathIndexList.setField(e,1,t)}setNextPath(e,t){this.m_pathIndexList.setField(e,2,t)}setPathFlags(e,t){this.m_pathIndexList.setField(e,6,t)}getPathFlags(e){return this.m_pathIndexList.getField(e,6)}setPathGeometry(e,t){this.m_pathIndexList.setField(e,7,t)}getPathIndex(e){return this.m_pathIndexList.getField(e,0)}setNextGeometry(e,t){this.m_geometryIndexList.setField(e,1,t)}setPrevGeometry(e,t){this.m_geometryIndexList.setField(e,0,t)}getGeometryIndex(e){return this.m_geometryIndexList.getField(e,7)}setFirstPath(e,t){this.m_geometryIndexList.setField(e,3,t)}setLastPath(e,t){this.m_geometryIndexList.setField(e,4,t)}newGeometry(e){let t=this.m_geometryIndexList.newElement();return this.m_geometryIndexList.setField(t,2,e),this.m_geometryIndexList.setField(t,5,0),this.m_geometryIndexList.setField(t,6,0),this.m_geometryIndexList.setField(t,7,this.m_geometryIndexList.elementToIndex(t)),t}freeGeometry(e){this.m_geometryIndexList.deleteElement(e)}newPath(e){let t=this.m_pathIndexList.newElement(),n=this.m_pathIndexList.elementToIndex(t);if(this.m_pathIndexList.setField(t,0,n),this.m_pathIndexList.setField(t,3,0),this.m_pathIndexList.setField(t,6,0),this.setPathGeometry(t,e),n>=this.m_pathAreas.length){let e=Math.trunc(n<16?16:3*n/2);this.m_pathAreas.length=e,this.m_pathLengths.length=e}return this.m_pathAreas[n]=0,this.m_pathLengths[n]=0,this.m_pathCount++,t}freePath(e){this.m_pathIndexList.deleteElement(e),this.m_pathCount--}newVertex(e){let t=this.m_vertexIndexList.newElement(),n=e>=0?e:this.m_vertexIndexList.elementToIndex(t);if(this.m_vertexIndexList.setField(t,0,n),e<0){if(n>=this.m_vertices.getPointCount()){let e=Math.trunc(n<16?16:3*n/2);this.m_vertices.reserveRounded(e),this.m_vertices.resizeNoInit(e),this.m_segments!==null&&(this.m_segments.length=e),this.m_xyStream=this.m_vertices.getAttributeStreamRef(0)}this.m_segments&&(this.m_segments[n]=null)}return this.m_pointCount++,t}freeVertex(e){this.unselect(e);let t=this.getVertexIndex(e);this.m_vertexIndexList.deleteElement(e),this.m_pointCount--;for(let e=0,n=this.m_indices.length;e<n;e++){if(e===this.m_selectionIndex)continue;let n=this.m_indices[e];n!==null&&n.size()>t&&n.write(t,-1)}this.m_weights&&this.m_weights.size()>t&&this.m_weights.write(t,1),this.m_ranks&&this.m_ranks.size()>t&&this.m_ranks.write(t,1),this.m_segmentWeights&&this.m_segmentWeights.size()>t&&this.m_segmentWeights.write(t,1),this.m_segmentRanks&&this.m_segmentRanks.size()>t&&this.m_segmentRanks.write(t,1),this.m_segments&&this.setSegmentToIndex(t,null)}insertVertex_(e,t,n,r){this.m_hasForceSetEnvelope=0;let i=t===-1?this.getLastVertex(e):this.getPrevVertex(t),a=i===-1?-1:this.getNextVertex(i),o=this.newVertex(n===null?this.m_pointCount:-1),s=this.getVertexIndex(o);n!==null&&this.m_vertices.setPointByValNoCurves(s,n),this.setPathToVertex(o,e),this.setNextVertex(o,a),this.setPrevVertex(o,i),a!==-1&&this.setPrevVertex(a,o),i!==-1&&this.setNextVertex(i,o);let c=this.isClosedPath(e),l=this.getFirstVertex(e);t===-1&&this.setLastVertex(e,o),t===l&&(c&&r&&l!==-1||this.setFirstVertex(e,o)),c&&a===-1&&(this.setNextVertex(o,o),this.setPrevVertex(o,o)),this.setPathSize(e,this.getPathSize(e)+1);let u=this.getGeometryFromPath(e);return this.setGeometryVertexCount(u,this.getPointCount(u)+1),o}getHelperPoint(){return this.m_helperPoint||(this.m_helperPoint=new q({vd:this.m_vertices.getDescription()}),this.m_helperPoint.setXYCoords(0,0)),this.m_helperPoint}addMultiPoint(e,t){let n=this.createGeometry(e.getGeometryType(),e.getDescription());return this.appendMultiPoint(n,e,t),n}addPoint_(e,t){let n=this.createGeometry(L.enumMultiPoint,e.getDescription());return this.appendPoint(n,e,t),n}appendMultiPath_(e,t){if(t.isEmpty())return;let n=t.getImpl();this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+n.getPointCount()),this.m_verticesMp.addPoints(t,0,n.getPointCount()),this.m_xyStream=this.m_vertices.getAttributeStreamRef(0);let r=this.m_segments!==null||n.getSegmentFlagsStreamRef()!==null;this.m_vertexIndexList.setCapacity(this.m_vertexIndexList.size()+n.getPointCount()),this.m_pathIndexList.setCapacity(this.m_pathIndexList.size()+n.getPathCount());for(let t=0,i=n.getPathCount();t<i;t++){if(n.getPathSize(t)===0)continue;let i=this.insertPath(e,-1);this.setClosedPath(i,n.isClosedPath(t));for(let e=n.getPathStart(t),a=n.getPathEnd(t);e<a;e++){let t=this.insertVertex_(i,-1,null,!1);if(r){let r=this.getVertexIndex(t);if(1&n.getSegmentFlags(e))this.setSegmentToIndex(r,null);else{let t=new Q;n.querySegment(e,t,!0),this.setSegmentToIndex(r,t.releaseSegment())}}}n.isStrongPathStart(t)&&this.setStrongPathStart(i,!0),n.isStrongPathEnd(t)&&this.setStrongPathEnd(i,!0)}}addMultiPath(e,t){let n=this.createGeometry(e.getGeometryType(),e.getDescription());return e.getGeometryType()===L.enumPolygon&&this.setFillRule(n,e.getFillRule()),this.appendMultiPath(n,e,t),n}appendMultiPathPolyline(e,t,n){let r=t.getImpl(),i=this.m_segments!==null||r.getSegmentFlagsStreamRef()!==null,a=new G;t.queryEnvelope(a);{let a=n.clone(),o=r.getPointCount(),s=r.getAccelerators();if(s&&s.getQuadTree()&&(o=s.getQuadTree().getIntersectionCount(a,0,r.getPointCount()+1)),o<t.getPointCount()){if(o===0)return;let n=r.queryLimitedSegmentIterator(a),s=-1,c=-100,l=-1,u=0,d=-1,f=-1,p=!1,m=n.nextSegment();if(m!==null)for(;;m=n.nextSegment()){let a=m===null,o=m===null?s:n.getPathIndex(),h=m===null?c:n.getStartPointIndex();if(a||(s===o&&c+1===h?u++:a=!0),a){if(d!==-1){let e=-1,n=-1;if(u===l){this.setClosedPath(f,p);let i=r.getPathEnd(s);this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+i-d),this.m_verticesMp.addPoints(t,d,i),n=r.getPathSize(s),e=i-1}else if(!p||c+1<r.getPathEnd(s))this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+c+2-d),this.m_verticesMp.addPoints(t,d,c+2),n=c-d+2,e=c;else{this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+c+2-d),this.m_verticesMp?.addPoints(t,d,c+1),e=c,n=c-d+1;let i=r.getPathStart(s);this.m_verticesMp.addPoints(t,i,i+1),n+=1}this.m_xyStream=this.m_vertices.getAttributeStreamRef(0);for(let t=0,a=d;t<n;t++,a++){let t=this.insertVertex_(f,-1,null,!1);if(i){let n=this.getVertexIndex(t);if(1&r.getSegmentFlags(a)||a>e)this.setSegmentToIndex(n,null);else{let e=new Q;r.getSegmentBuffer(a,e,!0),this.setSegmentToIndex(n,e.releaseSegment())}}}}if(m===null)break;u=1,d=h,s===o?f=this.insertPath(e,-1):(f=this.insertPath(e,-1),this.setClosedPath(f,!1),l=r.getSegmentCountPath(o),p=r.isClosedPath(o),s=o)}c=h}return}}this.appendMultiPath_(e,t)}appendMultiPathPolygon(e,t,n){let r=t.getImpl(),i=this.m_segments!==null||r.getSegmentFlagsStreamRef()!==null,a=G.constructEmpty();t.queryEnvelope(a),U(n.isIntersecting(a)&&!n.containsEnvelope(a));let o=G.construct(-1/0,n.ymin,1/0,n.ymax),s=G.construct(n.xmin,-1/0,n.xmax,1/0),c=r.getAccelerators();if(c&&c.getQuadTree()){let e=c.getQuadTree(),t=e.getIntersectionCount(o,0,0);t>e.getIntersectionCount(s,0,t+1)&&(s=W(o,o=s))}else o.height()>s.width()&&(s=W(o,o=s));let l=[],u=r.queryLimitedSegmentIterator(o),d=-1,f=-100,p=-1,m=0,h=-1,g=-1,_=-1,v=!0,y=u.nextSegment();if(y!==null)for(;;y=u.nextSegment()){let n=y===null,a=y===null?d:u.getPathIndex(),o=y===null?f:u.getStartPointIndex();if(n||(a===d?f+1===o?m++:n=!0:(n=d>=0,d<0&&(d=a,p=r.getSegmentCountPath(d),h=o,_=-1,m=1))),n){if(!(l.length===0&&p===m)){l.length!==0&&l[0].first===h||(this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+1),this.m_verticesMp.addPoints(t,h,h+1),g===-1&&(g=h),_===-1&&(_=this.insertPath(e,-1),this.setClosedPath(_,!0)),this.m_xyStream=this.m_vertices.getAttributeStreamRef(0),this.insertVertex_(_,-1,null,!1));for(let{first:n,second:a}of l){g===-1&&(g=n);let o=-1,s=-1,c=n+a-1;if(a===p){let e=c+1;s=e-n,this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+s),this.m_verticesMp.addPoints(t,n,e),o=c,U(l.length===1)}else if(c+1<r.getPathEnd(d)){let e=c+2;s=e-n,this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+s),this.m_verticesMp.addPoints(t,n,e),o=c}else{let e=r.getPathStart(d),i=e===g?0:1,a=c+1;s=a-n+i,this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+(a-n)+i),this.m_verticesMp.addPoints(t,n,a),o=c,i>0&&this.m_verticesMp?.addPoints(t,e,e+1)}this.m_xyStream=this.m_vertices.getAttributeStreamRef(0),_===-1&&(_=this.insertPath(e,-1),this.setClosedPath(_,!0));for(let e=0,t=n;e<s;e++,t++){let e=this.insertVertex_(_,-1,null,!1);if(i){let n=this.getVertexIndex(e);if(1&r.getSegmentFlags(t)||t>o)this.setSegmentToIndex(n,null);else{let e=new Q;r.getSegmentBuffer(t,e,!0),this.setSegmentToIndex(n,e.releaseSegment())}}}}if(l.length===0||l.at(-1).first+l.at(-1).second!==h+m){let e=h+m;e===t.getPathEnd(d)&&(e=t.getPathStart(d)),g!==e&&(this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+1),this.m_verticesMp.addPoints(t,e,e+1),this.insertVertex_(_,-1,null,!1))}}l.length=0,v=!0,a!==d&&(d=a,p=r.getSegmentCountPath(d),_=-1,g=-1),h=o,m=1}if(!y)break;{let e=G.constructEmpty();y.queryLooseEnvelope(e),s.isIntersecting(e)?(v?l.push(lt(o,1)):l.at(-1).second++,v=!1):v=!0}f=o}}appendMultiPath(e,t,n){if(n===void 0)return void this.appendMultiPath_(e,t);if(t.isEmpty())return;let r=t.getGeometryType()===L.enumPolygon,i=G.constructEmpty();t.queryEnvelope(i),n.isIntersecting(i)&&(!n.containsEnvelope(i)&&t.getPointCount()>10?r?this.appendMultiPathPolygon(e,t,n):this.appendMultiPathPolyline(e,t,n):this.appendMultiPath_(e,t))}appendPoint(e,t,n){if(t.isEmpty()||n!==void 0&&!n.contains(t.getXY()))return;this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+1),this.m_verticesMp.add(t),this.m_xyStream=this.m_vertices.getAttributeStreamRef(0),this.m_vertexIndexList.setCapacity(this.m_vertexIndexList.size()+1);let r=this.insertPath(e,-1);this.insertVertex_(r,-1,null,!1)}appendMultiPoint_(e,t){this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+t.getPointCount()),this.m_verticesMp.addPoints(t,0,t.getPointCount()),this.m_xyStream=this.m_vertices.getAttributeStreamRef(0),this.m_vertexIndexList.setCapacity(this.m_vertexIndexList.size()+t.getPointCount());let n=this.insertPath(e,-1);for(let e=0,r=t.getPointCount();e<r;e++)this.insertVertex_(n,-1,null,!1)}appendMultiPoint(e,t,n){if(n===void 0)return void this.appendMultiPoint_(e,t);let r=t.getAttributeStreamRef(0),i=0;for(let e=0,a=t.getPointCount();e<a;e++){let t=r.readPoint2D(2*e);n.contains(t)&&i++}this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+i);let a=-1,o=-1,s=0;for(let e=0,i=t.getPointCount();e<i;e++){let i=r.readPoint2D(2*e);n.contains(i)?(a===-1&&(a=e,o=e),o++):a>=0&&(this.m_verticesMp.addPoints(t,a,o-a),a=-1,s++)}if(a>0&&(this.m_verticesMp.addPoints(t,a,o-a),s++),!s)return;this.m_xyStream=this.m_vertices.getAttributeStreamRef(0),this.m_vertexIndexList.setCapacity(this.m_vertexIndexList.size()+i);let c=this.insertPath(e,-1);for(let e=0,i=t.getPointCount();e<i;e++){let t=r.readPoint2D(2*e);n.contains(t)&&this.insertVertex_(c,-1,null,!1)}}splitSegmentForward(e,t,n,r,i){let a=this.getNextVertex(e);a===-1&&R(`Edit_shape.split_segment_forward_`);let o=this.getHelperPoint(),s=this.getPathFromVertex(e),c=e,l=this.hasSegmentParentage();for(let e=0,r=t.getResultSegmentCount(n);e<r;e++){let u=this.getVertexIndex(c),d=this.getNextVertex(c),f=t.getResultSegment(n,e),p=null;if(f.getGeometryType()!==L.enumLine&&(p=f.clone(),p.dropAllAttributes()),e===0&&(f.queryStart(o),this.setSegmentToIndex(u,null),this.setPointEx(c,o,t.getResultSegmentStartPointRank(n,e),t.getResultSegmentStartPointWeight(n,e),i)),this.setSegmentRank(c,t.getResultSegmentInteriorRank(n,e)),this.setSegmentWeight(c,t.getResultSegmentInteriorWeight(n,e)),l){let r=t.getResultSegmentSegmentParentage(n,e),i=t.getResultSegmentStartPointIsBreak(n,e);this.setSegmentParentageAndBreak(c,r,i)}if(f.queryEnd(o),e<r-1){this.setSegmentToIndex(u,p);let r=this.insertVertex(s,d,o);this.setWeight(r,t.getResultSegmentEndPointWeight(n,e)),this.setRank(r,t.getResultSegmentEndPointRank(n,e)),this.select(r),c=r}else{this.setPointEx(a,o,t.getResultSegmentEndPointRank(n,e),t.getResultSegmentEndPointWeight(n,e),i);let r=t.getResultSegmentEndPointIsBreak(n,e);this.setSegmentParentageBreakVertex(a,r),this.setSegmentToIndex(u,p)}}}splitSegmentBackward(e,t,n,r,i){let a=this.getNextVertex(e);a===-1&&R(`Edit_shape.split_segment_backward_`);let o=this.getHelperPoint(),s=this.getPathFromVertex(e),c=e,l=this.hasSegmentParentage();for(let e=0,r=t.getResultSegmentCount(n);e<r;e++){let u=r-e-1,d=this.getVertexIndex(c),f=this.getNextVertex(c),p=t.getResultSegment(n,u),m=null;if(p.getGeometryType()!==L.enumLine&&(m=p.clone(),m.reverse(),m.dropAllAttributes()),e===0&&(p.queryEnd(o),this.setSegmentToIndex(d,null),this.setPointEx(c,o,t.getResultSegmentEndPointRank(n,u),t.getResultSegmentEndPointWeight(n,u),i),this.setSegmentParentageAndBreak(c,t.getResultSegmentSegmentParentage(n,u),t.getResultSegmentEndPointIsBreak(n,u))),p.getGeometryType()===L.enumLine?this.setSegmentToIndex(d,null):this.setSegmentToIndex(d,m),this.setSegmentRank(c,t.getResultSegmentInteriorRank(n,u)),this.setSegmentWeight(c,t.getResultSegmentInteriorWeight(n,u)),p.queryStart(o),e<r-1){let e=this.insertVertex(s,f,o);this.setWeight(e,t.getResultSegmentStartPointWeight(n,u)),this.setRank(e,t.getResultSegmentStartPointRank(n,u)),this.select(e),c=e,l&&this.setSegmentParentageAndBreak(e,t.getResultSegmentSegmentParentage(n,u),t.getResultSegmentEndPointIsBreak(n,u))}else this.setPointEx(a,o,t.getResultSegmentStartPointRank(n,u),t.getResultSegmentStartPointWeight(n,u),i)}}selected_(e){return this.getUserIndex(e,this.m_selectionIndex)>=0}allocateIndex(e=!0){if(this.m_deletedIndices.length){let t=this.m_deletedIndices.pop();return e&&t.setRange(-1,0,t.size()),t}return e?tn(0,-1):tn(0)}recycleUserIndex(e){this.m_deletedIndices.push(e)}allocatePathIndex(){if(this.m_deletedPathIndices.length){let e=this.m_deletedPathIndices.at(-1);return this.m_deletedPathIndices.pop(),e}return tn(0)}recyclePathUserIndex(e){this.m_deletedPathIndices.push(e)}peelALoop_(e,t,n){let r=this.getNextVertex(e),i=this.getNextVertex(t),a=this.getVertexIndex(e),o=this.getVertexIndex(t);if(this.setNextVertex(e,i),this.setPrevVertex(i,e),this.setNextVertex(t,r),this.setPrevVertex(r,t),this.m_segments){let e=this.getSegmentFromIndex(a),t=this.getSegmentFromIndex(o);this.setSegmentToIndex(o,null),this.setSegmentToIndex(a,t),this.setSegmentToIndex(o,e)}if(this.hasSegmentParentage()){let n=this.getSegmentParentage(t),r=this.getSegmentParentage(e);n===-1&&r===-1||(r=W(n,n=r),this.setSegmentParentageAndBreak(e,r),this.setSegmentParentageAndBreak(t,n))}if(n){let t=this.getPathFromVertex(e),n=this.getGeometryFromPath(t),a=[!1],o=this.insertClosedPath(n,-1,r,this.getFirstVertex(t),a);a[0]&&this.setFirstVertex(t,i);let s=this.getPathSize(t);return s-=this.getPathSize(o),this.setPathSize(t,s),o}return-1}sortVerticesSimpleByYHelper(e,t,n){e.sort(t,n,(e,t)=>{let n=this.compareVerticesSimpleY(e,t);if(n===0){let r=this.getPathInternalIndexFromVertex(e),i=this.getPathInternalIndexFromVertex(t);n=r<i?-1:r>i?1:0}return n})}sortVerticesSimpleByYHelper3D(e,t,n){U(0)}constructor(){this.m_verticesMp=null,this.m_vertices=null,this.m_xyStream=null,this.m_vertexDescription=null,this.m_segments=null,this.m_weights=null,this.m_ranks=null,this.m_segmentWeights=null,this.m_segmentRanks=null,this.m_indices=[],this.m_deletedIndices=[],this.m_pathAreas=[],this.m_pathLengths=[],this.m_pathindices=[],this.m_deletedPathIndices=[],this.m_geometryIndices=[],this.m_selectedVertices=[],this.m_helperPoint=null,this.m_forceSetEnvelope=Yt.constructEmpty(),this.m_hasForceSetEnvelope=0,this.m_workPoint2D=z.getNAN(),this.m_workPoint2_2D=z.getNAN(),this.m_curveStitcher=null,this.m_pathCount=0,this.m_pointCount=0,this.m_firstGeometry=-1,this.m_lastGeometry=-1,this.m_vertexIndexList=new pn(5),this.m_pathIndexList=new pn(8),this.m_geometryIndexList=new pn(8),this.m_bHasAttributes=!1,this.m_selectedCount=0,this.m_selectionIndex=-1,this.m_selection=!1,this.m_bucketSort=new fn,this.m_segmentParentageIndex=-1}getTotalPointCount(){return this.m_pointCount}getEnvelope2D(e){if(this.m_hasForceSetEnvelope!==0)return new G(this.m_forceSetEnvelope.xmin,this.m_forceSetEnvelope.ymin,this.m_forceSetEnvelope.xmax,this.m_forceSetEnvelope.ymax);let t=this.hasCurves(),n=G.constructEmpty(),r=this.queryVertexIterator(),i=!0;for(let e=r.next();e!==-1;e=r.next()){if(i?n.merge(this.getXY(e)):n.mergeNe(this.getXY(e)),t){let t=this.getSegment(e);if(t!==null){let e=G.constructEmpty();t.queryLooseEnvelope(e),n.mergeEnvelope2D(e)}}i=!1}return n}getEnvelope3D(e){return U(0),Yt.constructEmpty()}forceSetEnvelope2D(e){this.m_hasForceSetEnvelope=1,this.m_forceSetEnvelope.setCoords(e.xmin,e.ymin,0,e.xmax,e.ymax,0)}forceSetEnvelope3D(e){U(0)}forgetForceSetEnvelope(){this.m_hasForceSetEnvelope=0}getGeometryCount(){return this.m_geometryIndexList.size()}addGeometry(e,t){let n=e.getGeometryType();if(V(n))return this.addMultiPath(e,t);if(n===L.enumMultiPoint)return this.addMultiPoint(e,t);if(n===L.enumPoint)return this.addPoint_(e,t);if(n===L.enumEnvelope){let n=new X;return n.addEnvelope(e,!1),this.addMultiPath(n,t)}R(``)}appendGeometry(e,t){this.mergeVertexDescription(t.getDescription());let n=t.getGeometryType();V(n)?this.appendMultiPath(e,t):n===L.enumMultiPoint?this.appendMultiPoint(e,t):R(``)}assignRankToGeometryVertices(e,t){t<1&&(t=1);let n=this.queryVertexIterator();for(let e=n.next();e!==-1;e=n.next())this.setRank(e,t),this.setSegmentRank(e,t)}collapseAllGeometriesToFirst(){this.collapseGeometriesToFirst(L.enumUnknown)}collapseGeometriesToFirst(e){this.dbgVerifyVertexCounts();let t=-1,n=-1,r=-1;for(let i=this.getFirstGeometry();i!==-1;){if(e===L.enumUnknown||this.getGeometryType(i)===e){if(t===-1){t=i,n=this.getPathCount(t),r=this.getPointCount(t),i=this.getNextGeometry(i);continue}for(let e=this.getFirstPath(i);e!==-1;e=this.getNextPath(e))this.setPathGeometry(e,t);n+=this.getPathCount(i),r+=this.getPointCount(i);let e=this.getLastPath(t),a=this.getFirstPath(i);e===-1?this.setFirstPath(t,a):this.setNextPath(e,a),a!==-1&&(this.setPrevPath(a,e),this.setLastPath(t,this.getLastPath(i))),this.setFirstPath(i,-1),this.setLastPath(i,-1);let o=i;i=this.getNextGeometry(i),this.setGeometryVertexCount(o,0),this.removeGeometry(o);continue}i=this.getNextGeometry(i)}return t!==-1&&(this.setGeometryVertexCount(t,r),this.setGeometryPathCount(t,n),this.dbgVerifyVertexCounts()),t}setFillRule(e,t){let n=this.m_geometryIndexList.getField(e,2);n&=-134217729,n|=t===1?134217728:0,this.m_geometryIndexList.setField(e,2,n)}getFillRule(e){return 134217728&this.m_geometryIndexList.getField(e,2)?1:0}setGeometryModified(e,t){let n=this.m_geometryIndexList.getField(e,2);!!(67108864&n)!==t&&(n&=-67108865,n|=t?67108864:0,this.m_geometryIndexList.setField(e,2,n))}getGeometryModified(e){return!!(67108864&this.m_geometryIndexList.getField(e,2))}setGeometryModifiedWithVertex(e,t){let n=this.getPathFromVertex(e),r=this.getGeometryFromPath(n);this.setGeometryModified(r,t)}getGeometryModifiedWithVertex(e){let t=this.getPathFromVertex(e),n=this.getGeometryFromPath(t);return this.getGeometryModified(n)}swapGeometry(e,t){let n=this.getFirstPath(e),r=this.getFirstPath(t),i=this.getLastPath(e),a=this.getLastPath(t);for(let n=this.getFirstPath(e);n!==-1;n=this.getNextPath(n))this.setPathGeometry(n,t);for(let n=this.getFirstPath(t);n!==-1;n=this.getNextPath(n))this.setPathGeometry(n,e);this.setFirstPath(e,r),this.setFirstPath(t,n),this.setLastPath(e,a),this.setLastPath(t,i);let o=this.getPointCount(e),s=this.getPathCount(e),c=this.getPointCount(t),l=this.getPathCount(t);this.setGeometryVertexCount(e,c),this.setGeometryVertexCount(t,o),this.setGeometryPathCount(e,l),this.setGeometryPathCount(t,s);let u=this.m_geometryIndexList.getField(e,2),d=this.m_geometryIndexList.getField(t,2);this.m_geometryIndexList.setField(e,2,d),this.m_geometryIndexList.setField(t,2,u)}addPathFromMultiPath(e,t,n){let r=this.createGeometry(n?L.enumPolygon:L.enumPolyline,e.getDescription()),i=e.getImpl();if(e.getPathSize(t)<2)return r;this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+e.getPathSize(t)),this.m_verticesMp.addPoints(e,e.getPathStart(t),i.getPathEnd(t)),this.m_xyStream=this.m_vertices.getAttributeStreamRef(0);let a=this.insertPath(r,-1);this.setClosedPath(a,i.isClosedPath(t)||n);let o=this.m_segments!==null||i.getSegmentFlagsStreamRef()!==null;for(let e=i.getPathStart(t),n=i.getPathEnd(t);e<n;e++){let t=this.insertVertex_(a,-1,null,!1);if(o){let n=this.getVertexIndex(t);if(1&i.getSegmentFlags(e))this.setSegmentToIndex(n,null);else{let t=new Q;i.querySegment(e,t,!0),this.setSegmentToIndex(n,t.releaseSegment())}}}return i.isStrongPathStart(t)&&this.setStrongPathStart(a,!0),i.isStrongPathEnd(t)&&this.setStrongPathEnd(a,!0),r}getGeometry(e){let t=this.getGeometryType(e),n=Zo(t,this.m_verticesMp.getDescription()),r=this.getPointCount(e);if(r===0)return n;if(V(t)){let t=n.getImpl(),i=this.getPathCount(e),a=tn(i+1),o=nn(i+1,0),s=n.getDescription(),c=this.hasCurves();for(let n=0,c=s.getAttributeCount();n<c;n++){let c=s.getSemantics(n),l=Qo.getComponentCount(c),u=$t(c,r),d=this.m_vertices.getAttributeStreamRef(c),f=0,p=0,m=0;for(let t=this.getFirstPath(e);t!==-1;t=this.getNextPath(t)){let e=0;this.isClosedPath(t)&&(e|=1),this.isExterior(t)&&(e|=8),this.isStrongPathStart(t)&&(e|=2),this.isStrongPathEnd(t)&&(e|=4),e&&o.setBits(p,e);let n=this.getPathSize(t);if(a.write(p++,m),m+=n,c===0){let e=d,n=u,r;for(let i=this.getFirstVertex(t);f<m;i=this.getNextVertex(i),f++){let t=this.getVertexIndex(i);r=e.readPoint2D(2*t),n.writePoint2D(2*f,r)}}else for(let e=this.getFirstVertex(t);f<m;e=this.getNextVertex(e),f++){let t=this.getVertexIndex(e);for(let e=0;e<l;e++){let n=d.readAsDbl(t*l+e);u.writeAsDbl(f*l+e,n)}}}t.setAttributeStreamRef(c,u),a.write(i,r)}if(t.setPathFlagsStreamRef(o),t.setPathStreamRef(a),t.notifyModifiedFlags(65535),c){let n=0,r=0;for(let i=this.getFirstPath(e);i!==-1;i=this.getNextPath(i)){n+=this.getPathSize(i);for(let e=this.getFirstVertex(i);r<n;e=this.getNextVertex(e)){let n=this.getSegment(e);n!==null&&n.isCurve()&&t.replaceSegment(r,n,!0),r++}}}}else if(t===L.enumMultiPoint){let t=n.getImpl(),i=n.getDescription();t.reserve(r),t.resizeNoInit(r);for(let n=0,r=i.getAttributeCount();n<r;n++){let r=i.getSemantics(n),a=Qo.getComponentCount(r),o=t.getAttributeStreamRef(r),s=this.m_vertices.getAttributeStreamRef(r),c=0,l=this.getFirstPath(e),u=this.getPathSize(l);for(let e=this.getFirstVertex(l);c<u;e=this.getNextVertex(e),c++){let t=this.getVertexIndex(e);for(let e=0;e<a;e++){let n=s.readAsDbl(t*a+e);o.writeAsDbl(c*a+e,n)}}t.setAttributeStreamRef(r,o)}t.notifyModifiedFlags(65535)}else B(`getGeometry`);return n}queryPointGeometryOnly(e,t){this.getGeometryType(e)!==L.enumMultiPoint&&R(`get_point_geometry_only`);let n=this.getPointCount(e);if(n>1&&R(`get_point_geometry_only`),n===0)return t.assignVertexDescription(this.m_vertexDescription),void t.setEmpty();let r=this.getFirstPath(e),i=this.getFirstVertex(r);this.queryPoint(i,t)}removeGeometry(e){for(let t=this.getFirstPath(e);t!==-1;t=this.removePath(t));let t=this.getPrevGeometry(e),n=this.getNextGeometry(e);return t===-1?this.m_firstGeometry=n:this.setNextGeometry(t,n),n===-1?this.m_lastGeometry=t:this.setPrevGeometry(n,t),this.freeGeometry(e),n}createGeometry(e,t){t===void 0&&(t=Kt());let n=this.newGeometry(e);return this.m_vertices||=(this.m_verticesMp=new ii({vd:t}),this.m_verticesMp.getImpl()),this.mergeVertexDescription(t),this.m_firstGeometry===-1?(this.m_firstGeometry=n,this.m_lastGeometry=n):(this.setPrevGeometry(n,this.m_lastGeometry),this.setNextGeometry(this.m_lastGeometry,n),this.m_lastGeometry=n),n}getFirstGeometry(){return this.m_firstGeometry}getLastGeometry(){return this.m_lastGeometry}getNextGeometry(e){return this.m_geometryIndexList.getField(e,1)}getPrevGeometry(e){return this.m_geometryIndexList.getField(e,0)}getGeometryType(e){return 16777215&this.m_geometryIndexList.getField(e,2)}setGeometryUserIndex(e,t,n){let r=this.m_geometryIndices[t],i=this.getGeometryIndex(e);i>=r.size()&&r.resize(Math.max(1.25*i,16),-1),r.write(i,n)}getGeometryUserIndex(e,t){let n=this.getGeometryIndex(e),r=this.m_geometryIndices[t];return n<r.size()?r.read(n):-1}createGeometryUserIndex(){for(let e=0;e<this.m_geometryIndices.length;e++)if(this.m_geometryIndices[e]===null)return this.m_geometryIndices[e]=tn(0),e;this.m_geometryIndices.push(tn(0));let e=this.m_geometryIndices.length-1;return U(e>=0&&e<=2**53-1),e}removeGeometryUserIndex(e){for(this.m_geometryIndices[e]=null;this.m_geometryIndices.length>0&&this.m_geometryIndices.at(-1)===null;)this.m_geometryIndices.pop()}getFirstPath(e){return this.m_geometryIndexList.getField(e,3)}getLastPath(e){return this.m_geometryIndexList.getField(e,4)}hasPointFeatures(){for(let e=this.getFirstGeometry();e!==-1;e=this.getNextGeometry(e))if(!V(this.getGeometryType(e)))return!0;return!1}getPointCount(e){return this.m_geometryIndexList.getField(e,5)}getPathCount(e){return this.m_geometryIndexList.getField(e,6)}filterClosePoints(e,t,n,r,i){let a=e*e,o=0,s=this.hasCurves(),c=this.hasSegmentParentage();for(let e=i===-1?this.getFirstGeometry():i;e!==-1;e=i===-1?this.getNextGeometry(e):-1){let i=this.getGeometryType(e);if(!V(i)||n&&i!==L.enumPolygon)continue;let l=this.getGeometryType(e)===L.enumPolygon,u=this.getGeometryModified(e);for(let n=this.getFirstPath(e);n!==-1;){let i=0;for(let t=this.getFirstVertex(n);i<Math.trunc(this.getPathSize(n)/2);){let l=this.getNextVertex(t);if(l===-1)break;let d=this.getXY(t),f=this.getXY(l),p=z.sqrDistance(d,f),m=!0;do if(p<=a){if(s){let e=this.getSegment(t);if(e!==null){let t=e.calculateLength2D();if(p=t*t,p>a)break}}if(p===0?o===0&&(o=-1):o=1,l!==this.getLastVertex(n)){let n=c&&(this.getSegmentParentageBreakVertex(t)||this.getSegmentParentageBreakVertex(l));if(this.transferAllDataToTheVertex(l,t,!0),this.removeVertex(l,!1),r&&!u&&(this.setGeometryModified(e,!0),u=!0),c&&t!==l){this.setSegmentParentageBreakVertex(t,n);let e=this.getNextVertex(t);U(e!==-1),this.isDiscontinuousSegmentParentage(e)&&this.setSegmentParentageBreakVertex(e,!0)}}m=!1}while(0);m&&(t=this.getNextVertex(t)),i++}let d=this.getFirstVertex(n);for(let t=this.isClosedPath(n)?d:this.getLastVertex(n);this.getPathSize(n)>0;){let i=this.getPrevVertex(t);if(i===-1)break;{let l=this.getXY(i),f=this.getXY(t),p=z.sqrDistance(l,f),m=!0;do if(p<=a){if(s){let e=this.getSegment(i);if(e!==null){let t=e.calculateLength2D();if(p=t*t,p>a)break}}if(p===0?o===0&&(o=-1):o=1,c){U(this.m_segmentParentageIndex>=0);let e=this.getUserIndex(t,this.m_segmentParentageIndex);this.transferAllDataToTheVertex(i,t,!0),this.setUserIndex(t,this.m_segmentParentageIndex,e)}else this.transferAllDataToTheVertex(i,t,!0);let l=c&&(this.getSegmentParentageBreakVertex(t)||this.getSegmentParentageBreakVertex(i));this.removeVertex(i,!0),r&&!u&&(this.setGeometryModified(e,!0),u=!0),c&&i!==t&&(l||this.isDiscontinuousSegmentParentage(t))&&this.setSegmentParentageBreakVertex(t,!0),d===i&&(d=this.getFirstVertex(n)),m=!1}while(0);if(m&&(t=this.getPrevVertex(t),t===d))break}}let f=this.getPathSize(n),p=t&&f<(l?3:2);p&&l&&f===2&&s&&(p=!this.pathHasCurves(n)),p?(n=this.removePath(n),o===0&&(o=-1),r&&!u&&(this.setGeometryModified(e,!0),u=!0)):n=this.getNextPath(n)}}return o}filterClosePoints3D(e,t,n,r,i,a){return U(0),0}hasDegenerateSegments(e){for(let t=this.getFirstGeometry();t!==-1;t=this.getNextGeometry(t))if(V(this.getGeometryType(t)))for(let n=this.getFirstPath(t);n!==-1;){let t=this.getPathSize(n);if(t===0)return!0;let r=this.getFirstVertex(n);for(let n=0;n<t;n++){let t=this.getNextVertex(r);if(t===-1)break;let n=this.getVertexIndex(r),i=this.getSegmentFromIndex(n),a=0;if(i!==null){if(a=i.calculateLowerLength2D(),a<=e&&(a=i.calculateUpperLength2D(),a<=e||(a=i.calculateLength2D(),a<=e)))return!0}else{let r=this.getVertexIndex(t);if(a=this.m_vertices.getShortestDistance(n,r),a<=e)return!0}r=t}n=this.getNextPath(n)}return!1}hasDegenerateSegments3D(e,t){return U(0),!1}transferAllDataToTheVertex(e,t,n=!1){let r=this.getVertexIndex(e),i=this.getVertexIndex(t);if(n){let e=1,t=1;if(this.m_ranks&&(e=this.getRankWithIndex(r),t=this.getRankWithIndex(i)),e>t&&this.setRankWithIndex(i,e),e>=t&&this.m_weights){let n=this.getWeightWithIndex(r),a=this.getWeightWithIndex(i);(e>t||n>a)&&this.setWeightWithIndex(i,n)}}else{if(this.m_weights){let e=this.getWeightWithIndex(r);this.setWeightWithIndex(i,e)}if(this.m_ranks){let e=this.getRankWithIndex(r);this.setRankWithIndex(i,e)}}if(this.m_segmentWeights){let e=this.getSegmentWeightWithIndex(r);this.setSegmentWeightWithIndex(i,e)}if(this.m_segmentRanks){let e=this.getSegmentRankWithIndex(r);this.setSegmentRankWithIndex(i,e)}for(let n=0,r=this.m_indices.length;n<r;n++)if(n!==this.m_selectionIndex&&this.m_indices[n]!==null){let r=this.getUserIndex(e,n);this.setUserIndex(t,n,r)}let a=this.selected(e);a!==this.selected(t)&&(a?this.select(t):this.unselect(t))}splitSegmentAxisAware(e,t,n,r,i){let a=0,o=this.getNextVertex(e);o===-1&&R(``);let s=this.getVertexIndex(e),c=this.getVertexIndex(o),l=this.getSegmentFromIndex(s),u=this.m_vertices.getShortestDistance(s,c),d=this.getPathFromVertex(e),f=this.m_bHasAttributes;f&&l&&(u=l.calculateLength2D());let p=this.getSegmentParentage(e),m=this.getHelperPoint();if(l){let e=0,i=0,h=-1;for(let g=0;g<n;g++){let n=t[g];if(e<n&&n<1){let t=l.cut(e,n);if(r!==null&&(g>0&&t.setStartXY(r[g-1]),t.setEndXY(r[g]),t.normalizeAfterEndpointChange(),i=g),f){let e=u>0?l.calculateSubLengthFromStart(n)/u:0;this.m_vertices.interpolateTwoVertices(s,c,e,m)}m.setXY(t.getEndXY()),h=this.insertVertex(d,o,m),a++;let _=this.getPrevVertex(h),v=this.getVertexIndex(_);this.setSegmentToIndex(v,t),p!==-1&&this.setSegmentParentageAndBreak(h,p,!1),e=n}}if(h!==-1){let t=l.cut(e,1);r!==null&&(t.setStartXY(r[i]),t.normalizeAfterEndpointChange());let n=this.getVertexIndex(h);this.setSegmentToIndex(n,t)}}else{let e=0;for(let r=0;r<n;r++){let n=t[r];if(e<n&&n<1){this.m_vertices.interpolateTwoVertices(s,c,n,m);let e=this.insertVertex(d,o,m);a++,p!==-1&&this.setSegmentParentageAndBreak(e,p,!1)}e=n}}return a}splitSegment(e,t,n,r=null){return this.splitSegmentAxisAware(e,t,n,r,-1)}snapControlPoints(e,t,n){this.getNextVertex(e)===-1&&R(``);let r=e,i=!1;for(let e=0;e<t;++e){let e=this.getVertexIndex(r),t=this.getSegmentFromIndex(e);if(t){let e=t.snapControlPoints(n);i||=e}r=this.getNextVertex(r)}return i}snapControlPointsOnSelection(e){if(!this.hasCurves())return!1;let t=0,n=this.queryVertexIteratorOnSelection();for(let r=n.next();r!==-1;r=n.next()){let n=this.getVertexIndex(r),i=this.getSegmentFromIndex(n);i&&(t|=i.snapControlPoints(e)?1:0)}return t!==0}calculateSubLength2D(e,t,n){return U(0),0}setPoint(e,t,n){if(this.setPointOnly(e,t),this.m_segments!==null){let r=this.getVertexIndex(e),i=this.getSegmentFromIndex(r);i!==null&&(i.setStartXY(t.getXY()),i.normalizeAfterEndpointChange(),n&&i.ensureXYMonotone());let a=this.getPrevVertex(e);if(a!==-1){let e=this.getVertexIndex(a),r=this.getSegmentFromIndex(e);r!==null&&(r.setEndXY(t.getXY()),r.normalizeAfterEndpointChange(),n&&r.ensureXYMonotone())}}}setPointEx(e,t,n,r,i){this.setPoint(e,t,i);let a=this.getVertexIndex(e);this.setWeightWithIndex(a,r),this.setRankWithIndex(a,n)}setPointOnly(e,t){let n=this.getVertexIndex(e);this.m_vertices.setPointByValNoCurves(n,t)}setPointOnlyEx(e,t,n,r){U(0)}queryPoint(e,t){let n=this.getVertexIndex(e);this.m_vertices.getPointByVal(n,t)}setXY(e,t){this.setXYCoords(e,t.x,t.y)}setXYCoords(e,t,n){let r=this.getVertexIndex(e);if(this.m_vertices?.setXYCoordsNoCurves(r,t,n),this.m_segments!==null){let i=this.getSegmentFromIndex(r);i!==null&&(i.setStartXYCoords(t,n),i.normalizeAfterEndpointChange());let a=this.getPrevVertex(e);if(a!==-1){let e=this.getVertexIndex(a),r=this.getSegmentFromIndex(e);r!=null&&(r.setEndXYCoords(t,n),r.normalizeAfterEndpointChange())}}}setXYMonotonic(e,t,n){let r=this.getVertexIndex(e);if(this.m_vertices.setXYCoordsNoCurves(r,t,n),this.m_segments!==null){let i=this.getSegmentFromIndex(r);if(i!==null){let e=i.getEndXY();i.setCoordsForIntersector(new z(t,n),e,!1),i.ensureXYMonotone()}let a=this.getPrevVertex(e);if(a!==-1){let e=this.getVertexIndex(a),r=this.getSegmentFromIndex(e);if(r!==null){let e=r.getStartXY();r.setCoordsForIntersector(e,new z(t,n),!1),r.ensureXYMonotone()}}}}setXYMonotonicPoint2D(e,t){this.setXYMonotonic(e,t.x,t.y)}queryXY(e,t){let n=this.getVertexIndex(e);return this.m_vertices.queryXY(n,t)}getXY(e){let t=this.getVertexIndex(e);return this.m_vertices.getXY(t)}getXYWithIndex(e){return this.m_xyStream.readPoint2D(2*e)}static setSegDefault(e,t,n){U(0)}setXYZ(e,t,n){U(0)}setXYZCoords(e,t,n,r){U(0)}queryXYZ(e,t){U(0)}getXYZ(e){return U(0),K.getNAN()}getXYZWithIndex(e){return U(0),K.getNAN()}mergeVertexDescription(e){this.m_verticesMp.mergeVertexDescription(e),this.m_vertexDescription=this.m_verticesMp.getDescription(),this.m_bHasAttributes=this.m_vertexDescription.getAttributeCount()>1}addAttribute(e){U(0)}getAttributeAsDbl(e,t,n){return this.m_vertices.getAttributeAsDbl(e,this.getVertexIndex(t),n)}queryAttributeAsDbl(e,t,n,r){U(0)}setAttribute(e,t,n,r){U(0)}setAttributeInt(e,t,n,r){U(0)}getVertexDescription(){return this.m_vertexDescription}getMinPathVertexY(e){return U(0),0}getVertexIndex(e){return this.m_vertexIndexList.getField(e,0)}getY(e){let t=this.getVertexIndex(e);return this.m_vertices.queryXY(t,this.m_workPoint2D),this.m_workPoint2D.y}getX(e){return this.getXY(e).x}isEqualXY(e,t){return this.queryXY(e,this.m_workPoint2D),this.queryXY(t,this.m_workPoint2_2D),this.m_workPoint2D.isEqualPoint2D(this.m_workPoint2_2D)}isEqualXYPoint2D(e,t){return this.queryXY(e,this.m_workPoint2D),this.m_workPoint2D.isEqualPoint2D(t)}isEqualXYZPoint3D(e,t){return U(0),!1}setWeight(e,t){t<1&&(t=1);let n=t===1;if(this.m_weights==null){if(n)return;this.m_weights=rn(this.m_vertices.getPointCount(),1)}let r=this.getVertexIndex(e);if(r>=this.m_weights.size()){if(n)return;this.m_weights.resize(r+1,1)}this.m_weights.write(r,t)}setWeightWithIndex(e,t){t<1&&(t=1);let n=t===1;if(this.m_weights===null){if(n)return;this.m_weights=rn(this.m_vertices.getPointCount(),1)}if(e>=this.m_weights.size()){if(n)return;this.m_weights.resize(e+1,1)}this.m_weights.write(e,t)}getWeight(e){if(this.m_weights===null)return 1;let t=this.getVertexIndex(e);return t>=this.m_weights.size()?1:this.m_weights.read(t)}getWeightWithIndex(e){return this.m_weights===null||e>=this.m_weights.size()?1:this.m_weights.read(e)}getRank(e){if(this.m_ranks===null)return 1;let t=this.getVertexIndex(e);return t>=this.m_ranks.size()?1:this.m_ranks.read(t)}getRankWithIndex(e){return this.m_ranks===null||e>=this.m_ranks.size()?1:this.m_ranks.read(e)}setRank(e,t){t<1&&(t=1);let n=t===1;if(this.m_ranks===null){if(n)return;this.m_ranks=tn(this.m_vertices.getPointCount(),1)}let r=this.getVertexIndex(e);if(r>=this.m_ranks.size()){if(n)return;this.m_ranks.resize(r+1,1)}this.m_ranks.write(r,t)}setRankWithIndex(e,t){t<1&&(t=1);let n=t===1;if(this.m_ranks===null){if(n)return;this.m_ranks=tn(this.m_vertices.getPointCount(),1)}if(e>=this.m_ranks.size()){if(n)return;this.m_ranks.resize(e+1,1)}this.m_ranks.write(e,t)}setSegmentWeight(e,t){t<1&&(t=1);let n=t===1;if(this.m_segmentWeights===null){if(n)return;this.m_segmentWeights=rn(this.m_vertices.getPointCount(),1)}let r=this.getVertexIndex(e);if(r>=this.m_segmentWeights.size()){if(n)return;this.m_segmentWeights.resize(r+1,1)}this.m_segmentWeights.write(r,t)}setSegmentWeightWithIndex(e,t){t<1&&(t=1);let n=t===1;if(this.m_segmentWeights==null){if(n)return;this.m_segmentWeights=rn(this.m_vertices.getPointCount(),1)}if(e>=this.m_segmentWeights.size()){if(n)return;this.m_segmentWeights.resize(e+1,1)}this.m_segmentWeights.write(e,t)}getSegmentWeight(e){if(this.m_segmentWeights===null)return 1;let t=this.getVertexIndex(e);return t>=this.m_segmentWeights.size()?1:this.m_segmentWeights.read(t)}getSegmentWeightWithIndex(e){return this.m_segmentWeights==null||e>=this.m_segmentWeights.size()?1:this.m_segmentWeights.read(e)}getSegmentRank(t){if(this.m_segmentRanks===null)return e.st_defaultRank;let n=this.getVertexIndex(t);return n>=this.m_segmentRanks.size()?e.st_defaultRank:this.m_segmentRanks.read(n)}getSegmentRankWithIndex(e){return this.m_segmentRanks===null||e>=this.m_segmentRanks.size()?1:this.m_segmentRanks.read(e)}setSegmentRank(e,t){t<1&&(t=1);let n=t===1;if(this.m_segmentRanks===null){if(n)return;this.m_segmentRanks=tn(this.m_vertices.getPointCount(),1)}let r=this.getVertexIndex(e);if(r>=this.m_segmentRanks.size()){if(n)return;this.m_segmentRanks.resize(r+1,1)}this.m_segmentRanks.write(r,t)}setSegmentRankWithIndex(e,t){t<1&&(t=1);let n=t===1;if(this.m_segmentRanks===null){if(n)return;this.m_segmentRanks=tn(this.m_vertices.getPointCount(),1)}if(e>=this.m_segmentRanks.size()){if(n)return;this.m_segmentRanks.resize(e+1,1)}this.m_segmentRanks.write(e,t)}removeWeights(){this.m_weights=null,this.m_segmentWeights=null}removeRanks(){this.m_ranks=null,this.m_segmentRanks=null}setUserIndex(e,t,n){let r=this.m_indices[t],i=this.getVertexIndex(e);if(r.size()<=i){if(n===-1)return;r.resize(this.m_vertices.getPointCount(),-1)}r.write(i,n)}getUserIndex(e,t){let n=this.getVertexIndex(e),r=this.m_indices[t];return n<r.size()?r.read(n):-1}addToUserIndex(e,t,n){let r=this.m_indices[t],i=this.getVertexIndex(e);r.size()<=i&&r.resize(this.m_vertices.getPointCount(),-1);let a=r.read(i);r.write(i,a+n)}createUserIndex(){for(let e=0;e<this.m_indices.length;e++)if(this.m_indices[e]===null)return this.m_indices[e]=this.allocateIndex(),e;this.m_indices.push(this.allocateIndex());let e=this.m_indices.length-1;return U(e>=0&&e<=Ve()),e}createUserIndexUninitialized(){for(let e=0;e<this.m_indices.length;e++)if(this.m_indices[e]===null)return this.m_indices[e]=this.allocateIndex(!1),e;this.m_indices.push(this.allocateIndex(!1));let e=this.m_indices.length-1;return U(e>=0&&e<=2**53-1),e}fillUserIndexForGeometry(e,t,n){let r=this.m_indices[t],i=r.size();for(let t=this.getFirstPath(e);t!==-1;t=this.getNextPath(t)){let e=this.getFirstVertex(t);for(let a=0,o=this.getPathSize(t);a<o;a++,e=this.getNextVertex(e)){let t=this.getVertexIndex(e);t<i&&r.write(t,n)}}}fillUserIndexForSelection(e,t){U(0)}removeUserIndex(e){for(this.recycleUserIndex(this.m_indices[e]),this.m_indices[e]=null;this.m_indices.length>0&&this.m_indices[this.m_indices.length-1]===null;)this.m_indices.pop()}replaceCurveWithLine(e){if(this.m_segments!==null){let t=this.getVertexIndex(e);this.setSegmentToIndex(t,null)}}queryLineConnector(e,t,n=!1){let r=this.getNextVertex(e);if(r===-1)return!1;if(!this.m_bHasAttributes||n){let n=this.getXY(e);t.setStartXY(n);let i=this.getXY(r);t.setEndXY(i)}else{let n=new q({vd:this.getVertexDescription()});this.queryPoint(e,n),t.setStart(n),this.queryPoint(r,n),t.setEnd(n)}return!0}queryLineConnector3D(e,t,n=!1){return U(0),!1}hasCurves(){return this.m_segments!==null}geometryHasCurves(e){return U(0),!1}pathHasCurves(e){if(!this.hasCurves())return!1;let t=this.getFirstVertex(e);if(t===-1)return!1;let n=this.getPathSize(e),r=t;for(let e=0;e<n;e++,r=this.getNextVertex(r)){let e=this.getSegment(r);if(e!==null&&e.getGeometryType()!==L.enumLine)return!0}return!1}insertPath(e,t){let n=-1;t===-1?n=this.getLastPath(e):(e!==this.getGeometryFromPath(t)&&R(``),n=this.getPrevPath(t));let r=this.newPath(e);return t!==-1&&this.setPrevPath(t,r),this.setNextPath(r,t),this.setPrevPath(r,n),n===-1?this.setFirstPath(e,r):this.setNextPath(n,r),t===-1&&this.setLastPath(e,r),this.setGeometryPathCount(e,this.getPathCount(e)+1),r}removePath(e){let t=this.getPrevPath(e),n=this.getNextPath(e),r=this.getGeometryFromPath(e);return t===-1?this.setFirstPath(r,n):this.setNextPath(t,n),n===-1?this.setLastPath(r,t):this.setPrevPath(n,t),this.clearPath(e),this.setGeometryPathCount(r,this.getPathCount(r)-1),this.freePath(e),n}clearPath(e){let t=this.getFirstVertex(e);if(t!==-1){let n=t;for(let t=0,r=this.getPathSize(e);t<r;t++){let e=n;n=this.getNextVertex(n),this.freeVertex(e)}let r=this.getGeometryFromPath(e);this.setGeometryVertexCount(r,this.getPointCount(r)-this.getPathSize(e))}this.setPathSize(e,0)}getNextPath(e){return this.m_pathIndexList.getField(e,2)}getPrevPath(e){return this.m_pathIndexList.getField(e,1)}getPathSize(e){return this.m_pathIndexList.getField(e,3)}isClosedPath(e){return!!(1&this.getPathFlags(e))}setClosedPath(e,t){if(this.isClosedPath(e)===t)return;if(this.getPathSize(e)>0){let n=this.getFirstVertex(e),r=this.getLastVertex(e);if(t){this.setNextVertex(r,n),this.setPrevVertex(n,r);let e=this.getVertexIndex(r);this.setSegmentToIndex(e,null)}else{this.setNextVertex(r,-1),this.setPrevVertex(n,-1);let e=this.getVertexIndex(r);this.setSegmentToIndex(e,null)}}let n=(1|this.getPathFlags(e))-1;this.setPathFlags(e,n|(t?1:0))}closeAllPaths(e){U(0)}isStrongPathStart(e){return!!(8&this.getPathFlags(e))}isStrongPathEnd(e){return!!(16&this.getPathFlags(e))}setStrongPathStart(e,t){let n=(8|this.getPathFlags(e))-8;this.setPathFlags(e,n|(t?8:0))}setStrongPathEnd(e,t){let n=(16|this.getPathFlags(e))-16;this.setPathFlags(e,n|(t?16:0))}getGeometryFromPath(e){return this.m_pathIndexList.getField(e,7)}isExterior(e){return!!(2&this.getPathFlags(e))}setExterior(e,t){let n=(2|this.getPathFlags(e))-2;this.setPathFlags(e,n|(t?2:0))}getRingArea(e){if(this.isRingAreaValid(e))return this.m_pathAreas[this.getPathIndex(e)];let t=this.getFirstVertex(e);if(t===-1)return 0;let n=this.getXY(t),r=new s(0),i=this.getPathSize(e);if(i>2){let e=n.clone(),a=e.x,o=e.y,s=this.getNextVertex(t),c=this.getXY(s);s=this.getNextVertex(s);let l=z.getNAN();for(let t=2;t<i;t++,s=this.getNextVertex(s))this.queryXY(s,l),r.pe((l.x-e.x)*(c.y-o)),e.setCoordsPoint2D(c),c.setCoordsPoint2D(l);r.pe((a-e.x)*(c.y-o))}if(this.hasCurves()){let e=t;for(let t=0;t<i;t++,e=this.getNextVertex(e)){let t=this.getSegment(e);if(t===null||t.getGeometryType()===L.enumLine)continue;let n=2*t.calculateArea2DHelper();r.pe(n)}}this.setRingAreaValid(e,!0);let a=.5*r.getResult();return this.m_pathAreas[this.getPathIndex(e)]=a,a}getPathIndexInternal(e){return this.getPathIndex(e)}getPathInternalIndexFromVertex(e){return this.getPathIndex(this.getPathFromVertex(e))}setPathUserIndex(e,t,n){let r=this.m_pathindices[t],i=this.getPathIndex(e);r.size()<this.m_pathAreas.length&&r.resize(this.m_pathAreas.length,-1),r.write(i,n)}getPathUserIndex(e,t){let n=this.getPathIndex(e),r=this.m_pathindices[t];return n<r.size()?r.read(n):-1}createPathUserIndex(){for(let e=0;e<this.m_pathindices.length;e++)if(this.m_pathindices[e]===null)return this.m_pathindices[e]=this.allocatePathIndex(),e;this.m_pathindices.push(this.allocatePathIndex());let e=this.m_pathindices.length-1;return U(e>=0&&e<=2**53-1),e}fillPathUserIndexForGeometry(e,t,n){let r=this.m_pathindices[t],i=r.size();for(let t=this.getFirstPath(e);t!==-1;t=this.getNextPath(t)){let e=this.getPathIndex(t);e<i&&r.write(e,n)}}removePathUserIndex(e){for(this.recyclePathUserIndex(this.m_pathindices[e]),this.m_pathindices[e]=null;this.m_pathindices.length>0&&this.m_pathindices.at(-1)===null;)this.m_pathindices.pop()}movePath(e,t,n){if(n===-1&&R(``),t===n)return;let r=this.getNextPath(n),i=this.getPrevPath(n),a=this.getGeometryFromPath(n);i===-1?this.setFirstPath(a,r):this.setNextPath(i,r),r===-1?this.setLastPath(a,i):this.setPrevPath(r,i),this.setGeometryVertexCount(a,this.getPointCount(a)-this.getPathSize(n)),this.setGeometryPathCount(a,this.getPathCount(a)-1),i=t===-1?this.getLastPath(e):this.getPrevPath(t),this.setPrevPath(n,i),this.setNextPath(n,t),t===-1?this.setLastPath(e,n):this.setPrevPath(t,n),i===-1?this.setFirstPath(e,n):this.setNextPath(i,n),this.setGeometryVertexCount(e,this.getPointCount(e)+this.getPathSize(n)),this.setGeometryPathCount(e,this.getPathCount(e)+1),this.setPathGeometry(n,e)}addVertex(e,t){return this.m_vertices.getPointByVal(this.getVertexIndex(t),this.getHelperPoint()),this.insertVertex_(e,-1,this.getHelperPoint(),!1)}insertVertex(e,t,n){return this.insertVertex_(e,t,n,!0)}removeVertex(e,t){let n=this.getPathFromVertex(e),r=this.getPrevVertex(e),i=this.getNextVertex(e);r!==-1&&this.setNextVertex(r,i);let a=this.getPathSize(n);if(e===this.getFirstVertex(n)&&this.setFirstVertex(n,a>1?i:-1),i!==-1&&this.setPrevVertex(i,r),e===this.getLastVertex(n)&&this.setLastVertex(n,a>1?r:-1),this.hasCurves()&&r!==-1&&i!==-1){let n=this.getVertexIndex(e),a=this.getVertexIndex(r),o=this.getVertexIndex(i);if(t){let e=this.getSegmentFromIndex(a);if(e!==null){let t=this.m_vertices.getXY(o);e.setEndXY(t),e.normalizeAfterEndpointChange()}this.setSegmentToIndex(n,null)}else{let e=this.getSegmentFromIndex(n);if(this.setSegmentToIndex(n,null),e!==null){let t=this.m_vertices.getXY(a);e.setStartXY(t),e.normalizeAfterEndpointChange()}this.setSegmentToIndex(a,e)}}this.setPathSize(n,a-1);let o=this.getGeometryFromPath(n);return this.setGeometryVertexCount(o,this.getPointCount(o)-1),this.freeVertex(e),i}removeVertices(e,t){U(e!==t);let n=this.getPathFromVertex(e),r=this.getPrevVertex(e),i=this.getPrevVertex(t);r!==-1&&this.setNextVertex(r,t);let a=this.getPathSize(n),o=this.getVertexIndex(e);this.setSegmentToIndex(o,null),this.setPrevVertex(t,r),this.setPrevVertex(e,-1),this.setNextVertex(i,-1);let s=0,c=e,l=this.getFirstVertex(n),u=!1;for(;;){let e=this.getNextVertex(c);if(u||=l===c,this.freeVertex(c),s++,c===i)break;c=e}a-=s,u&&this.setFirstVertex(n,a>0?t:-1),this.setPathSize(n,a);let d=this.getGeometryFromPath(n);this.setGeometryVertexCount(d,this.getPointCount(d)-s)}getFirstVertex(e){return this.m_pathIndexList.getField(e,4)}getLastVertex(e){return this.m_pathIndexList.getField(e,5)}getNextVertex(e){return this.m_vertexIndexList.getField(e,2)}getPrevVertex(e){return this.m_vertexIndexList.getField(e,1)}getNextVertexEx(e,t){return t>0?this.m_vertexIndexList.getField(e,2):this.m_vertexIndexList.getField(e,1)}getPrevVertexEx(e,t){return t>0?this.m_vertexIndexList.getField(e,1):this.m_vertexIndexList.getField(e,2)}getPathFromVertex(e){return this.m_vertexIndexList.getField(e,3)}addPoint(e,t){return this.insertVertex_(e,-1,t,!1)}getGeometryFromVertex(e){return this.getGeometryFromPath(this.getPathFromVertex(e))}replaceNaNs(e,t){this.m_vertexDescription.hasAttribute(e)||B(``),this.m_vertices.replaceNaNs(e,t)}removeNaNVertices(){for(let e=this.getFirstGeometry();e!==-1;e=this.getNextGeometry(e))for(let t=this.getFirstPath(e);t!==-1;t=this.getNextPath(t)){let e=this.getFirstVertex(t);for(let n=0,r=this.getPathSize(t);n<r;n++)e=this.getXY(e).isFinite()?this.getNextVertex(e):this.removeVertex(e,!0)}}queryVertexIterator(e=-1){return this.queryVertexIteratorEx(!1,e)}queryVertexIteratorEx(e,t=-1){let n=-1,r=-1,i=-1,a=-1,o=0,s=!1;for(n=t===-1?this.getFirstGeometry():t;n!==-1;n=this.getNextGeometry(n))if(!e||V(this.getGeometryType(n))){for(r=this.getFirstPath(n);r!==-1;r=this.getNextPath(r))if(i=this.getFirstVertex(r),a=i,o=0,i!==-1){s=!0;break}if(s||t!==-1)break}return s||(n=-1),ns.create_(this,n,r,i,a,o,e,!1,t!==-1)}queryVertexIteratorOnSelection(e=-1){return this.m_selection?ns.create_(this,e,-1,-1,-1,-1,!1,!0,e!==-1):this.queryVertexIteratorEx(!1,e)}hasSelection(){return this.m_selection}createEmptySelection(){U(0)}removeSelection(){this.m_selection&&(this.m_selectedVertices.length=0,this.removeUserIndex(this.m_selectionIndex),this.m_selectionIndex=-1,this.m_selection=!1,this.m_selectedCount=0)}select(e){return!!this.selected(e)||(this.setUserIndex(e,this.m_selectionIndex,this.m_selectedVertices.length),this.m_selectedVertices.push(e),this.m_selectedCount++,!1)}unselect(e){if(!this.m_selection)return;let t=this.getUserIndex(e,this.m_selectionIndex);t>=0&&(this.m_selectedVertices[t]=-1,this.setUserIndex(e,this.m_selectionIndex,-1),this.m_selectedCount--)}selected(e){return!this.m_selection||this.selected_(e)}getSelectedCount(){return this.m_selection?this.m_selectedCount:this.getTotalPointCount()}createSelectionForCrackingAndClustering(e,t){return U(0),!1}peelALoop(e,t){this.peelALoop_(e,t,!1)}peelALoopIntoAPath(e,t){return this.peelALoop_(e,t,!0)}applyTransformation(e){if(this.m_verticesMp.applyTransformation(e),this.m_segments!==null)for(let t=0,n=this.m_segments.length;t<n;t++)this.m_segments[t]&&this.m_segments[t].applyTransformation(e)}setGeometryType(e,t){this.m_geometryIndexList.setField(e,2,t)}splitSegmentWithIntersector(e,t,n,r,i){r?this.splitSegmentForward(e,t,n,!0,i):this.splitSegmentBackward(e,t,n,!0,i)}setPrevVertex(e,t){this.m_vertexIndexList.setField(e,1,t)}setNextVertex(e,t){this.m_vertexIndexList.setField(e,2,t)}setPathToVertex(e,t){this.m_vertexIndexList.setField(e,3,t)}setPathSize(e,t){this.m_pathIndexList.setField(e,3,t)}setFirstVertex(e,t){this.m_pathIndexList.setField(e,4,t)}setLastVertex(e,t){this.m_pathIndexList.setField(e,5,t)}getSegment(e){if(this.m_segments!=null){let t=this.getVertexIndex(e);return this.getSegmentFromIndex(t)}return null}isCurve(e){if(this.m_segments===null)return!1;let t=this.getVertexIndex(e);return this.m_segments.length>t&&this.m_segments[t]!==null}querySegment(e,t,n=!0,r=!1){let i=this.getNextVertex(e);if(i===-1)return!1;let a=this.getSegment(e);if(!a)return!n&&(this.queryLineConnector(e,t.createLine(),r),!0);if(t.copyFrom(a,!0),r)return!0;if(this.m_vertexDescription.getAttributeCount()>1){let n=this.getHelperPoint();this.queryPoint(e,n),t.get().setStart(n),this.queryPoint(i,n),t.get().setEnd(n)}return!0}getSegmentFromIndex(e){return(this.m_segments!==null&&this.m_segments.length>e?this.m_segments[e]:null)||null}getAndClearSegmentFromIndex(e){return(this.m_segments!==null&&this.m_segments.length>e?this.m_segments[e]:null)||null}setSegmentToIndex(e,t){if(this.m_hasForceSetEnvelope=0,this.m_segments===null){if(!t)return;this.m_segments=[],this.m_segments.length=this.m_vertices.getPointCount()}e>=this.m_segments.length&&(this.m_segments.length=e+1),this.m_segments[e]=t}setGeometryPathCount(e,t){this.m_geometryIndexList.setField(e,6,t)}setGeometryVertexCount(e,t){this.m_geometryIndexList.setField(e,5,t)}ringParentageCheckInternal(e,t){return U(0),!1}reverseRingInternal(e){let t=this.hasCurves(),n=this.hasSegmentParentage(),r=null,i=-1,a=e;if(t){let e=this.getVertexIndex(a);r=this.getAndClearSegmentFromIndex(e)}n&&(i=this.getSegmentParentage(a));do{let e=this.getPrevVertex(a),o=this.getNextVertex(a);if(this.setNextVertex(a,e),this.setPrevVertex(a,o),t){let e=this.getVertexIndex(o),t=this.getSegmentFromIndex(e);r&&r.reverse(),this.setSegmentToIndex(e,r),r=t}if(n){let e=this.getSegmentParentage(o);this.setSegmentParentagePreserveBreak(o,i),i=e}a=o}while(a!==e);this.dbgVerifyIntegrity(e)}setTotalPointCount(e){this.m_pointCount=e}removePathOnly(e){let t=this.getPrevPath(e),n=this.getNextPath(e),r=this.getGeometryFromPath(e);t===-1?this.setFirstPath(r,n):this.setNextPath(t,n),n===-1?this.setLastPath(r,t):this.setPrevPath(n,t),this.setFirstVertex(e,-1),this.setLastVertex(e,-1),this.freePath(e)}insertClosedPath(e,t,n,r,i){let a=this.insertPath(e,-1),o=0,s=n;for(i[0]=!1;;){s===r&&(i[0]=!0),this.setPathToVertex(s,a),o++;let e=this.getNextVertex(s);if(e===n)break;s=e}return this.setClosedPath(a,!0),this.setPathSize(a,o),i[0]&&(n=r),this.setFirstVertex(a,n),this.setLastVertex(a,this.getPrevVertex(n)),this.setRingAreaValid(a,!1),a}findVertex2D(e,t){return U(0),0}findVertex3D(e,t,n){return U(0),0}dbgVerifyMonotone(){}dbgCheckSelection(){}dbgVerifySegment(e){}dbgVerifyIntegrity(e,t=!0){}dbgVerifyVertexCounts(){}dbgVerifyCurves(){}dbgDumpGeometry(e,t){}getNextNthVertex(e,t){if(t===0)return e;let n=e;for(let e=0;e<t;++e)if(n=t>0?this.getNextVertex(n):this.getPrevVertex(n),n===-1)return-1;return n}removeVertexInternal(e,t){let n=this.getPrevVertex(e),r=this.getNextVertex(e);if(n!==-1&&this.setNextVertex(n,r),r!==-1&&this.setPrevVertex(r,n),this.hasCurves()&&n!==-1&&r!==-1){let i=this.getVertexIndex(e),a=this.getVertexIndex(n),o=this.getVertexIndex(r);if(t){let e=this.getSegmentFromIndex(a);if(e!==null){let t=this.m_vertices.getXY(o);e.setEndXY(t),e.normalizeAfterEndpointChange()}this.setSegmentToIndex(i,null)}else{let e=this.getSegmentFromIndex(i);if(this.setSegmentToIndex(i,null),e!==null){let t=this.m_vertices.getXY(a);e.setStartXY(t),e.normalizeAfterEndpointChange()}this.setSegmentToIndex(a,e)}}return this.freeVertex(e),r}isRingAreaValid(e){return!!(4&this.getPathFlags(e))}setRingAreaValid(e,t){let n=(4|this.getPathFlags(e))-4;this.setPathFlags(e,n|(t?4:0))}compareVerticesSimpleY(e,t){return this.queryXY(e,this.m_workPoint2D),this.queryXY(t,this.m_workPoint2_2D),this.m_workPoint2D.compare(this.m_workPoint2_2D)}compareVerticesSimpleY3D(e,t){return this.getXYZ(e).compare(this.getXYZ(t))}compareVerticesSimpleX(e,t){return this.getXY(e).compareX(this.getXY(t))}sortVerticesSimpleByYHeapMerge(e,t){U(0)}sortVerticesSimpleByY(e,t,n){this.m_bucketSort.sort(e,t,n,new es(this))}sortVerticesSimpleByX(e,t,n){U(0)}sortVerticesSimpleByY3D(e,t,n){U(0)}snapVertexForPoleClipping(e,t){let n=this.getPrevVertex(e);n!==-1&&this.replaceCurveWithLine(n),this.getNextVertex(e)!==-1&&this.replaceCurveWithLine(e);let r=new z;this.queryXY(e,r),r.y=t,this.setXY(e,r)}setSegmentParentageAndBreak(e,t,n=!0){if(this.m_segmentParentageIndex===-1){if(t===-1)return;this.m_segmentParentageIndex=this.createUserIndex()}t>=0&&(U(t<=kt()>>1),t<<=1,t|=n?1:0),this.setUserIndex(e,this.m_segmentParentageIndex,t)}setSegmentParentagePreserveBreak(e,t){if(U(t>=-1),this.m_segmentParentageIndex===-1){if(t===-1)return;this.m_segmentParentageIndex=this.createUserIndex()}t>=0&&(U(t<=kt()>>1),t<<=1,t|=this.getSegmentParentageBreakVertex(e)?1:0),this.setUserIndex(e,this.m_segmentParentageIndex,t)}getSegmentParentage(e){if(this.m_segmentParentageIndex===-1)return-1;let t=this.getUserIndex(e,this.m_segmentParentageIndex);return t<0?t:t>>1}getOriginalSegmentInfo(e){if(this.m_segmentParentageIndex!==-1){let t=this.getSegmentParentage(e);return new rs(t)}return new rs(-1)}setSegmentParentageBreakVertex(e,t){if(this.m_segmentParentageIndex===-1)return;let n=this.getUserIndex(e,this.m_segmentParentageIndex);n<0||!!(1&n)!==t&&(t?n|=1:n&=kt()>>1<<1,this.setUserIndex(e,this.m_segmentParentageIndex,n))}getSegmentParentageBreakVertex(e){if(this.m_segmentParentageIndex===-1)return!0;let t=this.getUserIndex(e,this.m_segmentParentageIndex);return t<0||!!(1&t)}isDiscontinuousSegmentParentage(e){let t=this.getPrevVertex(e);return t===-1?!1:this.getSegmentParentage(t)!==this.getSegmentParentage(e)}setCurveStitcherPointer(e){this.m_curveStitcher=e}hasSegmentParentage(){return this.m_segmentParentageIndex!==-1}deleteSegmentParentage(){this.m_segmentParentageIndex!==-1&&(this.removeUserIndex(this.m_segmentParentageIndex),this.m_segmentParentageIndex=-1),this.m_curveStitcher=null}clearSegments(){this.m_segments=null}};function ss(e){if(e.isEmpty())return new X({vd:e.getDescription()});if(V(e.getGeometryType())&&e.hasNonLinearSegments())return ls(e);let t=e.getImpl(),n=t.getPointCount();if(n<=2){if(n===1||t.getXY(0).equals(t.getXY(1))){let e=new q({vd:t.getDescription()});return t.getPointByVal(0,e),e}{let e=new q,n=new Bi({vd:t.getDescription()});return t.getPointByVal(0,e),n.startPathPoint(e),t.getPointByVal(1,e),n.lineToPoint(e),n}}let r=t.getAttributeStreamRef(0),i=new hs({stream:r,n}),a=1,o=r.readPoint2D(0),s=new z;for(;a<n&&r.queryPoint2D(a<<1,s).equals(o);)a++;if(i.m_treeHull.addElement(0),a<n){i.m_treeHull.addBiggestElement(a);let e=new z;for(let n=a+1;n<t.getPointCount();n++){r.queryPoint2D(n<<1,e);let t=i.treeHull(e);t!==-1&&i.m_treeHull.setElement(t,n)}}let c=t.getDescription(),l=c.getAttributeCount()>1,u=i.m_treeHull.size(),d=null;if(u>=2){d=u>=3?new X({vd:c}):new Bi({vd:c});let e=d.getImpl();e.reserve(i.m_treeHull.size()),e.addPathPoint2D(null,0,!0);let n=new z;for(let a=i.m_treeHull.getFirst();a!==-1;a=i.m_treeHull.getNext(a))if(l){let n=new q;t.getPointByVal(i.m_treeHull.getElement(a),n),e.insertPoint(0,-1,n)}else r.queryPoint2D(i.m_treeHull.getElement(a)<<1,n),e.insertPoint2D(0,-1,n)}else if(l){let e=new q({vd:c});t.getPointByVal(i.m_treeHull.getElement(i.m_treeHull.getFirst()),e),d=e}else{let e=r.readPoint2D(i.m_treeHull.getElement(i.m_treeHull.getFirst())<<1);d=new q(e)}return d}function cs(e,t,n,r=!1){if(t<=262144)return vs(e,t,n,r);let i=new hs({points:e,n:t}),a=1,o=e[0];for(;a<t&&e[a].equals(o);)a++;if(i.m_treeHull.addElement(0),a<t){i.m_treeHull.addBiggestElement(a);for(let n=a+1;n<t;n++){let t=e[n],r=i.treeHull(t);r!==-1&&i.m_treeHull.setElement(r,n)}}let s=0;for(let e=i.m_treeHull.getFirst();e!==-1;e=i.m_treeHull.getNext(e))n[s++]=i.m_treeHull.getElement(e);return s}function ls(e){U(e.hasNonLinearSegments()&&!e.isEmpty());let t=new hs;return t.addGeometry(e),t.getBoundingGeometry()}function us(e,t,n){if((t<0||t>=e.getPathCount())&&R(`path index`),e.hasNonLinearSegmentsPath(t))return!1;let r=e.getImpl(),i=r.getPathStart(t),a=r.getPathEnd(t),o=!r.isClosedPath(t)&&r.isClosedPathInXYPlane(t),s=r.getAttributeStreamRef(0),c=2*i,l=2*a;if(o&&(l-=2),l-c<6)return!0;let u=s.readPoint2D(c),d=s.readPoint2D(c+2),f=s.readPoint2D(c+4);if(!ys(z.orientationRobust(d,f,u)))return!1;let p=d.clone(),m=new z;for(let e=c+6;e<l;e+=2)if(m.assign(d),d.assign(f),s.queryPoint2D(e,f),!ys(z.orientationRobust(d,f,u))||!ys(z.orientationRobust(p,f,u))||!ys(z.orientationRobust(d,f,m)))return!1;return!0}function ds(e,t,n){e.setNAN(),t.setCoords(1,0),n.setCoords(0,0)}function fs(e,t,n,r,i){if(ds(n,r,i),e.isEmpty())return;if(e.getGeometryType()===L.enumPoint)return void n.assign(e.getXY());let a=e,o=a.getPointCount();o!==0&&(o===1?n.assign(a.getXY(0)):ps(a,o,t,n,r,i))}function ps(e,t,n,r,i,a){if(t===2){let t=e.getXY(0),n=e.getXY(1);r.assign(t.add(n).mul(.5));let o=n.sub(t);i=Ss(o),a.setCoords(.5*o.length(),0)}else{let o=Number.MAX_VALUE,s=[0,1,0,0],c=new Ke(4,2);for(c.set(0,0,0),c.set(0,1,1),c.set(1,0,1),c.set(1,1,2);s[0]<t;++s[0],Cs(c,0,t)){s[1]===s[0]&&(++s[1],Cs(c,1,t));for(let n=1;;++n){for(;;){let r=ws(e.getXY(c.get(0,0)),e.getXY(c.get(0,1)),e.getXY(c.get(n,0)),e.getXY(c.get(n,1)),2^n);if(r>0||(++s[n],Cs(c,n,t),r===0))break}if(n===3)break;s[n+1]<s[n]&&(s[n+1]=s[n],c.set(n+1,0,c.get(n,0)),c.set(n+1,1,c.get(n,1)))}let l=e.getXY(c.get(0,0)).add(e.getXY(c.get(2,0))).mul(.5),u=Ss(e.getXY(c.get(0,1)).sub(e.getXY(c.get(0,0)))),d=new z,f,p;if(d.x=Math.max(0,u.dotProduct(e.getXY(c.get(1,0)).sub(e.getXY(c.get(3,0))))),d.y=Math.max(0,u.crossProduct(e.getXY(c.get(0,0)).sub(e.getXY(c.get(2,0))))),n?(f=d.x*d.y,p=f<o):(f=d.y,p=f<o),p){o=f;let t=e.getXY(c.get(1,0)),n=e.getXY(c.get(3,0)),s=t.add(n).mul(.5).sub(l);r.assign(l.add(u.mul(u.dotProduct(s)))),i.assign(u),a.assign(d)}}a.mulThis(.5),a.x<a.y&&(a.y=W(a.x,a.x=a.y),i.leftPerpendicularThis())}i.y<0?i.negateThis():i.y===0&&(i.x=1)}os.st_defaultRank=1;var ms=class{constructor(e){this.m_handleP=-1,this.m_handleQ=-1,this.m_currentSupport=-1,this.m_area=0,this.m_bDone=!0,U(0),this.m_convexHull=e,this.m_function=this.done_}next(){return U(0),!1}get_vertex_handle_p(){return U(0),0}get_vertex_handle_q(){return U(0),0}get_current_support(){return U(0),0}getNext(e){return U(0),0}getPrev(e){return U(0),0}intialize_(){return U(0),!1}increment_(){return U(0),!1}increment_q_(){return U(0),!1}increment_p_(){return U(0),!1}parallel_edge_with_q_support_(){return U(0),!1}parallel_edge_with_p_support_(){return U(0),!1}done_(){return U(0),!1}},hs=class e{nullGetXY(e){return B(`m_getXY is null`),{}}nullDeleteNode(e){B(`m_deleteNode is null`)}constructor(e){this.m_treeHull=new yn,this.m_shape=null,this.m_stream=null,this.m_points=null,this.m_geometryHandle=-1,this.m_pathHandle=-1,this.m_getXY=this.nullGetXY,this.m_deleteNode=this.nullDeleteNode,e?e.stream?(this.m_treeHull.setCapacity(Math.min(20,e.n)),this.m_stream=e.stream,this.m_getXY=this.getXYStream,this.m_deleteNode=this.deleteNodeStream,this.m_points=null,this.m_geometryHandle=-1,this.m_pathHandle=-1):e.points?(this.m_treeHull.setCapacity(Math.min(20,e.n)),this.m_points=e.points,this.m_getXY=this.getXYPoints,this.m_deleteNode=this.deleteNodePoints,this.m_stream=null,this.m_geometryHandle=-1,this.m_pathHandle=-1):ge(`unrecognized constructor parameter`):(this.m_treeHull.setCapacity(20),this.m_shape=new os,this.m_geometryHandle=this.m_shape.createGeometry(L.enumMultiPoint),this.m_pathHandle=this.m_shape.insertPath(this.m_geometryHandle,-1),this.m_getXY=this.getXYShape,this.m_deleteNode=this.deleteNodeShape,this.m_stream=null,this.m_points=null)}getXYShape(e){return this.m_shape.getXY(e)}getXYStream(e){return this.m_stream.readPoint2D(e<<1)}getXYPoints(e){return U(0),new z}deleteNodeShape(e){let t=this.m_treeHull.getElement(e);this.m_treeHull.deleteNode(e),this.m_shape.removeVertex(t,!1)}deleteNodeStream(e){this.m_treeHull.deleteNode(e)}deleteNodePoints(e){U(0)}addGeometry(e){if(e.isEmpty())return;let t=e.getGeometryType();if(t===L.enumGeometryCollection){let t=e;for(let e=0,n=t.getGeometryCount();e<n;e++)this.addGeometry(t.getGeometry(e))}else d(t)?this.addMultiVertexGeometry(e):Ne(t)?this.addSegment(e,!1):t===L.enumEnvelope?this.addEnvelope(e):t===L.enumPoint?this.addPoint(e):R(`Convex_hull: geometry not supported`)}getBoundingGeometry(){let e=new q,t=this.m_treeHull.getFirst(),n=new X({vd:this.m_shape.getVertexDescription()});if(this.m_treeHull.size()===0)return n;n.reserve(this.m_treeHull.size()),this.m_shape.queryPoint(this.m_treeHull.getElement(t),e),n.startPathPoint(e);for(let r=this.m_treeHull.getNext(t);r!==-1;r=this.m_treeHull.getNext(r))this.m_shape.queryPoint(this.m_treeHull.getElement(r),e),n.lineToPoint(e);return n}getAntipodalPairsIterator(){return U(0),new ms(this)}getXY(e){return U(0),new z}getXYWithIndex(e){return U(0),new z}getFirst(){return U(0),0}getLast(){return U(0),0}getNext(e){return U(0),0}getPrev(e){return U(0),0}getVertexIndex(e){return U(0),0}getPointCount(){return U(0),0}addMultiVertexGeometry(e){let t=new q,n=e.getImpl(),r=new z;for(let i=0;i<e.getPointCount();i++){n.queryXY(i,r);let a=this.addPoint2D(r);if(a!==-1){e.getPointByVal(i,t);let n=this.m_shape.addPoint(this.m_pathHandle,t);this.m_treeHull.setElement(a,n)}}if(V(e.getGeometryType())){let t=e;if(t.hasNonLinearSegments()){let e=t.querySegmentIterator();for(;e.nextPath();)for(;e.hasNextSegment();){let t=e.nextCurve();t!==null&&this.addSegment(t,!0)}}}}addEnvelope(e){let t=new q;for(let n=0;n<4;n++){let r=new z;e.queryCorner(n,r);let i=this.addPoint2D(r);if(i!==-1){e.queryCornerByVal(n,t);let r=this.m_shape.addPoint(this.m_pathHandle,t);this.m_treeHull.setElement(i,r)}}}static querySegmentControlPoints(e,t,n){let r=e.getGeometryType();if(U(r!==L.enumLine),r===L.enumEllipticArc){let n=e,r=60*Math.PI/180,i=Math.abs(n.getSweepAngle());if(i>r){let e=Math.min(6,Math.ceil(i/r)),a=1/e,o=new Q;n.queryStart(t[0]);let s=1;for(let r=0;r<e;r++){n.queryCut(r*a,(r+1)*a,o);let i=C(z,3);vd(o.get(),i);let c=z.calculateLength(i,3),l=z.calculateLength(i,2),u=c>0?l/c:.5;r<e-1?o.get().queryEnd(t[s+1]):n.queryEnd(t[s+1]),q.lerp(t[s-1],t[s+1],u,t[s]),t[s].setXY(i[1]),s+=2}return s}{let n=C(z,3);vd(e,n);let r=z.calculateLength(n,3);e.queryStart(t[0]),e.queryEnd(t[2]);let i=z.calculateLength(n,2),a=r>0?i/r:.5;return q.lerp(t[0],t[2],a,t[1]),t[1].setXY(n[1]),3}}if(r===L.enumBezier){let n=e,r=C(z,4);n.queryControlPoints(r);let i=z.calculateLength(r,4),a=z.calculateLength(r,2),o=z.calculateLength(r,3);e.queryStart(t[0]),e.queryEnd(t[3]);let s=i>0?a/i:.5;q.lerp(t[0],t[3],s,t[1]),t[1].setXY(r[1]);let c=i>0?o/i:.5;return q.lerp(t[0],t[3],c,t[2]),t[2].setXY(r[2]),4}if(r===L.enumBezier2){let n=e,r=C(z,3);n.queryControlPoints(r);let i=z.calculateLength(r,3);e.queryStart(t[0]),e.queryEnd(t[2]);let a=z.calculateLength(r,2),o=i>0?a/i:.5;return q.lerp(t[0],t[2],o,t[1]),t[1].setXY(r[1]),3}if(r===L.enumRationalBezier2){let n=e,r=C(z,3);n.queryControlPoints(r);let i=z.calculateLength(r,3);e.queryStart(t[0]),e.queryEnd(t[2]);let a=z.calculateLength(r,2),o=i>0?a/i:.5;return q.lerp(t[0],t[2],o,t[1]),t[1].setXY(r[1]),3}R(`Convex_hull: segment type not supported`)}addSegment(t,n){if(!n){let e=new q,n=t.getStartXY(),r=this.addPoint2D(n);if(r!==-1){t.queryStart(e);let n=this.m_shape.addPoint(this.m_pathHandle,e);this.m_treeHull.setElement(r,n)}let i=t.getEndXY(),a=this.addPoint2D(i);if(a!==-1){t.queryEnd(e);let n=this.m_shape.addPoint(this.m_pathHandle,e);this.m_treeHull.setElement(a,n)}}if(t.isCurve()){let n=C(q,13);for(let r=1,i=e.querySegmentControlPoints(t,n,n.length)-1;r<i;++r){let e=n[r].getXY(),t=this.addPoint2D(e);if(t!==-1){let e=this.m_shape.addPoint(this.m_pathHandle,n[r]);this.m_treeHull.setElement(t,e)}}}}addPoint(e){let t=e.getXY(),n=this.addPoint2D(t);if(n!==-1){let t=this.m_shape.addPoint(this.m_pathHandle,e);this.m_treeHull.setElement(n,t)}}addPoint2D(e){let t=-1;if(this.m_treeHull.size()===0)return t=this.m_treeHull.addElement(-4),t;if(this.m_treeHull.size()===1){let n=this.m_treeHull.getElement(this.m_treeHull.getFirst()),r=this.m_shape.getXY(n);return e.equals(r)||(t=this.m_treeHull.addBiggestElement(-5)),t}return t=this.treeHull(e),t}treeHull(e){let t=-1;do{let n=this.m_treeHull.getFirst(),r=this.m_treeHull.getLast(),i=this.m_treeHull.getElement(n),a=this.m_treeHull.getElement(r),o=this.m_getXY(i),s=this.m_getXY(a),c=z.orientationRobust(s,e,o);if(ys(c)){t=this.m_treeHull.addBiggestElement(-1);let i=this.treeHullWalkBackward(e,r,n);i!==n&&this.treeHullWalkForward(e,n,this.m_treeHull.getPrev(i));break}if(bs(c)){let i=this.m_treeHull.getRoot(),a=this.m_treeHull.getFirst(),s=this.m_treeHull.getLast(),c=-1,l=-1,u=-1;for(;a!==this.m_treeHull.getPrev(s);){l=this.m_treeHull.getElement(i);let t=this.m_getXY(l);bs(z.orientationRobust(t,e,o))?(s=i,i=this.m_treeHull.getLeft(i)):(a=i,i=this.m_treeHull.getRight(i))}i=s,c=a,l=this.m_treeHull.getElement(i),u=this.m_treeHull.getElement(c);let d=this.m_getXY(l),f=this.m_getXY(u);if(c!==n&&!ys(z.orientationRobust(f,e,d)))break;t=this.m_treeHull.addElementAtPosition(c,i,-2,!0,!1),this.treeHullWalkForward(e,i,r),this.treeHullWalkBackward(e,c,n);break}{let i=xs(e,s,o);if(i===-1){let i=this.m_treeHull.getPrev(r);this.m_treeHull.deleteNode(r),t=this.m_treeHull.addBiggestElement(-3),this.treeHullWalkBackward(e,i,n)}else if(i===1){let i=this.m_treeHull.getNext(n);this.m_treeHull.deleteNode(n),t=this.m_treeHull.addElementAtPosition(-1,i,-3,!0,!1),this.treeHullWalkForward(e,i,r)}break}}while(0);return t}treeHullWalkForward(e,t,n){if(t===n)return n;let r=t,i=this.m_treeHull.getElement(r),a=this.m_treeHull.getNext(r),o=this.m_getXY(i);for(;r!==n&&this.m_treeHull.size()>2;){let t=this.m_treeHull.getElement(a),n=this.m_getXY(t);if(ys(z.orientationRobust(n,e,o)))break;let s=r;r=a,i=t,o.assign(n),a=this.m_treeHull.getNext(r),this.m_deleteNode(s)}return r}treeHullWalkBackward(e,t,n){if(t===n)return n;let r=t,i=this.m_treeHull.getElement(r),a=this.m_treeHull.getPrev(r),o=this.m_getXY(i);for(;r!==n&&this.m_treeHull.size()>2;){let t=this.m_treeHull.getElement(a),n=this.m_getXY(t);if(ys(z.orientationRobust(o,e,n)))break;let s=r;r=a,i=t,o.assign(n),a=this.m_treeHull.getPrev(r),this.m_deleteNode(s)}return r}};function gs(e,t,n){let r=t.sub(e),i=n.sub(t);if(r.x===0)return i.x>0?-1:0;if(r.y===0)return i.y>0?1:i.y<0?-1:0;let a=r.crossProduct(i),o=4*2**-52*(Math.abs(i.x*r.y)+Math.abs(i.y*r.x));return a>o?1:a<-o?-1:z.orientationRobust(e,t,n)}function _s(e,t,n){let r=t.sub(e),i=n.sub(t);if(r.x===0)return i.x<0?-1:0;if(r.y===0)return i.y>0?-1:i.y<0?1:0;let a=r.crossProduct(i),o=4*2**-52*(Math.abs(i.x*r.y)+Math.abs(i.y*r.x));return a>o?1:a<-o?-1:z.orientationRobust(e,t,n)}function vs(e,t,n,r){let i=new sn(0);for(let e=0;e<t;e++)i.add(e);r||fn.sortEx(i,0,t,{userSort(t,n,r){r.sort(t,n,(t,n)=>e[t].compareX(e[n]))},getValue:t=>e[t].x});let a=0;t:for(let r=0;r<t;++r){let t=i.read(r);for(;a>=2;){let o=n[a-2],s=n[a-1];if(e[s].equals(e[t])){i.write(r,-1);continue t}if(!(gs(e[o],e[s],e[t])>=0)){s===i.read(r-1)&&i.write(r-1,-1);break}a--}n[a++]=t,a===2&&e[t].equals(e[n[0]])&&(i.write(1,-1),a--)}let o=a+1;t:for(let r=t-2;r>=0;--r){let t=i.read(r);if(!(t<0)){for(;a>=o;){let r=n[a-2],i=n[a-1];if(e[i].equals(e[t]))continue t;if(!(_s(e[r],e[i],e[t])>=0))break;a--}if(r!==0){let r=n[a-1];n[a++]=t,e[t].equals(e[r])&&a--}}}return a>1&&e[n[0]].equals(e[n[a-1]])&&a--,a}function ys(e){return e<0}function bs(e){return e>0}function xs(e,t,n){let r=-1;r=t.y===n.y?0:t.x===n.x?1:Math.abs(t.x-n.x)>=Math.abs(t.y-n.y)?0:1;let i=-1;return i=t[r]<n[r]?e[r]<t[r]?-1:n[r]<e[r]?1:0:t[r]<e[r]?-1:e[r]<n[r]?1:0,i}function Ss(e){return(e=e.clone()).divThis(Math.max(Math.abs(e.x),Math.abs(e.y))),e.normalize(),e}function Cs(e,t,n){e.inc(t,0)===n&&e.set(t,0,0),e.inc(t,1)===n&&e.set(t,1,0)}function ws(e,t,n,r,i){switch(i){case 0:break;case 1:t.rightPerpendicularThis(),e.rightPerpendicularThis();break;case 2:t.negateThis(),e.negateThis();break;case 3:t.leftPerpendicularThis(),e.leftPerpendicularThis();break;default:R(``)}return z.orientationRobustEx(e,t,n,r)}var Ts=class{constructor(){this.length=NaN,this.specialPoints=[]}specialPointsCount(){return this.specialPoints.length}};function Es(e){return Ds(e.calculateUpperLength2D())}function Ds(e){return 256*fe()*e}function Os(e){let t=z.distance(e.getStartXY(),e.getEndXY()),n=e.calculateUpperLength2D();return n-t<=8*2**-52*n}function ks(e,t,n=!1){t[1].setCoords(e.m_cp[0].x-e.getStartX(),e.m_cp[0].y-e.getStartY()),t[1].mulThis(3),t[2].setCoords(e.m_cp[1].x-e.m_cp[0].x,e.m_cp[1].y-e.m_cp[0].y),t[2].mulThis(3),t[3]=e.getEndXY().sub(e.getStartXY()),t[3].subThis(t[2]),t[2].subThis(t[1]),n?t[0].setCoords(0,0):t[0]=e.getStartXY()}function As(e,t,n){let r=C(z,4);e.queryControlPoints(r),Ms(r,t,n)}function js(e,t,n){let r=C(z,4);e.queryControlPoints(r),Ns(r,t,n)}function Ms(e,t,n){let r=e[1].x;r-=e[0].x,r*=3;let i=e[2].x;i-=e[1].x,i*=3;let a=e[3].x;a-=e[0].x,a-=i,i-=r,t[3].setWithEps(a),t[2].setWithEps(i),t[1].setWithEps(r),n?t[0].set(0):t[0].set(e[0].x)}function Ns(e,t,n){let r=e[1].y;r-=e[0].y,r*=3;let i=e[2].y;i-=e[1].y,i*=3;let a=e[3].y;a-=e[0].y,a-=i,i-=r,t[3].setWithEps(a),t[2].setWithEps(i),t[1].setWithEps(r),n?t[0].set(0):t[0].set(e[0].y)}function Ps(e,t,n=!1){let r=C(br,4);r[0].assignPoint2D(e[0]),r[1].assignPoint2D(e[1]),r[2].assignPoint2D(e[2]),r[3].assignPoint2D(e[3]),t[1].setCoords(r[1].x.sub(r[0].x),r[1].y.sub(r[0].y)),t[1].mulThis(A.constructInt32(3)),t[2].setCoords(r[2].x.sub(r[1].x),r[2].y.sub(r[1].y)),t[2].mulThis(A.constructInt32(3)),t[3]=r[3].sub(r[0]),t[3]=t[3].sub(t[2]),t[2]=t[2].sub(t[1]),n?t[0].setCoords(Ce,Ce):t[0]=r[0].clone()}function Fs(e,t,n){if(n){if(t<0)return t;if(t>1)return t-1+Fs(e,1,!1)}if(e.isDegenerate(0))return 0;let r=t===1,i=Rs(e);if(r&&!Number.isNaN(i.length)&&!Number.isNaN(i.length))return i.length;let a=Es(e),o=a/e.calculateUpperLength2D(),s=0,c=0;for(let n=1,r=i.specialPointsCount();n<r;n++){let r=i.specialPoints[n];if(s+=Bc(e,c,Math.min(t,r),o,a),t<=r)break;c=r}return r&&(i.length=s),s}function Is(e,t,n){let r=Fs(e,1,!1);if(t<=0)return t;if(t>=r)return t-r+1;let i=[0];return Gi(new Rc(e,t),I.unit(),1,i)!==1&&B(``),i[0]}function Ls(e,t,n){n===void 0&&(n=t,t=0);let r=new z;if(t<0||n>1)return r.setNAN(),r;if(t>n&&R(`calculate_sub_weightedCentroid`),t===n||e.isDegenerate(0))return r.setCoords(0,0),r;let i=Rs(e),a=Es(e),o=a/e.calculateUpperLength2D(),s=t,c=0;for(let e=1,n=i.specialPointsCount();e<n;e++)if(t<i.specialPoints[e]){c=e-1;break}r.setCoords(0,0);for(let t=c+1,l=i.specialPointsCount();t<l;t++){let c=Math.min(i.specialPoints[t],n),l=Vc(e,s,c,o,a);if(r.addThis(l),s=c,n<=i.specialPoints[t])break}return r.add(e.getStartXY().mul(e.calculateLength2D()))}function Rs(e){if(e.m_cachedValues)return e.m_cachedValues;let t=new Ts,n=C(P,8),r=C(z,4);e.queryControlPoints(r);let i=Mc(r,n);t.specialPoints=[];for(let e=0;e<i;e++)t.specialPoints.push(n[e].value());return Bs(e,t),t}function zs(e){let t=null;return t=e.m_cachedValues,t}function Bs(e,t){e.m_cachedValues=t}function Vs(e){e.m_cachedValues=null}function Hs(e,t){t.m_cachedValues=W(e.m_cachedValues,e.m_cachedValues=t.m_cachedValues)}function Us(e,t,n,r){if(t.isEqual(e.m_XStart,e.m_YStart)&&n.isEqual(e.m_XEnd,e.m_YEnd))return;let i=!!r&&e.isMonotoneQuickAndDirty(),a=new At,o=C(z,3);o[0].setCoords(e.m_XStart,e.m_YStart),o[2].setCoords(e.m_XEnd,e.m_YEnd);let s=new z;s.setSub(o[2],o[0]),s.leftPerpendicularThis(),o[1].setAdd(o[0],s);let c=C(z,3);c[0].setCoordsPoint2D(t),c[2].setCoordsPoint2D(n),s.setSub(c[2],c[0]),s.leftPerpendicularThis(),c[1].setAdd(c[0],s),a.setFromTwoTriangles(o,c)?a.transformPoints2D(e.m_cp,2,e.m_cp):(Ee(t,n,1/3,e.m_cp[0]),Ee(t,n,2/3,e.m_cp[1])),e.changeEndPoints2D(t,n),i&&$s(e)}function Ws(e,t,n,r,i){return{tmin:e,tmax:t,t:n,d:r,pt:i.clone()}}function Gs(e,t,n,r){let i=C(z,4);e.queryControlPoints(i);let a=H(18,NaN),o=Gi(new wc(i,t,NaN),I.construct(n,r),18,a),s=new z;e.queryCoord2D(n,s);let c=n,l=z.distance(s,t),u=new z;e.queryCoord2D(r,u);let d=z.distance(u,t);d<l&&(l=d,c=r,s.assign(u));for(let n=0;n<o;n++){e.queryCoord2D(a[n],u);let r=z.distance(u,t);r<l&&(l=r,c=a[n],s.assign(u))}return Ws(n,r,c,l,s)}function Ks(e,t){let n=C(P,4);As(e,n,!0);let r=C(P,4);js(e,r,!0);let i=n[3].clone(),a=n[2].clone(),o=n[1].clone(),s=r[3].clone(),c=r[2].clone(),l=r[1].clone(),u=a.mulE(o).addE(c.mulE(l)).mul(4),d=a.mulE(a).mul(8).addE(i.mulE(o).mul(12)).addE(c.mulE(c).mul(8).addE(s.mulE(l).mul(12))),f=i.mulE(a).addE(s.mulE(c)).mul(36),p=i.mulE(i).addE(s.mulE(s)).mul(36),m=C(P,3),h=ia(p,f,d,u,new I(0,1),!1,m);if(U(h<=3),h>0){let n=Zs(e,1,0).sqrLength(),r=Zs(e,1,1).sqrLength(),i=n;t.set(0),i<r&&(i=r,t.set(1));for(let n=0;n<h;n++){let r=Zs(e,1,m[n].value()).sqrLength();r<i&&(i=r,t=m[n])}}}function qs(e,t,n,r){if(t===1){let t=1-n,i=t*t,a=n*n,o=e[1].sub(e[0]),s=e[2].sub(e[1]),c=e[3].sub(e[2]),l=o.mul(i).add(s.mul(2*t*n)).add(c.mul(a));r.assign(l.mul(3))}else if(t===2){let t=1-n,i=e[2].sub(e[1]).sub(e[1].sub(e[0])),a=e[3].sub(e[2]).sub(e[2].sub(e[1])),o=i.mul(t).add(a.mul(n));r.assign(o.mul(6))}else if(t===3){let t=e[2].sub(e[1]),n=e[3].sub(t.mul(3)).sub(e[0]);r.assign(n.mul(6))}else r.setCoords(0,0)}function Js(e,t,n,r){{let t=pe.subE(n),i=t.sqr(),a=n.sqr(),o=e[1].subE(e[0]).mulE(i).addE(e[2].subE(e[1]).mulE(new P(2).mulE(t).mulE(n))).addE(e[3].subE(e[2]).mulE(a));r.setE(o.mulE(new P(3)))}}function Ys(e,t,n){let r=new z;return qs(e,t,n,r),r}function Xs(e,t,n){let r=[J.constructPoint2D(e[0]),J.constructPoint2D(e[1]),J.constructPoint2D(e[2]),J.constructPoint2D(e[3])],i=new J;return Js(r,t,n,i),i}function Zs(e,t,n){let r=C(z,4);return e.queryControlPoints(r),Ys(r,t,n)}function Qs(e){let t=e.m_cp[0].sub(e.getStartXY()),n=e.m_cp[1].sub(e.m_cp[0]),r=e.getEndXY().sub(e.getStartXY());return t.mulThis(3),n.mulThis(3),r.subThis(n),n.subThis(t),(3*r.x*(2*n.y+5*t.y)-3*r.y*(2*n.x+5*t.x)+10*(n.x*t.y-n.y*t.x))/60}function $s(e){let t=C(z,4);e.queryControlPoints(t);let n=ec(t);return n&&(e.m_cp[0].setCoordsPoint2D(t[1]),e.m_cp[1].setCoordsPoint2D(t[2]),e.afterCompletedModification()),n}function ec(e){return Sr(e)}function tc(e){return Cr(e)}function nc(e,t,n){let r=new z,i=new z,a=new z,o=new z,s=new z;t<=.5?(g(2,e[0],e[1],t,r),g(2,e[1],e[2],t,i),g(2,e[2],e[3],t,a),g(2,r,i,t,o),g(2,i,a,t,s),g(2,o,s,t,n)):(ze(2,e[0],e[1],t,r),ze(2,e[1],e[2],t,i),ze(2,e[2],e[3],t,a),ze(2,r,i,t,o),ze(2,i,a,t,s),ze(2,o,s,t,n))}function rc(e,t,n,r){U(t>=0&&t<=1);let i=new z,a=new z,o=new z,s=new z,c=new z,l=new z;t<=.5?(g(2,e[0],e[1],t,i),g(2,e[1],e[2],t,a),g(2,e[2],e[3],t,o),g(2,i,a,t,s),g(2,a,o,t,c),g(2,s,c,t,l)):(ze(2,e[0],e[1],t,i),ze(2,e[1],e[2],t,a),ze(2,e[2],e[3],t,o),ze(2,i,a,t,s),ze(2,a,o,t,c),ze(2,s,c,t,l));let u=e[3].clone();n&&(n[0].assign(e[0]),n[1].assign(i),n[2].assign(s),n[3].assign(l)),r&&(r[0].assign(l),r[1].assign(c),r[2].assign(o),r[3].assign(u))}function ic(e,t,n,r){if(U(t>=0&&n<=1&&t<=n),t===n){let n=new z;ac(e,t,n),r[0].assign(n),r[1].assign(n),r[2].assign(n),r[3].assign(n);return}if(t===0&&n===1){for(let t=0;t<4;++t)r[t].assign(e[t]);return}let i=C(z,4);rc(e,n,i,null),rc(i,n>0?t/n:0,null,i),ac(e,t,i[0]),ac(e,n,i[3]),r[0].setCoordsPoint2D(i[0]),r[1].setCoordsPoint2D(i[1]),r[2].setCoordsPoint2D(i[2]),r[3].setCoordsPoint2D(i[3])}function ac(e,t,n,r){if(r){if(t<0){si(new Z({start:e[0],end:e[0].add(cc(e,0).getUnitVector())}),t,n);return}if(t>1){si(new Z({start:e[3],end:e[3].add(cc(e,1).getUnitVector())}),t-1,n);return}}if(t<=.5){let r=new z;g(2,e[0],e[1],t,r);let i=new z;g(2,e[1],e[2],t,i);let a=new z;g(2,e[2],e[3],t,a);let o=new z;g(2,r,i,t,o);let s=new z;g(2,i,a,t,s),g(2,o,s,t,n)}else{let r=new z;ze(2,e[0],e[1],t,r);let i=new z;ze(2,e[1],e[2],t,i);let a=new z;ze(2,e[2],e[3],t,a);let o=new z;ze(2,r,i,t,o);let s=new z;ze(2,i,a,t,s),ze(2,o,s,t,n)}}function oc(e,t,n){if(t.value()<=.5){let r=new J;F(2,J.constructPoint2D(e[0]),J.constructPoint2D(e[1]),t,r);let i=new J;F(2,J.constructPoint2D(e[1]),J.constructPoint2D(e[2]),t,i);let a=new J;F(2,J.constructPoint2D(e[2]),J.constructPoint2D(e[3]),t,a);let o=new J;F(2,r,i,t,o);let s=new J;F(2,i,a,t,s),F(2,o,s,t,n)}else{let r=new J;vt(2,J.constructPoint2D(e[0]),J.constructPoint2D(e[1]),t,r);let i=new J;vt(2,J.constructPoint2D(e[1]),J.constructPoint2D(e[2]),t,i);let a=new J;vt(2,J.constructPoint2D(e[2]),J.constructPoint2D(e[3]),t,a);let o=new J;vt(2,r,i,t,o);let s=new J;vt(2,i,a,t,s),vt(2,o,s,t,n)}}function sc(e,t,n){let r=C(z,4);e.queryControlPoints(r),oc(r,t,n)}function cc(e,t){let n=_e(t,0,1),r=Ys(e,1,n);return r.isZero()&&(r=Ys(e,2,n),r.isZero()?r=Ys(e,3,n):n===1&&r.negateThis()),r}function lc(e,t,n){let r=C(z,4);e.queryControlPoints(r),uc(r,t,n)}function uc(e,t,n){t.value()<0&&t.set(0,t.eps()),t.value()>1&&t.set(1,t.eps()),n.setE(Xs(e,1,t))}function dc(e,t,n,r,i){if(i){if(Rd(t,n)!==0)return e?4:2}else if(wr(t,n))return 1;return gc(e,t,n,null,null,null,r,i!==void 0&&i,!0,!1)===0?0:4}function fc(e,t,n,r,i){if(i){if(Rd(t,n)!==0)return e?4:2}else if(wr(t,n))return 1;return _c(e,t,n,null,null,null,r,i!==void 0&&i,!0,!1)===0?0:4}function pc(e,t,n,r,i){if(i){if(Rd(t,n)!==0)return 2}else if(wr(t,n))return 1;return vc(e,t,n,null,null,null,r,i!==void 0&&i,!0,!1)===0?0:4}function mc(e,t,n,r,i){if(i){if(Rd(t,n)!==0)return e?4:2}else if(wr(t,n))return 1;return yc(e,t,n,null,null,null,r,i!==void 0&&i,!0,!1)===0?0:4}function hc(e,t,n,r,i){if(i){if(Rd(t,n)!==0)return e?4:2}else if(wr(t,n))return 1;return bc(e,t,n,null,null,null,r,i??!1,!0,!1)===0?0:4}function gc(e,t,n,r,i,a,o,s,c,l){if(i!==null&&(i.length=0),a!=null&&(a.length=0),r!==null&&(r.length=0),n.isDegenerate(0)){let e=[0,0,0],s=t.intersectPoint(n.getStartXY(),e,o);if(s>0){if(i!==null)for(let t=0;t<s;t++)i.push(e[t]);if(a!==null)for(let e=0;e<s;e++)a.push(0);if(r!=null)for(let n=0;n<s;n++){let i=new z;t.queryCoord2D(e[n],i),r.push(i)}}return s}let u=Gr(t,n);if(Kr(t,n,o=Math.max(o,u)))return 0;let d=C(z,4);ks(t,d);let f=n.getEndXY();f.subThis(n.getStartXY());let p=f.clone();p.leftPerpendicularThis();let m=3*d[3].dotProduct(p),h=2*d[2].dotProduct(p),g=d[1].dotProduct(p),_=H(15,NaN),v=H(15,NaN),y=qi(m,h,g,I.unit(),!1,_);y<0&&(_[0]=0,_[1]=1,y=2);let b,x=0;for(let e=0,r=x;e<y;++e){let i=t.getCoord2D(_[e+r]);v[x]=n.getClosestCoordinate(i,!1),z.distance(i,n.getCoord2D(v[x]))<=o&&(_[x]=_[e+r],x++)}if(d[0].subThis(n.getStartXY()),Math.abs(f.x)>=Math.abs(f.y)){let e=f.y/f.x;m=d[3].y-d[3].x*e,h=d[2].y-d[2].x*e,g=d[1].y-d[1].x*e,b=d[0].y-d[0].x*e}else{let e=f.x/f.y;m=d[3].x-d[3].y*e,h=d[2].x-d[2].y*e,g=d[1].x-d[1].y*e,b=d[0].x-d[0].y*e}let S=t.getEndXY().equals(n.getStartXY())||t.getEndXY().equals(n.getEndXY()),w=[0,0,0];y=Ji(m,h,g,b,I.unit(),S,w);for(let e=0,r=x;e<y;++e){_[e+r]=w[e];let i=t.getCoord2D(_[e+r]);v[x]=n.getClosestCoordinate(i,!1),z.distance(i,n.getCoord2D(v[x]))<=o&&(_[x]=_[e+r],x++)}y=t.intersectPoint(n.getStartXY(),w,o);for(let e=0;e<y;e++)_[x]=w[e],v[x++]=0;y=t.intersectPoint(n.getEndXY(),w,o);for(let e=0;e<y;e++)_[x]=w[e],v[x++]=1;return n.intersectPoint(t.getStartXY(),w,o)!==0&&(v[x]=w[0],_[x++]=0),n.intersectPoint(t.getEndXY(),w,o)!==0&&(v[x]=w[0],_[x++]=1),x===0?0:Ud(e,t,n,_,v,x,r,i,a,o,s,c,l)}function _c(e,t,n,r,i,a,o,s,c,l){if(td(n))return gc(e,t,new Z({start:n.getStartXY(),end:n.getEndXY()}),r,i,a,o,s,c,l);let u=Gr(t,n);if(Kr(t,n,o=Math.max(o,u)))return 0;let d=[],f=[],p=[],m=C(z,4);{t.queryControlPoints(m);let e=C(z,4),r=new At;n.canonicToWorldTransformation(r);let i=new At;i.setInvert(r),i.transformPoints2D(m,4,e);let a=C(br,4);Ps(e,a);let c=[a[0].x,a[1].x,a[2].x,a[3].x],l=[a[0].y,a[1].y,a[2].y,a[3].y],u=C(A,3);u[0].setDouble(n.getSemiMinorAxis()),u[0].sqrThis(),u[1].setDouble(n.getSemiMajorAxis()),u[1].sqrThis(),u[2].setThis(u[0]),u[2].mulThis(u[1]),u[2].negateThis();let h=wa(c,3,l,3,null,0,u,!0,I.unit(),I.unit(),f,s);if(h>0){let e=0;for(let r=0;r<h;r++){let i=new z;t.queryCoord2D(f[r],i);let a=n.getClosestCoordinate(i,!1),s=new z;n.queryCoord2D(a,s),z.distance(i,s)<=o&&(d.push(i.clone()),f[e]=f[r],p.push(a),e++)}f.length=e,d.length=e}}let h=[0,1];for(let e=0;e<2;e++){let t=e===0?n.getStartXY():n.getEndXY(),r=[0];Tc(m,t,I.unit(),!1,-1,1,r);let i=new z;ac(m,r[0],i),z.distance(t,i)<=o&&(f.push(r[0]),p.push(h[e]),d.push(i.clone()))}for(let e=0;e<2;e++){let t=[0,3];{let r=n.getClosestCoordinate(m[t[e]],!1),i=new z;n.queryCoord2D(r,i),z.distance(m[t[e]],i)<=o&&(f.push(h[e]),p.push(r),d.push(i.clone()))}}return Ud(e,t,n,f,p,f.length,r,i,a,o,s,c,l)}function vc(e,t,n,r,i,a,o,s,c,l){let u=C(z,4);t.queryControlPoints(u);let d=C(z,4);if(n.queryControlPoints(d),qr(u,d,4)<0)return vc(e,n,t,r,a,i,o,s,c,!l);let f=Gr(t,n);if(Kr(t,n,o=Math.max(o,f)))return 0;if(Hc(t,n,r,i,a,o,s,c,l))return 2;let p=new I(0,1),m=new I(0,1);{let e=new pr;Cc(u,new I(0,1),e);let t=new pr;Cc(d,new I(0,1),t);let n=Math.max(e.maxDim(),t.maxDim());if(e.inflate(3*o),t.inflate(3*o),!e.intersectW(t))return 0;if(e.maxDim()<.1*n){if(Ic(u,e,p),p.isEmpty()||(Ic(d,e,m),m.isEmpty()))return 0;ic(u,p.vmin,p.vmax,u),ic(d,m.vmin,m.vmax,d)}}let h=Gd(u,3,d,3,o);if(h===0)return 0;let g=[],_=[],v=[],y=!1;if(h===-1){let e=C(br,4);Ps(u,e);let t=[e[0].x,e[1].x,e[2].x,e[3].x],n=[e[0].y,e[1].y,e[2].y,e[3].y],r=C(br,4);Ps(d,r);let i=[],a=[],s=xa(t,3,n,3,null,0,[r[0].x,r[1].x,r[2].x,r[3].x],3,[r[0].y,r[1].y,r[2].y,r[3].y],3,null,0,!0,I.unit(),I.unit(),i,a,c);if(s>0)for(let e=0;e<s;e++){let t=new z;ac(d,a[e],t);let n=new z;ac(u,i[e],n),z.distance(n,t)<=o&&(g.push(n.clone()),v.push(a[e]),_.push(i[e]))}else s===-1&&(y=!0)}for(let e=0;e<2;e++){let t=e===0?u:d,n=e===0?d:u;for(let r=0;r<2;r++){let i=r===0?0:3,a=[0];Tc(n,t[i],I.unit(),!1,-1,1,a);let s=new z;ac(n,a[0],s),z.distance(t[i],s)<=o&&(e===0?(_.push(i===0?0:1),v.push(a[0])):(v.push(i===0?0:1),_.push(a[0])),g.push(s.clone()))}}if(_.length===0&&y){let e=t.calculateUpperLength2D()>n.calculateUpperLength2D();{let r=[0,0];if(Ac(e?t:n,r,!0)===2&&(U(I.unit().containsCoordinate(r[0])),!I.unit().containsCoordinate(r[1]))){let t=new z;ac(e?u:d,r[0],t);let n=[0,0];Tc(e?d:u,t,I.unit(),!1,-1,2,n)===1&&(g.push(t.clone()),_.push(e?r[0]:n[0]),v.push(e?n[0]:r[0]))}}}if(_.length===0)return 0;if(!p.equalsRange(0,1))for(let e=0;e<_.length;++e)_[e]=Gc.recalculateParentT(p.vmin,p.vmax,_[e]);if(!m.equalsRange(0,1))for(let e=0;e<v.length;++e)v[e]=Gc.recalculateParentT(m.vmin,m.vmax,v[e]);return Ud(e,t,n,_,v,_.length,r,i,a,o,s,c,l)}function yc(e,t,n,r,i,a,o,s,c,l){let u=Gr(t,n);if(n.isDegenerateToLineHelper(u)){let u=new Z({start:n.getStartXY(),end:n.getEndXY()}),d=gc(e,t,u,r,i,a,o,s,c,l);if(a)for(let e=0;e<d;++e){let t=u.getCoord2D(a[e]);a[e]=n.getClosestCoordinate(t,!1)}return d}if(Kr(t,n,o=Math.max(o,u)))return 0;let d=C(z,4);t.queryControlPoints(d);let f=C(z,3);n.queryControlPoints(f);let p=new I(0,1),m=new I(0,1),h=[0,0,0];n.queryWeights(h);let g=[1,iu(h),1];{let e=new pr;Cc(d,new I(0,1),e);let t=new pr;jl(f,g,new I(0,1),t);let n=Math.max(e.maxDim(),t.maxDim());if(e.inflate(3*o),t.inflate(3*o),!e.intersectW(t))return 0;if(e.maxDim()<.1*n){if(Ic(d,e,p),p.isEmpty()||(ru(f,g,e,m),m.isEmpty()))return 0;ic(d,p.vmin,p.vmax,d),Ll(f,g,m.vmin,m.vmax,f,g)}}let _=Gd(d,3,f,2,o);if(_===0)return 0;let v=[],y=[],b=[];if(_===-1){let e=C(br,4);Ps(d,e);let t=[e[0].x,e[1].x,e[2].x,e[3].x],n=[e[0].y,e[1].y,e[2].y,e[3].y],r=C(A,3),i=C(A,3),a=C(A,3);Yl(f,g,r,i,a);let s=[],l=[],u=xa(r,2,i,2,a,2,t,3,n,3,null,0,!0,I.unit(),I.unit(),l,s,c);if(u>0)for(let e=0;e<u;e++){let t=new z;ac(d,s[e],t);let n=new z;nu(f,g,l[e],n),z.distance(t,n)<=o&&(v.push(t.clone()),y.push(s[e]),b.push(l[e]))}}for(let e=0;e<2;e++){let t,n;e===0?(t=d,n=f):(n=d,t=f);for(let r=0;r<2;r++){let i=r===0?0:t.length-1,a=[0],s=new z;if(e===0){let e=Dl(n,g,t[i],I.unit(),!1,-1,1,a);U(e===1),nu(n,g,a[0],s)}else{let e=Tc(n,t[i],I.unit(),!1,-1,1,a);U(e===1),ac(n,a[0],s)}z.distance(t[i],s)<=o&&(e===0?(y.push(i===0?0:1),b.push(a[0])):(b.push(i===0?0:1),y.push(a[0])),v.push(s.clone()))}}if(y.length===0)return 0;if(!p.equalsRange(0,1))for(let e=0;e<y.length;++e)y[e]=Gc.recalculateParentT(p.vmin,p.vmax,y[e]);if(!m.equalsRange(0,1))for(let e=0;e<b.length;++e)b[e]=ha.recalculateParentT(m.vmin,m.vmax,b[e]);for(let e=0;e<b.length;++e)b[e]=au(h,b[e]);return Ud(e,t,n,y,b,y.length,r,i,a,o,s,c,l)}function bc(e,t,n,r,i,a,o,s,c,l){let u=Gr(t,n);if(Kr(t,n,o=Math.max(o,u)))return 0;let d=C(z,4);t.queryControlPoints(d);let f=C(z,3);n.queryControlPoints(f);let p=Gd(d,3,f,2,o);if(p===0)return 0;let m=[],h=[],g=[];if(p===-1){let e=C(br,4);Ps(d,e);let r=[e[0].x,e[1].x,e[2].x,e[3].x],i=[e[0].y,e[1].y,e[2].y,e[3].y],a=C(br,3);Po(f,a);let c=xa([a[0].x,a[1].x,a[2].x],2,[a[0].y,a[1].y,a[2].y],2,null,0,r,3,i,3,null,0,!0,I.unit(),I.unit(),g,h,s);if(c>0){let e=0;for(let r=0;r<c;r++){let i=new z;t.queryCoord2D(h[r],i);let a=new z;n.queryCoord2D(g[r],a),z.distance(i,a)<=o&&(m.push(i.clone()),h[e]=h[r],g[e]=g[r],e++)}h.length=e,m.length=e}}for(let e=0;e<2;e++){let t,n;e===0?(t=d,n=f):(n=d,t=f);for(let r=0;r<2;r++){let i=r===0?0:t.length-1,a=[0],s=new z;if(e===0)fo(n,t[i],a),Fo(n,a[0],s);else{let e=Tc(n,t[i],I.unit(),!1,-1,1,a);U(e===1),ac(n,a[0],s)}z.distance(t[i],s)<=o&&(e===0?(h.push(i===0?0:1),g.push(a[0])):(g.push(i===0?0:1),h.push(a[0])),m.push(s.clone()))}}return Ud(e,t,n,h,g,h.length,r,i,a,o,s,c,l)}function xc(e,t,n,r,i){let a=new pr;if(Sc(e,I.unit(),a),a.inflate(r),!a.isIntersectingPoint2D(t))return 0;let o=Rs(e),s=0,c=o.specialPoints[0],l=[];for(let n=1,r=o.specialPoints.length;n<r;++n){let r=o.specialPoints[n],i=Gs(e,t,c,r);if(l.length===0)l.push(i);else if(i.t===i.tmin)U(l.at(-1).d<=i.d),l.at(-1).tmax=i.tmax;else if(l.at(-1).t===l.at(-1).tmax){U(l.at(-1).d>=i.d);let e=l.at(-1).tmin;l[l.length-1]=i,l.at(-1).tmin=e}else l.push(i);c=r}for(let e of l)if(e.d<=r){let t=e.t;n?(s>=n.length&&E(``),n[s]=t,s++):s++}return s}function Sc(e,t,n){let r=C(z,4);e.queryControlPoints(r),Cc(r,t,n)}function Cc(e,t,n){if(t.equalsRange(0,1))return void n.setFromPoints(e,4);let r=C(z,4);ic(e,t.vmin,t.vmax,r),n.setFromPoints(r,4)}var wc=class{constructor(e,t,n){this.dbgCounter=0,this.controlPoints=e,this.point=t.clone(),this.maxDistance=n}getMaxDerivative(){return 6}getValue(e,t){switch(e){case 0:{let e=new z;ac(this.controlPoints,t,e);let n=Ys(this.controlPoints,1,t);return 2*e.sub(this.point).dotProduct(n)}case 1:{let e=new z;ac(this.controlPoints,t,e);let n=Ys(this.controlPoints,1,t),r=Ys(this.controlPoints,2,t);return 2*(e.sub(this.point).dotProduct(r)+n.dotProduct(n))}case 2:{let e=new z;ac(this.controlPoints,t,e);let n=Ys(this.controlPoints,1,t),r=Ys(this.controlPoints,2,t),i=Ys(this.controlPoints,3,t);return 2*(e.sub(this.point).dotProduct(i)+3*n.dotProduct(r))}case 3:{let e=Ys(this.controlPoints,1,t),n=Ys(this.controlPoints,2,t),r=Ys(this.controlPoints,3,t);return 2*(4*e.dotProduct(r)+3*n.sqrLength())}case 4:{let e=Ys(this.controlPoints,2,t),n=Ys(this.controlPoints,3,t);return 2*(10*e.dotProduct(n))}case 5:{let e=Ys(this.controlPoints,3,t);return 2*(10*e.dotProduct(e))}default:return 0}}getError(e){return 0}isInterestingInterval(e,t){if(e>=0&&t<=1){let n=C(z,4);ic(this.controlPoints,e,t,n);let r=new pr;if(r.setFromPoints(n,4),Math.sqrt(r.sqrMinDistance(this.point))>this.maxDistance)return!1}return!0}};function Tc(e,t,n,r,i,a,o){be(I.unit().contains(n)&&a>0,`getClosestCoordinate`),(i<0||Number.isNaN(i))&&(i=Number.MAX_VALUE);let s=[],c=new z;ac(e,n.vmin,c);let l=z.distance(c,t);if(l<=i&&s.push(new z(n.vmin,l)),n.vmin!==n.vmax&&(ac(e,n.vmax,c),l=z.distance(c,t),l<=i&&s.push(new z(n.vmax,l))),n.width()>0){let r=H(18,NaN),a=Gi(new wc(e,t,i),n,18,r);for(let n=0;n<a;n++)ac(e,r[n],c),l=z.distance(c,t),l>i||s.push(new z(r[n],l))}if(r){U(n.equals(I.unit()));{ac(e,-1,c,!0);let n=new z;ac(e,0,n);let r=new Z({start:c,end:n}),a=r.getClosestCoordinate(t,!0);a<1&&(c.assign(r.getCoord2D(a)),l=z.distance(c,t),l<=i&&s.push(new z(a-1,l)))}{ac(e,2,c,!0);let r=new z;ac(e,n.vmax,r);let a=new Z({start:r,end:c}),o=a.getClosestCoordinate(t,!0);o>0&&(c.assign(a.getCoord2D(o)),l=z.distance(c,t),l<=i&&s.push(new z(1+o,l)))}}if(!s.length)return 0;s.sort((e,t)=>e.compare(t));let u=0,d=s[0].x;if(o[u++]=d,u<a){let t=Nn(e,4,!1).total(),n=s[0].y;for(let e=1,r=s.length;e<r;e++)if(s[e].y>n+t){s.length=e;break}s.sort((e,t)=>Me(e.x,t.x)),u=0,o[u++]=s[0].x;for(let e=1,t=s.length;e<t;e++)s[e].x!==o[u-1]&&u<a&&(o[u++]=s[e].x)}return u}function Ec(e,t,n,r,i,a,o){let s=C(z,4);return e.queryControlPoints(s),Tc(s,t,n,r,i,a,o)}function Dc(e){return e.getStartXY().norm(1)+e.getEndXY().norm(1)+e.m_cp[0].norm(1)+e.m_cp[1].norm(1)}function Oc(e){return e[0].norm(1)+e[1].norm(1)+e[2].norm(1)+e[3].norm(1)}function kc(e,t,n){if(U(n>=2),n===2){let r=new z;Ee(t[0],t[n-1],1/3,r);let i=new z;Ee(t[0],t[n-1],2/3,i),e.construct(t[0],r,i,t[n-1]);return}let r=t[0],i=t[n-1],a=[0,0],o=Ec(e,r,I.unit(),!1,NaN,2,a),s=[0,0],c=Ec(e,i,I.unit(),!1,NaN,2,s),l=[];for(let u=0;u<o;u++)for(let o=0;o<c;o++){let c=a[u],d=s[o],f=c>d,p=(a,o)=>{let s=H(n-2,NaN),l=()=>{let e=0;for(let r=1,i=n-1;r<i;r++){e+=z.distance(t[r-1],t[r]);let n=e;s[r-1]=n}e+=z.distance(t[n-2],t[n-1]),f&&s.reverse();for(let t=1,r=n-1;t<r;t++)s[t-1]/=e,f&&(s[t-1]=1-s[t-1])},u=!1,p=!1;{let t=new Q;f?(e.queryCut(d,c,t,!0),a.assign(t.get().getControlPoint2()),o.assign(t.get().getControlPoint1())):(e.queryCut(c,d,t,!0),a.assign(t.get().getControlPoint1()),o.assign(t.get().getControlPoint2())),r.equals(a)&&(u=!0),i.equals(o)&&(p=!0)}l();let m=Number.MAX_VALUE,h=a.clone(),g=o.clone();for(let e=0;e<5;e++)m=Uc(!0,!1,r,h,g,i,u,p,s,n-2,t,n);for(let e=0;e<30;e++){let e=h.clone();g.clone();let a=Uc(!0,!0,r,h,g,i,u,p,s,n-2,t,n);if(m<=a&&e.equals(h)&&e.equals(g))break;m=a}l();let _=!1,v=Number.MAX_VALUE,y=a.clone(),b=o.clone();for(let e=0;e<30;e++){let e=y.clone();b.clone();let a=Uc(_,!0,r,y,b,i,u,p,s,n-2,t,n);if(v<=a&&e.equals(y)&&e.equals(b))break;_=!0,v=a}return v<m?(a.assign(y),o.assign(b)):(a.assign(h),o.assign(g),v=m),v},m=new z,h=new z,g=[p(m,h),z.distance(r,m)+z.distance(m,h)+z.distance(h,i),m.x,m.y,h.x,h.y];l.splice(l.length,0,...g)}let u=l[0],d=l[1],f=0;for(let e=6;e<l.length;e+=6)l[e]<u&&(u=l[e],d=l[e+1],f=e);let p=f;for(let e=0;e<l.length;e+=6)e!==f&&l[e+1]<d&&Math.abs(u-l[e])<10*u&&(d=l[e+1],p=e);e.construct(r,new z(l[p+2],l[p+3]),new z(l[p+4],l[p+5]),i)}function Ac(e,t,n=!1){let r=C(z,4);e.queryControlPoints(r);let i=C(br,4),a,o,s;Ps(r,i,!0);let c=i[3].x.isZero(),l=i[3].y.isZero();if(c||l)if(c&&!l){if(i[2].x.isZero())return 0;a=i[1].x.div(i[2].x).negate(),o=i[2].y.div(i[3].y),s=i[1].y.div(i[3].y)}else{if(c||!l||i[2].y.isZero())return 0;a=i[1].y.div(i[2].y).negate(),o=i[2].x.div(i[3].x),s=i[1].x.div(i[3].x)}else{i[2].x.divThis(i[3].x),i[1].x.divThis(i[3].x),i[2].y.divThis(i[3].y),i[1].y.divThis(i[3].y);let e=i[2].x.sub(i[2].y);if(e.isZero())return 0;a=i[1].x.sub(i[1].y).div(e).negate(),o=i[2].x.clone(),s=i[1].x.clone()}if(!n&&a.abs().value()>2)return 0;let u=[0,0],d=e.getStartXY().equals(e.getEndXY()),f=qi(1,-a.toDouble(),a.add(o).mul(a).add(s).toDouble(),I.unit(),d,u);if(f===0)return 0;if(u[0]>=0&&u[0]<=1){let e=a.toDouble()-u[0];if(n||e>=0&&e<=1)return t[0]=u[0],t[1]=e,t[0]>t[1]&&(t[1]=W(t[0],t[0]=t[1])),2}if(f===2&&u[1]>=0&&u[1]<=1){let e=a.toDouble()-u[1];if(n||e>=0&&e<=1)return t[0]=u[1],t[1]=e,t[0]>t[1]&&(t[1]=W(t[0],t[0]=t[1])),2}return 0}function jc(e,t,n){let r=e[1].mulE(t[2]).subThisE(e[2].mulE(t[1])),i=e[1].mulE(t[3]).subThisE(e[3].mulE(t[1])).mulThis(3),a=e[2].mulE(t[3]).subThisE(e[3].mulE(t[2])).mulThis(3),o=C(P,2),s=ra(a,i,r,new I(0,1),!1,o);s<0&&(s=0);let c=0;for(let e=0;e<s;e++)re(o[e].value(),0,1)||(n[c].setE(o[e]),c++);return c}function Mc(e,t){t[0].set(0);let n=1,r=C(P,4);Ms(e,r,!0);let i=C(P,4);Ns(e,i,!0);{let e=r[3].mul(3),i=r[2].mul(2),a=r[1].clone(),o=C(P,2),s=ra(e,i,a,new I(0,1),!1,o);s<0&&(s=0);for(let e=0;e<s;e++)re(o[e].value(),0,1)||(t[n]=o[e],n++)}{let e=i[3].mul(3),r=i[2].mul(2),a=i[1].clone(),o=C(P,2),s=ra(e,r,a,new I(0,1),!1,o);s<0&&(s=0);for(let e=0;e<s;e++)re(o[e].value(),0,1)||(t[n]=o[e],n++)}if(n+=jc(r,i,t.slice(n)),t[n].set(1),n++,n>2){Ze(t,0,n,(e,t)=>{let n=e.value(),r=t.value();return n<r?-1:n>r?1:0});let r=0,i=t[0].clone(),a=0,o=Oc(e)*fe(),s=new z;nc(e,t[0].value(),s);for(let c=1;c<n;c++){let n=new z;if(nc(e,t[c].value(),n),t[c].eq(i)||n.isEqualPoint2D(s,o)){if(r!==0){if(t[c].eps()===0)i.setE(t[c]),a=0;else if(a!==0){let e=Ct(1/t[c].eps()),n=1/a,r=e+n;i.set((t[c].value()*e+i.value()*n)/r),a=1/r,i.setError(Math.sqrt(a))}t[r].setE(i),nc(e,i.value(),s)}}else r++,t[r].setE(t[c]),i.setE(t[c]),nc(e,i.value(),s),a=Ct(t[c].eps())}r++,n=r}return n===1&&(n=2,t[1].set(1)),U(t[0].value()===0),U(t[n-1].value()===1),n}function Nc(e,t,n,r,i){let a=C(P,4),o=C(P,3),s=new I(0,1),c=0;if(t){if(Ns(e,a,!1),c=ia(a[3],a[2],a[1],a[0].sub(n),s,!1,o),r)for(let t=0;t<c;t++){let n=new z;ac(e,o[t].value(),n),r[t]=n.x}}else if(Ms(e,a,!1),c=ia(a[3],a[2],a[1],a[0].sub(n),s,!1,o),r)for(let t=0;t<c;t++){let n=new z;ac(e,o[t].value(),n),r[t]=n.y}if(i)for(let e=0;e<c;e++)i[e]=o[e].value();else r&&Ze(r,0,c,Me);return c}function Pc(e,t,n,r){let i=Fc(e,t,n,r.getEnvelope2D());if(i.isEmpty())return new I(i);let a=C(z,n);for(let t=0;t<n;++t)r.xyRot(e[t],a[t]);let o=Fc(a,t,n,r.getRotatedEnvelope2D());return i.intersect(new I(o)),new I(i)}function Fc(e,t,n,r){let i=C(z,n);for(let e=0;e<n;++e)i[e]=new z(e/(n-1),0);let a=(e,t,n,r)=>{let i=new P(t.x).subE(new P(e.x)).divE(new P(t.y).subE(new P(e.y))).mulE(new P(n).subE(new P(e.y))).addE(new P(e.x));if(i.eps()>.1){let r=(t.x-e.x)/(t.y-e.y)*(n-e.y)+e.x;i.set(r,fe())}if(i.lt(new P(0))||i.gt(new P(1)))return!1;let a=i.value()-i.eps();a=_e(a,0,1);let o=i.value()+i.eps();return o=_e(o,0,1),r.mergeCoordinate(a),r.mergeCoordinate(o),!0},o=[];{let t=(e,t)=>{o.length=n;let r=cs(i,n,o,!0),s=new I;s.setEmpty();let c=n=>n.y<e?-1:n.y>t?1:0,l=i[o[0]],u=c(l);u===0&&s.mergeCoordinate(l.x);for(let n=1;n<=r;++n){let d=i[o[n%r]],f=c(d);f===0&&s.mergeCoordinate(d.x);let p=0;f!==u&&(p=f*u===0?f===1||u===1?2:1:3,1&p&&a(l,d,e,s),2&p&&a(l,d,t,s)),l=d,u=f}return s};for(let t=0;t<n;++t)i[t].y=e[t].x;let s=t(r.xmin,r.xmax);if(s.isEmpty())return new I(s);for(let t=0;t<n;++t)i[t].y=e[t].y;let c=t(r.ymin,r.ymax);return s.intersect(new I(c)),new I(s)}}function Ic(e,t,n){n.setEmpty(),n.merge(Pc(e,null,4,t))}function Lc(e,t,n){n.length=0;{let t=new P;Ks(e,t);let r=new J;if(lc(e,t,r),r.isZero())return t.isZero()||t.eq(new P(1))?0:(n.push(t.value()),1)}let r=C(P,4);As(e,r,!0);let i=C(P,4);js(e,i,!0);let a=C(P,6),o=r[3].negate().mulE(i[1]).addE(r[2].mulE(i[2]).mul(2)).addE(r[1].mulE(i[3])),s=r[3].negate().mulE(i[1]).subE(r[2].mulE(i[2]).mul(2)).addE(r[1].mulE(i[3])),c=r[2].mulE(r[2]).subE(i[2].mulE(i[2]));a[0]=i[1].mulE(i[1]).mulE(o).addE(r[1].mulE(r[1]).mulE(s)).addE(r[1].mulE(i[1]).mulE(c).mul(2)).mul(6),a[1]=r[2].mulE(i[1]).subE(r[1].mulE(i[2])).mulE(r[2].mulE(r[2]).addE(r[1].mulE(r[3]).mul(2)).addE(i[2].mulE(i[2])).addE(i[1].mulE(i[3]).mul(2))).mul(24);let l=r[1].mulE(i[2]).mulE(i[2]).mulE(i[3]),u=r[2].mulE(r[2]).mulE(r[3]).mulE(i[1]).subE(l).mul(156),d=r[3].mulE(i[1]).subE(r[1].mulE(i[3])),f=r[3].mulE(i[1]).subE(r[1].mulE(i[3])),p=r[1].mulE(r[3]).mulE(f).addE(i[1].mulE(i[3]).mulE(d)).mul(72),m=i[1].mulE(i[3]).subE(r[1].mulE(r[3])),h=r[2].mulE(i[2]).mulE(m).mul(120),g=r[1].mulE(r[2]).mulE(r[2]).mulE(i[3]),_=r[3].mulE(i[1]).mulE(i[2]).mulE(i[2]).subE(g).mul(36);a[2]=u.addE(p).addE(h).addE(_);let v=r[2].mulE(r[3]).mulE(r[3]).mulE(i[1]).subE(r[1].mulE(i[2]).mulE(i[3]).mulE(i[3])).mul(360),y=r[2].mulE(i[2]).mulE(r[2].mulE(r[3]).subE(i[2].mulE(i[3]))).addE(r[3].mulE(i[2]).mulE(i[2]).mulE(i[2])).subE(r[2].mulE(r[2]).mulE(r[2]).mulE(i[3])).mul(24),b=r[2].mulE(i[1]).mulE(i[3]).mulE(i[3]).subE(r[1].mulE(r[3]).mulE(r[3]).mulE(i[2])).mul(72),x=r[3].mulE(i[3]).mulE(i[1].mulE(i[2]).subE(r[1].mulE(r[2]))).mul(288);a[3]=v.addE(y).addE(b).addE(x),a[4]=i[3].mulE(i[3]).addE(r[3].mulE(r[3])).mulE(r[3].mulE(i[1]).subE(r[1].mulE(i[3]))).mul(270).addE(r[3].mulE(i[2]).subE(r[2].mulE(i[3]))).mulE(r[2].mulE(r[3]).addE(i[2].mulE(i[3]))).mul(180),a[5]=r[3].mulE(i[2]).subE(r[2].mulE(i[3])).mulE(r[3].mulE(r[3]).addE(i[3].mulE(i[3]))).mul(216);let S=C(P,5),w=aa(a,5,new I(0,1),!1,S,5);if(w>0){let r=Math.abs(e.getCurvature(0)),i=0,a=Math.abs(e.getCurvature(1));(a>r||!Number.isFinite(a))&&(i=1);for(let t=0;t<w;t++){let n=Math.abs(e.getCurvature(S[t].value()));e.getCoord2D(S[t].value()),(n>r||!Number.isFinite(n))&&(r=n,i=S[t].value())}if((!Number.isFinite(r)||1/r<t)&&!re(i,0,1)){let t=e.getCoord2D(i);if(!t.equals(e.getStartXY())&&!t.equals(e.getEndXY()))return n.push(i),1}}if(!e.isClosed()){let t=[0,0],r=Ac(e,t,!1);for(let e=0;e<r;e++)t[e]>0&&t[e]<1&&n.push(t[e]);return n.length}return 0}var Rc=class{constructor(e,t){this.b=e,this.len=t}getMaxDerivative(){return 1}getValue(e,t){return e===0?this.len-Fs(this.b,t,!1):0}getError(e){return 0}};function zc(e,t,n,r,i,a,o){for(;;){let s=z.distance(t[0],t[3]),l=z.distance(t[0],t[1])+z.distance(t[1],t[2])+z.distance(t[2],t[3]);if(l-s<=r+n*l)return e+c(s,l,.5);let u=e=>Ys(t,1,e).length();{U(o<12);let s=u(0),c=u(1);i[0]+=2,s>c&&(c=W(s,s=c),t[3]=W(t[0],t[0]=t[3]),t[2]=W(t[1],t[1]=t[2]));let d=s/(s+c),f=1,p=l;for(;d<1/32&&p>=32*(r+n*p);){f/=4;let e=u(f);i[0]++,d=s/(e+s);let n=new z;if(ac(t,.5*f,n),p=z.distance(n,t[0]),p<=r){let e=new z;ac(t,f,e),p+=z.distance(e,n)}}if(f!==1){let s=C(z,4);rc(t,f,t,s),e=zc(e,s,n,r,i,0,o+1),a++,o++;continue}}i[0]+=8;let d=Xo(8,u,0,1);i[0]+=16;let f=Xo(16,u,0,1),p=Math.abs(d-f)>r+n*l;if(!p)return e+f;if(a<3){let s=C(z,4);rc(t,.5,t,s),e=zc(e,s,n,r,i,a+1,o+1),a++,o++;continue}i[0]+=32;let m=Xo(32,u,0,1);if(p=Math.abs(f-m)>r+n*l,!p)return e+m;i[0]+=64;let h=Xo(64,u,0,1);if(p=Math.abs(m-h)>r+n*l,!p)return e+h;i[0]+=128;let g=Xo(128,u,0,1);return p=Math.abs(h-g)>r+n*l,e+g}}function Bc(e,t,n,r,i){if(n===t)return 0;let a=C(z,4);e.queryControlPoints(a);let o=C(z,4);return ic(a,t,n,o),zc(0,o,r,i,[0],0,0)}function Vc(e,t,n,r,i){let a=!0,o=Ba(5,t,n,r,i,t=>{let n=Zs(e,1,t);return(a?e.getCoordX(t)-e.getStartX():e.getCoordY(t)-e.getStartY())*n.length()});a=!1;let s=Ba(5,t,n,r,i,t=>{let n=Zs(e,1,t);return(a?e.getCoordX(t)-e.getStartX():e.getCoordY(t)-e.getStartY())*n.length()});return new z(o,s)}function Hc(e,t,n,r,i,a,o,s,c){let l=C(z,4);e.queryControlPoints(l);let u=C(z,4);if(t.queryControlPoints(u),l[0].equals(u[0])){if(l[1].equals(u[1])&&l[2].equals(u[2])&&l[3].equals(u[3]))return n&&(n.length=0,n.push(l[0]),n.push(l[3])),r&&(r.length=0,r.push(0),r.push(1)),i&&(i.length=0,i.push(0),i.push(1)),!0;if(!l[0].equals(u[3]))return!1}return!!(l[0].equals(u[3])&&l[1].equals(u[2])&&l[2].equals(u[1])&&l[3].equals(u[0]))&&(r&&(r.length=0,r.push(0),r.push(1),c&&(r[1]=W(r[0],r[0]=r[1]))),i&&(i.length=0,i.push(1),i.push(0),c&&(i[1]=W(i[0],i[0]=i[1]))),n&&(n.length=0,n.push(l[0]),n.push(l[3]),c&&(n[1]=W(n[0],n[0]=n[1]))),!0)}function Uc(e,t,n,r,i,a,o,s,c,l,u,d){U(l+2===d);let f=0,p=0,m=0,h=0,g=0,_=0,v=0,y=(e,t)=>{let o=1-t,s=n.mul(mt(o)),c=r.mul(3*t*o*o),l=i.mul(3*t*t*o),d=a.mul(mt(t));return s.add(c).add(l).add(d).sub(u[e]).sqrLength()};for(let t=1,o=d-1;t<o;t++){let o=c[t-1];if(e){t>2?(o=_e(2*c[t-2]-c[t-3],0,1),c[t-1]=o):t===2&&(o=_e(2*c[t-2],0,1),c[t-1]=o);let e=(e,t,o)=>{let s=-1;for(let c=0;!(Math.abs(t-s)<1e-12)&&c!==10;c++){let c=t*t,l=1-t,d=l*l,f=d*l,p=n.x-2*r.x+i.x,m=n.x-3*r.x+3*i.x-a.x,h=n.y-2*r.y+i.y,g=n.y-3*r.y+3*i.y-a.y,_=n.x-r.x-2*p*t+m*c,v=-u[e].x+n.x*f+t*(3*r.x*d+t*(3*i.x*l+a.x*t)),y=n.y-r.y-2*h*t+g*c,b=-u[e].y+n.y*f+t*(3*r.y*d+t*(3*i.y*l+a.y*t)),x=-6*(_*v+y*b),S=6*(3*Ct(_)-(-2*p+2*m*t)*v)+6*(3*Ct(y)-(-2*h+2*g*t)*b);if(s=t,S===0)break;t=_e(t-x/S,o,1)}return s};{let n=y(t,c[t-1]),r=e(t,c[t-1],0),i=y(t,r);if(1.01*n<i){let n=t>1?c[t-2]:0,a=e(t,.3*(c[t-1]-n)+n,0),o=y(t,a);o<i&&(i=o,r=a)}n>i&&(c[t-1]=r)}}let s=c[t-1],l=s*s,d=l*s,b=1-s,x=b*b,S=x*b;f+=3*l*x*x,p+=3*d*S,m+=3*l*l*x;let C=-(S*n.x+d*a.x-u[t].x);h+=C*s*x,g+=C*l*b;let w=-(S*n.y+d*a.y-u[t].y);_+=w*s*x,v+=w*l*b}if(t){let e=f*m-p*p;Math.abs(e)>=1e-12*(Math.abs(f*m)+Math.abs(p*p))+1e-10?(o||(r.x=(h*m-g*p)/e,r.y=(_*m-v*p)/e),s||(i.x=(f*g-p*h)/e,i.y=(f*v-p*_)/e)):(Ee(n,a,.3,r),Ee(n,a,.6,i))}let b=0;for(let e=1,t=d-1;e<t;e++)b+=y(e,c[e-1]);return b}var Wc=Rt,Gc=class e extends ai{constructor(e){e&&e.cp?(super({start:e.cp[0],end:e.cp[3],vd:e.vd}),this.m_cp=C(z,2),this.m_cp[0].assign(e.cp[1]),this.m_cp[1].assign(e.cp[2])):e===void 0||ue(e,`vd`)?(super({vd:e?.vd,XStart:0,YStart:0,XEnd:0,YEnd:0}),this.m_cp=C(z,2),this.m_cp[0].setCoords(0,0),this.m_cp[1].setCoords(0,0)):e.from?(super({start:e.from,end:e.to,vd:e.vd}),this.m_cp=C(z,2),this.m_cp[0].assign(e.cp1),this.m_cp[1].assign(e.cp2)):(super({XStart:0,YStart:0,XEnd:0,YEnd:0,vd:e.vd}),B(`unrecognized constructor params`),this.m_cp=C(z,2),this.m_cp[0].setCoords(0,0),this.m_cp[1].setCoords(0,0)),this.m_cachedValues=0}getBoundary(){return Ui(this)}construct(e,t,n,r){this.m_XStart=e.x,this.m_YStart=e.y,this.m_XEnd=r.x,this.m_YEnd=r.y,this.m_cp[0].assign(t),this.m_cp[1].assign(n),this.afterCompletedModification()}constructPoints(e){this.m_XStart=e[0].x,this.m_YStart=e[0].y,this.m_XEnd=e[3].x,this.m_YEnd=e[3].y,this.m_cp[0].assign(e[1]),this.m_cp[1].assign(e[2]),this.afterCompletedModification()}constructFromQuadratic(e){let t=C(z,4);Bo(e,t),this.constructPoints(t)}constructFromQuadraticSegment(e){this.dropAllAttributes(),this.assignVertexDescription(e.getDescription()),this.m_XStart=e.getStartX(),this.m_YStart=e.getStartY(),this.m_XEnd=e.getEndX(),this.m_YEnd=e.getEndY(),qe(2,e.getStartXY(),e.getControlPoint1(),2/3,this.m_cp[0]),qe(2,e.getControlPoint1(),e.getEndXY(),1/3,this.m_cp[1]),this.afterCompletedModification(),Hr(this,e)}getGeometryType(){return L.enumBezier}queryEnvelope(e){if(e.m_EnvelopeType!==2)return void U(0);if(e.setCoords(this.getStartXY()),e.mergeNe(this.getEndXY()),e.contains(this.m_cp[0])&&e.contains(this.m_cp[1]))return;let t=zs(this);if(t!==null){let n=new z;for(let r of t.specialPoints)this.queryCoord2D(r,n),e.mergeNe(n);return}let n=C(P,8),r=C(z,4);this.queryControlPoints(r);let i=Mc(r,n),a=new z;for(let t=1;t<i-1;t++)this.queryCoord2D(n[t].value(),a),e.mergeNe(a)}applyTransformation(e){if(e.m_TransformationType===1){let t=C(z,4);this.queryControlPoints(t),e.transformPoints2D(t,4,t),this.setStartXY(t[0]),this.m_cp[0].assign(t[1]),this.m_cp[1].assign(t[2]),this.setEndXY(t[3]),Vs(this);return}U(0)}createInstance(){return new e({vd:this.m_description})}calculateLength2D(){return Fs(this,1,!1)}calculateLowerLength2D(){return z.distance(this.getStartXY(),this.getEndXY())}calculateUpperLength2D(){return z.distance(this.getStartXY(),this.m_cp[0])+z.distance(this.m_cp[0],this.m_cp[1])+z.distance(this.getEndXY(),this.m_cp[1])}queryCoord2D(e,t){return this.queryCoord2DExtends(e,t,!0)}queryCoord2DMP(e,t){U(0)}queryCoord2DExtends(e,t,n){let r=C(z,4);this.queryControlPoints(r),ac(r,e,t,n)}queryCoord2DE(e,t){sc(this,e,t)}getCoordX(e){if(e<0||e>1){let t=new z;return this.queryCoord2DExtends(e,t,!0),t.x}let t=c(this.getStartX(),this.m_cp[0].x,e),n=c(this.m_cp[0].x,this.m_cp[1].x,e),r=c(this.m_cp[1].x,this.getEndX(),e),i=c(t,n,e),a=c(n,r,e);return c(i,a,e)}getCoordY(e){if(e<0||e>1){let t=new z;return this.queryCoord2DExtends(e,t,!0),t.y}let t=c(this.getStartY(),this.m_cp[0].y,e),n=c(this.m_cp[0].y,this.m_cp[1].y,e),r=c(this.m_cp[1].y,this.getEndY(),e),i=c(t,n,e),a=c(n,r,e);return c(i,a,e)}cut(e,t,n){let r=new Q;return this.queryCut(e,t,r,n),r.releaseSegment()}queryCut(e,t,n,r){let i=n.createCubicBezier();if(this.cutBezierIgnoreAttributes(e,t,i),r)return;i.assignVertexDescription(this.m_description);let a=this.m_description.getAttributeCount();if(a>1){for(let t=1;t<a;t++){let n=this.m_description.getSemantics(t),r=Wc.getComponentCount(n);for(let t=0;t<r;t++){let r=this.getAttributeAsDbl(e,n,t);i.setStartAttribute(n,t,r)}}for(let e=1;e<a;e++){let n=this.m_description.getSemantics(e),r=Wc.getComponentCount(n);for(let e=0;e<r;e++){let r=this.getAttributeAsDbl(t,n,e);i.setEndAttribute(n,e,r)}}}}queryDerivative(e,t){lc(this,e,t)}cutBezierIgnoreAttributes(e,t,n){(e<0||t>1||e>t)&&R(`Cubic_bezier.cut_bezier_ignore_attributes`);let r=C(z,4);this.queryControlPoints(r);let i=C(z,4);ic(r,e,t,i),n.setControlPoints(i)}splitBezierIgnoreAttributes(e,t,n){this===t&&this===n&&R(`Cubic_bezier.split_bezier_ignore_attributes`);let r=C(z,4);this.queryControlPoints(r);let i=C(z,4),a=C(z,4);rc(r,e,i,a),t&&t.setControlPoints(i),n&&n.setControlPoints(a)}getAttributeAsDbl(e,t,n){if(t===0)return n===0?this.getCoordX(e):this.getCoordY(e);if(e===0)return this.getStartAttributeAsDbl(t,n);if(e===1)return this.getEndAttributeAsDbl(t,n);let r=this.getStartAttributeAsDbl(t,n),i=this.getEndAttributeAsDbl(t,n),a=this.calculateLength2D(),o=a>0?this.tToLength(e)/a:0,s=Wc.getInterpolation(t);return le(s,r,i,o,Wc.getDefaultValue(t))}getClosestCoordinate(e,t){let n=[NaN];return Ec(this,e,I.unit(),t,-1,1,n),n[0]}getClosestCoordinateOnInterval(e,t,n=-1){let r=[NaN];return Ec(this,e,t,!1,n,1,r)===0?NaN:r[0]}getYMonotonicParts(e,t=!1){return this.getMonotonicParts(e,t)}getMonotonicParts(e,t){e.length<2&&R(``);let n=Rs(this);if(n.specialPointsCount()===2&&this.isMonotoneQuickAndDirty())return 0;let r=0;U(e.length>=n.specialPointsCount()-1);for(let i=1,a=n.specialPointsCount();i<a;++i)this.queryCut(n.specialPoints[i-1],n.specialPoints[i],e[r],t),r++;for(let t=0;t<r;++t)$s(e[t].get());return r}intersectionWithAxis2D(e,t,n,r){let i=C(z,4);return this.queryControlPoints(i),Nc(i,e,t,n,r)}intersectionOfYMonotonicWithAxisX(e,t){if(this.m_YStart===this.m_YEnd)return e===this.m_YStart?t:NaN;if(e===this.m_YStart)return this.m_XStart;if(e===this.m_YEnd)return this.m_XEnd;let n=[0,0],r=this.intersectionWithAxis2D(!0,e,n,null);return U(r!==2),r===-1?t:n[0]}isCurve(){return!0}isDegenerate(e){return Tr(this,e)}isDegenerate3D(e,t){return U(0),!1}queryLooseEnvelope(e){if(e.m_EnvelopeType===2)return e.setCoords({pt:this.getStartXY()}),e.mergeNe(this.m_cp[0]),e.mergeNe(this.m_cp[1]),void e.mergeNe(this.getEndXY());U(0)}clone(e){let t=this.createInstance();return this.copyTo(t),t}queryInterval(e,t){if(e===0){let e=G.constructEmpty();this.queryEnvelope(e);let n=I.constructEmpty();return t===0?e.queryIntervalX(n):e.queryIntervalY(n),n}return super.queryInterval(e,t)}queryLooseEnvelopeOnInterval(e,t){let n=C(z,4);this.queryControlPoints(n),ic(n,e.vmin,e.vmax,n),t.setFromPoints(n,4)}changeEndPoints2D(e,t){if(e.isEqual(this.m_XStart,this.m_YStart)&&t.isEqual(this.m_XEnd,this.m_YEnd))return;let n=this.m_cp[0].isEqual(this.m_XStart,this.m_YStart),r=this.m_cp[0].isEqual(this.m_XEnd,this.m_YEnd),i=this.m_cp[1].isEqual(this.m_XStart,this.m_YStart),a=this.m_cp[1].isEqual(this.m_XEnd,this.m_YEnd);this.setStartXY(e),this.setEndXY(t),n?this.m_cp[0].setCoordsPoint2D(e):r&&this.m_cp[0].setCoordsPoint2D(t),a?this.m_cp[1].setCoordsPoint2D(t):i&&this.m_cp[1].setCoordsPoint2D(e),this.normalizeAfterEndpointChange()}tToLength(e){return Fs(this,e,!0)}lengthToT(e){return Is(this,e)}calculateWeightedAreaCentroid2D(e){let t=C(z,4);ks(this,t);let n=t[3],r=t[2],i=t[1],a=new z;a.x=(5*n.x*n.x*(7*r.y+16*i.y)+n.x*(-35*n.y*r.x+40*r.x*r.y-80*n.y*i.x+140*r.x*i.y+112*i.x*i.y)-2*(n.y*(20*r.x*r.x+70*r.x*i.x+56*i.x*i.x)-7*(4*r.x+5*i.x)*(-r.y*i.x+r.x*i.y)))/840,a.y=(-5*n.y*n.y*(7*r.x+16*i.x)+n.y*(5*n.x*(7*r.y+16*i.y)-4*(10*r.x*r.y+35*r.y*i.x+28*i.x*i.y))+2*(-7*(4*r.y+5*i.y)*(r.y*i.x-r.x*i.y)+n.x*(20*r.y*r.y+70*r.y*i.y+56*i.y*i.y)))/840;let o=Qs(this);return a.x+=(t[0].x-e.x)*o,a.y+=(t[0].y-e.y)*o,a}calculateWeightedCentroid2D(){let e=new z;return this.isDegenerate(0)?(e.setCoords(0,0),e):Os(this)?(e.assign(this.getCoord2D(.5).mul(this.calculateLength2D())),e):(e.assign(Ls(this,1)),e)}getControlPoint1(){return this.m_cp[0].clone()}setControlPoint1(e){this.m_cp[0].setCoordsPoint2D(e),this.afterCompletedModification()}getControlPoint2(){return this.m_cp[1].clone()}setControlPoint2(e){this.m_cp[1].setCoordsPoint2D(e),this.afterCompletedModification()}queryControlPoints(e){e[0].assign(this.getStartXY()),e[1].assign(this.m_cp[0]),e[2].assign(this.m_cp[1]),e[3].assign(this.getEndXY())}queryControlPointsHelper(e){return this.queryControlPoints(e),4}setControlPoints(e){for(let t=0;t<4;t++)e[t].isNAN()&&R(`NAN control points in bezier are not supported`);this.m_XStart=e[0].x,this.m_YStart=e[0].y,this.m_cp[0].setCoordsPoint2D(e[1]),this.m_cp[1].setCoordsPoint2D(e[2]),this.m_XEnd=e[3].x,this.m_YEnd=e[3].y,this.afterCompletedModification()}getTangent(e){let t=C(z,4);return this.queryControlPoints(t),cc(t,e)}getDerivative(e){let t=C(z,4);return this.queryControlPoints(t),Ys(t,1,e)}getCurvature(e){let t=Zs(this,1,e),n=Zs(this,2,e),r=t.sqrLength();return r===0?NaN:(t.divThis(Math.sqrt(r)),t.crossProduct(n)/r)}isIntersectingPoint(e,t,n){if(n&&(e.equals(this.getStartXY())||e.equals(this.getEndXY())))return!1;let r=new G;if(this.queryLooseEnvelope(r),r.inflateCoords(t,t),!r.contains(e))return!1;let i=this.getClosestCoordinate(e,!1),a=new z;return this.queryCoord2D(i,a),z.distance(a,e)<=t}isIntersectingPoint3D(e,t,n,r,i=1){return U(0),!1}isMonotoneQuickAndDirty(){let e=C(z,4);return this.queryControlPoints(e),tc(e)}getMonotonicPartParams(e,t){let n=Rs(this),r=n.specialPointsCount();if(U(Yr.s_maxMonotonicPartParams>=r),!t)return n.specialPointsCount();e<r&&R(``);for(let e=0;e<r;e++)t[e]=n.specialPoints[e];return r}normalizeAfterEndpointChange(){return!1}orientBottomUp(){if(this.m_YEnd<this.m_YStart||this.m_YEnd===this.m_YStart&&this.m_XEnd<this.m_XStart){this.m_XEnd=W(this.m_XStart,this.m_XStart=this.m_XEnd),this.m_YEnd=W(this.m_YStart,this.m_YStart=this.m_YEnd);for(let e=0,t=this.m_description.getTotalComponentCount()-2;e<t;e++)this.m_attributes[e+t]=W(this.m_attributes[e],this.m_attributes[e]=this.m_attributes[e+t]);this.m_cp[1]=W(this.m_cp[0],this.m_cp[0]=this.m_cp[1]),this.m_cachedValues=null}}findMinDeriv(){let e=new P;return Ks(this,e),e.value()}isLine(){return!1}isDegenerateToLineHelper(e){let t=C(z,4);this.queryControlPoints(t);let n=t[3].sub(t[0]),r=n.length();if(z.distance(t[0],t[1])+z.distance(t[2],t[1])+z.distance(t[2],t[3])-r>e)return!1;let i=e,a=t[1].clone();a.subThis(t[0]);let o=Math.abs(a.crossProduct(n))/r;return!(o>i)&&(a=t[2].clone(),a.subThis(t[1]),o=Math.abs(a.crossProduct(n))/r,!(o>i))}copyIgnoreAttributes(e){let t=C(z,4);this.queryControlPoints(t),e.setControlPoints(t)}calculateArea2DHelper(){return Qs(this)}absNorm(){return Dc(this)}queryEnvelopeW(e,t){Sc(this,e,t)}setSegmentFromCoordsForStitcher(e,t){kc(this,e,t)}writeInBufferStream(e,t){let n=new Float64Array(4);return this.writeInBuffer_(n),e.writeRangeFromArray(t,n.length,n,!0,1),t+n.length}writeInBuffer_(e){return e[0]=this.m_cp[0].x,e[1]=this.m_cp[0].y,e[2]=this.m_cp[1].x,e[3]=this.m_cp[1].y,4}readFromBufferStream(e,t){let n=new Float64Array(4);e.queryRange(t,n.length,n,!0,1),this.readFromBuffer_(n)}readFromBuffer_(e){this.m_cp=C(z,2),this.m_cp[0].x=e[0],this.m_cp[0].y=e[1],this.m_cp[1].x=e[2],this.m_cp[1].y=e[3],this.m_cachedValues=null}snapControlPoints(e){let t=C(z,4);this.queryControlPoints(t);let n=(t,n,r)=>{let i=!1;return z.sqrDistance(t,r)<=e&&(i=!t.equals(r),t.setCoordsPoint2D(r),z.sqrDistance(n,r)<=e&&(i||=!n.equals(r),n.setCoordsPoint2D(r))),i},r=n(t[1],t[2],t[0]),i=n(t[2],t[1],t[3]);return(r||i)&&this.setControlPoints(t),r||i}needsSnapControlPoints(e){if(!e)return!1;let t=C(z,4);this.queryControlPoints(t);let n=(t,n,r)=>{let i=!1;return z.sqrDistance(t,r)<=e&&(i=!t.equals(r),t.setCoordsPoint2D(r),z.sqrDistance(n,r)<=e&&(i||=!n.equals(r),n.setCoordsPoint2D(r))),i},r=n(t[1],t[2],t[0]),i=n(t[2],t[1],t[3]);return r||i}calculateSpecialPointsForCracking(e,t){return Lc(this,e,t)}ensureXYMonotone(){return $s(this)}setCoordsForIntersector(e,t,n){Us(this,e,t,n)}copyToImpl(e){let t=e;t.m_cp[0].assign(this.m_cp[0]),t.m_cp[1].assign(this.m_cp[1]),Bs(t,zs(this))}reverseImpl(){this.m_cp[1]=W(this.m_cp[0],this.m_cp[0]=this.m_cp[1])}equalsImpl(e){let t=e;return!!this.m_cp[0].equals(t.m_cp[0])&&!!this.m_cp[1].equals(t.m_cp[1])}equalsImplTol(e,t){let n=e;return!!this.m_cp[0].isEqualPoint2D(n.m_cp[0],t)&&!!this.m_cp[1].isEqualPoint2D(n.m_cp[1],t)}swapImpl(e){let t=e;t.m_cp[0]=W(this.m_cp[0],this.m_cp[0]=t.m_cp[0]),t.m_cp[1]=W(this.m_cp[1],this.m_cp[1]=t.m_cp[1]),Hs(this,t)}afterCompletedModification(){Vs(this)}isIntersecting(e,t,n){return Id(!1,this,e,t,n)!==0}intersect(e,t,n,r,i){return Bd(!1,this,e,t,n,r,i)}intersectPoint(e,t,n){return xc(this,e,t,n)}endPointModified(){Vs(this)}clearEndPointModified(){}};Gc.type=L.enumBezier;var Kc=class{constructor(){this.length=NaN,this.area=NaN,this.centroidX=NaN,this.centroidY=0,this.specialPoints=[],this.specialPointsLength=[]}specialPointsCount(){return this.specialPoints.length}};function qc(e,t,n,r,i,a,o,s){for(;;){let l=z.distance(t[0],t[2]),u=z.distance(t[0],t[1])+z.distance(t[1],t[2]);if(u-l<=i+r*u)return e+c(l,u,.5);let d=C(z,4),f=e=>(il(t,n,1,e,d),d[1].length());if(o===0&&s<8){U(s<8);let c=f(0),l=f(1);a[0]+=2,c>l&&(l=W(c,c=l),t[2]=W(t[0],t[0]=t[2]),n[2]=W(n[0],n[0]=n[2]));let d=c/(c+l),p=1,m=u;for(;d<1/32&&m>=i+r*m;){p/=4;let e=f(p);a[0]++,d=c/(e+c);let r=new z;if(nu(t,n,.5*p,r),m=z.distance(r,t[0]),m<=i){let e=new z;nu(t,n,p,e),m+=z.distance(e,r)}}if(p!==1){let c=C(z,3),l=[0,0,0];Il(t,n,p,t,n,c,l),e=qc(e,c,l,r,i,a,0,s+1),o++,s++;continue}}let p=!1;a[0]+=8;let m=Xo(8,f,0,1);a[0]+=16;let h=Xo(16,f,0,1);if(p=Math.abs(m-h)>i+r*u,!p)return e+h;if(o<8&&s<9){let c=C(z,3),l=[0,0,0];Il(t,n,.5,t,n,c,l),e=qc(e,c,l,r,i,a,o+1,s+1),o++,s++;continue}a[0]+=32;let g=Xo(32,f,0,1);if(p=Math.abs(h-g)>i+r*u,!p)return e+g;a[0]+=64;let _=Xo(64,f,0,1);if(p=Math.abs(g-_)>i+r*u,!p)return e+_;a[0]+=128;let v=Xo(128,f,0,1);return p=Math.abs(_-v)>i+r*u,e+v}}function Jc(e,t,n,r,i){if(n===t)return 0;let a=C(z,3),o=[0,0,0];e.queryControlPoints(a),e.queryWeights(o);let s=[0,0,0],c=C(z,3);return Ll(a,o,t,n,c,s),qc(0,c,s,r,i,[0],0,0)}var Yc=class{constructor(e,t,n){this.controlPoints=x(e,3),this.weights=[0,0,0],Qe(this.weights,t,0,0,3),this.point=n.clone()}getMaxDerivative(){return 3}getValue(e,t){if(e===0){let e=new z;nu(this.controlPoints,this.weights,t,e);let n=C(z,4);return il(this.controlPoints,this.weights,1,t,n),2*e.sub(this.point).dotProduct(n[1])}if(e===1){let e=new z;nu(this.controlPoints,this.weights,t,e);let n=C(z,4);return il(this.controlPoints,this.weights,2,t,n),2*(e.sub(this.point).dotProduct(n[2])+n[1].dotProduct(n[1]))}if(e===2){let e=new z;nu(this.controlPoints,this.weights,t,e);let n=C(z,4);return il(this.controlPoints,this.weights,3,t,n),2*(e.sub(this.point).dotProduct(n[3])+3*n[1].dotProduct(n[2]))}return 0}getError(e){return U(0),0}};function Xc(e,t,n,r){let i=Ol(0,0,0,0,z.getNAN()),a=H(18,NaN),o=C(z,3);e.queryControlPoints(o),o[2].subThis(t),o[1].subThis(t),o[0].subThis(t);let s=[0,0,0];e.queryWeights(s);let c=[1,iu(s),1],l=ou(s,n),u=ou(s,r),d=Gi(new Yc(o,c,new z(0,0)),I.construct(l,u),18,a);nu(o,c,l,i.pt),i.t=l,i.d=z.distance(i.pt,new z(0,0));let f=new z;nu(o,c,u,f);let p=z.distance(f,new z(0,0));p<i.d&&(i.d=p,i.t=u,i.pt.assign(f));for(let e=0;e<d;e++){nu(o,c,a[e],f);let t=z.distance(f,new z(0,0));t<i.d&&(i.d=t,i.t=au(s,a[e]),i.pt.assign(f))}return i}function Zc(e,t,n,r,i){let a=!0,o=C(z,4),s=Ba(5,t,n,r,i,t=>(rl(e,1,t,o),(a?e.getCoordX(t)-e.getStartX():e.getCoordY(t)-e.getStartY())*o[1].length()));a=!1;let c=Ba(5,t,n,r,i,t=>(rl(e,1,t,o),(a?e.getCoordX(t)-e.getStartX():e.getCoordY(t)-e.getStartY())*o[1].length()));return new z(s,c)}function Qc(e){e.m_cachedValues=null}function $c(e,t){t.m_cachedValues=W(e.m_cachedValues,e.m_cachedValues=t.m_cachedValues)}function el(e){if(e.m_cachedValues)return e.m_cachedValues;let t=new Kc,n=C(z,3);e.queryControlPoints(n);let r=[0,0,0];return e.queryWeights(r),tl(n,r,t.specialPoints),Tl(e,t),t}function tl(e,t,n){if(t[1]===0)return n.length=0,n.push(0),void n.push(1);let r=C(P,8);r[0].set(0);let i=1;{let n=new P(e[1].x).subThis(e[0].x).mulThis(t[1]).mulThis(t[0]),a=new P(e[2].x).subThis(e[0].x).mulThis(t[2]).mulThis(t[0]),o=n.subE(a).addThisE(new P(e[2].x).subThis(e[1].x).mulThis(t[2]).mulThis(t[1]));a.subThisE(n.mul(2));let s=C(P,2),c=ra(o,a,n,new I(0,1),!1,s);c<0&&(c=0);for(let e=0;e<c;e++)re(s[e].value(),0,1)||(r[i]=s[e],i++)}{let n=new P(e[1].y).subThis(e[0].y).mulThis(t[1]).mulThis(t[0]),a=new P(e[2].y).subThis(e[0].y).mulThis(t[2]).mulThis(t[0]),o=n.subE(a).addThisE(new P(e[2].y).subThis(e[1].y).mulThis(t[2]).mulThis(t[1]));a.subThisE(n.mul(2));let s=C(P,2),c=ra(o,a,n,new I(0,1),!1,s);c<0&&(c=0);for(let e=0;e<c;e++)re(s[e].value(),0,1)||(r[i]=s[e],i++)}if(r[i].set(1),i++,i>2){Ze(r,0,i,(e,t)=>Me(e.value(),t.value()));let e=0,t=r[0].value(),n=1;for(let a=1;a<i;a++)r[a].eq(r[a-1])?(t+=r[a].value(),n++):(n>1&&(t/=n,r[e].set(t)),e++,r[e]=r[a],t=r[a].value(),n=1);e++,i=e}r[0].set(0),r[i-1].set(1),n.length=i;for(let e=0;e<i;e++)n[e]=r[e].value()}function nl(e,t,n){if(n){if(t<0)return t;if(t>1)return t-1+nl(e,1,!1)}if(e.isDegenerate(0))return 0;let r=t===1,i=el(e);if(r&&!Number.isNaN(i.length))return i.length;let a=xl(e),o=a/e.calculateUpperLength2D(),s=0,c=0;for(let n=1,r=i.specialPointsCount();n<r;n++){let r=i.specialPoints[n];if(s+=Jc(e,c,Math.min(t,r),o,a),t<=r)break;c=r}return r&&(i.length=s),s}function rl(e,t,n,r){let i=C(z,3);e.queryControlPoints(i);let a=[0,0,0];e.queryWeights(a),il(i,a,t,n,r)}function il(e,t,n,r,i){let a=[e[0],e[1],e[2]],o=[t[0],t[1],t[2]],s=C(z,4);al(a,o,n,r,s);for(let e=0;e<=n;e++)i[e].setCoords(s[e].x,s[e].y)}function al(e,t,n,r,i){U(n>0);let a=[e[0].clone(),e[1].clone(),e[2].clone()];if(!a[0].isZero()){for(let e=1;e<3;++e)a[e].subThis(a[0]);a[0].setCoords(0,0)}let o=ol(a,t,0,r),s=cl(t,0,r),c=o.divide(s);if(i[0].assign(c),n===0)return;let l=[t[1]*t[0],t[2]*t[0]*.5,t[1]*t[2]],u=[e[1].sub(e[0]),e[2].sub(e[0]),e[2].sub(e[1])],d=s*s,f=ol(u,l,0,r).mul(2).divide(d);if(i[1].assign(f),n===1)return;let p=cl(t,1,r),m=2*s*p,h=ol(u,l,1,r).mul(2).sub(f.mul(m)).divide(d);if(i[2].assign(h),n===2)return;let g=ol(u,l,2,r).mul(2),_=2*(p*p+s*cl(t,2,r)),v=g.sub(h.mul(m).mul(2)).sub(f.mul(_)).divide(d);i[3].assign(v),n!==3&&B(``)}function ol(e,t,n,r){if(n===0){if(r<=.5){let n=new z;g(2,e[0].mul(t[0]),e[1].mul(t[1]),r,n);let i=new z;g(2,e[1].mul(t[1]),e[2].mul(t[2]),r,i);let a=new z;return g(2,n,i,r,a),a}{let n=new z;ze(2,e[0].mul(t[0]),e[1].mul(t[1]),r,n);let i=new z;ze(2,e[1].mul(t[1]),e[2].mul(t[2]),r,i);let a=new z;return ze(2,n,i,r,a),a}}if(n===1){let n=e[1].mul(t[1]),i=n.sub(e[0].mul(t[0])).mul(1-r).add(e[2].mul(t[2]).sub(n).mul(r));return i.mulThis(2),i}if(n===2){let n=e[1].mul(t[1]),r=e[2].mul(t[2]).sub(n).sub(n.sub(e[0].mul(t[0])));return r.mulThis(2),r}B(``)}function sl(e,t,n,r){if(r.toDouble()<=.5){let n=new J;F(2,e[0].mulE(t[0]),e[1].mulE(t[1]),r,n);let i=new J;F(2,e[1].mulE(t[1]),e[2].mulE(t[2]),r,i);let a=new J;return F(2,n,i,r,a),a}{let n=new J;vt(2,e[0].mulE(t[0]),e[1].mulE(t[1]),r,n);let i=new J;vt(2,e[1].mulE(t[1]),e[2].mulE(t[2]),r,i);let a=new J;return vt(2,n,i,r,a),a}}function cl(e,t,n){if(t===0){let t=c(e[0],e[1],n),r=c(e[1],e[2],n);return c(t,r,n)}if(t===1)return 2*((1-n)*(e[1]-e[0])+(e[2]-e[1])*n);if(t===2)return 2*(e[2]-e[1]-(e[1]-e[0]));B(``)}function ll(e,t,n){if(n.toDouble()<=.5){let t=Ge(e[0],e[1],n),r=Ge(e[1],e[2],n);return Ge(t,r,n)}{let t=k(e[0],e[1],n),r=k(e[1],e[2],n);return k(t,r,n)}}function ul(e,t,n,r,i){let a=[J.constructPoint2D(e[0]),J.constructPoint2D(e[1]),J.constructPoint2D(e[2])];a[2].subThisE(a[0]),a[1].subThisE(a[0]),a[0].setCoords(0,0),dl(a,[new P(t[0]),new P(t[1]),new P(t[2])],n,r,i)}function dl(e,t,n,r,i){U(n>0);let a=[e[0].clone(),e[1].clone(),e[2].clone()];if(!a[0].isZero()){for(let e=1;e<3;++e)a[e].subThisE(a[0]);a[0]=J.constructCoords(0,0)}let o=sl(a,t,0,r),s=ll(t,0,r),c=o.divE(s);i[0].setE(c);let l=[t[1].mulE(t[0]),t[2].mulE(t[0]).mul(.5),t[1].mulE(t[2])],u=sl([e[1].subE(e[0]),e[2].subE(e[0]),e[2].subE(e[1])],l,0,r).mul(2),d=s.sqr(),f=u.divE(d);i[1].setE(f)}function fl(e,t,n){let r=C(z,3);e.queryControlPoints(r);let i=H(3,NaN);e.queryWeights(i),pl(r,i,t,n)}function pl(e,t,n,r){n.value()<0&&n.set(0,n.eps()),n.value()>1&&n.set(1,n.eps());let i=C(J,4);ul(e,t,1,n,i),r.setE(i[1])}function ml(e,t,n){let r=_e(n,0,1),i=C(z,4);if(il(e,t,3,r,i),i[1].isZero()){if(i[2].isZero())return i[3];{let e=i[2].clone();return r===1&&e.negateThis(),e}}return i[1]}var hl=class{constructor(e,t){this.len=0,this.b=e,this.len=t}getMaxDerivative(){return 1}getValue(e,t){return e===0?this.len-nl(this.b,t,!1):0}getError(e){return U(0),0}};function gl(e,t,n){let r=nl(e,1,!1);if(t<=0)return t;if(t>=r)return t-r+1;let i=[0];return Gi(new hl(e,t),I.unit(),1,i)!==1&&B(``),i[0]}function _l(e){let t=C(z,3),n=[0,0,0];return e.queryControlPoints(t),e.queryWeights(n),vl(t,n)}function vl(e,t){let n=iu(t);if(n===1)return oo(e);if(n===0)return 0;let r=[new z(0,0),e[1].sub(e[0]),e[2].sub(e[0])],i=r[1].crossProduct(r[2]);if(n<1){U(n>0);let e=1-n,t;if(e<.01)t=-1/3+e*(2/15+e*(3/35+e*(16/315+e*(20/693+e*(16/1001+e*(56/6435))))));else{let r=e*(1+n),i=Math.atan2(Math.sqrt(e),Math.sqrt(1+n));t=n*(.5*n-h(r)*i)/r}return i*t}{let e=(n-1)*(n+1);return .25*n/e**1.5*(-2*n*Math.sqrt(e)*i-4*r[1].y*r[2].x*Math.atanh(Math.sqrt((n-1)/(n+1)))-r[1].x*r[2].y*Math.log(2*n*(n-Math.sqrt(e))-1))}}function yl(e,t){let n=iu(t);if(n===1){let t=C(z,3);Ao(e,t);let n=t[2].clone(),r=t[1].clone(),i=new z,a=n.y*r.x-n.x*r.y;return i.x=-(4*n.x+5*r.x)*a/60,i.y=-(4*n.y+5*r.y)*a/60,i}if(n===0)return new z(0,0);U(n>0);let r=e[1].sub(e[0]),i=e[2].sub(e[0]);if(n<1){let e=Math.sqrt(1-n),t=Math.sqrt(1+n),a=(r.y*i.x-r.x*i.y)*n/(e*t)**5/12,o=Math.atan2(e,t),s=n*e*t,c=n*n,l=r.mul(2*(2+c)),u=i.mul(2*c-5),d=l.add(u).mul(s),f=i.sub(r.mul(2*c)).mul(6*o);return d.add(f).mul(a)}{let e=Math.sqrt(n-1),t=Math.sqrt(n+1),a=(r.y*i.x-r.x*i.y)*n/(e*t)**5/12,o=Math.atanh(e/t),s=n*e*t,c=n*n,l=r.mul(4).sub(i.mul(5)),u=r.add(i).mul(2*c),d=l.add(u).mul(s),f=i.sub(r.mul(2*c)).mul(6*o);return d.add(f).mul(a)}}function bl(e){let t=C(z,3),n=[0,0,0];return e.queryControlPoints(t),e.queryWeights(n),yl(t,n)}function xl(e){return Sl(e.calculateUpperLength2D())}function Sl(e){return 256*fe()*e}function Cl(e){if(e.m_weights[1]===0)return!0;let t=z.distance(e.getStartXY(),e.getEndXY()),n=e.calculateUpperLength2D();return n-t<=8*2**-52*n}function wl(e){return e.m_cachedValues}function Tl(e,t){e.m_cachedValues=t}function El(e,t,n,r,i){let a=C(z,3);e.queryControlPoints(a);let o=[0,0,0];e.queryWeights(o);let s=[0];return Dl(a,o,t,I.unit(),r,i,1,s)===1?s[0]:NaN}function Dl(e,t,n,r,i,a,o,s){be(I.unit().contains(r)&&o>0,``),(a<0||Number.isNaN(a))&&(a=Number.MAX_VALUE);let c=[,,,];for(let t=0;t<3;++t)c[t]=e[t].sub(n);let l=iu(t),u=br.constructPoint2D(c[0]),d=br.constructPoint2D(c[1]),f=br.constructPoint2D(c[2]),p=A.constructDouble(l),m=p.clone();m.ldexpThis(1);let h=u.dotProduct(d.sub(u)).mul(p),g=p.mul(p.addDouble(2)),_=f.sub(d.mul(g.ldexp(1))),v=d.sqrLength().mul(p.mul(p).ldexp(1)).add(u.sqrLength().mul(p.ldexp(2).subDouble(1))).add(u.dotProduct(_)),y=f.sub(d.mul(m)).add(u.mul(m.subDouble(1))),b=d.mul(p).sub(u).dotProduct(y).mulDouble(3),x=d.dotProduct(f).mul(p.subDouble(3).mul(p)).ldexp(1),S=d.sqrLength().mul(p.mul(p).ldexp(2)),w=u.sqrLength().mul(p.ldexp(2).subDouble(3)),T=u.dotProduct(f.sub(d.mul(p.mulDouble(3).subDouble(1)).mul(p))).ldexp(1),E=f.sqrLength().addThis(x).addThis(S).addThis(w).addThis(T),D=u.add(f).sub(d.mul(m)),O=p.subDouble(1),k=f.sub(u).dotProduct(D).mul(O),j=new z(0,0),M=[],N=new z;nu(c,t,r.vmin,N);let P=z.distance(N,j);if(P<=a&&M.push(new z(r.vmin,P)),r.vmin!==r.vmax&&(nu(c,t,r.vmax,N),P=z.distance(N,j),P<=a&&M.push(new z(r.vmax,P))),r.width()>0){let e=c[2].isZero(),n=C(A,4),i=Oa(k,E,b,v,h,58,r,e,n);for(let e=0;e<i;e++){if(!r.containsExclusiveCoordinate(n[e].toDouble()))continue;let i=n[e].toDouble();i=au(t,i);let o=new z;nu(c,t,i,o),P=z.distance(o,j),P<=a&&M.push(new z(i,P))}}if(i){U(r.equals(I.unit()));{nu(c,t,-1,N,!0);let e=new z;nu(c,t,0,e);let n=new Z({start:N,end:e}),r=n.getClosestCoordinate(j,!0);r<1&&(N=n.getCoord2D(r),P=z.distance(N,j),P<=a&&M.push(new z(r-1,P)))}{nu(c,t,2,N,!0);let e=new z;nu(c,t,r.vmax,e);let n=new Z({start:e,end:N}),i=n.getClosestCoordinate(j,!0);i>0&&(N=n.getCoord2D(i),P=z.distance(N,j),P<=a&&M.push(new z(1+i,P)))}}if(!M.length)return 0;M.sort((e,t)=>e.compare(t));let ee=0,te=M[0].x;if(s[ee++]=te,ee<o){let e=Nn(c,4,!1).total(),t=M[0].y;for(let n=1,r=M.length;n<r;n++)if(M[n].y>t+e){M.length=n;break}M.sort((e,t)=>Me(e.x,t.x)),ee=0,s[ee++]=M[0].x;for(let e=1,t=M.length;e<t;e++)M[e].x!==s[ee-1]&&ee<o&&(s[ee++]=M[e].x)}return ee}function Ol(e,t,n,r,i){return{tmin:e,tmax:t,t:n,d:r,pt:i.clone()}}function kl(e,t,n,r,i){let a=new pr;if(Al(e,I.unit(),a),a.inflate(r),!a.isIntersectingPoint2D(t))return 0;let o=el(e),s=0,c=[],l=o.specialPoints[0];for(let n=1,r=o.specialPoints.length;n<r;++n){let r=o.specialPoints[n],i=Xc(e,t,l,r);if(c.length===0)c.push(i);else if(i.t===i.tmin)U(c.at(-1).d<=i.d),c.at(-1).tmax=i.tmax;else if(c.at(-1).t===c.at(-1).tmax){U(c.at(-1).d>=i.d);let e=c.at(-1).tmin;c[c.length-1]=i,c.at(-1).tmin=e}else c.push(i);l=r}for(let e of c)if(e.d<=r){let t=e.t;n&&(n[s]=t),s++}return s}function Al(e,t,n){let r=C(z,3);e.queryControlPoints(r);let i=[0,0,0];e.queryWeights(i),jl(r,i,t,n)}function jl(e,t,n,r){if(n.equalsRange(0,1))return void r.setFromPoints(e,3);let i=C(z,3);Ll(e,t,n.vmin,n.vmax,i,[0,0,0]),r.setFromPoints(i,3)}function Ml(e){let t=yt(e[0].y,e[1].y),n=yt(e[1].y,e[2].y);if(t>=0&&n>=0||t<=0&&n<=0){let t=yt(e[0].x,e[1].x),n=yt(e[1].x,e[2].x);if(t>=0&&n>=0||t<=0&&n<=0)return!0}return!1}function Nl(e){let t=C(z,3);e.queryControlPoints(t);let n=Pl(t);return n&&(e.m_cp.setCoordsPoint2D(t[1]),e.afterCompletedModification()),n}function Pl(e){let t=!1;for(let n=0;n<2;n++){let r=yt(e[0][n],e[2][n]);r>0?(yt(e[0][n],e[1][n])<0&&(e[1][n]=e[0][n],t=!0),yt(e[1][n],e[2][n])<0&&(e[1][n]=e[2][n],t=!0)):r<0?(yt(e[0][n],e[1][n])>0&&(e[1][n]=e[0][n],t=!0),yt(e[1][n],e[2][n])>0&&(e[1][n]=e[2][n],t=!0)):e[1][n]!==e[0][n]&&(e[1][n]=e[0][n],t=!0)}return t}function Fl(e,t,n){n===void 0&&(n=t,t=0);let r=new z;if(t<0||n>1)return r.setNAN(),r;if(t>n&&R(`calculate_sub_weighted_centroid`),t===n||e.isDegenerate(0))return r.setCoords(0,0),r;let i=el(e),a=xl(e),o=a/e.calculateUpperLength2D(),s=t,c=0;for(let e=1,n=i.specialPointsCount();e<n;e++)if(t<i.specialPoints[e]){c=e-1;break}r.setCoords(0,0);for(let t=c+1,l=i.specialPointsCount();t<l;t++){let c=Math.min(i.specialPoints[t],n),l=Zc(e,s,c,o,a);if(r.addThis(l),s=c,n<=i.specialPoints[t])break}return r.add(e.getStartXY().mul(e.calculateLength2D()))}function Il(e,t,n,r,i,a,o){U(n>=0&&n<=1&&r!==a&&i!==o),U(t[0]>0&&t[2]>0&&t[1]>=0);let s=[1,iu(t),1],c=ou(t,n),l=x(e,3),u=C(K,3);Xl(l,s,u);let d=C(K,3),f=C(K,3);su(u,c,r?d:null,a?f:null),cu(t,n,i,o);let p=Ml(l);if(r){for(let e=0;e<3;++e)tu(d[e],r[e]);uu(l,r),p&&Pl(r)}if(a){for(let e=0;e<3;++e)tu(f[e],a[e]);uu(l,a),p&&Pl(a)}}function Ll(e,t,n,r,i,a){if(U(n>=0&&r<=1&&n<=r),n===r){let r=new z,o=Zl(e,t,n,r);lu(e,r),i[0].assign(r),i[1].assign(r),i[2].assign(r),a[0]=o,a[1]=o,a[2]=o;return}if(n===0&&r===1)return i[0].assign(e[0]),i[1].assign(e[1]),i[2].assign(e[2]),a[0]=t[0],a[1]=t[1],void(a[2]=t[2]);let o=C(K,3);{let i=[1,iu(t),1],a=ou(t,n),s=ou(t,r);Xl(e,i,o),su(o,s,o,null),su(o,a>=s?1:a/s,null,o)}let s=[0,0,0];cu(t,r,s,null),cu(s,n/r,null,s);let c=Ml(e),l=C(z,3);tu(o[1],l[1]),nu(e,t,n,l[0]),nu(e,t,r,l[2]),uu(e,l);for(let e=0;e<3;++e)i[e].assign(l[e]),a[e]=s[e];c&&Pl(i)}function Rl(e,t,n){let r=iu(t),i=[1,r,1],a=4*r/(3*(1+r));n[0].assign(e[0]),n[3].assign(e[2]),Ee(e[0],e[1],a,n[1]),Ee(e[2],e[1],a,n[2]),new Gc({cp:n}),new ha({points:e,weight:r});let o=0,s=.1,c=0;for(let t=0;t<9;t++,s+=.1){let t=new z;nu(e,i,s,t);let r=new z;ac(n,s,r);let a=z.sqrDistance(t,r);a>o&&(o=a,c=s)}{let t=new z;nu(e,i,c,t);let r=[0];Tc(n,t,I.unit(),!1,-1,1,r);let a=new z;return ac(n,r[0],a),o=z.sqrDistance(t,a),Math.sqrt(o)}}function zl(e,t,n,r){if(t.isEqual(e.m_XStart,e.m_YStart)&&n.isEqual(e.m_XEnd,e.m_YEnd))return;let i=!!r&&e.isMonotoneQuickAndDirty(),a=new At,o=C(z,3);o[0].setCoords(e.m_XStart,e.m_YStart),o[2].setCoords(e.m_XEnd,e.m_YEnd);let s=new z;s.setSub(o[2],o[0]),s.leftPerpendicularThis(),o[1].setAdd(o[0],s);let c=C(z,3);c[0].setCoordsPoint2D(t),c[2].setCoordsPoint2D(n),s.setSub(c[2],c[0]),s.leftPerpendicularThis(),c[1].setAdd(c[0],s),a.setFromTwoTriangles(o,c)?a.transformInPlace(e.m_cp):Ee(t,n,.5,e.m_cp),e.changeEndPoints2D(t,n),i&&Nl(e)}function Bl(e,t,n,r,i){if(i){if(Rd(t,n)!==0)return e?4:2}else if(wr(t,n))return 1;return Wl(e,t,n,null,null,null,r,i!==void 0&&i,!0,!1)===0?0:4}function Vl(e,t,n,r,i){if(i){if(Rd(t,n)!==0)return e?4:2}else if(wr(t,n))return 1;return Gl(e,t,n,null,null,null,r,i??!1,!0,!1)===0?0:4}function Hl(e,t,n,r,i){if(i){let r=Rd(t,n);if(r!==0){if(e){if(r===1){if(t.m_weights[0]===n.m_weights[0]&&t.m_weights[1]===n.m_weights[1]&&t.m_weights[2]===n.m_weights[2])return 2}else if(t.m_weights[0]===n.m_weights[2]&&t.m_weights[1]===n.m_weights[1]&&t.m_weights[2]===n.m_weights[0])return 2;return 4}return 2}}else if(wr(t,n))return 1;return Kl(e,t,n,null,null,null,r,i!==void 0&&i,!0,!1)===0?0:4}function Ul(e,t,n,r,i){if(i){if(Rd(t,n)!==0)return e?4:2}else if(wr(t,n))return 1;return ql(e,t,n,null,null,null,r,i??!1,!0,!1)===0?0:4}function Wl(e,t,n,r,i,a,o,s,c,l){if(i!==null&&(i.length=0),a!==null&&(a.length=0),r!==null&&(r.length=0),n.isDegenerate(0)){let e=[0,0],s=t.intersectPoint(n.getStartXY(),e,o);if(s>0){if(i!==null)for(let t=0;t<s;t++)i.push(e[t]);if(a!=null)for(let e=0;e<s;e++)a.push(0);if(r!=null)for(let n=0;n<s;n++){let i=new z;t.queryCoord2D(e[n],i),r.push(i)}}return s}let u=Gr(t,n);if(o=Math.max(o,u),t.isDegenerateToLineHelper(u)){let e=new Z({start:t.getStartXY(),end:t.getEndXY()}),c=vi(e,n,r,i,a,o,s,l);if(i)for(let n=0;n<c;++n){let r=e.getCoord2D(i[n]);i[n]=t.getClosestCoordinate(r,!1)}return c}if(Kr(t,n,o))return 0;let d=C(z,3);t.queryControlPoints(d);let f=[0,0,0];t.queryWeights(f);let p=[1,iu(f),1],m=n.getEndXY().sub(n.getStartXY()),h=m.clone();h.leftPerpendicularThis();let g=d[0].clone(),_=d[1].clone(),v=d[2].clone(),y=_.sub(g),b=v.sub(g),x=v.sub(_),S=p[0],w=p[1],T=p[2],E=S*w,D=S*T,O=w*T,k=y.dotProduct(h)*E,A=b.dotProduct(h)*D,j=k,M=A-2*k,N=x.dotProduct(h)*O+A-A,P=H(13,NaN),ee=H(13,NaN),te=qi(N,M,j,I.unit(),!1,P);te<0&&(P[0]=0,P[1]=1,te=2);let F=0;for(let e=0,t=F;e<te;++e){let r=new z;nu(d,p,P[e+t],r),ee[F]=n.getClosestCoordinate(r,!1),z.distance(r,n.getCoord2D(ee[F]))<=o&&(P[F]=P[e+t],F++)}let ne=C(z,3),re=C(z,3);if(t.queryControlPoints(re),re[0].subThis(n.getStartXY()),re[1].subThis(n.getStartXY()),re[2].subThis(n.getStartXY()),Jl(re,p,ne,!1),Math.abs(m.x)>=Math.abs(m.y)){let e=m.y/m.x;N=ne[2].y-ne[2].x*e,M=ne[1].y-ne[1].x*e,j=ne[0].y-ne[0].x*e}else{let e=m.x/m.y;N=ne[2].x-ne[2].y*e,M=ne[1].x-ne[1].y*e,j=ne[0].x-ne[0].y*e}let ie=t.getEndXY().equals(n.getStartXY())||t.getEndXY().equals(n.getEndXY()),ae=[0,0];te=qi(N,M,j,I.unit(),ie,ae);for(let e=0,t=F;e<te;++e){P[e+t]=ae[e];let r=new z;nu(d,p,P[e+t],r),ee[F]=n.getClosestCoordinate(r,!1),z.distance(r,n.getCoord2D(ee[F]))<=o&&(P[F]=P[e+t],F++)}U(F<P.length+4);for(let e=0;e<F;e++)P[e]=au(f,P[e]);te=t.intersectPoint(n.getStartXY(),ae,o);for(let e=0;e<te;e++)P[F]=ae[e],ee[F++]=0;te=t.intersectPoint(n.getEndXY(),ae,o);for(let e=0;e<te;e++)P[F]=ae[e],ee[F++]=1;te=n.intersectPoint(t.getStartXY(),ae,o);for(let e=0;e<te;e++)ee[F]=ae[e],P[F++]=0;te=n.intersectPoint(t.getEndXY(),ae,o);for(let e=0;e<te;e++)ee[F]=ae[e],P[F++]=1;return F===0?0:Ud(e,t,n,P,ee,F,r,i,a,o,s,c,l)}function Gl(e,t,n,r,i,a,o,s,c,l){if(td(n))return Wl(e,t,new Z({start:n.getStartXY(),end:n.getEndXY()}),r,i,a,o,s,c,l);let u=Gr(t,n);if(Kr(t,n,o=Math.max(o,u)))return 0;let d=[],f=[],p=C(z,4);{t.queryControlPoints(p);let e=C(z,4),r=new At;n.canonicToWorldTransformation(r);let i=new At;i.setInvert(r),i.transformPoints2D(p,4,e);let a=C(A,3),c=C(A,3),l=C(A,3),u=[0,0,0];t.queryWeights(u),Yl(e,u,a,c,l);let m=C(A,3);m[0].setDouble(n.getSemiMinorAxis()),m[0].sqrThis(),m[1].setDouble(n.getSemiMajorAxis()),m[1].sqrThis(),m[2].setThis(m[0]),m[2].mulThis(m[1]),m[2].negateThis();let h=wa(a,2,c,2,l,2,m,!0,I.unit(),I.unit(),d,s);if(h>0){let e=0;for(let r=0;r<h;r++){let i=new z;t.queryCoord2D(d[r],i);let a=n.getClosestCoordinate(i,!1),s=new z;n.queryCoord2D(a,s),z.distance(i,s)<=o&&(d[e]=d[r],f.push(a),e++)}d.length=e}}let m=[0,1];for(let e=0;e<2;e++){let r=e===0?n.getStartXY():n.getEndXY(),i=El(t,r,I.unit(),!1,-1),a=new z;t.queryCoord2D(i,a),z.distance(r,a)<=o&&(d.push(i),f.push(m[e]))}for(let e=0;e<2;e++){let t=[0,3];{let r=n.getClosestCoordinate(p[t[e]],!1),i=new z;n.queryCoord2D(r,i),z.distance(p[t[e]],i)<=o&&(d.push(m[e]),f.push(r))}}return Ud(e,t,n,d,f,d.length,r,i,a,o,s,c,l)}function Kl(e,t,n,r,i,a,o,s,c,l){let u=C(z,3);t.queryControlPoints(u);let d=C(z,3);if(n.queryControlPoints(d),qr(u,d,3)<0)return Kl(e,n,t,r,a,i,o,s,c,!l);let f=Gr(t,n);if(t.isDegenerateToLineHelper(f)){let u=new Z({start:t.getStartXY(),end:t.getEndXY()}),d=Wl(e,n,u,r,a,i,o,s,c,!l);if(i)for(let e=0;e<d;++e){let n=u.getCoord2D(i[e]);i[e]=t.getClosestCoordinate(n,!1)}return d}if(n.isDegenerateToLineHelper(f)){let u=new Z({start:n.getStartXY(),end:n.getEndXY()}),d=Wl(e,t,u,r,i,a,o,s,c,l);if(a)for(let e=0;e<d;++e){let t=u.getCoord2D(a[e]);a[e]=n.getClosestCoordinate(t,!1)}return d}if(Kr(t,n,o=Math.max(o,f)))return 0;let p=H(3,NaN);t.queryWeights(p);let m=H(3,NaN);n.queryWeights(m);let h=[1,iu(p),1],g=[1,iu(m),1],_=new I(0,1),v=new I(0,1);{let e=pr.constructEmpty();jl(u,h,new I(0,1),e);let t=pr.constructEmpty();jl(d,g,new I(0,1),t);let n=Math.max(e.maxDim(),t.maxDim());if(e.inflate(3*o),t.inflate(3*o),!e.intersectW(t))return 0;if(e.maxDim()<.1*n){if(ru(u,h,e,_),ru(d,g,e,v),_.isEmpty()||v.isEmpty())return 0;Ll(u,h,_.vmin,_.vmax,u,h),Ll(d,g,v.vmin,v.vmax,d,g)}}let y=Gd(u,2,d,2,o);if(y===0)return 0;let b=[],x=[];if(y===-1){let e=C(A,3),t=C(A,3),n=C(A,3);Yl(u,h,e,t,n);let r=C(A,3),i=C(A,3),a=C(A,3);Yl(d,g,r,i,a);let f=[],p=[],m=xa(e,2,t,2,n,2,r,2,i,2,a,2,!0,I.unit(),I.unit(),f,p,s,c,l);if(m>0)for(let e=0;e<m;e++){let t=new z;nu(d,g,p[e],t);let n=new z;nu(u,h,f[e],n),z.distance(n,t)<=o&&(b.push(f[e]),x.push(p[e]))}}for(let e=0;e<2;e++){let t,n,r;e===0?(t=u,n=d,r=g):(t=d,n=u,r=h);for(let i=0;i<2;i++){let a=i===0?0:t.length-1,s=new z,c=[0],l=Dl(n,r,t[a],I.unit(),!1,-1,1,c);U(l===1),nu(n,r,c[0],s),z.distance(t[a],s)<=o&&(e===0?(b.push(a===0?0:1),x.push(c[0])):(x.push(a===0?0:1),b.push(c[0])))}}if(b.length===0)return 0;if(!_.equalsRange(0,1))for(let e=0;e<b.length;++e)b[e]=ha.recalculateParentT(_.vmin,_.vmax,b[e]);if(!v.equalsRange(0,1))for(let e=0;e<x.length;++e)x[e]=ha.recalculateParentT(v.vmin,v.vmax,x[e]);for(let e=0;e<b.length;++e)b[e]=au(p,b[e]);for(let e=0;e<x.length;++e)x[e]=au(m,x[e]);return Ud(e,t,n,b,x,b.length,r,i,a,o,s,c,l)}function ql(e,t,n,r,i,a,o,s,c,l){if(t.isLine())return Do(e,n,new Z({start:t.getStartXY(),end:t.getEndXY()}),r,a,i,o,s,c,!l);if(n.isLine())return Wl(e,t,new Z({start:n.getStartXY(),end:n.getEndXY()}),r,i,a,o,s,c,l);let u=Gr(t,n);if(Kr(t,n,o=Math.max(o,u)))return 0;let d=C(z,3);t.queryControlPoints(d);let f=C(z,3);n.queryControlPoints(f);let p=Gd(d,2,f,2,o);if(p===0)return 0;let m=[],h=[];if(p===-1){let e=C(A,3),r=C(A,3),i=C(A,3),a=[0,0,0];t.queryWeights(a),Yl(d,a,e,r,i);let u=C(br,3);Po(f,u);let p=xa(e,2,r,2,i,2,[u[0].x,u[1].x,u[2].x],2,[u[0].y,u[1].y,u[2].y],2,null,0,!0,I.unit(),I.unit(),m,h,s,c,l);if(p>0){let e=0;for(let r=0;r<p;r++){let i=new z;n.queryCoord2D(h[r],i);let a=new z;t.queryCoord2D(m[r],a),z.distance(a,i)<=o&&(m[e]=m[r],h[e]=h[r],e++)}m.length=e,h.length=e}}for(let e=0;e<2;e++){let r;r=e===0?d:f;for(let i=0;i<2;i++){let a=i===0?0:r.length-1,s,c=new z;e===0?(s=uo(n,r[a],I.unit(),!1),n.queryCoord2D(s,c)):(s=El(t,r[a],I.unit(),!1,-1),t.queryCoord2D(s,c)),z.distance(r[a],c)<=o&&(e===0?(m.push(a===0?0:1),h.push(s)):(h.push(a===0?0:1),m.push(s)))}}return Ud(e,t,n,m,h,m.length,r,i,a,o,s,c,l)}function Jl(e,t,n,r=!1){let i=C(z,3);r?(i[0].setCoordsPoint2D(e[0]),i[1].setCoordsPoint2D(e[1]),i[1].subThis(i[0]),i[2].setCoordsPoint2D(e[2]),i[2].subThis(i[0]),i[0].setCoords(0,0)):(i[0].setCoordsPoint2D(e[0]),i[1].setCoordsPoint2D(e[1]),i[2].setCoordsPoint2D(e[2])),i[0].mulThis(t[0]),i[1].mulThis(t[1]),i[2].mulThis(t[2]),n[1].setCoords(i[1].x-i[0].x,i[1].y-i[0].y),n[2].setCoordsPoint2D(i[2].sub(i[1])),n[2].subThis(n[1]),n[1].x*=2,n[1].y*=2,n[0].setCoordsPoint2D(i[0])}function Yl(e,t,n,r,i){let a=A.constructDouble(t[0]),o=A.constructDouble(t[1]),s=A.constructDouble(t[2]);n[0].setDouble(e[0].x),n[0].mulThis(a),n[1].setDouble(e[1].x),n[1].mulThis(o),n[2].setDouble(e[2].x),n[2].mulThis(s),n[2].subThis(n[1]),n[1].subThis(n[0]),n[2].subThis(n[1]),n[1].ldexpThis(1),r[0].setDouble(e[0].y),r[0].mulThis(a),r[1].setDouble(e[1].y),r[1].mulThis(o),r[2].setDouble(e[2].y),r[2].mulThis(s),r[2].subThis(r[1]),r[1].subThis(r[0]),r[2].subThis(r[1]),r[1].ldexpThis(1),i[0].setDouble(t[0]),i[1].setDouble(t[1]),i[2].setThis(i[1]),i[2].ldexpThis(1),i[2].negateThis(),i[2].addThis(i[0]),i[2].addDoubleThis(t[2]),i[1].subThis(i[0]),i[1].ldexpThis(1)}function Xl(e,t,n){for(let r=0;r<3;++r)n[r].setCoordsPoint2DZ(e[r].mul(t[r]),t[r])}function Zl(e,t,n,r){if(n===0)return r.assign(e[0]),t[0];if(n===1)return r.assign(e[2]),t[2];let i=[e[0].x*t[0],e[1].x*t[1],e[2].x*t[2]],a=[e[0].y*t[0],e[1].y*t[1],e[2].y*t[2]],o=[t[0],t[1],t[2]],s=n,l,u,d;if(n<=.5){let e=ye(i[0],i[1],s),t=ye(i[1],i[2],s);l=c(e,t,s);let n=ye(a[0],a[1],s),r=ye(a[1],a[2],s);u=c(n,r,s);let f=ye(o[0],o[1],s),p=ye(o[1],o[2],s);d=ye(f,p,s)}else{let e=T(i[0],i[1],s),t=T(i[1],i[2],s);l=T(e,t,s);let n=T(a[0],a[1],s),r=T(a[1],a[2],s);u=T(n,r,s);let c=T(o[0],o[1],s),f=T(o[1],o[2],s);d=T(c,f,s)}return l/=d,u/=d,r.setCoords(l,u),lu(e,r),d}function Ql(e,t,n){let r=C(z,3);e.queryControlPoints(r);let i=[0,0,0];e.queryWeights(i),$l([J.constructPoint2D(r[0]),J.constructPoint2D(r[1]),J.constructPoint2D(r[2])],[new P(i[0]),new P(i[1]),new P(i[2])],t,n)}function $l(e,t,n,r){if(n.value()===0)return void r.setE(e[0]);if(n.value()===1)return void r.setE(e[2]);let i=[e[0].x.mulE(t[0]),e[1].x.mulE(t[1]),e[2].x.mulE(t[2])],a=[e[0].y.mulE(t[0]),e[1].y.mulE(t[1]),e[2].y.mulE(t[2])],o=[t[0].clone(),t[1].clone(),t[2].clone()],s=new P,c=new P,l=new P;if(n.value()<=.5){let e=Ge(i[0],i[1],n),t=Ge(i[1],i[2],n);s.setE(Ge(e,t,n));let r=Ge(a[0],a[1],n),u=Ge(a[1],a[2],n);c.setE(Ge(r,u,n));let d=Ge(o[0],o[1],n),f=Ge(o[1],o[2],n);l.setE(Ge(d,f,n))}else{let e=k(i[0],i[1],n),t=k(i[1],i[2],n);s.setE(k(e,t,n));let r=k(a[0],a[1],n),u=k(a[1],a[2],n);c.setE(k(r,u,n));let d=k(o[0],o[1],n),f=k(o[1],o[2],n);l.setE(k(d,f,n))}s.divThisE(l),c.divThisE(l);let u=new z(s.value(),c.value());lu([e[0].value(),e[1].value(),e[2].value()],u),r.x.set(u.x,s.eps()),r.y.set(u.y,c.eps())}function eu(e,t,n,r){let i=n.lte(Je)?A.lerpLo:A.lerpHi,[a,o,s]=[t.map((t,n)=>e[n].x.mul(t)),t.map((t,n)=>e[n].y.mul(t)),t].map(([e,t,r])=>i(i(e,t,n),i(t,r,n),n)),c=new z(a.divThis(s).value(),o.divThis(s).value());lu(e.map(e=>e.asPoint2D()),c),r.x=A.constructDouble(c.x),r.y=A.constructDouble(c.y)}function tu(e,t){return t.setCoords(e.x/e.z,e.y/e.z),e.z}function nu(e,t,n,r,i){if(i){if(n<0){si(new Z({start:e[0],end:e[0].add(ml(e,t,0).getUnitVector())}),n,r);return}if(n>1){si(new Z({start:e[2],end:e[2].add(ml(e,t,1).getUnitVector())}),n-1,r);return}}Zl(e,t,n,r)}function ru(e,t,n,r){r.setEmpty();let i=[];i.push(new I(0,1));let a=.5*Math.max(n.width(),n.height());for(;i.length;){let o=i.at(-1);i.pop();let s=new pr;if(jl(e,t,o,s),s.isIntersectingW(n)){let e=Math.max(s.width(),s.height());if(n.containsW(s)||e<=a||o.width()<1e-12)r.merge(o);else{let e=o.getCenter();i.push(I.construct(o.vmin,e)),i.push(I.construct(e,o.vmax))}}}}function iu(e){return e[1]/Math.sqrt(e[0]*e[2])}function au(e,t){let n=Math.sqrt(e[2]/e[0]);return t/c(n,1,t)}function ou(e,t){let n=Math.sqrt(e[0]/e[2]);return t/c(n,1,t)}function su(e,t,n,r){U(t>=0&&t<=1),new K().setCoordsPoint3D(e[0]),new K().setCoordsPoint3D(e[1]),new K().setCoordsPoint3D(e[2]);let i=new K,a=new K,o=new K;qe(3,e[0],e[1],t,i),qe(3,e[1],e[2],t,a),qe(3,i,a,t,o);let s=e[2].clone();n&&(n[0].assign(e[0]),n[1].assign(i),n[2].assign(o)),r&&(r[0].assign(o),r[1].assign(a),r[2].assign(s))}function cu(e,t,n,r){let i=[e[0],e[1],e[2]];U(t>=0&&t<=1&&n!==r);let a=c(i[0],i[1],t),o=c(i[1],i[2],t),s=c(a,o,t);n&&(n[0]=i[0],n[1]=a,n[2]=s),r&&(r[0]=s,r[1]=o,r[2]=i[2])}function lu(e,t){let n=I.constructEmpty();n.vmin=n.vmax=e[0].x,n.mergeNeCoordinate(e[1].x),n.mergeNeCoordinate(e[2].x),t.x=_e(t.x,n.vmin,n.vmax),n.vmin=n.vmax=e[0].y,n.mergeNeCoordinate(e[1].y),n.mergeNeCoordinate(e[2].y),t.y=_e(t.y,n.vmin,n.vmax)}function uu(e,t){let n=new I;n.vmin=n.vmax=e[0].x,n.mergeNeCoordinate(e[1].x),n.mergeNeCoordinate(e[2].x),t[0].x=_e(t[0].x,n.vmin,n.vmax),t[1].x=_e(t[1].x,n.vmin,n.vmax),t[2].x=_e(t[2].x,n.vmin,n.vmax),n.vmin=n.vmax=e[0].y,n.mergeNeCoordinate(e[1].y),n.mergeNeCoordinate(e[2].y),t[0].y=_e(t[0].y,n.vmin,n.vmax),t[1].y=_e(t[1].y,n.vmin,n.vmax),t[2].y=_e(t[2].y,n.vmin,n.vmax)}var du=ee/180,fu=180/ee;function pu(e){let t=e;return t>=-360&&t<720?(t<0?t+=360:t>=360&&(t-=360),t):(t=We(t,360),t<0&&(t+=360),t)}function mu(e){let t=e;return t=pu(t),t>180&&(t-=360),t}function hu(e){return e*du}function gu(e){return e*fu}function _u(e){let t=tt(),n=e;return n>=-t&&n<2*t?(n<0&&(n+=t),n>=t&&(n-=t),n):(n=We(n,t),n<0&&(n+=t),n)}function vu(e){let t=oe(),n=e;return n>-t&&n<=t||(n=_u(n),n>t&&(n-=tt())),n}function yu(e,t){return mu(t-e)}var bu=Rt,xu=class e extends ai{constructor(e){if(e===void 0||ue(e,`vd`))return super({vd:e?.vd,XStart:0,YStart:0,XEnd:0,YEnd:0}),this.m_semiMajorAxis=0,this.m_minorMajorRatio=1,this.m_rotation=0,this.m_cosr=1,this.m_sinr=0,this.m_center=new z(0,0),this.m_sweepAngle=0,this.m_startAngle=0,this.m_interior=new z(0,0),void(this.m_bits=0);if(e.copy)return super(e),void(this!==e.copy&&(this.m_center=new z(0,0),this.m_interior=new z(0,0),e.copy.copyToImpl(this)));if(e.move)super(e),this.m_semiMajorAxis=e.move.m_semiMajorAxis,this.m_minorMajorRatio=e.move.m_minorMajorRatio,this.m_rotation=e.move.m_rotation,this.m_cosr=e.move.m_cosr,this.m_sinr=e.move.m_sinr,this.m_center=e.move.m_center.clone(),this.m_sweepAngle=e.move.m_sweepAngle,this.m_startAngle=e.move.m_startAngle,this.m_interior=e.move.m_interior.clone(),this.m_bits=e.move.m_bits,this.m_cachedValues=e.move.m_cachedValues,e.move.m_cachedValues=null;else{if(e.fromPoint)return super({XStart:0,YStart:0,XEnd:0,YEnd:0}),this.m_center=new z(0,0),this.m_interior=new z(0,0),void this.constructCircularArcThreePoint(e.fromPoint,e.toPoint,e.interiorPoint);if(e.center)return super({XStart:0,YStart:0,XEnd:0,YEnd:0}),this.m_center=new z(0,0),this.m_interior=new z(0,0),void this.constructCircleRadius(e.radius,e.center,e.bIsCounterClockwise);if(e.semiMajorAxis)return super({XStart:0,YStart:0,XEnd:0,YEnd:0}),void this.constructEllipticArcEndPoints(e.fromPoint,e.toPoint,e.semiMajorAxis,e.minorMajorRatio,e.axisXRotationRad,e.bBigArc,e.bIsCounterClockwise)}}getBoundary(){return Ui(this)}assignCopy(e){return this!==e&&e.copyTo(this),this}constructCircleRadius(e,t,n=!1){return this.constructEllipse(e,1,t,0,n),this.setProjectionBehavior(0),this.afterCompletedModification(),this}constructCircleCenterAndPoint(e,t,n=!1){let r=z.distance(e,t);return this.constructEllipticArcEndPointsCenter(t,t,r,1,0,!0,n,e),this.setProjectionBehavior(0),this.afterCompletedModification(),this}constructTwoPointCircle(e,t,n=!1){let r=z.lerp(e,t,.5);return this.constructCircleCenterAndPoint(r,e,n),this}constructLineEllipticArc(e,t){return ed(this,e,t,1),this}constructLineCircularArc(e,t){return ed(this,e,t,0),this}constructEllipse(e,t,n,r,i=!1){this.m_semiMajorAxis=Math.abs(e),this.m_minorMajorRatio=Math.abs(t),this.m_minorMajorRatio>1&&(this.m_semiMajorAxis*=this.m_minorMajorRatio,this.m_minorMajorRatio=1/this.m_minorMajorRatio);let a=new z(0,this.m_minorMajorRatio*this.m_semiMajorAxis),o=Math.cos(r),s=Math.sin(r);return a.rotateDirect(o,s),a.addThis(n),this.constructEllipticArcEndPointsCenter(a,a,this.m_semiMajorAxis,this.m_minorMajorRatio,r,!0,i,n),this}inflate(e){if(this.isDegenerateToLine())return;let t=this.getSemiMinorAxis()+e;if(t=t<=0?0:(this.getSemiMajorAxis()+e)/this.getSemiMajorAxis(),this.isCircular()){let e=new At;e.setShiftCoords(-this.m_center.x,-this.m_center.y),e.scale(t,t),e.shiftCoords(this.m_center.x,this.m_center.y),this.applyTransformation(e)}else{let e=new At;this.canonicToWorldTransformation(e);let n=e.clone();n.invertPreciseThis(),n.scale(t,t),n.multiply(e),this.applyTransformation(n)}}constructEnclosingCircle(e,t,n=!1){return Sd(this,e,t,n),this}constructThreePointCircle(e,t,n,r=!1){if(e.equals(t)||t.equals(n)||e.equals(n)){let i=e.clone(),a=t.clone(),o=n.clone();return i.equals(a)&&a.assign(o),this.constructTwoPointCircle(i,a,r)}{let i=z.calculateCircleCenterFromThreePoints(e,t,n);if(!i.isFinite()||!Number.isFinite(z.distance(e,i))){let r=z.distance(e,t),i=z.distance(e,n);this.constructLineCircularArc(e,r>=i?t:n)}return this.constructCircleCenterAndPoint(i,e,r)}}constructCircularArcThreePoint(e,t,n){let r=new P(e.x),i=new P(t.x),a=new P(n.x),o=new P(e.y),s=new P(t.y),c=new P(n.y),l=new P(.5),u=i.subE(r),d=s.subE(o),f=a.subE(r),p=c.subE(o),m=u.mulE(p).subThisE(d.mulE(f));if(m.scaleError(10),m.isZero()){if(!u.isZero()||!d.isZero())return ed(this,e,t,0),this;{let r=e.clone().addThis(t).mulThis(.5).addThis(n).mulThis(.5),i=n.sub(r).length();this.constructEllipticArcEndPointsCenter(e,t,i,1,0,!0,!1,r),this.m_interior.assign(n)}return this.setProjectionBehavior(0),this}let h=u.sqr().addThisE(d.sqr()).mulThisE(l),g=f.sqr().addThisE(p.sqr()).mulThisE(l),_=h.mulE(p).subThisE(g.mulE(d)),v=u.mulE(g).subThisE(f.mulE(h));_.divThisE(m),v.divThisE(m);let y=_.sqr().addThisE(v.sqr());y.sqrtThis();let b=_.addE(r),x=v.addE(o),S=e.x-b.value(),C=e.y-x.value(),w=Math.atan2(C,S);S=t.x-b.value(),C=t.y-x.value();let T=Math.atan2(C,S);S=n.x-b.value(),C=n.y-x.value();let E=Math.atan2(C,S),D=E-2*oe();for(;D<w;)D+=2*oe();let O=T-2*oe();for(;O<D;)O+=2*oe();let k=E+2*oe();for(;k>w;)k-=2*oe();let A,j=T+2*oe();for(;j>k;)j-=2*oe();A=O-w<w-j?O-w:j-w;let M=new z(b.value(),x.value());return this.constructEllipticArcEndPointsCenter(e,t,y.value(),1,0,Math.abs(A)>oe(),A>0,M),this.m_interior.assign(n),this.setProjectionBehavior(0),this.afterCompletedModification(),this}constructCircularArc(e,t,n,r){return this.constructEllipticArcGeneral(e,1,t,n,r,0),this.setProjectionBehavior(0),this.afterCompletedModification(),this}constructEllipticArcEndPoints(e,t,n,r,i,a,o){return $u(this,e,t,n,r,i,a,o)}constructEllipticArcEndPointsCenter(e,t,n,r,i,a,o,s){return $u(this,e,t,n,r,i,a,o,s)}constructEllipticArcGeneral(e,t,n,r,i,a){this.m_semiMajorAxis=Math.abs(e),this.m_minorMajorRatio=Math.abs(t),this.m_minorMajorRatio>1&&(this.m_semiMajorAxis*=this.m_minorMajorRatio,this.m_minorMajorRatio=1/this.m_minorMajorRatio);let o=vu(a),s=Math.cos(o),c=Math.sin(o),l=new z(this.m_semiMajorAxis,this.m_minorMajorRatio*this.m_semiMajorAxis),u=z.getNAN(),d=vu(r);u.x=l.x*Math.cos(d),u.y=l.y*Math.sin(d),u.rotateDirect(s,c),u.addThis(n);let f=St(i,tt()),p=f;Math.abs(p)===tt()&&(p=0);let m=z.getNAN();return m.x=l.x*Math.cos(d+p),m.y=l.y*Math.sin(d+p),m.rotateDirect(s,c),m.addThis(n),this.constructEllipticArcEndPointsCenter(u,m,this.m_semiMajorAxis,this.m_minorMajorRatio,o,Math.abs(f)>oe(),f>0,n)}constructEllipticArcAsNURB(e,t,n,r){return(r>=1||r<0)&&R(`construct_elliptic_arc_as_NURB: weight`),t.isFinite()||R(`construct_elliptic_arc_as_NURB: control_point`),yd([e,t,n],r*r,null,!1,this),this}constructCanonic(e){return this.assignCopy(e),e.isDegenerateToLine()||e.m_center.isEqual(0,0)&&this.m_rotation===0||(this.m_XStart=e.getSemiMajorAxis()*Math.cos(e.m_startAngle),this.m_YStart=e.getSemiMinorAxis()*Math.sin(e.m_startAngle),this.m_XEnd=e.getSemiMajorAxis()*Math.cos(e.getEndAngle()),this.m_YEnd=e.getSemiMinorAxis()*Math.sin(e.getEndAngle()),this.m_center.setCoords(0,0),this.m_rotation=0,this.m_cosr=1,this.m_sinr=0,wd(this),this.afterCompletedModification(),e!==this&&Hr(this,e)),this}isCircular(){return this.m_minorMajorRatio===1&&this.m_rotation===0&&!this.isDegenerateToLine()}isDegenerateToLineHelper(e){if(this.isLine())return!0;if(this.isMajor())return!1;let t=this.getEndXY().sub(this.getStartXY()).length();return!(this.calculateLength2D()-t>e)}isDegenerateToLine(){return td(this)}getCenter(){return this.m_center.clone()}setCenter(e){if(!this.m_center.isNAN()){let t=e.sub(this.m_center);this.m_XStart+=t.x,this.m_YStart+=t.y,this.m_XEnd+=t.x,this.m_YEnd+=t.y,this.m_interior.addThis(t),this.m_center.assign(e),this.endPointModified(),this.normalizeAfterEndpointChange()}}getAxisXRotation(){return this.m_rotation}getSemiAxes(){return z.construct(this.m_semiMajorAxis,this.m_semiMajorAxis*this.m_minorMajorRatio)}getSemiMajorAxis(){return this.m_semiMajorAxis}getSemiMinorAxis(){return this.m_semiMajorAxis*this.m_minorMajorRatio}getMinorMajorRatio(){return this.m_minorMajorRatio}isClockwise(){return!dd(this)}isMajor(){return pd(this)}getSweepAngle(){return this.m_sweepAngle}getStartAngle(){return this.m_startAngle}getEndAngle(){return this.m_startAngle+this.m_sweepAngle}getGeometryType(){return L.enumEllipticArc}queryEnvelope(e){if(e.m_EnvelopeType===4){e.setEmpty(),e.assignVertexDescription(this.m_description);let t=G.constructEmpty();this.queryEnvelope(t),e.setEnvelope(t);for(let t=1,n=this.m_description.getAttributeCount();t<n;t++){let n=this.m_description.getSemantics(t);for(let r=bu.getComponentCount(n);t<r;t++){let t=this.queryInterval(n,0);e.setIntervalEnvelope(n,0,t)}}}else e.m_EnvelopeType===2?kd(this,I.unit(),e):xt(`3d not impl`)}applyTransformation(e){ad(this,e,!1,null,null)}createInstance(){return new e}calculateLength2D(){return qu(this,0,1)}queryControlPointsHelper(e){B(``)}queryCoord2D(e,t){if(td(this))ci(e,this.getStartXY(),this.getEndXY(),t);else if(e===0)t.assign(z.construct(this.m_XStart,this.m_YStart));else if(e===1)t.assign(z.construct(this.m_XEnd,this.m_YEnd));else{let n=Uu(this,e),r=new z(this.m_semiMajorAxis*Math.cos(n),this.getSemiMinorAxis()*Math.sin(n));r.rotateDirect(this.m_cosr,this.m_sinr),r.addThis(this.m_center),t.assign(r)}}queryCoord2DE(e,t){Pu(this,e,t)}queryCoord2DMP(e,t){xt(``)}getCoordX(e){let t=new z;return this.queryCoord2D(e,t),t.x}getCoordY(e){let t=new z;return this.queryCoord2D(e,t),t.y}cut(e,t,n){let r=new Q;return this.queryCut(e,t,r,n),r.releaseSegment()}queryCut(e,t,n,r){let i=n.createEllipticArc();r&&i.dropAllAttributes();let a=e===0&&t===1;if(a&&!r)return void this.copyTo(i);let o=z.getNAN();this.queryCoord2D(e,o);let s=z.getNAN();if(this.queryCoord2D(t,s),!a){if(o.equals(s))t-e>.5&&this.isMajor()&&this.isClosed()?(a=!0,e=0,t=1):t===1?e=t:t=e;else if(e>0&&o.isEqual(this.m_XStart,this.m_YStart)&&(e=0),t<1&&s.isEqual(this.m_XEnd,this.m_YEnd)&&(t=1),a=e===0&&t===1,a&&!r)return void this.copyTo(i)}if(i.m_center.assign(this.m_center),i.m_semiMajorAxis=this.m_semiMajorAxis,i.m_minorMajorRatio=this.m_minorMajorRatio,i.m_interior.assign(this.m_interior),i.m_rotation=this.m_rotation,i.m_cosr=this.m_cosr,i.m_sinr=this.m_sinr,i.m_sweepAngle=this.m_sweepAngle,i.m_startAngle=this.m_startAngle,i.m_bits=this.m_bits,jr(i,o.x,o.y),Nr(i,s.x,s.y),a)return void sd(i,Ju(this));i.m_startAngle=Uu(this,e),i.m_sweepAngle=Uu(this,t)-i.m_startAngle,i.m_startAngle=Ru(i.m_startAngle),fd(i,Math.abs(i.m_sweepAngle)>oe()),r&&i.assignVertexDescription(this.m_description),wd(i),Vu(i);let c=this.m_description.getAttributeCount();if(c>1&&!r){for(let t=1;t<c;t++){let n=this.m_description.getSemantics(t),r=bu.getComponentCount(n);for(let t=0;t<r;t++){let r=this.getAttributeAsDbl(e,n,t);i.setStartAttribute(n,t,r)}}for(let e=1;e<c;e++){let n=this.m_description.getSemantics(e),r=bu.getComponentCount(n);for(let e=0;e<r;e++){let r=this.getAttributeAsDbl(t,n,e);i.setEndAttribute(n,e,r)}}}i.afterCompletedModification()}queryDerivative(e,t){Nd(this,e,t)}cutArcIgnoreAttributes(e,t,n){let r=e===0&&t===1,i=new z;this.queryCoord2D(e,i);let a=new z;this.queryCoord2D(t,a),r||(i.equals(a)?t-e>.5&&this.isMajor()&&this.isClosed()?(r=!0,e=0,t=1):t===1?e=t:t=e:(e>0&&i.isEqual(this.m_XStart,this.m_YStart)&&(e=0),t<1&&a.isEqual(this.m_XEnd,this.m_YEnd)&&(t=1),r=e===0&&t===1)),n.m_center.assign(this.m_center),n.m_semiMajorAxis=this.m_semiMajorAxis,n.m_minorMajorRatio=this.m_minorMajorRatio,n.m_interior.assign(this.m_interior),n.m_rotation=this.m_rotation,n.m_cosr=this.m_cosr,n.m_sinr=this.m_sinr,n.m_sweepAngle=this.m_sweepAngle,n.m_startAngle=this.m_startAngle,n.m_bits=this.m_bits,jr(n,i.x,i.y),Nr(n,a.x,a.y),r?sd(n,Ju(this)):(n.m_startAngle=Uu(this,e),n.m_sweepAngle=Uu(this,t)-n.m_startAngle,n.m_startAngle=Ru(n.m_startAngle),fd(n,Math.abs(n.m_sweepAngle)>Math.PI),wd(n),n.afterCompletedModification())}changeEndPoints2D(e,t){Xu(this,e,t,!1)}getAttributeAsDbl(e,t,n){if(t===0)return n===0?this.getCoordX(e):this.getCoordY(e);if(e===0)return this.getStartAttributeAsDbl(t,n);if(e===1)return this.getEndAttributeAsDbl(t,n);let r=this.calculateLength2D(),i=r>0?this.tToLength(e)/r:0,a=bu.getInterpolation(t),o=this.getStartAttributeAsDbl(t,n),s=this.getEndAttributeAsDbl(t,n);return le(a,o,s,i,bu.getDefaultValue(t))}getClosestCoordinate(e,t){return Ad(this,e,I.unit(),t)}getClosestCoordinateOnInterval(e,t,n=-1){return Ad(this,e,t,!1)}getYMonotonicParts(e,t=!1){e.length<2&&R(``);let n=this.getSemiAxes(),r=Math.atan2(n.y*this.m_cosr,n.x*this.m_sinr),i=r+oe(),a=H(3,NaN),o=0;if(a[0]=Hu(this,r),a[0]>0&&a[0]<1&&o++,a[1]=Hu(this,i),a[1]>0&&a[1]<1&&(a[o]=a[1],o++),o===0)return 0;a[o]=1,o++,U(e.length>=o);let s=0;for(let n=0;n<o;n++){let r=a[n];this.queryCut(s,r,e[n],t),s=r}return o}getMonotonicParts(e,t){if(e.length<4&&R(``),this.isDegenerateToLine())return e[0].createEllipticArc().assignCopy(this),t&&e[0].get().dropAllAttributes(),1;let n=this.getSemiAxes(),r=H(4,NaN);r[0]=Math.atan2(n.y*this.m_cosr,n.x*this.m_sinr),r[1]=r[0]+oe(),r[2]=Math.atan2(-n.y*this.m_sinr,n.x*this.m_cosr),r[3]=r[2]+oe();let i=H(5,NaN),a=0;for(let e=0;e<4;e++)i[a]=Hu(this,r[e]),i[a]>0&&i[a]<1&&a++;if(a===0)return 0;ct(i,a),i[a-1]<1&&(i[a]=1,a++),U(e.length>=a);let o=0;for(let n=0;n<a;n++){let r=i[n];this.queryCut(o,r,e[n],t),o=r}return a}intersectionWithAxis2D(e,t,n,r){if(td(this))return new Z({start:this.getStartXY(),end:this.getEndXY()}).intersectionWithAxis2D(e,t,n,r);let i,a,o=new P(t),s=this.getSemiAxes();if(e){if(t>this.m_center.y+s.x||t<this.m_center.y-s.x)return 0;i=new P(s.x).mulThis(this.m_sinr),a=new P(s.y).mulThis(this.m_cosr),o.subThis(this.m_center.y)}else{if(t>this.m_center.x+s.x||t<this.m_center.x-s.x)return 0;i=new P(s.x).mulThis(this.m_cosr),a=new P(s.y).mulThis(-this.m_sinr),o.subThis(this.m_center.x)}let c=i.sqr(),l=a.sqr(),u=c.addE(l),d=a.mulE(o).mulThis(-2),f=o.sqr().subThisE(c),p=d.sqr().subThisE(u.mulE(f).mulThis(4)),m=i.mulE(o).mulThis(-2),h=o.sqr().subThisE(l),g=m.sqr().subThisE(u.mulE(h).mulThis(4)),_=p.eps()*Math.abs(g.value())<=g.eps()*Math.abs(p.value());_?i.isZero()&&(_=!1):a.isZero()&&(_=!0),_||(d.setE(m),f.setE(h));let v=C(P,2),y=ra(u,d,f,I.construct(-1,1),!1,v);if(y===0)return 0;let b=[0,0],x=0;for(let e=0;e<y;e++){let t=new P,n=new P;_?(t.setE(v[e]),n.setE(o.subE(a.mulE(v[e])).divThisE(i))):(n.setE(v[e]),t.setE(o.subE(i.mulE(v[e])).divThisE(a)));let r=Hu(this,Math.atan2(t.value(),n.value()));r>=0&&r<=1&&(b[x]=r,x++)}return y=x,y===0?0:(y===2&&b[0]>b[1]&&(b[1]=W(b[0],b[0]=b[1])),r&&Qe(r,b,0,0,y),n&&(n[0]=e?this.getCoordX(b[0]):this.getCoordY(b[0]),y>1&&(n[1]=e?this.getCoordX(b[1]):this.getCoordY(b[1]),!r&&n[0]>n[1]&&(n[1]=W(n[0],n[0]=n[1])))),y)}intersectionOfYMonotonicWithAxisX(e,t){if(this.m_YStart===this.m_YEnd)return e===this.m_YStart?t:NaN;if(e===this.m_YStart)return this.m_XStart;if(e===this.m_YEnd)return this.m_XEnd;let n=[0,0];return this.intersectionWithAxis2D(!0,e,n,null)===-1?t:n[0]}isCurve(){return!0}isDegenerate(e){return Tr(this,e)}isDegenerate3D(e,t){return U(0),!1}queryLooseEnvelope(e){e.m_EnvelopeType===3?xt(`3d not impl`):this.queryLooseEnvelopeOnInterval(new I(0,1),e)}clone(t){let n=new e;return this.copyTo(n),n}queryInterval(e,t){if(e===0){if(td(this))return t===0?I.construct(this.getStartX(),this.getEndX()):I.construct(this.getStartY(),this.getEndY());let e,n=this.getSemiAxes();e=t===0?Math.atan2(-n.y*this.m_sinr,n.x*this.m_cosr):Math.atan2(n.y*this.m_cosr,n.x*this.m_sinr);let r=e+Math.PI,i=[0,0];i[0]=Hu(this,e),i[1]=Hu(this,r);let a=t===0?I.construct(this.getStartX(),this.getEndX()):I.construct(this.getStartY(),this.getEndY()),o=new z;for(let e=0;e<2;e++){let n=i[e];n>0&&n<1&&(this.queryCoord2D(n,o),a.mergeNeCoordinate(t===0?o.x:o.y))}return a}return super.queryInterval(e,t)}queryLooseEnvelopeOnInterval(e,t){let n=new I(0,1);if(n.intersect(e),n.isEmpty())return void t.setEmpty();if(td(this))return t.setCoords(this.getCoord2D(n.vmin)),void t.mergeNe(this.getCoord2D(n.vmax));let r=this.getCoord2D(n.vmin),i=this.getCoord2D(n.vmax);if(this.m_minorMajorRatio===1&&Math.abs(this.m_sweepAngle)*n.width()<=nt){let e=z.lerp(r,i,.5),n=e.sub(this.m_center);n.normalize(),e=e.add(n.mul(.5*z.distance(r,i))),t.setCoords(r),t.mergeNe(i),t.mergeNe(e);return}kd(this,n,t)}tToLength(e){return td(this)?e*z.distance(this.getStartXY(),this.getEndXY()):this.m_minorMajorRatio===1?Math.abs(this.getSweepAngle()*e)*this.m_semiMajorAxis:nd(this,e)}parametricAngleToT(e){return Hu(this,e)}tToParametricAngle(e){return Uu(this,e)}lengthToT(e){if(td(this)){let t=z.distance(this.getStartXY(),this.getEndXY());return t===0?0:e/t}if(this.m_minorMajorRatio===1){let t=Math.abs(this.getSweepAngle())*this.m_semiMajorAxis;return t===0?0:e/t}return rd(this,e)}calculateWeightedAreaCentroid2D(e){if(td(this)){let e=new z;return e.setCoords(0,0),e}let t=Cd(this),n=this.getStartXY().sub(this.m_center),r=this.getEndXY().sub(this.m_center),i=this.m_semiMajorAxis,a=this.getSemiMinorAxis(),o=this.m_startAngle+this.m_sweepAngle,s=new z;s.x=i*a*(i*this.m_cosr*(-Math.sin(o)+Math.sin(this.m_startAngle))+a*(-Math.cos(o)+Math.cos(this.m_startAngle))*this.m_sinr)/3,s.y=i*a*(a*(Math.cos(o)-Math.cos(this.m_startAngle))*this.m_cosr+i*(-Math.sin(o)+Math.sin(this.m_startAngle))*this.m_sinr)/3;let c=r.add(n).mul(r.crossProduct(n)/6);return s.x-=c.x,s.y-=c.y,s.add(this.m_center.sub(e).mul(t))}calculateWeightedCentroid2D(){let e=new z;if(this.isDegenerate(0))return e.setCoords(0,0),e;if(td(this))return e.assign(this.getCoord2D(.5).mul(this.calculateLength2D())),e;let t=this.m_startAngle,n=this.m_startAngle+this.m_sweepAngle;if(n<t){let e=t;t=n,n=e}let r=Math.sin(t),i=Math.sin(n),a=Math.cos(t),o=Math.cos(n);if(this.m_minorMajorRatio===1){let t=this.getSemiMajorAxis(),n=t*t,s=n*(i-r),c=n*(a-o);e.setCoords(s,c)}else{let t=this.getSemiMajorAxis(),n=this.getSemiMinorAxis(),s=t*t,c=n*n,l=t*n,u=s-c,d=u/c,f=u/s,p=Math.sqrt(d),m=Math.sqrt(f),h=.5*l*(Math.asinh(p*i)/p+i*Math.sqrt(1+d*i*i))-.5*l*(Math.asinh(p*r)/p+r*Math.sqrt(1+d*r*r)),g=-.5*l*(Math.asin(m*o)/m+o*Math.sqrt(1-f*o*o))- -.5*l*(Math.asin(m*a)/m+a*Math.sqrt(1-f*a*a));e.setCoords(h,g)}return e.rotateDirect(this.m_cosr,this.m_sinr),e.assign(e.add(this.m_center.mul(this.calculateLength2D()))),e}isIntersectingPoint(e,t,n){if(n&&(e.isEqualPoint2D(this.getStartXY())||e.isEqualPoint2D(this.getEndXY())))return!1;if(!td(this)){let n=z.distance(e,this.m_center),r=this.getSemiAxes();if(n<r.x-t||n>r.y+t)return!1}let r=this.getClosestCoordinate(e,!1),i=new z;return this.queryCoord2D(r,i),z.distance(i,e)<=t}isIntersectingPoint3D(e,t,n,r,i=1){return U(0),!1}getTangent(e){if(td(this))return this.getEndXY().sub(this.getStartXY());{let t=Uu(this,e),n=new z;return n.setCoords(-this.m_semiMajorAxis*Math.sin(t),this.getSemiMinorAxis()*Math.cos(t)),this.m_rotation&&n.rotateDirect(this.m_cosr,this.m_sinr),n.scale(this.getSweepAngle()),n}}getDerivative(e){if(td(this))return this.getEndXY().sub(this.getStartXY());{let t=Uu(this,e),n=new z;return n.setCoords(-this.m_semiMajorAxis*Math.sin(t),this.getSemiMinorAxis()*Math.cos(t)),this.m_rotation&&n.rotateDirect(this.m_cosr,this.m_sinr),n.scale(this.getSweepAngle()),n}}normalizeAfterEndpointChange(){return!!hd(this)&&(td(this)?(gd(this),!1):_d(this,!1))}projectionBehavior(){return(4&this.m_bits)>>2}setProjectionBehavior(e){this.m_bits=-5&this.m_bits|e<<2}convertToCanonic(e){let t=new z(e.x,e.y);return t.subThis(this.m_center),t.rotateReverse(this.m_cosr,this.m_sinr),t}convertFromCanonic(e){let t=new z(e.x,e.y);return t.rotateDirect(this.m_cosr,this.m_sinr),t.addThis(this.m_center),t}canonicToWorldTransformation(e){e.setRotate(this.m_cosr,this.m_sinr),e.shiftCoords(this.m_center.x,this.m_center.y)}getCurvature(e){let t=Uu(this,e),n=new z,r=this.getSemiMinorAxis();n.setCoords(-this.m_semiMajorAxis*Math.sin(t),r*Math.cos(t));let i=new z;i.setCoords(-this.m_semiMajorAxis*Math.cos(t),-r*Math.sin(t)),this.m_rotation&&(n.rotateDirect(this.m_cosr,this.m_sinr),i.rotateDirect(this.m_cosr,this.m_sinr));let a=n.sqrLength();if(a===0)return NaN;let o=Math.sqrt(a);return n.divThis(o),n.crossProduct(i)/a}getMonotonicPartParams(e,t){let n=H(6,NaN);n[0]=0;let r=1;if(this.isDegenerateToLine())n[1]=1,r=2;else{let e=this.getSemiAxes(),t=H(4,NaN);this.m_rotation?(t[0]=Math.atan2(e.y*this.m_cosr,e.x*this.m_sinr),t[1]=t[0]+Math.PI,t[2]=Math.atan2(-e.y*this.m_sinr,e.x*this.m_cosr),t[3]=t[2]+Math.PI):(t[0]=0,t[1]=Math.PI,t[2]=.5*Math.PI,t[3]=gt());for(let e=0;e<4;e++){let i=Hu(this,t[e]);i>0&&i<1&&(n[r]=i,r++)}r>2&&ct(n,r),n[r]=1,r++}if(t){e<r&&R(``);for(let e=0;e<r;e++)t[e]=n[e]}return r}calculateLowerLength2D(){let e=z.distance(this.getStartXY(),this.getEndXY());if(this.isDegenerateToLine())return e;let t=Math.abs(this.m_sweepAngle)*this.getSemiMinorAxis();return Math.max(t,e)}calculateUpperLength2D(){let e=z.distance(this.getStartXY(),this.getEndXY());if(this.isDegenerateToLine())return e;let t=Math.abs(this.m_sweepAngle)*this.getSemiMajorAxis();return Math.max(t,e)}orientBottomUp(){if(this.m_YEnd<this.m_YStart||this.m_YEnd===this.m_YStart&&this.m_XEnd<this.m_XStart){this.m_XEnd=W(this.m_XStart,this.m_XStart=this.m_XEnd),this.m_YEnd=W(this.m_YStart,this.m_YStart=this.m_YEnd);for(let e=0,t=this.m_description.getTotalComponentCount()-2;e<t;e++)this.m_attributes[e+t]=W(this.m_attributes[e],this.m_attributes[e]=this.m_attributes[e+t]);this.m_startAngle+=this.m_sweepAngle,this.m_sweepAngle=-this.m_sweepAngle}}isLine(){return td(this)}copyIgnoreAttributes(e){e.m_XStart=this.m_XStart,e.m_YStart=this.m_YStart,e.m_XEnd=this.m_XEnd,e.m_YEnd=this.m_YEnd,e.m_center.assign(this.m_center),e.m_semiMajorAxis=this.m_semiMajorAxis,e.m_minorMajorRatio=this.m_minorMajorRatio,e.m_interior.assign(this.m_interior),e.m_rotation=this.m_rotation,e.m_cosr=this.m_cosr,e.m_sinr=this.m_sinr,e.m_sweepAngle=this.m_sweepAngle,e.m_startAngle=this.m_startAngle,e.m_bits=this.m_bits,cd(e)}calculateArea2DHelper(){return Cd(this)}absNorm(){let e=this.getStartXY().norm(1)+this.getEndXY().norm(1);return this.isDegenerateToLine()||(e+=this.m_center.norm(1),e+=this.m_semiMajorAxis),e}queryEnvelopeW(e,t){if(t.setCoords(this.getCoord2D(e.vmin)),t.mergeNe(this.getCoord2D(e.vmax)),td(this))return;let n=this.getSemiAxes(),r=H(8,NaN);{let e=Math.atan2(-n.y*this.m_sinr,n.x*this.m_cosr),t=e+Math.PI,i=Math.atan2(n.y*this.m_cosr,n.x*this.m_sinr),a=i+Math.PI;r[0]=Hu(this,e),r[1]=Hu(this,t),r[2]=Hu(this,i),r[3]=Hu(this,a)}{let e=this.m_cosr+this.m_sinr,t=this.m_cosr-this.m_sinr,i=Math.atan2(-n.y*e,n.x*t),a=i+Math.PI,o=Math.atan2(n.y*t,n.x*e),s=o+Math.PI;r[4]=Hu(this,i),r[5]=Hu(this,a),r[6]=Hu(this,o),r[7]=Hu(this,s)}let i=z.getNAN();for(let n=0;n<8;n++){let a=r[n];e.containsExclusiveCoordinate(a)&&(this.queryCoord2D(a,i),t.mergeNe(i))}}setSegmentFromCoordsForStitcher(e,t){Zu(this,e,t)}writeInBufferStream(e,t){let n=new Float64Array(10);return n[0]=this.m_bits,n[1]=this.m_semiMajorAxis,n[2]=this.m_minorMajorRatio,n[3]=this.m_rotation,n[4]=this.m_center.x,n[5]=this.m_center.y,n[6]=this.m_sweepAngle,n[7]=this.m_startAngle,n[8]=this.m_interior.x,n[9]=this.m_interior.y,e.writeRangeFromArray(t,n.length,n,!0,1),t+n.length}readFromBufferStream(e,t){let n=new Float64Array(10);e.queryRange(t,n.length,n,!0,1),this.m_bits=n[0],this.m_semiMajorAxis=n[1],this.m_minorMajorRatio=n[2],this.m_rotation=n[3],this.m_center.x=n[4],this.m_center.y=n[5],this.m_sweepAngle=n[6],this.m_startAngle=n[7],this.m_interior.x=n[8],this.m_interior.y=n[9],this.m_cosr=Math.cos(this.m_rotation),this.m_sinr=Math.sin(this.m_rotation),this.m_cachedValues=null}snapControlPoints(e){return!1}needsSnapControlPoints(e){return!1}calculateSpecialPointsForCracking(e,t){return B(`should not1; be called`),0}ensureXYMonotone(){if(td(this))return!1;if(this.getStartXY().equals(this.getEndXY()))return ed(this,this.getStartXY(),this.getEndXY(),this.projectionBehavior()),!0;let e=C(z,3),t=vd(this,e);if(Pl(e)){let n=!1;if(this.projectionBehavior()===0){let r=new G;r.setCoords({pt:e[0]}),r.mergeNe(e[2]);let i=new z;i.setSub(e[2],e[0]),i.leftPerpendicularThis(),i.normalize(),i.scale(z.distance(e[2],e[0]));let a=z.lerp(e[2],e[0],.5),o=a.sub(i),s=a.add(i);r.clipLine(o,s);let c=z.getClosestCoordinate(o,s,e[1],!1);e[1]=z.lerp(o,s,c);let l=e[2].sub(e[1]),u=e[0].sub(e[1]),d=l.crossProduct(u),f=l.dotProduct(u);t=p()-Math.abs(.5*Math.atan2(d,f)),n=!0}return yd(e,t*t,null,n,this),!0}return!1}setCoordsForIntersector(e,t,n){Xu(this,e,t,n)}getInteriorPoint(){return this.m_interior.clone()}copyToImpl(e){let t=e;t.m_center.assign(this.m_center),t.m_semiMajorAxis=this.m_semiMajorAxis,t.m_minorMajorRatio=this.m_minorMajorRatio,t.m_interior.assign(this.m_interior),t.m_rotation=this.m_rotation,t.m_cosr=this.m_cosr,t.m_sinr=this.m_sinr,t.m_sweepAngle=this.m_sweepAngle,t.m_startAngle=this.m_startAngle,t.m_bits=this.m_bits,sd(t,Ju(this))}reverseImpl(){ud(this,!dd(this)),Vu(this),(this.projectionBehavior()!==0||this.getStartXY().equals(this.getEndXY()))&&wd(this)}equalsImpl(e){let t=e;if(this.m_bits!==t.m_bits||this.m_semiMajorAxis!==t.m_semiMajorAxis||this.m_minorMajorRatio!==t.m_minorMajorRatio||!(this.m_center.isEqualPoint2D(t.m_center)||this.m_center.isNAN()&&t.m_center.isNAN())||this.m_rotation!==t.m_rotation||!this.m_interior.equals(t.m_interior))return!1;let n=t.m_sweepAngle;if(this.m_sweepAngle!==n)return!1;let r=t.m_startAngle;return this.m_startAngle===r}equalsImplTol(e,t){let n=e;if(this.m_bits!==n.m_bits)return!1;if(this.m_center.isNAN()&&n.m_center.isNAN())return!0;if(this.m_center.isNAN()!==n.m_center.isNAN()||!this.getSemiAxes().isEqualPoint2D(n.getSemiAxes(),t)||!this.m_center.isEqualPoint2D(n.m_center,t))return!1;let r=Math.abs(hu(mu(gu(this.m_rotation-n.m_rotation)))),i=Math.abs(oe()-r),a=Math.min(r,i);if(this.m_semiMajorAxis*Math.abs(a)>t)return!1;let o=this.getCoord2D(.5),s=n.getCoord2D(.5);return!!o.isEqualPoint2D(s,t)}swapImpl(e){let t=e;this.m_center=W(t.m_center,t.m_center=this.m_center),this.m_semiMajorAxis=W(t.m_semiMajorAxis,t.m_semiMajorAxis=this.m_semiMajorAxis),this.m_minorMajorRatio=W(t.m_minorMajorRatio,t.m_minorMajorRatio=this.m_minorMajorRatio),this.m_interior=W(t.m_interior,t.m_interior=this.m_interior),this.m_rotation=W(t.m_rotation,t.m_rotation=this.m_rotation),this.m_cosr=W(t.m_cosr,t.m_cosr=this.m_cosr),this.m_sinr=W(t.m_sinr,t.m_sinr=this.m_sinr),this.m_sweepAngle=W(t.m_sweepAngle,t.m_sweepAngle=this.m_sweepAngle),this.m_startAngle=W(t.m_startAngle,t.m_startAngle=this.m_startAngle),this.m_bits=W(t.m_bits,t.m_bits=this.m_bits),ld(this,t)}afterCompletedModification(){gd(this),cd(this)}intersect(e,t,n,r,i){return Bd(!1,this,e,t,n,r,i)}intersectPoint(e,t,n){if(t.length<2&&E(``),td(this))return new Z({start:this.getStartXY(),end:this.getEndXY()}).intersectPoint(e,t,n);{let t=z.distance(e,this.m_center);if(t>this.m_semiMajorAxis+n||t<this.getSemiMinorAxis()-n)return 0}let r=this.getClosestCoordinate(e,!1),i=z.getNAN();return this.queryCoord2D(r,i),z.distance(i,e)<=n?re(r,0,1)&&(this.queryCoord2D(r===0?1:0,i),z.distance(i,e)<=n)?(t&&(t[0]=0,t[1]=1),2):(t&&(t[0]=r),1):0}isIntersecting(e,t,n){return Id(!1,this,e,t,n)!==0}endPointModified(){this.m_bits|=8,cd(this)}clearEndPointModified(){gd(this)}};function Su(e,t,n,r){let i=[];return Cu(t,i),wu(e,i,t,n)}function Cu(e,t){t.length=e;for(let e=0;e<t.length;++e)t[e]=e;e>3&&$r(e,t)}function wu(e,t,n,r,i){let a=0,o=[0,0,0],s=0,c=0;for(let i=0;i<3;++i){let l=!1;for(;c<n;){let n=e.at(t[c]),u=1;if(a===3?u=z.inCircleRobust(e.at(r[0]),e.at(r[1]),e.at(r[2]),n):a===2?u=z.inCircleRobust3Point(e.at(r[0]),e.at(r[1]),n):a===1&&n.equals(e.at(r[0]))&&(u=0),u<=0){if(u<0&&i+1<3){t[s]=W(t[c],t[c]=t[s]);for(let e=0;e<a;e++)if(r[e]===t[c]){o[e]=c;break}s++}c++;continue}l=!0;let d=0;for(let e=0;e<a;e++)o[e]>c&&(r[d]=r[e],o[d]=o[e],d++);a=d,r[a]=t[c],o[a]=c,a++,a<3?c=s:(z.orientationRobust(e.at(r[0]),e.at(r[1]),e.at(r[2]))===1&&(r[2]=W(r[0],r[0]=r[2]),o[2]=W(o[0],o[0]=o[2])),c++)}if(!l)break;if(i+1<3){s=0;let n=!1;for(let e=0;e<a;e++)for(let t=e+1;t<a;t++)o[e]>o[t]&&(o[t]=W(o[e],o[e]=o[t]),r[t]=W(r[e],r[e]=r[t]),n=!0);for(let e=0;e<a;e++)t[o[e]]=W(t[e],t[e]=t[o[e]]),o[e]=e;n&&a===3&&z.orientationRobust(e.at(r[0]),e.at(r[1]),e.at(r[2]))===1&&(r[2]=W(r[0],r[0]=r[2]),o[2]=W(o[0],o[0]=o[2]))}c=a}return a}function Tu(e,t,n,r,i,a){return new Ou(0,0,0,null,!1,Ve()).densifyEx(e,t,n,r,!1,a)}function Eu(e,t,n,r,i,a,o,s){a&&(a.length=0),o&&(o.length=0);let c=e.getGeometryType();if(c===L.enumLine)return a&&(a.push(e.getStartXY()),a.push(z.getNAN()),a.push(z.getNAN()),a.push(e.getEndXY())),o&&(o.push(0),o.push(1)),1;if(c===L.enumBezier){if(!r)return a&&(a.push(e.getStartXY()),a.push(e.getControlPoint1()),a.push(e.getControlPoint2()),a.push(e.getEndXY())),o&&(o.push(0),o.push(1)),1;let t=H(9,NaN),s=e.getMonotonicPartParams(t.length,t);if(t.length=s,s=ku(e,n,t),s===2&&i&&(t[1]=.5,t.push(1),s=3),o&&o.splice(0,0,...t.slice(0,s)),a){let n=new Q;for(let r=1;r<s;r++){let i=t[r-1],o=t[r];e.queryCut(i,o,n,!0);let s=n.get();$s(s),r===1&&a.push(s.getStartXY()),a.push(s.getControlPoint1()),a.push(s.getControlPoint2()),a.push(s.getEndXY())}}return s-1}if(c===L.enumEllipticArc){let s=e;if(s.isDegenerateToLine()||s.isDegenerate(0))return a&&(a.push(e.getStartXY()),a.push(z.getNAN()),a.push(z.getNAN()),a.push(e.getEndXY())),o&&(o.push(0),o.push(1)),1;if(r&&(i||!s.isMonotoneQuickAndDirty())){let c=H(6,NaN),l=s.getMonotonicPartParams(c.length,c);c.length=l,l=ku(e,n,c),l===2&&i&&(c[1]=.5,c.push(1),l=3);let u=0;if(l>2){let e=new Q,i=o||[],d=0;for(let f=1;f<l;f++){let p=c[d],m=c[f];if(s.queryCut(p,m,e,!0),e.get().isDegenerate(0))continue;let h=i.length,g=Au(f===1,e.get(),t,n,r,a,o);U(g>0),u+=g;let _=f===l-1,v=c[d],y=e.get().getSweepAngle()/s.getSweepAngle();for(let e=h,t=i.length;e<t;e++)if(i[e]=!_||e+1<t?v+i[e]*y:1,a){let t=3*e,n=s.getCoord2D(i[e]);a[t].setCoordsPoint2D(n),t>0&&ec(a.slice(t-3))}d=f}return u}}return Au(!0,s,t,n,r,a,o)}if(c===L.enumRationalBezier2){let s=e;if(r&&(i||!s.isMonotoneQuickAndDirty())){let r=H(6,NaN),c=s.getMonotonicPartParams(r.length,r);r.length=c,c=ku(e,n,r),c===2&&i&&(r[1]=.5,r.push(1),c=3);let l=0;if(c>2){let e=new Q,i=o||[];for(let u=1;u<c;u++){let d=r[u-1],f=r[u];s.queryCut(d,f,e,!0);let p=i.length;l+=ju(u===1,e.get(),t,n,!1,a,o);let m=u===c-1,h=r[u-1];for(let e=p,t=i.length;e<t;e++)if(i[e]=!m||e+1<t?h+i[e]:1,a){let t=3*e,n=s.getCoord2D(i[e]);a[t].setCoordsPoint2D(n),t>0&&vo(a.slice(t-3))}}return l}}return ju(!0,s,t,n,r,a,o)}if(c===L.enumBezier2){let s=e,c=C(z,3);s.queryControlPoints(c);let l=new Gc;l.constructFromQuadratic(c);let u=Eu(l,t,n,r,i,a,o);if(a!=null&&o!=null)for(let e=1,t=0;e<u;++e,t+=3){let n=new z;s.queryCoord2D(o[e],n);let i=a[t+3];!n.equals(i)&&(a[t+3].setCoordsPoint2D(n),r)&&ec(a.slice(t,t+4))}return u}xt(``)}function Du(e,t,n,r,i,a,o,s,c){let l=e.getGeometryType();if(a&&(a.length=0,o.length=0),s&&(s.length=0),l===L.enumEllipticArc){let t=e;if(t.isDegenerateToLine()||t.isDegenerate(0))return a&&(a.push(e.getStartXY()),a.push(z.getNAN()),a.push(e.getEndXY()),o.push(NaN),o.push(NaN),o.push(NaN)),s&&(s.push(0),s.push(1)),1}let u=H(9,NaN),d;if(i)d=e.getMonotonicPartParams(u.length,u),u.length=d,d=ku(e,n,u);else{if(d=2,u[0]=0,u[1]=1,l===xu.type){let t=e.getSweepAngle();if(t>.9*Math.PI){let e=2*Math.PI/3;Math.min(3,Math.trunc(t/e+.5))>2?(u[0]=0,u[1]=1/3,u[2]=2/3,u[3]=1,d=4):(u[0]=0,u[1]=.5,u[2]=1,d=3)}}else U(l===ha.type);u.length=d}if(d===2&&r&&(u[1]=.5,u.push(1),d=3),a){let t=new Q,n=1;for(;n<d;){let r=u[n-1],s=u[n];e.queryCut(r,s,t,!0);let c=C(z,3),f=[1,1,1];if(l===L.enumEllipticArc){let e=t.get();if(Math.abs(e.getSweepAngle())>.9*Math.PI){let e=(s-r)/3;u.splice(n,0,r+e),u.splice(n+1,0,r+2*e),d+=2;continue}f[1]=vd(e,c)}else{let e=t.get();e.queryControlPoints(c),e.queryWeights(f)}i&&Pl(c),n===1&&(a.push(c[0].clone()),o.push(f[0])),a.push(c[1].clone()),a.push(c[2].clone()),o.push(f[1]),o.push(f[2]),n++}}return s&&(s.length=d,Qe(s,u,0,0,d)),d-1}xu.type=L.enumEllipticArc;var Ou=class e{static constructDefault(t){return new e(0,0,0,t,!1,Ve())}constructor(e,t,n,r,i,a){this.m_segmentBuffer=null,this.m_dummyPoint=new q,this.m_progressCounter=0,this.m_progressTracker=r,this.m_bSetDensifyFlag=i,this.m_maxLength=e,this.m_maxDeviation=t,this.m_maxAngle=n>p()?p():n,this.m_cosMaxAngle=Math.cos(this.m_maxAngle),this.m_bOnlyCurveDensify=this.m_maxAngle>0||this.m_maxDeviation>0,this.m_maxSegmentsPerCurve=a,be(this.m_maxSegmentsPerCurve>0,`this.m_maxSegmentsPerCurve > 0`),this.m_minStep=1/this.m_maxSegmentsPerCurve}densify(e){return this.densifyGeom(e)}densifySegment(e,t){this.densifySegmentEx(e,null,!0,!1,t)}densifyEx(e,t,n,r,i,a){return this.m_maxLength=t,this.m_maxDeviation=n,this.m_maxAngle=r>p()?p():r,this.m_cosMaxAngle=Math.cos(this.m_maxAngle),this.m_bOnlyCurveDensify=this.m_maxAngle>0||this.m_maxDeviation>0,this.m_bSetDensifyFlag=i,this.m_maxSegmentsPerCurve=a,be(this.m_maxSegmentsPerCurve>0,`this.m_maxSegmentsPerCurve > 0`),this.m_minStep=1/this.m_maxSegmentsPerCurve,this.densifyGeom(e)}densifyGeom(e){if(e.isEmpty()||e.getDimension()<1)return e;let t=e.getGeometryType();return Le(t)?e:V(t)?this.densifyMultiPath(e):Ne(t)?this.densifySegmentImpl(e):t===L.enumEnvelope?this.densifyEnvelope(e):void B(``)}densifySegmentEx(e,t,n,r,i){let a=e.getGeometryType();if(!(this.m_maxLength>0||this.m_bOnlyCurveDensify&&a!==L.enumLine)&&(!r||n))return void(t?a===L.enumLine?t.addSegment(e,n):(n&&(e.queryStart(this.m_dummyPoint),t.startPathPoint(this.m_dummyPoint)),e.queryEnd(this.m_dummyPoint),t.lineToPoint(this.m_dummyPoint)):(n&&i.push(0),i.push(1)));if(a===L.enumBezier)return void this.densifyCubicBezier(e,t,n,r,i);if(a===L.enumRationalBezier2)return void this.densifyRationalBezier2(e,t,n,r,i);if(a===L.enumBezier2)return void this.densifyBezier2(e,t,n,r,i);if(a===L.enumEllipticArc&&!e.isLine()&&e.getMinorMajorRatio()<.25)return void this.densifyEllipticArc(e,t,n,r,i);let o=1;this.m_maxLength>0&&(o=this.calculateLengthSubdivisionStep(e,this.m_maxLength)),this.m_maxDeviation>0&&(o=Math.min(o,this.calculateDeviationSubdivisionStep(e,this.m_maxDeviation))),this.m_maxAngle>0&&(o=Math.min(o,this.calculateAngularSubdivisionStep(e,this.m_maxAngle))),this.densifySegmentByLength(e,o,t,n,r,i)}densifyMultiPath(e){if(!e.hasNonLinearSegments()){if(e.getDescription().getAttributeCount()===1)return this.densifyMultiPathLinear(e);if(!(this.m_maxLength>0))return e}let t=e.createInstance();t.getGeometryType()===L.enumPolygon&&t.setFillRule(e.getFillRule()),t.reserve(e.getPointCount());let n=e.getImpl().querySegmentIterator();for(;n.nextPath();){let e=!0;for(;n.hasNextSegment();){let r=n.nextSegment(),i=n.isClosingSegment();this.densifySegmentEx(r,t,e,i,null),i&&t.closePathWithLine(),e=!1}}return t}densifySegmentImpl(e){let t=new Bi({vd:e.getDescription()});return this.densifySegmentEx(e,t,!0,!1,[0]),t}densifyEnvelope(e){let t=new X({vd:e.getDescription()});t.addEnvelope(e,!1);let n=G.constructEmpty();e.queryEnvelope(n);let r=n.width(),i=n.height();return!(this.m_maxLength>0)||r<=this.m_maxLength&&i<=this.m_maxLength?t:this.densifyMultiPath(t)}densifyMultiPathLinear(e){if(!(this.m_maxLength>0))return e;let t=e.createInstance();t.getGeometryType()===L.enumPolygon&&t.setFillRule(e.getFillRule()),t.reserve(e.getPointCount());let n=t.getImpl(),r=e.getImpl(),i=r.getAttributeStreamRef(0),a=new Z;for(let e=0,o=r.getPathCount();e<o;e++){let o=r.isClosedPath(e);if(r.getPathSize(e)===0)continue;let s=r.getPathStart(e),c=i.readPoint2D(2*s),l=c.clone();n.startPath(c);for(let o=s+1,c=r.getPathEnd(e);o<c;o++){let e=i.readPoint2D(2*o),r=z.distance(l,e);if(r>this.m_maxLength){let t=Math.ceil(r/this.m_maxLength);t>Ve()&&(t=Ve());let i=1/t,o,s,c;l.compare(e)<0?(a.setStartXY(l),a.setEndXY(e),o=0,s=1):(a.setStartXY(e),a.setEndXY(l),o=t-2,s=-1);for(let e=0,r=t-1;e<r;e++,o+=s){this.progress_(),c=i*(o+1);let e=new z;a.queryCoord2D(c,e),n.lineTo(e),this.m_bSetDensifyFlag&&n.setAttributeNoCurves(10,n.getPointCount()-1,0,1)}}else this.progress_();t.lineTo(e),l.assign(e)}if(o){let e=z.distance(l,c);if(e>this.m_maxLength){let t=c,r=Math.ceil(e/this.m_maxLength);r>Ve()&&(r=Ve());let i=1/r,o,s;l.compare(t)<0?(a.setStartXY(l),a.setEndXY(t),o=0,s=1):(a.setStartXY(t),a.setEndXY(l),o=r-2,s=-1);let u=new z(0,0),d;for(let e=0,t=r-1;e<t;e++,o+=s)this.progress_(),d=i*(o+1),a.queryCoord2D(d,u),n.lineTo(u),this.m_bSetDensifyFlag&&n.setAttributeNoCurves(10,n.getPointCount()-1,0,1)}n.closePathWithLine()}}return t}densifySegmentByLength(e,t,n,r,i,a){U(e.getGeometryType()!==L.enumBezier);let o=e.getStartXY().compare(e.getEndXY());o===0&&t<1&&(e.getGeometryType()===L.enumEllipticArc?o=e.getSweepAngle()<0?1:-1:xt(`densify segment by length`));let s=0;if(r&&(n?(e.queryStart(this.m_dummyPoint),n.startPathPoint(this.m_dummyPoint)):a.push(0),++s),t*this.m_maxSegmentsPerCurve<1&&(t=1/this.m_maxSegmentsPerCurve),t<1){this.m_segmentBuffer||=new Q;let r=Math.ceil(1/t);r>Ve()&&(r=Ve()),t=1/r,this.m_segmentBuffer.create(e.getGeometryType());let i,c,l,u=e;o<0?(i=0,c=1):(e.copyTo(this.m_segmentBuffer.get()),this.m_segmentBuffer.get().reverse(),i=r-2,c=-1,u=this.m_segmentBuffer.get());let d=r-1;for(let e=0;e<d;e++,i+=c)l=t*(i+1),n?(u.queryCoord(l,this.m_dummyPoint),n.lineToPoint(this.m_dummyPoint),this.m_bSetDensifyFlag&&l!==1&&l!==0&&n.setAttribute(10,n.getPointCount()-1,0,1)):a.push(o>0?1-l:l),this.progress_();l=1,s+=d}(!i||i&&r&&s<2)&&(n?(e.queryEnd(this.m_dummyPoint),n.lineToPoint(this.m_dummyPoint)):a.push(1))}densifyCubicBezier(e,t,n,r,i){let a=new Gc,o=e,s=e.calculateUpperLength2D(),c=e.getStartXY().compare(e.getEndXY());if(c===0&&s>0){let t=C(z,4);e.queryControlPoints(t),c=t[1].compare(t[2]),c===0&&(c=t[1].compare(t[0]))}c>0&&(e.copyTo(a),a.reverse(),o=a);let l=0;n&&(t?(e.queryStart(this.m_dummyPoint),t.startPathPoint(this.m_dummyPoint)):i.push(0),++l);let u=[],d=[],f=Math.trunc(Math.log2(this.m_maxSegmentsPerCurve)),p=!0,m=0;if(c>0)for(u.push([o.getStartXY(),o.getControlPoint1(),o.getControlPoint2(),o.getEndXY(),new z(0,1)]),d.push(0);u.length;){this.progress_();let e=u.at(-1),a=d.at(-1),s=e[4].x,c=e[4].y;if(a<f&&this.bezierNeedsSplit(e)){p&&=(m=o.findMinDeriv(),!1);let t=.5*(s+c);Math.abs(m-t)<.4*(c-s)&&(t=m);let n=(t-s)/(c-s),r=e[0].mul(1-n).add(e[1].mul(n)),i=e[1].mul(1-n).add(e[2].mul(n)),l=e[2].mul(1-n).add(e[3].mul(n)),f=r.mul(1-n).add(i.mul(n)),h=i.mul(1-n).add(l.mul(n)),g=f.mul(1-n).add(h.mul(n)),_=e[3];e[1]=r,e[2]=f,e[3]=g,e[4].setCoords(s,t);let v=[g,h,l,_,new z(t,c)];u.push(v),d[d.length-1]=a+1,d.push(a+1);continue}u.pop(),d.pop(),(u.length>0||!r||r&&n&&l<2)&&(t?(o.queryCoord(s,this.m_dummyPoint),t.lineToPoint(this.m_dummyPoint),this.m_bSetDensifyFlag&&s!==1&&s!==0&&t.setAttribute(10,t.getPointCount()-1,0,1)):i.push(1-s),++l)}else for(u.push([o.getStartXY(),o.getControlPoint1(),o.getControlPoint2(),o.getEndXY(),new z(0,1)]),d.push(0);u.length;){this.progress_();let e=u.at(-1),a=d.at(-1),s=e[4].x,c=e[4].y;if(a<f&&this.bezierNeedsSplit(e)){p&&=(m=o.findMinDeriv(),!1);let t=.5*(s+c);Math.abs(m-t)<.4*(c-s)&&(t=m);let n=(t-s)/(c-s),r=e[0].mul(1-n).add(e[1].mul(n)),i=e[1].mul(1-n).add(e[2].mul(n)),l=e[2].mul(1-n).add(e[3].mul(n)),f=r.mul(1-n).add(i.mul(n)),h=i.mul(1-n).add(l.mul(n)),g=f.mul(1-n).add(h.mul(n)),_=e[0];e[0]=g,e[1]=h,e[2]=l,e[4].setCoords(t,c);let v=[_,r,f,g,new z(s,t)];u.push(v),d[d.length-1]=a+1,d.push(a+1);continue}u.pop(),d.pop(),(u.length>0||!r||r&&n&&l<2)&&(t?(o.queryCoord(c,this.m_dummyPoint),t.lineToPoint(this.m_dummyPoint),this.m_bSetDensifyFlag&&c!==1&&c!==0&&t.setAttribute(10,t.getPointCount()-1,0,1)):i.push(c),++l)}}densifyRationalBezier2(e,t,n,r,i){let a=new ha,o=e,s=e.calculateUpperLength2D(),c=e.getStartXY().compare(e.getEndXY());c===0&&s>0&&(c=0),c>0&&(e.copyTo(a),a.reverse(),o=a);let l=0;n&&(t?(e.queryStart(this.m_dummyPoint),t.startPathPoint(this.m_dummyPoint)):i.push(0),++l);let u=Math.trunc(Math.log2(this.m_maxSegmentsPerCurve)),d=new ha,f=[],p=[];for(f.push(new I(0,1)),p.push(0);f.length;){this.progress_();let e=f.at(-1).clone(),a=p.at(-1);if(a<u&&this.rationalBezier2NeedsSplit(o,d,e.vmin,e.vmax)){let t=e.getCenter();c>0?(f.at(-1).vmax=t,f.push(new I(t,e.vmax))):(f.at(-1).vmin=t,f.push(new I(e.vmin,t))),p[p.length-1]=a+1,p.push(a+1);continue}if(f.pop(),p.pop(),f.length>0||!r||r&&n&&l<2){let n=c>0?e.vmin:e.vmax;t?(o.queryCoord(n,this.m_dummyPoint),t.lineToPoint(this.m_dummyPoint),this.m_bSetDensifyFlag&&n!==1&&n!==0&&t.setAttribute(10,t.getPointCount()-1,0,1)):i.push(c>0?1-n:n),++l}}}densifyBezier2(e,t,n,r,i){let a=new _a,o=e,s=e.calculateUpperLength2D(),c=e.getStartXY().compare(e.getEndXY());c===0&&s>0&&(c=0),c>0&&(e.copyTo(a),a.reverse(),o=a);let l=0;n&&(t?(e.queryStart(this.m_dummyPoint),t.startPathPoint(this.m_dummyPoint)):i.push(0),++l);let u=Math.ceil(Math.log2(this.m_maxSegmentsPerCurve)),d=new _a,f=[],p=[];for(f.push(new I(0,1)),p.push(0);f.length;){this.progress_();let e=f.at(-1).clone(),a=p.at(-1);if(a<u&&this.bezier2NeedsSplit(o,d,e.vmin,e.vmax)){let t=e.getCenter();c>0?(f.at(-1).vmax=t,f.push(new I(t,e.vmax))):(f.at(-1).vmin=t,f.push(new I(e.vmin,t))),p[p.length-1]=a+1,p.push(a+1);continue}if(f.pop(),p.pop(),f.length>0||!r||r&&n&&l<2){let n=c>0?e.vmin:e.vmax;t?(o.queryCoord(n,this.m_dummyPoint),t.lineToPoint(this.m_dummyPoint),this.m_bSetDensifyFlag&&n!==1&&n!==0&&t.setAttribute(10,t.getPointCount()-1,0,1)):i.push(c>0?1-n:n),++l}}}densifyEllipticArc(e,t,n,r,i){let a=new xu,o=e,s=e.calculateUpperLength2D(),c=e.getStartXY().compare(e.getEndXY());c===0&&s>0&&(c=e.isClockwise()?0:1),c>0&&(e.copyTo(a),a.reverse(),o=a);let l=0;n&&(t?(e.queryStart(this.m_dummyPoint),t.startPathPoint(this.m_dummyPoint)):i.push(0),++l);let u=Math.trunc(Math.log2(this.m_maxSegmentsPerCurve)),d=new xu,f=[],p=[];for(f.push(new I(0,1)),p.push(0);f.length;){this.progress_();let e=f.at(-1).clone(),a=p.at(-1);if(a<u&&this.ellipticArcNeedsSplit(o,d,e.vmin,e.vmax)){let t=e.getCenter();c>0?(f.at(-1).vmax=t,f.push(new I(t,e.vmax))):(f.at(-1).vmin=t,f.push(new I(e.vmin,t))),p[p.length-1]=a+1,p.push(a+1);continue}if(f.pop(),p.pop(),f.length>0||!r||r&&n&&l<2){let n=c>0?e.vmin:e.vmax;t?(o.queryCoord(n,this.m_dummyPoint),t.lineToPoint(this.m_dummyPoint),this.m_bSetDensifyFlag&&n!==1&&n!==0&&t.setAttribute(10,t.getPointCount()-1,0,1)):i.push(c>0?1-n:n),++l}}}calculateLengthSubdivisionStep(e,t){let n=e.calculateUpperLength2D();if(!e.isCurve())return n?t/n:1;if(e.getGeometryType()===L.enumEllipticArc){let r=e;if(r.isCircular()||r.isDegenerate(0)||r.isDegenerateToLine()){let e=t/n;return e<this.m_minStep&&(e=this.m_minStep),e}return t/n*r.getSemiAxes().y/r.getSemiAxes().x}e.getGeometryType()===L.enumBezier&&xt(``),xt(``)}calculateDeviationSubdivisionStep(e,t){if(!e.isCurve())return 1;if(e.getGeometryType()===L.enumEllipticArc){let n=e;if(n.isDegenerate(0)||n.isDegenerateToLine())return 1;{let r=n.getSemiMajorAxis(),i=1-t/r,a=Math.PI/2;if(i>0){let e=4*Math.sqrt(t/r*.5);a=Math.min(Math.PI/2,Math.abs(e))}a=Math.max(a,2*Math.PI/this.m_maxSegmentsPerCurve);let o=a*r;return this.calculateLengthSubdivisionStep(e,o)}}xt(``)}calculateAngularSubdivisionStep(e,t){if(!e.isCurve())return 1;if(e.getGeometryType()===L.enumEllipticArc){let n=e;return n.isDegenerate(0)||n.isDegenerateToLine()?1:this.calculateLengthSubdivisionStep(e,t*n.getSemiMinorAxis())}xt(``)}rationalBezier2NeedsSplit(t,n,r,i){t.cutBezierIgnoreAttributes(r,i,n);let a=!1;if(this.m_maxLength>0&&n.calculateUpperLength2D()>this.m_maxLength)return a=!0,!0;let o=C(z,3);n.queryControlPoints(o);let s=[0,0,0];return n.queryWeights(s),!a&&this.m_maxDeviation>0&&(a=!e.checkRationalBezier2MaxDeviation(o,s,this.m_maxDeviation)),!a&&this.m_maxAngle>0&&(a=!e.checkRationalBezier2MaxAngle(o,s,this.m_cosMaxAngle)),a}bezier2NeedsSplit(t,n,r,i){t.cutBezierIgnoreAttributes(r,i,n);let a=!1;if(this.m_maxLength>0&&n.calculateUpperLength2D()>this.m_maxLength)return a=!0,!0;let o=C(z,3);return n.queryControlPoints(o),!a&&this.m_maxDeviation>0&&(a=!e.checkBezier2MaxDeviation(o,this.m_maxDeviation)),!a&&this.m_maxAngle>0&&(a=!e.checkBezier2MaxAngle(o,this.m_cosMaxAngle)),a}ellipticArcNeedsSplit(t,n,r,i){t.cutArcIgnoreAttributes(r,i,n);let a=!1;return this.m_maxLength>0&&n.calculateUpperLength2D()>this.m_maxLength?(a=!0,!0):(!a&&this.m_maxDeviation>0&&(a=!e.checkEllipticArcMaxDeviation(n,this.m_maxDeviation)),!a&&this.m_maxAngle>0&&(a=!e.checkEllipticArcMaxAngle(n,this.m_cosMaxAngle)),a)}bezierNeedsSplit(t){let n=!1;return this.m_maxLength>0&&z.distance(t[0],t[1])+z.distance(t[1],t[2])+z.distance(t[2],t[3])>this.m_maxLength?(n=!0,!0):(!n&&this.m_maxDeviation>0&&(n=!e.checkBezierMaxDeviation(t,this.m_maxDeviation)),!n&&this.m_maxAngle>0&&(n=!e.checkBezierMaxAngle(t,this.m_cosMaxAngle)),n)}progress_(){}static checkBezierMaxDeviation(e,t){let n=e[3].sub(e[0]);if(n.sqrLength()>0){let r=n.clone();r.leftPerpendicularThis(),r.normalize();let i=r.dotProduct(e[0].sub(e[1])),a=r.dotProduct(e[0].sub(e[2]));if(Math.max(Math.abs(i),Math.abs(a))<=t){let t=new z;ac(e,.5,t,!1);let r=t.sub(e[0]).dotProduct(n);return r>=0&&r<=n.sqrLength()}return!1}return Math.max(e[0].sub(e[1]).sqrLength(),e[0].sub(e[2]).sqrLength())<=t*t}static checkBezierMaxAngle(e,t){if(e[0].equals(e[3]))return!(!e[0].equals(e[1])||!e[1].equals(e[2]));let n=e[3].sub(e[0]);n.normalize();{let r=e[1].sub(e[0]),i=r.dotProduct(n);if(i<0||r.length()*t>i)return!1}{let r=e[2].sub(e[0]),i=r.dotProduct(n);if(i<0||r.length()*t>i)return!1}{let r=e[2].sub(e[1]),i=r.dotProduct(n);if(i<0||r.length()*t>i)return!1}return!0}static checkRationalBezier2MaxDeviation(e,t,n){if(t[1]===0)return!1;let r=e[2].sub(e[0]);if(r.sqrLength()>0){let t=r.clone();t.leftPerpendicularThis(),t.normalize();let i=t.dotProduct(e[0].sub(e[1]));if(Math.abs(i)<=n){let t=e[1].sub(e[0]).dotProduct(r);return t>=0&&t<=r.sqrLength()}return!1}return e[0].sub(e[1]).sqrLength()<=n*n}static checkRationalBezier2MaxAngle(e,t,n){if(t[1]===0)return!1;if(e[0].equals(e[2]))return!!e[0].equals(e[1]);let r=e[2].sub(e[0]);r.normalize();{let t=e[1].sub(e[0]),i=t.dotProduct(r);if(i<0||t.length()*n>i)return!1}return!0}static checkBezier2MaxDeviation(e,t){let n=e[2].sub(e[0]);if(n.sqrLength()>0){let r=n.clone();r.leftPerpendicularThis(),r.normalize();let i=r.dotProduct(e[0].sub(e[1]));if(Math.abs(i)<=t){let t=e[1].sub(e[0]).dotProduct(n);return t>=0&&t<=n.sqrLength()}return!1}return e[0].sub(e[1]).sqrLength()<=t*t}static checkBezier2MaxAngle(e,t){if(e[0].equals(e[2]))return!!e[0].equals(e[1]);let n=e[2].sub(e[0]);n.normalize();{let r=e[1].sub(e[0]),i=r.dotProduct(n);if(i<0||r.length()*t>i)return!1}return!0}static checkEllipticArcMaxDeviation(e,t){if(Math.abs(e.getSweepAngle())<Math.PI){let n=e.getEndXY().sub(e.getStartXY()),r=[0,0];if(jd(e,n,r)===1){let n=e.getCoord2D(r[0]),i=z.getClosestCoordinate(e.getStartXY(),e.getEndXY(),n),a=new z;return Ee(e.getStartXY(),e.getEndXY(),i,a),z.distance(n,a)<=t}}let n=e.getCoord2D(.5),r=new z;return Ee(e.getEndXY(),e.getStartXY(),.5,r),z.distance(n,r)<=t}static checkEllipticArcMaxAngle(e,t){let n=e.getTangent(0),r=e.getTangent(1),i=n.dotProduct(r);return!(i<0)&&!(n.length()*r.length()*t>i)}static checkTypeForReplace(e,t){return e.getGeometryType()===t&&(t!==L.enumEllipticArc||e.isCircular())}};function ku(e,t,n){let r=n.length;if(t<=0||r<=2)return r;let i=0,a=H(r-1,NaN);for(let t=1,o=r;t<o;t++){let r=e.tToLength(n[t]);a[t-1]=r-i,i=r}for(;a.length>1;){let e=a.findIndex(e=>e<=2*t);if(e===-1)break;let r=e+1,i=e+1;if(e>0){let t=e-1;(i===a.length||a[t]>a[i])&&(i=t,r--)}a[i]+=a[e],a.splice(e,1),n.splice(r,1)}return n.length}function Au(e,t,n,r,i,a,o,s){let c=t.clone();c.dropAllAttributes();let l=(e,t,n,r)=>(t&&(e&&t.push(r.getStartXY()),t.push(z.getNAN()),t.push(z.getNAN()),t.push(r.getEndXY())),n&&(e&&n.push(0),n.push(1)),1);if(c.isDegenerateToLine()||c.isDegenerate(0))return l(e,a,o,t);let u=c.getStartXY(),d=c.getEndXY(),f=c.getSemiAxes(),p=new At;if(c.isCircular())p.setIdentity();else{let e=c.getAxisXRotation();p.setScaleCoords(1,c.getMinorMajorRatio()),p.rotateAngle(e)}let m=c.getCenter();p.shift(m);let h=p.clone();h.invertThis(),c.applyTransformation(h);let g=c.getSweepAngle();if(g===0)return l(e,a,o,t);let _=G.constructEmpty();_.setCoords({center:m,width:2*f.x,height:2*f.x});let v=.05*_.calculateToleranceFromEnvelope(),y=4*(Math.max(n/f.x,v/f.x)/.0741)**(1/6);y=Math.min(y,Math.PI/2);let b=_u(c.getStartAngle()),x=g>0?Math.floor(b/y):Math.ceil(b/y);x*=y;let S=g>0?y:-y;x+S===b&&(x+=S);let w=4/3*Math.tan(Math.abs(y)/4);g>0&&(w=-w),o&&e&&o.push(0);let T=y/Math.abs(g),E=(x-b)/g,D=u.clone(),O=new z;c.queryCoord2D(0,O);let k=O.clone(),A=1-.01*T,j=0,M=0;for(;E<1;){let n;if(E+=T,M>0&&E<A)n=w;else{E>=A&&(E=1);let e=(E-M)*g;n=4/3*Math.tan(Math.abs(e)/4),g>0&&(n=-n)}c.queryCoord2D(E,O);let s=new z;p.queryTransform(O,s);let l=t.getClosestCoordinate(s,!1);if(t.queryCoord2D(l,s),E!==1&&(z.distance(D,s)<=2*r||z.distance(s,d)<=2*r))continue;D.setCoordsPoint2D(s);let f=C(z,4);f[0].assign(k),f[3].assign(O),f[1].rightPerpendicularOther(k),f[1].scaleAddThis(n,k),f[2].leftPerpendicularOther(O),f[2].scaleAddThis(n,O),p.transformPoints2D(f,3,f),f[3].assign(s),M===0&&f[0].setCoordsPoint2D(u),E===1&&f[3].setCoordsPoint2D(d),i&&ec(f);let m=!0;for(let e=1;e<4;e++)if(!f[e].isEqualPoint2D(f[0])){m=!1;break}m||(o&&o.push(l),a&&(M===0&&e&&a.push(f[0].clone()),a.push(f[1].clone()),a.push(f[2].clone()),a.push(f[3].clone())),j++),M=E,k.setCoordsPoint2D(O)}return j}function ju(e,t,n,r,i,a,o,s){t.clone().dropAllAttributes();let c=new G;t.queryLooseEnvelope(c);let l=.05*c.calculateToleranceFromEnvelope(),u=Math.max(n,l);o&&e&&o.push(0);let d=0,f=C(z,3);t.queryControlPoints(f);let p=[0,0,0];t.queryWeights(p);let m=[],h=H(9,NaN),g=0;i?(g=t.getMonotonicPartParams(h.length,h),h.length=g,g=ku(t,r,h)):(h.length=2,g=2,h[0]=0,h[1]=1);let _=0,v=e;for(let e=1;e<g;e++){let t=h[e];for(m.length=0,m.push(t),m.push(_);m.length>1;){let e=m.at(-1);m.pop();let t=m.at(-1),n=C(z,3),r=[0,0,0];Ll(f,p,e,t,n,r);let i=C(z,4),s=Rl(n,r,i),c=m.length>16;u>=s||c?(o.push(t),a&&(v&&=(a.push(i[0]),!1),a.push(i[1]),a.push(i[2]),a.push(i[3])),d++):(m.push(.5*(e+t)),m.push(e))}_=t}return d}function Mu(){return{e2:0,completeE:0}}var Nu=class{constructor(e,t){this.m_arc=e,this.m_sqrChordLength=t}getMaxDerivative(){return 1}getValue(e,t){return e===0?z.sqrDistance(this.m_arc.getCoord2D(t),this.m_arc.getCoord2D(1-t))-this.m_sqrChordLength:0}getError(e){return 0}};function Pu(e,t,n){if(td(e)){pi(new Z({start:e.getStartXY(),end:e.getEndXY()}),t,n);return}if(t.value()===0)n.set(e.getStartXY());else if(t.value()===1)n.set(e.getEndXY());else{let r=new P;Wu(e,t,r);let i=new P,a=new P;P.st_cosAndSin(r,i,a);let o=J.constructCoordsE(new P(e.m_semiMajorAxis).mulThisE(i),new P(e.m_semiMajorAxis).mulThis(e.m_minorMajorRatio).mulThisE(a)),s=new P(e.m_rotation);P.st_cosAndSin(s,i,a),o.rotateDirect(i,a),o.addThisE(J.constructPoint2D(e.m_center)),n.setE(o)}}function Fu(e,t){return e.convertToCanonic(t)}function Iu(e,t){let n=new I(e.getStartAngle(),e.getEndAngle());n.normalize();let r=tt(),i=We(t,r);if(i<n.vmin){let e=i+r;for(;e<n.vmin;)e+=r;return n.containsCoordinate(e)?e:n.vmin-i<e-n.vmax?i:e}if(i>n.vmax){let e=i-r;for(;e>n.vmax;)e-=r;return n.containsCoordinate(e)||n.vmin-e<i-n.vmax?e:i}return i}function Lu(e,t,n,r){let i=e.m_startAngle,a=e.m_sweepAngle,o=1e-12;for(;i>oe();)i-=2*oe();for(;i<=-oe();)i+=2*oe();if(!Number.isNaN(t)){for(;t>oe();)t-=2*oe();for(;t<=-oe();)t+=2*oe();!n&&t>i&&(t-=2*oe()),n&&t<i&&(t+=2*oe()),a=t-i,Math.abs(a)<o&&!r&&(a=n?2*oe():-2*oe()),Math.abs(a)>2*oe()-o&&r&&(a=0)}Math.abs(a)>2*oe()-o&&(a=a>=0?2*oe():-2*oe(),e.setEndXY(e.getStartXY())),Math.abs(a)<o&&(a=0,e.setEndXY(e.getStartXY())),r=Math.abs(a)<=oe(),a&&(n=a>0),e.m_startAngle=Ru(i),e.m_sweepAngle=a,fd(e,!r),ud(e,n)}function Ru(e){let t=e,n=!1;return t<=-oe()?(t+=tt(),n=!0):t>oe()&&(t-=tt(),n=!0),t<=-oe()?(t=We(t,tt()),t<=-oe()&&(t+=tt()),n=!0):t>oe()&&(t=We(t,tt()),t>oe()&&(t-=tt()),n=!0),n&&(t>oe()||t<=-oe())&&(t=oe()),t}function zu(e,t,n){let r=n,i=r.getSemiAxes(),a=new z(i.x*Math.cos(e[0]),i.y*Math.sin(e[0]));return a=r.convertFromCanonic(a),z.sqrDistance(a,r.getStartXY())}function Bu(e,t,n){let r=n,i=r.getSemiAxes(),a=e[0]+r.getStartAngle(),o=new z(i.x*Math.cos(a),i.y*Math.sin(a));return o=r.convertFromCanonic(o),z.sqrDistance(o,r.getEndXY())}function Vu(e){if(e.m_center.isNAN())return e.m_startAngle=0,void(e.m_sweepAngle=0);let t=e.getStartXY(),n=e.getEndXY(),r=t.equals(n),i=pd(e),a=dd(e),o=e.projectionBehavior();if(r){let n=e.convertToCanonic(t),r=new z(e.m_semiMajorAxis,e.m_semiMajorAxis*e.m_minorMajorRatio);n.x/=r.x,n.y/=r.y,e.m_startAngle=Ru(Math.atan2(n.y,n.x)),e.m_sweepAngle=i?a?tt():-tt():0}else{let r=e.convertToCanonic(t),s=new z(e.m_semiMajorAxis,e.m_semiMajorAxis*e.m_minorMajorRatio);r.x/=s.x,r.y/=s.y;let c=e.convertToCanonic(n);c.x/=s.x,c.y/=s.y,e.m_startAngle=Math.atan2(r.y,r.x),e.m_sweepAngle=z.calculateAngle(r,c),a?e.m_sweepAngle<0&&(e.m_sweepAngle+=tt()):e.m_sweepAngle>0&&(e.m_sweepAngle-=tt()),e.m_startAngle=Ru(e.m_startAngle);let l=zu([e.m_startAngle],1,e);if(l=Math.sqrt(l),l>.25*Wr(e)){let t=e.m_startAngle-1e-4,n=e.m_startAngle+1e-4,r=[0];Yi(zu,e,1,[e.m_startAngle],[t],[n],1e-14,r),e.m_startAngle=Ru(r[0])}if(l=Bu([e.m_sweepAngle],1,e),l=Math.sqrt(l),l>.25*Wr(e)){let t=e.m_sweepAngle-1e-4,n=e.m_sweepAngle+1e-4,r=[0];Yi(Bu,e,1,[e.m_sweepAngle],[t],[n],1e-14,r),e.m_sweepAngle=r[0]}let u=Math.abs(e.m_sweepAngle)>oe();if(fd(e,u),i!==u&&!i&&Math.abs(e.m_sweepAngle)>1.5*oe()||e.m_sweepAngle===0||a!==e.m_sweepAngle>0)return void ed(e,t,n,o)}}function Hu(e,t){return(Iu(e,t)-e.getStartAngle())/e.getSweepAngle()}function Uu(e,t){return e.m_startAngle+t*e.m_sweepAngle}function Wu(e,t,n){n.assign(new P(e.m_startAngle).addE(t.mulE(new P(e.m_sweepAngle))))}function Gu(e,t){let n=new P(e.m_cosr).sqrThis(),r=new P(e.m_sinr).sqrThis(),i=new P(e.m_minorMajorRatio),a=new P(1/e.m_minorMajorRatio),o=i.mulE(n).addThisE(a.mulE(r)),s=i.subE(a).mulThis(2*e.m_cosr*e.m_sinr),c=i.mulE(r).addThisE(a.mulE(n));t[0]=o,t[1]=s,t[2]=c,t[3]=new P(-e.m_semiMajorAxis).mulThis(e.m_semiMajorAxis).mulThis(e.m_minorMajorRatio)}function Ku(e,t){let n=new yr;n.a11.setE(e[0]),n.a12=P.st_mulByPower2(e[1],.5),n.a21.setE(n.a12),n.a22.setE(e[2]);let r=[z.getNAN(),z.getNAN()],i=[new P,new P];n.eigenSymmetric(i,r);let a=e[3].clone();return a.negateThis(),a.invThis(),i[0].mulThisE(a),i[1].mulThisE(a),i[0].sqrtThis().invThis(),i[1].sqrtThis().invThis(),t.x=i[0].toDouble(),t.y=i[1].toDouble(),Math.atan2(r[0].y,r[0].x)}function qu(e,t,n){if(td(e))return(n-t)*z.distance(e.getStartXY(),e.getEndXY());if(e.m_minorMajorRatio===1)return Math.abs(e.getSweepAngle()*(t-n))*e.m_semiMajorAxis;let r=nd(e,t);return nd(e,n)-r}function Ju(e){return e.m_cachedValues}function Yu(e){if(e.m_cachedValues)return e.m_cachedValues;let t=Mu();return t.e2=Qu(e),t.completeE=Ot(t.e2),e.m_cachedValues=t,t}function Xu(e,t,n,r){if(!t.isEqual(e.m_XStart,e.m_YStart)||!n.isEqual(e.m_XEnd,e.m_YEnd)){if(td(e))return e.m_XStart=t.x,e.m_YStart=t.y,e.m_XEnd=n.x,e.m_YEnd=n.y,wd(e),void e.afterCompletedModification();if(r&&Math.abs(e.getSweepAngle())<=1.01*p()){let r=C(z,3),i=vd(e,r);if(Ml(r)){if(r[0].assign(t),r[2].assign(n),Pl(r),e.projectionBehavior()===0){let t=0,n=2;z.sqrDistance(r[1],r[0])<z.sqrDistance(r[1],r[2])&&(n=W(t,t=n));let i=r[n].sub(r[t]),a=i.length();i.divThis(a);let o=r[1].sub(r[t]),s=o.length(),c=o.dotProduct(i)/s,l=o.crossProduct(i)/s,u=new z;Ee(r[t],r[n],.5,u);let d=.5*a/l*_e(1-c,0,1),f=r[1].side(r[t],r[n]),p=i.clone();f?p.leftPerpendicularThis():p.rightPerpendicularThis();let m=u.sub(p.mul(d));e.constructCircularArcThreePoint(r[0],r[2],m)}else yd(r,i*i,null,!1,e);return}}e.projectionBehavior()===0?Pd(e,t,n):Fd(e,t,n)}}function Zu(e,t,n){let r=e.projectionBehavior()===0;if(n<=2)return void ed(e,t[0],t[n-1],r?0:1);if(r){e.constructCircularArcThreePoint(t[0],t[n-1],t[Math.trunc(n/2)]);let r=new z;e.queryCoord2D(.5,r),e.m_interior.setCoordsPoint2D(r);return}let i=e.getSemiMajorAxis(),a=e.getMinorMajorRatio(),o=e.getAxisXRotation(),s=e.getCenter(),c=[,,,,];c[0]=e.isMajor(),c[1]=!c[0],c[2]=c[0],c[3]=!c[0];let l=[,,,,];l[0]=e.isClockwise(),l[1]=l[0],l[2]=!l[0],l[3]=!l[0];let u=Math.trunc(n<5?1:(n+4)/5),d=C(xu,4),f=H(4,NaN),p=0;for(let e=0;e<4;e++){d[e].constructEllipticArcEndPointsCenter(t[0],t[n-1],i,a,o,c[e],l[e],s),f[e]=0;let r=0;for(let i=u;i<n-1;i+=u){let n=d[e].getClosestCoordinate(t[i],!1);f[e]+=z.sqrDistance(d[e].getCoord2D(n),t[i]),r++}f[e]/=r,f[e]<f[p]&&(p=e)}e.assignCopy(d[p])}function Qu(e){return 1-Ct(e.m_minorMajorRatio)}function $u(e,t,n,r,i,a,o,s,c){return e.m_bits=0,e.m_rotation=a,Ar(e,t),Mr(e,n),e.m_cosr=Math.cos(a),e.m_sinr=Math.sin(a),fd(e,o),ud(e,s),c===void 0?e.m_center.setNAN():e.m_center.assign(c),e.setProjectionBehavior(1),e.m_semiMajorAxis=r,e.m_minorMajorRatio=i,_d(e,c===void 0)}function ed(e,t,n,r){e.m_bits=0,e.m_rotation=0,Ar(e,t),Mr(e,n),e.m_interior.assign(t.add(n).mul(.5)),e.m_startAngle=0,e.m_sweepAngle=0,e.m_cosr=1,e.m_sinr=0,fd(e,!1),ud(e,!1),e.m_center.setNAN(),e.m_semiMajorAxis=1,e.m_minorMajorRatio=0,e.setProjectionBehavior(r),e.afterCompletedModification()}function td(e){return e.m_center.isNAN()}function nd(e,t){if(t===0)return 0;let n=Yu(e),r=Uu(e,t),i=p(),a=id(e),o=Pe(r+i,n.e2,n.completeE),s=e.m_semiMajorAxis*(o-a);return Math.abs(s)}function rd(e,t){if(td(e)){let n=z.distance(e.getStartXY(),e.getEndXY());return n===0?0:t/n}if(e.m_minorMajorRatio===1){let n=Math.abs(e.getSweepAngle()*e.m_semiMajorAxis);return n===0?0:t/n}if(t===0)return 0;let n=e.getSweepAngle();if(n===0)return .5;let r=Yu(e),i=p(),a=id(e);n<0&&(t=-t);let o=t/e.m_semiMajorAxis+a,s=l(o,r.e2,r.completeE);return s-=i,s-=e.getStartAngle(),s/n}function id(e){let t=Yu(e);return Pe(e.getStartAngle()+p(),t.e2,t.completeE)}function ad(e,t,n,r,i){if(t.m_TransformationType===2)return void U(0);if(U(!hd(e)),t.isIdentity()&&(!r||r.equals(e.getStartXY())&&i.equals(e.getEndXY())))return;cd(e);let a=z.getNAN(),o=z.getNAN();if(r===null?(a.x=e.m_XStart,a.y=e.m_YStart,t.transformInPlace(a),o.x=e.m_XEnd,o.y=e.m_YEnd,t.transformInPlace(o)):(a=r,o=i),td(e))return e.m_XStart=a.x,e.m_YStart=a.y,e.m_XEnd=o.x,void(e.m_YEnd=o.y);let s=e.m_center.clone();if(t.transformInPlace(s),n||t.isUniformNoRotation()){let n=dd(e);if(t.isReflective()&&(n=!n),e.projectionBehavior()===0){if(!a.equals(o)){let n=e.m_interior.clone();t.transformInPlace(n),e.constructCircularArcThreePoint(a,o,n);return}od(e,a,o,s,n,!1);return}let r=new z(e.m_cosr,e.m_sinr);t.transformWithoutTranslateInPlace(r);let i=Math.atan2(r.y,r.x),c=e.getSemiAxes();t.transformWithoutTranslateInPlace(c);let l=e.m_center.clone();t.transformInPlace(l),e.constructEllipticArcEndPointsCenter(a,o,c.x,c.y/c.x,i,e.isMajor(),n,l);return}{{let n=[,,,,];Gu(e,n);let r=new yr;if(r.a11.setE(n[0]),r.a12.setE(n[1]),r.a12.mulThisByPower2(.5),r.a21.setE(r.a12),r.a22.setE(n[2]),!r.det().isZero()){let i=new yr;if(i.a11.set(t.xx),i.a12.set(t.xy),i.a21.set(t.yx),i.a22.set(t.yy),i.invertThis()){let c=i.clone();c.transposeThis();let l=r.clone();if(l.mulThis(i),l.mulLeftThis(c),!l.det().isZero()){let r=C(P,4);r[0].setE(l.a11),r[1].setE(l.a12),r[1].mulThisByPower2(2),r[2].setE(l.a22),r[3].setE(n[3]);let i=z.getNAN(),c=Ku(r,i),u=dd(e);t.isReflective()&&(u=!u),e.constructEllipticArcEndPointsCenter(a,o,i.x,i.y/i.x,c,e.isMajor(),u,s);return}}}}let n=[z.getNAN(),z.getNAN(),z.getNAN()];n[0].setCoords(e.getSemiMajorAxis(),0),n[0].rotateDirect(e.m_cosr,e.m_sinr),n[1].setCoords(e.getSemiMajorAxis(),e.getSemiMinorAxis()),n[1].rotateDirect(e.m_cosr,e.m_sinr),n[2].setCoords(0,e.getSemiMinorAxis()),n[2].rotateDirect(e.m_cosr,e.m_sinr);let r=e.isClockwise();r&&(n[2]=W(n[0],n[0]=n[2])),t.transformWithoutTranslateArray(n,3,n),t.isReflective()&&(r=!r);let i=new z(0,0),c=e.createInstance();yd(n,.5,i,!1,c),e.constructEllipticArcEndPointsCenter(a,o,c.getSemiMajorAxis(),c.getMinorMajorRatio(),c.getAxisXRotation(),e.isMajor(),!r,s)}}function od(e,t,n,r,i,a){let o=.5*(r.sub(t).length()+r.sub(n).length());e.m_center.assign(r),e.m_startAngle=Math.atan2(t.y-e.m_center.y,t.x-e.m_center.x),Lu(e,Math.atan2(n.y-e.m_center.y,n.x-e.m_center.x),i,a);let s=e.constructEllipticArcEndPointsCenter(t,n,o,1,0,Math.abs(e.m_sweepAngle)>Math.PI,e.m_sweepAngle>0,r);return e.setProjectionBehavior(0),s}function sd(e,t){e.m_cachedValues=t}function cd(e){e.m_cachedValues=null}function ld(e,t){t.m_cachedValues=W(e.m_cachedValues,e.m_cachedValues=t.m_cachedValues)}function ud(e,t){let n=t?1:0;e.m_bits=-2&e.m_bits|n}function dd(e){return!!(1&e.m_bits)}function fd(e,t){let n=t?1:0;e.m_bits=-3&e.m_bits|n<<1}function pd(e){return!!(2&e.m_bits)}function md(e){if(e.m_center.isNAN())return!1;let t=new J;t.setWithEps(e.getStartXY(),8),t.subThisE(new J().setWithEps(e.m_center,8));let n=new P;n.setWithEps(e.m_rotation,8);let r=new P,i=new P;P.st_cosAndSin(n,r,i),t.rotateReverse(r,i);let a=new J;a.setWithEps(e.getEndXY()),a.subThisE(J.constructPoint2D(e.m_center)),a.rotateReverse(r,i);let o=new P;o.setWithEps(e.m_semiMajorAxis,8);let s=o.clone(),c=new P;c.setWithEps(e.m_minorMajorRatio),s.mulThisE(c),t.x.divThisE(o),t.y.divThisE(s),a.x.divThisE(o),a.y.divThisE(s);let l=t.x.sqr().addThisE(t.y.sqr()).subThisE(pe),u=a.x.sqr().addThisE(a.y.sqr()).subThisE(pe);return!l.isZero()||!u.isZero()}function hd(e){return!!(8&e.m_bits)}function gd(e){e.m_bits&=-9}function _d(e,t){gd(e);let n=e.getStartXY(),r=e.getEndXY(),i=!1,a=pd(e),o=dd(e),s=e.projectionBehavior(),c=n.equals(r),l=e.m_minorMajorRatio===0||e.m_semiMajorAxis===0;if(Number.isNaN(e.m_minorMajorRatio)&&(e.m_semiMajorAxis===0?e.m_minorMajorRatio=1:Oe(`NAN minor major ratio and non-zero major axis`)),l||=t?c:e.m_center.isNAN(),l)return ed(e,n,r,s),!0;e.m_semiMajorAxis=Math.abs(e.m_semiMajorAxis),e.m_minorMajorRatio=Math.abs(e.m_minorMajorRatio),e.m_minorMajorRatio>1&&(e.m_semiMajorAxis*=e.m_minorMajorRatio,e.m_minorMajorRatio=1/e.m_minorMajorRatio);let u=new z(e.m_semiMajorAxis,e.m_semiMajorAxis*e.m_minorMajorRatio);if(U(u.y>0&&u.x>=u.y),c){let t=e.convertToCanonic(n);U(!u.isZero()),t.x/=u.x,t.y/=u.y;let r=Math.sqrt(Ct(t.x)+Ct(t.y));if(i=r!==1,e.m_semiMajorAxis*=r,u.mulThis(r),e.m_startAngle=Ru(Math.atan2(t.y,t.x)),!a)return e.m_interior.assign(n),e.m_sweepAngle=0,e.afterCompletedModification(),i;e.m_sweepAngle=o?tt():-tt()}else{let t=e.m_center.isNAN()||md(e);if(!t){let i=e.convertToCanonic(n);i.x/=u.x,i.y/=u.y;let a=new z(1,0);e.m_startAngle=z.calculateAngle(a,i);let o=e.convertToCanonic(r);o.x/=u.x,o.y/=u.y,e.m_sweepAngle=z.calculateAngle(i,o),t=!xd(e)}if(t){i=!0;let t=n.sub(r).mulThis(.5);t.rotateReverse(e.m_cosr,e.m_sinr);let s=Ct(t.x/u.x)+Ct(t.y/u.y);s>1&&(s=Math.sqrt(s),e.m_semiMajorAxis*=s,u.mulThis(s));let c=new z(0,0);{let e=u.x*u.x,n=u.y*u.y,r=e*t.y*t.y+n*t.x*t.x,i=e*n-r;if(i>0){let e=Math.sqrt(i/r);c.setCoords(u.x*t.y/u.y,-u.y*t.x/u.x),c.mulThis(e),a===o&&c.negateThis()}}{let t=new z(c.x,c.y);t.rotateDirect(e.m_cosr,e.m_sinr),t.addThis(n.add(r).mulThis(.5)),e.m_center.assign(t)}}if(Vu(e),!xd(e))return ed(e,n,r,s),!0}return wd(e),e.afterCompletedModification(),i}function vd(e,t){U(Math.abs(e.getSweepAngle())<15*Math.PI/16);let n=e.getSemiMajorAxis(),r=e.getSemiMinorAxis(),i;if(n===0)return t[0].setCoordsPoint2D(e.getStartXY()),t[1].setCoordsPoint2D(e.getStartXY()),t[2].setCoordsPoint2D(e.getStartXY()),i=1,i;if(r===0)return t[0].setCoordsPoint2D(e.getStartXY()),t[2].setCoordsPoint2D(e.getEndXY()),t[1]=z.lerp(t[0],t[2],.5),i=1,i;let a=e.getSweepAngle(),o=e.getStartAngle(),s=o+a,c=new z(-n*Math.sin(o),r*Math.cos(o)),l=new z(-n*Math.sin(s),r*Math.cos(s));c.normalize(),l.normalize(),c.rotateDirect(e.m_cosr,e.m_sinr),l.rotateDirect(e.m_cosr,e.m_sinr),t[0].setCoordsPoint2D(e.getStartXY()),t[2].setCoordsPoint2D(e.getEndXY()),t[1].setSub(t[2],t[0]);let u=c.crossProduct(l);return t[1].assign(c.mul(t[1].crossProduct(l)/u)),t[1].addThis(t[0]),i=Math.cos(.5*a),i}function yd(e,t,n,r,i){if(r){let n=.5,r=Math.sqrt(t),a=Ct(1-n)+2*r*n*(1-n)+Ct(n),o=e[0].mul(Ct(1-n)).add(e[1].mul(2*r*n*(1-n))).add(e[2].mul(Ct(n))).divThis(a);return i.constructCircularArcThreePoint(e[0],e[2],o),!0}let a=e[0].sub(e[1]),o=e[2].sub(e[1]),s=a.crossProduct(o),c=a.dotProduct(o),l=t;U(l<=1),U(l>0);let u=.5/(1-l),d=a.sqrLength(),f=c,p=o.sqrLength(),m=Ct(s),h=a.sub(o).sqrLength();if(m===0||c<=-Math.sqrt(d)*Math.sqrt(p))return ed(i,e[0],e[2],1),!1;let g=[0,0],_=new I;_.setInfinite();let v=qi(2*m,-(h/l+4*f),2*(1-l)/l,_,!1,g);if(v===0)return ed(i,e[0],e[2],1),!1;v===1&&(g[1]=g[0]);let y=Math.sqrt(u/g[0]),b=Math.sqrt(u/g[1]),x=.5/l,S=x-p*g[0],C=x-d*g[0];Math.abs(S)>Math.abs(C)?C=f*g[0]-x+1:S=f*g[0]-x+1;let w=a.mul(S).add(o.mul(C)),T=w.norm(1)<1e-15*y?0:Math.atan2(w.y,w.x)+Math.PI,E=a.add(o),D=n?n.clone():e[1].add(E.mul(u)),O=e[0].sub(D),k=e[2].sub(D),A=O.crossProduct(k)<0;return new xu,i.constructEllipticArcEndPointsCenter(e[0],e[2],y,b/y,T,!1,!A,D)}function bd(e,t,n,r,i){return yd(e,t,n,r,i)}function xd(e){let t=Wr(e),n=!1;{let r=new z(e.m_semiMajorAxis*Math.cos(e.m_startAngle),e.getSemiMinorAxis()*Math.sin(e.m_startAngle));r.rotateDirect(e.m_cosr,e.m_sinr),r.addThis(e.m_center),n=z.distance(e.getStartXY(),r)>t}let r=!1;if(!n){let n=new z(e.m_semiMajorAxis*Math.cos(e.m_startAngle+e.m_sweepAngle),e.getSemiMinorAxis()*Math.sin(e.m_startAngle+e.m_sweepAngle));n.rotateDirect(e.m_cosr,e.m_sinr),n.addThis(e.m_center),r=z.distance(e.getEndXY(),n)>t}return!n&&!r}function Sd(e,t,n,r){n===0&&R(`construct_enclosing_circle`);let i=[0,0,0],a=Su(t,n,i);if(a===1)e.constructCircleRadius(0,t[i[0]],r);else if(a===2){let n=z.lerp(t[i[0]],t[i[1]],.5),a=z.distance(t[i[0]],n),o=z.distance(t[i[1]],n);e.constructCircleRadius(Math.max(a,o),n,r)}else if(a===3){let n=z.calculateCircleCenterFromThreePoints(t[i[0]],t[i[1]],t[i[2]]),a=z.distance(t[i[0]],n),o=z.distance(t[i[1]],n),s=z.distance(t[i[2]],n);e.constructCircleRadius(Math.max(a,o,s),n,r)}else B(`unexpected`)}function Cd(e){if(td(e)||e.isDegenerate(0))return 0;let t=e.m_semiMajorAxis,n=e.getSemiMinorAxis(),r=t*t+n*n,i=e.getStartAngle(),a=e.getEndAngle(),o=e.m_center.y-e.m_YStart,s=e.m_cosr,c=e.m_sinr,l=1,u=0;e.m_rotation&&(l=(s-c)*(s+c),u=2*s*c);let d=((-.5*(a-i)+.25*l*(2*Math.cos(a+i)*Math.sin(a-i)))*n+-2*Math.sin(.5*(a+i))*Math.sin(.5*(a-i))*s*o)*t/r,f=0;return e.m_rotation&&(f=.125*(-2*Math.sin(a+i)*Math.sin(a-i))*u-n*o/r*(2*Math.cos(.5*(a+i))*Math.sin(.5*(a-i)))*c),r*(d+f)+-.5*(e.m_XEnd-e.m_XStart)*(e.m_YEnd-e.m_YStart)}function wd(e){e.queryCoord2D(.5,e.m_interior)}function Td(e,t,n,r,i){if(i){if(Rd(t,n)!==0)return 2}else if(wr(t,n))return 1;return Dd(e,t,n,null,null,null,r,i!==void 0&&i,!0,!1)===0?0:4}function Ed(e,t,n,r,i){if(i){if(Rd(t,n)!==0)return 2}else if(wr(t,n))return 1;return Od(e,t,n,null,null,null,r,i!==void 0&&i,!0,!1)===0?0:4}function Dd(e,t,n,r,i,a,o,s,c,l){if(td(t))return vi(new Z({start:t.getStartXY(),end:t.getEndXY()}),n,r,i,a,o,s,l);i!==null&&(i.length=0),a!==null&&(a.length=0),r!==null&&(r.length=0);let u=Gr(t,n);if(Kr(t,n,o=Math.max(u,o)))return 0;let d=n.getStartXY();d.subThis(t.m_center);let f=n.getEndXY();f.subThis(t.m_center),d.rotateReverse(t.m_cosr,t.m_sinr),f.rotateReverse(t.m_cosr,t.m_sinr);let p=f.clone();p.subThis(d);let m=t.m_semiMajorAxis,h=1/m,g=t.getSemiMinorAxis(),_=1/g,v=p.clone();v.leftPerpendicularThis();let y=Math.atan2(g*v.y,m*v.x),b=H(16,NaN),x=H(16,NaN),S=0,C=[y,y+Math.PI];for(let e=0;e<2;++e){let r=Hu(t,C[e]);if(r>=0&&r<=1){b[S]=r;let e=t.getCoord2D(b[S]);x[S]=n.getClosestCoordinate(e,!1),z.distance(e,n.getCoord2D(x[S]))<=o&&S++}}let w=d.x*h,T=d.y*_,E=p.x*h,D=p.y*_,O=qi(E*E+D*D,2*(w*E+T*D),w*w+T*T-1,I.unit(),!1,x);U(O>=0);for(let e=0;e<O;e++){let r=p.mul(x[e]).add(d);r.x*=h,r.y*=_;let i=Hu(t,Math.atan2(r.y,r.x));if(i>=0&&i<=1){b[S]=i;let e=t.getCoord2D(i);x[S]=n.getClosestCoordinate(e,!1),z.distance(e,n.getCoord2D(x[S]))<=o&&S++}}U(S<b.length+4);let k=H(16,NaN);O=t.intersectPoint(n.getStartXY(),k,o);for(let e=0;e<O;e++,S++)b[S]=k[e],x[S]=0;O=t.intersectPoint(n.getEndXY(),k,o);for(let e=0;e<O;e++,S++)b[S]=k[e],x[S]=1;O=n.intersectPoint(t.getStartXY(),k,o);for(let e=0;e<O;e++,S++)b[S]=0,x[S]=k[e];O=n.intersectPoint(t.getEndXY(),k,o);for(let e=0;e<O;e++,S++)b[S]=1,x[S]=k[e];return S===0?0:Ud(e,t,n,b,x,S,r,i,a,o,s,c,l)}function Od(e,t,n,r,i,a,o,s,c,l){if(td(t)){let l=new Z({start:t.getStartXY(),end:t.getEndXY()});return Dd(e,n,l,r,a,i,o,s,c,!0)}if(td(n)){let u=new Z({start:n.getStartXY(),end:n.getEndXY()});return Dd(e,t,u,r,i,a,o,s,c,l)}let u=Gr(t,n);o=Math.max(o,u);let d=!1;{let e=t.getSemiAxes(),r=t.getCenter(),l=n.getSemiAxes(),u=n.getCenter(),f=z.distance(u,r),p=e.x+l.x;if(f>p+o)return 0;if(e.y>l.x){if(f+l.x+o<e.y)return 0}else if(l.y>e.x&&f+e.x+o<l.y)return 0;if(c&&!s){let r=t.m_minorMajorRatio===1&&t.isClosed()&&t.isMajor(),o=n.m_minorMajorRatio===1&&n.isClosed()&&n.isMajor();if(r&&o&&(d=!0,f<=p)&&Math.max(e.x,l.x)<=Math.min(e.x,l.x)+f)return U(!i&&!a),1}}if(!d&&Kr(t,n,o))return 0;let f=[],p=[],m=Du(t,0,0,!1,!1,f,p,null),h=[],g=[],_=Du(n,0,0,!1,!1,h,g,null);if(m===1&&_===1){let e=new ha({points:f,weights:p}),u=new ha({points:h,weights:g}),d=[],m=[],_=Kl(!1,e,u,r,i===null?null:d,a===null?null:m,o,s,c,l);if(_>0&&i!==null||a!==null){i&&(i.length=0),a&&(a.length=0);for(let r=0;r<_;++r){if(i)if(re(d[r],0,1))i.push(d[r]);else{let n=e.tToLength(d[r]),a=t.lengthToT(n);i.push(a)}if(a)if(re(m[r],0,1))a.push(m[r]);else{let e=u.tToLength(m[r]),t=n.lengthToT(e);a.push(t)}}}return _}let v=[],y=[],b=0,x=c&&!s;for(let e=0;e<m;e++){let r=new ha({points:f.slice(2*e,2*e+3),weights:p.slice(2*e,2*e+3)}),i=0;for(let a=0;a<_;a++){y.length<=a&&y.push(new ha({points:h.slice(2*a,2*a+3),weights:g.slice(2*a,2*a+3)}));let s=[],c=[],l=x?null:s,u=x?null:c,d=Kl(!1,r,y[a],null,l,u,o,!1,x,!1);if(d>0&&x)return 1;for(let o=0;o<d;++o){if(s[o]===0&&e===0)s[o]=0;else if(s[o]===1&&e===m-1)s[o]=1;else{let e=r.tToLength(s[o])+b;s[o]=t.lengthToT(e)}if(c[o]===0&&a===0)c[o]=0;else if(c[o]===1&&a===_-1)c[o]=1;else{let e=y[a].tToLength(c[o])+i;c[o]=n.lengthToT(e)}v.push(lt(s[o],c[o]))}i+=y[a].calculateLength2D()}b+=r.calculateLength2D()}if(v.length===0)return 0;if(s&&(v=v.filter(e=>!re(e.first,0,1)||!re(e.second,0,1)||!t.getCoord2D(e.first).equals(n.getCoord2D(e.second)))),c)return v.length;let S=[],C=[];for(let e of v)S.push(e.first),C.push(e.second);return Ud(e,t,n,S,C,S.length,r,i,a,o,s,c,l)}function kd(e,t,n){if(n.setCoords(e.getCoord2D(t.vmin)),n.mergeNe(e.getCoord2D(t.vmax)),td(e))return;let r=e.getSemiAxes(),i=[0,0,0,0];{let t=Math.atan2(-r.y*e.m_sinr,r.x*e.m_cosr),n=t+Math.PI,a=Math.atan2(r.y*e.m_cosr,r.x*e.m_sinr),o=a+Math.PI;i[0]=Hu(e,t),i[1]=Hu(e,n),i[2]=Hu(e,a),i[3]=Hu(e,o)}let a=new z;for(let r=0;r<4;r++){let o=i[r];t.containsExclusiveCoordinate(o)&&(e.queryCoord2D(o,a),n.mergeNe(a))}}function Ad(e,t,n,r,i){if(e.m_semiMajorAxis===0)return n.vmin;let a=z.getNAN();e.queryCoord2D(n.vmin,a);let o=z.getNAN();if(e.queryCoord2D(n.vmax,o),td(e))return new Z({start:a,end:o}).getClosestCoordinate(t,r);let s=Fu(e,t);if(a=Fu(e,a),o=Fu(e,o),e.m_minorMajorRatio===1){if(s.isEqual(0,0))return n.vmin;let t=Hu(e,Math.atan2(s.y,s.x));return r||n.containsCoordinate(t)?t:z.distance(s,a)<=z.distance(s,o)?n.vmin:n.vmax}let c=e.getSemiMajorAxis(),l=e.getSemiMinorAxis(),u=(c-l)*(c+l),d=Ct(u),f=s.x,p=s.y,m=Ct(l*p),h=l*u*p*2,g=[new P(m),new P(h),new P(d-Ct(c*f)-m),new P(-h),new P(-d)],_=C(P,4),y=aa(g,4,new I(-1,1),!1,_,4),b=n.vmin,x=z.sqrDistance(s,a);{let e=z.sqrDistance(s,o);e<x&&(b=n.vmax,x=e)}U(!r);let S=H(8,NaN);for(let t=0;t<y;++t){let n=_[t].value(),r=Math.sqrt(1-n*n),i=Math.atan2(n,r),a=Math.atan2(n,-r);S[2*t]=Hu(e,i),S[2*t+1]=Hu(e,a)}S=S.slice(0,2*y),v(S);for(let r=0,i=2*y;r<i;++r)if(S[r]>n.vmin&&S[r]<n.vmax){let n=z.sqrDistance(t,e.getCoord2D(S[r]));x>n&&(x=n,b=S[r])}return b}function jd(e,t,n){U(!td(e));let r=new At;r.setRotateAngle(-e.getAxisXRotation());let i=new z;r.queryTransform(t,i);let a=Math.atan2(-i.x*e.getMinorMajorRatio(),i.y),o=a+oe(),s=Hu(e,a),c=Hu(e,o);c<s&&(c=W(s,s=c));let l=0;return s>=0&&s<=1&&(n[l++]=s),c>=0&&c<=1&&(n[l++]=c),l}function Md(e,t,n){return e.m_semiMajorAxis===t.m_semiMajorAxis&&e.isMajor()!==t.isMajor()&&!!e.m_center.equals(t.m_center)&&e.m_sinr===t.m_sinr&&e.m_cosr===t.m_cosr&&e.m_minorMajorRatio===t.m_minorMajorRatio&&(n?e.isClockwise()!==t.isClockwise():e.isClockwise()===t.isClockwise())}function Nd(e,t,n){if(td(e))n.setE(J.constructPoint2D(e.getEndXY()).subE(J.constructPoint2D(e.getStartXY())));else{let r=new P;Wu(e,t,r);let i=new J;if(i.setCoordsE(new P(e.m_semiMajorAxis).negate().mulE(new P().setSin(r)),new P(e.getSemiMinorAxis()).mulE(new P().setCos(r))),e.m_rotation){let t=new P(e.m_rotation);i.rotateDirect(new P().setCos(t),new P().setSin(t))}i.scaleThis(new P(e.getSweepAngle())),n.setE(i)}}function Pd(e,t,n,r){let i=e.getStartXY(),a=e.getEndXY(),o=i.equals(a),s=t.equals(n);if(!o&&!s){let r=new At;r.setShiftCoords(-e.m_XStart,-e.m_YStart);let o=z.distance(t,n),s=z.distance(i,a),c=o/s;r.scale(c,c);let l=a.sub(i);l.divThis(s);let u=n.sub(t);u.divThis(o);let d=l.crossProduct(u),f=u.dotProduct(l);r.rotate(f,d),r.shiftCoords(t.x,t.y),ad(e,r,!0,t,n);return}let c=new z;if(e.queryCoord2D(.5,c),s){if(o){let r=e.m_center.add(t.sub(i));e.constructEllipticArcEndPointsCenter(t,n,e.getSemiMajorAxis(),1,0,!0,!e.isClockwise(),r),e.setProjectionBehavior(0)}else if(e.isMajor()){let r=c.sub(t).getUnitVector().mul(2*e.getSemiMajorAxis()).add(t);e.constructCircularArcThreePoint(t,n,r)}else e.constructCircularArcThreePoint(t,n,t);return}let l=t.add(n).mul(.5),u=n.sub(t);u.rightPerpendicularThis();let d=l.add(u),f=z.getClosestCoordinate(l,d,e.getCenter(),!0),p=new z;Ee(l,d,f,p);let m=z.distance(t,p);e.constructEllipticArcEndPointsCenter(t,n,m,1,0,!0,!e.isClockwise(),p),e.setProjectionBehavior(0)}function Fd(e,t,n,r){let i=e.getStartXY(),a=e.getEndXY(),o=i.equals(a),s=t.equals(n);if(!o&&!s){let r=new At;r.initializeFromTwoPoints(i,a,t,n),ad(e,r,!0,t,n),e.endPointModified(),e.normalizeAfterEndpointChange();return}if(!e.isMajor())return void ed(e,t,n,1);if(o&&s){let r=e.m_center.add(t.sub(i));e.constructEllipticArcEndPointsCenter(t,n,e.getSemiMajorAxis(),e.getMinorMajorRatio(),e.getAxisXRotation(),!0,!e.isClockwise(),r);return}if(!o){let r=.5*(tt()-Math.abs(e.getSweepAngle())),i=(e.getSweepAngle()+r*Ye(e.getSweepAngle()))/e.getSweepAngle(),a=new z;e.queryCoord2D(i,a),e.constructEllipticArcEndPointsCenter(a,a,e.getSemiMajorAxis(),e.getMinorMajorRatio(),e.getAxisXRotation(),!0,!e.isClockwise(),e.getCenter());let o=e.getCenter().add(t.sub(a));e.constructEllipticArcEndPointsCenter(t,n,e.getSemiMajorAxis(),e.getMinorMajorRatio(),e.getAxisXRotation(),!0,!e.isClockwise(),o);return}let c=z.sqrDistance(t,n),l=.25,u=.75;if(c<z.sqrDistance(e.getCoord2D(.25),e.getCoord2D(.75))){let t=[0],n=Gi(new Nu(e,c),I.construct(0,.25),1,t);n>0&&(U(n===1),l=t[0],u=1-t[0])}let d=e.getCoord2D(l),f=e.getCoord2D(u);U(!d.equals(f)),e.constructEllipticArcEndPointsCenter(d,f,e.getSemiMajorAxis(),e.getMinorMajorRatio(),e.getAxisXRotation(),!0,!e.isClockwise(),e.m_center),Fd(e,t,n)}function Id(e,t,n,r,i){return Ld(e,!1,t,n,r,i)}function Ld(e,t,n,r,i,a){let o=n.getGeometryType(),s=r.getGeometryType(),c=Math.max(i,Gr(n,r));if(o===L.enumLine&&s===L.enumLine)return _i(n,r,c,a);let l=n,u=r,d=n.getStartXY(),f=n.getEndXY();if(d.compare(f)>0&&(l=n.clone().reverse()),d=r.getStartXY(),f=r.getEndXY(),d.compare(f)>0&&(u=r.clone().reverse()),t){if(n.equals(r))return 2;if(kr(n,r,c))return 4}switch(o){case L.enumLine:switch(s){case L.enumEllipticArc:return Td(e,u,l,c,a);case L.enumBezier:return dc(e,u,l,c,a);case L.enumRationalBezier2:return Bl(e,u,l,c,a);case L.enumBezier2:return wo(e,u,l,c,a);default:B(``)}break;case L.enumEllipticArc:switch(s){case L.enumLine:return Td(e,l,u,c,a);case L.enumEllipticArc:return Ed(e,l,u,c,a);case L.enumBezier:return fc(e,u,l,c,a);case L.enumRationalBezier2:return Vl(e,u,l,c,a);case L.enumBezier2:return To(e,u,l,c,a);default:B(``)}break;case L.enumBezier:switch(s){case L.enumLine:return dc(e,l,u,c,a);case L.enumEllipticArc:return fc(e,l,u,c,a);case L.enumBezier:return pc(e,l,u,c,a);case L.enumRationalBezier2:return mc(e,l,u,c,a);case L.enumBezier2:return hc(e,l,u,c,a);default:B(``)}break;case L.enumRationalBezier2:switch(s){case L.enumLine:return Bl(e,l,u,c,a);case L.enumEllipticArc:return Vl(e,l,u,c,a);case L.enumBezier:return mc(e,u,l,c,a);case L.enumRationalBezier2:return Hl(e,l,u,c,a);case L.enumBezier2:return Ul(e,l,u,c,a);default:B(``)}break;case L.enumBezier2:switch(s){case L.enumLine:return wo(e,l,u,c,a);case L.enumEllipticArc:return To(e,l,u,c,a);case L.enumBezier:return hc(e,u,l,c,a);case L.enumRationalBezier2:return Ul(e,u,l,c,a);case L.enumBezier2:return Eo(e,l,u,c,a);default:B(``)}break;default:B(``)}}function Rd(e,t,n=!0){if(!n&&!zd(e,t))return 0;let r=e.isLine()&&t.isLine();if(e.getStartXY().equals(t.getStartXY())&&e.getEndXY().equals(t.getEndXY())){if(r)return 1;let n=e.getGeometryType();if(n!==t.getGeometryType())return 0;if(n===L.enumBezier){let n=e,r=t;return n.getControlPoint1().equals(r.getControlPoint1())&&n.getControlPoint2().equals(r.getControlPoint2())?1:0}if(n===L.enumEllipticArc)return Md(e,t,!1)?1:0;if(n===L.enumRationalBezier2){let n=e,r=t;if(n.getControlPoint1().equals(r.getControlPoint1())&&n.getStandardFormWeight()===r.getStandardFormWeight())return 1}else if(n===L.enumBezier2){let n=t;if(e.getControlPoint1().equals(n.getControlPoint1()))return 1}return 0}if(e.getStartXY().equals(t.getEndXY())&&e.getEndXY().equals(t.getStartXY())){if(r)return-1;let n=e.getGeometryType();if(n!==t.getGeometryType())return 0;if(n===L.enumBezier){let n=e,r=t;return n.getControlPoint1().equals(r.getControlPoint2())&&n.getControlPoint2().equals(r.getControlPoint1())?-1:0}if(n===L.enumEllipticArc)return Md(e,t,!0),-1;if(n===L.enumRationalBezier2){let n=e,r=t;if(n.getControlPoint1().equals(r.getControlPoint1())&&n.getStandardFormWeight()===r.getStandardFormWeight())return-1}else if(n===L.enumBezier2){let n=t;if(e.getControlPoint1().equals(n.getControlPoint1()))return-1}return 0}return 0}function zd(e,t){let n=e.getGeometryType();return n===t.getGeometryType()&&(n!==L.enumEllipticArc||e.projectionBehavior()===t.projectionBehavior())}function Bd(e,t,n,r,i,a,o){!i&&a&&R(``);let s=t.getGeometryType(),c=n.getGeometryType(),l=Math.max(o,Gr(t,n));if(r&&(r.length=0),i&&(i.length=0),a&&(a.length=0),s===L.enumLine&&c===L.enumLine)return vi(t,n,r,i,a,l,!1,!1);let u=t,d=n,f=t.getStartXY(),p=t.getEndXY(),m=!1,h=!1;f.compare(p)>0&&(u=t.clone(!0).reverse(),m=!0),f=n.getStartXY(),p=n.getEndXY(),f.compare(p)>0&&(d=n.clone(!0).reverse(),h=!0);let g=0;switch(s){case L.enumLine:switch(c){case L.enumEllipticArc:g=Dd(e,d,u,r,a,i,l,!1,!1,!0);break;case L.enumBezier:g=gc(e,d,u,r,a,i,l,!1,!1,!0);break;case L.enumRationalBezier2:g=Wl(e,d,u,r,a,i,l,!1,!1,!0);break;case L.enumBezier2:g=Do(e,d,u,r,a,i,l,!1,!1,!0);break;default:B(``)}break;case L.enumEllipticArc:switch(c){case L.enumLine:g=Dd(e,u,d,r,i,a,l,!1,!1,!1);break;case L.enumEllipticArc:g=Od(e,u,d,r,i,a,l,!1,!1,!1);break;case L.enumBezier:g=_c(e,d,u,r,a,i,l,!1,!1,!0);break;case L.enumRationalBezier2:g=Gl(e,d,u,r,a,i,l,!1,!1,!0);break;case L.enumBezier2:g=Oo(e,d,u,r,a,i,l,!1,!1,!0);break;default:B(``)}break;case L.enumRationalBezier2:switch(c){case L.enumLine:g=Wl(e,u,d,r,i,a,l,!1,!1,!1);break;case L.enumEllipticArc:g=Gl(e,u,d,r,i,a,l,!1,!1,!1);break;case L.enumBezier:g=yc(e,d,u,r,a,i,l,!1,!1,!0);break;case L.enumRationalBezier2:g=Kl(e,u,d,r,i,a,l,!1,!1,!1);break;case L.enumBezier2:g=ql(e,u,d,r,i,a,l,!1,!1,!1);break;default:B(``)}break;case L.enumBezier2:switch(c){case L.enumLine:g=Do(e,u,d,r,i,a,l,!1,!1,!1);break;case L.enumEllipticArc:g=Oo(e,u,d,r,i,a,l,!1,!1,!1);break;case L.enumBezier:g=bc(e,d,u,r,a,i,l,!1,!1,!0);break;case L.enumRationalBezier2:g=ql(e,d,u,r,a,i,l,!1,!1,!0);break;case L.enumBezier2:g=ko(e,u,d,r,i,a,l,!1,!1,!1);break;default:B(``)}break;case L.enumBezier:switch(c){case L.enumLine:g=gc(e,u,d,r,i,a,l,!1,!1,!1);break;case L.enumEllipticArc:g=_c(e,u,d,r,i,a,l,!1,!1,!1);break;case L.enumBezier:g=vc(e,u,d,r,i,a,l,!1,!1,!1);break;case L.enumRationalBezier2:g=yc(e,u,d,r,i,a,l,!1,!1,!1);break;case L.enumBezier2:g=bc(e,u,d,r,i,a,l,!1,!1,!1);break;default:B(``)}break;default:B(``)}if(m){if(i){for(let e=0;e<g;e++)i[e]=1-i[e];i.reverse()}r&&r.reverse(),a&&a.reverse()}if(h&&a)for(let e=0;e<g;e++)a[e]=1-a[e];return g}function Vd(e,t,n){return t===n?0:(t>n&&(n=W(t,t=n)),e.cut(t,n,!0).calculateUpperLength2D())}function Hd(e,t,n,r,i){let a=[],o=[],s=[];for(let c=0,l=i;c<l;c++)a.push(e.calculateSubLengthFromStart(n[c])),o.push(t.calculateSubLengthFromStart(r[c])),re(n[c],0,1)&&re(r[c],0,1)&&e.getCoord2D(n[c]).equals(t.getCoord2D(r[c]))&&s.push(c);if(s.length===0||s.length===i)return;s.sort((e,t)=>n[e]<n[t]?-1:n[e]>n[t]?1:r[e]<r[t]?-1:r[e]>r[t]?1:0);let c=-1;for(let l of s){if(c>=0&&n[l]===n[c]&&n[l]===n[c]){c=l;continue}c=l;let s=[];s.length=i;for(let e=0;e<s.length;++e)s[e]=e;s.sort((e,t)=>{let n=a[l],r=o[l],i=a[e]-n,s=o[e]-r,c=i*i+s*s,u=a[t]-n,d=o[t]-r,f=u*u+d*d;return c<f?-1:c>f?1:0});for(let a=0;a<i;a++){let i=s[a];if(i===l||n[i]===n[l]&&r[i]===r[l]||re(n[i],0,1)&&re(r[i],0,1))continue;let o=(n,r,i,a)=>{let o=new J,s=new P;s.setWithEps(1);let c=new P;c.set(r,s.eps()),e.queryCoord2DE(c,o);let l=new J;e.queryCoord2DE(new P(n),l);let u=!1;return o.eq(l)&&(c.set(a,s.eps()),t.queryCoord2DE(c,o),t.queryCoord2DE(new P(i),l),u=o.eq(l)),!u},c=z.getNAN();e.queryCoord2D(n[i],c);let u=z.getNAN();if(t.queryCoord2D(r[i],u),z.distance(c,u)===0&&o(n[l],n[i],r[l],r[i]))break;let d=new I(r[i],r[l]);d.normalizeNoNAN();let f=new I(n[i],n[l]);f.normalizeNoNAN();let p=-1,m=1/0,h=1/0,g=n[i];c.assign(e.getCoord2D(g));for(let a=0;a<5;a++){let a=t.getClosestCoordinateOnInterval(c,d,-1);u.assign(t.getCoord2D(a));let s=z.distance(c,u);if(g=e.getClosestCoordinateOnInterval(u,f,-1),g===n[l]&&a===r[l]){p=1;break}c.assign(e.getCoord2D(g));let _=z.distance(u,c);if(!(_<h&&s<m)){p=0;break}if(_===0&&s===0){o(n[l],n[i],r[l],r[i])?(n[i]=g,r[i]=a,p=0):p=1;break}h=_,m=s}if(p===-1&&(p=re(n[i],0,1)||re(r[i],0,1)?0:1),p!==1)break;n[i]=n[l],r[i]=r[l]}}}function Ud(e,t,n,r,i,a,o,s,l,u,d,f,p){if(!a)return 0;let m=(e,t)=>{for(let n=0;n<a;++n){let r=t[n];if(re(r,0,1)){r=dt(r);continue}let i=e.getCoord2D(r);r<.5?i.equals(e.getStartXY())&&Vd(e,0,r)<=Wr(e)&&(t[n]=0):i.equals(e.getEndXY())&&Vd(e,r,1)<=Wr(e)&&(t[n]=1)}};m(t,r),m(n,i),Hd(t,n,r,i,a);let h=[];for(let e=0,t=a;e<t;e++)h.push(e);let g=(e,t)=>p?me(i[e],r[e],i[t],r[t]):me(r[e],i[e],r[t],i[t]);if(h.length>1){h.sort(g);let e=Math.max(Wr(t),Wr(n)),a=0;for(let o=1,s=h.length;o<s;o++){let s=r[h[a]],c=r[h[o]],l=i[h[a]],u=i[h[o]];if(s!==c||l!==u){if(Vd(t,s,c)<=e&&Vd(n,l,u)<=e&&!(re(s,0,1)&&re(l,0,1)||re(c,0,1)&&re(u,0,1))){let e=z.distance(t.getCoord2D(s),n.getCoord2D(l)),r=z.distance(t.getCoord2D(c),n.getCoord2D(u));if(e<=r)continue;if(r<e){h[a]=h[o];continue}continue}a++,h[a]=h[o]}}if(h.length=a+1,h.length===1&&h[0]!==0&&(r[0]=r[h[0]],i[0]=i[h[0]],h[0]=0),h.length>2){let e=I.constructEmpty(),a=I.constructEmpty();e.setCoords(r[h[0]],r[h.at(-1)]),a.setCoords(i[h[0]],i[h.at(-1)]);let o=!0;for(let t=1,n=h.length-1;t<n;t++)if(!e.containsCoordinate(r[h[t]])||!a.containsCoordinate(i[h[t]])){o=!1;break}if(o){let r=[.5,.2,.7,.1,.3,.4,.6,.8,.9];for(let i=0;i<r.length;i++){let s=c(e.vmin,e.vmax,r[i]),l=t.getCoord2D(s);if(!n.isCloserThanDistance(l,a,u)){o=!1;break}s=c(a.vmin,a.vmax,r[i]);let d=n.getCoord2D(s);if(!t.isCloserThanDistance(d,e,u)){o=!1;break}}}o&&(h[1]=h.at(-1),h.length=2)}}if(h.length===1&&e&&Or(t,n,r[0],i[0],u,1,[0],[0])&&(h.push(1),r[1]=0,i[1]=0,h.sort(g)),d&&h.length===1){let e=!0;for(let a=0,o=h.length;a<o;a++)if(!(re(r[h[a]],0,1)&&re(i[h[a]],0,1)&&z.distance(t.getCoord2D(r[h[a]]),n.getCoord2D(i[h[a]]))===0)){e=!1;break}if(e)return 0}let _=0;for(let e=0,n=h.length;e<n;e++){if(s&&s.push(r[h[e]]),l&&l.push(i[h[e]]),o){let n=z.getNAN();t.queryCoord2D(r[h[e]],n),o.push(n)}_++}return _}function Wd(e,t,n,r,i,a,o,s,c){if(re(n,0,1)&&re(r,0,1)&&z.distance(e.getCoord2D(n),t.getCoord2D(r))===0){let l=1e-12,u=new J,d=2**-52;if(e.queryDerivative(new P(n,d),u),u.isTrueZero()){let t=n===1?-1e-12:l;e.queryDerivative(new P(n,d).add(t),u)}n===1&&u.negateThis();let f=new J;if(t.queryDerivative(new P(r,d),f),f.isTrueZero()){let e=n===1?-1e-12:l;t.queryDerivative(new P(r,d).add(e),f)}r===1&&f.negateThis(),u.isZero()||u.normalize(),f.isZero()||f.normalize();let p=u.dotProduct(f),m=u.crossProduct(f);if(m.scaleError(3),p.ge(bt)&&(m.isZero()||Math.abs(m.value())<(()=>{if(c)return .001;{let n=e.calculateUpperLength2D(),r=t.calculateUpperLength2D();return Math.min(.01*i/Math.min(n,r),1e-10)}})()))return Dr(e,t,n,r,i,a,o,s)}return 0}function Gd(e,t,n,r,i){let a=-1,o=-1,s=-1,c=-1;{let i=[0,t],l=[t,0],u=[0,r],d=[r,0];for(let t=0;t<2&&a===-1;++t)for(let r=0;r<2;++r)if(e[i[t]].equals(n[u[r]])){a=i[t],o=l[t],s=u[r],c=d[r];break}}if(a===-1){let a=new pr;a.setFromPoints(e,t+1);let o=new pr;return o.setFromPoints(n,r+1),o.inflate(i),a.isIntersectingW(o)?-1:0}{let l=H(t+1,NaN),u=cs(e,t+1,l);U(u>1);let d=0,f=0;for(let e=0;e<u;++e)a===l[e]&&(f=e,d++),o===l[e]&&d++;if(d!==2)return-1;let p=H(r+1,NaN),m=cs(n,r+1,p);U(m>1),d=0;let h=0;for(let e=0;e<m;++e)s===p[e]&&(h=e,d++),c===p[e]&&d++;if(d!==2)return-1;let g=e[l[(f+u-1)%u]],_=e[l[(f+1)%u]],v=n[p[(h+m-1)%m]],y=n[p[(h+1)%m]],b=e[a],x=[g,_,v,y],S=[0,1,2,3];S.sort((e,t)=>z.compareVectorsOrigin(b,x[e],x[t]));let C=S[0];for(let e=1;e<4;e++){if(S[e]!==(C+1)%4)return-1;C=S[e]}{let e=g.sub(b),t=y.sub(b),n=t.dotProduct(e);if(n>0){let r=t.crossProduct(e),a=Math.abs(Math.atan2(r,n)),o=a*e.length(),s=a*t.length();if(o<=i||s<=i)return-1}}{let e=_.sub(b),t=v.sub(b),n=t.dotProduct(e);if(n>0){let r=t.crossProduct(e),a=Math.abs(Math.atan2(r,n)),o=a*e.length(),s=a*t.length();if(o<=i||s<=i)return-1}}return 1}}var Kd=Rt,Z=class e extends oi{constructor(e){super(e||{XStart:0,YStart:0,XEnd:0,YEnd:0})}assignMove(e){return this!==e&&(this.m_description=e.m_description,e.m_description=null,this.m_attributes=e.m_attributes,e.m_attributes=null,this.m_XStart=e.m_XStart,e.m_XStart=NaN,this.m_YStart=e.m_YStart,this.m_XEnd=e.m_XEnd,e.m_XEnd=NaN,this.m_YEnd=e.m_YEnd),this}assignCopy(e){return this!==e&&e.copyTo(this),this}calculateLowerLength3D(){return U(0),0}calculateUpperLength3D(){return U(0),0}changeEndPoints3D(e,t){U(0)}getClosestCoordinate3D(e,t,n){return U(0),0}getBoundary(){return Ui(this)}getAttributeAsDbl(e,t,n){if(t===0)return n===0?li(this,e):ui(this,e);let r=Kd.getInterpolation(t),i=this.getStartAttributeAsDbl(t,n),a=this.getEndAttributeAsDbl(t,n);return le(r,i,a,e,Kd.getDefaultValue(t))}constructFromCoords(e,t,n,r){this.dropAllAttributes(),this.setStartXYCoords(e,t),this.setEndXYCoords(n,r)}construct(e,t){this.dropAllAttributes(),this.setStartXY(e),this.setEndXY(t)}construct3D(e,t){U(0)}constructPoint(e,t){this.assignVertexDescription(e.getDescription()),this.mergeVertexDescription(t.getDescription()),this.setStart(e),this.setEnd(t)}getGeometryType(){return e.type}queryEnvelope(e){if(e.m_EnvelopeType===4){e.setEmpty(),e.assignVertexDescription(this.m_description);let t=G.constructEmpty();this.queryEnvelope(t),e.setEnvelope(t);for(let t=1,n=this.m_description.getAttributeCount();t<n;t++){let n=this.m_description.getSemantics(t);for(let r=Kd.getComponentCount(n);t<r;t++){let t=this.queryInterval(n,0);e.setIntervalEnvelope(n,0,t)}}}else e.m_EnvelopeType===2?e.setCoords({xmin:this.m_XStart,ymin:this.m_YStart,xmax:this.m_XEnd,ymax:this.m_YEnd}):e.m_EnvelopeType===3?(e.setEmpty(),e.mergeCoords(this.m_XStart,this.m_YStart,Br(this,0,1,0)),e.mergeCoords(this.m_XEnd,this.m_YEnd,Br(this,1,1,0))):xt(`env type not impl`)}applyTransformation(e){U(e instanceof At);let t=new z;t.x=this.m_XStart,t.y=this.m_YStart,e.transformInPlace(t),this.m_XStart=t.x,this.m_YStart=t.y,t.x=this.m_XEnd,t.y=this.m_YEnd,e.transformInPlace(t),this.m_XEnd=t.x,this.m_YEnd=t.y}createInstance(){return new e({vd:this.m_description})}calculateLength2D(){return Math.sqrt(Ti(this))}calculateLength3D(e){return U(0),0}changeEndPoints2D(e,t){this.setStartXY(e),this.setEndXY(t),this.normalizeAfterEndpointChange()}queryControlPointsHelper(e){return U(e.length>=2),e[0]=this.getStartXY(),e[1]=this.getEndXY(),2}queryCoord2D(e,t){return si(this,e,t)}queryCoord3D(e,t){U(0)}getCoordZ(e){return di(this,e)}queryCoord2DE(e,t){pi(this,e,t)}queryCoord2DMP(e,t){t.assignPoint2D(this.getStartXY());let n=br.constructPoint2D(this.getEndXY());n.subThis(t),n.mulThis(A.constructDouble(e)),t.addThis(n)}getCoordX(e){return li(this,e)}getCoordY(e){return ui(this,e)}cut(e,t,n){let r=new Q;return this.queryCut(e,t,r,n),r.releaseSegment()}queryCut(e,t,n,r){let i=n.createLine();r&&i.assignVertexDescription(this.m_description);let a=z.getNAN();if(si(this,e,a),i.setStartXYCoords(a.x,a.y),si(this,t,a),i.setEndXYCoords(a.x,a.y),!r)for(let n=1,r=this.m_description.getAttributeCount();n<r;n++){let r=this.m_description.getSemantics(n),a=Kd.getComponentCount(r);for(let n=0;n<a;n++){let a=this.getAttributeAsDbl(e,r,n);i.setStartAttribute(r,n,a);let o=this.getAttributeAsDbl(t,r,n);i.setEndAttribute(r,n,o)}}}queryDerivative(e,t){fi(this,e,t)}getClosestCoordinate(e,t){return z.getClosestCoordinate(this.getStartXY(),this.getEndXY(),e,t)}getClosestCoordinateOnInterval(e,t,n=-1){let r=new z;this.queryCoord2D(t.vmin,r);let i=new z;this.queryCoord2D(t.vmax,i);let a=z.getClosestCoordinate(r,i,e,!1);return Yr.recalculateParentT(t.vmin,t.vmax,a)}intersectionOfYMonotonicWithAxisX(e,t){let n=this.m_YEnd-this.m_YStart;if(!n)return e===this.m_YEnd?t:NaN;let r=(e-this.m_YStart)/n,i=li(this,r);return r===1&&(i=this.m_XEnd),i}isCurve(){return!1}isMonotoneQuickAndDirty(){return!0}isDegenerate(e){let t=this.m_XStart-this.m_XEnd,n=this.m_YStart-this.m_YEnd;return Math.sqrt(t*t+n*n)<=e}isDegenerate3D(e,t){return U(0),!1}queryLooseEnvelope(e){this.queryEnvelope(e)}clone(t){let n=new e;return this.copyTo(n),n}tToLength(e){return e*this.calculateLength2D()}lengthToT(e){let t=this.calculateLength2D();return t===0?0:e/t}calculateWeightedAreaCentroid2D(e){let t=new z;return t.setCoords(0,0),t}calculateWeightedCentroid2D(){return this.getCoord2D(.5).mul(this.calculateLength2D())}getTangent(e){let t=z.getNAN();return t.setSub(this.getEndXY(),this.getStartXY()),t}getDerivative(e){let t=new z;return t.setSub(this.getEndXY(),this.getStartXY()),t}getCurvature(e){return 0}isIntersectingPoint(e,t,n){return xi(this,e,t,n)>=0}isIntersectingPoint3D(e,t,n,r,i=1){return U(0),!1}getYMonotonicParts(e,t){return 0}getMonotonicParts(e,t){return 0}getMonotonicPartParams(e,t){return t&&(e<2&&R(``),t[0]=0,t[1]=1),2}intersectionWithAxis2D(e,t,n,r){if(e){let e=this.m_YEnd-this.m_YStart;if(!e)return t===this.m_YEnd?-1:0;let i=(t-this.m_YStart)/e;return i<0||i>1?0:(n&&(n[0]=li(this,i)),r&&(r[0]=i),1)}{let e=this.m_XEnd-this.m_XStart;if(!e)return t===this.m_XEnd?-1:0;let i=(t-this.m_XStart)/e;return i<0||i>1?0:(n&&(n[0]=ui(this,i)),r&&(r[0]=i),1)}}calculateUpperLength2D(){return this.calculateLength2D()}calculateLowerLength2D(){return this.calculateLength2D()}normalizeAfterEndpointChange(){return!1}queryLooseEnvelopeOnInterval(e,t){if(t.m_EnvelopeType===2){let n=_e(e.vmin,0,1),r=new z;this.queryCoord2D(n,r),t.setCoords({pt:r}),n=_e(e.vmax,0,1),this.queryCoord2D(n,r),t.mergeNe(r);return}xt(`3d dst not impl`)}orientBottomUp(){gi(this)}isLine(){return!0}isDegenerateToLineHelper(e){return!0}copyIgnoreAttributes(e){e.setStartXY(this.getStartXY()),e.setEndXY(this.getEndXY()),e.normalizeAfterEndpointChange()}calculateArea2DHelper(){return 0}absNormXYZ(e){return hi(this,e)}absNorm(){return this.getStartXY().norm(1)+this.getEndXY().norm(1)}queryEnvelopeW(e,t){t.setCoords(this.getCoord2D(e.vmin)),t.mergeNe(this.getCoord2D(e.vmax))}setSegmentFromCoordsForStitcher(e,t){mi(this,e[0],e[t-1])}writeInBufferStream(e,t){return U(0),0}readFromBufferStream(e,t){U(0)}snapControlPoints(e){return!1}needsSnapControlPoints(e){return!1}calculateSpecialPointsForCracking(e,t){return 0}ensureXYMonotone(){return!1}setCoordsForIntersector(e,t,n){mi(this,e,t)}static isIntersectingLineLine(e,t,n,r){return _i(e,t,n,r)}static isIntersectingLineLine_(e,t,n,r){return _i(e,t,n,r)}copyToImpl(e){}reverseImpl(){}equalsImpl(e){return!0}equalsImplTol(e,t){return!0}swapImpl(e){}afterCompletedModification(){}endPointModified(){}clearEndPointModified(){}intersect(e,t,n,r,i){return Bd(!1,this,e,t,n,r,i)}intersectPoint(e,t,n){t.length<1&&E(``);let r=xi(this,e,n,!1);return r>=0?(t&&(t[0]=r),1):0}isIntersecting(e,t,n){return Id(!1,this,e,t,n)!==0}};Z.type=L.enumLine;var Q=class e{constructor(e){this.m_seg=null,this.m_curves=null,this.m_lineBuffer=new Z,this.m_mask=0,this.m_active=0,e!==void 0&&(e.copy?e.copy.copyTo(this,!1):e.move?this.assignMove(e.move):e.segment?this.copyFrom(e.segment,!!e.bIgnoreAttributes):B(`bad constructor params`))}assignCopy(t){return t instanceof e?this!==t&&t.copyTo(this,!1):this.copyFrom(t,!1),this}assignMove(t){if(t instanceof e){if(this===t)return this;this.reset(),1&t.m_mask&&(this.m_lineBuffer=t.m_lineBuffer,t.m_lineBuffer=null,this.m_mask=1),this.m_curves=t.m_curves,this.m_mask=t.m_mask,this.m_active=t.m_active,t.reset(),this.m_seg=this.activeSegment(),t.m_seg=null}else{if(this.m_seg===t)return this;this.create(t.getGeometryType()),this.m_seg.swap(t)}return this}activeSegment(){switch(this.m_active){case 0:return null;case 1:return this.line();case 2:return this.arc();case 4:return this.bezier3();case 8:return this.bezier2();case 16:return this.rbezier2();default:B(``)}}get(){return this.m_seg}reset(){1&this.m_mask&&(this.m_lineBuffer=null),this.m_mask>1&&(this.m_curves=null),this.m_mask=0,this.m_active=0}empty(){return this.m_seg===null}copyTo(e,t){this!==e&&(this.empty()?e.m_seg=null:e.copyFrom(this.m_seg,t))}copyToWithZ(e,t){U(0)}createImpl(e){switch(e){case L.enumLine:1&this.m_mask||(this.m_lineBuffer=new Z,this.m_mask|=1,this.m_active=1);break;case L.enumEllipticArc:2&this.m_mask||(this.m_curves=new xu,this.m_mask=1&this.m_mask|2,this.m_active=2);break;case L.enumBezier:4&this.m_mask||(this.m_curves=new Gc,this.m_mask=1&this.m_mask|4,this.m_active=4);break;case L.enumBezier2:8&this.m_mask||(this.m_curves=new _a,this.m_mask=1&this.m_mask|8,this.m_active=8);break;case L.enumRationalBezier2:16&this.m_mask||(this.m_curves=new ha,this.m_mask=1&this.m_mask|16,this.m_active=16);break;default:R(``)}}create(e){e===L.enumLine?this.createLine():e===L.enumEllipticArc?this.createEllipticArc():e===L.enumBezier?this.createCubicBezier():e===L.enumRationalBezier2?this.createQuadraticRationalBezier():e===L.enumBezier2?this.createQuadraticBezier():R(`Segment_buffer.create`)}copyFrom(e,t){this.m_seg!==e&&(this.create(e.getGeometryType()),t?e.copyIgnoreAttributes(this.m_seg):e.copyTo(this.m_seg))}copyFromWithZ(e,t){U(0)}line(){return this.m_lineBuffer}arc(){return this.m_curves}bezier3(){return this.m_curves}bezier2(){return this.m_curves}rbezier2(){return this.m_curves}createLine(){return this.createImpl(L.enumLine),this.m_seg=this.line(),this.line()}createEllipticArc(){return this.createImpl(L.enumEllipticArc),this.m_seg=this.arc(),this.arc()}createCubicBezier(){return this.createImpl(L.enumBezier),this.m_seg=this.bezier3(),this.bezier3()}createQuadraticRationalBezier(){return this.createImpl(L.enumRationalBezier2),this.m_seg=this.rbezier2(),this.rbezier2()}createQuadraticBezier(){return this.createImpl(L.enumBezier2),this.m_seg=this.bezier2(),this.bezier2()}releaseSegment(){if(this.m_seg=null,this.m_active===0&&B(`releaseSegment`),1&this.m_active){let e=this.line();return--this.m_mask,this.m_active=0,this.m_lineBuffer=null,e}let e;return 2&this.m_active?e=this.arc():4&this.m_active?e=this.bezier3():8&this.m_active?e=this.bezier2():16&this.m_active?e=this.rbezier2():B(`releaseSegment`),this.m_mask-=this.m_active,this.m_active=0,this.m_curves=null,e}equals(t){return t instanceof e?this===t||(this.empty()?t.empty():!t.empty()&&this.get().equals(t.get())):(xt(`seg comparison not yet impl`),!1)}};function qd(e,t,n,r,i){return Jd(e,t,null,n,r,i)}function Jd(e,t,n,r,i,a){let o=e.getGeometryType();if(o===L.enumPoint){let n=e.getXY();return t.contains(n)?e:e.createInstance()}if(o===L.enumEnvelope){let n=G.constructEmpty();if(e.queryEnvelope(n),n.intersect(t)){let t=e.clone();return t.setEnvelope(n),t}return e.createInstance()}if(e.isEmpty())return e;if(t.isEmpty())return e.createInstance();let s=t.clone();{let t=new G;if(e.queryLooseEnvelope(t),s.containsEnvelope(t))return e;if(!s.isIntersecting(t))return e.createInstance();i===0&&(t.intersect(s),t.inflate(Math.max(.1*t.maxDimension(),1)),t.intersect(s),s.assign(t))}let c=r;if((n!==null||Number.isNaN(c))&&(c=Pn(n,s,!1).total()),o===L.enumGeometryCollection){let t=e,n=e.createInstance();for(let e=0,r=t.getGeometryCount();e<r;e++){let r=t.getGeometry(e);if(r.isEmpty())continue;let o=qd(r,s,c,i,a);o.isEmpty()||(o===r?n.addGeometry(o.clone()):n.addGeometry(o))}return n}d(o)||R(`Clip: geometry not supported`);let l=e.getImpl().getAccelerators();if(l!==null){let e=l.getRasterizedGeometry();U(e===null)}switch(o){case L.enumMultiPoint:{let t=e,n,r=t.getPointCount(),i=t.getImpl().getAttributeStreamRef(0),a=0;for(let e=0;e<r;e++){let r=i.readPoint2D(2*e);s.contains(r)||(a===0&&(n=t.createInstance()),a<e&&n.addPoints(t,a,e),a=e+1)}return a>0&&n.addPoints(t,a,r),a===0?t:(U(n!==null),n)}case L.enumPolygon:case L.enumPolyline:return Xd(e,s,c,i,a);default:B(``)}}function Yd(e,t,n,r,i,a){let o=new Zd(t,a),s=new G;return e.queryLooseEnvelope(s),t.containsEnvelope(s)?e:t.isIntersecting(s)?o.clipPolesOut(e,i):e.createInstance()}function Xd(e,t,n,r,i){return new Zd(t,i).clipMultiPath2(e,n,r)}var Zd=class e{constructor(e,t){this.m_shape=new os,this.m_geometry=-1,this.m_verticesOnExtentIndex=-1,this.m_verticesOnExtent=[],this.m_progressCounter=0,this.m_extent=new G(e),this.m_progressTracker=t}progress_(){}clipMultiPath2(e,t,n){return e.getGeometryType()===L.enumPolygon?this.clipPolygonOrProjectedPolyline2(e,n):this.clipPolyline(e,t)}clipPolygonOrProjectedPolyline2(t,n){let r=t.getGeometryType()===L.enumPolyline;if(this.m_extent.width()===0||this.m_extent.height()===0)return t.createInstance();let i=G.constructEmpty();t.queryLooseEnvelope(i),this.m_geometry=r?this.m_shape.addGeometry(t):this.m_shape.addGeometry(t,this.m_extent);let a=G.constructEmpty(),o=G.constructEmpty(),s=new z,c=new z,l=H(9,NaN),u=H(9,NaN),d=C(z,9),f=null,p=new Z,m=[],h=!1;for(let t=0;!h&&t<4;t++){let n=!1,g=!!(1&t),_=0;switch(t){case 0:_=this.m_extent.xmin,n=i.xmin<=_&&i.xmax>=_;break;case 1:_=this.m_extent.ymin,n=i.ymin<=_&&i.ymax>=_;break;case 2:_=this.m_extent.xmax,n=i.xmin<=_&&i.xmax>=_;break;case 3:_=this.m_extent.ymax,n=i.ymin<=_&&i.ymax>=_}if(n){h=!0;for(let n=this.m_shape.getFirstPath(this.m_geometry);n!==-1;){let i=!0,v=-1,y=-1,b=this.m_shape.getFirstVertex(n),x=b;do{this.progress_(),f=this.m_shape.getSegment(x);let n=f;if(n===null){let e=this.m_shape.getNextVertex(x);if(e===-1){U(r),v===0&&m.push(x);break}this.m_shape.queryXY(x,s),p.setStartXY(s),this.m_shape.queryXY(e,c),p.setEndXY(c),n=p}n.queryLooseEnvelope(a);let b=e.checkSegmentIntersection(a,t,_);n.isCurve()&&b===0&&n.isCurve()&&(p.setStartXY(n.getStartXY()),p.setEndXY(n.getEndXY()),this.m_shape.replaceCurveWithLine(x),n=p,p.queryEnvelope(a),b=e.checkSegmentIntersection(a,t,_));let S=0,C=-1;if(b===-1){let r=n.intersectionWithAxis2D(g,_,l,u);if(r>0){let e=null;if(n.isCurve()){e=d,U(r<=9);for(let e=0;e<r;e++)g?d[e].setCoords(l[e],_):d[e].setCoords(_,l[e]);S=this.m_shape.splitSegmentAxisAware(x,u,r,e,g?1:0)}else S=this.m_shape.splitSegmentAxisAware(x,u,r,null,-1)}else S=0;S+=1;let a=x,b=this.m_shape.getNextVertex(a);n=null;for(let n=0;n<S;n++){this.m_shape.queryXY(a,s),this.m_shape.queryXY(b,c),f=this.m_shape.getSegment(a);let n=f;n===null&&(p.setStartXY(s),p.setEndXY(c),n=p),n.queryEnvelope(o);let r=e.checkSegmentIntersection(o,t,_);n.isCurve()&&r===0&&(this.m_shape.replaceCurveWithLine(a),p.setStartXY(s),p.setEndXY(c),n=p,n.queryEnvelope(o),r=e.checkSegmentIntersection(o,t,_)),r===-1&&(g?Math.abs(s.y-_)<Math.abs(c.y-_)?(s.y=_,this.m_shape.setXY(a,s)):(c.y=_,this.m_shape.setXY(b,c)):Math.abs(s.x-_)<Math.abs(c.x-_)?(s.x=_,this.m_shape.setXY(a,s)):(c.x=_,this.m_shape.setXY(b,c)),f=this.m_shape.getSegment(a),n=f,n===null&&(p.setStartXY(s),p.setEndXY(c),n=p),n.queryEnvelope(o),r=e.checkSegmentIntersection(o,t,_),r===-1&&(r=e.checkSegmentIntersectionLoose(o,t,_)));let l=v;v=r,y===-1&&(y=v),l===0&&v===1||l===1&&v===0||l===0&&v===0&&m.push(a),v===1&&(h=!1,i=!1),a=b,C=a,b=this.m_shape.getNextVertex(b)}}if(S===0){let e=v;v=b,y===-1&&(y=v),e===0&&v>=1||e>=1&&v===0||e===0&&v===0&&m.push(x),v===1&&(h=!1,i=!1),C=this.m_shape.getNextVertex(x)}if(x=C,m.length>=256){for(let e=1,t=m.length-1;e<t;e++){let t=m[e];r?this.m_shape.snapVertexForPoleClipping(t,_):this.m_shape.removeVertex(t,!1)}m[1]=m.at(-1),m.length=2}}while(x!==b);if(!i){y!==0||!r&&v!==0&&v!==2||m.push(b);for(let e=0,t=m.length;e<t;e++){let t=m[e];r?this.m_shape.snapVertexForPoleClipping(t,_):this.m_shape.removeVertex(t,!1)}}m.length=0,n=i||this.m_shape.getPathSize(n)===0?this.m_shape.removePath(n):this.m_shape.getNextPath(n)}}}if(h)return t.createInstance();f=null,r?this.removeSpikesAlongPoles():this.resolveBoundaryOverlaps(),n>0&&this.densifyAlongClipExtent(n);let g=this.m_shape.getGeometry(this.m_geometry);return g.getGeometryType()===L.enumPolygon&&g.setFillRule(t.getFillRule()),g}clipPolyline(t,n){let r=G.constructEmpty(),i=G.constructEmpty(),a=H(9,NaN),o=H(9,NaN),s=new Q,c=t,l=G.constructEmpty();t.queryLooseEnvelope(l);for(let n=0;n<4;n++){let u=!1,d=!!(1&n),f=0;switch(n){case 0:f=this.m_extent.xmin,u=l.xmin<=f&&l.xmax>=f;break;case 1:f=this.m_extent.ymin,u=l.ymin<=f&&l.ymax>=f;break;case 2:f=this.m_extent.xmax,u=l.xmin<=f&&l.xmax>=f;break;case 3:f=this.m_extent.ymax,u=l.ymin<=f&&l.ymax>=f}if(!u)continue;let p=c;c=t.createInstance();let m=p.getImpl().querySegmentIterator();m.resetToFirstPath();let h=new z,g=new z;for(;m.nextPath();){let t=-1,l=!0;for(;m.hasNextSegment();){this.progress_();let u=m.nextSegment(),p=u.isDegenerate(0);u.queryLooseEnvelope(r);let _=e.checkSegmentIntersection(r,n,f);if(_===-1){let r=u.intersectionWithAxis2D(d,f,a,o),m=0;h.assign(u.getStartXY());for(let _=0;_<=r;_++){let v=_<r?o[_]:1;if(m===v)continue;u.queryCut(m,v,s,!1);let y=s.get(),b=!1;if(y.getStartXY().equals(h)||(y.setStartXY(h),b=!0),_<r&&(d?(g.x=a[_],g.y=f):(g.x=f,g.y=a[_]),y.getEndXY().equals(g)||(y.setEndXY(g),b=!0)),b&&y.normalizeAfterEndpointChange(),!p&&y.isDegenerate(0))continue;y.queryEnvelope(i);let x=e.checkSegmentIntersection(i,n,f);if(x===-1){let t=y.getStartXY(),r=y.getEndXY();b=!1,d?Math.abs(t.y-f)<Math.abs(r.y-f)?(t.y=f,y.setStartXY(t),t.equals(y.getStartXY())||(y.setStartXY(t),b=!0)):(r.y=f,r.equals(y.getEndXY())||(y.setEndXY(r),b=!0)):Math.abs(t.x-f)<Math.abs(r.x-f)?(t.x=f,t.equals(y.getStartXY())||(y.setStartXY(t),b=!0)):(r.x=f,r.equals(y.getEndXY())||(y.setEndXY(r),b=!0)),b&&y.normalizeAfterEndpointChange(),y.queryEnvelope(i),x=e.checkSegmentIntersection(i,n,f),x===-1&&(x=e.checkSegmentIntersectionLoose(i,n,f))}h.assign(y.getEndXY()),m=v,t=x,t>=1?(c.addSegment(y,l),l=!1):l=!0}}else t=_,t>=1?(c.addSegment(u,l),l=!1):l=!0}}}return c}static checkSegmentIntersection(e,t,n){switch(t){case 0:return e.xmin<n&&e.xmax<=n?0:e.xmin>=n?e.xmax===n?2:1:-1;case 1:return e.ymin<n&&e.ymax<=n?0:e.ymin>=n?e.ymax===n?2:1:-1;case 2:return e.xmin>=n&&e.xmax>n?0:e.xmax<=n?e.xmin===n?2:1:-1;case 3:return e.ymin>=n&&e.ymax>n?0:e.ymax<=n?e.ymin===n?2:1:-1}return B(``),0}static checkSegmentIntersectionLoose(e,t,n){switch(t){case 0:{let t=Math.abs(e.xmin-n),r=Math.abs(e.xmax-n);return e.xmin<n?t>r?0:1:(B(``),1)}case 1:{let t=Math.abs(e.ymin-n),r=Math.abs(e.ymax-n);return e.ymin<n?t>r?0:1:(B(``),1)}case 2:{let t=Math.abs(e.xmin-n),r=Math.abs(e.xmax-n);return e.xmax>n?t<r?0:1:(B(``),1)}case 3:{let t=Math.abs(e.ymin-n),r=Math.abs(e.ymax-n);return e.ymax>n?t<r?0:1:(B(``),1)}}return B(``),0}resolveBoundaryOverlaps(){this.m_verticesOnExtentIndex=-1,this.splitSegments(!1,this.m_extent.xmin),this.splitSegments(!1,this.m_extent.xmax),this.splitSegments(!0,this.m_extent.ymin),this.splitSegments(!0,this.m_extent.ymax),this.m_verticesOnExtent.length=0,this.m_verticesOnExtentIndex=this.m_shape.createUserIndex();let e=new z;for(let t=this.m_shape.getFirstPath(this.m_geometry);t!==-1;t=this.m_shape.getNextPath(t)){let n=this.m_shape.getFirstVertex(t);for(let r=0,i=this.m_shape.getPathSize(t);r<i;r++,n=this.m_shape.getNextVertex(n))this.progress_(),this.m_shape.queryXY(n,e),this.m_extent.xmin!==e.x&&this.m_extent.xmax!==e.x&&this.m_extent.ymin!==e.y&&this.m_extent.ymax!==e.y||(this.m_shape.setUserIndex(n,this.m_verticesOnExtentIndex,this.m_verticesOnExtent.length),this.m_verticesOnExtent.push(n))}this.dbgCheckPathFirst(),this.resolveOverlaps(!1,this.m_extent.xmin),this.dbgCheckPathFirst(),this.resolveOverlaps(!1,this.m_extent.xmax),this.dbgCheckPathFirst(),this.resolveOverlaps(!0,this.m_extent.ymin),this.dbgCheckPathFirst(),this.resolveOverlaps(!0,this.m_extent.ymax),this.fixPaths()}densifyAlongClipExtent(e){let t=new z(0,0),n=new z(0,0),r=H(2048,NaN);for(let i=this.m_shape.getFirstPath(this.m_geometry);i!==-1;i=this.m_shape.getNextPath(i)){let a=this.m_shape.getFirstVertex(i),o=a;do{let i=this.m_shape.getNextVertex(o);this.m_shape.queryXY(o,t);let a=-1;if(t.x===this.m_extent.xmin?(this.m_shape.queryXY(i,n),n.x===this.m_extent.xmin&&(a=1)):t.x===this.m_extent.xmax&&(this.m_shape.queryXY(i,n),n.x===this.m_extent.xmax&&(a=1)),t.y===this.m_extent.ymin?(this.m_shape.queryXY(i,n),n.y===this.m_extent.ymin&&(a=0)):t.y===this.m_extent.ymax&&(this.m_shape.queryXY(i,n),n.y===this.m_extent.ymax&&(a=0)),a===-1){o=i;continue}if(this.isCurve(o)){o=i;continue}let s=t.clone(),c=new z(0,0);if(a){let r=t.y-this.m_extent.ymin;c.y=Ye(n.y-t.y),s.y=e*ft(Math.floor(Math.abs(r)/e),r)+this.m_extent.ymin,c.y<0&&(s.y+=e)}else{let r=t.x-this.m_extent.xmin;c.x=Ye(n.x-t.x),s.x=e*ft(Math.floor(Math.abs(r)/e),r)+this.m_extent.xmin,c.x<0&&(s.x+=e)}let l=a?n.y-t.y:n.x-t.x,u=Math.abs(l);if(u/e>65536&&B(``),u>0){let n=Math.trunc(u/e)+2;r.length<n&&(r.length=n);let i=0;for(let n=0;;n++){let o=s.add(c.mul(n*e)),u=(a?o.y-t.y:o.x-t.x)/l;if(u>=1)break;u<=0||(U(i<=r.length),r[i]=u,i++)}i!==0&&this.m_shape.splitSegment(o,r,i)}o=i}while(o!==a)}}splitSegments(e,t){let n=-1,r=new z,i=[];for(let a=this.m_shape.getFirstPath(this.m_geometry);a!==-1;a=this.m_shape.getNextPath(a)){let o=this.m_shape.getFirstVertex(a),s=-1;for(let c=0,l=this.m_shape.getPathSize(a);c<l;c++,o=s)if(this.progress_(),s=this.m_shape.getNextVertex(o),this.m_shape.queryXY(o,r),(e?r.y===t:r.x===t)&&(this.m_shape.queryXY(s,r),e?r.y===t:r.x===t)){if(this.isCurve(o))continue;n===-1&&(n=this.m_shape.createUserIndex()),this.m_shape.getUserIndex(o,n)!==1&&(i.push(o),this.m_shape.setUserIndex(o,n,1)),this.m_shape.getUserIndex(s,n)!==1&&(i.push(s),this.m_shape.setUserIndex(s,n,1))}}if(n!==-1&&this.m_shape.removeUserIndex(n),i.length<3)return;i.sort((e,t)=>this.compareVertices(e,t));let a=new z,o=new z,s=new z;o.setNAN();let c=-1,l=[],u=[],d=this.m_shape.createUserIndex(),f=this.m_shape.createUserIndex();for(let n=0,p=i.length;n<p;n++){let p=i[n];if(this.m_shape.queryXY(p,r),!r.isEqualPoint2D(o)){if(c===-1){c=n,o.setCoordsPoint2D(r);continue}for(let r=c;r<n;r++){let n=i[r],s=this.m_shape.getNextVertex(n),c=this.m_shape.getPrevVertex(n),u=!1;this.m_shape.queryXY(s,a),o.compare(a)<0&&(e?a.y===t:a.x===t)&&(this.isCurve(n)||(l.push(n),u=!0,this.m_shape.setUserIndex(n,f,1))),this.m_shape.queryXY(c,a),o.compare(a)<0&&(e?a.y===t:a.x===t)&&(this.isCurve(c)||(u||l.push(n),this.m_shape.setUserIndex(n,d,1)))}for(let e=0,t=l.length;e<t;e++){let t=l[e],n=this.m_shape.getUserIndex(t,d),i=this.m_shape.getUserIndex(t,f);if(n===1){let e=this.m_shape.getPrevVertex(t);this.m_shape.queryXY(e,s);let n=0;if(!s.isEqualPoint2D(r)){let i=z.distance(o,s);n=z.distance(s,r)/i,n===0?n=2**-52:n===1&&(n=1-2**-52),this.m_shape.splitSegment(e,[n],1);let a=this.m_shape.getPrevVertex(t);this.m_shape.setXY(a,r),u.push(a),this.m_shape.setUserIndex(a,d,1),this.m_shape.setUserIndex(a,f,-1)}}if(i===1){let e=this.m_shape.getNextVertex(t);this.m_shape.queryXY(e,s);let n=0;if(!s.isEqualPoint2D(r)){let e=z.distance(o,s);n=z.distance(o,r)/e,n===0?n=2**-52:n===1&&(n=1-2**-52),this.m_shape.splitSegment(t,[n],1);let i=this.m_shape.getNextVertex(t);this.m_shape.setXY(i,r),u.push(i),this.m_shape.setUserIndex(i,d,-1),this.m_shape.setUserIndex(i,f,1)}}}let p=l;l=u,u=p,u.length=0,c=n,o.setCoordsPoint2D(r)}}this.m_shape.removeUserIndex(d),this.m_shape.removeUserIndex(f)}resolveOverlaps(e,t){let n=new z,r=[],i=-1;for(let a=0,o=this.m_verticesOnExtent.length;a<o;a++){this.progress_();let o=this.m_verticesOnExtent[a];if(o===-1)continue;let s=this.m_shape.getNextVertex(o);if(this.m_shape.queryXY(o,n),(e?n.y===t:n.x===t)&&(this.m_shape.queryXY(s,n),e?n.y===t:n.x===t)){if(this.isCurve(o))continue;i===-1&&(i=this.m_shape.createUserIndex()),this.m_shape.getUserIndex(o,i)!==-2&&(r.push(o),this.m_shape.setUserIndex(o,i,-2)),this.m_shape.getUserIndex(s,i)!==-2&&(r.push(s),this.m_shape.setUserIndex(s,i,-2))}}if(r.length===0)return void(i!==-1&&this.m_shape.removeUserIndex(i));U(i!==-1),r.sort((e,t)=>this.compareVertices(e,t));for(let e=0,t=r.length;e<t;e++){let t=r[e];this.m_shape.setUserIndex(t,i,e)}let a=new z,o=new z;o.setNAN();let s=-1;for(let c=0,l=r.length;c<l;c++){this.progress_();let l=r[c];if(l!==-1&&(this.m_shape.queryXY(l,n),!n.isEqualPoint2D(o))){if(s!==-1)for(;;){let n=!1,l=c;for(let u=s;u<l;u++){let s=r[u];if(s===-1)continue;let l=-1,d=this.m_shape.getNextVertex(s);this.m_shape.queryXY(d,a),o.compare(a)<0&&(e?a.y===t:a.x===t)&&(this.isCurve(s)||(l=d));let f=-1,p=this.m_shape.getPrevVertex(s);if(this.m_shape.queryXY(p,a),o.compare(a)<0&&(e?a.y===t:a.x===t)&&(this.isCurve(p)||(f=p)),l===-1||f===-1){if(l!==-1||f!==-1){for(let d=u+1;d<c;d++){let c=r[d];if(c===-1)continue;let u=this.m_shape.getNextVertex(c),p=-1;this.m_shape.queryXY(u,a),o.compare(a)<0&&(e?a.y===t:a.x===t)&&(this.isCurve(c)||(p=u));let m=this.m_shape.getPrevVertex(c),h=-1;if(this.m_shape.queryXY(m,a),o.compare(a)<0&&(e?a.y===t:a.x===t)&&(this.isCurve(m)||(h=m)),p!==-1&&h!==-1){this.beforeRemoveVertex(c,r,i),this.m_shape.removeVertex(c,!1),this.beforeRemoveVertex(p,r,i),this.m_shape.removeVertex(p,!1),n=!0;break}if(l!==-1&&h!==-1){this.removeOverlap(r,s,l,c,h,i),n=!0;break}if(f!==-1&&p!==-1){this.removeOverlap(r,c,p,s,f,i),n=!0;break}}if(n)break}}else this.beforeRemoveVertex(s,r,i),this.m_shape.removeVertex(s,!1),this.beforeRemoveVertex(l,r,i),this.m_shape.removeVertex(l,!1),n=!0}if(!n)break}s=c,o.setCoordsPoint2D(n)}}this.m_shape.removeUserIndex(i)}beforeRemoveVertex(e,t,n){let r=this.m_shape.getUserIndex(e,n);U(r>=0),t[r]=-1,r=this.m_shape.getUserIndex(e,this.m_verticesOnExtentIndex),U(r>=0),this.m_verticesOnExtent[r]=-1;let i=this.m_shape.getPathFromVertex(e);i!==-1&&this.m_shape.getFirstVertex(i)===e&&(this.m_shape.setFirstVertex(i,-1),this.m_shape.setLastVertex(i,-1))}removeOverlap(e,t,n,r,i,a){this.m_shape.setNextVertex(t,r),this.m_shape.setPrevVertex(r,t),this.m_shape.setPrevVertex(n,i),this.m_shape.setNextVertex(i,n),this.beforeRemoveVertex(r,e,a),this.m_shape.removeVertexInternal(r,!1),this.beforeRemoveVertex(i,e,a),this.m_shape.removeVertexInternal(i,!0)}removeSpikesAlongPoles(){this.removeSpikesOnPole(this.m_extent.ymin),this.removeSpikesOnPole(this.m_extent.ymax)}removeSpikesOnPole(e){for(let t=this.m_shape.getFirstPath(this.m_geometry);t!==-1;t=this.m_shape.getNextPath(t)){let n=this.m_shape.getPathSize(t);if(n<3)continue;let r=this.m_shape.getFirstVertex(t),i=new z;this.m_shape.queryXY(r,i);let a=i.y===e&&!this.isCurve(r);r=this.m_shape.getNextVertex(r);let o=new z;this.m_shape.queryXY(r,o);let s=o.y===e&&!this.isCurve(r);r=this.m_shape.getNextVertex(r);let c=new z;for(let t=0,l=n-2;t<l;t++,r=this.m_shape.getNextVertex(r)){this.progress_(),this.m_shape.queryXY(r,c);let t=c.y===e;if(s&&a&&t&&(o.x-i.x)*(c.x-o.x)<=0){this.m_shape.removeVertex(this.m_shape.getPrevVertex(r),!1),o.setCoordsPoint2D(c),s=t&&!this.isCurve(r);continue}i.setCoordsPoint2D(o),a=s,o.setCoordsPoint2D(c),s=t&&!this.isCurve(r)}}}fixPaths(){for(let e=0,t=this.m_verticesOnExtent.length;e<t;e++){let t=this.m_verticesOnExtent[e];t!==-1&&this.m_shape.setPathToVertex(t,-1)}let e=this.m_shape.hasCurves(),t=0,n=0;for(let e=this.m_shape.getFirstPath(this.m_geometry);e!==-1;){let r=this.m_shape.getFirstVertex(e);if(r===-1||e!==this.m_shape.getPathFromVertex(r)){let t=e;e=this.m_shape.getNextPath(e),this.m_shape.setFirstVertex(t,-1),this.m_shape.removePathOnly(t);continue}let i=r,a=0;do this.m_shape.setPathToVertex(i,e),a++,i=this.m_shape.getNextVertex(i);while(i!==r);this.m_shape.setRingAreaValid(e,!1),this.m_shape.setLastVertex(e,this.m_shape.getPrevVertex(r)),this.m_shape.setPathSize(e,a),n+=a,t++,e=this.m_shape.getNextPath(e)}for(let r=0,i=this.m_verticesOnExtent.length;r<i;r++){let i=this.m_verticesOnExtent[r];if(i===-1)continue;let a=this.m_shape.getPathFromVertex(i);if(a!==-1)continue;a=this.m_shape.insertPath(this.m_geometry,-1);let o=!1,s=0,c=i;do this.m_shape.setPathToVertex(i,a),s++,e&&s<=2&&(o||=this.isCurve(i)),i=this.m_shape.getNextVertex(i);while(i!==c);if(o?s===0:s<=2){let e=this.m_shape.getUserIndex(c,this.m_verticesOnExtentIndex);U(e>=0),this.m_verticesOnExtent[e]=-1;let t=this.m_shape.removeVertex(c,!1);s===2&&(e=this.m_shape.getUserIndex(t,this.m_verticesOnExtentIndex),e>=0&&(this.m_verticesOnExtent[e]=-1),this.m_shape.removeVertex(t,!1));let n=a;a=this.m_shape.getNextPath(a),this.m_shape.setFirstVertex(n,-1),this.m_shape.removePathOnly(n);continue}this.m_shape.setClosedPath(a,!0),this.m_shape.setPathSize(a,s),this.m_shape.setFirstVertex(a,c),this.m_shape.setLastVertex(a,this.m_shape.getPrevVertex(c)),this.m_shape.setRingAreaValid(a,!1),n+=s,t++}this.m_shape.setGeometryPathCount(this.m_geometry,t),this.m_shape.setGeometryVertexCount(this.m_geometry,n);let r=0;for(let e=this.m_shape.getFirstGeometry();e!==-1;e=this.m_shape.getNextGeometry(e))r+=this.m_shape.getPointCount(e);this.m_shape.setTotalPointCount(r)}dbgCheckPathFirst(){}isCurve(e){return this.m_shape.getSegment(e)!==null}compareVertices(e,t){let n=new z;this.m_shape.queryXY(e,n);let r=new z;return this.m_shape.queryXY(t,r),n.compare(r)}clipPolesOut(e,t){return this.clipPolygonOrProjectedPolyline2(e,t)}},Qd=class{getOperatorType(){return 10004}supportsCurves(){return!0}accelerateGeometry(e,t,n){return!1}canAccelerateGeometry(e){return!1}executeMany(e,t,n,r){return new $d(e,t,n,r)}execute(e,t,n,r){return ef(e,t,n,r)}},$d=class extends n{constructor(e,t,n,r){super(),this.m_progressTracker=r,this.m_index=-1,e||R(``),this.m_envelope=t,this.m_inputGeometryCursor=e,this.m_spatialRefImpl=n,this.m_tolerance=Pn(n,t,!1).total()}next(){let e;return(e=this.m_inputGeometryCursor.next())?($e(e),this.m_index=this.m_inputGeometryCursor.getGeometryID(),qd(e,this.m_envelope,this.m_tolerance,0,this.m_progressTracker)):null}getGeometryID(){return this.m_index}tock(){return!0}getRank(){return 1}};function ef(e,t,n,r){return Jd(e,t,n,NaN,0,r)}var tf=Ou,nf=class extends n{constructor(e,t,n,r,i,a){super(),this.m_densificator=new tf(t,n,r,a,!1,i),this.m_index=-1,this.m_inputGeoms=e}tock(){return!0}getRank(){return 1}next(){let e=null;for(;e=this.m_inputGeoms.next();)return $e(e),this.m_index=this.m_inputGeoms.getGeometryID(),this.densify(e);return null}getGeometryID(){return this.m_index}densify(e){return this.m_densificator.densify(e)}},rf=class{getOperatorType(){return 10202}accelerateGeometry(e,t,n){return!1}canAccelerateGeometry(e){return!1}supportsCurves(){return!0}executeMany(e,t,n,r,i,a=12e3){return new nf(e,t,n,r,a,i)}execute(e,t,n,r,i,a=12e3){return Tu(e,t,n,r,i,a)}},af=class e{constructor(e){if(this.m_geom=this.m_sr=null,e){if(e.move)return this.m_geom=e.move.m_geom,e.move.m_geom=null,this.m_sr=e.move.m_sr,void(e.move.m_sr=null);if(e.copy)return this.m_geom=e.copy.m_geom?e.copy.m_geom.clone():null,void(this.m_sr=e.copy.m_sr);e.geom&&(this.m_geom=e.geom),e.sr&&(this.m_sr=e.sr)}}getGeometry(){return this.m_geom}getSpatialReference(){return this.m_sr}setGeometry(e){this.m_geom=e}setSpatialReference(e){this.m_sr=e}equals(e,t){let n=e;return!(!this.m_sr&&n.m_sr)&&!(this.m_sr&&!n.m_sr)&&!(!this.m_geom&&n.m_geom)&&!(this.m_geom&&!n.m_geom)&&!(this.m_sr&&n.m_sr&&!this.m_sr.equals(n.m_sr))&&!(this.m_geom&&n.m_geom&&!this.m_geom.equals(n.m_geom,t))}clone(){let t=null;return this.m_geom&&(t=this.m_geom.clone()),new e({geom:t,sr:this.m_sr})}hasGeom(){return!!this.m_geom}},sf=class{constructor(e){this.m_factor=1,this.m_wkid=0,this.m_peUnit=null,e&&(this.m_peUnit=e,this.m_factor=e.getUnitFactor(),this.m_wkid=e.getCode(),this.m_wkid<0&&(this.m_wkid=0))}getName(){return this.m_peUnit?this.m_peUnit.getName():``}getID(){return this.m_wkid}getConversionFactor(e){return this.getUnitType()!==e.getUnitType()&&R(`unit type mismatch`),this.getUnitToBaseFactor()/e.getUnitToBaseFactor()}getUnitToBaseFactor(){return this.m_factor}getHashCode(){return we(je(this.getUnitType()),je(this.getUnitToBaseFactor()))}equals(e){return!!e&&this.getUnitType()===e.getUnitType()&&this.getUnitToBaseFactor()===e.getUnitToBaseFactor()&&this.getID()===e.getID()&&this.getName()===e.getName()}static isValidWkid(e){return!1}},cf={330:104878,500:104879,1300:104899,1450:104986,2230:104988,3800:104978,5e3:104919,6200:104906,8200:104909,9500:104927,9600:104977,1e4:[104911,104936],11e3:104941,11080:104872,11100:104907,12e3:104920,12400:104995,13e3:104948,14e3:[104923,104989],15e3:[104913,104954],15100:104976,16e3:[104926,104931],18e3:[104922,104982],21e3:104947,21500:104877,27e3:[104950,104957],29e3:104964,3e4:104921,31e3:104949,33e3:104946,4e4:[104914,104967],40600:104897,41900:104937,42e3:104951,43100:104993,49300:104924,50100:104939,54e3:104955,58200:104981,59500:104930,74e3:104961,77e3:104956,79e3:104962,83500:104910,85e3:104917,88800:104934,89200:104985,96e3:104997,104e3:104963,106500:104898,11e4:104938,133e3:104932,135e3:104983,17e4:104965,198200:104987,198630:104935,208e3:104966,235800:104952,249400:104929,252100:104980,255e3:104973,47e4:104972,529800:104942,531e3:104996,56e4:104928,561400:104979,578900:104945,584700:104959,593e3:104970,606e3:104999,718e3:104933,745700:104984,761400:104953,763500:104994,764e3:104940,788900:104958,1188300:104998,1195e3:104969,1352600:104968,1560800:104874,1562090:104915,1737400:104903,1821460:104918,1821490:104876,2409300:104912,2410300:104873,2439400:104974,2439700:104900,2575e3:104943,2631200:104875,2632345:104916,3393400:104904,3396190:[104905,104971],6051e3:104901,6051800:104902,637e4:104128,6370997:[4052,37008],6371e3:4035,6371007:4047,6371228:[4053,10346],6376045:[8042,8043],6376523:[4027,4901,4902],6376896:37007,6378135:[4122,4322,4324,4720,4985,4987],6378136:[4740,4923,7678,7680,9474,9475,104017,104018],6378137:[3823,3824,3888,3889,4017,4019,4023,4031,4040,4046,4055,4074,4075,4080,4081,4121,4126,4130,4133,4140,4141,4148,4151,4152,4163,4166,4167,4170,4171,4172,4173,4176,4180,4189,4190,4258,4269,4283,4318,4319,4326,4463,4466,4469,4470,4480,4482,4483,4490,4557,4558,4612,4617,4619,4624,4627,4659,4661,4667,4669,4670,4674,4686,4687,4693,4694,4702,4737,4742,4747,4749,4750,4755,4756,4757,4758,4759,4761,4762,4763,4764,4765,4883,4885,4887,4889,4893,4895,4898,4907,4909,4921,4925,4927,4929,4931,4933,4935,4937,4939,4941,4943,4945,4947,4949,4951,4953,4955,4957,4959,4961,4963,4965,4967,4971,4975,4977,4979,4981,4983,4989,4997,4999,5012,5013,5245,5246,5251,5252,5263,5264,5323,5324,5340,5342,5353,5354,5359,5360,5364,5365,5370,5371,5372,5373,5380,5381,5392,5393,5488,5489,5545,5546,5592,5593,5885,5886,6134,6135,6310,6311,6318,6319,6321,6322,6324,6325,6364,6365,6667,6668,6705,6706,6782,6783,6980,6982,6983,6987,6989,6990,7034,7035,7036,7037,7038,7039,7040,7041,7042,7072,7073,7084,7085,7086,7087,7133,7135,7136,7138,7139,7372,7373,7657,7659,7661,7663,7665,7685,7686,7797,7798,7816,7843,7844,7880,7881,7885,7886,7900,7901,7902,7903,7904,7905,7906,7907,7908,7909,7910,7911,7912,7915,7917,7919,7921,7923,7925,7927,7929,7931,8085,8086,8231,8232,8235,8237,8239,8240,8244,8246,8248,8249,8251,8252,8254,8255,8399,8403,8426,8427,8449,8542,8544,8545,8684,8685,8698,8699,8817,8818,8860,8888,8899,8900,8901,8902,8906,8907,8916,8918,8920,8922,8924,8926,8928,8930,8932,8934,8936,8938,8940,8942,8944,8946,8948,8949,8972,8973,8974,8975,8976,8977,8978,8979,8980,8981,8982,8983,8984,8985,8986,8987,8988,8989,8990,8991,8992,8993,8994,8995,8996,8997,8998,8999,9e3,9002,9003,9005,9006,9008,9009,9011,9012,9013,9014,9016,9017,9018,9019,9053,9054,9055,9056,9057,9059,9060,9061,9062,9063,9064,9065,9066,9067,9068,9069,9071,9072,9074,9075,9139,9140,9147,9148,9152,9153,9183,9184,9293,9294,9299,9308,9309,9332,9333,9364,9372,9379,9380,9384,9453,9469,9470,9546,9547,9695,9696,9701,9702,9739,9754,9755,9758,9763,9776,9777,9778,9779,9781,9782,9783,9784,9866,9871,9939,9964,9969,9974,9989,9990,10175,10177,10178,10185,10191,10196,10204,10209,10214,10219,10224,10229,10237,10272,10277,10283,10284,10298,10299,10300,10304,10305,10307,10309,10310,10311,10312,10327,10328,10413,10414,10468,10474,10475,10570,10571,10605,10606,10623,10628,10638,10639,10670,10671,10672,10673,10689,10690,10724,10725,10738,10739,10761,10762,10780,10781,10784,10785,10799,10800,20033,20040,20041,20045,20046,104009,104010,104011,104012,104013,104014,104015,104016,104019,104020,104021,104022,104024,104027,104028,104050,104100,104107,104108,104110,104111,104114,104115,104116,104117,104118,104119,104120,104121,104122,104123,104124,104129,104133,104134,104137,104141,104142,104143,104144,104145,104179,104180,104181,104182,104183,104184,104185,104186,104199,104223,104257,104258,104259,104260,104286,104287,104602,104613,104644,104645,104646,104647,104653,104804,104896,104991],6378140:4610,6378145:[4025,4276,4760,4891,37001],6378150:37003,6378155:[37004,37207],6378160:[3821,4003,4021,4036,4202,4203,4237,4238,4291,4618,4708,5527,37231,104023,104136],6378166:37002,6378200:[4020,4229,4286,4303,4706],6378245:[4024,4147,4164,4178,4179,4191,4200,4205,4214,4284,4317,4555,4676,4677,4678,4991,4993,5560,5561,37257,104135],6378270:[4732,37005,37229],6378273:[4054,10345],6378300:[4029,4168,4174],6378388:[4022,4123,4153,4154,4158,4159,4160,4161,4165,4181,4182,4183,4184,4185,4192,4194,4195,4196,4199,4204,4207,4208,4215,4218,4221,4224,4225,4230,4231,4233,4235,4236,4247,4248,4249,4254,4255,4259,4264,4265,4271,4272,4274,4285,4287,4288,4292,4297,4309,4311,4313,4316,4472,4475,4611,4614,4615,4616,4621,4622,4623,4625,4626,4628,4629,4630,4631,4632,4633,4636,4637,4639,4641,4642,4643,4644,4645,4646,4658,4660,4662,4663,4664,4665,4668,4672,4673,4684,4688,4689,4690,4691,4692,4698,4704,4705,4707,4709,4710,4711,4712,4714,4715,4716,4718,4719,4721,4722,4724,4725,4727,4728,4729,4730,4733,4734,4735,4739,4741,4753,4754,4802,4803,4806,4809,4810,4823,4824,4900,5524,6883,8428,8430,8431,9248,9251,9253,9403,9893,10158,10249,10252,10635,10636,10735,10736,10758,37201,37204,37205,37212,37213,37214,37215,37216,37217,37218,37219,37221,37222,37224,37226,37227,37230,37232,37233,37234,37235,37237,37238,37241,37242,37245,37246,37247,37249,37250,37251,37253,37259,104104,104106,104125,104126,104127,104130,104138,104248],6378523:104786,24764e3:104960,25559e3:104944,60268e3:104925,71492e3:104908,6957e5:104975,6377397.155:[3819,3906,4004,4120,4124,4125,4149,4150,4156,4162,4211,4219,4257,4262,4280,4289,4294,4295,4301,4306,4308,4312,4314,4613,4666,4745,4746,4801,4804,4805,4808,4813,4814,4815,4818,4820,4904,5132,5228,5229,5681,5830,8351,9267,10268,37255,104101,104102,104105,104131,104648,104696,104697,104990,104992],6377563.396:[4001,4188,4277,4278,4279],6377340.189:[4002,4299,4300],6377492.018:[4005,4273,4817],6377483.865280418:[4006,4293],6378293.645208759:[4007,4157,4302,4738,5464],6378206.4:[4008,4127,4128,4129,4135,4136,4137,4138,4139,4169,4216,4242,4253,4267,4608,4609,4638,4675,4683,4695,4717,4723,4726,4995,5451,5467,37220,37239,37243,37252,37260,104e3,104109,104112,104113,104132],6378450.047:[4009,4268],6378300.789:[4010,4281],6378249.2:[4011,4014,4155,4193,4206,4213,4223,4226,4227,4228,4252,4261,4266,4275,4282,4296,4304,4310,4315,4671,4807,4811,4816,4821,37223,37225,104139,104140,104261,104304],6378249.145:[4012,4013,4132,4134,4142,4143,4175,4197,4198,4201,4209,4210,4212,4220,4222,4232,4234,4246,4250,4251,4256,4260,4263,4270,4305,4307,4600,4601,4602,4603,4604,4605,4606,4607,4620,4679,4680,4696,4697,4699,4700,4701,4703,4713,4731,4736,4743,4744,4812,4819,6881,6882,6892,6894,8694,37206,37208,37211,37228,37240,37254,104025,104026,104103,104305],6377276.345:[4015,4131,4144,4239,4240,4244,4682,5233,6207,37202,104256,104664,104693],6377298.556:[4016,4298],6377304.063:[4018,4245],6378298.3:[4028,4903],6378136.2:4032,6378136.3:4033,6378249.144808011:[4034,4241],20922931.8:[4042,4243],6377301.243:[4044,4145,37203],6377299.151:[4045,4146],6377019.27:[4657,10256,10260,10265],6378306.3696:[4748,4752],6377295.664:[4751,37006],6378136.5:[7682,7683],6371008.7714:104047,6378418.941:[104700,104726,104760],6378586.581:[104701,104743],6378505.809:104702,6378544.823:104703,6378490.569:104704,6378470.757:[104705,104776],6378403.701:[104706,104750],6378434.181:[104707,104724,104739,104764],6378454.907:104708,6378400.653:104709,6378567.378:104710,6378546.957:[104711,104717,104780],6378476.853:[104712,104736],6378411.321:[104713,104728],6378647.541:[104714,104715],6378514.953:[104716,104782],6378421.989:[104718,104770],6378481.425:[104719,104753,104774,104781],6378518.001:[104720,104725],6378521.049:[104721,104723,104731,104745,104748],6378464.661:104722,6378436.619:104727,6378574.389:[104729,104730],6378472.281:[104732,104756],6378498.189:[104733,104746],6378449.421:[104734,104766],6378525.621:[104735,104754],6378466.185:104737,6378496.665:104738,6378643.579:104740,6378559.758:104741,6378414.369:[104742,104763,104772],6378441.801:104744,6378502.761:[104747,104759,104773,104775],6378617.061:104749,6378624.681:[104751,104765],6378468.623:104752,6378445.763:[104755,104758,104761],6378670.401:104757,6378438.753:104762,6378543.909:104767,6378605.783:104768,6378540.861:104769,6378443.325:[104771,104784],6378548.481:104777,6378463.746:104778,6378426.561:104779,6378453.688:104783,6378530.193:104785,6378376.271:[104800,104828],6378471.92:104801,6378472.931:104802,6378411.351:104803,6378380.991:104805,6378414.96:104806,6378345.09:[104807,104819,104844,104870],6378412.542:104808,6378470.401:104809,6378376.331:104810,6378379.031:104811,6378407.621:104812,6378376.811:[104813,104827],6378313.92:104814,6378414.93:104815,6378413.021:104816,6378380.381:104817,6378530.851:104818,6378591.521:104820,6378378.881:104821,6378408.481:[104822,104832],6378375.601:[104823,104838],6378408.041:104824,6378655.071:104825,6378409.151:104826,6378315.7:[104829,104840,104845,104851],6378285.86:[104830,104835,104859],6378379.301:104831,6378560.121:104833,6378531.821:104834,6378500.6:104836,6378376.041:104837,6378406.601:104839,6378438.991:104841,6378345.42:104842,6378593.86:104843,6378381.271:[104846,104847],6378413.671:104848,6378344.377:104849,6378563.891:104850,6378408.091:104852,6378377.671:104853,6378472.751:104854,6378412.511:104855,6378407.281:104856,6378534.451:104857,6378406.051:104858,6378532.921:104860,6378380.091:104861,6378408.941:104862,6378624.171:104863,6378377.411:104864,6378474.591:104865,6378407.141:104866,6378376.871:104867,6378375.251:104868,6378405.971:104869,6378437.651:104871};function lf(){for(let e in cf)delete cf[e]}var uf=class extends sf{constructor(e){if(typeof e==`number`)return super(),this.m_factor=e,void(this.m_wkid=0);super(e)}getUnitType(){return 1}convertFromRadians(e){return e/this.getUnitToBaseFactor()}convertToRadians(e){return e*this.getUnitToBaseFactor()}};function df(e){return new _S}function ff(e){return e.getType()===$.PE_TYPE_LINUNIT?new _S(e):e.getType()===$.PE_TYPE_ANGUNIT?new uf(e):void R(`peUnit`)}function pf(e){let t=wC(null);return e.getType()===$.PE_TYPE_PROJCS||e.getType()===$.PE_TYPE_GEOGCS?t.reset(e.getUnit()):R(`PE_coord_sys`),t.get()||B(`cannot create units from coord sys`),ff(t.get())}var mf=class e{constructor(e,t,n){e===void 0?(this.x=new P,this.y=new P,this.z=new P):e instanceof K?(this.x=new P(e.x),this.y=new P(e.y),this.z=new P(e.z)):e instanceof P?(this.x=e.clone(),this.y=t.clone(),this.z=n.clone()):R(`EPoint3D constructor`)}dotProduct(e){return this.x.mulE(e.x).addE(this.y.mulE(e.y)).addE(this.z.mulE(e.z))}crossProduct(t){return new e(this.y.mulE(t.z).subE(this.z.mulE(t.y)),this.z.mulE(t.x).subE(this.x.mulE(t.z)),this.x.mulE(t.y).subE(this.y.mulE(t.x)))}crossProductVector(t){let n=this.y.mulE(t.z).subE(t.y.mulE(this.z)),r=t.x.mulE(this.z).subE(this.x.mulE(t.z)),i=this.x.mulE(t.y).subE(t.x.mulE(this.y));return new e(n,r,i)}sqrLength(){return this.x.mulE(this.x).addE(this.y.mulE(this.y)).addE(this.z.mulE(this.z))}length(){return this.sqrLength().sqrt()}static distance(e,t){return e.sub(t).length()}negate(){return new e(this.x.negate(),this.y.negate(),this.z.negate())}add(t){return new e(this.x.addE(t.x),this.y.addE(t.y),this.z.addE(t.z))}sub(t){return new e(this.x.subE(t.x),this.y.subE(t.y),this.z.subE(t.z))}subThis(e){return this.x.subThisE(e.x),this.y.subThisE(e.y),this.z.subThisE(e.z),this}addThis(e){return this.x.addThisE(e.x),this.y.addThisE(e.y),this.z.addThisE(e.z),this}mul(t){return new e(this.x.mulE(t),this.y.mulE(t),this.z.mulE(t))}div(t){return new e(this.x.divE(t),this.y.divE(t),this.z.divE(t))}eq(e){return this.x.eq(e.x)&&this.y.eq(e.y)&&this.z.eq(e.z)}isZero(){return this.x.isZero()&&this.y.isZero()&&this.z.isZero()}value(){return K.construct(this.x.value(),this.y.value(),this.z.value())}},hf=class{constructor(e){if(this.m_origin=new K,this.m_normal=new K,this.m_axisX=new K,this.m_axisY=new K,!e)return this.m_origin=new K,this.m_normal=new K(0,0,1),this.m_axisX=new K(1,0,0),void(this.m_axisY=new K(0,1,0));e.pt0&&e.pt1&&e.pt2?this.setFromPoints(e.pt0,e.pt1,e.pt2):U(0,`unimplemented constructor options ${JSON.stringify(e)}`)}assign(e){return U(0),this}set(e,t,n,r){U(0)}setFromPoints(e,t,n){let r=t.sub(e),i=n.sub(e);this.m_normal=r.crossProductVector(i);let a=!0;if(this.m_normal.isZero()){if(a=!1,r.isZero()&&(r=i),r.isZero())return this.m_normal.setCoords(0,0,1),this.m_axisX.setCoords(1,0,0),this.m_axisY.setCoords(0,1,0),this.m_origin=e,!1;this.m_axisX=r.getUnitVector(),this.m_normal=this.m_axisX.createAPerpendicular()}else this.m_normal.normalizeThis(),this.m_axisX=r.getUnitVector();return this.m_axisY=this.m_normal.crossProductVector(this.m_axisX),this.m_origin=e,a}getCoord(e,t){return U(0),{}}getCoord2D(e){return U(0),{}}getCoordX(e,t){return U(0),0}getCoordY(e,t){return U(0),0}getCoordZ(e,t){return U(0),0}setPreferredAxisX(e){U(0)}getOrigin(){return U(0),{}}getNormal(){return U(0),{}}getAxisX(){return this.m_axisX.clone()}getAxisY(){return this.m_axisY.clone()}setAxisX(e,t=!1){U(0)}setAxisY(e,t=!1){U(0)}recalculateAxisY(){U(0)}setOrigin(e){U(0)}setNormal(e,t){U(0)}intersect(e,t){return U(0),!1}intersectLine(e){return U(0),0}intersectLineEx(e,t){return U(0),0}closestCoordinate(e){let t=e.sub(this.m_origin),n=new z;return n.x=t.dotProduct(this.m_axisX),n.y=t.dotProduct(this.m_axisY),n}projectVector(e){return U(0),{}}signedDistance(e){return U(0),0}distance(e){return U(0),0}};function gf(e,t){return!1}function _f(e,t,n,r,i=100,a=gf){let o,s,c,l,u,d,f,p,m;U(r>0);let h,g,v,y=0,b=0,x=_();t>n&&(n=W(t,t=n));let S=e(t),C=e(n);S<C?(o=s=c=t,l=u=d=S):(o=s=c=n,l=u=d=C);let w=0;for(;w<i&&(v=.5*(n-t),m=t+v,h=r*(Math.abs(o)+.25),g=2*h,!(a(o,l)||Math.abs(o-m)<=g-v));++w){if(Math.abs(b)>h){let e=(o-s)*(l-d),r=(o-c)*(l-u),i=(o-c)*r-(o-s)*e;r=2*(r-e),r>0&&(i=-i),r=Math.abs(r);let a=b;b=y,Math.abs(i)>=Math.abs(r*a*.5)||i<=r*(t-o)||i>=r*(n-o)?(b=o>=m?t-o:n-o,y=_()*b):(y=i/r,p=o+y,(p-t<g||n-p<g)&&(y=m-o<0?-Math.abs(h):Math.abs(h)))}else b=o>=m?t-o:n-o,y=b*x;p=o+y,f=e(p),f<l?(p>=o?t=o:n=o,c=s,s=o,o=p,d=u,u=l,l=f):(p<o?t=p:n=p,f<=u||s===o?(c=s,s=p,d=u,u=f):(f<=d||c===o||c===s)&&(c=p,d=f))}return lt(o,l)}function vf(e,t,n){return e>n?e-=Math.ceil((e-n)/o)*o:e<t&&(e+=Math.ceil((t-e)/o)*o),e}function yf(e,t,n){return bf(e,t,n,0)}function bf(e,t,n,r){let i=n.x,a=n.y;return Sf(e,t,Math.cos(i),Math.sin(i),Math.cos(a),Math.sin(a),r)}function xf(e,t,n,r,i,a){return Sf(e,t,n,r,i,a,0)}function Sf(e,t,n,r,i,a,o){let s=e/Math.sqrt(1-t*a*a),c=s+o,l=c*i*n,u=c*i*r,d=(s*(1-t)+o)*a;return K.construct(l,u,d)}function Cf(e,t,n){let r=new P,i=new P,a=new P,o=new P;r.setCos(n.x),i.setSin(n.x),a.setCos(n.y),o.setSin(n.y);let s=o.negate().mulE(o.mul(t)).add(1).sqrt(),c=new P(e).divE(s),l=c.mulE(a).mulE(r),u=c.mulE(a).mulE(i),d=c.mul(1-t).mulE(o);return new mf(l,u,d)}function wf(e,t,n){let r=n.x,i=n.y,a=n.z,o=Math.atan2(i,r),s=Math.sqrt(r*r+i*i),c=Math.atan2(a,(1-t)*s);return z.construct(o,c)}function Tf(e,t,n){let r=1-t,i=e/Math.sqrt(Ct(n.x)+Ct(n.y)+Ct(n.z)/r);return n.mul(i)}function Ef(e,t,n,r,i){let a=yf(e,t,n),o=yf(e,t,r);return wf(e,t,K.lerp(a,o,i))}function Df(n,r,i,a){let o={stack:[],error:void 0,hasError:!1};try{let e=t(o,new mC,!1);return xC.geodeticDistance(n,r,i.x,i.y,a.x,a.y,e,null,null,$.PE_LINETYPE_GEODESIC),e.val}catch(e){o.error=e,o.hasError=!0}finally{e(o)}}function Of(e,t,n,r,i){switch(U(n.isFinite()&&r.isFinite()),i){case 0:return Df(e,t,n,r);case 1:return jf(e,t,n);case 2:case 3:{let i=yf(e,t,n),a=yf(e,t,r);return K.distance(i,a)}default:xt(``)}}function kf(e,t,n,r,i,a=0,o){if(a===2||a===3)return Af(e,t,n,r,i,a===3,o);let s=wf(e,t,n),c=n=>{let o=wf(e,t,K.lerp(r,i,n));return Of(e,t,s,o,a)},l=K.distance(r,i);if(l>0){let n=Hf(e,l),{first:a,second:s}=_f(c,0,1,n);return o&&o.assign(Tf(e,t,K.lerp(r,i,a))),lt(a,s)}{let e=c(0);return o&&o.assign(r),lt(.5,e)}}function Af(e,t,n,r,i,a=!1,o){let s=Tf(e,t,n);if(a){let a=new hf({pt0:new K(0,0,0),pt1:r,pt2:i}),c=a.closestCoordinate(n),l=a.closestCoordinate(r),u=a.closestCoordinate(i),d=z.getClosestCoordinate(l,u,c),f=Tf(e,t,K.lerp(r,i,d)),p=K.distance(f,s);return o&&o.assign(f),lt(d,p)}let c=n=>{let a=Tf(e,t,K.lerp(r,i,n));return K.distance(a,s)},l=K.distance(r,i);if(l>0){let n=Hf(e,l),{first:a,second:s}=_f(c,0,1,n);return o&&o.assign(Tf(e,t,K.lerp(r,i,a))),lt(a,s)}{let e=K.distance(n,r);return o&&o.assign(n),lt(.5,e)}}function jf(n,r,i,a){let o={stack:[],error:void 0,hasError:!1};try{let e=t(o,new mC,!1);return xC.greatEllipticDistance(n,r,i.x,i.y,i.x,i.y,e,null,null),e.val}catch(e){o.error=e,o.hasError=!0}finally{e(o)}}function Mf(e,t,n,r,i){if(Math.abs(n.x-r.x)>Math.PI||Math.abs(n.y)>nt||Math.abs(r.y)>nt||(Math.abs(n.y)===nt||Math.abs(r.y)===nt)&&n.x!==r.x)return NaN;let{first:a,second:o}=de(n.x,r.x),s=i;if(s=vf(s,a,o),!I.construct(n.x,r.x).containsCoordinate(s))return NaN;let c=J.constructPoint2D(n),l=J.constructPoint2D(r),u=Cf(1,t,c),d=Cf(1,t,l),f=u.crossProductVector(d);if(f.z.isZero())return n.y;let p=f.x.divE(f.z.negate()),m=f.y.divE(f.z.negate()),h=p.mulE(p).addE(m.mulE(m)).sqrt();if(h.isZero()||p.isZero()&&m.isZero())return n.y;let g=Math.atan2(m.value(),p.value()),_=Math.atan2(h.value()*Math.cos(g-s),1-t),v=yf(1,t,z.construct(s,_)),y=K.construct(v.x,v.y,-v.z),b=f.value().dotProduct(v),x=f.value().dotProduct(y);return Math.abs(x)<Math.abs(b)&&(_=-_),_}function Nf(e,t,n,r,i,a){if(a[0]=NaN,a[1]=NaN,Math.abs(n.x-r.x)>Math.PI||Math.abs(n.y)>nt||Math.abs(r.y)>nt||(Math.abs(n.y)===nt||Math.abs(r.y)===nt)&&n.x!==r.x||Math.abs(i)>=nt||n.y>0&&r.y>0&&n.y>i&&r.y>i||n.y<0&&r.y<0&&n.y<i&&r.y<i)return 0;let o=J.constructPoint2D(n),s=J.constructPoint2D(r),c=Cf(1,t,o),l=Cf(1,t,s),u=c.crossProductVector(l);if(u.z.isZero())return I.construct(n.y,r.y).containsCoordinate(i)?(a[0]=n.x,1):0;let d=u.x.divE(u.z.negate()),f=u.y.divE(u.z.negate()),p=d.mulE(d).addE(f.mulE(f)).sqrt();if(p.isZero()||d.isZero()&&f.isZero())return i===0?(a[0]=n.x,a[1]=r.x,2):0;let m=(1-t)*Math.tan(i)/p.value();if(Math.abs(m)>1)return 0;let h=Math.acos(m),g=Math.atan2(f.value(),d.value()),_=g-h,v=g+h,y=Math.min(n.x,r.x),b=Math.max(n.x,r.x);vf(_,y,b),i===0?v=_:vf(v,y,b);let x=0;return y<=_&&_<=b&&(a[x]=_,x++),v!==_&&y<=v&&v<=b&&(a[x]=v,x++),x}function Pf(e,t){t[0]>.5*Math.PI?(e[0]+=Math.PI,t[0]=Math.PI-t[0]):t[0]<.5*-Math.PI&&(e[0]-=Math.PI,t[0]=-Math.PI-t[0]),U(t[0]>=.5*-Math.PI&&t[0]<=.5*Math.PI)}function Ff(e,t){return e*Math.sqrt(1-t)}function If(e){return 1-e}function Lf(e,t,n,r,i){r=_e(r,-nt,nt),i=_e(i,-nt,nt);let a=nt-.03,o;return o=r>a&&i>a||r<-a&&i<-a?Rf(e,r,i):zf(e,i)-zf(e,r),.5*(n-t)*o*If(e)}function Rf(e,t,n){let r=1;if(t<0&&(r=-1,t=-t,n=-n),e!==0){let i=e*e,a=i*e,o=[1,(1+11*e)/12,(1+118*e+241*i)/360,(1+1089*e+10419*i+8651*a)/20160,(1+9836*e+318246*i+1027436*a+458881*(a*e))/1814400],s=t=>{let n=0,r=Ct(t)/(e-1);for(let e=o.length-1;e>=0;--e)n=o[e]+n*r;return n*=-Ct(t/(1-e)),n},c=s(nt-t);return(s(nt-n)-c)*r}{let e=nt-t,i=nt-n,a=-4*Ct(Math.sin(e/2));return(-4*Ct(Math.sin(i/2))-a)*r}}function zf(e,t){if(t===0)return 0;let n=Math.sin(t),r=n,i=n;return e!==0&&(r/=1-e*n*n,i=n*b(Math.sqrt(e)*n)),r+i}function Bf(e,t){return(1-t)*e}function Vf(e,t,n){let r=n/(2*Bf(e,t)),i=r*r;return n*(1-i*(.16666666666666666-.008333333333333333*i))}function Hf(e,t){if(t!==0){let n=e*w()/t;return Math.min(n,1e-10)}return 0}var Uf=class e{constructor(e){this.m_currentShift=63n,this.m_currentElt=0n,this.m_iCurrentElt=-1,this.m_parent=e,this.m_aiSetElts=e.m_bits.flatMap((e,t)=>t)}next(){if(this.m_currentShift++,this.m_currentShift===64n){if(this.m_iCurrentElt++,this.m_iCurrentElt===this.m_aiSetElts.length)return e.npos();this.m_currentShift=0n,this.m_currentElt=this.m_parent.m_bits[this.m_aiSetElts[this.m_iCurrentElt]]}for(;this.m_currentShift<63n&&!(this.m_currentElt&1n<<this.m_currentShift);)this.m_currentShift++;return this.m_currentElt&1n<<this.m_currentShift?64*this.m_aiSetElts[this.m_iCurrentElt]+Number(this.m_currentShift):this.next()}static npos(){return 2**53-1}};function Wf(e){return 1n<<(63n&BigInt(e))}function Gf(e){return e>>6}var Kf=class{constructor(e){this.m_bits=[],e!==void 0&&e.copy&&(this.m_bits=e.copy.m_bits.slice())}assignMove(){return this}assignCopy(){return this}hasBit(e){let t=Wf(e),n=Gf(e);return this.m_bits[n]!==void 0&&!!(this.m_bits[n]&t)}setBit(e){let t=Wf(e),n=Gf(e);this.m_bits[n]===void 0&&(this.m_bits[n]=0n),this.m_bits[n]|=t}clearBit(e){}flipBit(e){let t=Wf(e),n=Gf(e);return this.m_bits[n]===void 0&&(this.m_bits[n]=0n),this.m_bits[n]^=t,(this.m_bits[n]&t)!==0n}clear(){this.m_bits.length=0}isZero(){let e=0;return this.m_bits.forEach(t=>{e|=t?2:1}),!(2&e)}equals(e){if(this===e)return!0;if(this.m_bits.length!==e.m_bits.length)return!1;let t=0;return this.m_bits.forEach((n,r)=>{t|=n===e.m_bits[r]?2:1}),!(1&t)&&(e.m_bits.forEach((e,n)=>{t|=e===this.m_bits[n]?2:1}),!(1&t))}notEquals(e){return!this.equals(e)}assignOr(e){return e.m_bits.forEach((e,t)=>{this.m_bits[t]===void 0?this.m_bits[t]=e:this.m_bits[t]|=e}),this}assignSubtract(e){return e.m_bits.forEach((e,t)=>{this.m_bits[t]!==void 0&&(this.m_bits[t]&=~e)}),this}assignAnd(e){return e.m_bits.forEach((e,t)=>{this.m_bits[t]!==void 0&&(this.m_bits[t]&=e)}),this}assignXor(e){return e.m_bits.forEach((e,t)=>{this.m_bits[t]===void 0?this.m_bits[t]=e:this.m_bits[t]^=e}),this}getHashCode(){return this.m_bits.reduce((e,t)=>ie(e,t),je(0))}getUnorderedBitIterator(){return new Uf(this)}},qf=class{constructor(e,t){this.m_map=new Map,this.m_hf=e,this.m_ef=t}add(e){let t=this.m_hf(e);if(!this.m_map.has(t))return this.m_map.set(t,e),this;let n=this.m_map.get(t);return n instanceof Array?n.find(t=>this.m_ef(t,e))||n.push(e):this.m_ef(n,e)||this.m_map.set(t,[n,e]),this}clear(){this.m_map.clear()}delete(e){return!1}has(e){let t=this.m_hf(e);if(!this.m_map.has(t))return!1;let n=this.m_map.get(t);return n instanceof Array?n.find(t=>this.m_ef(t,e))!==void 0:this.m_ef(n,e)}get(e){let t=this.m_hf(e),n=this.m_map.get(t);if(n!==void 0)return n instanceof Array?n.find(t=>this.m_ef(t,e)):n}get size(){let e=0;for(let t of this.m_map.values())e+=t instanceof Array?t.length:1;return e}forEach(e,t){}[Symbol.iterator](){return new Set()[Symbol.iterator]()}entries(){return new Set().entries()}keys(){return new Set().keys()}values(){return new Set().values()}get[Symbol.toStringTag](){return`ValueSet`}},Jf=class extends vn{constructor(e){super(),this.m_bufferLeft=new Q,this.m_bufferRight=new Q,this.m_intervalLeft=I.constructEmpty(),this.m_intervalRight=I.constructEmpty(),this.m_yScanline=NaN,this.m_helper=e}compare(e,t,n){let r=t,i=e.getElement(n);this.m_helper.querySegmentXY(r,this.m_bufferLeft),this.m_helper.querySegmentXY(i,this.m_bufferRight);let a=this.m_bufferLeft.get(),o=this.m_bufferRight.get();if(this.m_intervalLeft.setCoords(a.getStartX(),a.getEndX()),this.m_intervalRight.setCoords(o.getStartX(),o.getEndX()),this.m_intervalLeft.vmax<this.m_intervalRight.vmin)return-1;if(this.m_intervalLeft.vmin>this.m_intervalRight.vmax)return 1;let s=a.getStartY()===a.getEndY(),c=o.getStartY()===o.getEndY();if(s||c){if(s&&c)return 0;if(a.getStartY()===o.getStartY()&&a.getStartX()===o.getStartX())return s?1:-1;if(a.getEndY()===o.getEndY()&&a.getEndX()===o.getEndX())return s?-1:1}let l=a.intersectionOfYMonotonicWithAxisX(this.m_yScanline,this.m_intervalLeft.vmin),u=o.intersectionOfYMonotonicWithAxisX(this.m_yScanline,this.m_intervalRight.vmin);if(l===u){let e=a.getEndY(),t=o.getEndY(),n=Math.min(e,t),r=.5*(n+this.m_yScanline);r===this.m_yScanline&&(r=n),l=a.intersectionOfYMonotonicWithAxisX(r,this.m_intervalLeft.vmin),u=o.intersectionOfYMonotonicWithAxisX(r,this.m_intervalRight.vmin)}return l<u?-1:l>u?1:0}setY(e){this.m_yScanline=e}},Yf=class{constructor(e){this.m_segmentBuffer=new Q,this.m_point=z.getNAN(),this.m_parent=e}setPointXY(e){this.m_point.assign(e)}compare(e,t){let n=e.getElement(t);this.m_parent.querySegmentXY(n,this.m_segmentBuffer);let r=this.m_segmentBuffer.get(),i=new I;if(i.setCoords(r.getStartX(),r.getEndX()),this.m_point.x<i.vmin)return-1;if(this.m_point.x>i.vmax)return 1;let a=r.intersectionOfYMonotonicWithAxisX(this.m_point.y,this.m_point.x);return this.m_point.x<a?-1:this.m_point.x>a?1:0}},Xf,Zf;function Qf(e,t){return{parentage:e,rank:t}}function $f(e,t){let n=e.length;if(n!==t.length)return!1;let r=e[0].parentage;if(r!==t[0].parentage)return!1;if(r===-1)return!0;for(let r=1;r<n;++r)if(e[r].parentage!==t[r].parentage)return!1;return!0}function ep(e,t,n){n.length=0;let r=!1;{let i=e.getHalfEdgeVertexIterator(t);for(;i!==-1;){let t=e.getVertexFromVertexIterator(i),a=e.getShape().getSegmentRank(t),o=e.getShape().getSegmentParentage(t);r||=o>=0,n.push(Qf(o,a)),i=e.incrementVertexIterator(i)}}{let i=e.getHalfEdgeVertexIterator(e.getHalfEdgeTwin(t));for(;i!==-1;){let t=e.getVertexFromVertexIterator(i),a=e.getShape().getSegmentRank(t),o=e.getShape().getSegmentParentage(t);r||=o>=0,n.push(Qf(o,a)),i=e.incrementVertexIterator(i)}}r&&n.sort((e,t)=>e.rank>t.rank?-1:e.rank<t.rank?1:e.parentage<t.parentage?-1:e.parentage>t.parentage?1:0),n[0].parentage===-1&&(n.length=1)}function tp(){return new qf(e=>e.getHashCode(),(e,t)=>e.equals(t))}(function(e){e[e.enumInputModeBuildGraph=0]=`enumInputModeBuildGraph`,e[e.enumInputModeSimplifyAlternate=1]=`enumInputModeSimplifyAlternate`,e[e.enumInputModeSimplifyWinding=2]=`enumInputModeSimplifyWinding`})(Xf||={}),function(e){e[e.enumSegmentParentageBreakNode=1]=`enumSegmentParentageBreakNode`,e[e.enumPathBreakNode=2]=`enumPathBreakNode`}(Zf||={});var np=class e{constructor(){this.m_shape=null,this.m_clusterData=new pn(8),this.m_clusterVertices=new pn(2),this.m_firstCluster=-1,this.m_lastCluster=-1,this.m_halfEdgeData=new pn(8),this.m_chainData=new pn(8),this.m_chainAreas=null,this.m_chainPerimeters=null,this.m_universeChain=-1,this.m_simplifiedGeometry=-1,this.m_edgeIndices=[],this.m_clusterIndices=[],this.m_chainIndices=[],this.m_bBuildGeometryParentageSets=!1,this.m_chainBitSetIndex=-1,this.m_edgeBitSetIndex=-1,this.m_edgeBitSetIndexLeft=-1,this.m_emptyBitSet=null,this.m_geometryMapID=null,this.m_uniqueBitSets=null,this.m_chainBitSets=[],this.m_edgeBitSets=[],this.m_checkDirtyPlanesweepTolerance=NaN,this.m_geometryIDIndex=-1,this.m_clusterIndex=-1,this.m_halfEdgeIndex=-1,this.m_tmpHalfEdgeParentageIndex=-1,this.m_tmpHalfEdgeParentageIndexLeft=-1,this.m_tmpHalfEdgeWindingNumberIndex=-1,this.m_tmpHalfEdgeOddEvenNumberIndex=-1,this.m_segmentParentageIndex=-1,this.m_segmentIndexHe=-1,this.m_clusterBreakNodeIndex=-1,this.m_universeGeomID=-1,this.m_pointCount=0,this.m_progressCounter=0,this.m_bBuildChains=!0,this.m_bDirtyCheckFailed=!1}setCheckDirtyPlanesweepTolerance(e){this.m_checkDirtyPlanesweepTolerance=e}dirtyCheckFailed(){return this.m_bDirtyCheckFailed}getShape(){return this.m_shape}setEditShape(e,t,n=!0,r=!1){r?this.setEditShapeImpl3D_(e,Xf.enumInputModeBuildGraph,null,t,!1):this.setEditShapeImpl_(e,Xf.enumInputModeBuildGraph,null,t,n)}setAndSimplifyEditShapeAlternate(e,t,n=null,r=!1){let i=[];i.push(t),this.m_simplifiedGeometry=t,r?this.setEditShapeImpl3D_(e,Xf.enumInputModeSimplifyAlternate,i,n,!1):this.setEditShapeImpl_(e,Xf.enumInputModeSimplifyAlternate,i,n,e.getGeometryType(t)===L.enumPolygon)}setAndSimplifyEditShapeWinding(e,t,n=null){let r=[];r.push(t),this.m_simplifiedGeometry=t,this.setEditShapeImpl_(e,Xf.enumInputModeSimplifyWinding,r,n,!0)}removeShape(){this.m_shape!==null&&(this.m_geometryIDIndex!==-1&&(this.m_shape.removeGeometryUserIndex(this.m_geometryIDIndex),this.m_geometryIDIndex=-1),this.m_clusterIndex!==-1&&(this.m_shape.removeUserIndex(this.m_clusterIndex),this.m_clusterIndex=-1),this.m_halfEdgeIndex!==-1&&(this.m_shape.removeUserIndex(this.m_halfEdgeIndex),this.m_halfEdgeIndex=-1),this.m_tmpHalfEdgeParentageIndex!==-1&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeParentageIndex),this.m_tmpHalfEdgeParentageIndex=-1),this.m_tmpHalfEdgeParentageIndexLeft!==-1&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeParentageIndexLeft),this.m_tmpHalfEdgeParentageIndexLeft=-1),this.m_tmpHalfEdgeWindingNumberIndex!==-1&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeWindingNumberIndex),this.m_tmpHalfEdgeWindingNumberIndex=-1),this.m_tmpHalfEdgeOddEvenNumberIndex!==-1&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeOddEvenNumberIndex),this.m_tmpHalfEdgeOddEvenNumberIndex=-1),this.m_segmentParentageIndex!==-1&&(this.deleteUserIndexForHalfEdges(this.m_segmentParentageIndex),this.m_segmentParentageIndex=-1),this.m_segmentIndexHe!==-1&&(this.deleteUserIndexForHalfEdges(this.m_segmentIndexHe),this.m_segmentIndexHe=-1),this.m_clusterBreakNodeIndex!==-1&&(this.deleteUserIndexForClusters(this.m_clusterBreakNodeIndex),this.m_clusterBreakNodeIndex=-1),this.deleteEdgeBitSets_(),this.deleteChainBitSets_(),this.m_emptyBitSet=null,this.m_geometryMapID=null,this.m_shape=null,this.m_clusterData.deleteAll(!0),this.m_clusterVertices.deleteAll(!0),this.m_firstCluster=-1,this.m_lastCluster=-1,this.m_halfEdgeData.deleteAll(!0),this.m_edgeIndices.length=0,this.m_clusterIndices.length=0,this.m_chainIndices.length=0,this.m_chainData.deleteAll(!0),this.m_universeChain=-1,this.m_chainAreas=null)}getClusterHalfEdge(e){return this.m_clusterData.getField(e,2)}queryXY(e,t){let n=this.getClusterVertexIndex_(e);t.assign(this.m_shape.getXYWithIndex(n))}queryXYZ(e,t){U(0)}getClusterParentage(e){return this.m_clusterData.getField(e,1)}getFirstCluster(){return this.m_firstCluster}getPrevCluster(e){return this.m_clusterData.getField(e,3)}getNextCluster(e){return this.m_clusterData.getField(e,4)}getClusterChain(e){return this.m_clusterData.getField(e,6)}getClusterVertexIterator(e){return this.m_clusterData.getField(e,7)}incrementVertexIterator(e){return this.m_clusterVertices.getField(e,1)}getVertexFromVertexIterator(e){return this.m_clusterVertices.getField(e,0)}getClusterUserIndex(e,t){let n=this.getClusterIndex_(e),r=this.m_clusterIndices[t];return r.size()<=n?-1:r.read(n)}setClusterUserIndex(e,t,n){let r=this.getClusterIndex_(e),i=this.m_clusterIndices[t];i.size()<=r&&i.resize(this.m_clusterData.size(),-1),i.write(r,n)}hasClusterUserIndexFlags(e,t,n){if(t===-1)return!1;let r=this.getClusterUserIndex(e,t);return r!==-1&&(n&r)!==0}setClusterUserIndexFlags(e,t,n){let r=this.getClusterIndex_(e),i=this.m_clusterIndices[t];i.size()<=r&&i.resize(this.m_clusterData.size(),-1);let a=i.read(r);a===-1&&(a=0),i.write(r,n|a)}clearClusterUserIndexFlags(e,t,n){let r=this.getClusterIndex_(e),i=this.m_clusterIndices[t];i.size()<=r&&i.resize(this.m_clusterData.size(),-1);let a=i.read(r);a===-1&&(a=0),i.write(r,~n&a)}createUserIndexForClusters(e=-1){let t=new sn(this.m_clusterData.capacity(),e);for(let e=0,n=this.m_clusterIndices.length;e<n;e++)if(this.m_clusterIndices[e]===null)return this.m_clusterIndices[e]=t,e;return this.m_clusterIndices.push(t),this.m_clusterIndices.length-1}deleteUserIndexForClusters(e){this.m_clusterIndices[e]=null}getHalfEdgeOrigin(e){return this.m_halfEdgeData.getField(e,1)}getHalfEdgeTo(e){return this.getHalfEdgeOrigin(this.getHalfEdgeTwin(e))}getHalfEdgeTwin(e){return this.m_halfEdgeData.getField(e,4)}getHalfEdgePrev(e){return this.m_halfEdgeData.getField(e,5)}getHalfEdgeNext(e){return this.m_halfEdgeData.getField(e,6)}getHalfEdgeChain(e){return this.m_halfEdgeData.getField(e,2)}getHalfEdgeFaceParentage(e){return this.getChainParentage(this.getHalfEdgeChain(e))}getHalfEdgeVertexIterator(e){return this.m_halfEdgeData.getField(e,7)}getHalfEdgeFromXY(e,t){this.queryXY(this.getHalfEdgeOrigin(e),t)}getHalfEdgeToXY(e,t){this.queryXY(this.getHalfEdgeTo(e),t)}isHalfEdgeCurve(e){return this.m_segmentIndexHe===-1?!1:this.getHalfEdgeUserIndex(e,this.m_segmentIndexHe)!==-1}getHalfEdgeFromXYZ(e,t){U(0)}getHalfEdgeToXYZ(e,t){U(0)}getHalfEdgeParentage(t){return this.m_halfEdgeData.getField(t,3)&e.c_EdgeParentageMask}getHalfEdgeUserIndex(e,t){let n=this.getHalfEdgeIndex_(e),r=this.m_edgeIndices[t];return r.size()<=n?-1:r.read(n)}setHalfEdgeUserIndex(e,t,n){let r=this.getHalfEdgeIndex_(e),i=this.m_edgeIndices[t];i.size()<=r&&i.resize(this.m_halfEdgeData.size(),-1),i.write(r,n)}createUserIndexForHalfEdges(e){e===void 0&&(e=-1);let t=new sn(this.m_halfEdgeData.capacity(),e);for(let e=0,n=this.m_edgeIndices.length;e<n;e++)if(this.m_edgeIndices[e]===null)return this.m_edgeIndices[e]=t,e;this.m_edgeIndices.push(t);let n=this.m_edgeIndices.length-1;return U(n>=0&&n<=2**53-1),n}deleteUserIndexForHalfEdges(e){this.m_edgeIndices[e]=null}deleteEdgesBreakFaces_(e){for(let t=0,n=e.length;t<n;t++){let n=e[t],r=this.getHalfEdgeChain(n),i=this.getHalfEdgeTwin(n),a=this.getHalfEdgeChain(i);this.setChainHalfEdge_(r,-1),this.setChainHalfEdge_(a,-1),this.updateVertexToHalfEdgeConnection_(n,!0),this.deleteEdgeImpl_(n)}}doesHalfEdgeBelongToAPolygonInterior(e,t){return U(0),!1}doesHalfEdgeBelongToAPolygonExterior(e,t){return U(0),!1}doesHalfEdgeBelongToAPolygonBoundary(e,t){return U(0),!1}doesHalfEdgeBelongToAPolylineInterior(e,t){return U(0),!1}doesHalfEdgeBelongToAPolylineExterior(e,t){return U(0),!1}doesClusterBelongToAPolygonInterior(e,t){return U(0),!1}doesClusterBelongToAPolygonExterior(e,t){return U(0),!1}doesClusterBelongToAPolygonBoundary(e,t){return U(0),!1}getFirstChain(){return this.m_universeChain}getChainHalfEdge(e){return this.m_chainData.getField(e,1)}getChainParentage(e){return this.m_chainData.getField(e,2)}getChainParent(e){return this.m_chainData.getField(e,3)}getChainFirstIsland(e){return this.m_chainData.getField(e,4)}getChainNextInParent(e){return this.m_chainData.getField(e,5)}getChainNext(e){return this.m_chainData.getField(e,7)}getChainArea(e){let t=this.getChainIndex_(e),n=this.m_chainAreas.read(t);return Number.isNaN(n)&&(this.updateChainAreaAndPerimeter_(e),n=this.m_chainAreas.read(t)),n}getChainPerimeter(e){return U(0),0}getChainUserIndex(e,t){let n=this.getChainIndex_(e),r=this.m_chainIndices[t];return r.size()<=n?-1:r.read(n)}setChainUserIndex(e,t,n){let r=this.getChainIndex_(e),i=this.m_chainIndices[t];i.size()<=r&&i.resize(this.m_chainData.size(),-1),i.write(r,n)}createUserIndexForChains(){let e=new sn(this.m_chainData.capacity(),-1);for(let t=0,n=this.m_chainIndices.length;t<n;t++)if(this.m_chainIndices[t]===null)return this.m_chainIndices[t]=e,t;return this.m_chainIndices.push(e),this.m_chainIndices.length-1}deleteUserIndexForChains(e){this.m_chainIndices[e]=null}extractPolygonFromChainAndIslands(e,t,n,r){let i=t===-1?e.createGeometry(L.enumPolygon):t,a=new Q;this.extractPolygonPathFromChain_(e,i,n,r,a);for(let t=this.getChainFirstIsland(n);t!==-1;t=this.getChainNextInParent(t))this.extractPolygonPathFromChain_(e,i,t,r,a);return i}getGeometryID(e){let t=this.m_shape.getGeometryUserIndex(e,this.m_geometryIDIndex);return U(t>=0),1<<Math.min(t,31)}getClusterFromVertex(e){return this.m_shape.getUserIndex(e,this.m_clusterIndex)}getHalfEdgeFromVertex(e){return this.m_shape.getUserIndex(e,this.m_halfEdgeIndex)}buildGeometryParentageSets(){this.m_bBuildGeometryParentageSets=!0}getChainBitSet(e){if(U(this.m_bBuildGeometryParentageSets),this.m_chainBitSetIndex===-1)return this.getEmptySet();let t=this.getChainUserIndex(e,this.m_chainBitSetIndex);U(t>=0);let n=this.m_chainBitSets.at(t);return n||=this.getEmptySet(),n}getChainBoundaryBitSet(e){U(this.m_bBuildGeometryParentageSets);let t=new Kf,n=e=>{let n=this.getChainHalfEdge(e),r=n;do{let e=this.getEdgeBitSet_(r);e!==null&&t.assignOr(e);let n=this.getEdgeBitSet_(this.getHalfEdgeTwin(r));n!==null&&t.assignOr(n),r=this.getHalfEdgeNext(r)}while(r!==n)};n(e);for(let t=this.getChainFirstIsland(e);t!==-1;t=this.getChainNextInParent(t))n(e);return t}getChainPolygons(e){return U(0),[]}getGeometriesFromBits(e){if(!this.m_bBuildGeometryParentageSets||e===null)return[];if(this.m_geometryMapID===null){this.m_geometryMapID=new Map;for(let e=this.m_shape.getFirstGeometry();e!==-1;e=this.m_shape.getNextGeometry(e))this.m_geometryMapID.set(this.m_shape.getGeometryUserIndex(e,this.m_geometryIDIndex),e)}let t=[],n=e.getUnorderedBitIterator();for(let e=n.next();e!==Uf.npos();e=n.next())U(this.m_geometryMapID.has(e)),t.push(this.m_geometryMapID.get(e));return t}getVertexDominant(e,t){if(t===-1)return e;let n=this.getClusterFromVertex(e);return this.getVertexDominantFromCluster(n,t)}getVertexDominantFromCluster(e,t){if(t!==-1){let n=-1;for(let r=this.getClusterVertexIterator(e);r!==-1;r=this.incrementVertexIterator(r)){let e=this.getVertexFromVertexIterator(r);n===-1&&(n=e);let i=this.m_shape.getPathFromVertex(e);if(this.m_shape.getGeometryFromPath(i)===t){n=e;break}}return n}{let t=this.getClusterVertexIterator(e);return t===-1?-1:this.getVertexFromVertexIterator(t)}}isBreakNode(e){return this.hasClusterUserIndexFlags(e,this.m_clusterBreakNodeIndex,Zf.enumSegmentParentageBreakNode)}setBreakNode(e,t){U(this.m_clusterBreakNodeIndex!==-1),t?this.setClusterUserIndexFlags(e,this.m_clusterBreakNodeIndex,Zf.enumSegmentParentageBreakNode):this.clearClusterUserIndexFlags(e,this.m_clusterBreakNodeIndex,Zf.enumSegmentParentageBreakNode)}isStrongPathNode(e){return this.hasClusterUserIndexFlags(e,this.m_clusterBreakNodeIndex,Zf.enumPathBreakNode)}setStrongPathNode(e,t){if(this.m_clusterBreakNodeIndex===-1){if(!t)return;this.m_clusterBreakNodeIndex=this.createUserIndexForClusters()}t?this.setClusterUserIndexFlags(e,this.m_clusterBreakNodeIndex,Zf.enumPathBreakNode):this.clearClusterUserIndexFlags(e,this.m_clusterBreakNodeIndex,Zf.enumPathBreakNode)}getSegmentParentage(e){if(this.m_segmentParentageIndex===-1)return-1;let t=this.getHalfEdgeUserIndex(e,this.m_segmentParentageIndex);return t>=0?t:-1}isCrossroadAhead(e){let t=this.getHalfEdgeNext(e);if(this.isStrongPathNode(this.getHalfEdgeOrigin(t)))return!0;let n=this.getHalfEdgeTwin(t),r=this.getHalfEdgeNext(n);return e!==this.getHalfEdgeTwin(r)}isCrossroadBehind(e){return U(0),!1}getHalfEdgeConnector(e,t){let n=this.getClusterHalfEdge(e);if(n===-1)return-1;let r=n,i=-1,a=-1;do{if(this.getHalfEdgeTo(r)===t)return r;if(i===-1){if(i=this.getClusterHalfEdge(t),i===-1)return-1;a=i}if(this.getHalfEdgeTo(a)===e)return r=this.getHalfEdgeTwin(a),r;r=this.getHalfEdgeNext(this.getHalfEdgeTwin(r)),a=this.getHalfEdgeNext(this.getHalfEdgeTwin(a))}while(r!==n&&a!==i);return-1}querySegmentXY(e,t){if(this.m_segmentIndexHe!==-1){let n=this.getHalfEdgeUserIndex(e,this.m_segmentIndexHe);if(n!==-1){if(n!==-2){let e=this.m_shape.getSegmentFromIndex(n);t.copyFrom(e,!0)}else{n=this.getHalfEdgeUserIndex(this.getHalfEdgeTwin(e),this.m_segmentIndexHe);let r=this.m_shape.getSegmentFromIndex(n);t.copyFrom(r,!0),t.get().reverse()}return}}t.createLine();let n=t.get(),r=z.getNAN();this.getHalfEdgeFromXY(e,r),n.setStartXY(r),this.getHalfEdgeToXY(e,r),n.setEndXY(r)}isCurveEdge(e){return this.m_segmentIndexHe===-1?!1:this.getHalfEdgeUserIndex(e,this.m_segmentIndexHe)!==-1}compareEdgeAnglesCurveHelper_(e,t,n){let r=new Q,i=new Q;this.querySegmentXY(e,r),this.querySegmentXY(t,i);let a=r.get(),o=i.get();if(a.equals(o))return 0;let s=new z;this.getHalfEdgeFromXY(e,s);let c=new z;this.getHalfEdgeToXY(e,c);let l=new z;return this.getHalfEdgeToXY(t,l),U(!c.isEqualPoint2D(l)),Er(a,o)}compareEdgeAnglesHelper_(e,t,n){if(e===t)return 0;if(this.isHalfEdgeCurve(e)||this.isHalfEdgeCurve(t))return this.compareEdgeAnglesCurveHelper_(e,t,n);let r=z.getNAN();this.getHalfEdgeToXY(e,r);let i=z.getNAN();if(this.getHalfEdgeToXY(t,i),r.isEqualPoint2D(i))return 0;let a=z.getNAN();this.getHalfEdgeFromXY(e,a);let o=z.getNAN();o.setSub(r,a);let s=z.getNAN();return s.setSub(i,a),!n||s.y>=0&&o.y>0?z.compareVectors(o,s):0}compareEdgeAngles_(e,t){return this.compareEdgeAnglesHelper_(e,t,!1)}compareEdgeAnglesForPair_(e,t){return this.compareEdgeAnglesHelper_(e,t,!0)}compareEdgeAngles3D_(e,t){return U(0),0}compareEdgeAnglesForPair3D_(e,t){return U(0),0}dbgDumpChains_(){}dbgDumpChainToPolygon_(e,t){}deleteEdgeInternal_(e){let t=this.getHalfEdgeChain(e),n=this.getHalfEdgeTwin(e),r=this.getHalfEdgeChain(n);U(r===t),U(e===this.getHalfEdgeNext(n)||n===this.getHalfEdgeNext(e));let i=this.getHalfEdgeNext(e);i===n&&(i=this.getHalfEdgeNext(i),i===e&&(i=-1));let a=this.getChainIndex_(t),o=this.m_chainAreas.read(a);Number.isNaN(o)||(this.setChainArea_(t,NaN),this.setChainPerimeter_(t,NaN));let s=this.getChainHalfEdge(t);s!==e&&s!==n||this.setChainHalfEdge_(t,i),this.updateVertexToHalfEdgeConnection_(e,!0),this.deleteEdgeImpl_(e)}getFirstUnvisitedHalfEdgeOnCluster_(e,t,n){let r=t===-1?this.getClusterHalfEdge(e):t;if(r===-1)return-1;let i=r;for(;;){if(this.getHalfEdgeUserIndex(r,n)!==1)return r;let e=this.getHalfEdgeNext(this.getHalfEdgeTwin(r));if(e===i)return-1;r=e}}removeSpikes_(){let e=!1,t=this.createUserIndexForHalfEdges();for(let n=this.getFirstCluster();n!==-1;n=this.getNextCluster(n)){let r=-1;for(;;){let i=this.getFirstUnvisitedHalfEdgeOnCluster_(n,r,t);if(i===-1)break;r=this.getHalfEdgeNext(this.getHalfEdgeTwin(i));let a=i;for(;;){let n=this.getHalfEdgeNext(a),o=this.getHalfEdgePrev(a),s=this.getHalfEdgeTwin(a);if(o===s){if(this.deleteEdgeInternal_(a),e=!0,r!==a&&r!==s||(r=-1),a===i||o===i){if(i=n,a===i||o===i)break;a=n;continue}}else this.setHalfEdgeUserIndex(a,t,1);if(a=n,a===i)break}}}return this.deleteUserIndexForHalfEdges(t),e}progress_(e,t=!1){}newCluster_(){let e=this.m_clusterData.newElement();return this.m_clusterData.setField(e,1,0),e}newHalfEdgePair_(){let e=this.m_halfEdgeData.newElement();this.m_halfEdgeData.setField(e,2,0),this.m_halfEdgeData.setField(e,3,0);let t=this.m_halfEdgeData.newElement();return this.m_halfEdgeData.setField(t,2,0),this.m_halfEdgeData.setField(t,3,0),this.setHalfEdgeTwin_(e,t),this.setHalfEdgeTwin_(t,e),e}newChain_(){let e=this.m_chainData.newElement();return this.m_chainData.setField(e,2,0),e}deleteChain_(e){return U(0),0}getClusterIndex_(e){return this.m_clusterData.elementToIndex(e)}setClusterVertexIterator_(e,t){this.m_clusterData.setField(e,7,t)}setClusterHalfEdge_(e,t){this.m_clusterData.setField(e,2,t)}setClusterParentage_(e,t){this.m_clusterData.setField(e,1,t)}setPrevCluster_(e,t){this.m_clusterData.setField(e,3,t)}setNextCluster_(e,t){this.m_clusterData.setField(e,4,t)}setClusterVertexIndex_(e,t){this.m_clusterData.setField(e,5,t)}getClusterVertexIndex_(e){return this.m_clusterData.getField(e,5)}setClusterChain_(e,t){this.m_clusterData.setField(e,6,t)}addClusterToExteriorChain_(e,t){this.setClusterChain_(t,e)}getHalfEdgeIndex_(e){return this.m_halfEdgeData.elementToIndex(e)}setHalfEdgeOrigin_(e,t){this.m_halfEdgeData.setField(e,1,t)}setHalfEdgeTwin_(e,t){this.m_halfEdgeData.setField(e,4,t)}setHalfEdgePrev_(e,t){this.m_halfEdgeData.setField(e,5,t)}setHalfEdgeNext_(e,t){this.m_halfEdgeData.setField(e,6,t)}setHalfEdgeChain_(e,t){this.m_halfEdgeData.setField(e,2,t)}setHalfEdgeParentage_(e,t){this.m_halfEdgeData.setField(e,3,t)}getHalfEdgeParentageMask_(e){return this.m_halfEdgeData.getField(e,3)}setHalfEdgeVertexIterator_(e,t){this.m_halfEdgeData.setField(e,7,t)}updateVertexToHalfEdgeConnectionHelper_(e,t){let n=t?-1:e;for(let t=this.getHalfEdgeVertexIterator(e);t!==-1;t=this.incrementVertexIterator(t)){let e=this.getVertexFromVertexIterator(t);this.m_shape.setUserIndex(e,this.m_halfEdgeIndex,n)}}updateVertexToHalfEdgeConnection_(e,t){e!==-1&&(this.updateVertexToHalfEdgeConnectionHelper_(e,t),this.updateVertexToHalfEdgeConnectionHelper_(this.getHalfEdgeTwin(e),t))}getChainIndex_(e){return this.m_chainData.elementToIndex(e)}setChainHalfEdge_(e,t){this.m_chainData.setField(e,1,t)}setChainParentage_(e,t){this.m_chainData.setField(e,2,t)}setChainParent_(e,t){this.m_chainData.setField(e,3,t);let n=this.getChainFirstIsland(t);this.setChainNextInParent_(e,n),this.setChainFirstIsland_(t,e)}setChainFirstIsland_(e,t){this.m_chainData.setField(e,4,t)}setChainNextInParent_(e,t){this.m_chainData.setField(e,5,t)}setChainPrev_(e,t){this.m_chainData.setField(e,6,t)}setChainNext_(e,t){this.m_chainData.setField(e,7,t)}setChainArea_(e,t){let n=this.getChainIndex_(e);this.m_chainAreas.write(n,t)}setChainPerimeter_(e,t){let n=this.getChainIndex_(e);this.m_chainPerimeters.write(n,t)}updateChainAreaAndPerimeter_(e){let t=this.m_shape.hasCurves(),n=new s(0),r=new s(0),i=this.getChainHalfEdge(e),a=z.getNAN(),o=z.getNAN(),c=z.getNAN();this.getHalfEdgeFromXY(i,a),o.setCoordsPoint2D(a);let l=i;do this.getHalfEdgeToXY(l,c),t&&this.isCurveEdge(l)||r.pe(z.distance(o,c)),this.getHalfEdgeChain(this.getHalfEdgeTwin(l))!==e&&n.pe((c.x-a.x-(o.x-a.x))*(c.y-a.y+(o.y-a.y))*.5),o.setCoordsPoint2D(c),l=this.getHalfEdgeNext(l);while(l!==i);if(t){let t=new Q;l=i;do{this.getHalfEdgeToXY(l,c);let i=this.isCurveEdge(l);if(i&&(this.querySegmentXY(l,t),r.pe(t.get().calculateLength2D())),this.getHalfEdgeChain(this.getHalfEdgeTwin(l))!==e&&i){let e=t.get().calculateArea2DHelper();n.pe(e)}l=this.getHalfEdgeNext(l)}while(l!==i)}let u=this.getChainIndex_(e);this.m_chainAreas.write(u,n.getResult()),this.m_chainPerimeters.write(u,r.getResult())}getChainTopmostEdge_(e){return U(0),0}planeSweepParentage_(e,t){let n=new Jf(this),r=new yn;r.setCapacity(Math.trunc(this.m_pointCount/2)),r.setComparator(n);let i=[],a=this.createUserIndexForHalfEdges(),o=null,s=z.getNAN();for(let c=this.getFirstCluster();c!==-1;c=this.getNextCluster(c)){this.progress_(t);let l=this.getClusterHalfEdge(c);if(l!==-1){if(i.length=0,!this.tryOptimizedInsertion_(r,a,i,c,l)){this.queryXY(c,s),n.setY(s.y);let e=l;do{let t=this.getHalfEdgeUserIndex(e,a);t!==-1&&(r.deleteNode(t),this.setHalfEdgeUserIndex(e,a,pn.impossibleIndex2())),e=this.getHalfEdgeNext(this.getHalfEdgeTwin(e))}while(l!==e);e=l;do{if(this.getHalfEdgeUserIndex(e,a)===-1){let t=r.addElement(e);i.push(t)}e=this.getHalfEdgeNext(this.getHalfEdgeTwin(e))}while(l!==e)}for(let t=i.length-1;t>=0;t--){let n=i[t],o=r.getElement(n),s=this.getHalfEdgeTwin(o);this.setHalfEdgeUserIndex(s,a,n),this.planeSweepParentagePropagateParentage_(r,n,e)}}else if(this.getClusterChain(c)===-1){o===null&&(o=new Yf(this)),this.queryXY(c,s),o.setPointXY(s);let e=r.searchLowerBound(o),t=this.m_universeChain;if(e!==-1){let n=r.getElement(e);this.getHalfEdgeChain(n)===this.getHalfEdgeChain(this.getHalfEdgeTwin(n))&&(n=this.getLeftSkipPolylines_(r,e)),n!==-1&&(t=this.getHalfEdgeChain(n))}this.addClusterToExteriorChain_(t,c)}}this.deleteUserIndexForHalfEdges(a)}planeSweepParentagePropagateParentage_(e,t,n){let r=e.getElement(t),i=this.getHalfEdgeChain(r);if(this.getChainParent(i)!==-1)return;let a=this.getLeftSkipPolylines_(e,t),o=this.getHalfEdgeTwin(r),s=this.getHalfEdgeChain(o),c=this.getChainParent(i),l=this.getChainParent(s);if(a===-1)c===-1&&(s===i?(this.setChainParent_(s,this.m_universeChain),l=this.m_universeChain,c=l):(l===-1&&(this.setChainParent_(s,this.m_universeChain),l=this.m_universeChain),this.setChainParent_(i,s),c=s));else{let e=this.getHalfEdgeChain(a);if(l===-1){if(this.getChainArea(e)<=0){let t=this.getChainParent(e);this.setChainParent_(s,t),l=t}else this.setChainParent_(s,e),l=e;s===i&&(c=l)}}c===-1&&(this.trySetChainParentFromTwin_(i,s),c=this.getChainParent(i)),U(c!==-1),n===Xf.enumInputModeBuildGraph?this.propagateParentageBuildGraph_(e,t,r,a):n===Xf.enumInputModeSimplifyWinding?this.propagateParentageWinding_(e,t,r,a,o,i,s):n===Xf.enumInputModeSimplifyAlternate&&this.propagateParentageAlternate_(e,t,r,a,o,i,s)}propagateParentageBuildGraph_(e,t,n,r){let i,a=t;r===-1?(a=e.getNext(a),i=this.getHalfEdgeChain(n)):i=this.getHalfEdgeChain(r);let o=null,s=this.getChainParentage(i);for(this.m_bBuildGeometryParentageSets&&(o=this.getChainBitSet(i));a!==-1;a=e.getNext(a)){let t=e.getElement(a),n=this.getHalfEdgeTwin(t);i=this.getHalfEdgeChain(t);let r=this.getHalfEdgeChain(n);if(this.m_bBuildGeometryParentageSets){let e=this.getChainBitSet(r);e=new Kf({copy:e}),e.assignOr(o),this.setChainBitSet_(r,e);let n=this.getChainBitSet(i),a=this.getLeftEdgeBitSet_(t),s=new Kf({copy:o});if(s.assignSubtract(a),s.isZero())break;n=new Kf({copy:n}),n.assignOr(s),this.setChainBitSet_(i,n),o=n}let c=this.getChainParentage(r),l=c|s;l!==c&&this.setChainParentage_(r,l);let u=this.getChainParentage(i),d=s&~this.getHalfEdgeUserIndex(t,this.m_tmpHalfEdgeParentageIndexLeft);if(d&&(u|=d,this.setChainParentage_(i,u)),d===0)break;s=u}}propagateParentageWinding_(e,t,n,r,i,a,o){if(a===o)return;let s=this.getHalfEdgeUserIndex(n,this.m_tmpHalfEdgeWindingNumberIndex);s+=this.getHalfEdgeUserIndex(i,this.m_tmpHalfEdgeWindingNumberIndex);let c=0,l=[],u=[];u.push(0);for(let n=e.getFirst();n!==t;n=e.getNext(n)){let t=e.getElement(n),r=this.getHalfEdgeTwin(t),i=this.getHalfEdgeChain(t),a=this.getHalfEdgeChain(r);if(i!==a){let e=this.getHalfEdgeUserIndex(t,this.m_tmpHalfEdgeWindingNumberIndex);e+=this.getHalfEdgeUserIndex(r,this.m_tmpHalfEdgeWindingNumberIndex),c+=e;let n=!1;l.length!==0&&l.at(-1)===a&&(u.pop(),l.pop(),n=!0),U(this.getChainParent(a)!==-1),n&&this.getChainParent(a)===i||(u.push(c),l.push(i))}}if(c+=s,l.length!==0&&l.at(-1)===o&&(u.pop(),l.pop()),c!==0){if(u.at(-1)===0){let e=this.m_simplifiedGeometry,t=this.getGeometryID(e);this.setChainParentage_(a,t)}}else if(u.at(-1)!==0){let e=this.m_simplifiedGeometry,t=this.getGeometryID(e);this.setChainParentage_(a,t)}}propagateParentageAlternate_(e,t,n,r,i,a,o){let s=this.m_simplifiedGeometry,c=this.getGeometryID(s);if(r===-1)this.setChainParentage_(o,this.m_universeGeomID),1&this.getHalfEdgeUserIndex(n,this.m_tmpHalfEdgeOddEvenNumberIndex)?this.setChainParentage_(a,c):this.setChainParentage_(a,this.m_universeGeomID);else{let e=this.getChainParentage(o);if(e===0){let e=this.getHalfEdgeChain(r),t=this.getChainParentage(e);this.setChainParentage_(o,t),1&this.getHalfEdgeUserIndex(n,this.m_tmpHalfEdgeOddEvenNumberIndex)?this.setChainParentage_(a,t===c?this.m_universeGeomID:c):this.setChainParentage_(a,t)}else 1&this.getHalfEdgeUserIndex(n,this.m_tmpHalfEdgeOddEvenNumberIndex)?this.setChainParentage_(a,e===c?this.m_universeGeomID:c):this.setChainParentage_(a,e)}}tryOptimizedInsertion_(e,t,n,r,i){let a=i,o=-1,s=-1,c=0;do{if(c===2)return!1;let e=this.getHalfEdgeUserIndex(a,t);if(e!==-1){if(o!==-1)return!1;o=e}else{if(s!==-1)return!1;s=a}c++,a=this.getHalfEdgeNext(this.getHalfEdgeTwin(a))}while(i!==a);return s!==-1&&o!==-1&&(this.setHalfEdgeUserIndex(e.getElement(o),t,pn.impossibleIndex2()),e.setElement(o,s),n.push(o),!0)}trySetChainParentFromTwin_(e,t){let n=this.getChainArea(e);if(n===0)return!1;let r=this.getChainArea(t);if(n>0&&r<0||n<0&&r>0)return this.setChainParent_(e,t),!0;{let n=this.getChainParent(t);if(n!==-1)return this.setChainParent_(e,n),!0}return!1}createHalfEdges_(t,n){this.m_halfEdgeIndex=this.m_shape.createUserIndex();for(let r=0,i=n.size();r<i;r++){let i=n.read(r),a=this.m_shape.getUserIndex(i,this.m_clusterIndex),o=this.m_shape.getPathFromVertex(i),s=this.m_shape.getGeometryFromPath(o),c=this.m_shape.getGeometryType(s);if(V(c)){let n=this.m_shape.getNextVertex(i);if(n===-1)continue;let r=this.m_shape.getUserIndex(n,this.m_clusterIndex);if(a===r)continue;let o=this.newHalfEdgePair_(),l=this.getHalfEdgeTwin(o),u=this.m_clusterVertices.newElement();this.m_clusterVertices.setField(u,0,i),this.m_clusterVertices.setField(u,1,-1),this.setHalfEdgeVertexIterator_(o,u),this.m_shape.setUserIndex(i,this.m_halfEdgeIndex,o),this.setHalfEdgeOrigin_(o,a);let d=this.getClusterHalfEdge(a);if(d===-1)this.setClusterHalfEdge_(a,o),this.setHalfEdgePrev_(o,l),this.setHalfEdgeNext_(l,o);else{let e=this.getHalfEdgePrev(d);this.setHalfEdgePrev_(d,l),this.setHalfEdgeNext_(l,d),this.setHalfEdgeNext_(e,o),this.setHalfEdgePrev_(o,e)}this.setHalfEdgeOrigin_(l,r);let f=this.getClusterHalfEdge(r);if(f===-1)this.setClusterHalfEdge_(r,l),this.setHalfEdgeNext_(o,l),this.setHalfEdgePrev_(l,o);else{let e=this.getHalfEdgePrev(f);this.setHalfEdgePrev_(f,o),this.setHalfEdgeNext_(o,f),this.setHalfEdgeNext_(e,l),this.setHalfEdgePrev_(l,e)}let p=this.getGeometryID(s);if(t===Xf.enumInputModeBuildGraph){let e=c===L.enumPolygon?p:0;if(this.setHalfEdgeUserIndex(l,this.m_tmpHalfEdgeParentageIndex,0),this.setHalfEdgeUserIndex(o,this.m_tmpHalfEdgeParentageIndex,e),this.setHalfEdgeUserIndex(l,this.m_tmpHalfEdgeParentageIndexLeft,e),this.setHalfEdgeUserIndex(o,this.m_tmpHalfEdgeParentageIndexLeft,0),this.m_bBuildGeometryParentageSets){let e=new Kf,t=this.m_shape.getGeometryUserIndex(s,this.m_geometryIDIndex);e.setBit(t),this.setEdgeBitSet_(o,e),this.setEdgeBitSet_(l,null),this.setLeftEdgeBitSet_(l,e),this.setLeftEdgeBitSet_(o,null)}}else if(t===Xf.enumInputModeSimplifyWinding){let e=this.m_shape.getXY(i),t=this.m_shape.getXY(n),r=0,a=0;e.compare(t)<0?r=1:a=-1,this.setHalfEdgeUserIndex(o,this.m_tmpHalfEdgeWindingNumberIndex,r),this.setHalfEdgeUserIndex(l,this.m_tmpHalfEdgeWindingNumberIndex,a)}else t===Xf.enumInputModeSimplifyAlternate&&(this.setHalfEdgeUserIndex(o,this.m_tmpHalfEdgeOddEvenNumberIndex,1),this.setHalfEdgeUserIndex(l,this.m_tmpHalfEdgeOddEvenNumberIndex,1));let m=c===L.enumPolygon?e.c_EdgeBitMask:0;this.setHalfEdgeParentage_(o,p|m),this.setHalfEdgeParentage_(l,p|m)}}if(this.m_shape.hasCurves()){this.m_segmentIndexHe=this.createUserIndexForHalfEdges();for(let e=0,t=n.size();e<t;e++){let t=n.read(e);if(this.m_shape.getSegment(t)){let e=this.m_shape.getUserIndex(t,this.m_halfEdgeIndex);e!==-1&&(this.setHalfEdgeUserIndex(e,this.m_segmentIndexHe,this.m_shape.getVertexIndex(t)),this.setHalfEdgeUserIndex(this.getHalfEdgeTwin(e),this.m_segmentIndexHe,-2))}}}}mergeVertexListsOfEdges_(e,t){{let n=this.getHalfEdgeVertexIterator(t);if(n!==-1){let r=this.getHalfEdgeVertexIterator(e);this.m_clusterVertices.setField(n,1,r),this.setHalfEdgeVertexIterator_(e,n),this.setHalfEdgeVertexIterator_(t,-1)}}let n=this.getHalfEdgeTwin(e),r=this.getHalfEdgeTwin(t);{let e=this.getHalfEdgeVertexIterator(r);if(e!==-1){let t=this.getHalfEdgeVertexIterator(n);this.m_clusterVertices.setField(e,1,t),this.setHalfEdgeVertexIterator_(n,e),this.setHalfEdgeVertexIterator_(r,-1)}}if(this.m_segmentIndexHe!==-1){let i=this.getHalfEdgeUserIndex(e,this.m_segmentIndexHe);if(i!==-1){if(i===-2){let n=this.getHalfEdgeUserIndex(t,this.m_segmentIndexHe);this.setHalfEdgeUserIndex(e,this.m_segmentIndexHe,n)}if(i=this.getHalfEdgeUserIndex(n,this.m_segmentIndexHe),i===-2){let e=this.getHalfEdgeUserIndex(r,this.m_segmentIndexHe);this.setHalfEdgeUserIndex(n,this.m_segmentIndexHe,e)}}}}sortHalfEdgesByAngle_(e){let t=[];for(let n=this.getFirstCluster();n!==-1;n=this.getNextCluster(n)){t.length=0;let r=this.getClusterHalfEdge(n);if(r!==-1){let i=r;do t.push(i),i=this.getHalfEdgeNext(this.getHalfEdgeTwin(i));while(i!==r);if(t.length>1){let i=!0;t.length>2?(t.sort((e,t)=>this.compareEdgeAngles_(e,t)),t.push(t[0])):this.compareEdgeAnglesForPair_(t[0],t[1])>0?t[1]=W(t[0],t[0]=t[1]):i=!1;let a=t[0],o=a,s=this.getHalfEdgeTo(o),c=this.getHalfEdgeTwin(o),l=-1;for(let n=1,r=t.length;n<r;n++){let r=t[n],i=this.getHalfEdgeTwin(r),u=this.getHalfEdgeOrigin(i);if(u!==s||r===o)this.updateVertexToHalfEdgeConnection_(l,!1),l=-1,o=r,s=u,c=i;else{if(e===Xf.enumInputModeBuildGraph){let e=this.getHalfEdgeParentageMask_(o)|this.getHalfEdgeParentageMask_(r);if(this.setHalfEdgeParentage_(o,e),this.setHalfEdgeParentage_(c,e),this.setHalfEdgeUserIndex(o,this.m_tmpHalfEdgeParentageIndex,this.getHalfEdgeUserIndex(o,this.m_tmpHalfEdgeParentageIndex)|this.getHalfEdgeUserIndex(r,this.m_tmpHalfEdgeParentageIndex)),this.setHalfEdgeUserIndex(c,this.m_tmpHalfEdgeParentageIndex,this.getHalfEdgeUserIndex(c,this.m_tmpHalfEdgeParentageIndex)|this.getHalfEdgeUserIndex(i,this.m_tmpHalfEdgeParentageIndex)),this.setHalfEdgeUserIndex(o,this.m_tmpHalfEdgeParentageIndexLeft,this.getHalfEdgeUserIndex(o,this.m_tmpHalfEdgeParentageIndexLeft)|this.getHalfEdgeUserIndex(r,this.m_tmpHalfEdgeParentageIndexLeft)),this.setHalfEdgeUserIndex(c,this.m_tmpHalfEdgeParentageIndexLeft,this.getHalfEdgeUserIndex(c,this.m_tmpHalfEdgeParentageIndexLeft)|this.getHalfEdgeUserIndex(i,this.m_tmpHalfEdgeParentageIndexLeft)),this.m_bBuildGeometryParentageSets){let e,t,n;e=this.getEdgeBitSet_(o),t=this.getEdgeBitSet_(r),n=new Kf({copy:e}),n.assignOr(t),this.setEdgeBitSet_(o,n),e=this.getEdgeBitSet_(c),t=this.getEdgeBitSet_(i),n=new Kf({copy:e}),n.assignOr(t),this.setEdgeBitSet_(c,n),e=this.getLeftEdgeBitSet_(o),t=this.getLeftEdgeBitSet_(r),n=new Kf({copy:e}),n.assignOr(t),this.setLeftEdgeBitSet_(o,n),e=this.getLeftEdgeBitSet_(c),t=this.getLeftEdgeBitSet_(i),n=new Kf({copy:e}),n.assignOr(t),this.setLeftEdgeBitSet_(c,n)}}else if(this.m_tmpHalfEdgeWindingNumberIndex!==-1){let e=this.getHalfEdgeUserIndex(o,this.m_tmpHalfEdgeWindingNumberIndex)+this.getHalfEdgeUserIndex(r,this.m_tmpHalfEdgeWindingNumberIndex),t=this.getHalfEdgeUserIndex(c,this.m_tmpHalfEdgeWindingNumberIndex)+this.getHalfEdgeUserIndex(i,this.m_tmpHalfEdgeWindingNumberIndex);this.setHalfEdgeUserIndex(o,this.m_tmpHalfEdgeWindingNumberIndex,e),this.setHalfEdgeUserIndex(c,this.m_tmpHalfEdgeWindingNumberIndex,t)}else if(this.m_tmpHalfEdgeOddEvenNumberIndex!==-1){let e=this.getHalfEdgeUserIndex(o,this.m_tmpHalfEdgeOddEvenNumberIndex)+this.getHalfEdgeUserIndex(r,this.m_tmpHalfEdgeOddEvenNumberIndex),t=this.getHalfEdgeUserIndex(c,this.m_tmpHalfEdgeOddEvenNumberIndex)+this.getHalfEdgeUserIndex(i,this.m_tmpHalfEdgeOddEvenNumberIndex);this.setHalfEdgeUserIndex(o,this.m_tmpHalfEdgeOddEvenNumberIndex,e),this.setHalfEdgeUserIndex(c,this.m_tmpHalfEdgeOddEvenNumberIndex,t)}this.mergeVertexListsOfEdges_(o,r),this.deleteEdgeImpl_(r),l=o,t[n]=-1,r===a&&(t[0]=-1,a=-1)}}if(this.updateVertexToHalfEdgeConnection_(l,!1),l=-1,!i){a=-1;for(let e=0,n=t.length;e<n;e++){let n=t[e];if(n!==-1){a=n;break}}r!==a&&this.setClusterHalfEdge_(n,a);continue}a=-1;for(let e=0,n=t.length;e<n;e++){let n=t[e];if(n===-1)continue;if(a===-1){a=n,o=a,s=this.getHalfEdgeTo(o),c=this.getHalfEdgeTwin(o);continue}if(n===o)continue;let r=this.getHalfEdgeTwin(n),i=this.getHalfEdgeOrigin(r);this.setHalfEdgeNext_(c,n),this.setHalfEdgePrev_(n,c),o=n,s=i,c=r}this.setClusterHalfEdge_(n,a)}}}}sortHalfEdgesByAngle3D_(e){U(0)}buildChains_(e){this.m_universeChain=this.newChain_(),this.setChainHalfEdge_(this.m_universeChain,-1);let t=this.m_universeChain,n=this.createUserIndexForHalfEdges();for(let e=this.getFirstCluster();e!==-1;e=this.getNextCluster(e)){let r=this.getClusterHalfEdge(e);if(r!==-1){let e=r;do{if(this.getHalfEdgeUserIndex(e,n)!==1){let r=this.newChain_();this.setChainHalfEdge_(r,e),this.setChainPrev_(r,t),this.setChainNext_(t,r);let i=null;this.m_bBuildGeometryParentageSets&&(i=new Kf),t=r;let a=0,o=e;do this.m_tmpHalfEdgeParentageIndex!==-1&&(a|=this.getHalfEdgeUserIndex(o,this.m_tmpHalfEdgeParentageIndex)),this.m_bBuildGeometryParentageSets&&i.assignOr(this.getEdgeBitSet_(o)),this.setHalfEdgeChain_(o,r),this.setHalfEdgeUserIndex(o,n,1),o=this.getHalfEdgeNext(o);while(o!==e);this.m_bBuildGeometryParentageSets&&this.setChainBitSet_(r,i),this.setChainParentage_(r,a)}e=this.getHalfEdgeNext(this.getHalfEdgeTwin(e))}while(e!==r)}}this.m_chainAreas=new ln(this.m_chainData.size(),NaN),this.m_chainPerimeters=new ln(this.m_chainData.size(),NaN),this.setChainArea_(this.m_universeChain,1/0),this.setChainPerimeter_(this.m_universeChain,1/0),this.deleteUserIndexForHalfEdges(n)}simplify_(e){U(0)}simplifyAlternate_(){U(0)}simplifyWinding_(){U(0)}setEditShapeImpl_(e,t,n,r,i){this.removeShape(),this.m_bBuildChains=i,this.m_shape=e,this.m_geometryIDIndex=this.m_shape.createGeometryUserIndex();let a=this.m_shape.getTotalPointCount();if(n){a=0;for(let e=0,t=n.length;e<t;e++)a+=this.m_shape.getPointCount(n[e])}let o=new sn(0),s=0,c=0;{let e=n==null?this.m_shape.getFirstGeometry():n[0],t=1;for(;e!==-1;){this.m_shape.setGeometryUserIndex(e,this.m_geometryIDIndex,c++);for(let t=this.m_shape.getFirstPath(e);t!==-1;t=this.m_shape.getNextPath(t)){let e=this.m_shape.getFirstVertex(t);for(let n=0,r=this.m_shape.getPathSize(t);n<r;n++)o.add(e),e=this.m_shape.getNextVertex(e)}Be(this.m_shape.getGeometryType(e))||(s+=this.m_shape.getPathCount(e)),n==null?e=this.m_shape.getNextGeometry(e):(e=t<n.length?n[t]:-1,t++)}}this.m_universeGeomID=1<<Math.min(c,31),this.m_pointCount=o.size(),this.m_shape.sortVerticesSimpleByY(o,0,this.m_pointCount),this.m_clusterVertices.setCapacity(this.m_pointCount),this.progress_(r,!0),this.m_clusterData.setCapacity(this.m_pointCount+10),this.m_halfEdgeData.setCapacity(2*this.m_pointCount+32),this.m_chainData.setCapacity(Math.max(32,s)),this.m_clusterIndex=this.m_shape.createUserIndex();let l=z.getNAN(),u=0,d=z.getNAN();for(let e=0;e<=this.m_pointCount;e++){if(e<this.m_pointCount){let t=o.read(e);this.m_shape.queryXY(t,d)}else d.setNAN();if(!l.isEqualPoint2D(d)){if(u<e){let t=this.newCluster_(),n=-1,r=-1;for(let i=u;i<e;i++){r=o.read(i),this.m_shape.setUserIndex(r,this.m_clusterIndex,t);let e=this.m_clusterVertices.newElement();this.m_clusterVertices.setField(e,0,r),this.m_clusterVertices.setField(e,1,n),n=e;let a=this.m_shape.getPathFromVertex(r),s=this.m_shape.getGeometryFromPath(a),c=this.getGeometryID(s);this.setClusterParentage_(t,this.getClusterParentage(t)|c)}this.setClusterVertexIterator_(t,n),this.setClusterVertexIndex_(t,this.m_shape.getVertexIndex(r)),this.m_lastCluster!==-1&&this.setNextCluster_(this.m_lastCluster,t),this.setPrevCluster_(t,this.m_lastCluster),this.m_lastCluster=t,this.m_firstCluster===-1&&(this.m_firstCluster=t)}u=e,l.setCoordsPoint2D(d)}}if(this.m_shape.hasSegmentParentage()){this.m_clusterBreakNodeIndex===-1&&(this.m_clusterBreakNodeIndex=this.createUserIndexForClusters());for(let e=0;e<this.m_pointCount;e++){let t=o.read(e);if(this.m_shape.getSegmentParentageBreakVertex(t)){let e=this.getClusterFromVertex(t);this.setBreakNode(e,!0)}}}this.progress_(r,!0);{let e=n==null?this.m_shape.getFirstGeometry():n[0],t=1;for(;e!==-1;){for(let t=this.m_shape.getFirstPath(e);t!==-1;t=this.m_shape.getNextPath(t)){if(this.m_shape.isStrongPathStart(t)){let e=this.m_shape.getFirstVertex(t),n=this.getClusterFromVertex(e);this.setStrongPathNode(n,!0)}if(this.m_shape.isStrongPathEnd(t)){let e=this.m_shape.isClosedPath(t)?this.m_shape.getFirstVertex(t):this.m_shape.getLastVertex(t),n=this.getClusterFromVertex(e);this.setStrongPathNode(n,!0)}}n==null?e=this.m_shape.getNextGeometry(e):(e=t<n.length?n[t]:-1,t++)}}if(t===Xf.enumInputModeBuildGraph&&(this.m_tmpHalfEdgeParentageIndex=this.createUserIndexForHalfEdges(),this.m_tmpHalfEdgeParentageIndexLeft=this.createUserIndexForHalfEdges()),t===Xf.enumInputModeSimplifyWinding&&(this.m_tmpHalfEdgeWindingNumberIndex=this.createUserIndexForHalfEdges()),t===Xf.enumInputModeSimplifyAlternate&&(this.m_tmpHalfEdgeOddEvenNumberIndex=this.createUserIndexForHalfEdges()),this.createHalfEdges_(t,o),this.dbgNavigate_(),this.sortHalfEdgesByAngle_(t),!Number.isNaN(this.m_checkDirtyPlanesweepTolerance)&&!this.checkStructureAfterDirtySweep_())return this.m_bDirtyCheckFailed=!0,void this.cleanSetEditShapeImpl_();this.buildChains_(t),this.m_tmpHalfEdgeParentageIndex!==-1&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeParentageIndex),this.m_tmpHalfEdgeParentageIndex=-1),this.m_bBuildChains&&this.planeSweepParentage_(t,r),this.m_tmpHalfEdgeParentageIndexLeft!==-1&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeParentageIndexLeft),this.m_tmpHalfEdgeParentageIndexLeft=-1),this.dbgChkChainParents_(),this.dbgDumpChains_(),this.mergeSegmentParentage_(),this.dbgNavigate_(),this.dbgDumpChains_(),this.cleanSetEditShapeImpl_()}setEditShapeImpl3D_(e,t,n,r,i){U(0)}cleanSetEditShapeImpl_(){this.m_tmpHalfEdgeParentageIndex!==-1&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeParentageIndex),this.m_tmpHalfEdgeParentageIndex=-1),this.m_tmpHalfEdgeParentageIndexLeft!==-1&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeParentageIndexLeft),this.m_tmpHalfEdgeParentageIndexLeft=-1),this.m_tmpHalfEdgeWindingNumberIndex!==-1&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeWindingNumberIndex),this.m_tmpHalfEdgeWindingNumberIndex=-1),this.m_tmpHalfEdgeOddEvenNumberIndex!==-1&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeOddEvenNumberIndex),this.m_tmpHalfEdgeOddEvenNumberIndex=-1)}cleanSetEditShapeImpl3D_(){U(0)}dbgNavigate_(){}dbgChkChainParents_(){}deleteEdgeImpl_(e){let t=this.getHalfEdgeNext(e),n=this.getHalfEdgePrev(e),r=this.getHalfEdgeTwin(e),i=this.getHalfEdgeNext(r),a=this.getHalfEdgePrev(r);t!==r&&(this.setHalfEdgeNext_(a,t),this.setHalfEdgePrev_(t,a)),n!==r&&(this.setHalfEdgeNext_(n,i),this.setHalfEdgePrev_(i,n));let o=this.getHalfEdgeOrigin(e);this.getClusterHalfEdge(o)===e&&(i===e?this.setClusterHalfEdge_(o,-1):this.setClusterHalfEdge_(o,i));let s=this.getHalfEdgeOrigin(r);this.getClusterHalfEdge(s)===r&&(t===r?this.setClusterHalfEdge_(s,-1):this.setClusterHalfEdge_(s,t)),this.m_halfEdgeData.deleteElement(e),this.m_halfEdgeData.deleteElement(r)}getLeftSkipPolylines_(e,t){let n=t;for(;;){if(n=e.getPrev(n),n===-1)return-1;{let t=e.getElement(n);if(this.getHalfEdgeChain(t)!==this.getHalfEdgeChain(this.getHalfEdgeTwin(t)))return t}}}checkStructureAfterDirtySweep_(){let e=Ct(this.m_checkDirtyPlanesweepTolerance),t=new z,n=new z,r=new z,i=new z,a=new z;for(let o=this.getFirstCluster();o!==-1;o=this.getNextCluster(o)){let s=this.getClusterHalfEdge(o);if(s!==-1){let o=s;this.getHalfEdgeFromXY(o,t),this.getHalfEdgeToXY(o,n),r.setSub(n,t);let c=r.sqrLength();do{let s=o;if(o=this.getHalfEdgeNext(this.getHalfEdgeTwin(o)),o!==s){this.getHalfEdgeToXY(o,i),a.setSub(i,t);let s=a.sqrLength(),l=a.crossProduct(r),u=l*l/(s*c);if(Math.min(s,c)*u<=e&&a.dotProduct(r)>=0)return!1;r.assign(a),c=s,n.assign(i)}}while(o!==s)}}return!0}extractPolygonPathFromChain_(e,t,n,r,i){let a=this.m_shape.hasSegmentParentage(),o=this.getChainHalfEdge(n),s=o,c=-1,l=new q;do{let o=this.getHalfEdgeTwin(s);if(this.getHalfEdgeChain(o)!==n){let n=-1,o=this.getHalfEdgeOrigin(s);if(r===-1){let e=this.getClusterVertexIterator(o);n=this.getVertexFromVertexIterator(e)}else for(let e=this.getClusterVertexIterator(o);e!==-1;e=this.incrementVertexIterator(e)){let t=this.getVertexFromVertexIterator(e);n===-1&&(n=t);let i=this.m_shape.getPathFromVertex(t);if(this.m_shape.getGeometryFromPath(i)===r){n=t;break}}let u;if(c===-1&&(c=e.insertPath(t,-1),e.setClosedPath(c,!0)),this.m_shape===e?u=e.addVertex(c,n):(this.m_shape.queryPoint(n,l),u=e.addPoint(c,l)),this.isHalfEdgeCurve(s)&&(this.querySegmentXY(s,i),e.setSegmentToIndex(e.getVertexIndex(u),i.get().clone())),a){let t=this.getSegmentParentage(s);e.setSegmentParentageAndBreak(u,t,this.isBreakNode(o))}}s=this.getHalfEdgeNext(s)}while(s!==o)}mergeSegmentParentage_(){if(!this.m_shape.hasSegmentParentage())return;U(this.m_clusterBreakNodeIndex!==-1),U(this.m_segmentParentageIndex===-1);for(let e=this.getFirstCluster();e!==-1;e=this.getNextCluster(e)){let t=0,n=this.getClusterHalfEdge(e);if(n!==-1){let e=n;do t++,e=this.getHalfEdgeNext(this.getHalfEdgeTwin(e));while(e!==n&&t<3)}t!==2&&this.setBreakNode(e,!0)}let e=[],t=[];this.m_segmentParentageIndex=this.createUserIndexForHalfEdges();let n=this.createUserIndexForHalfEdges();for(let r=this.getFirstCluster();r!==-1;r=this.getNextCluster(r)){let i=this.getClusterHalfEdge(r);if(i!==-1){let r=!1,a=i;do{let i=a;for(;this.getHalfEdgeUserIndex(i,n)===-1;){let a=this.getHalfEdgeNext(i),o=this.getHalfEdgeTwin(i);ep(this,i,t);let s=t.at(-1).parentage;if(!r){let t=this.getHalfEdgeOrigin(i);if(!this.isBreakNode(t)){let t=this.getHalfEdgePrev(i);i!==t&&(ep(this,t,e),r=!0)}}if(r&&!$f(t,e)){let e=this.getHalfEdgeOrigin(i);this.setBreakNode(e,!0)}e=W(t,t=e),r=!0;let c=this.getHalfEdgeOrigin(a);this.isBreakNode(c)&&(r=!1),this.setHalfEdgeUserIndex(i,this.m_segmentParentageIndex,s),this.setHalfEdgeUserIndex(o,this.m_segmentParentageIndex,s),this.setHalfEdgeUserIndex(i,n,1),this.setHalfEdgeUserIndex(o,n,1),i=a}a=this.getHalfEdgeNext(this.getHalfEdgeTwin(a))}while(a!==i)}}this.deleteUserIndexForHalfEdges(n)}registerNewBitSet(e){return this.m_uniqueBitSets===null&&(this.m_uniqueBitSets=tp(),this.m_uniqueBitSets.add(this.getEmptySet())),e===null?this.getEmptySet():this.m_uniqueBitSets.has(e)?this.m_uniqueBitSets.get(e):(this.m_uniqueBitSets.add(e),e)}getLeftEdgeBitSet_(e){let t=this.getHalfEdgeUserIndex(e,this.m_edgeBitSetIndexLeft);return U(t>=0),U(this.m_edgeBitSets.at(t)),this.m_edgeBitSets.at(t)}getEdgeBitSet_(e){let t=this.getHalfEdgeUserIndex(e,this.m_edgeBitSetIndex);return U(t>=0),this.m_edgeBitSets.at(t)}setEdgeBitSet_(e,t){U(this.m_bBuildGeometryParentageSets),t=this.registerNewBitSet(t),this.m_edgeBitSetIndex===-1&&(this.m_edgeBitSetIndex=this.createUserIndexForHalfEdges());let n=this.getHalfEdgeUserIndex(e,this.m_edgeBitSetIndex);n===-1?(this.setHalfEdgeUserIndex(e,this.m_edgeBitSetIndex,this.m_edgeBitSets.length),this.m_edgeBitSets.push(t)):this.m_edgeBitSets[n]=t}setLeftEdgeBitSet_(e,t){U(this.m_bBuildGeometryParentageSets),t=this.registerNewBitSet(t),this.m_edgeBitSetIndexLeft===-1&&(this.m_edgeBitSetIndexLeft=this.createUserIndexForHalfEdges());let n=this.getHalfEdgeUserIndex(e,this.m_edgeBitSetIndexLeft);n===-1?(this.setHalfEdgeUserIndex(e,this.m_edgeBitSetIndexLeft,this.m_edgeBitSets.length),this.m_edgeBitSets.push(t)):this.m_edgeBitSets[n]=t}setChainBitSet_(e,t){U(this.m_bBuildGeometryParentageSets),t=this.registerNewBitSet(t),this.m_chainBitSetIndex===-1&&(this.m_chainBitSetIndex=this.createUserIndexForChains());let n=this.getChainUserIndex(e,this.m_chainBitSetIndex);n===-1?(this.setChainUserIndex(e,this.m_chainBitSetIndex,this.m_chainBitSets.length),this.m_chainBitSets.push(t)):this.m_chainBitSets[n]=t}getEmptySet(){return this.m_emptyBitSet||=new Kf,this.m_emptyBitSet}deleteEdgeBitSets_(){this.m_edgeBitSetIndex!==-1&&(this.deleteUserIndexForHalfEdges(this.m_edgeBitSetIndex),this.m_edgeBitSetIndex=-1),this.m_edgeBitSetIndexLeft!==-1&&(this.deleteUserIndexForHalfEdges(this.m_edgeBitSetIndexLeft),this.m_edgeBitSetIndexLeft=-1),this.m_edgeBitSets.length=0,this.m_uniqueBitSets=null}deleteChainBitSets_(){this.m_chainBitSetIndex!==-1&&(this.deleteUserIndexForChains(this.m_chainBitSetIndex),this.m_chainBitSetIndex=-1,this.m_chainBitSets.length=0)}dbgPrintEdge_(e){}dbgVerifyEdgeSegment(e){}};np.c_EdgeParentageMask=2147483647,np.c_EdgeBitMask=1<<31;var rp=class e{freeNode_(e){this.m_listNodes.deleteElement(e)}newNode_(){return this.m_listNodes.newElement()}freeList_(e){this.m_lists.deleteElement(e)}newList_(){return this.m_lists.newElement()}Init_(e){U(0)}constructor(t){this.m_listNodes=new pn(2),this.m_listOfLists=e.st_nullNode(),this.m_bAllowNavigationBetweenLists=!0,t===void 0&&(t=!0),this.m_bAllowNavigationBetweenLists=t,this.m_lists=new pn(this.m_bAllowNavigationBetweenLists?4:2)}createList(){let t=this.newList_();return this.m_bAllowNavigationBetweenLists&&(this.m_lists.setField(t,3,this.m_listOfLists),this.m_listOfLists!==e.st_nullNode()&&this.m_lists.setField(this.m_listOfLists,2,t),this.m_listOfLists=t),t}deleteList(t){let n=this.getFirst(t);for(;n!==e.st_nullNode();){let e=n;n=this.getNext(n),this.freeNode_(e)}if(this.m_bAllowNavigationBetweenLists){let n=this.m_lists.getField(t,2),r=this.m_lists.getField(t,3);n===e.st_nullNode()?this.m_listOfLists=r:this.m_lists.setField(n,3,r),r!==e.st_nullNode()&&this.m_lists.setField(r,2,n)}this.freeList_(t)}reserveLists(e){this.m_lists.setCapacity(e)}addElement(t,n){this.m_lists.getField(t,0);let r=this.m_lists.getField(t,1),i=this.newNode_();return r===e.st_nullNode()?(this.m_lists.setField(t,0,i),this.m_lists.setField(t,1,i)):(this.m_listNodes.setField(r,1,i),this.m_lists.setField(t,1,i)),this.m_listNodes.setField(i,0,n),i}reserveNodes(e){this.m_listNodes.setCapacity(e)}deleteElementDirect(t,n,r){n===e.st_nullNode()?(this.m_lists.setField(t,0,this.m_listNodes.getField(r,1)),this.m_lists.getField(t,1)===r&&this.m_lists.setField(t,1,e.st_nullNode())):(this.m_listNodes.setField(n,1,this.m_listNodes.getField(r,1)),this.m_lists.getField(t,1)===r&&this.m_lists.setField(t,1,n)),this.freeNode_(r)}deleteElementSearch(e,t){let n=-1,r=this.getFirst(e);for(;r!==t;)n=r,r=this.getNext(r);this.deleteElementDirect(e,n,t)}concatenateLists(t,n){let r=this.m_lists.getField(t,1),i=this.m_lists.getField(n,0);if(i!==e.st_nullNode()&&(r===e.st_nullNode()?(this.m_lists.setField(t,0,i),this.m_lists.setField(t,1,this.m_lists.getField(n,1))):(this.m_listNodes.setField(r,1,i),this.m_lists.setField(t,1,this.m_lists.getField(n,1)))),this.m_bAllowNavigationBetweenLists){let t=this.m_lists.getField(n,2),r=this.m_lists.getField(n,3);t===e.st_nullNode()?this.m_listOfLists=r:this.m_lists.setField(t,3,r),r!==e.st_nullNode()&&this.m_lists.setField(r,2,t)}return this.freeList_(n),t}getElement(e){return this.m_listNodes.getField(e,0)}getData(e){return this.getElement(e)}setElement(e,t){U(0)}getNext(e){return this.m_listNodes.getField(e,1)}getFirst(e){return this.m_lists.getField(e,0)}getFirstElement(e){let t=this.getFirst(e);return this.getElement(t)}static st_nullNode(){return-1}clear(){this.m_listNodes.deleteAll(!0),this.m_lists.deleteAll(!0),this.m_listOfLists=e.st_nullNode()}isEmpty(e){return U(0),!1}getNodeCount(){return this.m_listNodes.size()}getListCount(){return this.m_lists.size()}getFirstList(){return this.m_listOfLists}getNextList(e){return this.m_lists.getField(e,3)}};function ip(e=-1){return{m_value:e,m_line:new Z,m_segment:null,m_segmentInfo:new rs(-1),m_env:new I(0,0),m_dxdy:55555555,m_bHorizontal:!1,m_bCurve:!1}}var ap=67,op=class extends vn{constructor(e,t,n){super(!0),this.m_bIntersectionDetected=!1,this.m_nonSimpleResult=new jt,this.m_tempSimpleEdge1=ip(),this.m_tempSimpleEdge2=ip(),this.m_prev1=-1,this.m_prev2=-1,this.m_vertex1=-1,this.m_vertex2=-1,this.m_currentNode=-1,this.m_prevX1=NaN,this.m_prevX2=NaN,this.m_prevY=NaN,this.m_prevX=0,this.m_sweepY=NaN,this.m_sweepX=0,this.m_ptSweep=new z,this.m_simpleEdgesCache=[],this.m_simpleEdgesRecycle=[],this.m_cOutstandingConstructedEdges=0,this.m_shape=e,this.m_bShapeHasSegments=this.m_shape.hasCurves(),this.m_tolerance=t,this.m_tolerance10=10*t,this.m_bIsSimple=n;let r=Math.trunc(Math.min(3*e.getTotalPointCount()/2,ap)),i=Math.min(7,r);this.m_simpleEdgesCache.length=i}tryGetCachedEdge_(e){let t=this.m_simpleEdgesCache[(e&kt())%this.m_simpleEdgesCache.length];return t&&t.m_value===e?t:null}tryDeleteCachedEdge_(e){let t=(e&kt())%this.m_simpleEdgesCache.length,n=this.m_simpleEdgesCache[t];n&&n.m_value===e&&(this.m_simpleEdgesRecycle.push(n),this.m_simpleEdgesCache[t]=null)}tryCreateCachedEdge_(e){let t=(e&kt())%this.m_simpleEdgesCache.length,n=this.m_simpleEdgesCache[t];return n?null:(this.m_simpleEdgesRecycle.length===0?(n=ip(),this.m_cOutstandingConstructedEdges++):n=this.m_simpleEdgesRecycle.pop(),n.m_value=e,this.m_simpleEdgesCache[t]=n,n)}initSimpleEdge_(e,t){this.m_bShapeHasSegments&&this.initSimpleEdgeHelper_(e,t)||e.m_bCurve||(this.m_shape.queryLineConnector(t,e.m_line,!0),e.m_segment=e.m_line,e.m_env.setCoordsNoNAN(e.m_line.getStartX(),e.m_line.getEndX()),e.m_env.vmax+=this.m_tolerance,e.m_line.orientBottomUp(),e.m_bHorizontal=e.m_line.getEndY()===e.m_line.getStartY(),e.m_bHorizontal||(e.m_dxdy=(e.m_line.getEndX()-e.m_line.getStartX())/(e.m_line.getEndY()-e.m_line.getStartY())))}initSimpleEdgeHelper_(e,t){if(e.m_segment=this.m_shape.getSegment(t),e.m_segmentInfo=this.m_shape.getOriginalSegmentInfo(t),e.m_bCurve=e.m_segment!==null,e.m_bCurve){let t=e.m_segment.clone();return t.orientBottomUp(),e.m_segment=t,e.m_env=e.m_segment.queryInterval(0,0),e.m_env.vmax+=this.m_tolerance,!0}return!1}compareTwoSegments_(e,t){let n=e.getStartXY(),r=e.getEndXY(),i=t.getStartXY(),a=t.getEndXY();if(this.m_ptSweep.setCoords(this.m_sweepX,this.m_sweepY),n.isEqualPoint2D(i)&&this.m_sweepY===n.y){this.m_ptSweep.assign(r.compare(a)<0?r:a);let n=e.intersectionOfYMonotonicWithAxisX(this.m_ptSweep.y,this.m_ptSweep.x),i=t.intersectionOfYMonotonicWithAxisX(this.m_ptSweep.y,this.m_ptSweep.x);if(Math.abs(n-i)>this.m_tolerance)return n<i?-1:1}let o=n.compare(i)<0?i:n,s=r.compare(a)<0?r:a,c=0,l=0;for(let n=1;n<5;n++){Ee(o,s,n/5,this.m_ptSweep);let r=e.intersectionOfYMonotonicWithAxisX(this.m_ptSweep.y,this.m_ptSweep.x),i=t.intersectionOfYMonotonicWithAxisX(this.m_ptSweep.y,this.m_ptSweep.x),a=Math.abs(r-i);a>c&&(c=a,l=r<i?-1:1)}return l===0?this.errorCracking():l}compareNonHorizontal_(e,t){if(e.m_line.getStartY()===t.m_line.getStartY()&&e.m_line.getStartX()===t.m_line.getStartX())return e.m_line.getEndY()===t.m_line.getEndY()&&e.m_line.getEndX()===t.m_line.getEndX()?this.m_bIsSimple?this.errorCoincident():0:this.compareNonHorizontalUpperEnd_(e,t);if(e.m_line.getEndY()===t.m_line.getEndY()&&e.m_line.getEndX()===t.m_line.getEndX())return this.compareNonHorizontalLowerEnd_(e,t);let n=this.compareNonHorizontalLowerEnd_(e,t),r=this.compareNonHorizontalUpperEnd_(e,t);return n<0&&r<0?-1:n>0&&r>0?1:this.errorCracking()}compareHorizontal1Case1_(e,t){if(e.getEndX()>t.getEndX()){if(t.getEndX()>t.getStartX()&&t.getEndY()-t.getStartY()<2*this.m_tolerance&&e.isIntersectingPoint(t.getEndXY(),this.m_tolerance,!0))return this.errorCracking()}else if((t.getEndY()-t.getStartY())/(t.getEndX()-t.getStartX())*(e.getEndX()-e.getStartX())<this.m_tolerance10&&t.isIntersectingPoint(e.getEndXY(),this.m_tolerance,!0))return this.errorCracking();return 1}compareHorizontal1Case2_(e,t){if(e.getStartX()<t.getStartX()){if(t.getEndX()>t.getStartX()&&t.getEndY()-t.getStartY()<2*this.m_tolerance&&e.isIntersectingPoint(t.getEndXY(),this.m_tolerance,!0))return this.errorCracking()}else if((t.getEndY()-t.getStartY())/(t.getEndX()-t.getStartX())*(e.getStartX()-e.getEndX())<this.m_tolerance10&&t.isIntersectingPoint(e.getStartXY(),this.m_tolerance,!0))return this.errorCracking();return-1}compareHorizontal1Case3_(e,t){let n=z.getNAN();n.setSub(t.getEndXY(),t.getStartXY()),n.rightPerpendicularThis(),n.normalize();let r=z.getNAN();r.setSub(e.getStartXY(),t.getStartXY());let i=z.getNAN();i.setSub(e.getEndXY(),t.getStartXY());let a=r.dotProduct(n),o=i.dotProduct(n),s=Math.abs(a),c=Math.abs(o);if(s<c){if(s<this.m_tolerance10&&t.isIntersectingPoint(e.getStartXY(),this.m_tolerance,!0))return this.errorCracking()}else if(c<this.m_tolerance10&&t.isIntersectingPoint(e.getEndXY(),this.m_tolerance,!0))return this.errorCracking();return a<0&&o<0?-1:a>0&&o>0?1:this.errorCracking()}compareHorizontal1_(e,t){return e.getStartY()===t.getStartY()&&e.getStartX()===t.getStartX()?this.compareHorizontal1Case1_(e,t):e.getEndY()===t.getEndY()&&e.getEndX()===t.getEndX()?this.compareHorizontal1Case2_(e,t):this.compareHorizontal1Case3_(e,t)}compareHorizontal2_(e,t){return e.getEndY()===t.getEndY()&&e.getEndX()===t.getEndX()&&e.getStartY()===t.getStartY()&&e.getStartX()===t.getStartX()?this.m_bIsSimple?this.errorCoincident():0:this.errorCracking()}compareNonHorizontalLowerEnd_(e,t){let n=1;if(e.m_line.getStartY()<t.m_line.getStartY()){n=-1;let r=e;e=t,t=r}let r=e.m_line,i=t.m_line,a=r.getStartX()-i.getStartX(),o=t.m_dxdy*(r.getStartY()-i.getStartY()),s=this.m_tolerance10;return a<o-s?-n:a>o+s?n:i.isIntersectingPoint(r.getStartXY(),this.m_tolerance,!0)?this.errorCracking():a<o?-n:n}compareNonHorizontalUpperEnd_(e,t){let n=1;if(t.m_line.getEndY()<e.m_line.getEndY()){n=-1;let r=e;e=t,t=r}let r=e.m_line,i=t.m_line,a=r.getEndX()-i.getStartX(),o=t.m_dxdy*(r.getEndY()-i.getStartY()),s=this.m_tolerance10;return a<o-s?-n:a>o+s?n:i.isIntersectingPoint(r.getEndXY(),this.m_tolerance,!0)?this.errorCracking():a<o?-n:n}errorCoincident(){return this.m_bIntersectionDetected=!0,this.m_nonSimpleResult=new jt(7,this.m_vertex1,this.m_vertex2),-1}errorCracking(){return this.m_bIntersectionDetected=!0,this.m_bIsSimple?this.m_nonSimpleResult=new jt(6,this.m_vertex1,this.m_vertex2):(this.m_prev1=-1,this.m_prev2=-1,this.m_vertex1=-1,this.m_vertex2=-1),-1}compareSegments_(e,t,n,r){if(n.m_env.vmax<r.m_env.vmin)return-1;if(r.m_env.vmax<n.m_env.vmin)return 1;if(!n.m_bCurve&&!r.m_bCurve){let e=n.m_bHorizontal?1:0;return e|=r.m_bHorizontal?2:0,e===0?this.compareNonHorizontal_(n,r):e===1?this.compareHorizontal1_(n.m_line,r.m_line):e===2?-1*this.compareHorizontal1_(r.m_line,n.m_line):this.compareHorizontal2_(n.m_line,r.m_line)}if(this.m_bIntersectionDetected)return-1;let i=this.m_prevY===this.m_sweepY&&this.m_prevX===this.m_sweepX,a,o;if(i&&e===this.m_prev1?a=this.m_prevX1:(a=NaN,this.m_prev1=-1),i&&t===this.m_prev2?o=this.m_prevX2:(o=NaN,this.m_prev2=-1),this.m_prevY=this.m_sweepY,this.m_prevX=this.m_sweepX,Number.isNaN(a)){this.m_prev1=e;let t=n.m_segment.intersectionOfYMonotonicWithAxisX(this.m_sweepY,this.m_sweepX);a=t,this.m_prevX1=t}if(Number.isNaN(o)){this.m_prev2=t;let e=r.m_segment.intersectionOfYMonotonicWithAxisX(this.m_sweepY,this.m_sweepX);o=e,this.m_prevX2=e}let s=Ld(!0,!0,n.m_segment,r.m_segment,this.m_tolerance,!0);return s===0?Math.abs(a-o)<=this.m_tolerance?this.compareTwoSegments_(n.m_segment,r.m_segment):a<o?-1:a>o?1:0:s===2?this.m_bIsSimple?this.errorCoincident():n.m_segmentInfo.equals(r.m_segmentInfo)?0:this.errorCracking():this.errorCracking()}clearIntersectionDetectedFlag(){this.m_bIntersectionDetected=!1}intersectionDetected(){return this.m_bIntersectionDetected}getLastComparedNode(){return this.m_currentNode}getResult(){return this.m_nonSimpleResult}setSweepY(e,t){this.m_sweepY=e,this.m_sweepX=t,this.m_prev1=-1,this.m_prev2=-1,this.m_vertex1=-1,this.m_vertex2=-1}compare(e,t,n){if(this.m_bIntersectionDetected)return-1;let r=e.getElement(n),i=t;return this.m_currentNode=n,this.compareSegments(i,i,r,r)}compareSegments(e,t,n,r){let i=this.tryGetCachedEdge_(e);i===null?this.m_vertex1===t?i=this.m_tempSimpleEdge1:(this.m_vertex1=t,i=this.tryCreateCachedEdge_(e),i===null&&(i=this.m_tempSimpleEdge1,this.m_tempSimpleEdge1.m_value=e),this.initSimpleEdge_(i,t)):this.m_vertex1=t;let a=this.tryGetCachedEdge_(n);return a===null?this.m_vertex2===r?a=this.m_tempSimpleEdge2:(this.m_vertex2=r,a=this.tryCreateCachedEdge_(n),a===null&&(a=this.m_tempSimpleEdge2,this.m_tempSimpleEdge2.m_value=n),this.initSimpleEdge_(a,r)):this.m_vertex2=r,this.compareSegments_(t,r,i,a)}onDelete(e){this.tryDeleteCachedEdge_(e)}onSet(e){this.tryDeleteCachedEdge_(e)}onEndSearch(e){this.tryDeleteCachedEdge_(e)}onAddUniqueElementFailed(e){this.tryDeleteCachedEdge_(e)}},sp=class{constructor(e,t){this.m_bIntersectionDetected=!1,this.m_pointOfInterest=z.getNAN(),this.m_line1=new Z,this.m_seg1=null,this.m_env=I.constructEmpty(),this.m_vertex1=-1,this.m_currentNode=-1,this.m_minDist=Number.MAX_VALUE,this.m_shape=e,this.m_tolerance=t}getCurrentNode(){return this.m_currentNode}clearIntersectionDetectedFlag(){this.m_bIntersectionDetected=!1,this.m_minDist=Number.MAX_VALUE}intersectionDetected(){return this.m_bIntersectionDetected}setPoint(e){this.m_pointOfInterest.assign(e)}compare(e,t){let n=e.getElement(t);return this.compareVertex(e,t,n)}compareVertex(e,t,n){let r,i=this.m_shape.getSegment(n),a=!0;if(i==null)this.m_shape.queryLineConnector(n,this.m_line1,!0),this.m_env.setCoordsNoNAN(this.m_line1.getStartX(),this.m_line1.getEndX()),i=this.m_line1,r=this.m_line1.getStartY()===this.m_line1.getEndY();else{let e=G.constructEmpty();i.queryLooseEnvelope(e),e.queryIntervalX(this.m_env),r=e.height()===0,a=!1}if(this.m_pointOfInterest.x+this.m_tolerance<this.m_env.vmin)return-1;if(this.m_pointOfInterest.x-this.m_tolerance>this.m_env.vmax)return 1;if(r)return this.m_currentNode=t,this.m_bIntersectionDetected=!0,0;let o=0;if(a){gi(this.m_line1);let e=this.m_line1.getStartXY(),t=new z;t.setSub(this.m_line1.getEndXY(),e),t.rightPerpendicularThis();let n=new z;n.setSub(this.m_pointOfInterest,e),o=t.dotProduct(n),o/=t.length()}else o=i.intersectionOfYMonotonicWithAxisX(this.m_pointOfInterest.y,this.m_pointOfInterest.x)-this.m_pointOfInterest.x;return o<10*-this.m_tolerance?-1:o>10*this.m_tolerance?1:(i.isIntersectingPoint(this.m_pointOfInterest,this.m_tolerance)&&(Math.abs(o)<this.m_minDist&&(this.m_currentNode=t,this.m_minDist=o),this.m_bIntersectionDetected=!0),o<0?-1:o>0?1:0)}},cp=class e{constructor(t,n){this.m_lists=new rp(!1),this.m_hash=n,this.m_hashBuckets=new Int32Array(t),this.m_hashBuckets.fill(e.st_nullNode()),this.m_bitFilter=new Int32Array(10*t+31>>5)}reserveElements(e){this.m_lists.reserveLists(Math.min(this.m_hashBuckets.length,e)),this.m_lists.reserveNodes(e)}addElement(e,t){t===void 0&&(t=this.m_hash.getHash(e));let n=t%(this.m_bitFilter.length<<5);this.m_bitFilter[n>>5]|=1<<(31&n);let r=t%this.m_hashBuckets.length,i=this.m_hashBuckets[r];return i===rp.st_nullNode()&&(i=this.m_lists.createList(),this.m_hashBuckets[r]=i),this.m_lists.addElement(i,e)}deleteElement(e,t){t===void 0&&(t=this.m_hash.getHash(e));let n=t%this.m_hashBuckets.length,r=this.m_hashBuckets[n];r===rp.st_nullNode()&&R(``);let i=this.m_lists.getFirst(r),a=rp.st_nullNode();for(;i!==rp.st_nullNode();){let t=this.m_lists.getData(i),o=this.m_lists.getNext(i);t===e?(this.m_lists.deleteElementDirect(r,a,i),this.m_lists.getFirst(r)===rp.st_nullNode()&&(this.m_lists.deleteList(r),this.m_hashBuckets[n]=rp.st_nullNode())):a=i,i=o}}getFirstInBucket(e){let t=e%(this.m_bitFilter.length<<5);if(!(this.m_bitFilter[t>>5]&1<<(31&t)))return rp.st_nullNode();let n=e%this.m_hashBuckets.length,r=this.m_hashBuckets[n];return r===rp.st_nullNode()?rp.st_nullNode():this.m_lists.getFirst(r)}getNextInBucket(e){return this.m_lists.getNext(e)}findNode(e){let t=this.m_hash.getHash(e),n=this.getFirstInBucket(t);for(;n!==rp.st_nullNode();){let t=this.m_lists.getData(n);if(this.m_hash.equal(t,e))return n;n=this.m_lists.getNext(n)}return rp.st_nullNode()}deleteNode(e){let t=this.getElement(e),n=this.m_hash.getHash(t)%this.m_hashBuckets.length,r=this.m_hashBuckets[n];r===rp.st_nullNode()&&R(``),this.m_lists.deleteElementSearch(r,e),this.m_lists.getFirst(r)===rp.st_nullNode()&&(this.m_lists.deleteList(r),this.m_hashBuckets[n]=rp.st_nullNode())}getElement(e){return this.m_lists.getData(e)}static st_nullNode(){return rp.st_nullNode()}clear(){U(0)}size(){return this.m_lists.getNodeCount()}dbgPrintBucketHistogram(){}};function lp(e,t,n,r,i){let a=new gp(i);return a.m_shape=e,a.m_sqrTolerance=t*t,a.m_cellSize=2*t,a.m_invCellSize=1/a.m_cellSize,a.m_geometry=n,a.m_bTrackChanges=r,a.m_bHasSegmentParentage=e.hasSegmentParentage(),a.clusterNonReciprocal()}function up(e,t,n,r,i){let a=e-n,o=t-r;return a*a+o*o<=i}function dp(){return{pt:new z,weight:0,rank:0,bMerged:!1}}function fp(e,t,n,r,i,a){let o=dp(),s=n+i,c=!1,l=e.x;e.x!==t.x&&(r===a&&(l=(e.x*n+t.x*i)/s),c=!0);let u=e.y;return e.y!==t.y&&(r===a&&(u=(e.y*n+t.y*i)/s),c=!0),r===a?(o.pt.setCoords(l,u),o.weight=s,o.rank=r):r>a?(o.rank=r,o.weight=n,o.pt=e):(o.rank=a,o.weight=i,o.pt=t),o.bMerged=c,o}function pp(e,t,n,r,i,a,o,s,c){let l=e.equals(t);if(r>a)return o.assignCopy(e),c[0]=r,s[0]=n,l;if(a>r)return o=t,c[0]=a,s[0]=i,l;o.assignCopy(e);let u=fp(e.getXY(),t.getXY(),n,r,i,a);return o.setXY(u.pt),s[0]=u.weight,c[0]=u.rank,l}function mp(e,t){let n=ne(e);return O(n,t)}var hp=class{constructor(e,t,n,r,i){this.m_workPt=new z,this.m_shape=e,this.m_sqrTolerance=n,this.m_invCellSize=r,this.m_origin=t.clone(),this.m_hashValues=i}getHash(e){return this.m_shape.getUserIndex(e,this.m_hashValues)}calculateHashFromVertex(e){this.m_shape.queryXY(e,this.m_workPt);let t=this.m_workPt.x-this.m_origin.x,n=Math.trunc(t*this.m_invCellSize+.5),r=this.m_workPt.y-this.m_origin.y;return mp(n,Math.trunc(r*this.m_invCellSize+.5))}equal(e,t){return U(0),!1}},gp=class{constructor(e){this.m_origin=z.getNAN(),this.m_sqrTolerance=0,this.m_cellSize=0,this.m_invCellSize=0,this.m_geometry=-1,this.m_bucketArray=H(4,NaN),this.m_bucketHash=H(4,NaN),this.m_dbgCandidateCheckCount=0,this.m_nsr=new jt,this.m_hashValues=-1,this.m_newClusters=-1,this.m_bTrackChanges=!1,this.m_bHasSegmentParentage=!1,this.m_shape=null,this.m_clusters=new rp,this.m_hashFunction=null,this.m_hashTable=null,this.m_progressCounter=0,this.m_progressTracker=e}progress_(){}collectClusterCandidates(e,t){let n=z.getNAN();this.m_shape.queryXY(e,n);let r=(n.x-this.m_origin.x)*this.m_invCellSize,i=(n.y-this.m_origin.y)*this.m_invCellSize,a=Math.trunc(r),o=Math.trunc(i),s=0;for(let e=0;e<=1;e+=1)for(let t=0;t<=1;t+=1){let n=mp(a+e,o+t),r=this.m_hashTable.getFirstInBucket(n);r!==cp.st_nullNode()&&(this.m_bucketArray[s]=r,this.m_bucketHash[s]=n,s++)}for(let e=s-1;e>=1;e--){let t=this.m_bucketArray[e];for(let n=e-1;n>=0;n--)if(t===this.m_bucketArray[n]){this.m_bucketHash[n]=-1,s--,e!==s&&(this.m_bucketHash[e]=this.m_bucketHash[s],this.m_bucketArray[e]=this.m_bucketArray[s]);break}}for(let r=0;r<s;r++)this.collectNearestNeighbourCandidates(e,this.m_bucketHash[r],n,this.m_bucketArray[r],t)}collectNearestNeighbourCandidates(e,t,n,r,i){let a=z.getNAN();for(let o=r;o!==cp.st_nullNode();o=this.m_hashTable.getNextInBucket(o)){let r=this.m_hashTable.getElement(o);e===r||t!==-1&&this.m_shape.getUserIndex(r,this.m_hashValues)!==t||(this.m_shape.queryXY(r,a),up(n.x,n.y,a.x,a.y,this.m_sqrTolerance)&&i.push(o))}}mergeClusters(e,t,n){let r=this.m_shape.getUserIndex(e,this.m_newClusters),i=this.m_shape.getUserIndex(t,this.m_newClusters);r===-1&&(r=this.m_clusters.createList(),this.m_clusters.addElement(r,e),this.m_shape.setUserIndex(e,this.m_newClusters,r)),i===-1?this.m_clusters.addElement(r,t):this.m_clusters.concatenateLists(r,i),this.m_shape.setUserIndex(t,this.m_newClusters,pn.impossibleIndex2());let a=this.mergeVertices(e,t);if(n){let t=this.m_hashFunction.calculateHashFromVertex(e);this.m_shape.setUserIndex(e,this.m_hashValues,t)}return a}mergeVertices(e,t){let n=z.getNAN();this.m_shape.queryXY(e,n);let r=z.getNAN();this.m_shape.queryXY(t,r);let i=this.m_shape.getRank(e),a=this.m_shape.getRank(t),o=this.m_shape.getWeight(e),s=this.m_shape.getWeight(t),c,l,u,d,f=!1;if(i===a?(c=i,l=o+s,u=n.x,n.x!==r.x&&(u=(n.x*o+r.x*s)/l,f=!0),d=n.y,n.y!==r.y&&(d=(n.y*o+r.y*s)/l,f=!0)):(i>a?(u=n.x,d=n.y,l=o,c=i):(u=r.x,d=r.y,l=s,c=a),f=!n.equals(r)),f&&(this.m_shape.setXYMonotonic(e,u,d),this.m_bTrackChanges&&this.m_shape.setGeometryModifiedWithVertex(e,!0),this.m_bHasSegmentParentage)){let n=this.m_shape.getSegmentParentageBreakVertex(e)||this.m_shape.getSegmentParentageBreakVertex(t);this.m_shape.setSegmentParentageBreakVertex(e,n),this.m_shape.setSegmentParentageBreakVertex(t,n)}return this.m_shape.setWeight(e,l),this.m_shape.setRank(e,c),f}needsClustering(){let n={stack:[],error:void 0,hasError:!1};try{t(n,m(()=>{this.m_hashTable=null,this.m_hashFunction=null,this.m_shape.removeUserIndex(this.m_hashValues),this.m_shape.removeUserIndex(this.m_newClusters)}),!1);let e=this.m_shape.getSelectedCount(),r=this.m_shape.getEnvelope2D(this.m_progressTracker);this.m_origin.assign(r.getLowerLeft());let i=Math.max(r.height(),r.width())/(Ve()-1);this.m_cellSize<i&&(this.m_cellSize=i,this.m_invCellSize=1/this.m_cellSize),this.m_clusters.clear(),this.m_clusters.reserveLists(this.m_shape.getSelectedCount()/3+1),this.m_clusters.reserveNodes(this.m_shape.getSelectedCount()/3+1),this.m_hashValues=this.m_shape.createUserIndex(),this.m_newClusters=this.m_shape.createUserIndex(),this.m_hashFunction=new hp(this.m_shape,this.m_origin,this.m_sqrTolerance,this.m_invCellSize,this.m_hashValues),this.m_hashTable=new cp(4*e/3,this.m_hashFunction),this.m_hashTable.reserveElements(this.m_shape.getSelectedCount());let a=!1;for(let e=0;e<2;e++){let t=[],n=this.m_shape.queryVertexIteratorOnSelection(this.m_geometry);for(let r=n.next();r!==-1;r=n.next()){if(this.progress_(),e>0&&this.m_shape.getUserIndex(r,this.m_newClusters)===pn.impossibleIndex2())continue;let n;if(e===0?(n=this.m_hashFunction.calculateHashFromVertex(r),this.m_shape.setUserIndex(r,this.m_hashValues,n)):n=this.m_shape.getUserIndex(r,this.m_hashValues),this.collectClusterCandidates(r,t),t.length!==0){for(let e=0,n=t.length;e<n;e++){this.progress_();let n=t[e],i=this.m_hashTable.getElement(n);if(this.m_hashTable.deleteNode(n),!this.m_shape.isEqualXY(r,i))return this.m_nsr=new jt(5,this.m_shape.getVertexIndex(r),this.m_shape.getVertexIndex(i)),a=!0,a;this.mergeClusters(r,i,!1)}t.length=0}e===0&&this.m_hashTable.addElement(r,n)}}return a}catch(e){n.error=e,n.hasError=!0}finally{e(n)}}clusterNonReciprocal(){let e=this.m_shape.getSelectedCount(),t=this.m_shape.getEnvelope2D(this.m_progressTracker);this.m_origin=t.getLowerLeft();let n=Math.max(t.height(),t.width())/(Ve()-1);this.m_cellSize<n&&(this.m_cellSize=n,this.m_invCellSize=1/this.m_cellSize),this.m_clusters.clear(),this.m_clusters.reserveLists(Math.trunc(this.m_shape.getSelectedCount()/3+1)),this.m_clusters.reserveNodes(Math.trunc(this.m_shape.getSelectedCount()/3+1)),this.m_hashValues=this.m_shape.createUserIndex(),this.m_newClusters=this.m_shape.createUserIndex(),this.m_hashFunction=new hp(this.m_shape,this.m_origin,this.m_sqrTolerance,this.m_invCellSize,this.m_hashValues),this.m_hashTable=new cp(Math.trunc(4*e/3),this.m_hashFunction),this.m_hashTable.reserveElements(this.m_shape.getSelectedCount());let r=!1;{let e=this.m_shape.queryVertexIteratorOnSelection(this.m_geometry);for(let t=e.next();t!==-1;t=e.next()){this.progress_();let e=this.m_hashFunction.calculateHashFromVertex(t);this.m_shape.setUserIndex(t,this.m_hashValues,e),this.m_hashTable.addElement(t,e)}}{let e=[],t=this.m_shape.queryVertexIteratorOnSelection(this.m_geometry);for(let n=t.next();n!==-1;n=t.next()){if(this.m_shape.getUserIndex(n,this.m_newClusters)===pn.impossibleIndex2())continue;let t=this.m_shape.getUserIndex(n,this.m_hashValues);this.m_hashTable.deleteElement(n,t);let i=!1;for(;this.collectClusterCandidates(n,e),e.length!==0;){let t=0;for(let r=0,i=e.length;r<i;r++){this.progress_();let a=e[r],o=this.m_hashTable.getElement(a);this.m_hashTable.deleteNode(a);let s=r+1===i;t|=this.mergeClusters(n,o,s)?1:0}if(i||=t!==0,r||=t!==0,e.length=0,!t)break}i&&(t=this.m_shape.getUserIndex(n,this.m_hashValues)),this.m_hashTable.addElement(n,t)}e.length=0}return r&&this.applyClusterPositions_(),this.m_hashTable=null,this.m_hashFunction=null,this.m_shape.removeUserIndex(this.m_hashValues),this.m_shape.removeUserIndex(this.m_newClusters),r}applyClusterPositions_(){let e=z.getNAN();for(let t=this.m_clusters.getFirstList();t!==rp.st_nullNode();t=this.m_clusters.getNextList(t)){let n=this.m_clusters.getFirst(t),r=this.m_clusters.getElement(n);this.m_shape.queryXY(r,e);let i=this.m_shape.getRank(r),a=this.m_shape.getWeight(r);for(n=this.m_clusters.getNext(n);n!==rp.st_nullNode();n=this.m_clusters.getNext(n)){let t=this.m_clusters.getElement(n);if(this.m_bTrackChanges?this.m_shape.isEqualXYPoint2D(t,e)||(this.m_shape.setXYMonotonicPoint2D(t,e),this.m_shape.setGeometryModifiedWithVertex(t,!0)):this.m_shape.setXYMonotonicPoint2D(t,e),this.m_bHasSegmentParentage){let e=this.m_shape.getSegmentParentageBreakVertex(r)||this.m_shape.getSegmentParentageBreakVertex(t);this.m_shape.setSegmentParentageBreakVertex(r,e),this.m_shape.setSegmentParentageBreakVertex(t,e)}this.m_shape.setWeight(t,a),this.m_shape.setRank(t,i)}}}},_p=class e{constructor(){this.m_inputParts=[],this.m_resultParts1=[],this.m_resultParts2=[],this.m_resultSegments=[],this.m_freeSegments=[],this.m_inputSegments=[],this.m_param1=[],this.m_param2=[],this.m_tolerance=0,this.m_toleranceZ=0,this.m_point=new q,this.m_pointWeight=1,this.m_maxDensifyLimit=0,this.m_pointRank=0,this.m_changed1=!1,this.m_changed2=!1,this.m_adaptiveDensify=!1}clear(){this.freeAllResultSegments(),this.m_inputSegments.length=0,this.m_inputParts.length=0,this.m_resultParts1.length=0,this.m_resultParts2.length=0,this.m_param1.length=0,this.m_param2.length=0,this.m_adaptiveDensify=!1,this.m_changed1=!1,this.m_changed2=!1}newIntersectionPart_(e,t,n,r,i,a,o,s,c,l){return yp(e,t,n,r,i,a,o,s,c,l)}pushSegment(e,t,n,r,i,a,o,s,c,l){return this.m_inputParts.push(this.newIntersectionPart_(this.m_inputSegments.length,t,n,r,i,a,o,s,c,l)),this.m_inputSegments.push(e),this.m_inputParts.length-1}getResultSegmentCount(e){return this.m_adaptiveDensify?e===0?this.m_param1.length-1:this.m_param2.length-1:e===0?this.m_resultParts1.length:this.m_resultParts2.length}getResultPart_(e,t){return e===0?this.m_resultParts1[t]:this.m_resultParts2[t]}getResultSegment(e,t){return this.m_resultSegments[this.getResultPart_(e,t).segmentIndex].get()}getSegmentChanged(e){return e===0?this.m_changed1:this.m_changed2}getResultSegmentStartPointWeight(e,t){return this.getResultPart_(e,t).weightStart}getResultSegmentStartPointRank(e,t){return this.getResultPart_(e,t).rankStart}getResultSegmentSegmentParentage(e,t){return this.getResultPart_(e,t).segmentParentage}getResultSegmentStartPointIsBreak(e,t){return this.getResultPart_(e,t).u.bBreakStart}getResultSegmentEndPointWeight(e,t){return this.getResultPart_(e,t).weightEnd}getResultSegmentEndPointRank(e,t){return this.getResultPart_(e,t).rankEnd}getResultSegmentEndPointIsBreak(e,t){return this.getResultPart_(e,t).u.bBreakEnd}getResultSegmentInteriorRank(e,t){return this.getResultPart_(e,t).rankInterior}getResultSegmentInteriorWeight(e,t){return this.getResultPart_(e,t).weightInterior}getResultPoint(){return this.m_point}getResultPointWeight(){return this.m_pointWeight}getResultPointRank(){return this.m_pointRank}getResultPointChanged(){return this.m_changed2}intersectLines(t,n){this.m_inputSegments.length!==2&&B(``),this.m_changed1=!1,this.m_changed2=!1,this.m_tolerance=t;let r=Ct(t*e.c_smallToleranceFactor),i=!1,a=this.m_inputParts[0],o=this.m_inputParts[1],s=this.m_inputSegments[a.segmentIndex],c=this.m_inputSegments[o.segmentIndex];if(n||5&Id(!0,s,c,t,!0)){let e=Bd(!0,s,c,null,this.m_param1,this.m_param2,t);e===0&&B(``);let n=Array(e);for(let t=0;t<e;++t)n[t]=z.getNAN();let l=new Float64Array(e),u=new Int32Array(e),d=Array(e),f=Array(e);for(let t=0;t<e;++t)d[t]=bp(),f[t]=bp();for(let t=0;t<e;t++){let e=this.m_param1[t],p=this.m_param2[t],m,h=a.rankInterior,g=a.weightInterior;e===0?(h=a.rankStart,g=a.weightStart,m=a.u.bBreakStart):e===1?(h=a.rankEnd,g=a.weightEnd,m=a.u.bBreakEnd):(this.m_changed1=!0,m=!1);let _,v=o.rankInterior,y=o.weightInterior;p===0?(v=o.rankStart,y=o.weightStart,_=o.u.bBreakStart):p===1?(v=o.rankEnd,y=o.weightEnd,_=o.u.bBreakEnd):(this.m_changed2=!0,_=!1);let b=h,x=v,S=1,C=0,w=z.getNAN();if(b===x){let n=s.getCoord2D(e),i=c.getCoord2D(p);S=g+y,C=h,Ee(n,i,y/S,w);let a=z.sqrDistance(w,n),o=z.sqrDistance(w,i);d[t].bBigMove=a>r,f[t].bBigMove=o>r,this.m_changed1||n.equals(w)||(this.m_changed1=!0),this.m_changed2||i.equals(w)||(this.m_changed2=!0)}else if(b>x){w=s.getCoord2D(e);let n=c.getCoord2D(p);S=g,C=h;let i=z.sqrDistance(w,n);d[t].bBigMove=!1,f[t].bBigMove=i>r,this.m_changed2||n.equals(w)||(this.m_changed2=!0)}else{w=c.getCoord2D(p),S=y,C=v;let n=s.getCoord2D(e),i=z.sqrDistance(w,n);d[t].bBigMove=i>r,f[t].bBigMove=!1,this.m_changed1||n.equals(w)||(this.m_changed1=!0)}n[t].assign(w),l[t]=S,u[t]=C,d[t].bIsBreak=m||_,f[t].bIsBreak=m||_,i||=d[t].bBigMove||f[t].bBigMove}let p=a.rankInterior,m=a.weightInterior,h=0,g=-1;for(let r=0;r<=e;r++){let i=r<e?this.m_param1[r]:1;if(i!==h){let o=this.allocResultSegment(),c=this.m_resultSegments[o],f,_,v,y;s.queryCut(h,i,c,!1),c.get().snapControlPoints(t*t);let b=!1,x=!1,S=!1,C=!1,w=!1,T=z.getNAN(),E=z.getNAN();g===-1?(f=a.weightStart,_=a.rankStart,T=c.get().getStartXY(),S=a.u.bBreakStart):(_=u[g],f=l[g],b=d[g].bBigMove,T.assign(n[g]),S=d[g].bIsBreak,w=!0),r<e?(y=u[r],v=l[r],x=d[r].bBigMove,E.assign(n[r]),C=d[r].bIsBreak,w=!0):(v=a.weightEnd,y=a.rankEnd,E=c.get().getEndXY(),C=a.u.bBreakEnd),w&&c.get().setCoordsForIntersector(T,E,!0),this.m_resultParts1.push(this.newIntersectionPart_(o,f,_,v,y,m,p,S,C,a.segmentParentage));let D=this.m_resultParts1.at(-1);D.u.bBigMoveStart=b,D.u.bBigMoveEnd=x,h=i,g=r}else g===-1&&(g=r)}let _=H(e,0);for(let t=0;t<e;t++)_[t]=t;e>2?(_.sort((e,t)=>this.m_param2[e]<this.m_param2[t]?-1:this.m_param2[e]>this.m_param2[t]?1:0),v(this.m_param2)):e===2&&this.m_param2[0]>this.m_param2[1]&&(this.m_param2[1]=W(this.m_param2[0],this.m_param2[0]=this.m_param2[1]),_[1]=W(_[0],_[0]=_[1]));let y=o.rankInterior,b=o.weightInterior;h=0,g=-1;for(let r=0;r<=e;r++){let i=r<e?this.m_param2[r]:1;if(i!==h){let a=this.allocResultSegment(),s=this.m_resultSegments[a],d,p,m,v;c.queryCut(h,i,s,!1),s.get().snapControlPoints(t*t);let x=z.getNAN(),S=z.getNAN(),C=!1,w=!1,T=!1,E=!1,D=!1;if(g!==-1){let e=_[g];d=l[e],p=u[e],x.assign(n[e]),T=f[e].bBigMove,C=f[e].bIsBreak,D=!0}else d=o.weightStart,p=o.rankStart,x=s.get().getStartXY(),C=o.u.bBreakStart;if(r!==e){let e=_[r];m=l[e],v=u[e],S.assign(n[e]),E=f[e].bBigMove,w=f[e].bIsBreak,D=!0}else m=o.weightEnd,v=o.rankEnd,S=s.get().getEndXY(),w=o.u.bBreakEnd;D&&s.get().setCoordsForIntersector(x,S,!0),this.m_resultParts2.push(this.newIntersectionPart_(a,d,p,m,v,b,y,C,w,o.segmentParentage));let O=this.m_resultParts2.at(-1);O.u.bBigMoveStart=T,O.u.bBigMoveEnd=E,h=i,g=r}else g===-1&&(g=r)}return i?3:2}return 0}intersectLines3D(e,t,n,r){return U(0),1}intersect2D(e,t){let n=this.m_inputParts[0],r=this.m_inputParts[1],i=this.m_inputSegments[n.segmentIndex].getGeometryType(),a=this.m_inputSegments[r.segmentIndex].getGeometryType();return i!==L.enumLine||a!==L.enumLine?new wp(this).intersectCurves(e,t):this.intersectLines(e,t)}intersect2DEx(t,n,r,i,a){this.m_point.assignCopy(n),this.m_inputSegments.length!==1&&B(``),this.m_tolerance=t,this.m_changed1=!1,this.m_changed2=!1;let o=Ct(t*e.c_smallToleranceFactor),s=!1,c=this.m_inputParts[0],l=this.m_inputSegments[c.segmentIndex];if(a||l.isIntersectingPoint(n.getXY(),t,!0)){this.m_param1=H(16,NaN);let e=l.getClosestCoordinate(n.getXY(),!1);this.m_param1[0]=e;let a=c.rankInterior,u=c.weightInterior;e===0?(a=c.rankStart,u=c.weightStart):e===1?(a=c.rankEnd,u=c.weightEnd):this.m_changed1=!0;let d=a,f=r,p=i;d===f&&l.isCurve()&&(d=f+1);let m=1,h=0,g=new z;if(d===f){let t=l.getCoord2D(e),r=n.getXY();m=u+p,h=a,Ee(t,r,p/m,g),this.m_changed1||t.equals(g)||(this.m_changed1=!0),this.m_changed2||r.equals(g)||(this.m_changed2=!0),s=z.sqrDistance(g,t)>o}else d>f?(g.assign(l.getCoord2D(e)),m=u,h=a,this.m_changed2||g.equals(n.getXY())||(this.m_changed2=!0)):(g.assign(l.getCoord2D(e)),m=p,h=f,this.m_changed1||g.equals(n.getXY())||(this.m_changed1=!0),s=z.sqrDistance(g,n.getXY())>o);let _=0,v=-1;for(let e=0;e<=1;e++){let n=e<1?this.m_param1[0]:1;if(n!==_){let r=this.allocResultSegment(),i=this.m_resultSegments[r];l.queryCut(_,n,i),i.get().snapControlPoints(t*t);let a=c.weightStart,o=c.weightEnd,s=c.rankStart,u=c.rankEnd,d=c.rankInterior,f=c.weightInterior,p=c.u.bBreakStart,y=c.u.bBreakEnd;v!==-1&&(a=m,s=h,p=!0,i.get().setCoordsForIntersector(g,i.get().getEndXY(),!0)),e!==1&&(o=m,u=h,y=!0,i.get().setCoordsForIntersector(i.get().getStartXY(),g,!0)),_=n,this.m_resultParts1.push(this.newIntersectionPart_(r,a,s,o,u,f,d,p,y,c.segmentParentage))}v=e}return this.m_point.setXY(g),this.m_pointWeight=m,this.m_pointRank=h,s?3:2}return 0}intersect3D(e,t,n,r){return U(0),1}intersect3DEx(e,t,n,r,i,a,o){return U(0),1}getTolerance(){return this.m_tolerance}freeAllResultSegments(){this.m_resultSegments.length=0,this.m_freeSegments.length=0}freeResultSegment(e){this.m_freeSegments.push(e)}allocResultSegment(){if(this.m_freeSegments.length)return this.m_freeSegments.pop();let e=new Q,t=this.m_resultSegments.length;return this.m_resultSegments.push(e),t}allocResultSegmentFromBuffer(e){if(this.m_freeSegments.length)return this.m_freeSegments.pop();let t=new Q({copy:e}),n=this.m_resultSegments.length;return this.m_resultSegments.push(t),n}allocResultSegmentFromSegment(e){if(this.m_freeSegments.length)return this.m_freeSegments.pop();let t=new Q({segment:e}),n=this.m_resultSegments.length;return this.m_resultSegments.push(t),n}};function vp(e,t){return{bBigMoveStart:!1,bBigMoveEnd:!1,bBreakStart:e,bBreakEnd:t}}function yp(e,t,n,r,i,a,o,s,c,l){return{segmentIndex:e,weightStart:t,rankStart:n,weightEnd:r,rankEnd:i,weightInterior:a,rankInterior:o,segmentParentage:l,u:vp(s,c)}}function bp(){return{bBigMove:!1,bIsBreak:!1}}_p.maxWeight=.1*Number.MAX_VALUE,_p.c_smallToleranceFactor=.01,_p.c_maxGeometryTypeToRankDelta=8;var xp=class{constructor(){this.start=null,this.end=null,this.equalEdge=null,this.segmentIndex=-1,this.segmentParentage=-1,this.weight=0,this.rank=0}hasSegment(){return this.segmentIndex>=0}transferAttributes(e,t,n){if(t.getDescription().getAttributeCount()===1)return;let r=e.parent.m_resultSegments[this.segmentIndex].get().getStartXY(),i=e.parent.m_resultSegments[this.segmentIndex].get().getEndXY(),a=new q;t.queryStart(a),n?(a.setXY(r),e.parent.m_resultSegments[this.segmentIndex].get().setStart(a)):(a.setXY(i),e.parent.m_resultSegments[this.segmentIndex].get().setEnd(a)),t.queryEnd(a),n?(a.setXY(i),e.parent.m_resultSegments[this.segmentIndex].get().setEnd(a)):(a.setXY(r),e.parent.m_resultSegments[this.segmentIndex].get().setStart(a))}copyFromWhenOverlap(e,t,n){this.equalEdge=t,t.equalEdge=this,this.segmentIndex=e.parent.allocResultSegmentFromBuffer(e.parent.m_resultSegments[t.segmentIndex]),this.segmentParentage=t.segmentParentage,this.weight=t.weight,this.rank=t.rank,n?(this.start.copyFrom(t.start),this.end.copyFrom(t.end)):(this.start.copyFrom(t.end),this.end.copyFrom(t.start),e.parent.m_resultSegments[this.segmentIndex].get().reverse())}getEnd(){return this.end}getNextInChain(){return this.end.nextInChain}getPrevInChain(){return this.start.prevInChain}},Sp=class{constructor(){this.hash=0,this.pt=new z,this.prevInChain=null,this.nextInChain=null,this.prevInHash=null,this.nextInHash=null,this.prevEqual=null,this.nextEqual=null,this.weight=0,this.rank=0,this.bBigMove=!1,this.bIsBreak=!1}copyFrom(e){this.pt.assign(e.pt),this.weight=e.weight,this.rank=e.rank,this.bBigMove=e.bBigMove,this.bIsBreak=e.bIsBreak}nextNode(){return this.nextInChain?this.nextInChain.end:null}prevNode(){return this.prevInChain?this.prevInChain.start:null}equalListHead(){let e=this;for(;e.prevEqual!==null;e=e.prevEqual);return e}};function Cp(e,t,n,r){return{edge1:e,edge2:t,recursion:n,bIsIntersecting:r}}var wp=class{constructor(e){this.m_pairs=[],this.m_chainOrigin1=null,this.m_chainOrigin2=null,this.m_newNodes=[],this.m_hashTableOfEquals=[],this.m_hashTableOfEqualsSize=0,this.m_origin=new z,this.m_cell=new z,this.parent=e}addSegment(e,t,n,r,i,a,o,s,c,l,u){let d=this.newNode(this.parent.m_resultSegments[e].get().getStartXY(),n,r,c),f=this.newNode(this.parent.m_resultSegments[e].get().getEndXY(),i,a,l);this.newEdge(d,f,e,o,s,u),this.m_chainOrigin1===null?this.m_chainOrigin1=d:this.m_chainOrigin2===null?this.m_chainOrigin2=d:U(0)}intersectCurvesHelper(e,t,n,r,i){let a=this.getSegment(e).get(),o=this.getSegment(t).get();if(a.isDegenerate(0)||o.isDegenerate(0))return 0;let s=this.tryOverlapIntersectCurves(e,t,n,r);if(s!==0)return s;let c=Ct(.01*n),l=!1,u=this.processSharpCorners(a,o,n,i>4),d=u>0;if(!d){if(!(r||5&Ld(!0,!1,a,o,n,!0)))return 0;u=Bd(!0,a,o,null,this.parent.m_param1,this.parent.m_param2,n)}u===0&&B(``);let f=a.getGeometryType(),p=o.getGeometryType(),m=C(z,u),h=C(z,u),g=H(u,NaN),_=H(u,NaN),v=H(u,NaN),y=H(u,NaN),b=he(bp,u),x=he(bp,u),S=!1,w=!1;for(let r=0;r<u;r++){let i=this.parent.m_param1[r],s=this.parent.m_param2[r],u=e.rank,C=e.weight,T=!0,E=!1;i===0?(u=e.start.rank,C=e.start.weight,E=e.start.bIsBreak):i===1?(u=e.end.rank,C=e.end.weight,E=e.end.bIsBreak):(S=!0,T=!1);let D=t.rank,O=t.weight,k=!1,A=!0;s===0?(D=t.start.rank,O=t.start.weight,k=t.start.bIsBreak):s===1?(D=t.end.rank,O=t.end.weight,k=t.end.bIsBreak):(w=!0,A=!1);let j=u,M=D;if(j===M&&(j*=_p.c_maxGeometryTypeToRankDelta,M*=_p.c_maxGeometryTypeToRankDelta,j+=Tp(f,a,!1),M+=Tp(p,o,!1)),T&&A&&M===j){let e=a.getCoord2D(i),t=o.getCoord2D(s);e.equals(t)&&(M=j-1)}let N=1,P=0,ee=1,te=0,F=new z,ne=new z,re=a.getCoord2D(i),ie=o.getCoord2D(s);if(d&&z.distance(re,ie)>n)F.setCoordsPoint2D(re),ne.setCoordsPoint2D(ie),N=C,ee=O,P=u,te=D,b[r].bBigMove=!1,x[r].bBigMove=!1,E=!0,k=!0;else if(j===M){ee=N=C+O,te=P=u,Ee(re,ie,O/N,F),ne.setCoordsPoint2D(F);let e=z.sqrDistance(F,re),t=z.sqrDistance(F,ie);b[r].bBigMove=e>c,x[r].bBigMove=t>c,S||re.equals(F)||(S=!0),w||ie.equals(ne)||(w=!0)}else if(j>M){F.setCoordsPoint2D(re),ne.setCoordsPoint2D(F),ee=N=C,te=P=u;let e=z.sqrDistance(F,ie);b[r].bBigMove=!1,x[r].bBigMove=e>c,w||ie.equals(ne)||(w=!0)}else{ne.setCoordsPoint2D(ie),F.setCoordsPoint2D(ne),ee=N=O,te=P=D;let e=z.sqrDistance(F,re);b[r].bBigMove=e>c,x[r].bBigMove=!1,S||re.equals(F)||(S=!0)}m[r].assign(F),h[r].assign(ne),g[r]=N,_[r]=ee,v[r]=P,y[r]=te,b[r].bIsBreak=E||k,x[r].bIsBreak=E||k,l||=b[r].bBigMove||x[r].bBigMove,r>0&&(i!==this.parent.m_param1[r-1]&&s!==this.parent.m_param2[r-1]||(v[r]<=v[r-1]?(m[r].assign(h[r-1]),g[r]=_[r-1],v[r]=y[r-1],h[r].assign(h[r-1]),_[r]=_[r-1],y[r]=y[r-1],b[r].bBigMove||=b[r-1].bBigMove,x[r].bBigMove||=x[r-1].bBigMove,b[r].bIsBreak||=b[r-1].bIsBreak,x[r].bIsBreak||=x[r-1].bIsBreak):(m[r-1].assign(m[r]),g[r-1]=g[r],v[r-1]=v[r],h[r-1].assign(h[r]),_[r-1]=_[r],y[r-1]=y[r],b[r-1].bBigMove||=b[r].bBigMove,x[r-1].bBigMove||=x[r].bBigMove,b[r-1].bIsBreak||=b[r].bIsBreak,x[r-1].bIsBreak||=x[r].bIsBreak)))}if(!(S||w||u!==2||f===L.enumLine&&p===L.enumLine)){if(this.processDoublyConnectedEdges(e,t,i+1,n))return this.parent.m_changed1=!0,this.parent.m_changed2=!0,2;U(0)}this.parent.m_changed1||=S,this.parent.m_changed2||=w;let T=e,E=e.end.weight,D=e.end.rank,O=e.end.bBigMove,k=e.end.bIsBreak,A=0,j=-1;for(let t=0;t<=u;t++){let r=t<u?this.parent.m_param1[t]:1;if(r!==A){let i=this.parent.allocResultSegment(),o=this.parent.m_resultSegments[i],s,c,l,d;a.queryCut(A,r,o,!1),o.get().snapControlPoints(n*n);let f=!1,p=!1,h=!1,_=!1,y=new z,x=new z;j===-1?(s=e.start.weight,c=e.start.rank,h=e.start.bBigMove,f=e.start.bIsBreak,y.assign(o.get().getStartXY())):(c=v[j],s=g[j],h=b[j].bBigMove,f=b[j].bIsBreak,y.assign(m[j])),t<u?(d=v[t],l=g[t],_=b[t].bBigMove,p=b[t].bIsBreak,x.assign(m[t])):(l=E,d=D,_=O,p=k,x.assign(o.get().getEndXY()));let S=T;r<1&&(this.splitEdgeInPlace(T),S=T.getNextInChain()),this.updateSegmentOnly(T,i),T.start.hash===0||T.start.pt.equals(y)||(this.m_newNodes.push(T.start),this.removeNodeFromHash(T.start),T.start.hash=0),T.end.hash===0||T.end.pt.equals(x)||(this.m_newNodes.push(T.end),this.removeNodeFromHash(T.end),T.end.hash=0),T.start.pt.assign(y),T.end.pt.assign(x),T.start.bBigMove||=h,T.end.bBigMove||=_,T.start.bIsBreak||=f,T.end.bIsBreak||=p,T.start.weight=s,T.start.rank=c,T.end.weight=l,T.end.rank=d,T=S,A=r,j=t}else j===-1&&(j=t)}let M=T.getNextInChain(),N=[];N.length=u;for(let e=0;e<u;e++)N[e]=e;u>2?(N.sort((e,t)=>Me(this.parent.m_param2[e],this.parent.m_param2[t])),this.parent.m_param2.sort(Me)):u===2&&this.parent.m_param2[0]>this.parent.m_param2[1]&&(this.parent.m_param2[1]=W(this.parent.m_param2[0],this.parent.m_param2[0]=this.parent.m_param2[1]),N[1]=W(N[0],N[0]=N[1])),T=t,E=t.end.weight,D=t.end.rank,O=t.end.bBigMove,k=t.end.bIsBreak,A=0,j=-1;for(let e=0;e<=u;e++){let r=e<u?this.parent.m_param2[e]:1;if(r!==A){let i=this.parent.allocResultSegment(),a=this.parent.m_resultSegments[i],s,c,l,d;o.queryCut(A,r,a,!1),a.get().snapControlPoints(n*n);let f=new z,p=new z,m=!1,g=!1,v=!1,b=!1;if(j!==-1){let e=N[j];s=_[e],c=y[e],f.assign(h[e]),v=x[e].bBigMove,m=x[e].bIsBreak}else s=t.start.weight,c=t.start.rank,v=t.start.bBigMove,m=t.start.bIsBreak,f.assign(a.get().getStartXY());if(e!==u){let t=N[e];l=_[t],d=y[t],p.assign(h[t]),b=x[t].bBigMove,g=x[t].bIsBreak}else l=E,d=D,b=O,g=k,p.assign(a.get().getEndXY());let S=T;r<1&&(this.splitEdgeInPlace(T),S=T.getNextInChain()),this.updateSegmentOnly(T,i),T.start.hash===0||T.start.pt.equals(f)||(this.m_newNodes.push(T.start),this.removeNodeFromHash(T.start),T.start.hash=0),T.end.hash===0||T.end.pt.equals(p)||(this.m_newNodes.push(T.end),this.removeNodeFromHash(T.end),T.end.hash=0),T.start.pt.assign(f),T.end.pt.assign(p),T.start.bBigMove||=v,T.end.bBigMove||=b,T.start.bIsBreak||=m,T.end.bIsBreak||=g,T.start.weight=s,T.start.rank=c,T.end.weight=l,T.end.rank=d,T=S,A=r,j=e}else j===-1&&(j=e)}let P=T.getNextInChain();return this.postProcessResultPartsForCurves(e,M,t,P,i+1),l?3:2}intersectCurves(e,t){this.parent.m_inputSegments.length!==2&&B(``),this.parent.m_changed1=!1,this.parent.m_changed2=!1,this.parent.m_tolerance=e,this.m_hashTableOfEqualsSize=0,this.m_hashTableOfEquals=i(16);let n=G.constructEmpty();for(let e=0;e<2;e++){let t=this.parent.allocResultSegmentFromSegment(this.parent.m_inputSegments[this.parent.m_inputParts[e].segmentIndex]),r=G.constructEmpty();this.parent.m_inputSegments[this.parent.m_inputParts[e].segmentIndex].queryLooseEnvelope(r),n.mergeEnvelope2D(r);let i=this.parent.m_inputParts[e];this.addSegment(t,0,i.weightStart,i.rankStart,i.weightEnd,i.rankEnd,i.weightInterior,i.rankInterior,i.u.bBreakStart,i.u.bBreakEnd,i.segmentParentage)}n.inflateCoords(100*e,100*e),this.m_origin.assign(n.getLowerLeft()),this.m_cell.setCoords(2*e,2*e),this.m_pairs.push(Cp(this.m_chainOrigin1.nextInChain,this.m_chainOrigin2.nextInChain,0,t));let r=0,a=!0;for(;this.m_pairs.length;){let t=this.m_pairs.at(-1);this.m_pairs.pop(),U(t.recursion>=0),U(t.recursion<=256),this.clusterNodes(e);let n=this.intersectCurvesHelper(t.edge1,t.edge2,e,t.bIsIntersecting,t.recursion);a&&(a=!1,r=n)}for(let e=0;e<2;e++){let t=e===0?this.parent.m_resultParts1:this.parent.m_resultParts2;for(let n=(e===0?this.m_chainOrigin1:this.m_chainOrigin2).nextInChain;n!=null;n=n.getNextInChain())t.push(this.parent.newIntersectionPart_(n.segmentIndex,n.start.weight,n.start.rank,n.end.weight,n.end.rank,n.weight,n.rank,n.start.bIsBreak,n.end.bIsBreak,n.segmentParentage)),t.at(-1).u.bBigMoveStart=n.start.bBigMove,t.at(-1).u.bBigMoveEnd=n.end.bBigMove}return r}tryOverlapIntersectCurves(e,t,n,r){let i=this.parent.m_resultSegments[e.segmentIndex].get(),a=this.parent.m_resultSegments[t.segmentIndex].get(),o=i.getStartXY().equals(a.getStartXY())&&i.getEndXY().equals(a.getEndXY()),s=i.getStartXY().equals(a.getEndXY())&&i.getEndXY().equals(a.getStartXY());if(!o&&!s)return 0;let c=Rd(i,a,!0);if(c!==0&&zd(i,a)&&e.segmentParentage===t.segmentParentage){let e=!1;if(c>0)e=i.equals(a);else{U(c===-1);let t=new Q({segment:a});t.get().reverse(),e=i.equals(t.get())}if(e)return 1}let l=n*_p.c_smallToleranceFactor,u=!1;if(c===0){let e=[.5,.25,.75,.125,.375,.625,.875,.5625,.3125];for(let t=0,r=e.length;t<r;++t){let r=e[t],o=new z;i.queryCoord2D(r,o);let s=a.getClosestCoordinate(o,!1),c=new z;a.queryCoord2D(s,c);let d=z.distance(o,c);if(d>n)return 0;u||=d>l}for(let t=0,r=e.length;t<r;++t){let r=e[t],o=new z;a.queryCoord2D(r,o);let s=i.getClosestCoordinate(o,!1),c=new z;i.queryCoord2D(s,c);let d=z.distance(o,c);if(d>n)return 0;u||=d>l}}let d=e.rank,f=t.rank;return d===f&&(d*=_p.c_maxGeometryTypeToRankDelta,f*=_p.c_maxGeometryTypeToRankDelta,d+=Tp(i.getGeometryType(),i,!0),f+=Tp(a.getGeometryType(),a,!0)),d>f?(t.copyFromWhenOverlap(this,e,o),t.transferAttributes(this,i,o)):f>d?(e.copyFromWhenOverlap(this,t,o),e.transferAttributes(this,a,o)):e.segmentParentage<=t.segmentParentage?(e.weight+=t.weight,t.copyFromWhenOverlap(this,e,o),t.transferAttributes(this,i,o)):(t.weight=e.weight+t.weight,e.copyFromWhenOverlap(this,t,o),e.transferAttributes(this,a,o)),u?3:2}postProcessResultPartsForCurves(e,t,n,r,i){i===ot()&&B(`curve_helper`);for(let n=e;n!==t;n=n.getNextInChain())this.updateSegmentToNodes(n);for(let e=n;e!==r;e=e.getNextInChain())this.updateSegmentToNodes(e);for(let a=e;a!==t;a=a.getNextInChain()){let e=a.end.pt.sub(a.start.pt);for(let t=n;t!==r;t=t.getNextInChain()){let n=0;if(a.start.pt.equals(t.start.pt)&&a.end.pt.equals(t.end.pt)?n=1:a.start.pt.equals(t.end.pt)&&a.end.pt.equals(t.start.pt)&&(n=-1),!n){let n=a.start.pt.equals(t.start.pt)?1:0;if(n||(n=a.end.pt.equals(t.end.pt)?2:0,n||(n=a.end.pt.equals(t.start.pt)?3:0,n||=a.start.pt.equals(t.end.pt)?4:0)),n){let r=t.end.pt.sub(t.start.pt),o=e.dotProduct(r),s;switch(n){case 1:case 2:s=o>0;break;case 3:case 4:s=o<0;break;default:B(`post_process_result_parts_for_curves_`)}s&&this.m_pairs.push(Cp(a,t,i,!1))}continue}let r=this.parent.m_resultSegments[a.segmentIndex],o=this.parent.m_resultSegments[t.segmentIndex],s=[.5,.25,.75];for(let e=0,t=s.length;e<t;++e){let t=s[e],i=new z;r.get().queryCoord2D(t,i);let a=o.get().getClosestCoordinate(i,!1),c=new z;if(o.get().queryCoord2D(a,c),z.distance(i,c)>this.parent.m_tolerance){n=0;break}}if(!n){this.m_pairs.push(Cp(a,t,i,!1));continue}for(let e=0,t=s.length;e<t;++e){let t=s[e],i=new z;o.get().queryCoord2D(t,i);let a=r.get().getClosestCoordinate(i,!1),c=new z;if(r.get().queryCoord2D(a,c),z.distance(i,c)>this.parent.m_tolerance){n=0;break}}if(!n){this.m_pairs.push(Cp(a,t,i,!1));continue}a.equalEdge=t,t.equalEdge=a;let c=a.rank,l=t.rank;c===l&&(c*=_p.c_maxGeometryTypeToRankDelta,l*=_p.c_maxGeometryTypeToRankDelta,c+=Tp(r.get().getGeometryType(),r.get(),!0),l+=Tp(o.get().getGeometryType(),o.get(),!0)),c>l||c===l&&a.segmentParentage<=t.segmentParentage?(r.copyTo(o,!1),t.segmentParentage=a.segmentParentage,n===-1&&o.get().reverse()):(o.copyTo(r,!1),a.segmentParentage=t.segmentParentage,n===-1&&r.get().reverse());break}}this.updateAttachedEdgesAfterNodeChange(e.start),t&&this.updateAttachedEdgesAfterNodeChange(t.start),this.updateAttachedEdgesAfterNodeChange(n.start),r&&this.updateAttachedEdgesAfterNodeChange(r.start)}processDoublyConnectedEdges(e,t,n,r){n===ot()&&B(`curve_helper`);let i=this.getSegment(e).get(),a=this.getSegment(t).get(),o=i.getStartXY().equals(a.getStartXY())&&i.getEndXY().equals(a.getEndXY())?1:i.getEndXY().equals(a.getStartXY())&&i.getStartXY().equals(a.getEndXY())?-1:0;if(o!==0){let s=new Q;i.queryCut(0,.5,s),s.get().snapControlPoints(r*r);let c=new Q;i.queryCut(.5,1,c),c.get().snapControlPoints(r*r),this.splitEdgeInPlace(e),e.end.pt=s.get().getEndXY(),e.segmentIndex=this.parent.allocResultSegmentFromBuffer(s),e.getNextInChain().segmentIndex=this.parent.allocResultSegmentFromBuffer(c);let l=a.getClosestCoordinate(e.end.pt,!1);return Math.abs(l-.5)>.2&&(l=.5),a.queryCut(0,l,s),s.get().snapControlPoints(r*r),a.queryCut(l,1,c),c.get().snapControlPoints(r*r),this.splitEdgeInPlace(t),t.end.pt=s.get().getEndXY(),t.segmentIndex=this.parent.allocResultSegmentFromBuffer(s),t.getNextInChain().segmentIndex=this.parent.allocResultSegmentFromBuffer(c),o>0?(this.m_pairs.push(Cp(e,t,n,!1)),this.m_pairs.push(Cp(e.getNextInChain(),t.getNextInChain(),n,!1))):(this.m_pairs.push(Cp(e,t.getNextInChain(),n,!1)),this.m_pairs.push(Cp(e.getNextInChain(),t,n,!1))),!0}return!1}newNode(e,t,n,r){let i=new Sp;return this.m_newNodes.push(i),i.pt=e,i.rank=n,i.weight=t,i.bIsBreak=r,i}newEdge(e,t,n,r,i,a){let o=new xp;return o.start=e,o.end=t,e.nextInChain=o,t.prevInChain=o,o.segmentIndex=n,o.segmentParentage=a,o.rank=i,o.weight=r,o}splitEdgeInPlace(e){e.segmentIndex=-1;let t=new xp,n=new Sp;this.m_newNodes.push(n),n.pt.setNAN(),n.nextInChain=t,n.prevInChain=e,n.prevInHash=null,n.nextInHash=null,n.prevEqual=null,n.nextEqual=null,n.weight=e.weight,n.rank=e.rank,n.bIsBreak=!1,n.bBigMove=!1,t.start=n,t.segmentIndex=-1,t.end=e.end,t.end.prevInChain=t,t.rank=e.rank,t.weight=e.weight,t.segmentParentage=e.segmentParentage,e.end=n,e.equalEdge&&(e.equalEdge.equalEdge=null),e.equalEdge=null}updateSegmentOnly(e,t){e.segmentIndex=t}updateAttachedEdgesAfterNodeChange(e){for(let t=e.equalListHead();t!==null;t=t.nextEqual)this.updateAttachedEdgesAfterNodeChangeImpl(t)}updateAttachedEdgesAfterNodeChangeImpl(e){let t=e.prevInChain;if(t&&t.hasSegment()){let n=this.getSegment(t).get();e.pt.equals(n.getEndXY())||(n.setCoordsForIntersector(t.start.pt,t.end.pt,!1),n.ensureXYMonotone())}let n=e.nextInChain;if(n&&n.hasSegment()){let t=this.getSegment(n).get();e.pt.equals(t.getStartXY())||(t.setCoordsForIntersector(n.start.pt,n.end.pt,!1),t.ensureXYMonotone())}}updateSegmentToNodes(e){let t=this.getSegment(e).get();e.start.pt.equals(t.getStartXY())&&e.end.pt.equals(t.getEndXY())||(t.setCoordsForIntersector(e.start.pt,e.end.pt,!1),t.ensureXYMonotone()),this.updateAttachedEdgesAfterNodeChange(e.start),this.updateAttachedEdgesAfterNodeChange(e.end)}getSegment(e){return this.parent.m_resultSegments[e.segmentIndex]}clusterNodes(e){let t=!1,n=[],r=[],a=[];for(let e=0,t=this.m_newNodes.length;e<t;e++){let n=this.m_newNodes[e];if(n===null)continue;let r=n;for(let i=e+1;i<t;i++){let e=this.m_newNodes[i];e!==null&&n.pt.equals(e.pt)&&(r.nextInHash=e,e.prevInHash=r,r=e,this.m_newNodes[i]=null)}}for(let o=0,s=this.m_newNodes.length;o<s;o++){let s=this.m_newNodes[o];if(s==null)continue;for(s.hash=this.calculateHash(s.pt);;){let o=i(4),c=this.hashTableBinsToCheck(s,o);for(let t=0;t<c;t++)if(o[t]!==null)for(let i=o[t];i!==null;){let t=i.nextInHash;z.distance(s.pt,i.pt)<=e&&(n.push(i),this.removeNodeFromHash(i),i.hash=0,a.push(i),r.push(i)),i=t}let l=!1;for(let e of n)if(!s.pt.equals(e.pt)){let n=fp(s.pt,e.pt,s.weight,s.rank,e.weight,e.rank);s.pt.assign(n.pt),s.weight=n.weight,s.rank=n.rank,l=!0,t=!0}if(n.length=0,!l)break;s.hash=this.calculateHash(s.pt)}a.push(s),r.push(s);for(let e=s.nextInHash;e!==null;){e.prevInHash=null;let t=e.nextInHash;e.nextInHash=null,a.push(e),r.push(e),e=t}let c=s.hash,l=null,u=null;for(let e of r)s!==e&&(e.hash=c,e.pt.assign(s.pt),e.rank=s.rank,e.weight=s.weight),e.prevInHash=l,l&&(l.nextInHash=e),e.prevEqual=u,e.nextEqual=null,u&&(u.nextEqual=e),u=e,l=e;let d=c%this.m_hashTableOfEquals.length;l.nextInHash=this.m_hashTableOfEquals[d],this.m_hashTableOfEquals[d]!==null&&(this.m_hashTableOfEquals[d].prevInHash=l),this.m_hashTableOfEquals[d]=r[0],this.m_hashTableOfEqualsSize+=r.length,r.length=0,this.rehashIfNeeded()}if(this.m_newNodes.length=0,t)for(let e of a)this.updateAttachedEdgesAfterNodeChange(e)}rehashIfNeeded(){if(2*this.m_hashTableOfEqualsSize>this.m_hashTableOfEquals.length){let e=this.m_hashTableOfEquals;this.m_hashTableOfEquals=i(2*e.length),this.m_hashTableOfEqualsSize=0;for(let t of e){let e=t;for(;e;){let t=e.nextInHash;e.nextInHash=null,e.prevInHash=null,this.addNodeToHashImpl(e),e=t}}}}addNodeToHashImpl(e){let t=e.hash%this.m_hashTableOfEquals.length,n=this.m_hashTableOfEquals[t];e.nextInHash=n,n!==null&&(n.prevInHash=e),this.m_hashTableOfEquals[t]=e,this.m_hashTableOfEqualsSize++}removeNodeFromHash(e){let t=e.hash%this.m_hashTableOfEquals.length,n=e.prevInHash,r=e.nextInHash;n?n.nextInHash=r:this.m_hashTableOfEquals[t]=r,r&&(r.prevInHash=n),this.m_hashTableOfEqualsSize--,e.prevInHash=null,e.nextInHash=null}hashTableBinsToCheck(e,t){let n=(e.pt.x-this.m_origin.x)/this.m_cell.x,r=(e.pt.y-this.m_origin.y)/this.m_cell.y,i=Ve()-1,a=Math.round(_e(n,-2147483646,i)),o=Math.round(_e(r,-2147483646,i)),s=a|o<<32;s=je(s),t[0]=this.m_hashTableOfEquals[s%this.m_hashTableOfEquals.length];let c=a+1|o<<32;c=je(c);let l=1;t[1]=this.m_hashTableOfEquals[c%this.m_hashTableOfEquals.length],t[1]!==t[0]&&(l=2);let u=a+1|o+1<<32;u=je(u),t[l]=this.m_hashTableOfEquals[u%this.m_hashTableOfEquals.length];for(let e=0;e<l;e++)if(t[l]===t[e]){l--;break}l++;let d=a|o+1<<32;d=je(d),t[l]=this.m_hashTableOfEquals[d%this.m_hashTableOfEquals.length];for(let e=0;e<l;e++)if(t[l]===t[e]){l--;break}return l++,l}calculateHash(e){let t=(e.x-this.m_origin.x)/this.m_cell.x,n=(e.y-this.m_origin.y)/this.m_cell.y,r=Ve()-1,i=Math.round(_e(t,-2147483646,r))|Math.round(_e(n,-2147483646,r))<<32;return i=je(i),i===0&&(i=1),i}processSharpCorners(e,t,n,r){if(this.parent.m_param1.length=0,this.parent.m_param2.length=0,e.getStartXY().equals(t.getStartXY())){let i=[0,0],a=[0,0],o=Wd(e,t,0,0,n,2,i,a,r);if(o){this.parent.m_param1.push(0),this.parent.m_param2.push(0);for(let e=0;e<o;e++)this.parent.m_param1.push(i[e]),this.parent.m_param2.push(a[e]);return o+1}}if(e.getEndXY().equals(t.getEndXY())){let i=[0,0],a=[0,0],o=Wd(e,t,1,1,n,2,i,a,r);if(o){for(let e=0;e<o;e++)this.parent.m_param1.push(i[e]),this.parent.m_param2.push(a[e]);return this.parent.m_param1.push(1),this.parent.m_param2.push(1),o+1}}if(e.getStartXY().equals(t.getEndXY())){let i=[0,0],a=[0,0],o=Wd(e,t,0,1,n,2,i,a,r);if(o){this.parent.m_param1.push(0),this.parent.m_param2.push(1);for(let e=0;e<o;e++)this.parent.m_param1.push(i[e]),this.parent.m_param2.push(a[e]);return o+1}}if(e.getEndXY().equals(t.getStartXY())){let i=[0,0],a=[0,0],o=Wd(e,t,1,0,n,2,i,a,r);if(o){for(let e=0;e<o;e++)this.parent.m_param1.push(i[e]),this.parent.m_param2.push(a[e]);return this.parent.m_param1.push(1),this.parent.m_param2.push(0),o+1}}return 0}};function Tp(e,t,n){let r=0;switch(e){case L.enumLine:r=0;break;case L.enumBezier:r=2;break;case L.enumRationalBezier2:r=3;break;case L.enumBezier2:r=1;break;case L.enumEllipticArc:r=t.projectionBehavior()===0?5:4;break;default:B(``)}return n?5-r:r}var Ep=class extends op{constructor(e){super(e.m_shape,e.m_tolerance,!1),this.m_parent=e}compare(e,t,n){if(this.m_bIntersectionDetected)return-1;let r=e.getElement(n),i=this.m_parent.getEdgeOriginVertices(t),a=this.m_parent.m_edgeVertices.getFirstElement(i),o=this.m_parent.getEdgeOriginVertices(r),s=this.m_parent.m_edgeVertices.getFirstElement(o);return this.m_currentNode=n,this.compareSegments(t,a,r,s)}},Dp=class extends sp{constructor(e){super(e.m_shape,e.m_tolerance),this.m_parent=e}compare(e,t){if(this.m_bIntersectionDetected)return-1;let n=e.getElement(t),r=this.m_parent.getEdgeOriginVertices(n),i=this.m_parent.m_edgeVertices.getFirstElement(r);return this.m_currentNode=t,this.compareVertex(e,t,i)}},Op=class extends vn{constructor(e){super(),this.pt1=z.getNAN(),this.pt2=z.getNAN(),this.m_shape=e}compare(e,t,n){this.m_shape.queryXY(t,this.pt1);let r=e.getElement(n);return this.m_shape.queryXY(r,this.pt2),this.pt1.compare(this.pt2)}},kp=class{constructor(e){this.m_point=z.getNAN(),this.m_pt=z.getNAN(),this.m_shape=e}setPoint(e){this.m_point.setCoordsPoint2D(e)}compare(e,t){let n=e.getElement(t);return this.m_shape.queryXY(n,this.m_pt),this.m_point.compare(this.m_pt)}},Ap=class{constructor(e,t){this.m_shape=null,this.m_progressTracker=null,this.m_edges=new pn(8),this.m_clusters=new pn(5),this.m_clusterVertices=new rp(!1),this.m_edgeVertices=new rp(!1),this.m_helperPoint=new q,this.m_eventQ=new yn,this.m_sweepStructure=new yn,this.m_bComplications=!1,this.m_sweepComparator=null,this.m_tempEdgeBuffer=[],this.m_modifiedClusters=[],this.m_edgesToInsertInSweepStructure=[],this.m_prevNeighbour=-1,this.m_nextNeighbour=-1,this.m_bContinuingSegmentChainOptimization=!1,this.m_progressCounter=0,this.m_segmentIntersector=new _p,this.m_segBuf1=new Q,this.m_segBuf2=new Q,this.m_sweepPoint=new z(0,0),this.m_tolerance=0,this.m_toleranceSqr=0,this.m_sweepPointCluster=-1,this.m_vertexClusterIndex=-1,this.m_bCracked=!1,this.m_bSweepPointClusterWasModified=!1,this.m_progressTracker=e,this.m_bTrackChanges=t}hadComplications(){return this.m_bComplications}sweep(e,t){let n=new At;n.setSwapCoordinates(),e.applyTransformation(n),this.setEditShape_(e),this.m_bCracked=!1,this.m_tolerance=t,this.m_toleranceSqr=t*t;let r=this.sweepImpl_();return e.applyTransformation(n),r||=(this.fillEventQueuePass2(),this.sweepImpl_()||r),this.m_shape.removeUserIndex(this.m_vertexClusterIndex),this.m_shape=null,this.m_bCracked}sweepVertical(e,t){this.setEditShape_(e),this.m_bCracked=!1,this.m_tolerance=t,this.m_toleranceSqr=t*t,this.m_bComplications=!1;let n=this.sweepImpl_();if(!this.m_bComplications){let r=e.filterClosePoints(t,!0,!1,this.m_bTrackChanges,-1);this.m_bComplications=r===1,n||=r===1}return this.m_vertexClusterIndex!==-1&&(this.m_shape.removeUserIndex(this.m_vertexClusterIndex),this.m_vertexClusterIndex=-1),this.m_shape=null,n}getEdgeCluster(e,t){return this.m_edges.getField(e,0+t)}setEdgeCluster_(e,t,n){this.m_edges.setField(e,0+t,n)}getEdgeOriginVertices(e){return this.m_edges.getField(e,2)}setEdgeOriginVertices_(e,t){this.m_edges.setField(e,2,t)}getNextEdgeEx(e,t){return this.m_edges.getField(e,3+t)}setNextEdgeEx_(e,t,n){this.m_edges.setField(e,3+t,n)}getEdgeSweepNode(e){return this.m_edges.getField(e,7)}setEdgeSweepNode_(e,t){this.m_edges.setField(e,7,t)}getNextEdge(e,t){let n=this.getEdgeEnd(e,t);return this.m_edges.getField(e,3+n)}setNextEdge_(e,t,n){let r=this.getEdgeEnd(e,t);this.m_edges.setField(e,3+r,n)}getPrevEdge(e,t){let n=this.getEdgeEnd(e,t);return this.m_edges.getField(e,5+n)}setPrevEdge_(e,t,n){let r=this.getEdgeEnd(e,t);this.m_edges.setField(e,5+r,n)}getClusterVertices(e){return this.m_clusters.getField(e,0)}setClusterVertices_(e,t){this.m_clusters.setField(e,0,t)}getClusterSweepEdgeList(e){return this.m_clusters.getField(e,2)}setClusterSweepEdgeList_(e,t){this.m_clusters.setField(e,2,t)}getClusterFirstEdge(e){return this.m_clusters.getField(e,1)}setClusterFirstEdge_(e,t){this.m_clusters.setField(e,1,t)}getClusterEventQNode(e){return this.m_clusters.getField(e,3)}setClusterEventQNode_(e,t){this.m_clusters.setField(e,3,t)}newCluster_(e){let t=this.m_clusters.newElement(),n=this.m_clusterVertices.createList();return this.setClusterVertices_(t,n),e!==-1&&(this.m_clusterVertices.addElement(n,e),this.m_shape.setUserIndex(e,this.m_vertexClusterIndex,t)),t}deleteCluster_(e){this.m_clusters.deleteElement(e)}addVertexToCluster_(e,t){let n=this.getClusterVertices(e);this.m_clusterVertices.addElement(n,t),this.m_shape.setUserIndex(t,this.m_vertexClusterIndex,e)}newEdge_(e){let t=this.m_edges.newElement(),n=this.m_edgeVertices.createList();return this.setEdgeOriginVertices_(t,n),e!==-1&&this.m_edgeVertices.addElement(n,e),t}addVertexToEdge_(e,t){let n=this.getEdgeOriginVertices(e);this.m_edgeVertices.addElement(n,t)}deleteEdge_(e){this.m_edges.deleteElement(e);let t=this.m_edgesToInsertInSweepStructure.findIndex(t=>t===e);t>=0&&st(this.m_edgesToInsertInSweepStructure,t)}addEdgeToCluster(e,t){this.getEdgeCluster(e,0)===-1?this.setEdgeCluster_(e,0,t):this.getEdgeCluster(e,1)===-1?this.setEdgeCluster_(e,1,t):B(``),this.addEdgeToClusterImpl_(e,t)}addEdgeToClusterImpl_(e,t){let n=this.getClusterFirstEdge(t);if(n!==-1){let r=this.getNextEdge(n,t);this.setPrevEdge_(r,t,e),this.setNextEdge_(e,t,r),this.setNextEdge_(n,t,e),this.setPrevEdge_(e,t,n)}else this.setPrevEdge_(e,t,e),this.setNextEdge_(e,t,e),this.setClusterFirstEdge_(t,e)}getEdgeEnd(e,t){return this.getEdgeCluster(e,0)===t?0:1}mergeClusters_(e,t){this.dbgCheckCluster_(e),this.dbgCheckCluster_(t);let n=this.getClusterEventQNode(t);n!==-1&&(this.m_eventQ.deleteNode(n),this.setClusterEventQNode_(t,-1));let r=this.getClusterFirstEdge(e),i=this.getClusterFirstEdge(t);if(i!==-1){let n=i,a=i,o=!1;do{this.dbgCheckEdge_(n),o=!1;let r=this.getEdgeEnd(n,t),s=this.getNextEdgeEx(n,r);if(this.getEdgeCluster(n,r+1&1)===e){this.disconnectEdge_(n);let e=this.getEdgeOriginVertices(n);if(this.m_edgeVertices.deleteList(e),this.deleteEdge_(n),n===s){i=-1;break}i===n&&(i=this.getClusterFirstEdge(t),a=s,o=!0)}n=s}while(n!==a||o);if(i!==-1){do{let r=this.getEdgeEnd(n,t),i=this.getNextEdgeEx(n,r);this.setEdgeCluster_(n,r,e),n=i}while(n!==a);if(r=this.getClusterFirstEdge(e),r!==-1){let t=this.getNextEdge(r,e),n=this.getNextEdge(i,e);t===r?(this.setClusterFirstEdge_(e,i),this.addEdgeToClusterImpl_(r,e),this.setClusterFirstEdge_(e,r)):n===i&&this.addEdgeToClusterImpl_(i,e),this.setNextEdge_(i,e,t),this.setPrevEdge_(t,e,i),this.setNextEdge_(r,e,n),this.setPrevEdge_(n,e,r)}else this.setClusterFirstEdge_(e,i)}}let a=this.getClusterVertices(e),o=this.getClusterVertices(t);for(let t=this.m_clusterVertices.getFirst(o);t!==-1;t=this.m_clusterVertices.getNext(t)){let n=this.m_clusterVertices.getElement(t);this.m_shape.setUserIndex(n,this.m_vertexClusterIndex,e)}this.m_clusterVertices.concatenateLists(a,o),this.deleteCluster_(t),this.dbgCheckCluster_(e)}mergeEdges_(e,t){this.dbgCheckEdge_(e),this.dbgCheckEdge_(t);let n=this.getEdgeCluster(e,0),r=this.getEdgeCluster(e,1),i=this.getEdgeCluster(t,0),a=this.getEdgeCluster(t,1),o=this.getEdgeOriginVertices(e),s=this.getEdgeOriginVertices(t);if(this.m_edgeVertices.concatenateLists(o,s),t===this.getClusterFirstEdge(n)&&this.setClusterFirstEdge_(n,e),t===this.getClusterFirstEdge(r)&&this.setClusterFirstEdge_(r,e),this.disconnectEdge_(t),this.deleteEdge_(t),!(n===i&&r===a||r===i&&n===a)){let e=this.getClusterXY(n),t=this.getClusterXY(i);e.isEqualPoint2D(t)?(n!==i&&this.mergeClusters_(n,i),r!==a&&this.mergeClusters_(r,a)):(r!==i&&this.mergeClusters_(r,i),n!==a&&this.mergeClusters_(n,a))}this.dbgCheckEdge_(e)}disconnectEdge_(e){let t=this.getEdgeCluster(e,0),n=this.getEdgeCluster(e,1);this.disconnectEdgeFromCluster_(e,t),this.disconnectEdgeFromCluster_(e,n)}disconnectEdgeFromCluster_(e,t){let n=this.getNextEdge(e,t),r=this.getPrevEdge(e,t),i=this.getClusterFirstEdge(t);n===e?this.setClusterFirstEdge_(t,-1):(this.setNextEdge_(r,t,n),this.setPrevEdge_(n,t,r),i===e&&this.setClusterFirstEdge_(t,n))}applyIntersectorToEditShape_(e,t,n){let r=this.m_edgeVertices.getFirst(e),i=this.m_edgeVertices.getElement(r),a=this.getClusterFromVertex(i),o=this.m_shape.getNextVertex(i),s=this.getClusterFromVertex(o),c=this.m_shape.getXY(i),l=this.m_shape.getXY(o),u=!1,d=!1,f=t.getResultSegment(n,0).getStartXY(),p=t.getResultSegment(n,t.getResultSegmentCount(n)-1).getEndXY();c.equals(f)||(u=!0),l.equals(p)||(d=!0),this.m_shape.splitSegmentWithIntersector(i,t,n,!0,!0);let m=this.m_bTrackChanges&&t.getSegmentChanged(n);for(m&&this.m_shape.setGeometryModifiedWithVertex(i,!0),r=this.m_edgeVertices.getNext(r);r!==-1;r=this.m_edgeVertices.getNext(r)){let e=this.m_edgeVertices.getElement(r),i=this.getClusterFromVertex(e)===a;this.m_shape.splitSegmentWithIntersector(e,t,n,i,!0),m&&this.m_shape.setGeometryModifiedWithVertex(e,!0)}if(u&&this.updateClusterXY(!0,a,f,t.getResultSegmentStartPointWeight(n,0),t.getResultSegmentStartPointRank(n,0)),d){let e=t.getResultSegmentCount(n)-1;this.updateClusterXY(!0,s,p,t.getResultSegmentEndPointWeight(n,e),t.getResultSegmentEndPointRank(n,e))}}createEdgesAndClustersFromSplitEdge_(e,t,n){this.dbgCheckNewEdgesArray_();let r=this.getEdgeOriginVertices(e),i=this.getEdgeCluster(e,0),a=this.getEdgeCluster(e,1),o=this.newEdge_(-1);this.m_edgesToInsertInSweepStructure.push(o);let s=pn.impossibleIndex3();this.setEdgeSweepNode_(o,s),this.m_tempEdgeBuffer.push(o),this.addEdgeToCluster(o,i);let c=t.getResultSegmentCount(n);for(let e=1;e<c;e++){let e=this.newCluster_(-1);this.m_modifiedClusters.push(e),this.m_tempEdgeBuffer.push(e),this.addEdgeToCluster(o,e);let t=this.newEdge_(-1);this.m_edgesToInsertInSweepStructure.push(t),this.setEdgeSweepNode_(t,s),this.m_tempEdgeBuffer.push(t),this.addEdgeToCluster(t,e),o=t}this.addEdgeToCluster(o,a);for(let e=this.m_edgeVertices.getFirst(r);e!==-1;e=this.m_edgeVertices.getNext(e)){let t=this.m_edgeVertices.getElement(e);if(this.getClusterFromVertex(t)===i){let e=0,n=this.m_tempEdgeBuffer.length;do{if(e>0){let n=this.m_tempEdgeBuffer[e-1];this.addVertexToCluster_(n,t)}let n=this.m_tempEdgeBuffer[e];e+=2,this.addVertexToEdge_(n,t),t=this.m_shape.getNextVertex(t)}while(e<n)}else{let e=this.m_tempEdgeBuffer.length-1;do{if(e<this.m_tempEdgeBuffer.length-2){let n=this.m_tempEdgeBuffer[e+1];this.addVertexToCluster_(n,t)}let n=this.m_tempEdgeBuffer[e];e-=2,this.addVertexToEdge_(n,t),t=this.m_shape.getNextVertex(t)}while(e>=0)}}this.m_tempEdgeBuffer.length=0,this.dbgCheckNewEdgesArray_()}getVertexFromClusterIndex(e){let t=this.getClusterVertices(e);return this.m_clusterVertices.getFirstElement(t)}getClusterFromVertex(e){return this.m_shape.getUserIndex(e,this.m_vertexClusterIndex)}processSplitHelper1_(e,t,n){let r=this.getEdgeCluster(t,0),i=this.getClusterXY(r),a=this.getEdgeCluster(t,1),o=this.getClusterXY(a),s=n.getResultSegmentCount(e),c=n.getResultSegment(e,0),l=c.getStartXY();if(i.isEqualPoint2D(l)||(this.m_bComplications||i.compare(this.m_sweepPoint)*l.compare(this.m_sweepPoint)<0&&(this.m_bComplications=!0),this.getAffectedEdges(r,this.m_tempEdgeBuffer),this.m_modifiedClusters.push(r)),!this.m_bComplications&&s>1){let e=i.compare(o),t=c.getEndXY();(i.compare(t)!==e||t.compare(o)!==e||t.compare(this.m_sweepPoint)<0)&&(this.m_bComplications=!0)}c=n.getResultSegment(e,s-1);let u=c.getEndXY();o.isEqualPoint2D(u)||(this.m_bComplications||o.compare(this.m_sweepPoint)*u.compare(this.m_sweepPoint)<0&&(this.m_bComplications=!0),this.getAffectedEdges(a,this.m_tempEdgeBuffer),this.m_modifiedClusters.push(a)),this.m_tempEdgeBuffer.push(t);for(let e=0,n=this.m_tempEdgeBuffer.length;e<n;e++){let n=this.m_tempEdgeBuffer[e],r=this.getEdgeSweepNode(n);pn.isValidElement(r)&&(this.m_sweepStructure.deleteNode(r),this.setEdgeSweepNode_(n,-1));let i=pn.impossibleIndex3();n!==t&&this.getEdgeSweepNode(n)!==i&&(this.m_edgesToInsertInSweepStructure.push(n),this.setEdgeSweepNode_(n,i))}this.m_tempEdgeBuffer.length=0}checkAndFixIntersection_(e,t){let n=this.m_sweepStructure.getElement(e);return this.m_sweepComparator.compare(this.m_sweepStructure,n,t),!!this.m_sweepComparator.intersectionDetected()&&(this.m_sweepComparator.clearIntersectionDetectedFlag(),this.fixIntersection_(e,t),!0)}fixIntersection_(e,t){this.m_bCracked=!0;let n=this.m_sweepStructure.getElement(e),r=this.m_sweepStructure.getElement(t),i=null,a=null,o=this.getEdgeOriginVertices(n),s=this.m_edgeVertices.getFirstElement(o),c=this.getEdgeOriginVertices(r),l=this.m_edgeVertices.getFirstElement(c);this.m_shape.querySegment(s,this.m_segBuf1,!1,!1),i=this.m_segBuf1.get();let u=this.m_shape.getNextVertex(s),d=this.m_shape.getWeight(s),f=this.m_shape.getSegmentParentageBreakVertex(s),p=this.m_shape.getWeight(u),m=this.m_shape.getSegmentParentageBreakVertex(u),h=this.m_shape.getSegmentWeight(s),g=this.m_shape.getRank(s),_=this.m_shape.getRank(u),v=this.m_shape.getSegmentRank(s),y=this.m_shape.getSegmentParentage(s);this.m_shape.querySegment(l,this.m_segBuf2,!1,!1),a=this.m_segBuf2.get();let b=this.m_shape.getNextVertex(l),x=this.m_shape.getWeight(l),S=this.m_shape.getSegmentParentageBreakVertex(l),C=this.m_shape.getWeight(b),w=this.m_shape.getSegmentParentageBreakVertex(b),T=this.m_shape.getSegmentWeight(l),E=this.m_shape.getRank(l),D=this.m_shape.getRank(b),O=this.m_shape.getSegmentRank(l),k=this.m_shape.getSegmentParentage(l);this.m_segmentIntersector.pushSegment(i,d,g,p,_,h,v,f,m,y),this.m_segmentIntersector.pushSegment(a,x,E,C,D,T,O,S,w,k),this.m_segmentIntersector.intersect2D(this.m_tolerance,!0)===3&&(this.m_bComplications=!0),this.splitEdge_(n,r,-1,this.m_segmentIntersector),this.m_segmentIntersector.clear()}fixIntersectionPointSegment_(e,t){this.m_bCracked=!0;let n=this.m_sweepStructure.getElement(t),r=null,i=this.getEdgeOriginVertices(n),a=this.m_edgeVertices.getFirstElement(i);this.m_shape.querySegment(a,this.m_segBuf1,!1,!1),r=this.m_segBuf1.get();let o=this.m_shape.getNextVertex(a),s=this.m_shape.getWeight(a),c=this.m_shape.getSegmentParentageBreakVertex(a),l=this.m_shape.getWeight(o),u=this.m_shape.getSegmentParentageBreakVertex(o),d=this.m_shape.getSegmentWeight(a),f=this.m_shape.getRank(a),p=this.m_shape.getRank(o),m=this.m_shape.getSegmentRank(a),h=this.m_shape.getSegmentParentage(a),g=this.getClusterFirstVertex(e);this.m_segmentIntersector.pushSegment(r,s,f,l,p,d,m,c,u,h),this.m_shape.queryPoint(g,this.m_helperPoint);let _=this.m_shape.getWeight(g),v=this.m_shape.getRank(g);this.m_segmentIntersector.intersect2DEx(this.m_tolerance,this.m_helperPoint,v,_,!0),this.splitEdge_(n,-1,e,this.m_segmentIntersector),this.m_segmentIntersector.clear()}insertNewEdges_(){if(this.m_edgesToInsertInSweepStructure.length===0)return!0;this.dbgCheckNewEdgesArray_();let e=!0,t=0,n=this.m_edgesToInsertInSweepStructure.length,r=Math.max(2*n+200,this.m_sweepStructure.size()+200);for(;this.m_edgesToInsertInSweepStructure.length;){if(this.m_edgesToInsertInSweepStructure.length>Math.max(100,this.m_shape.getTotalPointCount())||t>r){this.m_edgesToInsertInSweepStructure.length=0,this.m_bComplications=!0,e=!1;break}let n=this.m_edgesToInsertInSweepStructure.at(-1);this.m_edgesToInsertInSweepStructure.pop(),this.setEdgeSweepNode_(n,-1);let i=this.isEdgeOnSweepLine_(n);pn.isValidElement(i)?(this.insertNewEdgeToSweepStructure_(n,i),t++):i!==pn.impossibleIndex2()&&(e=!1),this.m_bContinuingSegmentChainOptimization=!1}return e}insertNewEdgeToSweepStructure_(e,t){let n;if(this.m_bContinuingSegmentChainOptimization?(n=this.m_sweepStructure.addElementAtPosition(this.m_prevNeighbour,this.m_nextNeighbour,e,!0,!0),this.m_bContinuingSegmentChainOptimization=!1):n=this.m_sweepStructure.addUniqueElement(e),n===-1){let t=this.m_sweepStructure.getDuplicateElement(),n=this.m_sweepStructure.getElement(t);return this.mergeEdges_(n,e),!1}if(this.setEdgeSweepNode_(e,n),this.m_sweepComparator.intersectionDetected()){this.m_sweepComparator.clearIntersectionDetectedFlag();let e=this.m_sweepComparator.getLastComparedNode();return this.m_prevNeighbour===e&&(this.m_prevNeighbour=-1),this.m_nextNeighbour===e&&(this.m_nextNeighbour=-1),this.fixIntersection_(e,n),!0}return!1}isEdgeOnSweepLine_(e){let t=this.getEdgeCluster(e,0),n=this.getEdgeCluster(e,1),r=this.getClusterXY(t),i=this.getClusterXY(n);if(z.sqrDistance(r,i)<=this.m_toleranceSqr)return this.m_bComplications=!0,-1;let a=r.compare(this.m_sweepPoint),o=i.compare(this.m_sweepPoint);return a<=0&&o>0?n:o<=0&&a>0?t:a>0&&o>0?pn.impossibleIndex2():-1}fillEventQueue(){let e=new sn(0),t=this.m_shape.queryVertexIteratorOnSelection();for(let n=t.next();n!==-1;n=t.next())this.m_shape.getUserIndex(n,this.m_vertexClusterIndex)!==-1&&e.add(n);this.m_shape.sortVerticesSimpleByY(e,0,e.size()),this.progress_(!0),this.m_eventQ.clear(),this.m_eventQ.setCapacity(e.size()),this.m_eventQ.setComparator(new Op(this.m_shape));let n=z.getNAN();n.setNAN();let r=-1;for(let t=0,i=e.size();t<i;t++){let i=e.read(t);if(this.m_shape.getXY(i).isEqualPoint2D(n)){let e=this.m_shape.getUserIndex(i,this.m_vertexClusterIndex);this.mergeClusters_(r,e);continue}r=this.getClusterFromVertex(i),this.m_shape.queryXY(i,n);let a=this.m_eventQ.addBiggestElement(i);this.setClusterEventQNode_(r,a)}}fillEventQueuePass2(){let e=new sn(0);for(let t=this.m_eventQ.getFirst();t!==-1;t=this.m_eventQ.getNext(t)){let n=this.m_eventQ.getElement(t);e.add(n)}this.m_eventQ.clear(),this.m_shape.sortVerticesSimpleByY(e,0,e.size()),this.progress_(!0);for(let t=0,n=e.size();t<n;t++){let n=e.read(t),r=this.getClusterFromVertex(n),i=this.m_eventQ.addBiggestElement(n);this.setClusterEventQNode_(r,i)}}getAffectedEdges(e,t){let n=this.getClusterFirstEdge(e);if(n===-1)return;let r=n;do{let n=this.getEdgeSweepNode(r);pn.isValidElement(n)&&t.push(r),r=this.getNextEdge(r,e)}while(r!==n)}updateClusterXY(e,t,n,r,i){let a=this.getClusterVertices(t);for(let t=this.m_clusterVertices.getFirst(a);t!==-1;t=this.m_clusterVertices.getNext(t)){let a=this.m_clusterVertices.getElement(t);this.m_shape.setXYMonotonicPoint2D(a,n),this.m_shape.setWeight(a,r),this.m_shape.setRank(a,i),e&&this.m_bTrackChanges&&this.m_shape.setGeometryModifiedWithVertex(a,!0),this.m_shape.setSegmentParentageBreakVertex(a,!0)}}splitEdge_(e,t,n,r){this.dbgCheckEdge_(e),t!==-1&&this.dbgCheckEdge_(t),this.disconnectEdge_(e),t!==-1&&this.disconnectEdge_(t),this.processSplitHelper1_(0,e,r),t!==-1&&this.processSplitHelper1_(1,t,r),n!==-1&&r.getResultPointChanged()&&this.m_modifiedClusters.push(n);for(let e=0,t=this.m_modifiedClusters.length;e<t;e++){let t=this.m_modifiedClusters[e],n=this.getClusterEventQNode(t);n!==-1&&(this.m_eventQ.deleteNode(n),this.setClusterEventQNode_(t,-1))}let i=this.getEdgeOriginVertices(e),a=t===-1?-1:this.getEdgeOriginVertices(t);if(this.applyIntersectorToEditShape_(i,r,0),a!==-1)this.applyIntersectorToEditShape_(a,r,1);else{let e=r.getResultPoint().getXY();this.updateClusterXY(r.getResultPointChanged(),n,e,r.getResultPointWeight(),r.getResultPointRank())}this.createEdgesAndClustersFromSplitEdge_(e,r,0),t!==-1&&this.createEdgesAndClustersFromSplitEdge_(t,r,1),this.m_edgeVertices.deleteList(i),this.deleteEdge_(e),t!==-1&&(this.m_edgeVertices.deleteList(a),this.deleteEdge_(t));for(let e=0,t=this.m_modifiedClusters.length;e<t;e++){let t=this.m_modifiedClusters[e];t===this.m_sweepPointCluster&&(this.m_bSweepPointClusterWasModified=!0);let n=this.getClusterEventQNode(t);if(n===-1){let e=this.getClusterFirstVertex(t);if(n=this.m_eventQ.addUniqueElement(e),n===-1){let e=this.m_eventQ.getDuplicateElement(),n=this.m_eventQ.getElement(e),r=this.getClusterFromVertex(n);this.mergeClusters_(r,t)}else this.setClusterEventQNode_(t,n)}}this.m_modifiedClusters.length=0}getClusterXY(e){let t=this.getClusterFirstVertex(e);return this.m_shape.getXY(t)}getClusterFirstVertex(e){let t=this.getClusterVertices(e);return this.m_clusterVertices.getFirstElement(t)}dbgCheckEdge_(e){}dbgCheckCluster_(e){}dbgCheckNewEdgesArray_(){}dbgSaveSweepStructure_(e){}sweepImpl_(){this.progress_(!0),this.m_bSweepPointClusterWasModified=!1,this.m_sweepPointCluster=-1,this.m_sweepComparator===null&&(this.m_sweepStructure.disableBalancing(),this.m_sweepComparator=new Ep(this),this.m_sweepStructure.setComparator(this.m_sweepComparator));let e=[],t=null,n=null;this.m_prevNeighbour=-1,this.m_nextNeighbour=-1,this.m_bContinuingSegmentChainOptimization=!1;let r=pn.impossibleIndex2(),i=pn.impossibleIndex3();for(let a=this.m_eventQ.getFirst();a!==-1;){this.progress_(),this.dbgCheckSweepStructure_(),this.m_bContinuingSegmentChainOptimization=!1,this.m_prevNeighbour=-1,this.m_nextNeighbour=-1;let o=this.m_eventQ.getElement(a);this.m_sweepPointCluster=this.getClusterFromVertex(o),this.m_shape.queryXY(o,this.m_sweepPoint),this.m_sweepComparator.setSweepY(this.m_sweepPoint.y,this.m_sweepPoint.x);let s=!1;{let t=this.getClusterFirstEdge(this.m_sweepPointCluster);if(s=t===-1,!s){let n=t;do{let t=this.getEdgeSweepNode(n);t===-1?(this.m_edgesToInsertInSweepStructure.push(n),this.setEdgeSweepNode_(n,i)):t!==i&&e.push(t),n=this.getNextEdge(n,this.m_sweepPointCluster)}while(n!==t)}}if(!this.m_sweepStructure.isAutoBalancing()&&(this.m_sweepStructure.getMaxDepthEver()>4||this.m_edgesToInsertInSweepStructure.length>10)&&this.m_sweepStructure.enableBalancing(),e.length>0){this.m_bContinuingSegmentChainOptimization=e.length===1&&this.m_edgesToInsertInSweepStructure.length===1;for(let t=0,n=e.length;t<n;t++){let n=this.m_sweepStructure.getElement(e[t]);this.setEdgeSweepNode_(n,r)}let t=r,n=r;for(let i=0,a=e.length;i<a;i++){let a=e[i];if(t===r){let e=this.m_sweepStructure.getPrev(a);if(e!==-1){let n=this.m_sweepStructure.getElement(e);this.getEdgeSweepNode(n)!==r&&(t=e)}else t=-1}if(n===r){let e=this.m_sweepStructure.getNext(a);if(e!==-1){let t=this.m_sweepStructure.getElement(e);this.getEdgeSweepNode(t)!==r&&(n=e)}else n=-1}if(t!==r&&n!==r)break}for(let t=0,n=e.length;t<n;t++){let n=e[t],r=this.m_sweepStructure.getElement(n);this.m_sweepStructure.deleteNode(n),this.setEdgeSweepNode_(r,-1)}e.length=0,this.m_prevNeighbour=t,this.m_nextNeighbour=n,t!==-1&&n!==-1?this.m_bContinuingSegmentChainOptimization||this.checkAndFixIntersection_(t,n):t===-1&&n===-1&&(this.m_bContinuingSegmentChainOptimization=!1)}else s&&(t===null&&(t=new Dp(this)),t.setPoint(this.m_sweepPoint),this.m_sweepStructure.searchUpperBound(t),t.intersectionDetected()&&(t.clearIntersectionDetectedFlag(),this.fixIntersectionPointSegment_(this.m_sweepPointCluster,t.getCurrentNode())));let c=this.m_bContinuingSegmentChainOptimization;!this.insertNewEdges_()&&c&&this.m_prevNeighbour!==-1&&this.m_nextNeighbour!==-1&&this.checkAndFixIntersection_(this.m_prevNeighbour,this.m_nextNeighbour),this.m_bSweepPointClusterWasModified?(this.m_bSweepPointClusterWasModified=!1,n===null&&(n=new kp(this.m_shape)),n.setPoint(this.m_sweepPoint),a=this.m_eventQ.searchUpperBound(n)):a=this.m_eventQ.getNext(a)}return this.m_bCracked}setEditShape_(e){this.m_shape=e,this.m_vertexClusterIndex=this.m_shape.createUserIndex(),this.m_edges.setCapacity(e.getSelectedCount()+32),this.m_clusters.setCapacity(e.getSelectedCount()),this.m_clusterVertices.reserveLists(e.getSelectedCount()),this.m_clusterVertices.reserveNodes(e.getSelectedCount()),this.m_edgeVertices.reserveLists(e.getSelectedCount()+32),this.m_edgeVertices.reserveNodes(e.getSelectedCount()+32);for(let t=this.m_shape.getFirstGeometry();t!==-1;t=this.m_shape.getNextGeometry(t))if(V(this.m_shape.getGeometryType(t)))for(let n=this.m_shape.getFirstPath(t);n!==-1;n=this.m_shape.getNextPath(n)){let t=this.m_shape.getPathSize(n),r=this.m_shape.getFirstVertex(n);if(r===-1)continue;let i=this.m_shape.getNextVertex(r);if(i===-1||i===r)continue;let a=-1;e.selected(r)&&(a=this.newCluster_(r));let o=-1;a!==-1&&e.selected(i)&&(o=this.newEdge_(r),this.addEdgeToCluster(o,a));let s=o;for(let e=0,n=t-2;e<n;e++){let e=this.m_shape.getNextVertex(i),t=-1;if(this.m_shape.selected(i)){let n=this.newCluster_(i);s!==-1&&this.addEdgeToCluster(s,n),this.m_shape.selected(e)&&(t=this.newEdge_(i),this.addEdgeToCluster(t,n))}s=t,i=e}if(this.m_shape.isClosedPath(n)){let e=this.m_shape.getNextVertex(i);if(this.m_shape.selected(i)){let t=this.newCluster_(i);if(s!==-1&&this.addEdgeToCluster(s,t),this.m_shape.selected(e)){let e=this.newEdge_(i);this.addEdgeToCluster(e,t),this.addEdgeToCluster(e,a)}}}else{let e=-1;this.m_shape.selected(i)&&(e=this.newCluster_(i),s!==-1&&this.addEdgeToCluster(s,e))}}else for(let e=this.m_shape.getFirstPath(t);e!==-1;e=this.m_shape.getNextPath(e)){let t=this.m_shape.getFirstVertex(e);for(let n=0,r=this.m_shape.getPathSize(e);n<r;n++)this.m_shape.selected(t)&&this.newCluster_(t),t=this.m_shape.getNextVertex(t)}this.fillEventQueue()}progress_(e=!1){}dbgCheckSweepStructure_(){}};function jp(e,t,n,r){n>0&&lp(e,n,t,!1,r),new Np(r).executeImpl_(e,t)}function Mp(e,t,n){return{vertex0:e,vertex1:t,dir:n}}var Np=class{constructor(e){this.m_shape=null,this.m_spikes=[],this.m_points=new sn(0),this.m_pointsIndex=-1,this.m_dissolvedEdges=0,this.m_progressTracker=e}executeImpl_(e,t){if(this.m_shape=e,e.getPathCount(t)<2&&e.getPointCount(t)<6)return;this.m_points.resize(0);for(let n=e.getFirstPath(t);n!==-1;n=e.getNextPath(n)){let t=e.getFirstVertex(n);for(let r=0,i=e.getPathSize(n);r<i;r++,t=e.getNextVertex(t))this.m_points.add(t)}this.m_pointsIndex=e.createUserIndex();for(let t=0,n=this.m_points.size();t<n;++t)e.setUserIndex(this.m_points.read(t),this.m_pointsIndex,t);e.sortVerticesSimpleByY(this.m_points,0,this.m_points.size());let n=this.m_points.read(0),r=e.getXY(n),i=1,a=0,o=[];for(let t=1;t<this.m_points.size();t++){let s=this.m_points.read(t);if(s===-1||e.getUserIndex(s,this.m_pointsIndex)===-1)continue;let c=e.getXY(s);if(c.isEqualPoint2D(r))i++;else{if(i>1){for(let n=a;n<t;n++){let t=this.m_points.read(n);if(e.getUserIndex(t,this.m_pointsIndex)===-1)continue;let i=e.getNextVertex(t),a=e.getPrevVertex(t);if(t!==i&&!e.isEqualXYPoint2D(i,r)){let e=Mp(t,i,1);o.push(e)}if(t!==a&&a!==i&&!e.isEqualXYPoint2D(a,r)){let e=Mp(t,a,-1);o.push(e)}}o.length>0&&this.processBunch_(o,r)}n=s,r.assign(c),i=1,a=t}}if(this.m_dissolvedEdges===0)return e.removeUserIndex(this.m_pointsIndex),void(this.m_pointsIndex=-1);let s=e.getPointCount(t);for(let t=0;t<this.m_points.size();t++){let n=this.m_points.read(t);if(n===-1)continue;if(e.getUserIndex(n,this.m_pointsIndex)!==-1){e.setUserIndex(n,this.m_pointsIndex,-1);continue}let r=e.getPathFromVertex(n);e.getFirstVertex(r)===n&&e.setFirstVertex(r,-1),e.freeVertex(n),this.m_points.write(t,-1),s--}let c=e.createPathUserIndex(),l=e.getPathCount(t);for(let n=0,r=this.m_points.size();n<r;++n){if(this.m_points.read(n)===-1)continue;let r=this.m_points.read(n);if(e.getUserIndex(r,this.m_pointsIndex)!==-1)continue;let i=e.getPathFromVertex(r),a=-1;if(e.getPathUserIndex(i,c)===2){i=-1;for(let t=e.getNextVertex(r);t!==r;t=e.getNextVertex(t)){let n=e.getPathFromVertex(t);if(e.getPathUserIndex(n,c)!==2){i=n,r=t;break}}i===-1&&(i=e.insertPath(t,-1),e.setClosedPath(i,!0),l++),U(i!==-1)}e.setPathUserIndex(i,c,2),a=e.getFirstVertex(i);let o=0,s=!1,u=r;do{a===u&&(s=!0),e.setUserIndex(u,this.m_pointsIndex,1);let t=e.getPathFromVertex(u);t!==i&&(e.getPathUserIndex(t,c)!==2&&(e.setPathUserIndex(t,c,1),e.setFirstVertex(t,-1)),e.setPathToVertex(u,i)),o++,u=e.getNextVertex(u)}while(u!==r);s||e.setFirstVertex(i,r),e.setPathSize(i,o)}for(let n=e.getFirstPath(t);n!==-1;){let t=e.getNextPath(n);e.getPathUserIndex(n,c)!==1&&e.getFirstVertex(n)!==-1||(e.removePathOnly(n),l--),n=t}e.setGeometryVertexCount(t,s),e.setGeometryPathCount(t,l),e.removePathUserIndex(c),e.removeUserIndex(this.m_pointsIndex),this.m_pointsIndex=-1,e.dbgVerifyVertexCounts(),e.filterClosePoints(0,!0,!1,!1,t)}processBunch_(e,t){e.sort((e,n)=>{let r=this.m_shape.getXY(e.vertex1).sub(t),i=this.m_shape.getXY(n.vertex1).sub(t),a=z.compareVectors(r,i);return a===0?e.dir<n.dir?-1:1:a});let n=0,r=this.m_shape.getXY(e[0].vertex1),i=1,a=this.m_shape.hasCurves();for(let t=1,o=e.length;t<o;t++){let s=this.m_shape.getXY(e[t].vertex1);if(!(s.isEqualPoint2D(r)&&(i++,t+1<o))){if(i===2){let t=e[n],r=e[n+1],i=t.dir;if(i!==r.dir){let e=!0;if(a&&(e=!this.m_shape.isCurve(t.dir===1?t.vertex0:t.vertex1)&&!this.m_shape.isCurve(r.dir===1?r.vertex0:r.vertex1)),e){if(i===1){let e=t.vertex0,n=r.vertex0;this.m_shape.setNextVertex(e,n),this.m_shape.setPrevVertex(n,e),this.m_shape.getPrevVertex(e)===n&&(this.m_shape.setUserIndex(e,this.m_pointsIndex,-1),this.m_shape.setUserIndex(n,this.m_pointsIndex,-1));let i=t.vertex1,a=r.vertex1;this.m_shape.setPrevVertex(i,a),this.m_shape.setNextVertex(a,i),this.m_shape.getNextVertex(i)===a&&(this.m_shape.setUserIndex(i,this.m_pointsIndex,-1),this.m_shape.setUserIndex(a,this.m_pointsIndex,-1))}else{let e=t.vertex0,n=r.vertex0;this.m_shape.setPrevVertex(e,n),this.m_shape.setNextVertex(n,e),this.m_shape.getNextVertex(e)===n&&(this.m_shape.setUserIndex(e,this.m_pointsIndex,-1),this.m_shape.setUserIndex(n,this.m_pointsIndex,-1));let i=t.vertex1,a=r.vertex1;this.m_shape.setNextVertex(i,a),this.m_shape.setPrevVertex(a,i),this.m_shape.getPrevVertex(i)===a&&(this.m_shape.setUserIndex(i,this.m_pointsIndex,-1),this.m_shape.setUserIndex(a,this.m_pointsIndex,-1))}this.m_dissolvedEdges+=2}}}r.assign(s),n=t,i=1}}e.length=0}};function Pp(e){for(let t=e.getFirstGeometry();t!==-1;t=e.getNextGeometry(t))if(V(e.getGeometryType(t)))return!0;return!1}function Fp(e,t,n,r){if(!Pp(e))return!1;let i=new zp(r);i.m_shape=e,i.m_tolerance=t,i.m_bTrackChanges=n;let a=!1,o=e.hasCurves()?5:15;return a=e.getTotalPointCount()<o?i.crackBruteForce_():i.crackerPlaneSweep_(),a}function Ip(e,t,n,r,i){if(!Pp(t))return!1;let a=new zp(i);if(a.m_shape=t,a.m_tolerance=n,a.m_bAllowCoincident=e,a.m_bNeedsNonSimpleResult=r!==null,a.needsCrackingImpl_())return r&&r.assign(a.m_nonSimpleResult),!0;let o=new At;o.setSwapCoordinates(),t.applyTransformation(o),a=new zp(i),a.m_shape=t,a.m_tolerance=n,a.m_bAllowCoincident=e,a.m_bNeedsNonSimpleResult=r!==null;let s=a.needsCrackingImpl_();return t.applyTransformation(o),!!s&&(r&&r.assign(a.m_nonSimpleResult),!0)}function Lp(e,t,n,r){let i=t.getGeometryType();if(V(i))return new zp(r).crackAWithBMultiPath_(e,t,n);xt(`crack_A_with_B`)}function Rp(e,t){return{t:e,index:t}}var zp=class e{crackBruteForce_(){let e=this.crackBruteForceImpl_();if(!e&&this.m_shape.hasCurves()){let t=new At;t.setSwapCoordinates(),this.m_shape.applyTransformation(t),e=this.crackBruteForceImpl_(),this.m_shape.applyTransformation(t)}return e}crackBruteForceImpl_(){let e=!1,t=new Q,n=new Q,r=G.constructEmpty(),i=G.constructEmpty(),a=new q,o=new _p,s=this.m_shape.getTotalPointCount(),c=s*s*2,l=this.m_shape.queryVertexIteratorOnSelection();for(let s=l.next();s!==-1;s=l.next()){let u=this.m_shape.getGeometryType(l.currentGeometry()),d=1,f=1,p=1,m=0,h=0,g=0,_=this.m_shape.getSegmentParentage(s),v=!1,y=!1,b=null,x=!1;if(Be(u))d=this.m_shape.getWeight(s),m=this.m_shape.getRank(s);else{if(b=this.getSegment_(s,t),b===null)continue;let e=this.m_shape.getVertexIndex(s);d=this.m_shape.getWeightWithIndex(e),m=this.m_shape.getRankWithIndex(e),p=this.m_shape.getSegmentWeightWithIndex(e),g=this.m_shape.getSegmentRankWithIndex(e),v=this.m_shape.getSegmentParentageBreakVertex(s);{let e=this.m_shape.getNextVertex(s);f=this.m_shape.getWeight(e),h=this.m_shape.getRank(e),y=this.m_shape.getSegmentParentageBreakVertex(e)}if(b.queryLooseEnvelope(r),r.inflateCoords(this.m_tolerance,this.m_tolerance),b.isDegenerate(this.m_tolerance)){if(!b.isDegenerate(0))continue;x=!0,b=null}}let S=new ns({copy:l}),C=S.next();C!==-1&&(C=S.next());let w=0;for(;C!==-1;C=S.next()){if(w!==0){w--;continue}if(this.m_shape.getTotalPointCount()>c)return e;this.progress_();let u=this.m_shape.getGeometryType(S.currentGeometry()),T=null,E=!1,D=0,O=0,k=0,A=0,j=0,M=0,N=!1,P=!1,ee=this.m_shape.getSegmentParentage(C);if(Be(u))D=this.m_shape.getWeight(C),A=this.m_shape.getRank(C);else{if(T=this.getSegment_(C,n),T===null)continue;let e=this.m_shape.getVertexIndex(C);D=this.m_shape.getWeightWithIndex(e),A=this.m_shape.getRankWithIndex(e),k=this.m_shape.getSegmentWeightWithIndex(e),M=this.m_shape.getSegmentRankWithIndex(e),N=this.m_shape.getSegmentParentageBreakVertex(C);{let e=this.m_shape.getNextVertex(C);O=this.m_shape.getWeight(e),j=this.m_shape.getRank(e),P=this.m_shape.getSegmentParentageBreakVertex(e)}if(T.queryLooseEnvelope(i),T.isDegenerate(this.m_tolerance)){if(!T.isDegenerate(0))continue;E=!0,T=null}}let te=0,F=0;if(b!==null&&T!==null)r.isIntersectingNe(i)&&Ld(!0,!0,b,T,this.m_tolerance,!0)!==0&&(o.pushSegment(b,d,m,f,h,p,g,v,y,_),o.pushSegment(T,D,A,O,j,k,M,N,P,ee),o.intersect2D(this.m_tolerance,!0),e||=o.getSegmentChanged(0)||o.getSegmentChanged(1),te=o.getResultSegmentCount(0),F=o.getResultSegmentCount(1),te+F>0&&(this.m_shape.splitSegmentWithIntersector(s,o,0,!0,!0),this.m_shape.splitSegmentWithIntersector(C,o,1,!0,!0),this.m_bTrackChanges&&(o.getSegmentChanged(0)&&this.m_shape.setGeometryModifiedWithVertex(s,!0),o.getSegmentChanged(1)&&this.m_shape.setGeometryModifiedWithVertex(C,!0))),F>1&&(w+=F-1),o.clear());else if(b!==null){let t=this.m_shape.getXY(C);if(r.contains(t)){if(o.pushSegment(b,d,m,f,h,p,g,v,y,_),this.m_shape.queryPoint(C,a),o.intersect2DEx(this.m_tolerance,a,A,D,!1),e||=o.getSegmentChanged(0)||o.getResultPointChanged(),te=o.getResultSegmentCount(0),te>0)if(this.m_bTrackChanges&&(o.getSegmentChanged(0)&&this.m_shape.setGeometryModifiedWithVertex(s,!0),o.getSegmentChanged(1)&&this.m_shape.setGeometryModifiedWithVertex(C,!0)),this.m_shape.splitSegmentWithIntersector(s,o,0,!0,!0),E){let e=-1;for(let t=this.m_shape.getNextVertex(C);t!==-1&&t!==C&&(T=this.getSegment_(t,n),e=t,T!=null&&T.isDegenerate(0));t=this.m_shape.getNextVertex(t));for(let t=C;t!==-1&&(this.m_shape.setPoint(t,o.getResultPoint(),!0),t!==e);t=this.m_shape.getNextVertex(t));}else this.m_shape.setPoint(C,o.getResultPoint(),!0);o.clear()}}else{if(T===null)continue;{let t=this.m_shape.getXY(s);if(i.inflateCoords(this.m_tolerance,this.m_tolerance),i.contains(t)){if(o.pushSegment(T,D,A,O,j,k,M,N,P,ee),this.m_shape.queryPoint(s,a),o.intersect2DEx(this.m_tolerance,a,m,d,!1),e||=o.getSegmentChanged(0)||o.getResultPointChanged(),F=o.getResultSegmentCount(0),F>0)if(this.m_bTrackChanges&&(o.getSegmentChanged(0)&&this.m_shape.setGeometryModifiedWithVertex(C,!0),o.getSegmentChanged(1)&&this.m_shape.setGeometryModifiedWithVertex(s,!0)),this.m_shape.splitSegmentWithIntersector(C,o,0,!0,!0),w+=F-1,x){let e=-1;for(let t=this.m_shape.getNextVertex(s);t!==-1&&t!==s&&(T=this.getSegment_(t,n),e=t,T!=null&&T.isDegenerate(0));t=this.m_shape.getNextVertex(t));for(let t=s;t!==-1&&(this.m_shape.setPoint(t,o.getResultPoint(),!0),t!==e);t=this.m_shape.getNextVertex(t));}else this.m_shape.setPoint(s,o.getResultPoint(),!0);o.clear()}}}if(te+F!==0&&te!==0){let e=!1;for(;b=this.getSegment_(s,t),b!=null&&(b.queryEnvelope(r),b.isDegenerate(this.m_tolerance));){if(!(te>1)){e=!0;break}s=l.next(),te--,U(s!==-1)}if(e)break}}}return e}crackerPlaneSweep_(){return this.planesweep_()}planesweep_(){return new Ap(this.m_progressTracker,this.m_bTrackChanges).sweep(this.m_shape,this.m_tolerance)}needsCrackingImpl_(){let e=!1,t=new sn(0);t.resize(this.m_shape.getSelectedCount());let n=this.m_shape.queryVertexIteratorOnSelection();for(let e=0,r=n.next();r!==-1;++e,r=n.next())t.write(e,r);this.m_shape.sortVerticesSimpleByY(t,0,t.size()),t.add(-1);let r=this.m_shape.createUserIndex(),i=this.m_shape.createUserIndex();this.m_sweepComparator=new op(this.m_shape,this.m_tolerance,!this.m_bAllowCoincident),this.m_sweepStructure.setComparator(this.m_sweepComparator);let a=null,o=[],s=[],c=0,l=new z;for(let n=t.read(c++);n!==-1;){this.m_shape.queryXY(n,l);let u=!1;do{let e=this.m_shape.getNextVertex(n),a=this.m_shape.getPrevVertex(n);u||=e!==-1||a!==-1,e===-1||this.m_shape.selected(e)||(e=-1),a===-1||this.m_shape.selected(a)||(a=-1),e!==-1&&this.m_shape.compareVerticesSimpleY(n,e)<0&&(s.push(n),s.push(e)),a!==-1&&this.m_shape.compareVerticesSimpleY(n,a)<0&&(s.push(a),s.push(a));let l=this.m_shape.getUserIndex(n,r);l!==-1&&(o.push(l),this.m_shape.setUserIndex(n,r,-1));let d=this.m_shape.getUserIndex(n,i);d!==-1&&(o.push(d),this.m_shape.setUserIndex(n,i,-1)),n=t.read(c++)}while(n!==-1&&this.m_shape.isEqualXYPoint2D(n,l));if(!u&&(a===null&&(a=new sp(this.m_shape,this.m_tolerance)),a.setPoint(l),this.m_sweepStructure.searchUpperBound(a),a.intersectionDetected())){e=!0,this.m_bNeedsNonSimpleResult&&(B(`needsCrackingIMpl_`),this.m_nonSimpleResult=new jt(6,-1,-1));break}let d=o.length===1&&s.length===2;o.length>32&&v(o);let f=-1,p=-1;if(!d)for(let t=0,n=o.length;t<n;t++){let n=o[t],r=this.m_sweepStructure.getPrev(n);if(r!==-1&&o.indexOf(r)===-1)if(f===-1)f=r;else{if(e=!0,!this.m_bNeedsNonSimpleResult)break;this.m_nonSimpleResult=new jt(6,-1,-1)}let i=this.m_sweepStructure.getNext(n);if(i!==-1&&o.indexOf(i)===-1)if(p===-1)p=i;else{if(e=!0,!this.m_bNeedsNonSimpleResult)break;this.m_nonSimpleResult=new jt(6,-1,-1)}if(f!==-1&&p!==-1)break}if(e&&!this.m_bNeedsNonSimpleResult)break;if(this.m_sweepComparator.setSweepY(l.y,l.x),!d){for(let e=0,t=o.length;e<t;e++){let t=o[e];this.m_sweepStructure.deleteNode(t)}o.length=0}if(!d&&f!==-1&&p!==-1&&this.checkForIntersections_(f,p)){e=!0,this.m_bNeedsNonSimpleResult&&(this.m_nonSimpleResult=this.m_sweepComparator.getResult());break}for(let t=0,n=s.length;t<n;t+=2){let n=s[t],a=s[t+1],c;if(d?(c=this.m_sweepStructure.replaceElementAtPosition(o[0],n,!0,!0),o.length=0,d=!1):c=this.m_sweepStructure.addElement(n),this.m_sweepComparator.intersectionDetected()){this.m_bNeedsNonSimpleResult&&(this.m_nonSimpleResult=this.m_sweepComparator.getResult()),e=!0;break}this.m_shape.getUserIndex(a,r)===-1?this.m_shape.setUserIndex(a,r,c):this.m_shape.setUserIndex(a,i,c)}if(e)break;s.length=0}return this.m_shape.removeUserIndex(r),this.m_shape.removeUserIndex(i),e}checkForIntersections_(e,t){let n=this.m_sweepStructure.getElement(e);this.m_sweepComparator.compare(this.m_sweepStructure,n,t);let r=this.m_sweepComparator.intersectionDetected();return this.m_sweepComparator.clearIntersectionDetectedFlag(),r}getSegment_(t,n){return e.st_getSegment(this.m_shape,t,n)}static st_getSegment(e,t,n){return e.querySegment(t,n,!1,!1)?n.get():null}dbgPrintSweepEdge(e){}dbgPrintSweepStructure(){}dbgSaveSweepStructure(e=null){}dbgCheckSweepStructure(){}progress_(e=!1){this.m_progressCounter++}crackAWithBMultiPath_(e,t,n){let r=G.constructEmpty();e.queryLooseEnvelope(r);let i=G.constructEmpty();if(t.queryLooseEnvelope(i),i.inflateCoords(n,n),!i.isIntersecting(r))return e;let a=e.getImpl(),o=a.getAccelerators(),s=null,c=null;o&&(c=o.getQuadTree()),Bp(e,wt(t))&&(s=tr(a,i),c=s);let l=c?c.getIteratorForQT():null,u=t.querySegmentIterator(),d=e.querySegmentIterator(),f=H(15,NaN),p=[];for(;u.nextPath();)for(;u.hasNextSegment();){let e=u.nextSegment();if(c){l.resetIterator(e,n);for(let t=l.next();t!==-1;t=l.next()){this.progress_();let r=c.getElement(t);if(d.resetToVertex(r,-1),d.hasNextSegment()){let t=d.nextSegment().intersect(e,null,f,null,n);for(let e=0;e<t;e++){let t=f[e];if(t===0||t===1)continue;let n=Rp(t,d.getStartPointIndex());p.push(n)}}}}else{let t=G.constructEmpty();if(e.queryLooseEnvelope(t),t.inflateCoords(n,n),!r.isIntersecting(t))continue;for(d.resetToFirstPath();d.nextPath();)for(;d.hasNextSegment();){let r=d.nextSegment(),i=G.constructEmpty();if(r.queryLooseEnvelope(i),!i.isIntersecting(t))continue;let a=r.intersect(e,null,f,null,n);for(let e=0;e<a;e++){let t=f[e];if(t===0||t===1)continue;let n=Rp(t,d.getStartPointIndex());p.push(n)}}}}if(p.length===0)return e;p.sort((e,t)=>e.index<t.index?-1:e.index>t.index?1:e.t<t.t?-1:e.t>t.t?1:0);let m=e.createInstance();for(m.getGeometryType()===L.enumPolygon&&m.setFillRule(e.getFillRule()),d.resetToFirstPath();d.nextPath()&&!d.hasNextSegment(););U(d.hasNextSegment());let h=d.nextSegment(),g=new Q,_=-1;for(let e=0,t=p.length;e<t;){let n=p[e].index,r=e+1;for(;r<t&&p[r].index===n;)++r;for(;d.getStartPointIndex()<n;){this.progress_();let e=d.hasNextSegment(),t=d.getPathIndex();if((e||!d.isClosingSegment()||d.isCurve())&&(U(h!==null),m.addSegment(h,_!==t)),_=t,!e){for(d.isPathClosed();d.nextPath()&&!d.hasNextSegment(););U(d.hasNextSegment())}h=d.nextSegment()}let i=0;for(let t=e;t<r;t++){let e=p[t].t;if(e===i)continue;U(h!==null),h.queryCut(i,e,g),i=e;let n=d.getPathIndex();m.addSegment(g.get(),_!==n),_=n}let a=d.hasNextSegment();if((a||!d.isClosingSegment()||d.isCurve())&&(U(h!=null),h.queryCut(i,1,g),m.addSegment(g.get(),!1)),a)h=d.nextSegment();else{for(;d.nextPath()&&!d.hasNextSegment(););h=d.hasNextSegment()?d.nextSegment():null}e=r}if(h!==null){let e=d.getPathIndex();(d.hasNextSegment()||!d.isClosingSegment()||d.isCurve())&&m.addSegment(h,_!==e),_=e}let v=d.hasNextSegment();for(;;){if(!v){for(;d.nextPath()&&(v=d.hasNextSegment(),!v););if(!v)break}h=d.nextSegment();let e=d.getPathIndex();v=d.hasNextSegment(),(v||!d.isClosingSegment()||d.isCurve())&&m.addSegment(h,_!==e),_=e}return m}constructor(e){this.m_shape=null,this.m_progressTracker=null,this.m_nonSimpleResult=new jt,this.m_tolerance=0,this.m_sweepComparator=null,this.m_progressCounter=0,this.m_bTrackChanges=!1,this.m_bNeedsNonSimpleResult=!1,this.m_bAllowCoincident=!0,this.m_sweepStructure=new yn,this.m_progressTracker=e}};function Bp(e,t){let n=e.getPointCount();return n<16?!1:2*n+1*(Math.log(n)/Math.log(2))*t<1*n*t}zp.s_bForceBruteForce=!0;var Vp=class{constructor(e,t){this.m_monotoneParts=C(Q,16),this.m_xOrds=H(16,NaN),this.m_inputPoint=z.getNAN(),this.m_miny=0,this.m_maxy=0,this.m_windnum=0,this.m_bAlternate=e,this.m_tolerance=t,this.m_toleranceSqr=t*t,this.m_bTestBorder=!!t,this.m_bBreak=!1}_DoOne(e){if(!this.m_bTestBorder&&(this.m_bAlternate&&this.m_inputPoint.equals(e.getStartXY())||this.m_inputPoint.equals(e.getEndXY())))return void(this.m_bBreak=!0);if(e.getStartY()===this.m_inputPoint.y&&e.getStartY()===e.getEndY()){if(this.m_bAlternate&&!this.m_bTestBorder){let t=Math.min(e.getStartX(),e.getEndX()),n=Math.max(e.getStartX(),e.getEndX());this.m_inputPoint.x>t&&this.m_inputPoint.x<n&&(this.m_bBreak=!0)}return}let t=!1,n=Math.max(e.getStartX(),e.getEndX());if(this.m_inputPoint.x>n)t=!0;else if(this.m_inputPoint.x>=Math.min(e.getStartX(),e.getEndX())){let r=e.intersectionOfYMonotonicWithAxisX(this.m_inputPoint.y,n);t=!Number.isNaN(r)&&r<=this.m_inputPoint.x}if(t){if(this.m_inputPoint.y===e.getStartY()){if(this.m_inputPoint.y<e.getEndY())return}else if(this.m_inputPoint.y===e.getEndY()&&this.m_inputPoint.y<e.getStartY())return;this.m_bAlternate?this.m_windnum^=1:this.m_windnum+=e.getStartY()>e.getEndY()?1:-1}}_Result(){return!!this.m_windnum}testBorder(e){let t=e.getClosestCoordinate(this.m_inputPoint,!1),n=e.getCoord2D(t);return z.sqrDistance(n,this.m_inputPoint)<=this.m_toleranceSqr}setInputPoint(e){this.m_inputPoint.setCoordsPoint2D(e),this.m_miny=e.y-this.m_tolerance,this.m_maxy=e.y+this.m_tolerance}processSegment(e){let t=e.queryInterval(0,1);if(t.vmin>this.m_maxy||t.vmax<this.m_miny)return!1;if(this.m_bTestBorder&&this.testBorder(e))return!0;if(t.vmin>this.m_inputPoint.y||t.vmax<this.m_inputPoint.y)return!1;let n=0;if(e.isCurve()&&(this.m_monotoneParts.length===0&&(this.m_monotoneParts.length=128),n=e.getMonotonicParts(this.m_monotoneParts,!0),U(this.m_monotoneParts.length>=n)),n>0)for(let e=0;e<n;e++){let t=this.m_monotoneParts[e].get(),n=I.construct(t.getStartY(),t.getEndY());if(!(n.vmin>this.m_inputPoint.y||n.vmax<this.m_inputPoint.y)&&(this._DoOne(t),this.m_bBreak))return!0}else if(this._DoOne(e),this.m_bBreak)return!0;return!1}result(){return U(0),2}};function Hp(e,t,n,r){let i=new G;e.queryLooseEnvelope(i),i.inflateCoords(r,r);let a=e.getFillRule()===0,o=new Vp(a,r);o.setInputPoint(n);let s=i.clone();s.xmax=n.x+r,s.ymin=n.y-r,s.ymax=n.y+r;let c=e.getImpl().querySegmentIterator(),l=t.getIterator(s,r);for(let e=l.next();e!==-1;e=l.next())if(c.resetToVertex(t.getElement(e),-1),c.hasNextSegment()){let e=c.nextSegment();if(o.processSegment(e))return-1}return o._Result()?1:0}function Up(e,t,n){let r=e.getFillRule()===0,i=new Vp(r,n);i.setInputPoint(t);let a=e.getImpl().querySegmentIterator();for(;a.nextPath();)for(;a.hasNextSegment();){let e=a.nextSegment();if(i.processSegment(e))return-1}return i._Result()?1:0}function Wp(e,t,n){return t.isEmpty()?0:Gp(e,t.getXY(),n)}function Gp(e,t,n){if(e.isEmpty())return 0;let r=G.constructEmpty();if(e.queryLooseEnvelope(r),r.inflateCoords(n,n),!r.contains(t))return 0;let i=e.getImpl().getAccelerators();if(i){i.getRasterizedGeometry()&&U(0);let r=i.getQuadTree();if(r)return Hp(e,r,t,n)}return Up(e,t,n)}function Kp(e,t){let n=e.getPointCount();return n<16?!1:2*n+1*(Math.log(n)/Math.log(2))*t<1*n*t}function qp(e,t,n,r,i){let a=new Zp(i);return a.m_shape=e,a.m_geometry=t,a.m_sortedVertices=n,a.m_bFixSelfTangency=r,a.fixRingOrientation_()}var Jp=class{getDirection_(e){return this.m_shape.getNextVertex(this.getEnd1(e))===this.getEnd2(e)}getEnd_(e){let t=this.getEnd1(e),n=this.getEnd2(e);return this.m_shape.getNextVertex(t)===n?n:t}constructor(e){this.m_end1Nodes=[],this.m_end2Nodes=[],this.m_directions=[],this.m_shape=e,this.m_firstFree=-1}getSegment(e){return this.m_shape.getSegment(this.getStart(e))}isBottomUp(e){let t=this.getEnd1(e),n=this.getEnd2(e);this.m_shape.getPrevVertex(t)===n&&(n=W(t,t=n));let r=z.getNAN(),i=z.getNAN();return this.m_shape.queryXY(t,r),this.m_shape.queryXY(n,i),U(!r.equals(i)),r.y<i.y}getStart(e){let t=this.getEnd1(e),n=this.getEnd2(e);return this.m_shape.getNextVertex(t)===n?t:n}getEnd1(e){return this.m_end1Nodes[e]}getEnd2(e){return this.m_end2Nodes[e]}freeEdge(e){this.m_end1Nodes[e]=this.m_firstFree,this.m_firstFree=e}newEdge(e){if(this.m_firstFree!==-1){let t=this.m_firstFree;return this.m_firstFree=this.m_end1Nodes[t],this.m_end1Nodes[t]=e,this.m_end2Nodes[t]=this.m_shape.getNextVertex(e),t}let t=this.m_end1Nodes.length;return this.m_end1Nodes.push(e),this.m_end2Nodes.push(this.m_shape.getNextVertex(e)),t}getShape(){return this.m_shape}getPath(e){return this.m_shape.getPathFromVertex(this.getEnd1(e))}},Yp=class extends vn{constructor(e){super(),this.m_line1=new Z,this.m_line2=new Z,this.m_leftElm=-1,this.m_leftx=0,this.m_seg1=null,this.m_helper=e}compare(e,t,n){let r=e.getElement(n),i=this.m_helper.m_edges,a;this.m_leftElm===t?a=this.m_leftx:(this.m_seg1=i.getSegment(t),this.m_seg1?a=this.m_seg1.intersectionOfYMonotonicWithAxisX(this.m_helper.m_yScanline,0):(i.getShape().queryLineConnector(i.getStart(t),this.m_line1,!0),this.m_seg1=this.m_line1,a=this.m_line1.intersectionOfYMonotonicWithAxisX(this.m_helper.m_yScanline,0)),this.m_leftx=a,this.m_leftElm=t);let o,s=i.getSegment(r);if(s?o=s.intersectionOfYMonotonicWithAxisX(this.m_helper.m_yScanline,0):(i.getShape().queryLineConnector(i.getStart(r),this.m_line2,!0),s=this.m_line2,o=this.m_line2.intersectionOfYMonotonicWithAxisX(this.m_helper.m_yScanline,0)),a===o){let e=i.isBottomUp(t),n=i.isBottomUp(r),c=e?this.m_seg1.getEndY():this.m_seg1.getStartY(),l=n?s.getEndY():s.getStartY(),u=Math.min(c,l),d=.5*(u+this.m_helper.m_yScanline);d===this.m_helper.m_yScanline&&(d=u),a=this.m_seg1.intersectionOfYMonotonicWithAxisX(d,0),o=s.intersectionOfYMonotonicWithAxisX(d,0),a===o&&Ue(``)}return a<o?-1:a>o?1:0}reset(){this.m_leftElm=-1}},Xp=class{constructor(e){this.m_node=-1,this.m_index=0,this.m_sortedVertices=e.m_sortedVertices,this.m_sortedVerticesArray=e.m_sortedVerticesArray,this.m_sortedVertices&&(this.m_node=this.m_sortedVertices.getFirst(this.m_sortedVertices.getFirstList()))}next(){if(this.m_sortedVertices){let e=this.m_node;if(e===-1)return-1;let t=this.m_sortedVertices.getData(e);return this.m_node=this.m_sortedVertices.getNext(e),t}if(this.m_index<this.m_sortedVerticesArray.size()){let e=this.m_sortedVerticesArray.read(this.m_index);return this.m_index++,e}return-1}},Zp=class{constructor(e){this.m_edges=null,this.m_shape=null,this.m_AET=new yn,this.m_yScanline=0,this.m_geometry=-1,this.m_unknownRingOrientationCount=-1,this.m_sortedVertices=null,this.m_sortedVerticesArray=null,this.m_unknownNodes=[],this.m_node1UserIndex=-1,this.m_node2UserIndex=-1,this.m_pathOrientationIndex=-1,this.m_pathParentageIndex=-1,this.m_pathParentsIndex=-1,this.m_progressCounter=0,this.m_bFixSelfTangency=!1,this.m_progressTracker=e,this.m_AET.disableBalancing(),this.m_sweepComparator=new Yp(this),this.m_AET.setComparator(this.m_sweepComparator)}fixRingOrientation_(){let e=this.fixRingOrientationImplMain_();return this.m_pathOrientationIndex===-1||this.fixRingOrientationImplSimplify_(),e}fixRingOrientationForMp2sp_(){return this.fixRingOrientationImplMain_(),this.m_pathOrientationIndex===-1?-1:this.fixRingOrientationImplMp2sp_()}processBunchForRingOrientationTest_(e){return this.processBunchForRingOrientationTestOddEven_(e)}processBunchForRingOrientationTestOddEven_(e){let t=!1;if(this.m_edges||=new Jp(this.m_shape),this.m_unknownNodes.length=0,this.processBunchForRingOrientationRemoveEdges_(e),!this.m_AET.isAutoBalancing()){let t=0;for(let n=0,r=e.length;n<r;n++)e[n]!==-1&&t++;(t>10||this.m_AET.getMaxDepthEver()>4)&&this.m_AET.enableBalancing()}for(let t=0,n=e.length;t<n;t++){let n=e[t];n!==-1&&this.insertEdge_(n,-1)}for(let e=0;e<this.m_unknownNodes.length&&this.m_unknownRingOrientationCount>0;e++){let n=this.m_unknownNodes[e],r=this.m_AET.getElement(n),i=this.m_edges.getPath(r),a=this.m_shape.getPathUserIndex(i,this.m_pathOrientationIndex),o=-1;if(a===0){let e=this.m_AET.getPrev(n),r=n,i=!1;for(;e!==yn.st_nullNode();){let t=this.m_AET.getElement(e),n=this.m_edges.getPath(t);if(this.m_shape.getPathUserIndex(n,this.m_pathOrientationIndex)!==0){o=n;break}r=e,e=this.m_AET.getPrev(e)}if(e===yn.st_nullNode())i=!0,e=r;else{let t=this.m_AET.getElement(e);i=this.m_edges.isBottomUp(t),e=this.m_AET.getNext(e),i=!i}do{let n=this.m_AET.getElement(e),a=this.m_edges.getPath(n);if(this.m_shape.getPathUserIndex(a,this.m_pathOrientationIndex)===0){if(i!==this.m_edges.isBottomUp(n)){let e=this.m_shape.getFirstVertex(a);this.m_shape.reverseRingInternal(e),this.m_shape.setLastVertex(a,this.m_shape.getPrevVertex(e)),t=!0}if(this.m_shape.setPathUserIndex(a,this.m_pathOrientationIndex,i?3:2),!i){let e=this.m_shape.getPathUserIndex(o,this.m_pathOrientationIndex);e===2?(o=this.m_shape.getPathUserIndex(o,this.m_pathParentsIndex),e=this.m_shape.getPathUserIndex(o,this.m_pathOrientationIndex),U(e===3)):U(e===3);let t=this.m_shape.getPathUserIndex(o,this.m_pathParentageIndex);this.m_shape.setPathUserIndex(o,this.m_pathParentageIndex,a),this.m_shape.setPathUserIndex(a,this.m_pathParentageIndex,t),this.m_shape.setPathUserIndex(a,this.m_pathParentsIndex,o)}if(this.m_unknownRingOrientationCount--,!this.m_unknownRingOrientationCount)return t}o=a,r=e,e=this.m_AET.getNext(e),i=!i}while(r!==n)}}return t}processBunchForRingOrientationRemoveEdges_(e){for(let t=0,n=e.length;t<n;t++){let n=e[t],r=this.m_shape.getUserIndex(n,this.m_node1UserIndex),i=this.m_shape.getUserIndex(n,this.m_node2UserIndex);if(r!==-1){let e=this.m_AET.getElement(r);this.m_edges.freeEdge(e),this.m_shape.setUserIndex(n,this.m_node1UserIndex,-1)}if(i!==-1){let e=this.m_AET.getElement(i);this.m_edges.freeEdge(e),this.m_shape.setUserIndex(n,this.m_node2UserIndex,-1)}let a=-1;r!==-1&&i!==-1?(this.m_AET.deleteNode(r),this.m_AET.deleteNode(i),e[t]=-1):a=r===-1?i:r,a!==-1&&(this.insertEdge_(n,a)||this.m_AET.deleteNode(a),e[t]=-1)}}dbgVerifyRingOrientation_(){}insertEdge_(e,t){let n=z.getNAN(),r=z.getNAN();this.m_shape.queryXY(e,n);let i=this.m_shape.getNextVertex(e);this.m_shape.queryXY(i,r);let a=!1;if(n.y<r.y){a=!0;let n=this.m_edges.newEdge(e),r;t===-1?r=this.m_AET.addElement(n):(r=t,this.m_AET.setElement(r,n)),this.m_shape.getUserIndex(i,this.m_node1UserIndex)===-1?this.m_shape.setUserIndex(i,this.m_node1UserIndex,r):this.m_shape.setUserIndex(i,this.m_node2UserIndex,r);let o=this.m_shape.getPathFromVertex(e);this.m_shape.getPathUserIndex(o,this.m_pathOrientationIndex)===0&&this.m_unknownNodes.push(r)}let o=this.m_shape.getPrevVertex(e);if(this.m_shape.queryXY(o,r),n.y<r.y){a=!0;let n=this.m_edges.newEdge(o),r;t===-1?r=this.m_AET.addElement(n):(r=t,this.m_AET.setElement(r,n)),this.m_shape.getUserIndex(o,this.m_node1UserIndex)===-1?this.m_shape.setUserIndex(o,this.m_node1UserIndex,r):this.m_shape.setUserIndex(o,this.m_node2UserIndex,r);let i=this.m_shape.getPathFromVertex(e);this.m_shape.getPathUserIndex(i,this.m_pathOrientationIndex)===0&&this.m_unknownNodes.push(r)}return a}fixRingSelfTangency_(){let e=[],t=[],n=-1,r=-1,i=new z,a=-1,o=-1,s=-1,c=new Xp(this);for(let l=c.next();l!==-1;l=c.next()){let c=new z;this.m_shape.queryXY(l,c);let u=this.m_shape.getPathFromVertex(l);i.equals(c)&&o===u?(r===-1&&(n=this.m_shape.createPathUserIndex(),this.m_shape.fillPathUserIndexForGeometry(this.m_geometry,n,-1),r=this.m_shape.createUserIndex(),this.m_shape.fillUserIndexForGeometry(this.m_geometry,r,-1)),s===-1&&(s=t.length,this.m_shape.setUserIndex(a,r,s),t.push(1),this.m_shape.getPathUserIndex(u,n)===-1&&(this.m_shape.setPathUserIndex(u,n,a),e.push(u))),this.m_shape.setUserIndex(l,r,s),t[t.length-1]++):(s=-1,i.assign(c)),a=l,o=u}if(e.length===0)return!1;U(n!==-1);for(let i=0,a=e.length;i<a;i++){let a=e[i],o=this.m_shape.getPathUserIndex(a,n),s=this.m_shape.getUserIndex(o,r),c=[],l=[];c.push(o),l.push(s);for(let e=this.m_shape.getNextVertex(o);e!==o;e=this.m_shape.getNextVertex(e)){let n=e,i=this.m_shape.getUserIndex(n,r);if(i!==-1){if(l.length===0){l.push(i),c.push(n);continue}if(l.at(-1)===i){let a=c.at(-1);this.m_shape.peelALoopIntoAPath(a,n),this.m_shape.setUserIndex(e,r,-1),t[i]--,t[i]===1&&(t[i]=0,l.pop(),c.pop()),o=a,e=a}else c.push(e),l.push(i)}}}return this.m_shape.removePathUserIndex(n),this.m_shape.removeUserIndex(r),this.m_shape.dbgVerifyVertexCounts(),!0}progress_(e=!1){}fixRingOrientationImplMain_(){let n={stack:[],error:void 0,hasError:!1};try{let e,r=!1,i=t(n,m(()=>{this.m_sortedVerticesArray=null}),!1);if(this.m_sortedVertices===null){let t=this.m_shape.getPointCount(this.m_geometry);e=new sn(0);for(let t=this.m_shape.getFirstPath(this.m_geometry);t!==-1;t=this.m_shape.getNextPath(t)){let n=this.m_shape.getFirstVertex(t);for(let r=0,i=this.m_shape.getPathSize(t);r<i;r++)e.add(n),n=this.m_shape.getNextVertex(n)}this.m_shape.sortVerticesSimpleByY(e,0,t),this.progress_(!0),this.m_sortedVerticesArray=e}else i.bForget=!0;if(this.m_bFixSelfTangency&&(r=this.fixRingSelfTangency_()),this.m_shape.getPathCount(this.m_geometry)===1){let e=this.m_shape.getFirstPath(this.m_geometry),t=this.m_shape.getRingArea(e);if(this.m_shape.setExterior(e,!0),t<0){let t=this.m_shape.getFirstVertex(e);return this.m_shape.reverseRingInternal(t),this.m_shape.setLastVertex(e,this.m_shape.getPrevVertex(t)),!0}return!1}this.m_shape.dbgVerifyCurves(),this.m_pathOrientationIndex=this.m_shape.createPathUserIndex(),this.m_pathParentageIndex=this.m_shape.createPathUserIndex(),this.m_pathParentsIndex=this.m_shape.createPathUserIndex();for(let e=this.m_shape.getFirstPath(this.m_geometry);e!==-1;e=this.m_shape.getNextPath(e))this.m_shape.setPathUserIndex(e,this.m_pathOrientationIndex,0),this.m_shape.setPathUserIndex(e,this.m_pathParentageIndex,-1),this.m_shape.setPathUserIndex(e,this.m_pathParentsIndex,-1);let a=[];this.m_yScanline=NaN;let o=z.getNAN();this.m_unknownRingOrientationCount=this.m_shape.getPathCount(this.m_geometry),this.m_node1UserIndex=this.m_shape.createUserIndexUninitialized(),this.m_shape.fillUserIndexForGeometry(this.m_geometry,this.m_node1UserIndex,-1),this.m_node2UserIndex=this.m_shape.createUserIndexUninitialized(),this.m_shape.fillUserIndexForGeometry(this.m_geometry,this.m_node2UserIndex,-1);let s=new Xp(this);for(let e=s.next();e!==-1&&(this.progress_(),this.m_shape.queryXY(e,o),o.y!==this.m_yScanline&&a.length&&(r=this.processBunchForRingOrientationTest_(a)||r,this.m_sweepComparator.reset(),a.length=0),a.push(e),this.m_yScanline=o.y,this.m_unknownRingOrientationCount!==0);e=s.next());return this.m_unknownRingOrientationCount>0&&(r=this.processBunchForRingOrientationTest_(a)||r,a.length=0),this.m_shape.removeUserIndex(this.m_node1UserIndex),this.m_shape.removeUserIndex(this.m_node2UserIndex),this.dbgVerifyRingOrientation_(),r}catch(e){n.error=e,n.hasError=!0}finally{e(n)}}fixRingOrientationImplSimplify_(){let e=[];for(let t=this.m_shape.getFirstPath(this.m_geometry);t!==-1;)if(this.progress_(),this.m_shape.getPathUserIndex(t,this.m_pathOrientationIndex)===3){this.m_shape.setExterior(t,!0);for(let n=this.m_shape.getPathUserIndex(t,this.m_pathParentageIndex);n!==-1;){let r=this.m_shape.getPathUserIndex(n,this.m_pathParentageIndex);e.push(n),this.m_shape.setExterior(n,!1),this.m_shape.setPathUserIndex(n,this.m_pathParentageIndex,t),n=r}let n=t,r=e.length;for(let e=this.m_shape.getNextPath(t);r>0&&e!==-1;e=this.m_shape.getNextPath(e),--r){if(this.m_shape.getPathUserIndex(e,this.m_pathParentageIndex)!==t){n=-1;break}n=e}if(r!==0){n=t;for(let t=0,r=e.length;t<r;t++){let r=e[t];this.m_shape.setPathUserIndex(r,this.m_pathParentageIndex,Xt),this.m_shape.movePath(this.m_geometry,this.m_shape.getNextPath(n),r),n=r}}e.length=0,t=this.m_shape.getNextPath(n)}else t=this.m_shape.getNextPath(t);this.m_shape.removePathUserIndex(this.m_pathOrientationIndex),this.m_shape.removePathUserIndex(this.m_pathParentageIndex),this.m_shape.removePathUserIndex(this.m_pathParentsIndex)}fixRingOrientationImplMp2sp_(){let e=this.m_shape.createPathUserIndex(),t=0,n=[];for(let r=this.m_shape.getFirstPath(this.m_geometry);r!==-1;)if(this.progress_(),this.m_shape.getPathUserIndex(r,this.m_pathOrientationIndex)===3){this.m_shape.setExterior(r,!0),this.m_shape.setPathUserIndex(r,e,t),t++;for(let e=this.m_shape.getPathUserIndex(r,this.m_pathParentageIndex);e!==-1;){let t=this.m_shape.getPathUserIndex(e,this.m_pathParentageIndex);n.push(e),this.m_shape.setExterior(e,!1),this.m_shape.setPathUserIndex(e,this.m_pathParentageIndex,r),e=t}let i=r,a=n.length,o=t;for(let t=this.m_shape.getNextPath(r);a>0&&t!==-1;t=this.m_shape.getNextPath(t),--a){if(this.m_shape.getPathUserIndex(t,this.m_pathParentageIndex)!==r){i=-1;break}i=t,this.m_shape.setPathUserIndex(t,e,-o),o++}if(a!==0){i=r,o=t;for(let t=0,r=n.length;t<r;t++){let r=n[t];this.m_shape.setPathUserIndex(r,e,-o),o++,this.m_shape.setPathUserIndex(r,this.m_pathParentageIndex,Xt)}i=r}t=o,n.length=0,r=this.m_shape.getNextPath(i)}else r=this.m_shape.getNextPath(r);return this.m_shape.removePathUserIndex(this.m_pathOrientationIndex),this.m_shape.removePathUserIndex(this.m_pathParentageIndex),this.m_shape.removePathUserIndex(this.m_pathParentsIndex),e}};function Qp(e,t,n,r,i,a){let o=new $p(a);return o.m_shape=e,o.m_geometry=t,o.m_knownSimpleResult=n,o.m_bFixSelfTangency=r,o.m_polylineDegeneracies=i,o.m_bHasSegmentParentage=e.hasSegmentParentage(),o.m_bHasSegments=e.hasCurves(),o.simplify_()}var $p=class{constructor(e){this.m_shape=null,this.m_geometry=-1,this.m_sortedVertices=new bn,this.m_bunchEdgeEndPoints=[],this.m_bunchEdgeCenterPoints=[],this.m_bunchEdgeIndices=[],this.m_sorterSegmentBuffer1=null,this.m_sorterSegmentBuffer2=null,this.m_knownSimpleResult=-1,this.m_sortedVerticesListIndex=-1,this.m_polylineDegeneracies=-1,this.m_userIndexSortedIndexToVertex=-1,this.m_userIndexSortedAngleIndexToVertex=-1,this.m_nextVertexToProcess=-1,this.m_firstCoincidentVertex=-1,this.m_progressCounter=0,this.m_bFixSelfTangency=!1,this.m_bHasSegmentParentage=!1,this.m_bHasSegments=!1,this.m_progressTracker=e}compareAngles_(e,t){return this.m_bHasSegments?this.compareAnglesCurves_(e,t):this.compareAnglesLines_(e,t)}compareAnglesLines_(e,t){let n=this.m_bunchEdgeEndPoints[e],r=new z;this.m_shape.queryXY(n,r);let i=new z,a=this.m_bunchEdgeEndPoints[t];if(this.m_shape.queryXY(a,i),r.equals(i))return 0;let o=this.m_bunchEdgeCenterPoints[e],s=new z;this.m_shape.queryXY(o,s);let c=this.m_bunchEdgeCenterPoints[t],l=new z;this.m_shape.queryXY(c,l);let u=new z;u.setSub(r,s);let d=new z;return d.setSub(i,l),(u.isZero()||d.isZero())&&Ue(``),z.compareVectors(u,d)}compareAnglesCurves_(e,t){let n=this.m_bunchEdgeEndPoints[e],r=this.m_bunchEdgeEndPoints[t],i=this.m_bunchEdgeCenterPoints[e],a=this.m_bunchEdgeCenterPoints[t],o=this.m_shape.getNextVertex(i)===n,s=this.m_shape.getNextVertex(a)===r,c=o?this.m_shape.isCurve(i):this.m_shape.isCurve(n),l=s?this.m_shape.isCurve(a):this.m_shape.isCurve(r);return!c&&!l?this.compareAnglesLines_(e,t):(this.m_sorterSegmentBuffer1||=new Q,this.m_sorterSegmentBuffer2||=new Q,o?this.m_shape.querySegment(i,this.m_sorterSegmentBuffer1,!1,!0):(this.m_shape.querySegment(n,this.m_sorterSegmentBuffer1,!1,!0),this.m_sorterSegmentBuffer1.get().reverse()),s?this.m_shape.querySegment(a,this.m_sorterSegmentBuffer2,!1,!0):(this.m_shape.querySegment(r,this.m_sorterSegmentBuffer2,!1,!0),this.m_sorterSegmentBuffer2.get().reverse()),Er(this.m_sorterSegmentBuffer1.get(),this.m_sorterSegmentBuffer2.get()))}beforeRemoveVertex_(e,t){let n=this.m_shape.getUserIndex(e,this.m_userIndexSortedIndexToVertex);if(this.m_nextVertexToProcess===n&&(this.m_nextVertexToProcess=this.m_sortedVertices.getNext(this.m_nextVertexToProcess)),this.m_firstCoincidentVertex===n&&(this.m_firstCoincidentVertex=this.m_sortedVertices.getNext(this.m_firstCoincidentVertex)),this.m_sortedVertices.deleteElement(this.m_sortedVerticesListIndex,n),this.removeAngleSortInfo_(e),t){let t=this.m_shape.getPathFromVertex(e);if(t!==-1&&this.m_shape.getFirstVertex(t)===e){let n=this.m_shape.getNextVertex(e);if(n!==e){if(this.m_shape.getPathFromVertex(n)===t)return void this.m_shape.setFirstVertex(t,n);{let n=this.m_shape.getPrevVertex(e);if(n!==e&&this.m_shape.getPathFromVertex(n)===t)return void this.m_shape.setFirstVertex(t,n)}}this.m_shape.setFirstVertex(t,-1),this.m_shape.setLastVertex(t,-1)}}}processBunch_(){let e=!1,t=new z(0,0);for(;;){this.m_bunchEdgeEndPoints.length=0,this.m_bunchEdgeCenterPoints.length=0,this.m_bunchEdgeIndices.length=0;let n=this.m_firstCoincidentVertex,r=0,i=!0;for(;n!==this.m_nextVertexToProcess;){let e=this.m_sortedVertices.getData(n);i&&=(this.m_shape.queryXY(e,t),!1);let a=this.m_shape.getPrevVertex(e),o=this.m_shape.getNextVertex(e);this.m_shape.getUserIndex(a,this.m_userIndexSortedAngleIndexToVertex)!==-559038737&&(this.m_bunchEdgeEndPoints.push(a),this.m_shape.setUserIndex(a,this.m_userIndexSortedAngleIndexToVertex,-559038737),this.m_bunchEdgeCenterPoints.push(e),this.m_bunchEdgeIndices.push(r++)),this.m_shape.getUserIndex(o,this.m_userIndexSortedAngleIndexToVertex)!==-559038737&&(this.m_bunchEdgeEndPoints.push(o),this.m_shape.setUserIndex(o,this.m_userIndexSortedAngleIndexToVertex,-559038737),this.m_bunchEdgeCenterPoints.push(e),this.m_bunchEdgeIndices.push(r++)),n=this.m_sortedVertices.getNext(n)}if(this.m_bunchEdgeEndPoints.length<2){this.m_bunchEdgeEndPoints.length===1&&this.m_shape.setUserIndex(this.m_bunchEdgeEndPoints[0],this.m_userIndexSortedAngleIndexToVertex,-1);break}this.m_bunchEdgeIndices.sort((e,t)=>this.compareAngles_(e,t));for(let e=0,t=this.m_bunchEdgeIndices.length;e<t;e++){let t=this.m_bunchEdgeIndices[e],n=this.m_bunchEdgeEndPoints[t];this.m_shape.setUserIndex(n,this.m_userIndexSortedAngleIndexToVertex,e)}let a=this.processCrossOvers_(t);for(let e=0,t=this.m_bunchEdgeIndices.length;e<t;e++){let t=this.m_bunchEdgeIndices[e];if(t===-1)continue;let n=this.m_bunchEdgeEndPoints[t];this.m_shape.setUserIndex(n,this.m_userIndexSortedAngleIndexToVertex,-1)}if(!a)break;e=!0}return e}processCrossOvers_(e){let t=!1,n=!0;for(;n;){n=!1;let r=0;this.m_bunchEdgeIndices[r]===-1&&(r=this.getNextEdgeIndex_(r));let i=this.getNextEdgeIndex_(r);for(let a=0,o=this.m_bunchEdgeIndices.length;a<o&&r!==-1&&i!==-1&&r!==i;a++){let a=this.m_bunchEdgeIndices[r],o=this.m_bunchEdgeIndices[i],s=this.m_bunchEdgeEndPoints[a],c=this.m_bunchEdgeEndPoints[o],l=this.m_shape.getNextVertex(s),u=!1;this.m_shape.isEqualXYPoint2D(l,e)||(l=this.m_shape.getPrevVertex(s),u=!0);let d=this.m_shape.getNextVertex(c),f=!1;this.m_shape.isEqualXYPoint2D(d,e)||(d=this.m_shape.getPrevVertex(c),f=!0);let p=u?this.m_shape.getPrevVertex(l):this.m_shape.getNextVertex(l),m=f?this.m_shape.getPrevVertex(d):this.m_shape.getNextVertex(d),h=!1;(this.removeSpike_(l)||this.removeSpike_(d)||this.removeSpike_(s)||this.removeSpike_(c)||this.removeSpike_(p)||this.removeSpike_(m))&&(h=!0),l!==d&&(!h&&this.m_shape.isEqualXY(s,c)&&(h=this.resolveOverlap_(u,f,l,s,d,c)),!h&&this.m_shape.isEqualXY(p,m)&&(h=this.resolveOverlap_(!u,!f,l,p,d,m)),!h&&this.m_shape.isEqualXY(s,m)&&(h=this.resolveOverlap_(u,!f,l,s,d,m)),!h&&this.m_shape.isEqualXY(p,c)&&(h=this.resolveOverlap_(!u,f,l,p,d,c))),h&&(t=!0),n||=h,r=h?this.getNextEdgeIndex_(r):i,i=this.getNextEdgeIndex_(r)}}if(!t){let n=0;this.m_bunchEdgeIndices[n]===-1&&(n=this.getNextEdgeIndex_(n));let r=this.getNextEdgeIndex_(n);for(let i=0,a=this.m_bunchEdgeIndices.length;i<a&&n!==-1&&r!==-1&&n!==r;i++){let i=this.m_bunchEdgeIndices[n],a=this.m_bunchEdgeIndices[r],o=this.m_bunchEdgeEndPoints[i],s=this.m_bunchEdgeEndPoints[a],c=this.m_shape.getNextVertex(o);this.m_shape.isEqualXYPoint2D(c,e)||(c=this.m_shape.getPrevVertex(o));let l=this.m_shape.getNextVertex(s);this.m_shape.isEqualXYPoint2D(l,e)||(l=this.m_shape.getPrevVertex(s));let u=this.getDirection_(c,o),d=this.getDirection_(l,s),f=u?this.m_shape.getPrevVertex(c):this.m_shape.getNextVertex(c),p=d?this.m_shape.getPrevVertex(l):this.m_shape.getNextVertex(l),m=this.detectAndResolveCrossOver_(u,d,o,c,f,s,l,p);m===1?t=!0:m===0?(n=this.getNextEdgeIndex_(n),r=this.getNextEdgeIndex_(n)):(n=this.getPrevEdgeIndex_(n),r=this.getNextEdgeIndex_(n))}}return t}simplify_(){this.m_shape.getGeometryType(this.m_geometry)===L.enumPolygon&&this.m_shape.getFillRule(this.m_geometry)===1&&new W_(this.m_progressTracker).planarSimplifyNoCrackingAndCluster(this.m_bFixSelfTangency,this.m_shape,this.m_geometry,0);let e=!1;this.m_userIndexSortedIndexToVertex=-1,this.m_userIndexSortedAngleIndexToVertex=-1,this.m_userIndexSortedAngleIndexToVertex=this.m_shape.createUserIndexUninitialized();let t=this.m_shape.getPointCount(this.m_geometry),n=new sn(0);this.m_shape.dbgVerifyMonotone();for(let e=this.m_shape.getFirstPath(this.m_geometry);e!==-1;e=this.m_shape.getNextPath(e)){let t=this.m_shape.getFirstVertex(e);for(let r=0,i=this.m_shape.getPathSize(e);r<i;r++)this.m_shape.setUserIndex(t,this.m_userIndexSortedAngleIndexToVertex,-1),n.add(t),t=this.m_shape.getNextVertex(t)}this.m_shape.sortVerticesSimpleByY(n,0,t),this.progress_(!0),this.m_userIndexSortedIndexToVertex=this.m_shape.createUserIndexUninitialized(),this.m_sortedVertices.reserveNodes(t),this.m_sortedVerticesListIndex=this.m_sortedVertices.createList(0);for(let e=0;e<t;e++){let t=n.read(e),r=this.m_sortedVertices.addElement(this.m_sortedVerticesListIndex,t);this.m_shape.setUserIndex(t,this.m_userIndexSortedIndexToVertex,r)}this.m_nextVertexToProcess=-1,this.cleanupSpikes_()&&(e=!0);let r=0,i=!1;do{i=!1,this.m_nextVertexToProcess=-1,this.m_firstCoincidentVertex=this.m_sortedVertices.getFirst(this.m_sortedVerticesListIndex);let t=new z(0,0);this.m_firstCoincidentVertex!==bn.st_nullNode()&&this.m_shape.queryXY(this.m_sortedVertices.getData(this.m_firstCoincidentVertex),t);let n=0,a=this.m_firstCoincidentVertex;for(;a!==bn.st_nullNode()&&(a=this.m_sortedVertices.getNext(a),a!==bn.st_nullNode());){this.progress_();let e=this.m_sortedVertices.getData(a),r=z.getNAN();if(this.m_shape.queryXY(e,r),t.equals(r))n++;else{if(n>0){this.m_nextVertexToProcess=a;let e=this.processBunch_();a=this.m_nextVertexToProcess,a!==bn.st_nullNode()&&this.m_shape.queryXY(this.m_sortedVertices.getData(a),r),e&&(i=!0)}t.setCoordsPoint2D(r),this.m_firstCoincidentVertex=a,n=0}}this.m_nextVertexToProcess=-1,n>0&&this.processBunch_()&&(i=!0),r++>10&&B(``),i&&this.fixOrphanVertices_(),this.cleanupSpikes_()&&(i=!0),e||=i}while(i);return this.m_shape.dbgVerifyMonotone(),this.m_shape.dbgVerifyCurves(),this.m_shape.removeUserIndex(this.m_userIndexSortedIndexToVertex),this.m_shape.removeUserIndex(this.m_userIndexSortedAngleIndexToVertex),e=qp(this.m_shape,this.m_geometry,this.m_sortedVertices,this.m_bFixSelfTangency,this.m_progressTracker)||e,this.m_shape.dbgVerifyCurves(),e}getDirection_(e,t){return this.m_shape.getNextVertex(t)!==e}detectAndResolveCrossOver_(e,t,n,r,i,a,o,s){if(r===o)return this.removeAngleSortInfo_(n),this.removeAngleSortInfo_(a),-1;let c=this.m_shape.getUserIndex(n,this.m_userIndexSortedAngleIndexToVertex),l=this.m_shape.getUserIndex(i,this.m_userIndexSortedAngleIndexToVertex),u=this.m_shape.getUserIndex(a,this.m_userIndexSortedAngleIndexToVertex),d=this.m_shape.getUserIndex(s,this.m_userIndexSortedAngleIndexToVertex),f=H(8,NaN),p=H(4,NaN);f[0]=0,p[0]=c,f[1]=0,p[1]=l,f[2]=1,p[2]=u,f[3]=1,p[3]=d;for(let e=1;e<4;e++){let t=p[e],n=f[e],r=e-1;for(;r>=0&&p[r]>t;)p[r+1]=p[r],f[r+1]=f[r],r--;p[r+1]=t,f[r+1]=n}let m=0;if(f[0]&&(m|=1),f[1]&&(m|=2),f[2]&&(m|=4),f[3]&&(m|=8),m!==5&&m!==10)return 0;if(e!==t&&(s=W(a,a=s)),e)this.m_shape.setNextVertex(s,r),this.m_shape.setPrevVertex(r,s),this.m_shape.setNextVertex(i,o),this.m_shape.setPrevVertex(o,i),this.m_bHasSegmentParentage&&(this.m_shape.setSegmentParentageBreakVertex(r,!0),this.m_shape.setSegmentParentageBreakVertex(o,!0));else{if(this.m_shape.setPrevVertex(s,r),this.m_shape.setNextVertex(r,s),this.m_shape.setPrevVertex(i,o),this.m_shape.setNextVertex(o,i),this.m_bHasSegmentParentage){let e=this.m_shape.getSegmentParentage(r),t=this.m_shape.getSegmentParentage(o);this.m_shape.setSegmentParentageAndBreak(r,t,!0),this.m_shape.setSegmentParentageAndBreak(o,e,!0)}if(this.m_bHasSegments){let e=this.m_shape.getVertexIndex(r),t=this.m_shape.getVertexIndex(o),n=this.m_shape.getSegmentFromIndex(e);this.m_shape.setSegmentToIndex(e,null);let i=this.m_shape.getSegmentFromIndex(t);this.m_shape.setSegmentToIndex(t,null),this.m_shape.setSegmentToIndex(e,i),this.m_shape.setSegmentToIndex(t,n)}}return 1}resolveOverlap_(e,t,n,r,i,a){return this.resolveOverlapOddEven_(e,t,n,r,i,a)}resolveOverlapOddEven_(e,t,n,r,i,a){if(e!==t){e||(i=W(n,n=i),a=W(r,r=a));let t=this.m_shape.getNextVertex(i),o=this.m_shape.getNextVertex(n);if(this.m_shape.setNextVertex(n,t),this.m_shape.setPrevVertex(t,n),this.m_shape.setNextVertex(i,o),this.m_shape.setPrevVertex(o,i),this.m_bHasSegments){let e=this.m_shape.getVertexIndex(n),t=this.m_shape.getVertexIndex(i),r=this.m_shape.getSegmentFromIndex(e);this.m_shape.setSegmentToIndex(e,null);let a=this.m_shape.getSegmentFromIndex(t);this.m_shape.setSegmentToIndex(t,null),this.m_shape.setSegmentToIndex(e,a),this.m_shape.setSegmentToIndex(t,r)}if(this.m_bHasSegmentParentage){let e=this.m_shape.getSegmentParentage(n),t=this.m_shape.getSegmentParentage(i);this.m_shape.setSegmentParentageAndBreak(n,t,!0),this.m_shape.setSegmentParentageAndBreak(i,e,!0),this.m_shape.setSegmentParentageBreakVertex(r,!0),this.m_shape.setSegmentParentageBreakVertex(a,!0)}this.removeSpike_(i)}else{let o=e?n:r,s=t?i:a,c=e?r:n,l=t?a:i,u=null;if(this.m_bHasSegments){let e=this.m_shape.getVertexIndex(l);u=this.m_shape.getSegmentFromIndex(e),this.m_shape.setSegmentToIndex(e,null);let t=this.m_shape.getVertexIndex(s);this.m_shape.setSegmentToIndex(t,null);let n=this.m_shape.getVertexIndex(o);this.m_shape.setSegmentToIndex(n,null)}let d=-1;this.m_bHasSegmentParentage&&(d=this.m_shape.getSegmentParentage(l));let f=!1;this.m_shape.setNextVertex(o,s),this.m_shape.setNextVertex(s,o),this.m_shape.setPrevVertex(c,l),this.m_shape.setPrevVertex(l,c);let p=l;for(;p!==s;){let e=this.m_shape.getPrevVertex(p),t=this.m_shape.getNextVertex(p);if(this.m_shape.setPrevVertex(p,t),this.m_shape.setNextVertex(p,e),f||=p===o,this.m_bHasSegments&&p!==o){let e=this.m_shape.getVertexIndex(t),n=u;u=this.m_shape.getSegmentFromIndex(e),n!==null&&n.reverse(),this.m_shape.setSegmentToIndex(e,n)}if(this.m_bHasSegmentParentage){let e=this.m_shape.getSegmentParentage(t);this.m_shape.setSegmentParentagePreserveBreak(t,d),d=e}p=t}let m=null;if(!f){let e=this.m_shape.getPrevVertex(s),t=this.m_shape.getNextVertex(s);if(this.m_shape.setPrevVertex(s,t),this.m_shape.setNextVertex(s,e),this.m_bHasSegments){let e=this.m_shape.getVertexIndex(s);m=this.m_shape.getSegmentFromIndex(e),this.m_shape.setSegmentToIndex(e,null)}}let h=-1,g=-1;if(this.m_bHasSegmentParentage&&(h=f?this.m_shape.getSegmentParentage(o):this.m_shape.getSegmentParentage(s),g=this.m_shape.getSegmentParentage(c)),this.transferVertexData_(s,o),this.beforeRemoveVertex_(s,!0),this.m_shape.removeVertexInternal(s,!0),this.removeAngleSortInfo_(o),this.transferVertexData_(l,c),this.beforeRemoveVertex_(l,!0),this.m_shape.removeVertexInternal(l,!0),this.removeAngleSortInfo_(c),this.m_bHasSegmentParentage&&(this.m_shape.setSegmentParentageAndBreak(o,h,!0),this.m_shape.setSegmentParentageAndBreak(c,g,!0)),m){let e=this.m_shape.getVertexIndex(o);this.m_shape.setSegmentToIndex(e,m)}}return!0}cleanupSpikes_(){let e=!1;for(let t=this.m_shape.getFirstPath(this.m_geometry);t!==-1;){let n=this.m_shape.getNextPath(t),r=this.m_shape.getFirstVertex(t);for(let n=0,i=this.m_shape.getPathSize(t);n<i&&i>1;){this.progress_();let{v:a,bModified:o}=this.checkAndCleanupSpike_(t,r);if(a===-1)break;o?(e=!0,r=a,n=0,i=this.m_shape.getPathSize(t)):(r=a,n++)}t=n}return e}checkAndCleanupSpike_(e,t){let n={v:-1,bModified:!1},r=this.m_shape.getPrevVertex(t),i=this.m_shape.getNextVertex(t),a=-1,o=-1;for(;this.m_shape.isEqualXY(r,i)&&(a=r,o=i,i!==t);)r=this.m_shape.getPrevVertex(r),i=this.m_shape.getNextVertex(i);if(a===-1)return n.v=i,n;n.bModified=!0;for(let e=this.m_shape.getNextVertex(a);this.beforeRemoveVertex_(e,!1),e!==o;e=this.m_shape.getNextVertex(e));if(a===t)return this.m_polylineDegeneracies===-1?this.m_shape.removePath(e):this.m_shape.movePath(this.m_polylineDegeneracies,-1,e),n.v=-1,n;{let e=this.m_shape.peelALoopIntoAPath(a,o);this.m_polylineDegeneracies===-1?this.m_shape.removePath(e):this.m_shape.movePath(this.m_polylineDegeneracies,-1,e)}return n.v=a,n}removeSpike_(e){let t=this.m_shape.getPrevVertex(e),n=this.m_shape.getNextVertex(e),r=-1,i=-1;for(;this.m_shape.isEqualXY(t,n)&&(r=t,i=n,n!==e);)t=this.m_shape.getPrevVertex(t),n=this.m_shape.getNextVertex(n);if(r===-1)return!1;if(this.m_shape.peelALoop(r,i),this.m_bHasSegmentParentage&&(this.m_shape.setSegmentParentageBreakVertex(r,!0),this.m_shape.setSegmentParentageBreakVertex(i,!0)),this.removeAngleSortInfo_(r),this.m_polylineDegeneracies===-1)for(let e=this.m_shape.getNextVertex(i);;){let t=this.m_shape.getNextVertex(e);if(this.removeAngleSortInfo_(e),this.beforeRemoveVertex_(e,!0),this.m_shape.setSegmentToIndex(this.m_shape.getVertexIndex(e),null),this.m_shape.removeVertexInternal(e,!1),e===i)break;e=t}else{for(let e=i;;){let t=this.m_shape.getNextVertex(e);if(this.removeAngleSortInfo_(e),this.beforeRemoveVertex_(e,!1),e=t,e===i)break}this.m_shape.insertClosedPath(this.m_polylineDegeneracies,-1,i,i,[!1])}return!0}fixOrphanVertices_(){let e=0;for(let e=this.m_sortedVertices.getFirst(this.m_sortedVertices.getFirstList());e!==-1;e=this.m_sortedVertices.getNext(e)){let t=this.m_sortedVertices.getData(e);this.m_shape.setPathToVertex(t,-1)}let t=0;for(let n=this.m_shape.getFirstPath(this.m_geometry);n!==-1;){let r=this.m_shape.getFirstVertex(n);if(r===-1||this.m_shape.getPathFromVertex(r)!==-1){let e=n;n=this.m_shape.getNextPath(n),this.m_shape.removePathOnly(e);continue}this.m_shape.setPathToVertex(r,n);let i=1;for(let e=this.m_shape.getNextVertex(r);e!==r;e=this.m_shape.getNextVertex(e))this.m_shape.setPathToVertex(e,n),i++;this.m_shape.setRingAreaValid(n,!1),this.m_shape.setPathSize(n,i),this.m_shape.setLastVertex(n,this.m_shape.getPrevVertex(r)),t+=i,e++,n=this.m_shape.getNextPath(n)}for(let n=this.m_sortedVertices.getFirst(this.m_sortedVertices.getFirstList());n!==-1;n=this.m_sortedVertices.getNext(n)){let r=this.m_sortedVertices.getData(n);if(this.m_shape.getPathFromVertex(r)!==-1)continue;let i=this.m_shape.insertClosedPath(this.m_geometry,-1,r,r,[!1]);t+=this.m_shape.getPathSize(i),e++}this.m_shape.setGeometryPathCount(this.m_geometry,e),this.m_shape.setGeometryVertexCount(this.m_geometry,t);let n=0;for(let e=this.m_shape.getFirstGeometry();e!==-1;e=this.m_shape.getNextGeometry(e))n+=this.m_shape.getPointCount(e);this.m_shape.setTotalPointCount(n)}getNextEdgeIndex_(e){if(e===-1)return-1;for(let t=0,n=this.m_bunchEdgeIndices.length-1;t<n;t++)if(e=(e+1)%this.m_bunchEdgeIndices.length,this.m_bunchEdgeIndices[e]!==-1)return e;return-1}getPrevEdgeIndex_(e){if(e===-1)return-1;for(let t=0,n=this.m_bunchEdgeIndices.length-1;t<n;t++)if(e=(this.m_bunchEdgeIndices.length+e-1)%this.m_bunchEdgeIndices.length,this.m_bunchEdgeIndices[e]!==-1)return e;return-1}transferVertexData_(e,t){let n=this.m_shape.getUserIndex(t,this.m_userIndexSortedIndexToVertex),r=this.m_shape.getUserIndex(t,this.m_userIndexSortedAngleIndexToVertex);this.m_shape.transferAllDataToTheVertex(e,t),this.m_shape.setUserIndex(t,this.m_userIndexSortedIndexToVertex,n),this.m_shape.setUserIndex(t,this.m_userIndexSortedAngleIndexToVertex,r)}removeAngleSortInfo_(e){let t=this.m_shape.getUserIndex(e,this.m_userIndexSortedAngleIndexToVertex);t!==-1&&(this.m_bunchEdgeIndices[t]=-1,this.m_shape.setUserIndex(e,this.m_userIndexSortedAngleIndexToVertex,-1))}progress_(e=!1){}};function em(e,t,n,r,i,a=!0){switch(rm(r)){case 0:break;case 1:R(`relation string length has to be 9 characters`);break;default:R(`relation string`)}if(a){let a=gm(r,e.getDimension(),t.getDimension());if(a!==0)return Nm(e,t,n,a,i)}let o=0;if(typeof n==`number`)o=n;else{let r=G.constructEmpty();e.queryEnvelope(r);let i=G.constructEmpty();t.queryEnvelope(i);let a=G.constructEmpty();a.setCoords({env2D:r}),a.mergeEnvelope2D(i),o=Rn(n,a,!1)}let s=Dm(e,o),c=Dm(t,o);if(s.isEmpty()||c.isEmpty())return hm(s,c,r);let l=s.getGeometryType(),u=c.getGeometryType(),d=!1;switch(l){case L.enumPolygon:switch(u){case L.enumPolygon:d=im(s,c,o,r,i);break;case L.enumPolyline:d=am(s,c,o,r,i);break;case L.enumPoint:d=um(s,c,o,r);break;case L.enumMultiPoint:d=om(s,c,o,r,i)}break;case L.enumPolyline:switch(u){case L.enumPolygon:d=am(c,s,o,Om(r),i);break;case L.enumPolyline:d=sm(s,c,o,r,i);break;case L.enumPoint:d=dm(s,c,o,r,i);break;case L.enumMultiPoint:d=cm(s,c,o,r,i)}break;case L.enumPoint:switch(u){case L.enumPolygon:d=um(c,s,o,Om(r));break;case L.enumPolyline:d=dm(c,s,o,Om(r),i);break;case L.enumPoint:d=pm(s,c,o,r);break;case L.enumMultiPoint:d=fm(c,s,o,Om(r))}break;case L.enumMultiPoint:switch(u){case L.enumPolygon:d=om(c,s,o,Om(r),i);break;case L.enumPolyline:d=cm(c,s,o,Om(r),i);break;case L.enumMultiPoint:d=lm(s,c,o,r,i);break;case L.enumPoint:d=fm(s,c,o,r)}break;default:d=!1}return d}function tm(e,t,n,r){let i=new Tm;i.resetMatrix_(),i.setPredicates_(`T*****F**`),i.setAreaAreaPredicates_();let a=G.constructEmpty(),o=G.constructEmpty();e.queryEnvelope(a),t.queryEnvelope(o);let s=!1;if(Lm(a,o,n)&&(i.areaAreaDisjointPredicates_(e,t),s=!0),s||Rm(e,t),s)return mm(i.m_matrix,i.m_scl);let c=new os,l=c.addGeometry(e),u=c.addGeometry(t),d=null,f=0;if(e.hasNonLinearSegments()||t.hasNonLinearSegments()){d=new p_;let e=u_(n,c.getEnvelope2D(r));f=f_(e,0),r_(c,e,n,12e3,d,null,r)}h_(c,new En(n,0).add(f),r,!1,!1);let p=c.getGeometry(u).getBoundary();if(c.filterClosePoints(0,!0,!0,!1,-1),Qp(c,l,-1,!1,-1,r),c.getPointCount(l)===0)return!1;Qp(c,u,-1,!1,-1,r),i.setEditShape_(c,r);let m=c.getPointCount(u)===0;if(!m){i.computeMatrixTopoGraphHalfEdges_(l,u),i.m_topoGraph.removeShape();let e=mm(i.m_matrix,i.m_scl);if(!e)return e}let h=c.getGeometry(l);return c=new os,l=c.addGeometry(h),u=c.addGeometry(p),i.setEditShape_(c,r),i.m_predicateCount=0,i.resetMatrix_(),i.setPredicates_(m?`T*****F**`:`******F**`),i.setAreaLinePredicates_(),i.computeMatrixTopoGraphHalfEdges_(l,u),i.m_topoGraph.removeShape(),mm(i.m_matrix,i.m_scl)}function nm(e,t,n,r){let i=new Tm;i.resetMatrix_(),i.setPredicates_(`T*****F**`),i.setAreaLinePredicates_();let a=G.constructEmpty(),o=G.constructEmpty();e.queryEnvelope(a),t.queryEnvelope(o);let s=!1;if(Lm(a,o,n)&&(i.areaLineDisjointPredicates_(e,t),s=!0),s||Rm(e,t),s)return mm(i.m_matrix,i.m_scl);let c=new os,l=c.addGeometry(e),u=c.addGeometry(t);return i.setEditShapeCrackAndCluster_(c,new En(n,0),r),c.getPointCount(l)===0?!1:(i.computeMatrixTopoGraphHalfEdges_(l,u),i.m_topoGraph.removeShape(),mm(i.m_matrix,i.m_scl))}function rm(e){if(e.length!==9)return 1;for(let t=0;t<9;t++){let n=e[t];if(n!==`*`&&n!==`T`&&n!==`F`&&n!==`0`&&n!==`1`&&n!==`2`)return 2}return 0}function im(e,t,n,r,i){let a=new Tm;a.resetMatrix_(),a.setPredicates_(r),a.setAreaAreaPredicates_();let o=G.constructEmpty(),s=G.constructEmpty();e.queryEnvelope(o),t.queryEnvelope(s);let c=!1;if(Lm(o,s,n)&&(a.areaAreaDisjointPredicates_(e,t),c=!0),c||Rm(e,t),!c){let r=new os,o=r.addGeometry(e),s=r.addGeometry(t);a.setEditShapeCrackAndCluster_(r,new En(n,0),i),a.computeMatrixTopoGraphHalfEdges_(o,s),a.m_topoGraph.removeShape()}return mm(a.m_matrix,a.m_scl)}function am(e,t,n,r,i){let a=new Tm;a.resetMatrix_(),a.setPredicates_(r),a.setAreaLinePredicates_();let o=G.constructEmpty(),s=G.constructEmpty();e.queryEnvelope(o),t.queryEnvelope(s);let c=!1;if(Lm(o,s,n)&&(a.areaLineDisjointPredicates_(e,t),c=!0),c||Rm(e,t),!c){let r=new os,o=r.addGeometry(e),s=r.addGeometry(t);a.setEditShapeCrackAndCluster_(r,new En(n,0),i),a.m_clusterIndexB=a.m_topoGraph.createUserIndexForClusters(),wm(s,a.m_topoGraph,a.m_clusterIndexB),a.computeMatrixTopoGraphHalfEdges_(o,s),a.m_topoGraph.deleteUserIndexForClusters(a.m_clusterIndexB),a.m_topoGraph.removeShape()}return mm(a.m_matrix,a.m_scl)}function om(e,t,n,r,i){let a=new Tm;a.resetMatrix_(),a.setPredicates_(r),a.setAreaPointPredicates_();let o=G.constructEmpty(),s=G.constructEmpty();e.queryEnvelope(o),t.queryEnvelope(s);let c=!1;if(Lm(o,s,n)&&(a.areaPointDisjointPredicates_(e),c=!0),c||Rm(e,t),!c){let r=new os,o=r.addGeometry(e),s=r.addGeometry(t);a.setEditShapeCrackAndCluster_(r,new En(n,0),i),a.computeMatrixTopoGraphClusters_(o,s),a.m_topoGraph.removeShape()}return mm(a.m_matrix,a.m_scl)}function sm(e,t,n,r,i){let a=new Tm;a.resetMatrix_(),a.setPredicates_(r),a.setLineLinePredicates_();let o=G.constructEmpty(),s=G.constructEmpty();e.queryEnvelope(o),t.queryEnvelope(s);let c=!1;if(Lm(o,s,n)&&(a.lineLineDisjointPredicates_(e,t),c=!0),c||Rm(e,t),!c){let r=new os,o=r.addGeometry(e),s=r.addGeometry(t);a.setEditShapeCrackAndCluster_(r,new En(n,0),i),a.m_clusterIndexA=a.m_topoGraph.createUserIndexForClusters(),a.m_clusterIndexB=a.m_topoGraph.createUserIndexForClusters(),wm(o,a.m_topoGraph,a.m_clusterIndexA),wm(s,a.m_topoGraph,a.m_clusterIndexB),a.computeMatrixTopoGraphHalfEdges_(o,s),a.m_topoGraph.deleteUserIndexForClusters(a.m_clusterIndexA),a.m_topoGraph.deleteUserIndexForClusters(a.m_clusterIndexB),a.m_topoGraph.removeShape()}return mm(a.m_matrix,a.m_scl)}function cm(e,t,n,r,i){let a=new Tm;a.resetMatrix_(),a.setPredicates_(r),a.setLinePointPredicates_();let o=G.constructEmpty(),s=G.constructEmpty();e.queryEnvelope(o),t.queryEnvelope(s);let c=!1;if(Lm(o,s,n)&&(a.linePointDisjointPredicates_(e),c=!0),c||Rm(e,t),!c){let r=new os,o=r.addGeometry(e),s=r.addGeometry(t);a.setEditShapeCrackAndCluster_(r,new En(n,0),i),a.m_clusterIndexA=a.m_topoGraph.createUserIndexForClusters(),wm(o,a.m_topoGraph,a.m_clusterIndexA),a.computeMatrixTopoGraphClusters_(o,s),a.m_topoGraph.deleteUserIndexForClusters(a.m_clusterIndexA),a.m_topoGraph.removeShape()}return mm(a.m_matrix,a.m_scl)}function lm(e,t,n,r,i){let a=new Tm;a.resetMatrix_(),a.setPredicates_(r),a.setPointPointPredicates_();let o=new G,s=new G;e.queryEnvelope(o),t.queryEnvelope(s);let c=!1;if(Lm(o,s,n)&&(a.pointPointDisjointPredicates_(),c=!0),!c){let r=new os,o=r.addGeometry(e),s=r.addGeometry(t);a.setEditShapeCrackAndCluster_(r,new En(n,0),i),a.computeMatrixTopoGraphClusters_(o,s),a.m_topoGraph.removeShape()}return mm(a.m_matrix,a.m_scl)}function um(e,t,n,r,i){let a=new Tm;a.resetMatrix_(),a.setPredicates_(r),a.setAreaPointPredicates_();let o=G.constructEmpty();e.queryEnvelope(o);let s=t.getXY(),c=!1;if(zm(s,o,n)&&(a.areaPointDisjointPredicates_(e),c=!0),!c){let t=Hg(e,s,n);if(t===1)a.m_matrix[0]=0,a.m_matrix[2]=2,a.m_matrix[3]=-1,a.m_matrix[5]=1,a.m_matrix[6]=-1;else if(t===2)if(a.m_matrix[6]=-1,e.calculateArea2D()!==0)a.m_matrix[0]=-1,a.m_matrix[3]=0,a.m_matrix[2]=2,a.m_matrix[5]=1;else{a.m_matrix[0]=0,a.m_matrix[3]=-1,a.m_matrix[5]=-1;let t=G.constructEmpty();e.queryEnvelope(t),a.m_matrix[2]=t.height()||t.width()?1:-1}else a.areaPointDisjointPredicates_(e)}return mm(a.m_matrix,r)}function dm(e,t,n,r,i){let a=new Tm;a.resetMatrix_(),a.setPredicates_(r),a.setLinePointPredicates_();let o=G.constructEmpty();e.queryEnvelope(o);let s=!1;if(zm(t.getXY(),o,n)&&(a.linePointDisjointPredicates_(e),s=!0),!s){let r=null,o=!1,s=!1;if((a.m_performPredicates[0]||a.m_performPredicates[6])&&(Nm(e,t,n,4,i)?(a.m_matrix[0]=-1,a.m_matrix[6]=0):(a.m_performPredicates[0]&&(r=Ui(e),s=!Nm(r,t,n,4,i),o=!0,a.m_matrix[0]=s?-1:0),a.m_matrix[6]=-1)),a.m_performPredicates[3]&&(r!==null&&r.isEmpty()?a.m_matrix[3]=-1:(o||=(r??=Ui(e),s=!Nm(r,t,n,4,i),!0),a.m_matrix[3]=s?0:-1)),a.m_performPredicates[5])if(r!==null&&r.isEmpty())a.m_matrix[5]=-1;else if(o&&!s)a.m_matrix[5]=0;else{r===null&&(r=Ui(e));let o=Nm(r,t,n,3,i);a.m_matrix[5]=o?-1:0}if(a.m_performPredicates[2])if(e.calculateLength2D()!==0)a.m_matrix[2]=1;else{let r=new ii({vd:e.getDescription()});r.addPoints(e,0,e.getPointCount());let o=Nm(r,t,n,3,i);a.m_matrix[2]=o?-1:0}}return mm(a.m_matrix,a.m_scl)}function fm(e,t,n,r,i){let a=new Tm;a.resetMatrix_(),a.setPredicates_(r),a.setPointPointPredicates_();let o=G.constructEmpty();e.queryEnvelope(o);let s=t.getXY(),c=new z,l=!1;if(zm(s,o,n)&&(a.pointPointDisjointPredicates_(),l=!0),!l){let t=!1,r=!0,i=n*n;for(let n=0;n<e.getPointCount()&&(e.queryXY(n,c),z.sqrDistance(c,s)<=i?t=!0:r=!1,!t||r);n++);t?(a.m_matrix[0]=0,a.m_matrix[2]=r?-1:0,a.m_matrix[6]=-1):(a.m_matrix[0]=-1,a.m_matrix[2]=0,a.m_matrix[6]=0)}return mm(a.m_matrix,r)}function pm(e,t,n,r,i){let a=e.getXY(),o=t.getXY(),s=H(9,-1);return z.sqrDistance(a,o)<=n*n?s[0]=0:(s[2]=0,s[6]=0),s[8]=2,mm(s,r)}function mm(e,t){for(let n=0;n<9;n++)switch(t[n]){case`T`:if(e[n]===-1)return!1;break;case`F`:if(e[n]!==-1)return!1;break;case`0`:if(e[n]!==0)return!1;break;case`1`:if(e[n]!==1)return!1;break;case`2`:if(e[n]!==2)return!1}return!0}function hm(e,t,n){let r=H(9,-1);if(e.isEmpty()&&t.isEmpty())return mm(r,n);let i,a=!1;e.isEmpty()?(i=t,a=!0):i=e,r[0]=-1,r[1]=-1,r[3]=-1,r[4]=-1,r[6]=-1,r[7]=-1,r[8]=2;let o=i.getGeometryType();if(V(o))if(o===L.enumPolygon)if(i.calculateArea2D()!==0)r[2]=2,r[5]=1;else{r[5]=-1;let e=G.constructEmpty();i.queryEnvelope(e),r[2]=e.height()||e.width()?1:0}else r[2]=i.calculateLength2D()===0?0:1,r[5]=Hi(i)?0:-1;else r[2]=0,r[5]=-1;return a&&Em(r),mm(r,n)}function gm(e,t,n){return _m(e)?3:vm(e)?4:ym(e,t,n)?8:bm(e,t,n)?16:Sm(e)?64:xm(e)?1:Cm(e,t,n)?32:0}function _m(e){return e===`T*F**FFF*`}function vm(e){return e===`FF*FF****`}function ym(e,t,n){return(t!==0||n!==0)&&(t===2&&n===2?e===`F***T****`:(t===2||t===1)&&n===0&&e===`F**T*****`)}function bm(e,t,n){return t>n?e===`T*****T**`:t===1&&n===1&&e===`0********`}function xm(e){return e===`T*****FF*`}function Sm(e){return e===`T**FF*FF*`}function Cm(e,t,n){return t===n&&(t===1?e===`1*T***T**`:e===`T*T***T**`)}function wm(e,t,n){let r=t.getGeometryID(e);for(let e=t.getFirstCluster();e!==-1;e=t.getNextCluster(e)){if((t.getClusterParentage(e)&r)===0)continue;let i=t.getClusterHalfEdge(e);if(i===-1){t.setClusterUserIndex(e,n,0);continue}let a=i,o=0;do{let e=a;(t.getHalfEdgeParentage(e)&r)!==0&&o++,a=t.getHalfEdgeNext(t.getHalfEdgeTwin(e))}while(a!==i);t.setClusterUserIndex(e,n,o)}}var Tm=class{nullFunc(){return B(`should not be called`),!1}constructor(){this.m_clusterIndexA=-1,this.m_clusterIndexB=-1,this.m_visitedIndex=-1,this.m_topoGraph=new np,this.m_matrix=H(9,0),this.m_maxDim=H(9,0),this.m_performPredicates=H(9,!1),this.m_scl=``,this.m_predicateCount=0,this.m_predicatesHalfEdge=this.nullFunc,this.m_predicatesCluster=this.nullFunc}resetMatrix_(){this.m_matrix.fill(-2),this.m_maxDim.fill(-2)}setPredicates_(e){this.m_scl=e;for(let e=0;e<9;e++)this.m_scl[e]===`*`?this.m_performPredicates[e]=!1:(this.m_performPredicates[e]=!0,this.m_predicateCount++)}setRemainingPredicatesToFalse_(){for(let e=0;e<9;e++)this.m_performPredicates[e]&&this.m_matrix[e]===-2&&(this.m_matrix[e]=-1,this.m_performPredicates[e]=!1)}isPredicateKnown_(e){return this.m_matrix[e]!==-2&&(this.m_matrix[e]===-1?(this.m_performPredicates[e]=!1,this.m_predicateCount--,!0):this.m_scl[e]!==`T`&&this.m_scl[e]!==`F`?!(this.m_matrix[e]<this.m_maxDim[e])&&(this.m_performPredicates[e]=!1,this.m_predicateCount--,!0):(this.m_performPredicates[e]=!1,this.m_predicateCount--,!0))}setAreaAreaPredicates_(){this.m_predicatesHalfEdge=this.areaAreaPredicates_,this.m_maxDim[0]=2,this.m_maxDim[1]=1,this.m_maxDim[2]=2,this.m_maxDim[3]=1,this.m_maxDim[4]=1,this.m_maxDim[5]=1,this.m_maxDim[6]=2,this.m_maxDim[7]=1,this.m_maxDim[8]=2,this.m_performPredicates[8]&&(this.m_matrix[8]=2,this.m_performPredicates[8]=!1,this.m_predicateCount--)}setAreaLinePredicates_(){this.m_predicatesHalfEdge=this.areaLinePredicates_,this.m_predicatesCluster=this.areaPointPredicates_,this.m_maxDim[0]=1,this.m_maxDim[1]=0,this.m_maxDim[2]=2,this.m_maxDim[3]=1,this.m_maxDim[4]=0,this.m_maxDim[5]=1,this.m_maxDim[6]=1,this.m_maxDim[7]=0,this.m_maxDim[8]=2,this.m_performPredicates[8]&&(this.m_matrix[8]=2,this.m_performPredicates[8]=!1,this.m_predicateCount--)}setLineLinePredicates_(){this.m_predicatesHalfEdge=this.lineLinePredicates_,this.m_predicatesCluster=this.linePointPredicates_,this.m_maxDim[0]=1,this.m_maxDim[1]=0,this.m_maxDim[2]=1,this.m_maxDim[3]=0,this.m_maxDim[4]=0,this.m_maxDim[5]=0,this.m_maxDim[6]=1,this.m_maxDim[7]=0,this.m_maxDim[8]=2,this.m_performPredicates[8]&&(this.m_matrix[8]=2,this.m_performPredicates[8]=!1,this.m_predicateCount--)}setAreaPointPredicates_(){this.m_predicatesCluster=this.areaPointPredicates_,this.m_maxDim[0]=0,this.m_maxDim[1]=-1,this.m_maxDim[2]=2,this.m_maxDim[3]=0,this.m_maxDim[4]=-1,this.m_maxDim[5]=1,this.m_maxDim[6]=0,this.m_maxDim[7]=-1,this.m_maxDim[8]=2,this.m_performPredicates[1]&&(this.m_matrix[1]=-1,this.m_performPredicates[1]=!1,this.m_predicateCount--),this.m_performPredicates[4]&&(this.m_matrix[4]=-1,this.m_performPredicates[4]=!1,this.m_predicateCount--),this.m_performPredicates[7]&&(this.m_matrix[7]=-1,this.m_performPredicates[7]=!1,this.m_predicateCount--),this.m_performPredicates[8]&&(this.m_matrix[8]=2,this.m_performPredicates[8]=!1,this.m_predicateCount--)}setLinePointPredicates_(){this.m_predicatesCluster=this.linePointPredicates_,this.m_maxDim[0]=0,this.m_maxDim[1]=-1,this.m_maxDim[2]=1,this.m_maxDim[3]=0,this.m_maxDim[4]=-1,this.m_maxDim[5]=0,this.m_maxDim[6]=0,this.m_maxDim[7]=-1,this.m_maxDim[8]=2,this.m_performPredicates[1]&&(this.m_matrix[1]=-1,this.m_performPredicates[1]=!1,this.m_predicateCount--),this.m_performPredicates[4]&&(this.m_matrix[4]=-1,this.m_performPredicates[4]=!1,this.m_predicateCount--),this.m_performPredicates[7]&&(this.m_matrix[7]=-1,this.m_performPredicates[7]=!1,this.m_predicateCount--),this.m_performPredicates[8]&&(this.m_matrix[8]=2,this.m_performPredicates[8]=!1,this.m_predicateCount--)}setPointPointPredicates_(){this.m_predicatesCluster=this.pointPointPredicates_,this.m_maxDim[0]=0,this.m_maxDim[1]=-1,this.m_maxDim[2]=0,this.m_maxDim[3]=-1,this.m_maxDim[4]=-1,this.m_maxDim[5]=-1,this.m_maxDim[6]=0,this.m_maxDim[7]=-1,this.m_maxDim[8]=2,this.m_performPredicates[1]&&(this.m_matrix[1]=-1,this.m_performPredicates[1]=!1,this.m_predicateCount--),this.m_performPredicates[3]&&(this.m_matrix[3]=-1,this.m_performPredicates[3]=!1,this.m_predicateCount--),this.m_performPredicates[4]&&(this.m_matrix[4]=-1,this.m_performPredicates[4]=!1,this.m_predicateCount--),this.m_performPredicates[5]&&(this.m_matrix[5]=-1,this.m_performPredicates[5]=!1,this.m_predicateCount--),this.m_performPredicates[7]&&(this.m_matrix[7]=-1,this.m_performPredicates[7]=!1,this.m_predicateCount--),this.m_performPredicates[8]&&(this.m_matrix[8]=2,this.m_performPredicates[8]=!1,this.m_predicateCount--)}areaAreaDisjointPredicates_(e,t){this.m_matrix[0]=-1,this.m_matrix[1]=-1,this.m_matrix[3]=-1,this.m_matrix[4]=-1,this.areaGeomContainsOrDisjointPredicates_(e,this.m_performPredicates[2]?2:-1,this.m_scl[2],this.m_performPredicates[5]?5:-1,this.m_scl[5]),this.areaGeomContainsOrDisjointPredicates_(t,this.m_performPredicates[6]?6:-1,this.m_scl[6],this.m_performPredicates[7]?7:-1,this.m_scl[7])}areaGeomContainsOrDisjointPredicates_(e,t,n,r,i){let a=t!==-1,o=r!==-1;if(a||o){if(!(n!==`T`&&n!==`F`&&a||i!==`T`&&i!==`F`&&o)||e.calculateArea2D()!==0)a&&(this.m_matrix[t]=2),o&&(this.m_matrix[r]=1);else if(o&&(this.m_matrix[r]=-1),a){let n=G.constructEmpty();e.queryEnvelope(n),this.m_matrix[t]=n.height()||n.width()?1:0}}}areaAreaContainsPredicates_(e){this.m_matrix[2]=2,this.m_matrix[3]=-1,this.m_matrix[4]=-1,this.m_matrix[5]=1,this.m_matrix[6]=-1,this.m_matrix[7]=-1,this.areaGeomContainsOrDisjointPredicates_(e,this.m_performPredicates[0]?0:-1,this.m_scl[0],this.m_performPredicates[1]?1:-1,this.m_scl[1])}areaAreaWithinPredicates_(e){this.areaAreaContainsPredicates_(e),Em(this.m_matrix)}areaLineDisjointPredicates_(e,t){if(this.m_matrix[0]=-1,this.m_matrix[1]=-1,this.m_matrix[3]=-1,this.m_matrix[4]=-1,this.m_performPredicates[6]){let e=this.m_scl[6],n=e===`T`||e===`F`||t.calculateLength2D()!==0;this.m_matrix[6]=n?1:0}if(this.m_performPredicates[7]){let e=Hi(t);this.m_matrix[7]=e?0:-1}this.areaGeomContainsOrDisjointPredicates_(e,this.m_performPredicates[2]?2:-1,this.m_scl[2],this.m_performPredicates[5]?5:-1,this.m_scl[5])}areaLineContainsPredicates_(e,t){if(this.m_performPredicates[0]){let e=this.m_scl[0],n=e===`T`||e===`F`||t.calculateLength2D()!==0;this.m_matrix[0]=n?1:0}if(this.m_performPredicates[1]){let e=Hi(t);this.m_matrix[1]=e?0:-1}this.m_matrix[2]=2,this.m_matrix[3]=-1,this.m_matrix[4]=-1,this.m_matrix[5]=1,this.m_matrix[6]=-1,this.m_matrix[7]=-1}areaPointDisjointPredicates_(e){this.m_matrix[0]=-1,this.m_matrix[3]=-1,this.m_matrix[6]=0,this.areaGeomContainsOrDisjointPredicates_(e,this.m_performPredicates[2]?2:-1,this.m_scl[2],this.m_performPredicates[5]?5:-1,this.m_scl[5])}areaPointContainsPredicates_(e){this.m_matrix[0]=0,this.m_matrix[2]=2,this.m_matrix[3]=-1,this.m_matrix[5]=1,this.m_matrix[6]=-1}lineLineDisjointPredicates_(e,t){if(this.m_matrix[0]=-1,this.m_matrix[1]=-1,this.m_matrix[3]=-1,this.m_matrix[4]=-1,this.m_performPredicates[2]){let t=this.m_scl[2],n=t===`T`||t===`F`||e.calculateLength2D()!==0;this.m_matrix[2]=n?1:0}if(this.m_performPredicates[5]){let t=Hi(e);this.m_matrix[5]=t?0:-1}if(this.m_performPredicates[6]){let e=this.m_scl[6],n=e===`T`||e===`F`||t.calculateLength2D()!==0;this.m_matrix[6]=n?1:0}if(this.m_performPredicates[7]){let e=Hi(t);this.m_matrix[7]=e?0:-1}}linePointDisjointPredicates_(e){if(this.m_matrix[0]=-1,this.m_matrix[3]=-1,this.m_performPredicates[2]){let t=this.m_scl[2],n=t===`T`||t===`F`||e.calculateLength2D()!==0;this.m_matrix[2]=n?1:0}if(this.m_performPredicates[5]){let t=Hi(e);this.m_matrix[5]=t?0:-1}this.m_matrix[6]=0}pointPointDisjointPredicates_(){this.m_matrix[0]=-1,this.m_matrix[2]=0,this.m_matrix[6]=0}areaAreaPredicates_(e,t,n){let r=!0;if(this.m_performPredicates[0]){this.interiorAreaInteriorArea_(e,t,n);let i=this.isPredicateKnown_(0);r&&=i}if(this.m_performPredicates[1]){this.interiorAreaBoundaryArea_(e,t,1);let n=this.isPredicateKnown_(1);r&&=n}if(this.m_performPredicates[2]){this.interiorAreaExteriorArea_(e,t,n,2);let i=this.isPredicateKnown_(2);r&&=i}if(this.m_performPredicates[3]){this.interiorAreaBoundaryArea_(e,n,3);let t=this.isPredicateKnown_(3);r&&=t}if(this.m_performPredicates[4]){this.boundaryAreaBoundaryArea_(e,t,n);let i=this.isPredicateKnown_(4);r&&=i}if(this.m_performPredicates[5]){this.boundaryAreaExteriorArea_(e,t,n,5);let i=this.isPredicateKnown_(5);r&&=i}if(this.m_performPredicates[6]){this.interiorAreaExteriorArea_(e,n,t,6);let i=this.isPredicateKnown_(6);r&&=i}if(this.m_performPredicates[7]){this.boundaryAreaExteriorArea_(e,n,t,7);let i=this.isPredicateKnown_(7);r&&=i}return r}areaLinePredicates_(e,t,n){let r=!0;if(this.m_performPredicates[0]){this.interiorAreaInteriorLine_(e,t,n);let i=this.isPredicateKnown_(0);r&&=i}if(this.m_performPredicates[1]){this.interiorAreaBoundaryLine_(e,t,n,this.m_clusterIndexB);let i=this.isPredicateKnown_(1);r&&=i}if(this.m_performPredicates[2]){this.interiorAreaExteriorLine_(e,t,n);let i=this.isPredicateKnown_(2);r&&=i}if(this.m_performPredicates[3]){this.boundaryAreaInteriorLine_(e,t,n,this.m_clusterIndexB);let i=this.isPredicateKnown_(3);r&&=i}if(this.m_performPredicates[4]){this.boundaryAreaBoundaryLine_(e,t,n,this.m_clusterIndexB);let i=this.isPredicateKnown_(4);r&&=i}if(this.m_performPredicates[5]){this.boundaryAreaExteriorLine_(e,t,n);let i=this.isPredicateKnown_(5);r&&=i}if(this.m_performPredicates[6]){this.exteriorAreaInteriorLine_(e,t);let n=this.isPredicateKnown_(6);r&&=n}if(this.m_performPredicates[7]){this.exteriorAreaBoundaryLine_(e,t,n,this.m_clusterIndexB);let i=this.isPredicateKnown_(7);r&&=i}return r}lineLinePredicates_(e,t,n){let r=!0;if(this.m_performPredicates[0]){this.interiorLineInteriorLine_(e,t,n,this.m_clusterIndexA,this.m_clusterIndexB);let i=this.isPredicateKnown_(0);r&&=i}if(this.m_performPredicates[1]){this.interiorLineBoundaryLine_(e,t,n,this.m_clusterIndexA,this.m_clusterIndexB,1);let i=this.isPredicateKnown_(1);r&&=i}if(this.m_performPredicates[2]){this.interiorLineExteriorLine_(e,t,n,2);let i=this.isPredicateKnown_(2);r&&=i}if(this.m_performPredicates[3]){this.interiorLineBoundaryLine_(e,n,t,this.m_clusterIndexB,this.m_clusterIndexA,3);let i=this.isPredicateKnown_(3);r&&=i}if(this.m_performPredicates[4]){this.boundaryLineBoundaryLine_(e,t,n,this.m_clusterIndexA,this.m_clusterIndexB);let i=this.isPredicateKnown_(4);r&&=i}if(this.m_performPredicates[5]){this.boundaryLineExteriorLine_(e,t,n,this.m_clusterIndexA,5);let i=this.isPredicateKnown_(5);r&&=i}if(this.m_performPredicates[6]){this.interiorLineExteriorLine_(e,n,t,6);let i=this.isPredicateKnown_(6);r&&=i}if(this.m_performPredicates[7]){this.boundaryLineExteriorLine_(e,n,t,this.m_clusterIndexB,7);let i=this.isPredicateKnown_(7);r&&=i}return r}areaPointPredicates_(e,t,n){let r=!0;if(this.m_performPredicates[0]){this.interiorAreaInteriorPoint_(e,t);let n=this.isPredicateKnown_(0);r&&=n}if(this.m_performPredicates[2]){this.interiorAreaExteriorPoint_(e,t);let n=this.isPredicateKnown_(2);r&&=n}if(this.m_performPredicates[3]){this.boundaryAreaInteriorPoint_(e,t,n);let i=this.isPredicateKnown_(3);r&&=i}if(this.m_performPredicates[5]){this.boundaryAreaExteriorPoint_(e,t);let n=this.isPredicateKnown_(5);r&&=n}if(this.m_performPredicates[6]){this.exteriorAreaInteriorPoint_(e,t);let n=this.isPredicateKnown_(6);r&&=n}return r}linePointPredicates_(e,t,n){let r=!0;if(this.m_performPredicates[0]){this.interiorLineInteriorPoint_(e,t,n,this.m_clusterIndexA);let i=this.isPredicateKnown_(0);r&&=i}if(this.m_performPredicates[2]){this.interiorLineExteriorPoint_(e,t,n,this.m_clusterIndexA);let i=this.isPredicateKnown_(2);r&&=i}if(this.m_performPredicates[3]){this.boundaryLineInteriorPoint_(e,t,n,this.m_clusterIndexA);let i=this.isPredicateKnown_(3);r&&=i}if(this.m_performPredicates[5]){this.boundaryLineExteriorPoint_(e,t,n,this.m_clusterIndexA);let i=this.isPredicateKnown_(5);r&&=i}if(this.m_performPredicates[6]){this.exteriorLineInteriorPoint_(e,t,n);let i=this.isPredicateKnown_(6);r&&=i}return r}pointPointPredicates_(e,t,n){let r=!0;if(this.m_performPredicates[0]){this.interiorPointInteriorPoint_(e,t,n);let i=this.isPredicateKnown_(0);r&&=i}if(this.m_performPredicates[2]){this.interiorPointExteriorPoint_(e,t,n,2);let i=this.isPredicateKnown_(2);r&&=i}if(this.m_performPredicates[6]){this.interiorPointExteriorPoint_(e,n,t,6);let i=this.isPredicateKnown_(6);r&&=i}return r}interiorAreaInteriorArea_(e,t,n){if(this.m_matrix[0]===2)return;let r=this.m_topoGraph.getHalfEdgeFaceParentage(e);(r&t)!==0&&(r&n)!==0&&(this.m_matrix[0]=2)}interiorAreaBoundaryArea_(e,t,n){if(this.m_matrix[n]===1)return;let r=this.m_topoGraph.getHalfEdgeFaceParentage(e),i=this.m_topoGraph.getHalfEdgeFaceParentage(this.m_topoGraph.getHalfEdgeTwin(e));(r&t)!==0&&(i&t)!==0&&(this.m_matrix[n]=1)}interiorAreaExteriorArea_(e,t,n,r){if(this.m_matrix[r]===2)return;let i=this.m_topoGraph.getHalfEdgeFaceParentage(e);(i&t)!==0&&(i&n)===0&&(this.m_matrix[r]=2)}boundaryAreaBoundaryArea_(e,t,n){if(this.m_matrix[4]===1)return;let r=this.m_topoGraph.getHalfEdgeParentage(e);if((r&t)===0||(r&n)===0){if(this.m_matrix[4]!==0&&this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(e)),this.m_visitedIndex)!==1){let r=this.m_topoGraph.getHalfEdgeTo(e),i=this.m_topoGraph.getClusterParentage(r);if((i&t)!==0&&(i&n)!==0)return void(this.m_matrix[4]=0)}}else this.m_matrix[4]=1}boundaryAreaExteriorArea_(e,t,n,r){if(this.m_matrix[r]===1)return;let i=this.m_topoGraph.getHalfEdgeFaceParentage(e),a=this.m_topoGraph.getHalfEdgeFaceParentage(this.m_topoGraph.getHalfEdgeTwin(e));(i&n)===0&&(a&n)===0&&(this.m_matrix[r]=1)}interiorAreaInteriorLine_(e,t,n){if(this.m_matrix[0]===1)return;let r=this.m_topoGraph.getHalfEdgeFaceParentage(e),i=this.m_topoGraph.getHalfEdgeFaceParentage(this.m_topoGraph.getHalfEdgeTwin(e));(r&t)!==0&&(i&t)!==0&&(this.m_matrix[0]=1)}interiorAreaBoundaryLine_(e,t,n,r){if(this.m_matrix[1]!==0&&this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(e)),this.m_visitedIndex)!==1){let i=this.m_topoGraph.getHalfEdgeTo(e),a=this.m_topoGraph.getClusterParentage(i);if((a&t)===0&&(this.m_topoGraph.getHalfEdgeFaceParentage(e)&t)!==0){let e=this.m_topoGraph.getClusterUserIndex(i,r);if((a&n)!==0&&e%2!=0)return void(this.m_matrix[1]=0)}}}interiorAreaExteriorLine_(e,t,n){this.m_matrix[2]!==2&&(this.m_topoGraph.getHalfEdgeParentage(e)&t)!==0&&(this.m_matrix[2]=2)}boundaryAreaInteriorLine_(e,t,n,r){if(this.m_matrix[3]===1)return;let i=this.m_topoGraph.getHalfEdgeParentage(e);if((i&t)===0||(i&n)===0){if(this.m_matrix[3]!==0&&this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(e)),this.m_visitedIndex)!==1){let i=this.m_topoGraph.getHalfEdgeTo(e),a=this.m_topoGraph.getClusterParentage(i);if((a&t)!==0){let e=this.m_topoGraph.getClusterUserIndex(i,r);if((a&n)!==0&&e%2==0)return void(this.m_matrix[3]=0)}}}else this.m_matrix[3]=1}boundaryAreaBoundaryLine_(e,t,n,r){if(this.m_matrix[4]!==0&&this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(e)),this.m_visitedIndex)!==1){let i=this.m_topoGraph.getHalfEdgeTo(e),a=this.m_topoGraph.getClusterParentage(i);if((a&t)!==0){let e=this.m_topoGraph.getClusterUserIndex(i,r);if((a&n)!==0&&e%2!=0)return void(this.m_matrix[4]=0)}}}boundaryAreaExteriorLine_(e,t,n){if(this.m_matrix[5]===1)return;let r=this.m_topoGraph.getHalfEdgeParentage(e);(r&t)!==0&&(r&n)===0&&(this.m_matrix[5]=1)}exteriorAreaInteriorLine_(e,t){if(this.m_matrix[6]===1)return;let n=this.m_topoGraph.getHalfEdgeFaceParentage(e),r=this.m_topoGraph.getHalfEdgeFaceParentage(this.m_topoGraph.getHalfEdgeTwin(e));(n&t)===0&&(r&t)===0&&(this.m_matrix[6]=1)}exteriorAreaBoundaryLine_(e,t,n,r){if(this.m_matrix[7]!==0&&this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(e)),this.m_visitedIndex)!==1){let i=this.m_topoGraph.getHalfEdgeTo(e),a=this.m_topoGraph.getClusterParentage(i);if((a&t)===0&&(this.m_topoGraph.getHalfEdgeFaceParentage(e)&t)===0){let e=this.m_topoGraph.getClusterUserIndex(i,r);if((a&n)!==0&&e%2!=0)return void(this.m_matrix[7]=0)}}}interiorLineInteriorLine_(e,t,n,r,i){if(this.m_matrix[0]===1)return;let a=this.m_topoGraph.getHalfEdgeParentage(e);if((a&t)===0||(a&n)===0){if(this.m_matrix[0]!==0&&this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(e)),this.m_visitedIndex)!==1){let a=this.m_topoGraph.getHalfEdgeTo(e),o=this.m_topoGraph.getClusterParentage(a);if((o&t)!==0&&(o&n)!==0){let e=this.m_topoGraph.getClusterUserIndex(a,r),t=this.m_topoGraph.getClusterUserIndex(a,i);if(e%2==0&&t%2==0)return void(this.m_matrix[0]=0)}}}else this.m_matrix[0]=1}interiorLineBoundaryLine_(e,t,n,r,i,a){if(this.m_matrix[a]!==0&&this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(e)),this.m_visitedIndex)!==1){let o=this.m_topoGraph.getHalfEdgeTo(e),s=this.m_topoGraph.getClusterParentage(o);if((s&t)!==0&&(s&n)!==0){let e=this.m_topoGraph.getClusterUserIndex(o,r),t=this.m_topoGraph.getClusterUserIndex(o,i);if(e%2==0&&t%2!=0)return void(this.m_matrix[a]=0)}}}interiorLineExteriorLine_(e,t,n,r){if(this.m_matrix[r]===1)return;let i=this.m_topoGraph.getHalfEdgeParentage(e);(i&t)!==0&&(i&n)===0&&(this.m_matrix[r]=1)}boundaryLineBoundaryLine_(e,t,n,r,i){if(this.m_matrix[4]!==0&&this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(e)),this.m_visitedIndex)!==1){let a=this.m_topoGraph.getHalfEdgeTo(e),o=this.m_topoGraph.getClusterParentage(a);if((o&t)!==0&&(o&n)!==0){let e=this.m_topoGraph.getClusterUserIndex(a,r),t=this.m_topoGraph.getClusterUserIndex(a,i);if(e%2!=0&&t%2!=0)return void(this.m_matrix[4]=0)}}}boundaryLineExteriorLine_(e,t,n,r,i){if(this.m_matrix[i]!==0&&this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(e)),this.m_visitedIndex)!==1){let t=this.m_topoGraph.getHalfEdgeTo(e);if((this.m_topoGraph.getClusterParentage(t)&n)===0&&this.m_topoGraph.getClusterUserIndex(t,r)%2!=0)return void(this.m_matrix[i]=0)}}interiorAreaInteriorPoint_(e,t){if(this.m_matrix[0]!==0&&(this.m_topoGraph.getClusterParentage(e)&t)===0){let n=this.m_topoGraph.getClusterChain(e);if((this.m_topoGraph.getChainParentage(n)&t)!==0)return void(this.m_matrix[0]=0)}}interiorAreaExteriorPoint_(e,t){this.m_matrix[2]!==2&&(this.m_topoGraph.getClusterParentage(e)&t)!==0&&(this.m_matrix[2]=2)}boundaryAreaInteriorPoint_(e,t,n){if(this.m_matrix[3]===0)return;let r=this.m_topoGraph.getClusterParentage(e);(r&t)===0||(r&n)===0||(this.m_matrix[3]=0)}boundaryAreaExteriorPoint_(e,t){this.m_matrix[5]!==1&&(this.m_topoGraph.getClusterParentage(e)&t)!==0&&(this.m_matrix[5]=1)}exteriorAreaInteriorPoint_(e,t){if(this.m_matrix[6]!==0&&(this.m_topoGraph.getClusterParentage(e)&t)===0){let n=this.m_topoGraph.getClusterChain(e);if((this.m_topoGraph.getChainParentage(n)&t)===0)return void(this.m_matrix[6]=0)}}interiorLineInteriorPoint_(e,t,n,r){if(this.m_matrix[0]===0)return;let i=this.m_topoGraph.getClusterParentage(e);if((i&t)!==0&&(i&n)!==0&&this.m_topoGraph.getClusterUserIndex(e,r)%2==0)return void(this.m_matrix[0]=0)}interiorLineExteriorPoint_(e,t,n,r){if(this.m_matrix[2]!==1)if(this.m_topoGraph.getClusterHalfEdge(e)===-1){if(this.m_matrix[2]!==0&&(this.m_topoGraph.getClusterParentage(e)&n)===0)return void(this.m_matrix[2]=0)}else this.m_matrix[2]=1}boundaryLineInteriorPoint_(e,t,n,r){if(this.m_matrix[3]===0)return;let i=this.m_topoGraph.getClusterParentage(e);if((i&t)!==0&&(i&n)!==0&&this.m_topoGraph.getClusterUserIndex(e,r)%2!=0)return void(this.m_matrix[3]=0)}boundaryLineExteriorPoint_(e,t,n,r){if(this.m_matrix[5]===0)return;let i=this.m_topoGraph.getClusterParentage(e);if((i&t)!==0&&(i&n)===0&&this.m_topoGraph.getClusterUserIndex(e,r)%2!=0)return void(this.m_matrix[5]=0)}exteriorLineInteriorPoint_(e,t,n){if(this.m_matrix[6]===0)return;let r=this.m_topoGraph.getClusterParentage(e);(r&t)!==0||(r&n)===0||(this.m_matrix[6]=0)}interiorPointInteriorPoint_(e,t,n){if(this.m_matrix[0]===0)return;let r=this.m_topoGraph.getClusterParentage(e);(r&t)===0||(r&n)===0||(this.m_matrix[0]=0)}interiorPointExteriorPoint_(e,t,n,r){if(this.m_matrix[r]===0)return;let i=this.m_topoGraph.getClusterParentage(e);(i&t)===0||(i&n)!==0||(this.m_matrix[r]=0)}computeMatrixTopoGraphHalfEdges_(e,t){let n=!1,r=this.m_topoGraph.getGeometryID(e),i=this.m_topoGraph.getGeometryID(t);this.m_visitedIndex=this.m_topoGraph.createUserIndexForHalfEdges();for(let e=this.m_topoGraph.getFirstCluster();e!==-1;e=this.m_topoGraph.getNextCluster(e)){let t=this.m_topoGraph.getClusterHalfEdge(e);if(t===-1){if(this.m_predicatesCluster!==null&&(n=this.m_predicatesCluster(e,r,i),n))break;continue}let a=t;do{let e=a;if(this.m_topoGraph.getHalfEdgeUserIndex(e,this.m_visitedIndex)!==1)do{if(n=this.m_predicatesHalfEdge(e,r,i),n)break;this.m_topoGraph.setHalfEdgeUserIndex(e,this.m_visitedIndex,1),e=this.m_topoGraph.getHalfEdgeNext(e)}while(e!==a&&!n);if(n)break;a=this.m_topoGraph.getHalfEdgeNext(this.m_topoGraph.getHalfEdgeTwin(e))}while(a!==t);if(n)break}n||this.setRemainingPredicatesToFalse_(),this.m_topoGraph.deleteUserIndexForHalfEdges(this.m_visitedIndex)}computeMatrixTopoGraphClusters_(e,t){let n=!1,r=this.m_topoGraph.getGeometryID(e),i=this.m_topoGraph.getGeometryID(t);for(let e=this.m_topoGraph.getFirstCluster();e!==-1&&(n=this.m_predicatesCluster(e,r,i),!n);e=this.m_topoGraph.getNextCluster(e));n||this.setRemainingPredicatesToFalse_()}setEditShape_(e,t){this.m_topoGraph.setEditShape(e,t)}setEditShapeCrackAndCluster_(e,t,n){let r=0;if(e.hasCurves()){let i=new p_,a=e.getEnvelope2D(n),o=u_(t.total(),a);r=f_(o,0),r_(e,o,t.total(),12e3,i,null,n),i.clearStitcher(e)}h_(e,t.add(r),n,!1,!1),e.filterClosePoints(0,!0,!0,!1,-1);for(let t=e.getFirstGeometry();t!==-1;t=e.getNextGeometry(t))e.getGeometryType(t)===L.enumPolygon&&Qp(e,t,-1,!1,-1,n);this.setEditShape_(e,n)}};function Em(e){let t=e[1],n=e[2],r=e[5];e[1]=e[3],e[2]=e[6],e[5]=e[7],e[3]=t,e[6]=n,e[7]=r}function Dm(e,t,n){let r=e.getGeometryType();if(Ne(r)){let t=new Bi({vd:e.getDescription()});return t.addSegment(e,!0),t}if(r===L.enumEnvelope){let n=e,r=G.constructEmpty();if(e.queryEnvelope(r),r.height()<=t&&r.width()<=t){let t=new q({vd:e.getDescription()});return n.getCenter(t),t}if(r.height()<=t||r.width()<=t){let t=new Bi({vd:e.getDescription()}),r=new q;return n.queryCornerByVal(0,r),t.startPathPoint(r),n.queryCornerByVal(2,r),t.lineToPoint(r),t}let i=new X({vd:e.getDescription()});return i.addEnvelope(n,!1),i}return e}function Om(e){return`${e[0]}${e[3]}${e[6]}${e[1]}${e[4]}${e[7]}${e[2]}${e[5]}${e[8]}`}var km=class{nullFunc(){return B(`should not be called`),!1}constructor(e,t,n,r=!1){this.m_bDone=!1,this.m_tolerance=0,this.m_elementHandle=-1,this.m_query=G.constructEmpty(),this.m_envInter=G.constructEmpty(),this.m_quadTree=null,this.m_intersector=null,this.m_function=this.nullFunc;let i=e.getAccelerators(),a=null;i!=null&&(a=r?i.getQuadTreeForPaths():i.getQuadTree());let o=t.getAccelerators(),s=null;if(o!=null&&(s=r?o.getQuadTreeForPaths():o.getQuadTree()),a===null&&s===null&&!r){let r=e.getPointCount(),i=t.getPointCount();if(r>10&&i>10){let o=G.constructEmpty(),c=G.constructEmpty(),l=G.constructEmpty();e.queryLooseEnvelope(o),t.queryLooseEnvelope(c),o.inflateCoords(n,n),c.inflateCoords(n,n),l.setCoords({env2D:o}),l.intersect(c),r>=i?a=V(e.getGeometryType())?tr(e,l):nr(e,l):s=V(t.getGeometryType())?tr(t,l):nr(t,l)}}this.construct_(e,a,t,s,n,r)}next(){if(this.m_bQuadTree){if(this.m_bDone)return!1;for(;this.m_function(););return!this.m_bDone}return!!this.m_intersector&&this.m_intersector.next()}getRedElement(){return this.m_bQuadTree?this.m_bSwapElements?this.m_quadTree.getElement(this.m_elementHandle):V(this.m_queryType)?this.m_bPaths?this.m_pathIndex:this.m_segIter.getStartPointIndex():this.m_pointIndex:this.m_bSwapElements?this.m_intersector.getBlueElement(this.m_intersector.getHandleB()):this.m_intersector.getRedElement(this.m_intersector.getHandleA())}getBlueElement(){return this.m_bQuadTree?this.m_bSwapElements?V(this.m_queryType)?this.m_bPaths?this.m_pathIndex:this.m_segIter.getStartPointIndex():this.m_pointIndex:this.m_quadTree.getElement(this.m_elementHandle):this.m_bSwapElements?this.m_intersector.getRedElement(this.m_intersector.getHandleA()):this.m_intersector.getBlueElement(this.m_intersector.getHandleB())}getRedEnvelope(){return this.m_bPaths||ge(``),this.m_bQuadTree?this.m_bSwapElements?this.m_quadTree.getElementExtent(this.m_elementHandle):this.m_query:this.m_bSwapElements?this.m_intersector.getBlueEnvelope(this.m_intersector.getHandleB()):this.m_intersector.getRedEnvelope(this.m_intersector.getHandleA())}getBlueEnvelope(){return this.m_bPaths||ge(``),this.m_bQuadTree?this.m_bSwapElements?this.m_query:this.m_quadTree.getElementExtent(this.m_elementHandle):this.m_bSwapElements?this.m_intersector.getRedEnvelope(this.m_intersector.getHandleA()):this.m_intersector.getBlueEnvelope(this.m_intersector.getHandleB())}construct_(e,t,n,r,i,a){let o=G.constructEmpty(),s=G.constructEmpty();e.queryLooseEnvelope(o),n.queryLooseEnvelope(s),o.inflateCoords(i,i),s.inflateCoords(i,i),this.m_envInter.setCoords({env2D:o}),this.m_envInter.intersect(s),this.m_multiVertexImplA=e,this.m_multiVertexImplB=n;let c=e.getGeometryType(),l=n.getGeometryType();this.m_bPaths=a,this.m_pathIndex=-1,this.m_pointIndex=-1,this.m_bSwapElements=!1,this.m_queryType=L.enumUnknown,this.m_bQuadTree=!1,t!==null&&(this.m_bDone=!1,this.m_tolerance=i,this.m_quadTree=t,this.m_qtIter=this.m_quadTree.getIteratorForQT(),this.m_bQuadTree=!0,this.m_bSwapElements=!0,V(l)?(this.m_queryType=l,this.m_function=this.nextPath_,a?this.m_pathIndex=n.getPathCount():this.m_segIter=n.querySegmentIterator()):(this.m_queryType=l,this.m_function=this.nextPoint_,this.m_pointIndex=n.getPointCount())),this.m_bQuadTree||r!==null&&(this.m_bDone=!1,this.m_tolerance=i,this.m_quadTree=r,this.m_qtIter=this.m_quadTree.getIteratorForQT(),this.m_bQuadTree=!0,this.m_bSwapElements=!1,V(c)?(this.m_queryType=c,this.m_function=this.nextPath_,a?this.m_pathIndex=e.getPathCount():this.m_segIter=e.querySegmentIterator()):(this.m_queryType=c,this.m_function=this.nextPoint_,this.m_pointIndex=e.getPointCount())),this.m_bQuadTree||(a&&V(c)&&V(l)?this.m_intersector=Xn(e,n,i):V(c)&&V(l)?(this.m_intersector=Yn(e,n,i),this.m_bSwapElements=!1):V(c)&&!V(l)?(this.m_intersector=Zn(e,n,i),this.m_bSwapElements=!1):!V(c)&&V(l)?(this.m_intersector=Zn(n,e,i),this.m_bSwapElements=!0):(this.m_intersector=Qn(e,n,i),this.m_bSwapElements=!1))}nextPath_(){return this.m_bPaths?--this.m_pathIndex===-1?(this.m_bDone=!0,!1):(this.m_bSwapElements?this.m_multiVertexImplB.queryPathEnvelope(this.m_pathIndex,this.m_query):this.m_multiVertexImplA.queryPathEnvelope(this.m_pathIndex,this.m_query),this.m_qtIter.resetIterator(this.m_query,this.m_tolerance),this.m_function=this.iterate_,!0):this.m_segIter.nextPath()?(this.m_function=this.nextSegment_,!0):(this.m_bDone=!0,!1)}nextSegment_(){if(!this.m_segIter.hasNextSegment())return this.m_function=this.nextPath_,!0;let e=this.m_segIter.nextSegment(),t=new G;return e.queryLooseEnvelope(t),!t.isIntersecting(this.m_envInter)||(this.m_qtIter.resetIterator(e,this.m_tolerance),this.m_function=this.iterate_,!0)}nextPoint_(){if(--this.m_pointIndex===-1)return this.m_bDone=!0,!1;let e=new z;if(this.m_bSwapElements){let t=this.m_multiVertexImplB.getXY(this.m_pointIndex);e.setCoordsPoint2D(t)}else{let t=this.m_multiVertexImplA.getXY(this.m_pointIndex);e.setCoordsPoint2D(t)}return!this.m_envInter.contains(e)||(this.m_qtIter.resetIterator(G.construct(e.x,e.y,e.x,e.y),this.m_tolerance),this.m_function=this.iterate_,!0)}iterate_(){return this.m_elementHandle=this.m_qtIter.next(),this.m_elementHandle===-1&&(V(this.m_queryType)?(this.m_function=this.m_bPaths?this.nextPath_:this.nextSegment_,!0):(this.m_function=this.nextPoint_,!0))}};function Am(e){return e===2?1:e===1?2:e===128?64:e===64?128:e}function jm(e,t,n){let r;if(e instanceof ZS||e===null){let i=G.constructEmpty();i.setCoords({pt:t}),i.mergeEnvelope2D(n),r=Rn(e,i,!1)}else r=e;return r}function Mm(e,t,n){let r;if(e instanceof ZS||e===null){let i=G.constructEmpty();i.setCoords({env2D:t}),i.mergeEnvelope2D(n),r=Rn(e,i,!1)}else r=e;return r}function Nm(e,t,n,r,i){if(e.isEmpty()||t.isEmpty())return r===4;$e(e),$e(t);let a=e.getGeometryType(),o=t.getGeometryType();if(a===L.enumEnvelope){if(o===L.enumEnvelope)return Pm(e,t,n,r);if(o===L.enumPoint)return Fm(t,e,n,Am(r))}else if(a===L.enumPoint){if(o===L.enumEnvelope)return Fm(e,t,n,r);if(o===L.enumPoint)return Im(e,t,n,r)}let s=G.constructEmpty();e.queryEnvelope(s);let c=G.constructEmpty();t.queryEnvelope(c);let l=Mm(n,s,c);if(Lm(s,c,l))return r===4;let u=!1,d=null,f=null,p=null,m=null;switch(Ne(a)?(d=new Bi({vd:e.getDescription()}),d.addSegment(e,!0),p=d,a=L.enumPolyline):p=e,Ne(o)?(f=new Bi({vd:t.getDescription()}),f.addSegment(t,!0),m=f,o=L.enumPolyline):m=t,a!==L.enumEnvelope&&o!==L.enumEnvelope?(p.getDimension()<m.getDimension()||a===L.enumPoint&&o===L.enumMultiPoint)&&(r=Am(r)):a!==L.enumPolygon&&o!==L.enumEnvelope&&(r=Am(r)),a){case L.enumPolygon:switch(o){case L.enumPolygon:u=Bm(p,m,l,r,i);break;case L.enumPolyline:u=Vm(p,m,l,r,i);break;case L.enumPoint:u=Hm(p,m,l,r);break;case L.enumMultiPoint:u=Um(p,m,l,r);break;case L.enumEnvelope:u=Wm(p,m,l,r,i)}break;case L.enumPolyline:switch(o){case L.enumPolygon:u=Vm(m,p,l,r,i);break;case L.enumPolyline:u=Gm(p,m,l,r,i);break;case L.enumPoint:u=Km(p,m,l,r);break;case L.enumMultiPoint:u=qm(p,m,l,r);break;case L.enumEnvelope:u=Jm(p,m,l,r,i)}break;case L.enumPoint:switch(o){case L.enumPolygon:u=Hm(m,p,l,r);break;case L.enumPolyline:u=Km(m,p,l,r);break;case L.enumMultiPoint:u=Xm(m,p,l,r)}break;case L.enumMultiPoint:switch(o){case L.enumPolygon:u=Um(m,p,l,r);break;case L.enumPolyline:u=qm(m,p,l,r);break;case L.enumMultiPoint:u=Ym(p,m,l,r);break;case L.enumPoint:u=Xm(p,m,l,r);break;case L.enumEnvelope:u=Zm(p,m,l,r)}break;case L.enumEnvelope:switch(o){case L.enumPolygon:u=Wm(m,p,l,r,i);break;case L.enumPolyline:u=Jm(m,p,l,r,i);break;case L.enumMultiPoint:u=Zm(m,p,l,r)}}return u}function Pm(e,t,n,r,i){if(e.isEmpty()||t.isEmpty())return r===4;let a=G.constructEmpty();e.queryEnvelope(a);let o=G.constructEmpty();t.queryEnvelope(o);let s=Mm(n,a,o);switch(r){case 4:return Lm(a,o,s);case 2:return lg(o,a,s,!1);case 128:return lg(o,a,s,!0);case 1:return lg(a,o,s,!1);case 64:return lg(a,o,s,!0);case 3:return og(a,o,s);case 8:return sg(a,o,s);case 32:return cg(a,o,s);case 16:return!1}return!1}function Fm(e,t,n,r,i){if(e.isEmpty()||t.isEmpty())return r===4;let a=e.getXY(),o=G.constructEmpty();t.queryEnvelope(o);let s=jm(n,a,o);switch(r){case 4:return zm(a,o,s);case 2:case 128:return ag(a,o,s);case 1:case 64:return!1;case 3:return rg(a,o,s);case 8:return ig(a,o,s)}return!1}function Im(e,t,n,r,i){if(e.isEmpty()||t.isEmpty())return r===4;let a=e.getXY(),o=t.getXY(),s;if(n instanceof ZS||n===null){let e=G.constructEmpty();e.setCoords({pt:a}),e.merge(o),s=Rn(n,e,!1)}else s=n;switch(r){case 4:return tg(a,o,s);case 2:case 128:return ng(o,a,s);case 1:case 64:return ng(a,o,s);case 3:return eg(a,o,s)}return!1}function Lm(e,t,n){let r=G.constructEmpty();return r.setCoords({env2D:t}),r.inflateCoords(n,n),!e.isIntersecting(r)}function Rm(e,t,n,r=!1){let i=e.getGeometryType(),a=t.getGeometryType();if(d(i)){let t=e.getImpl().getAccelerators();if(t!==null){let e=t.getRasterizedGeometry();U(e===null)}}if(d(a)){let e=t.getImpl().getAccelerators();if(e!==null){let t=e.getRasterizedGeometry();U(t===null)}}return 0}function zm(e,t,n,r){let i=G.constructEmpty();return i.setCoords({env2D:t}),i.inflateCoords(n,n),!i.contains(e)}function Bm(e,t,n,r,i){switch(r){case 4:return $m(e,t,n);case 2:return nh(t,e,n,i);case 128:return rh(t,e,n);case 1:return nh(e,t,n,i);case 64:return rh(e,t,n);case 3:return Qm(e,t,n,i);case 8:return eh(e,t,n);case 32:return th(e,t,n,i)}return!1}function Vm(e,t,n,r,i){switch(r){case 4:return ih(e,t,n);case 1:return sh(e,t,n,i);case 64:return ch(e,t,n);case 8:return ah(e,t,n,i);case 16:return oh(e,t,n)}return!1}function Hm(e,t,n,r,i){switch(r){case 4:return lh(e,t,n);case 1:case 64:return dh(e,t,n);case 8:return uh(e,t,n)}return!1}function Um(e,t,n,r,i){switch(r){case 4:return fh(e,t,n);case 1:return hh(e,t,n,!1);case 64:return hh(e,t,n,!0);case 8:return ph(e,t,n);case 16:return mh(e,t,n)}return!1}function Wm(e,t,n,r,i){if(_h(e,t,n))return r===4;if(r===4)return!1;switch(r){case 2:return bh(e,t,n,!1);case 128:return bh(e,t,n,!0);case 1:return xh(e,t,n,!1,i);case 64:return xh(e,t,n,!0,i);case 3:return gh(e,t,n,i);case 8:return vh(e,t,n,i);case 32:return yh(e,t,n,i);case 16:return!1}return!1}function Gm(e,t,n,r,i){switch(r){case 4:return Ch(e,t,n);case 2:return Dh(t,e,n,i);case 128:return Oh(t,e,n,i);case 1:return Dh(e,t,n,i);case 64:return Oh(e,t,n,i);case 3:return Sh(e,t,n,i);case 8:return wh(e,t,n,i);case 32:return Eh(e,t,n,i);case 16:return Th(e,t,n,i)}return!1}function Km(e,t,n,r,i){switch(r){case 4:return kh(e,t,n);case 1:case 64:return jh(e,t,n);case 8:return Ah(e,t,n)}return!1}function qm(e,t,n,r,i){switch(r){case 4:return Mh(e,t,n);case 1:case 64:return Fh(e,t,n);case 8:return Nh(e,t,n);case 16:return Ph(e,t,n)}return!1}function Jm(e,t,n,r,i){if(Lh(e,t,n))return r===4;if(r===4)return!1;switch(r){case 2:return zh(e,t,n,!1);case 128:return zh(e,t,n,!0);case 1:case 64:case 32:return!1;case 3:return Ih(e,t,n);case 8:return Rh(e,t,n,i);case 16:return Bh(e,t,n)}return!1}function Ym(e,t,n,r,i){switch(r){case 4:return Hh(e,t,n);case 2:case 128:return Wh(t,e,n);case 1:case 64:return Wh(e,t,n);case 3:return Vh(e,t,n);case 32:return Uh(e,t,n)}return!1}function Xm(e,t,n,r,i){switch(r){case 4:return Kh(e,t,n);case 2:case 128:return qh(e,t,n);case 1:case 64:return Jh(e,t,n);case 3:return Gh(e,t,n)}return!1}function Zm(e,t,n,r,i){switch(r){case 4:return Xh(e,t,n);case 2:return Qh(e,t,n,!1);case 128:return Qh(e,t,n,!0);case 1:case 64:return!1;case 3:return Yh(e,t,n);case 8:return Zh(e,t,n);case 16:return $h(e,t,n)}return!1}function Qm(e,t,n,r){let i=G.constructEmpty(),a=G.constructEmpty();if(e.queryEnvelope(i),t.queryEnvelope(a),!og(i,a,n))return!1;if(Rm(e,t),gg(e,t,n))return!0;let o=e.calculateLength2D(),s=t.calculateLength2D(),c=Math.max(e.getPointCount(),t.getPointCount());return Math.abs(o-s)>4*c*n?!1:e.hasNonLinearSegments()||t.hasNonLinearSegments()?em(e,t,n,`**F**FFF*`,r,!1):yg(e,t,n,!0)}function $m(e,t,n,r){return Rm(e,t,n,!0),ug(e,t,n,!0)===1}function eh(e,t,n,r){return Rm(e,t),Dg(e,t,n,null)}function th(e,t,n,r){return Rm(e,t),Og(e,t,n,r)}function nh(e,t,n,r){let i=G.constructEmpty(),a=G.constructEmpty();return e.queryEnvelope(i),t.queryEnvelope(a),!!pg(i,a,n)&&(Rm(e,t),kg(e,t,n,r))}function rh(e,t,n,r){let i=G.constructEmpty(),a=G.constructEmpty();return e.queryEnvelope(i),t.queryEnvelope(a),!!pg(i,a,n)&&(Rm(e,t),ug(e,t,n,!1)===2)}function ih(e,t,n,r){return Rm(e,t,n,!0),ug(e,t,n,!0)===1}function ah(e,t,n,r){return Rm(e,t),Ag(e,t,n,r)}function oh(e,t,n,r){return Rm(e,t),jg(e,t,n,null)}function sh(e,t,n,r){let i=G.constructEmpty(),a=G.constructEmpty();return e.queryEnvelope(i),t.queryEnvelope(a),!!pg(i,a,n)&&(Rm(e,t),Mg(e,t,n,r))}function ch(e,t,n,r){let i=G.constructEmpty(),a=G.constructEmpty();return e.queryEnvelope(i),t.queryEnvelope(a),!!pg(i,a,n)&&(Rm(e,t),ug(e,t,n,!1)===2)}function lh(e,t,n,r){return Vg(e,t,n)===0}function uh(e,t,n,r){return Pg(e,t.getXY(),n)}function dh(e,t,n,r){return Ng(e,t.getXY(),n)}function fh(e,t,n,r,i){return Rm(e,t),dg(e,t,n)===1}function ph(e,t,n,r){Rm(e,t);let i=G.constructEmpty();e.queryEnvelope(i),i.inflateCoords(n,n);let a=new z,o=!1,s=e.getImpl(),c=new X,l=e,u=!1;for(let r=0;r<t.getPointCount();r++){if(t.queryXY(r,a),i.contains(a)){let e=Hg(l,a,n);if(e===2)o=!0;else if(e===1)return!1}u||=(!Kp(e,t.getPointCount()-1)||s.getAccelerators()!==null&&s.getAccelerators().getQuadTree()!==null?l=e:(e.copyTo(c),c.getImpl().buildQuadTreeAccelerator(1),l=c),!0)}return!!o}function mh(e,t,n,r){Rm(e,t);let i=new G,a=new G,o=new G;e.queryEnvelope(i),t.queryEnvelope(o),a.setCoords({env2D:i}),a.inflateCoords(n,n);let s=!1,c=!1,l=new z,u=e.getImpl(),d=new X,f=e,p=!1;for(let r=0;r<t.getPointCount();r++){if(t.queryXY(r,l),a.contains(l)){let e=Hg(f,l,n);e===0?c=!0:e===1&&(s=!0)}else c=!0;if(s&&c)return!0;p||=(!Kp(e,t.getPointCount()-1)||u.getAccelerators()!==null&&u.getAccelerators().getQuadTree()!==null?f=e:(e.copyTo(d),d.getImpl().buildQuadTreeAccelerator(1),f=d),!0)}return!1}function hh(e,t,n,r,i){let a=G.constructEmpty(),o=G.constructEmpty();if(e.queryEnvelope(a),t.queryEnvelope(o),!pg(a,o,n))return!1;Rm(e,t);let s=!1,c=new z,l=e.getImpl(),u=new X,d=e,f=!1;for(let i=0;i<t.getPointCount();i++){if(t.queryXY(i,c),!a.contains(c))return!1;let o=Hg(d,c,n);if(o===1)s=!0;else if(o===0)return!1;if(r&&o===2)return!1;f||=(!Kp(e,t.getPointCount()-1)||l.getAccelerators()!==null&&l.getAccelerators().getQuadTree()!==null?d=e:(e.copyTo(u),u.getImpl().buildQuadTreeAccelerator(1),d=u),!0)}return s}function gh(e,t,n,r){let i=new G,a=new G;if(e.queryEnvelope(i),t.queryEnvelope(a),!og(i,a,n))return!1;let o=new X;return o.addEnvelope(t,!1),Qm(e,o,n,r)}function _h(e,t,n,r){Rm(e,t);let i=G.constructEmpty(),a=G.constructEmpty();return e.queryEnvelope(i),t.queryEnvelope(a),pg(a,i,n)?!1:Hg(e,a.getLowerLeft(),0)===0&&!a.contains(e.getXY(0))&&!Eg(e,a,n)}function vh(e,t,n,r){Rm(e,t);let i=new G,a=new G;if(e.queryEnvelope(i),t.queryEnvelope(a),pg(a,i,n)||a.height()<=n||a.width()<=n)return!1;let o=new X;return o.addEnvelope(t,!1),Dg(e,o,n,r)}function yh(e,t,n,r){Rm(e,t);let i=new G,a=new G;if(e.queryEnvelope(i),t.queryEnvelope(a),pg(a,i,n)||a.height()<=n||a.width()<=n)return!1;let o=new X;return o.addEnvelope(t,!1),Og(e,o,n,r)}function bh(e,t,n,r,i){let a=G.constructEmpty(),o=G.constructEmpty();return e.queryEnvelope(a),t.queryEnvelope(o),r?mg(o,a,n):pg(o,a,n)}function xh(e,t,n,r,i){let a=G.constructEmpty(),o=G.constructEmpty();if(e.queryEnvelope(a),t.queryEnvelope(o),!pg(a,o,n))return!1;Rm(e,t);let s=new X;return s.addEnvelope(t,!1),r?ug(e,s,n,!1)===2:kg(e,s,n,i)}function Sh(e,t,n,r){let i=G.constructEmpty(),a=G.constructEmpty();return e.queryEnvelope(i),t.queryEnvelope(a),og(i,a,n)?(Rm(e,t),gg(e,t,n)?!0:e.hasNonLinearSegments()||t.hasNonLinearSegments()?em(e,t,n,`**F**FFF*`,r,!1):yg(e,t,n,!1)):!1}function Ch(e,t,n,r){Rm(e,t);let i=e.getImpl(),a=t.getImpl();return!new km(i,a,n,!0).next()||!xg(e,t,n)}function wh(e,t,n,r){Rm(e,t);let i=[],a=Sg(e,t,n,i);if(a===-2){let i=G.constructEmpty(),a=G.constructEmpty(),o=G.constructEmpty(),s,c;if(e.queryEnvelope(i),t.queryEnvelope(a),i.inflateCoords(1e3*n,1e3*n),a.inflateCoords(1e3*n,1e3*n),o.setCoords({env2D:i}),o.intersect(a),e.getPointCount()>10){if(s=qd(e,o,n,0,r),s.isEmpty())return!1}else s=e;if(t.getPointCount()>10){if(c=qd(t,o,n,0,r),c.isEmpty())return!1}else c=t;return em(s,c,n,`F********`,r,!1)}if(a!==0)return!1;let o=new ii;for(let e=0;e<i.length;e+=2){let t=i[e],n=i[e+1];o.addXY(t,n)}let s=e.getBoundary(),c=t.getBoundary();return s.addPoints(c,0,c.getPointCount()),!s.isEmpty()&&Wh(s,o,n)}function Th(e,t,n,r){Rm(e,t);let i=[],a=Sg(e,t,n,i);if(a===-2){let i=G.constructEmpty(),a=G.constructEmpty(),o=G.constructEmpty(),s,c;if(e.queryEnvelope(i),t.queryEnvelope(a),i.inflateCoords(1e3*n,1e3*n),a.inflateCoords(1e3*n,1e3*n),o.setCoords({env2D:i}),o.intersect(a),e.getPointCount()>10){if(s=qd(e,o,n,0,r),s.isEmpty())return!1}else s=e;if(t.getPointCount()>10){if(c=qd(t,o,n,0,r),c.isEmpty())return!1}else c=t;return em(s,c,n,`0********`,r,!1)}if(a!==0)return!1;let o=new ii;for(let e=0;e<i.length;e+=2){let t=i[e],n=i[e+1];o.addXY(t,n)}let s=e.getBoundary(),c=t.getBoundary();return s.addPoints(c,0,c.getPointCount()),!!s.isEmpty()||!Wh(s,o,n)}function Eh(e,t,n,r){Rm(e,t);let i=G.constructEmpty(),a=G.constructEmpty();e.queryEnvelope(i),t.queryEnvelope(a);let o=hg(i,a,n),s=hg(a,i,n),c=e.hasNonLinearSegments(),l=t.hasNonLinearSegments(),u=Sg(e,t,n,null);if(u===-1)return!1;if(u===1){if(o&&s)return!0;if(!c&&!l)return o&&!s?!bg(t,e,n,!1):s&&!o?!bg(e,t,n,!1):!bg(e,t,n,!1)&&!bg(t,e,n,!1)}let d=G.constructEmpty(),f=G.constructEmpty(),p=G.constructEmpty(),m,h;d.setCoords({env2D:i}),d.inflateCoords(1e3*n,1e3*n),f.setCoords({env2D:a}),f.inflateCoords(1e3*n,1e3*n),p.setCoords({env2D:d}),p.intersect(f);let g=``;if(g+=`1*`,o){if(t.getPointCount()>10){if(h=qd(t,p,n,0,r),h.isEmpty())return!1}else h=t;g+=`****`}else h=t,g+=`T***`;if(s){if(e.getPointCount()>10){if(m=qd(e,p,n,0,r),m.isEmpty())return!1}else m=e;g+=`***`}else m=e,g+=`T**`;return em(m,h,n,g,r,!1)}function Dh(e,t,n,r){let i=G.constructEmpty(),a=G.constructEmpty();return e.queryEnvelope(i),t.queryEnvelope(a),pg(i,a,n)?(Rm(e,t),e.hasNonLinearSegments()||t.hasNonLinearSegments()?em(e,t,n,`******FF*`,r,!1):bg(t,e,n,!1)):!1}function Oh(e,t,n,r){let i=G.constructEmpty(),a=G.constructEmpty();return e.queryEnvelope(i),t.queryEnvelope(a),pg(i,a,n)?(Rm(e,t),em(e,t,n,`T**FF*FF*`,r,!1)):!1}function kh(e,t,n,r){return Rm(e,t),!wg(e,t.getXY(),n)}function Ah(e,t,n,r){return Rm(e,t),Ig(e,t.getXY(),n)}function jh(e,t,n,r){return Rm(e,t),Tg(e,t.getXY(),n)}function Mh(e,t,n,r){return Rm(e,t),!Cg(e,t,n,!1)}function Nh(e,t,n,r){Rm(e,t);let i=e.getImpl(),a=t.getImpl(),o=new ii,s=new km(i,a,n,!1),c=i.querySegmentIterator(),l=!1;for(;s.next();){let e=s.getRedElement(),t=s.getBlueElement();c.resetToVertex(e,-1);let r=c.nextSegment(),i=a.getXY(t);r.isIntersectingPoint(i,n)&&(l=!0,o.addPoint2D(i))}if(!l)return!1;let u=e.getBoundary();return!u.isEmpty()&&Wh(u,o,n)}function Ph(e,t,n,r){Rm(e,t);let i=e.getImpl(),a=t.getImpl(),o=a.getPointCount(),s=H(o,!1),c=new km(i,a,n,!1),l=i.querySegmentIterator(),u=!1;for(;c.next();){let e=c.getRedElement(),t=c.getBlueElement();l.resetToVertex(e,-1);let r=l.nextSegment(),i=a.getXY(t);r.isIntersectingPoint(i,n)&&(u=!0,s[t]=!0)}if(!u)return!1;let d=!1;for(let e=0;e<o;e++)if(!s[e]){d=!0;break}if(!d)return!1;let f=e.getBoundary();if(f.isEmpty())return!0;let p=new ii;for(let e=0;e<o;e++)s[e]&&p.addPoint2D(a.getXY(e));return!Wh(f,p,n)}function Fh(e,t,n,r,i){let a=G.constructEmpty(),o=G.constructEmpty();if(e.queryEnvelope(a),t.queryEnvelope(o),!pg(a,o,n))return!1;Rm(e,t);let s=Cg(e,t,n,!0);if(!s)return s;let c=e.getBoundary();return c.isEmpty()?s:!Wh(c,t,n)}function Ih(e,t,n,r){let i=new G,a=new G;return e.queryEnvelope(i),t.queryEnvelope(a),!(a.height()>n&&a.width()>n)&&og(i,a,n)}function Lh(e,t,n,r){let i=G.constructEmpty(),a=G.constructEmpty();e.queryEnvelope(i),t.queryEnvelope(a);let o=Lg(a,i,n);return o===0?!Eg(e,a,n):o===4}function Rh(e,t,n,r){let i=new G,a=new G;if(e.queryEnvelope(i),t.queryEnvelope(a),a.height()<=n||a.width()<=n)return!1;let o=new G,s=new G;if(o.setCoords({env2D:a}),s.setCoords({env2D:a}),o.inflateCoords(n,n),s.inflateCoords(-n,-n),s.containsEnvelope(i)||!i.isIntersecting(o))return!1;let c=e.getImpl().querySegmentIterator();c.stripAttributes();let l=e.getImpl().getAccelerators(),u=null,d=null;l!==null&&(u=l.getQuadTree(),u!==null&&(d=u.getIterator(a,n))),d||c.nextPath()||B(`relational_operations`);let f=!1,p=null,m=new z,h=new z,g=e.hasNonLinearSegments(),_=!1;for(;;){if(d!==null){let e=d.next();if(e===-1)break;c.resetToVertex(u.getElement(e),-1),p=c.nextSegment()}else{for(;!c.hasNextSegment()&&c.nextPath(););if(!c.hasNextSegment())break;p=c.nextSegment()}if(g&&p.getGeometryType()!==L.enumLine){let e=new G;if(p.queryEnvelope(e),s.containsEnvelope(e))return!1;if(o.isIntersecting(e)){_=!0;break}}else{m.assign(p.getStartXY()),h.assign(p.getEndXY());let e=s.clipLine(m,h);if(e!==0)return!1;f||(e=o.clipLine(m,h),e!==0&&(f=!0))}}if(!_)return f;let v=new X;return v.addEnvelope(a,!1),ah(v,e,n,r)}function zh(e,t,n,r,i){let a=G.constructEmpty(),o=G.constructEmpty();if(e.queryEnvelope(a),t.queryEnvelope(o),o.height()<=n||o.width()<=n)return!1;if(r)return mg(o,a,n);if(!pg(o,a,n))return!1;let s=G.constructEmpty();s.setCoords({env2D:o}),s.inflateCoords(-n,-n);let c=G.constructEmpty();if(c.setCoords({env2D:o}),c.inflateCoords(n,n),s.containsEnvelope(a))return!0;let l=e.getImpl().querySegmentIterator();l.stripAttributes(),l.nextPath()||B(`relational_operations`);let u,d,f,p,m,h,g=!1,_=e.hasNonLinearSegments();for(_&&(f=new Z,p=new Z,m=new Z,h=new Z,s.querySide(0,f),s.querySide(1,p),s.querySide(2,m),s.querySide(3,h));;){for(;!l.hasNextSegment()&&l.nextPath(););if(!l.hasNextSegment())break;let e=l.nextSegment();if(_&&e.getGeometryType()!==L.enumLine){if(e.isIntersecting(f,n)){g=!0;break}if(e.isIntersecting(p,n)){g=!0;break}if(e.isIntersecting(m,n)){g=!0;break}if(e.isIntersecting(h,n)){g=!0;break}}else if(u=e.getStartXY(),d=e.getEndXY(),s.clipLine(u,d)!==0){g=!0;break}}return g}function Bh(e,t,n,r){let i=new G,a=new G;if(e.queryEnvelope(i),t.queryEnvelope(a),a.height()<=n||a.width()<=n)return!1;let o=new G;if(o.setCoords({env2D:a}),o.inflateCoords(n,n),o.containsEnvelope(i))return!1;let s=new G;if(s.setCoords({env2D:a}),s.inflateCoords(-n,-n),!s.isIntersecting(i))return!1;let c=e.getImpl().querySegmentIterator();c.stripAttributes();let l=e.getImpl().getAccelerators(),u=null,d=null;if(l!==null&&(u=l.getQuadTree(),u!==null&&(d=u.getIterator(a,n))),!d){let e=c.nextPath();U(e)}let f=!1,p=null,m=new z,h=new z,g=null,_=null,v=null,y=null;for(e.hasNonLinearSegments()&&(g=new Z,_=new Z,v=new Z,y=new Z,s.querySide(0,g),s.querySide(1,_),s.querySide(2,v),s.querySide(3,y));;){if(d!==null){let e=d.next();if(e===-1)break;c.resetToVertex(u.getElement(e),-1),p=c.nextSegment()}else{for(;!c.hasNextSegment()&&c.nextPath(););if(!c.hasNextSegment())break;p=c.nextSegment()}if(p.getGeometryType()===L.enumLine){if(m.assign(p.getStartXY()),h.assign(p.getEndXY()),s.clipLine(m,h)!==0){f=!0;break}}else{if(g.isIntersecting(p,n)){f=!0;break}if(_.isIntersecting(p,n)){f=!0;break}if(v.isIntersecting(p,n)){f=!0;break}if(y.isIntersecting(p,n)){f=!0;break}}}return f&&!0}function Vh(e,t,n,r){let i=G.constructEmpty(),a=G.constructEmpty();return e.queryEnvelope(i),t.queryEnvelope(a),!!og(i,a,n)&&(!!_g(e,t,n)||vg(e,t,n,!1,!0,!1))}function Hh(e,t,n,r){let i=e,a=t,o=new km(i,a,n,!1),s=n*n,c=new z,l=new z;for(;o.next();){let e=o.getRedElement(),t=o.getBlueElement();if(i.queryXY(e,c),a.queryXY(t,l),z.sqrDistance(c,l)<=s)return!1}return!0}function Uh(e,t,n,r){return vg(e,t,n,!1,!1,!0)}function Wh(e,t,n,r){let i=G.constructEmpty(),a=G.constructEmpty();return e.queryEnvelope(i),t.queryEnvelope(a),!!pg(i,a,n)&&vg(t,e,n,!0,!1,!1)}function Gh(e,t,n,r){let i=G.constructEmpty(),a=G.constructEmpty();return e.queryEnvelope(i),t.queryEnvelope(a),og(i,a,n)}function Kh(e,t,n,r){return Fg(e,t.getXY(),n)}function qh(e,t,n,r){return Gh(e,t,n)}function Jh(e,t,n,r){return!Kh(e,t,n)}function Yh(e,t,n,r){let i=new G,a=new G;return e.queryEnvelope(i),t.queryEnvelope(a),!(a.height()>n||a.width()>n)&&og(i,a,n)}function Xh(e,t,n,r){let i=G.constructEmpty(),a=G.constructEmpty();if(e.queryEnvelope(i),t.queryEnvelope(a),pg(a,i,n))return!1;let o=G.constructEmpty();o.setCoords({env2D:a}),o.inflateCoords(n,n);let s=new z;for(let t=0;t<e.getPointCount();t++)if(e.queryXY(t,s),o.contains(s))return!1;return!0}function Zh(e,t,n,r){let i=new G,a=new G,o=new G;if(t.queryEnvelope(i),i.height()<=n||i.width()<=n)return!1;a.setCoords({env2D:i}),o.setCoords({env2D:i}),a.inflateCoords(n,n),o.inflateCoords(-n,-n);let s=new z,c=!1;for(let t=0;t<e.getPointCount();t++)if(e.queryXY(t,s),a.contains(s)){if(o.containsExclusive(s))return!1;c=!0}return c}function Qh(e,t,n,r,i){let a=G.constructEmpty(),o=G.constructEmpty();if(e.queryEnvelope(a),t.queryEnvelope(o),o.height()<=n||o.width()<=n)return!1;if(r)return mg(o,a,n);if(!pg(o,a,n))return!1;let s=!1,c=G.constructEmpty(),l=G.constructEmpty();c.setCoords({env2D:o}),l.setCoords({env2D:o}),c.inflateCoords(-n,-n),l.inflateCoords(n,n);let u=new z;for(let t=0;t<e.getPointCount();t++){if(e.queryXY(t,u),!l.contains(u))return!1;c.containsExclusive(u)&&(s=!0)}return s}function $h(e,t,n,r){let i=new G,a=new G;if(e.queryEnvelope(i),t.queryEnvelope(a),pg(a,i,n)||a.height()<=n||a.width()<=n)return!1;let o=new G,s=new G;o.setCoords({env2D:a}),o.inflateCoords(-n,-n),s.setCoords({env2D:a}),s.inflateCoords(n,n);let c=new z,l=!1,u=!1;for(let t=0;t<e.getPointCount();t++)if(e.queryXY(t,c),!l&&o.containsExclusive(c)&&(l=!0),u||s.contains(c)||(u=!0),l&&u)return!0;return!1}function eg(e,t,n,r){return z.sqrDistance(e,t)<=n*n}function tg(e,t,n,r){return z.sqrDistance(e,t)>n*n}function ng(e,t,n,r){return eg(e,t,n)}function rg(e,t,n,r){let i=new G;return i.setCoords({pt:e}),og(i,t,n)}function ig(e,t,n,r){if(t.height()<=n||t.width()<=n)return!1;let i=new G,a=new G;return i.setCoords({env2D:t}),i.inflateCoords(n,n),!!i.contains(e)&&(a.setCoords({env2D:t}),a.inflateCoords(-n,-n),!a.containsExclusive(e))}function ag(e,t,n,r){if(t.height()<=n||t.width()<=n)return!1;let i=G.constructEmpty();return i.setCoords({env2D:t}),i.inflateCoords(-n,-n),i.containsExclusive(e)}function og(e,t,n,r){return pg(e,t,n)&&pg(t,e,n)}function sg(e,t,n,r){if(e.height()<=n||e.width()<=n||t.height()<=n||t.width()<=n)return!1;let i=new G;return i.setCoords({env2D:e}),i.inflateCoords(-n,-n),i.intersect(t),!(!i.isEmpty()&&i.height()>n&&i.width()>n)&&(i.setCoords({env2D:e}),i.inflateCoords(n,n),i.intersect(t),!i.isEmpty())}function cg(e,t,n,r){if(e.height()<=n||e.width()<=n||t.height()<=n||t.width()<=n||pg(e,t,n)||pg(t,e,n))return!1;let i=new G;return i.setCoords({env2D:e}),i.inflateCoords(-n,-n),i.intersect(t),!i.isEmpty()&&(i.height()>n||i.width()>n)}function lg(e,t,n,r,i){if(e.height()<=n||e.width()<=n)return!1;if(r)return mg(e,t,n);if(!pg(e,t,n))return!1;let a=G.constructEmpty();return a.setCoords({env2D:e}),a.inflateCoords(-n,-n),a.intersect(t),!a.isEmpty()}function ug(e,t,n,r,i){let a=new z,o=new z,s=G.constructEmpty(),c=G.constructEmpty(),l=e.getImpl(),u=t.getImpl(),d=u.getGeometryType(),f=new km(l,u,n,!0);if(!f.next())return 1;if(xg(e,t,n))return r?4:0;let p=new X,m=e,h=new X,g=null;d===L.enumPolygon&&(g=t);let _=d===L.enumPolygon?H(l.getPathCount(),!1):[],v=H(u.getPathCount(),!1),y=!1,b=!1,x=!1,S=!1,C=!1,w=!1;do{if(x&&C||S&&w||x&&S)break;let i=f.getRedElement(),T=f.getBlueElement();if(!v[T]&&(o.assign(t.getXY(t.getPathStart(T))),s.setCoords({env2D:f.getRedEnvelope()}),s.inflateCoords(n,n),s.contains(o))){if(Hg(m,o,0)!==0){if(S=!0,r)return 4}else w=!0;v[T]=!0}if(d===L.enumPolygon&&!_[i]&&(a.assign(e.getXY(e.getPathStart(i))),c.setCoords({env2D:f.getBlueEnvelope()}),c.inflateCoords(n,n),c.contains(a))){if(Hg(g,a,0)!==0){if(x=!0,r)return 4}else C=!0;_[i]=!0}if(y||=(!Kp(e,t.getPathCount()-1)||l.getAccelerators()!==null&&l.getAccelerators().getQuadTree()!==null?m=e:(e.copyTo(p),p.getImpl().buildQuadTreeAccelerator(1),m=p),!0),d===L.enumPolygon&&!b){let n=t;!Kp(n,e.getPathCount()-1)||u.getAccelerators()!==null&&u.getAccelerators().getQuadTree()!==null?g=t:(n.copyTo(h),h.getImpl().buildQuadTreeAccelerator(1),g=h),b=!0}}while(f.next());if(!x&&!S)return 1;if(!C||!w){if(d===L.enumPolygon){for(let e=0,t=l.getPathCount();e<t;e++)if(!_[e]){C=!0;break}}for(let e=0,t=u.getPathCount();e<t;e++)if(!v[e]){w=!0;break}}return x&&C||S&&w||x&&S?4:S?2:3}function dg(e,t,n,r,i){let a=G.constructEmpty();e.queryEnvelope(a),a.inflateCoords(n,n);let o=new z,s=e.getImpl(),c=new X,l=e,u=!1,d=!1,f=!1;for(let r=0;r<t.getPointCount();r++){if(t.queryXY(r,o),a.contains(o)){let e=Hg(l,o,n);if(e===1)return d=!0,4;if(e===2)return 4;f=!0}else f=!0;u||=(!Kp(e,t.getPointCount()-1)||s.getAccelerators()!==null&&s.getAccelerators().getQuadTree()!=null?l=e:(e.copyTo(c),c.getImpl().buildQuadTreeAccelerator(1),l=c),!0)}return d?f?4:2:1}function fg(e,t,n,r,i){r[0]=!1;let a=e.getImpl(),o=t.getImpl(),s=a.querySegmentIterator(),c=o.querySegmentIterator(),l=[0,0],u=[0,0],d=new km(a,o,n),f=!1;for(;d.next();){let e=d.getRedElement(),t=d.getBlueElement();s.resetToVertex(e,-1),c.resetToVertex(t,-1);let i=s.nextSegment(),a=c.nextSegment(),o=0;if(Rg(i,a)?!f&&a.isIntersecting(i,n)&&(f=!0):o=a.intersect(i,null,u,l,n),o!==0&&(f=!0,o===1)){let e=l[0],t=u[0];if(e>0&&e<1&&t>0&&t<1)return r[0]=!0,!1}}if(!f){r[0]=!0;let i=G.constructEmpty();e.queryEnvelope(i),i.inflateCoords(n,n);let s=new X,c=e,l=!1;for(let n=0,r=t.getPathCount();n<r;n++)if(t.getPathSize(n)>0){let r=G.constructEmpty();if(t.queryPathEnvelope(n,r),!i.isIntersecting(r))return!1;{let e=Gp(c,t.getXY(t.getPathStart(n)),0);if(U(e!==-1),e===0)return!1}l||=(!Kp(e,t.getPathCount()-1)||a.getAccelerators()!==null&&a.getAccelerators().getQuadTree()!==null?c=e:(e.copyTo(s),s.getImpl().buildQuadTreeAccelerator(1),c=s),!0)}if(e.getPathCount()===1||t.getGeometryType()===L.enumPolyline)return!0;let u=t,d=G.constructEmpty();u.queryEnvelope(d),d.inflateCoords(n,n);let f=new X,p=u,m=!1;for(let t=0,n=e.getPathCount();t<n;t++)if(e.getPathSize(t)>0){let n=G.constructEmpty();if(e.queryPathEnvelope(t,n),d.isIntersecting(n)){let n=Gp(p,e.getXY(e.getPathStart(t)),0);if(U(n!==-1),n===1)return!1}m||=(!Kp(u,e.getPathCount()-1)||o.getAccelerators()!==null&&o.getAccelerators().getQuadTree()!==null?p=u:(u.copyTo(f),f.getImpl().buildQuadTreeAccelerator(1),p=f),!0)}return!0}return!1}function pg(e,t,n){let r=G.constructEmpty();return r.setCoords({env2D:e}),r.inflateCoords(n,n),r.containsEnvelope(t)}function mg(e,t,n){let r=G.constructEmpty();return r.setCoords({env2D:t}),r.inflateCoords(n,n),e.containsExclusiveEnvelope(r)}function hg(e,t,n){let r=G.constructEmpty();return r.setCoords({env2D:t}),r.inflateCoords(n,n),!r.contains(e.getLowerLeft())||!r.contains(e.getLowerRight())||!r.contains(e.getUpperLeft())||!r.contains(e.getUpperRight())}function gg(e,t,n,r){if(e.getPathCount()!==t.getPathCount()||e.getPointCount()!==t.getPointCount())return!1;if(e.hasNonLinearSegments()||t.hasNonLinearSegments())return e.equals(t);let i=new z,a=new z,o=!0,s=n*n;for(let n=0;n<e.getPathCount();n++){if(e.getPathEnd(n)!==t.getPathEnd(n)){o=!1;break}for(let r=e.getPathStart(n);r<t.getPathEnd(n);r++)if(e.queryXY(r,i),t.queryXY(r,a),z.sqrDistance(i,a)>s){o=!1;break}if(!o)break}return!!o}function _g(e,t,n,r){if(e.getPointCount()!==t.getPointCount())return!1;let i=new z,a=new z,o=!0,s=n*n;for(let n=0;n<e.getPointCount();n++)if(e.queryXY(n,i),t.queryXY(n,a),z.sqrDistance(i,a)>s){o=!1;break}return!!o}function vg(e,t,n,r,i,a,o){let s=e.getImpl(),c=t.getImpl(),l=s.getPointCount(),u=c.getPointCount(),d=H(l,!1),f=i||a?H(u,!1):[],p=n*n,m=new km(s,c,n);for(;m.next();){let e=m.getRedElement(),t=m.getBlueElement(),n=s.getXY(e),r=c.getXY(t);z.sqrDistance(n,r)<=p&&(d[e]=!0,(i||a)&&(f[t]=!0))}let h=!1,g=!1;for(let e=0;e<l;e++){let t=d[e];if(h||=!t,g||=t,(i||r)&&h)return!1}if(r)return!0;let _=!1,v=!1;for(let e=0;e<u;e++){let t=f[e];if(_||=!t,v||=t,i&&_)return!1}return!!i||h&&g&&_&&v}function yg(e,t,n,r){return bg(e,t,n,r)&&bg(t,e,n,r)}function bg(e,t,n,r){if(ut(e),ut(t),t.isEmpty())return!1;let i=!0,a=H(2,NaN),o=H(2,NaN),s=[],c=new Bg,l,u=G.constructEmpty(),d=G.constructEmpty(),f=G.constructEmpty();e.queryEnvelope(u),t.queryEnvelope(d),u.inflateCoords(n,n),d.inflateCoords(n,n),f.setCoords({env2D:u}),f.intersect(d);let p=e.getImpl().querySegmentIterator(),m=t.getImpl().querySegmentIterator(),h=t.getImpl().getAccelerators(),g=null,_=null,v=null,y=null;if(h!==null&&(g=h.getQuadTree(),_=h.getQuadTreeForPaths(),_!==null&&(y=_.getIteratorForQT())),g===null){let n=e.getPointCount(),r=t.getPointCount();n>10&&r>10&&(g=tr(t.getImpl(),f))}for(g!==null&&(v=g.getIteratorForQT());p.nextPath();)for(;p.hasNextSegment();){let e=p.nextSegment();if(e.queryEnvelope(u),!u.isIntersecting(f))return i=!1,!1;if(y!==null&&(y.resetIterator(u,n),y.next()===-1))continue;let t=0,h=null;if(v!=null)v.resetIterator(e,n);else if(m.resetToFirstPath(),!m.nextPath())return i=!1,!1;do if(t=0,v!==null){let r=v.next();if(r===-1)return i=!1,!1;m.resetToVertex(g.getElement(r),-1),h=m.nextSegment(),t=e.intersect(h,null,a,o,n)}else{for(;!m.hasNextSegment();)if(!m.nextPath())return i=!1,!1;h=m.nextSegment(),h.queryEnvelope(d),d.inflateCoords(n,n),u.isIntersecting(d)&&(t=e.intersect(h,null,a,o,n))}while(t!==2||a[0]!==0||r&&!(o[0]<=o[1]));let _=NaN,b=!1;do{let r=!1;if(a[1]===1){if(!p.hasNextSegment()){b=!0;break}e=p.nextSegment(),r=!0}if(o[1]===1&&o[0]<=o[1]){if(_===-1||(_=1,!m.hasNextSegment()))break;h=m.nextSegment(),r=!0}if(o[1]===0&&o[0]>o[1]){if(_===1)break;if(Number.isNaN(_)){if(!m.hasPreviousSegment())break;m.previousSegment(),_=-1}if(!m.hasPreviousSegment())break;h=m.previousSegment(),r=!0}if(!r)break;t=e.intersect(h,null,a,o,n)}while(t===2&&(!r||o[0]<=o[1]));if(b)continue;let x=e.calculateLength2D();e.queryEnvelope(u),s.length=0,c.m_overlapEvents.length=0;let S=!1,C=!1,w=0,T=Rn(null,u,!0);for(v===null?(m.resetToFirstPath(),m.nextPath()||B(`relational_operations`)):v.resetIterator(e,n);;){if(t=0,v!==null){let r=v.next();if(r===-1)break;m.resetToVertex(g.getElement(r),-1),h=m.nextSegment(),t=e.intersect(h,null,a,o,n)}else{for(;!m.hasNextSegment()&&m.nextPath(););if(!m.hasNextSegment())break;h=m.nextSegment(),h.queryEnvelope(d),d.inflateCoords(n,n),u.isIntersecting(d)&&(t=e.intersect(h,null,a,o,n))}if(t===2&&(!r||o[0]<=o[1])){let e=p.getStartPointIndex(),t=p.getPathIndex(),r=m.getStartPointIndex(),i=m.getPathIndex();if(l=zg(e,t,a[0],a[1],r,i,o[0],o[1]),c.m_overlapEvents.push(l),s.push(s.length),!(S||l.m_scalarA0<w&&l.m_scalarA1<w)){if(w===0&&x*(l.m_scalarA0-w)>n)S=!0;else if(w!==0&&x*(l.m_scalarA0-w)>T)S=!0;else if(w=l.m_scalarA1,x*(1-w)<=n||w===1){C=!0;break}}}}if(!C){if(!S)return i=!1,!1;s.length>1&&s.sort((e,t)=>c.compareOverlapEvents(e,t)),w=0;for(let e=0;e<c.m_overlapEvents.length;e++)if(l=c.m_overlapEvents[s[e]],!(l.m_scalarA0<w&&l.m_scalarA1<w)){if(w===0&&x*(l.m_scalarA0-w)>n||w!==0&&x*(l.m_scalarA0-w)>T)return i=!1,!1;if(w=l.m_scalarA1,x*(1-w)<=n||w===1)break}if(x*(1-w)>n)return i=!1,!1;s.length=0,c.m_overlapEvents.length=0}}return i}function xg(e,t,n){let r=e.getImpl(),i=t.getImpl(),a=r.querySegmentIterator(),o=i.querySegmentIterator(),s=new km(r,i,n);for(;s.next();){let e=s.getRedElement(),t=s.getBlueElement();a.resetToVertex(e,-1),o.resetToVertex(t,-1);let r=a.nextSegment();if(o.nextSegment().isIntersecting(r,n))return!0}return!1}function Sg(e,t,n,r){let i=e.getImpl(),a=t.getImpl(),o=i.querySegmentIterator(),s=a.querySegmentIterator(),c=H(2,NaN),l=new km(i,a,n),u=!1,d=-1;for(;l.next();){let e=l.getRedElement(),t=l.getBlueElement();o.resetToVertex(e,-1),s.resetToVertex(t,-1);let i=o.nextSegment(),a=s.nextSegment(),f=0;if(Rg(i,a)){if(a.isIntersecting(i,n))return-2}else f=i.intersect(a,null,c,null,n);if(f){if(f===2){let e=i.calculateLength2D(),t=c[0];if(e*(c[1]-t)>n)return d=1,d;u=!0}else if(d=0,r){let e=c[0],t=new z;i.queryCoord2D(e,t),r.push(t.x),r.push(t.y)}}}return u?-2:d}function Cg(e,t,n,r){let i=e.getImpl(),a=t,o=a.getPointCount(),s=r?H(o,!1):[],c=new km(i,a,n,!1),l=i.querySegmentIterator();for(;c.next();){let e=c.getRedElement(),t=c.getBlueElement();l.resetToVertex(e,-1);let i=l.nextSegment(),o=a.getXY(t);if(i.isIntersectingPoint(o,n)){if(!r)return!0;s[t]=!0}}if(!r)return!1;for(let e=0;e<o;e++)if(!s[e])return!1;return!0}function wg(e,t,n){let r=new z,i=n*n,a=e.querySegmentIterator(),o=e.getImpl().getAccelerators();if(o!==null){let e=o.getQuadTree();if(e!==null){let o=G.constructEmpty();o.setCoords({pt:t});let s=e.getIterator(o,n);for(let n=s.next();n!==-1;n=s.next())if(a.resetToVertex(e.getElement(n),-1),a.hasNextSegment()){let e=a.nextSegment(),n=e.getClosestCoordinate(t,!1);if(e.queryCoord2D(n,r),z.sqrDistance(t,r)<=i)return!0}return!1}}let s=G.constructEmpty();for(;a.nextPath();)for(;a.hasNextSegment();){let e=a.nextSegment();if(e.queryEnvelope(s),s.inflateCoords(n,n),!s.contains(t))continue;let o=e.getClosestCoordinate(t,!1);if(e.queryCoord2D(o,r),z.sqrDistance(t,r)<=i)return!0}return!1}function Tg(e,t,n){return wg(e,t,n)&&!Ig(e,t,n)}function Eg(e,t,n,r){let i=e.querySegmentIterator(),a=e.getImpl().getAccelerators(),o=e.hasNonLinearSegments(),s=null,c=null,l=null,u=null;if(a!==null){let e=a.getQuadTree();if(e!==null){let r=e.getIterator(t,n);o&&(s=new Z,c=new Z,l=new Z,u=new Z,t.querySide(0,s),t.querySide(1,c),t.querySide(2,l),t.querySide(3,u));let a=G.constructEmpty();a.setCoords({env2D:t}),a.inflateCoords(n,n);for(let o=r.next();o!==-1;o=r.next())if(i.resetToVertex(e.getElement(o),-1),i.hasNextSegment()){let e=i.nextSegment();if(e.getGeometryType()===L.enumLine){let t=e.getStartXY(),n=e.getEndXY();if(a.clipLine(t,n))return!0;continue}if(t.contains(e.getStartXY())||t.contains(e.getEndXY())||e.isIntersecting(s,n)||e.isIntersecting(c,n)||e.isIntersecting(l,n)||e.isIntersecting(u,n))return!0}return!1}}if(o){s=new Z,c=new Z,l=new Z,u=new Z,t.querySide(0,s),t.querySide(1,c),t.querySide(2,l),t.querySide(3,u);let r=e.querySegmentIterator();for(;r.nextPath();)for(;r.hasNextSegment();){let e=r.nextSegment();if(t.contains(e.getStartXY())||t.contains(e.getEndXY())||e.isIntersecting(s,n)||e.isIntersecting(c,n)||e.isIntersecting(l,n)||e.isIntersecting(u,n))return!0}}else{let r=G.constructEmpty();r.setCoords({env2D:t}),r.inflateCoords(n,n);let i=e.getImpl(),a=i.getAttributeStreamRef(0),o=new z;for(let e=0,t=i.getPathCount();e<t;e++){let t=!0,n=new z,s=new z,c=new z,l=i.getPathStart(e),u=new z;for(let d=l,f=i.getPathEnd(e);d<f;d++)if(t)a.queryPoint2D(2*d,n),u.assign(n),t=!1;else{if(a.queryPoint2D(2*d,o),s.setCoordsPoint2D(n),c.setCoordsPoint2D(o),r.clipLine(s,c))return!0;n.assign(o)}if(i.isClosedPath(e)&&!t&&(s.setCoordsPoint2D(n),c.setCoordsPoint2D(u),r.clipLine(s,c)))return!0}}return!1}function Dg(e,t,n,r){let i=e.getImpl(),a=t.getImpl(),o=[0],s=Un(i.getIsSimple(0,o))&&Un(a.getIsSimple(0,o)),c=i.querySegmentIterator(),l=a.querySegmentIterator(),u=H(2,0),d=H(2,0),f=new km(i,a,n),p=!1;for(;f.next();){let e=f.getRedElement(),t=f.getBlueElement();c.resetToVertex(e,-1),l.resetToVertex(t,-1);let r=c.nextSegment(),i=l.nextSegment(),a=0;if(Rg(r,i)){if(i.isIntersecting(r,n)){p=!0;break}}else a=i.intersect(r,null,d,u,n);if(a===2){let e=u[0],t=u[1],i=r.calculateLength2D();if(s&&(t-e)*i>n)return!1;p=!0}else if(a){let e=u[0],t=d[0];if(e>0&&e<1&&t>0&&t<1)return!1;p=!0}}if(!p)return!1;let m=G.constructEmpty(),h=G.constructEmpty(),g=G.constructEmpty(),_,v;if(e.queryEnvelope(m),t.queryEnvelope(h),m.inflateCoords(1e3*n,1e3*n),h.inflateCoords(1e3*n,1e3*n),g.setCoords({env2D:m}),g.intersect(h),e.getPointCount()>10){if(_=qd(e,g,n,0,r),_.isEmpty())return!1}else _=e;if(t.getPointCount()>10){if(v=qd(t,g,n,0,r),v.isEmpty())return!1}else v=t;return em(_,v,n,`F********`,r,!1)}function Og(e,t,n,r){let i=e.getImpl(),a=t.getImpl(),o=[0],s=Un(i.getIsSimple(0,o))&&Un(a.getIsSimple(0,o)),c=G.constructEmpty(),l=G.constructEmpty(),u=G.constructEmpty();e.queryEnvelope(c),t.queryEnvelope(l);let d=!1,f=hg(c,l,n),p=hg(l,c,n),m=i.querySegmentIterator(),h=a.querySegmentIterator(),g=H(2,NaN),_=H(2,NaN),v=new km(i,a,n);for(;v.next();){let e=v.getRedElement(),t=v.getBlueElement();m.resetToVertex(e,-1),h.resetToVertex(t,-1);let r=m.nextSegment(),i=h.nextSegment(),a=0;if(Rg(r,i)){if(i.isIntersecting(r,n))break}else a=i.intersect(r,null,_,g,n);if(a===2){let e=g[0],t=g[1],i=r.calculateLength2D();if(s&&(t-e)*i>n&&(d=!0,f&&p))return!0}else if(a){let e=g[0],t=_[0];if(e>0&&e<1&&t>0&&t<1)return!0}}let y=G.constructEmpty(),b=G.constructEmpty(),x,S;y.setCoords({env2D:c}),y.inflateCoords(1e3*n,1e3*n),b.setCoords({env2D:l}),b.inflateCoords(1e3*n,1e3*n),u.setCoords({env2D:y}),u.intersect(b);let C=``;if(C+=d?`**`:`T*`,f){if(t.getPointCount()>10){if(S=qd(t,u,n,0,r),S.isEmpty())return!1}else S=t;C+=`****`}else S=t,C+=`T***`;if(p){if(e.getPointCount()>10){if(x=qd(e,u,n,0,r),x.isEmpty())return!1}else x=e;C+=`***`}else x=e,C+=`T**`;return em(x,S,n,C,r,!1)}function kg(e,t,n,r){let i=[!1],a=fg(e,t,n,i);if(i[0])return a;let o=G.constructEmpty(),s;if(t.queryEnvelope(o),o.inflateCoords(1e3*n,1e3*n),e.getPointCount()>10){if(s=qd(e,o,n,0,r),s.isEmpty())return!1}else s=e;return tm(s,t,n,r)}function Ag(e,t,n,r){let i=e.getImpl(),a=t.getImpl(),o=i.querySegmentIterator(),s=a.querySegmentIterator(),c=H(2,NaN),l=H(2,NaN),u=new km(i,a,n),d=!1;for(;u.next();){let e=u.getRedElement(),t=u.getBlueElement();o.resetToVertex(e,-1),s.resetToVertex(t,-1);let r=o.nextSegment(),i=s.nextSegment(),a=0;if(Rg(r,i)?!d&&i.isIntersecting(r,n)&&(d=!0):a=i.intersect(r,null,l,c,n),a===2)d=!0;else if(a){let e=c[0],t=l[0];if(e>0&&e<1&&t>0&&t<1)return!1;d=!0}}if(!d)return!1;let f=G.constructEmpty(),p=G.constructEmpty(),m=G.constructEmpty(),h,g;if(e.queryEnvelope(f),t.queryEnvelope(p),f.inflateCoords(1e3*n,1e3*n),p.inflateCoords(1e3*n,1e3*n),m.setCoords({env2D:f}),m.intersect(p),e.getPointCount()>10){if(h=qd(e,m,n,0,r),h.isEmpty())return!1}else h=e;if(t.getPointCount()>10){if(g=qd(t,m,n,0,r),g.isEmpty())return!1}else g=t;return em(h,g,n,`F********`,r,!1)}function jg(e,t,n,r){let i=e.getImpl(),a=t.getImpl(),o=i.querySegmentIterator(),s=a.querySegmentIterator(),c=H(2,NaN),l=H(2,NaN),u=new km(i,a,n),d=!1;for(;u.next();){let e=u.getRedElement(),t=u.getBlueElement();o.resetToVertex(e,-1),s.resetToVertex(t,-1);let r=o.nextSegment(),i=s.nextSegment(),a=0;if(Rg(r,i)?!d&&i.isIntersecting(r,n)&&(d=!0):a=i.intersect(r,null,l,c,n),a===2)d=!0;else if(a){let e=c[0],t=l[0];if(e>0&&e<1&&t>0&&t<1)return!0;d=!0}}if(!d)return!1;let f=G.constructEmpty(),p=G.constructEmpty(),m=G.constructEmpty(),h=G.constructEmpty(),g=G.constructEmpty();if(e.queryEnvelope(f),t.queryEnvelope(p),hg(p,f,n)){let i,a;if(m.setCoords({env2D:f}),m.inflateCoords(1e3*n,1e3*n),h.setCoords({env2D:p}),h.inflateCoords(1e3*n,1e3*n),g.setCoords({env2D:m}),g.intersect(h),e.getPointCount()>10){if(i=qd(e,g,n,0,r),i.isEmpty())return!1}else i=e;if(t.getPointCount()>10){if(a=qd(t,g,n,0,r),a.isEmpty())return!1}else a=t;return em(i,a,n,`T********`,r,!1)}return em(e,t,n,`T*****T**`,r,!1)}function Mg(e,t,n,r){let i=[!1],a=fg(e,t,n,i);if(i[0])return a;let o=G.constructEmpty(),s;if(t.queryEnvelope(o),o.inflateCoords(1e3*n,1e3*n),e.getPointCount()>10){if(s=qd(e,o,n,0,r),s.isEmpty())return!1}else s=e;return nm(s,t,n,r)}function Ng(e,t,n,r){return Hg(e,t,n)===1}function Pg(e,t,n,r){return Hg(e,t,n)===2}function Fg(e,t,n,r){let i=new z,a=n*n;for(let n=0;n<e.getPointCount();n++)if(e.queryXY(n,i),z.sqrDistance(i,t)<=a)return!1;return!0}function Ig(e,t,n){let r=e.getBoundary();return!r.isEmpty()&&!Fg(r,t,n)}function Lg(e,t,n){let r=G.constructEmpty();return r.setCoords({env2D:e}),r.inflateCoords(n,n),r.containsEnvelope(t)?1073741824:r.isIntersecting(t)?e.isIntersecting(t)?e.xmin<t.xmin&&t.xmax<e.xmax?t.ymin<e.ymin&&t.ymax>e.ymax?0:1073741824:e.ymin<t.ymin&&t.ymax<e.ymax?t.xmin<e.xmin&&t.xmax>e.xmax?0:1073741824:0:0:4}function Rg(e,t){return e.getGeometryType()!==L.enumLine||t.getGeometryType()!==L.enumLine}function zg(e,t,n,r,i,a,o,s){return{m_ivertexA:e,m_ipathA:t,m_scalarA0:n,m_scalarA1:r,m_ivertexB:i,m_ipathB:a,m_scalarB0:o,m_scalarB1:s}}var Bg=class{constructor(){this.m_overlapEvents=[]}compareOverlapEvents(e,t){let n=this.m_overlapEvents[e],r=this.m_overlapEvents[t];return n.m_ipathA<r.m_ipathA||n.m_ipathA===r.m_ipathA&&(n.m_ivertexA<r.m_ivertexA||n.m_ivertexA===r.m_ivertexA&&(n.m_scalarA0<r.m_scalarA0||n.m_scalarA0===r.m_scalarA0&&(n.m_scalarA1<r.m_scalarA1||n.m_scalarA1===r.m_scalarA1&&n.m_ivertexB<r.m_ivertexB)))?-1:1}};function Vg(e,t,n){let r=Wp(e,t,n);return r?r===1?1:2:0}function Hg(e,t,n){let r=Gp(e,t,n);return r?r===1?1:2:0}function Ug(e,t,n,r,i){for(let a=0;a<n;a++)i[a]=Hg(e,t[a],r)}function Wg(e,t,n,r,i){if(e.getGeometryType()===L.enumPolygon)Ug(e,t,n,r,i);else if(e.getGeometryType()===L.enumEnvelope){let a=G.constructEmpty();e.queryEnvelope(a),Kg(a,t,n,r,i)}else ge(``)}function Gg(e,t,n,r,i){let a=e.getGeometryType();a===L.enumPolyline?Yg(e,t,n,r,i):Ne(a)?Jg():ge(``)}function Kg(e,t,n,r,i){if(e.isEmpty()){for(let e=0;e<n;e++)i[e]=0;return}let a=e.clone();a.inflateCoords(.5*-r,.5*-r);let o=e.clone();o.inflateCoords(.5*r,.5*r);for(let e=0;e<n;e++)a.contains(t[e])?i[e]=1:o.contains(t[e])?i[e]=2:i[e]=0}function qg(e,t,n){if(n.reset(),t<3)return;let r=e[0].clone(),i=r.x,a=r.y,o=e[1].clone(),s=new z;for(let i=2;i<t;i++)s.assign(e[i]),n.pe((s.x-r.x)*(o.y-a)),r.assign(o),o.assign(s);n.pe((i-r.x)*(o.y-a))}function Jg(e,t,n,r,i){U(0)}function Yg(e,t,n,r,i){let a=e.getImpl(),o=a.getAccelerators(),s=null;o&&(s=o.getRasterizedGeometry());let c=n;for(let e=0;e<n;e++)i[e]=1,s&&U(0);if(c){if(o){let e=null;o!==null&&o.getQuadTree()!==null&&(e=o.getQuadTree());let s=a.getPointCount();if(e===null&&s>20&&s*n>4*s+Math.log(s)*n&&(e=tr(a)),e){let o=null,s=a.querySegmentIterator(),l=new G;for(let a=0;a<n&&c;a++)if(i[a]===1){l.setCoords(t[a]),o===null?o=e.getIterator(l,r):o.resetIterator(l,r);let n=-1;for(let l=o.next();l!==-1;l=o.next()){if(s.resetToVertex(e.getElement(l),n),n=s.getPathIndex(),s.nextSegment().isIntersectingPoint(t[a],r)){i[a]=2,c--;break}i[a]=0}}return}}let e=a.querySegmentIterator();for(;e.nextPath()&&c;)for(;e.hasNextSegment()&&c;){let a=e.nextSegment();for(let e=0;e<n&&c;e++)i[e]===1&&a.isIntersectingPoint(t[e],r)&&(i[e]=2,c--)}}for(let e=0;e<n;e++)i[e]===1&&(i[e]=0)}function Xg(e,t,n,r,i){let a=Wr(t),o=Math.max(4*a,n);return new n_(t,null,o,NaN,i).approximateWithCirclesImpl(e,r)}function Zg(){return Number.isNaN(this.radius.value())}function Qg(){return{ptStart:new z,ptEnd:new z,center:new J,radius:new P,fcenter:new br,fradius2:new A,maxError:NaN,isLine:Zg}}var $g=5,e_=1/8;function t_(e,t,n,r){return{pt:e.clone(),t,err:n,checkCount:r}}var n_=class e{constructor(e,t,n,r,i){this.m_left=e,this.m_tracker=i,this.m_eps=n,this.m_trackerCounter=0,this.m_tolerance=r,this.m_circleCheckCounter=0,this.m_bReversedLeft=!1,this.m_leftArc=Qg()}closeToCircularArc(t,n,r,i,a,o){if(this.m_circleCheckCounter++,o.maxError=0,!e.checkSweepAngle(t,n))return!1;if(o.ptStart.setCoordsPoint2D(r),o.ptEnd.setCoordsPoint2D(a),t.isCircular()){let e=t;return o.fradius2=A.constructDouble(e.getSemiMajorAxis()).mulDouble(e.getSemiMajorAxis()),o.radius.set(e.getSemiMajorAxis()),o.fcenter.assignPoint2D(e.getCenter()),o.center.set(e.getCenter()),!0}let s=o.ptEnd.sub(o.ptStart).clone();if(s.leftPerpendicularThis(),s.normalize(),Math.abs(s.dotProduct(i.sub(o.ptStart)))<=this.m_eps)return!!this.confirmIsLine(o,s)&&(o.radius.set(NaN),o.center.setCoords(0,0),!0);{let e=o.ptEnd.sub(o.ptStart),r=i.sub(o.ptStart),a=e.crossProduct(r);if(a===0)return!1;let s=.5*e.sqrLength(),c=.5*r.sqrLength(),l=s*r.y-c*e.y;l/=a;let u=e.x*c-r.x*s;u/=a;let d=Math.sqrt(l*l+u*u);if(4*2**-52*d>this.m_eps)return!1;let f=l+o.ptStart.x,p=u+o.ptStart.y;o.radius.set(d),o.center.setCoords(f,p);let m=this.maxCircleApproximationError(t,n,o);if(m>this.m_eps)return o.maxError=m,!1}let c=new br().assignPoint2D(o.ptStart),l=new br().assignPoint2D(o.ptEnd).sub(c),u=new br().assignPoint2D(i).sub(c),d=l.crossProduct(u);if(d.isZero())return!1;let f=l.sqrLength().mulDouble(.5),p=u.sqrLength().mulDouble(.5),m=f.mul(u.y).sub(p.mul(l.y)),h=l.x.mul(p).sub(u.x.mul(f)),g=m.mul(m).add(h.mul(h)),_=d.clone();_.invertThis(),o.fradius2=g.mul(_).mul(_),o.fcenter.setCoords(m.mul(_).add(c.x),h.mul(_).add(c.y)),o.center.setWithEps(o.fcenter.asPoint2D()),o.radius.setWithEps(Math.sqrt(o.fradius2.toDouble()));let v=J.constructPoint2D(o.ptStart).subE(o.center),y=J.constructPoint2D(o.ptEnd).subE(o.center);if(!v.dotProduct(y).gt(bt))return!1;let b=this.maxCircleApproximationError(t,n,o);return o.maxError=b,b<=this.m_eps}static checkSweepAngle(e,t){if(e.getGeometryType()===L.enumEllipticArc){let n=e,r=Uu(n,t.vmin),i=Uu(n,t.vmax);return!(Math.abs(i-r)>.5*nt)}return!0}confirmIsLine(e,t){let n=e.ptEnd.sub(e.ptStart);return!(Math.abs(t.dotProduct(n.mul(.25)))>this.m_eps)&&!(Math.abs(t.dotProduct(n.mul(.75)))>this.m_eps)}maxCircleApproximationError(e,t,n){let r=[.25,.75],i=[.1,.25,.75,.9],a,o;e.getGeometryType()===L.enumEllipticArc?(a=r,o=r.length):(a=i,o=i.length);let s=0;for(let r=0;r<o;++r){let i=new z;e.queryCoord2D(c(t.vmin,t.vmax,a[r]),i);let o=i.sub(n.center.value()).length(),l=Math.abs(o-n.radius.value());l>s&&(s=l)}return s}approximateWithCirclesImpl(t,n){let r=1;n&&n.push(0);let i=H(9,NaN),a;t?a=this.m_left.getMonotonicPartParams(i.length,i):(i[0]=0,i[1]=1,a=2);let o=[],s=[],c=new z(0,0);for(let t=1;t<a;t++){let a=new I(i[t-1],i[t]);for(this.m_bReversedLeft=!e.goodOrientation(this.m_left,a),this.m_bReversedLeft?(o.push(t_(c,a.vmin,0,0)),o.push(t_(c,a.vmax,0,0))):(o.push(t_(c,a.vmax,0,0)),o.push(t_(c,a.vmin,0,0))),o[0].pt=this.m_left.getCoord2D(o[0].t),o[1].pt=this.m_left.getCoord2D(o[1].t);o.length>1;){this.progress_();let e=o.at(-1),t=e.checkCount,i=e.err,a=e.pt.clone(),c=e.t,l=o[o.length-2].t,u=.5*(c+l),d=this.m_left.getCoord2D(u);if(i<=this.m_eps||t>=$g){let e=new I;if(e.setCoords(c,l),this.closeToCircularArc(this.m_left,e,a,d,o[o.length-2].pt,this.m_leftArc)){n&&(this.m_bReversedLeft?s.push(c):n.push(l)),r++,o.pop();continue}t=0,i=this.m_leftArc.maxError}e.t=u,e.pt.setCoordsPoint2D(d),i*=e_,t++,e.err=i,e.checkCount=t,o.push(t_(a,c,i,t))}this.m_bReversedLeft&&n&&(n.length+=s.length,Qe(n,s.reverse(),n.length-s.length,0,s.length),s.length=0),o.length=0}return r}approximateWithCirclesImplPolyline(e){let t=new Bi,n=[];if(!this.approximateWithCirclesImpl(!0,n))return t;let r=0,i=this.m_left.getStartXY();t.startPath(i);for(let a=1;a<n.length;++a)if(e)t.lineTo(this.m_left.getCoord2D(n[a]));else{let e=new z;this.m_left.queryCoord2D(n[a],e);let o=new z;this.m_left.queryCoord2D(.5*(n[a]+r),o);let s=new xu;s.constructCircularArcThreePoint(i,e,o),t.addSegment(s,!1),i.assign(e),r=n[a]}return t}static goodOrientation(e,t){let n=e.getCoord2D(t.vmin),r=e.getCoord2D(t.vmax);return n.compare(r)<0}progress_(e=!1){}};function r_(e,t,n,r,i,a,o){a_(e,t,n,i,a,o),v_(e,n,o)}function i_(e,t,n,r){if(!V(e.getGeometryType()))return e;let i=e.getImpl();if(!i.hasNonLinearSegments())return e;let a=e.createInstance();a.getGeometryType()===L.enumPolygon&&a.setFillRule(e.getFillRule()),new os;let o=new q,s=new Q,c=[],l=[],u=[],d=e.getDescription().getAttributeCount()>1,f=i.querySegmentIterator();for(;f.nextPath();){let e=!0;for(;f.hasNextSegment();){let r=f.isClosingSegment(),i=f.nextSegment();if(!i.isCurve()){a.addSegment(i,e,r),e=!1;continue}let p,m=!1;switch(i.getGeometryType()){case L.enumEllipticArc:case L.enumRationalBezier2:p=Du(i,t,n,!0,!0,l,u,c),m=!0;break;default:p=Eu(i,t,n,!0,!0,l,c)}let h=m?2:3;l[1].isNAN()?(s.createLine(),s.get().construct(l[0],l[h])):m?(s.createQuadraticRationalBezier(),s.get().constructArrayWeights(l,u)):(s.createCubicBezier(),s.get().constructPoints(l)),d&&e&&(i.queryCoord(c[0],o),s.get().setStart(o)),d&&(i.queryCoord(c[1],o),s.get().setEnd(o)),a.addSegment(s.get(),e,r&&p===1),e=!1;for(let e=1,t=p,n=h;e<t;++e,n+=h)l[n+1].isNAN()?(s.createLine(),s.get().construct(l[n],l[n+h])):m?(s.createQuadraticRationalBezier(),s.get().constructArrayWeights(l.slice(n),u.slice(n))):(s.createCubicBezier(),s.get().constructPoints(l.slice(n))),d&&(i.queryCoord(c[e+1],o),s.get().setEnd(o)),a.addSegment(s.get(),!1,r&&e+1===t)}}return a}function a_(e,t,n,r,i,a){e.hasCurves()?(e.setCurveStitcherPointer(r),r.m_impl=new m_(a,!1,null),r.m_impl.buildMonotonicCurveParentage(e,t,n,i)):r.m_impl=null}function o_(e,t,n,r,i,a,o,s){e.hasCurves()?(e.setCurveStitcherPointer(a),a.m_impl=new m_(s,!0,i),a.m_impl.buildMonotonicCurveParentage(e,t,n,o),v_(e,n,s)):a.m_impl=null}function s_(e){if(!e.hasSegmentParentage())return;let t=e.queryVertexIteratorOnSelection();for(let n=t.next();n!==-1;n=t.next())if(!e.getSegmentParentageBreakVertex(n)){e.getPathFromVertex(n);let t=e.getPrevVertex(n),r=t===-1?-1:e.getSegmentParentage(t),i=e.getSegmentParentage(n);i!==-1&&r!==-1&&i!==r&&e.setSegmentParentageBreakVertex(n,!0)}}function c_(e){if(!e.hasSegmentParentage())return;s_(e);let t=new sn(0),n=e.queryVertexIteratorOnSelection();for(let e=n.next();e!==-1;e=n.next())t.add(e);if(t.size()===0)return;e.sortVerticesSimpleByY(t,0,t.size()),t.add(-1);let r=z.getNAN();e.queryXY(t.read(0),r);let i=0,a=z.getNAN();for(let n=1,o=t.size();n<o;n++){{let r=t.read(n);r===-1?a.setNAN():e.queryXY(r,a)}if(!a.isEqualPoint2D(r)){if(n-i>1){let r=!1;for(let a=i;a<n;++a){let n=t.read(a);if(e.getSegmentParentageBreakVertex(n)){r=!0;break}}if(!r){let a=(t,n,r)=>{let i=e.getPrevVertex(t),a=e.getNextVertex(t);i===-1?n.setNAN():n.assign(e.getXY(i)),a===-1?r.setNAN():r.assign(e.getXY(a))},o=new z,s=new z;a(t.read(i),o,s);for(let e=i+1;e<n;++e){let n=t.read(e);if(n===-1)continue;let i=new z,c=new z;a(n,i,c);let l=(e,t)=>!!(e.equals(t)||e.isNAN()&&t.isNAN());if(!(l(i,o)&&l(c,s)||l(c,o)&&l(i,s))){r=!0;break}}}if(r)for(let r=i;r<n;++r)e.setSegmentParentageBreakVertex(t.read(r),!0)}r.setCoordsPoint2D(a),i=n}}}function l_(e,t){let n=t.isEmpty()?e:Pn(null,t,!0).total();return n>e&&(n=e),.125*n}function u_(e,t){return t||=G.constructEmpty(),l_(e,t)}function d_(e,t){return .125*e}function f_(e,t){return 3*e+3*t}var p_=class{constructor(){this.m_impl=null}stitchCurves(e,t,n,r){this.m_impl&&(this.m_impl.stitchCurves(e,t,n),r&&this.clearStitcher(e))}clearStitcher(e){this.m_impl&&=(this.m_impl.clearStitcher(e),null)}getOriginalVertexIndex(e,t){return this.m_impl.getOriginalVertexIndex(e,t)}getOriginalSegmentTypeInfo(e){return this.m_impl.getOriginalSegmentTypeInfo(e)}},m_=class e{constructor(e,t,n){this.m_originalPlanarSegments=[],this.m_progressTracker=null,this.m_nsr=null,this.m_progressTracker=e,this.m_nsr=n,this.m_tolerance=0,this.m_originalVertexIndex=-1,this.m_type=1,this.m_progressCounter=0,this.m_bIsSimple=t,this.m_densificationDeviation=NaN,this.m_maxSegmentsPerCurve=-1}buildMonotonicCurveParentage(t,n,r,i){if(!t.hasCurves())return;U(!t.hasSegmentParentage()),this.m_originalPlanarSegments.length=0,this.m_bIsSimple&&(this.m_originalVertexIndex=t.createUserIndex()),this.m_tolerance=r;let a=new q,o=new Q,s=[],c=[],l=[];for(let i=t.getFirstGeometry();i!==-1;i=t.getNextGeometry(i))for(let u=t.getFirstPath(i);u!==-1;u=t.getNextPath(u)){let i=t.getPathSize(u),d=t.getFirstVertex(u),f=0,p=-1;for(let m=0;m<i;m++){let h=t.getNextVertex(d);if(!t.querySegment(d,o,!0,!1)){d=h;continue}if(f===0){p=t.getVertexIndex(d);let n=e.regularizeCurve(t,o.get(),d,r);if(n>=0){this.m_nsr&&this.m_nsr.m_reason===0&&this.m_nsr.assign(new jt(13,p,-1)),f=n,i=t.getPathSize(u),h=t.getNextVertex(d);let e=t.querySegment(d,o,!0,!1);U(e)}}else f--;let g=t.getVertexIndex(d),_;this.m_originalVertexIndex!==-1&&t.setUserIndex(d,this.m_originalVertexIndex,p),t.setSegmentToIndex(g,null);let v=!1;switch(o.get().getGeometryType()){case L.enumEllipticArc:case L.enumRationalBezier2:_=Du(o.get(),n,r,!1,!0,c,l,s),v=!0;break;default:{let e=!this.m_bIsSimple||!o.get().isMonotoneQuickAndDirty();_=Eu(o.get(),n,r,e,!1,c,s)}}let y=this.m_originalPlanarSegments.length;if(t.setSegmentParentageAndBreak(d,y,!0),!c[1].isNAN()){let e=null;e=v?new ha({points:c,weights:l}):new Gc({cp:c}),e.snapControlPoints(r*r),t.setSegmentToIndex(g,e)}let b=v?2:3;for(let e=1,n=_,i=b;e<n;++e,i+=b){o.get().queryCoord(s[e],a);let n=t.insertVertex(u,h,a);if(this.m_originalVertexIndex!==-1&&t.setUserIndex(n,this.m_originalVertexIndex,p),!c[i+1].isNAN())if(v){let e=new ha({points:c.slice(i),weights:l.slice(i)});e.snapControlPoints(r*r),t.setSegmentToIndex(t.getVertexIndex(n),e)}else{let e=new Gc({cp:c.slice(i)});e.snapControlPoints(r*r),t.setSegmentToIndex(t.getVertexIndex(n),e)}t.setSegmentParentageAndBreak(n,y,!1)}_>1&&(m+=_-1,i=t.getPathSize(u)),this.m_originalPlanarSegments.push(o.releaseSegment()),d=h}}}buildLinearSegmentParentage(t,n,r,i,a){if(this.m_type=0,this.m_densificationDeviation=n,this.m_maxSegmentsPerCurve=i,!t.hasCurves())return;U(!t.hasSegmentParentage()),this.m_tolerance=r,this.m_originalPlanarSegments=[],this.m_bIsSimple&&(this.m_originalVertexIndex=t.createUserIndex());let o=new q,s=new Q,c=new Ou(0,n,0,this.m_progressTracker,!1,i),l=[];for(let n=t.getFirstGeometry();n!==-1;n=t.getNextGeometry(n))for(let i=t.getFirstPath(n);i!==-1;i=t.getNextPath(i)){let n=t.getPathSize(i),a=t.getFirstVertex(i);for(let u=0;u<n;u++){let u=t.getNextVertex(a);if(!t.querySegment(a,s,!0,!1)){a=u;continue}if(e.regularizeCurve(t,s.get(),a,r)>=0){n=t.getPathSize(i),u=t.getNextVertex(a);let e=t.querySegment(a,s,!0,!1);U(e)}let d=t.getVertexIndex(a);this.m_originalVertexIndex!==-1&&t.setUserIndex(a,this.m_originalVertexIndex,d),t.setSegmentToIndex(d,null),l.length=0,c.densifySegment(s.get(),l),this.progress_();let f=this.m_originalPlanarSegments.length;t.setSegmentParentageAndBreak(a,f,!0);for(let e=1,n=l.length-1;e<n;++e){s.get().queryCoord(l[e],o);let n=t.insertVertex(i,u,o);t.setSegmentParentageAndBreak(n,f,!1),this.m_originalVertexIndex!==-1&&t.setUserIndex(n,this.m_originalVertexIndex,d)}this.m_originalPlanarSegments.push(s.releaseSegment()),a=u}}t.clearSegments()}stitchCurves(t,n,r){e.st_stitchCurvesImpl(this,t,n,r,!1)}clearStitcher(e){this.m_originalPlanarSegments.length=0,this.m_originalVertexIndex!==-1&&(e.removeUserIndex(this.m_originalVertexIndex),this.m_originalVertexIndex=-1),e.deleteSegmentParentage()}static st_verifyParentage(t){e.st_stitchCurvesImpl(null,t,-1,0,!0)}getOriginalVertexIndex(e,t){return this.m_originalVertexIndex!==-1&&t!==-1?e.getUserIndex(t,this.m_originalVertexIndex):-1}getOriginalSegmentTypeInfo(e){if(e!==-1){let t=this.m_originalPlanarSegments[e];switch(t.getGeometryType()){case L.enumEllipticArc:return t.projectionBehavior()===0?0:1;case L.enumBezier:return 2;case L.enumBezier2:return 3;case L.enumLine:return-1;case L.enumRationalBezier2:return 4;default:xt(``)}}return-1}progress_(e=!1){this.m_progressCounter++}processSpanSmartTe_(e,t,n,r,i,a,o){if(t===n&&r===0)return U(e.getNextVertex(t)===-1),e.setSegmentToIndex(e.getVertexIndex(t),null),void e.setSegmentParentageAndBreak(t,-1);let s=e.getNextVertex(t),c=e.getXY(t),l=e.getXY(n),u,d=0;{let t=2,i=c;for(let r=s;r!==n;r=e.getNextVertex(r)){let n=e.getXY(r);d+=z.distance(n,i),i=n,t++}d+=z.distance(l,i),U(t===r)}if(i===null)return e.setSegmentToIndex(e.getVertexIndex(t),null),void e.removeVertices(s,n);let f=o,p=i.getClosestCoordinate(c,!1),m=i.getClosestCoordinate(l,!1),h=i.calculateLength2D(),g=i.tToLength(p),_=i.tToLength(m),v=Math.abs(g)>10*f&&Math.abs(g-h)>10*f,y=Math.abs(_)>10*f&&Math.abs(_-h)>10*f,b=e=>{let t=e.calculateLength2D();return Math.abs(t-d)>Math.max(.2*d,4*f)?null:e},x=i.isClosed();if(!x){let e=z.distance(i.getStartXY(),i.getEndXY());e<=f&&h>5*e&&(x=!0)}if(x){let a,o,s=new z;if(r===2)s=z.lerp(c,l,.5),a=i.getClosestCoordinate(s,!1),o=i.tToLength(a);else{let n=e.getNextNthVertex(t,(r-1)/2);s=e.getXY(n),a=i.getClosestCoordinate(s,!1),o=i.tToLength(a);let c=Math.abs(o)>10*f&&Math.abs(o-h)>10*f;if(!c&&(r-1>=4&&(n=e.getNextNthVertex(t,(r-1)/4),a=i.getClosestCoordinate(s,!1),o=i.tToLength(a),c=Math.abs(o)>10*f&&Math.abs(o-h)>10*f),!c))return}let d=!1,x=g===_;if(x){let n=2,a=4;r-1<=4&&(n=1,a=2);let o=c,s=e.getXY(e.getNextNthVertex(t,n)),l=e.getXY(e.getNextNthVertex(t,a));d=-z.orientationNonRobust(o,s,l)*Ye(i.calculateArea2DHelper())>0}else y?v?d=o>g:o<_?(g=0,p=0):(g=h,p=1):o>g?(_=h,m=1):(_=0,m=0);if(x)u=i.clone(),u.dropAllAttributes(),d||u.reverse(),U(c.equals(l));else{let e=!1;p>m&&(e=!0,[p,m]=[m,p]),u=i.cut(p,m,!0),u.getDescription().getAttributeCount(),e&&u.reverse()}u.setCoordsForIntersector(c,l,!1),u=b(u),u&&(this.removeSpanBetween(e,t,n),e.setSegmentToIndex(e.getVertexIndex(t),u))}else if(v||y){if((!v||!y)&&z.distance(i.getStartXY(),i.getEndXY())<10*f){let r=[lt(p,m),lt(p,m),lt(p,m)];v?(r[1].second=0,r[2].second=1):(r[1].first=1,r[2].first=0);let a=[null,null,null],o=[0,0,0],s=Number.MAX_VALUE,f=0;for(let e=0;e<3;e++){let t=!1;if(r[e].first>r[e].second){t=!0;let n=r[e].first;r[e].first=r[e].second,r[e].second=n}a[e]=i.cut(r[e].first,r[e].second,!0),a[e].dropAllAttributes(),t&&a[e].reverse(),a[e].setCoordsForIntersector(c,l,!1),o[e]=a[e].calculateLength2D();let n=Math.abs(d-o[e]);n<s&&(s=n,f=e)}u=a[f],u=b(u),u&&(this.removeSpanBetween(e,t,n),e.setSegmentToIndex(e.getVertexIndex(t),u));return}let r=!1;p>m&&(r=!0,[p,m]=[m,p]),u=i.cut(p,m,!0),u.dropAllAttributes(),r&&u.reverse(),u.setCoordsForIntersector(c,l,!1),u=b(u),u&&(this.removeSpanBetween(e,t,n),e.setSegmentToIndex(e.getVertexIndex(t),u))}else{if(u=i.clone(),u.dropAllAttributes(),g>_&&u.reverse(),d<Math.max(.75*h,h-this.m_densificationDeviation*(r-1))){let e=p>m?m:p,t=u.tToLength(e)+d,n=u.lengthToT(t);n=_e(n,e,1),u=u.cut(e,n,!0)}u.setCoordsForIntersector(c,l,!1),u=b(u),u&&(this.removeSpanBetween(e,t,n),e.setSegmentToIndex(e.getVertexIndex(t),u))}}processSpanCurves_(e,t,n,r,i,a,o){if(t===n&&r===0)return U(e.getNextVertex(t)===-1),e.setSegmentToIndex(e.getVertexIndex(t),null),void e.setSegmentParentageAndBreak(t,-1);let s=e.getNextVertex(t);{let t=2;for(let r=s;r!==n;r=e.getNextVertex(r))t++;U(t===r)}if(i===null)return e.setSegmentToIndex(e.getVertexIndex(t),null),void e.removeVertices(s,n);let c=e.getXY(t),l=e.getXY(n);if(i.isClosed()){if(c.isEqualPoint2D(l)&&c.isEqualPoint2D(i.getStartXY())){let s;if(s=this.verifySegmentFitnessCurves(e,t,n,r,i,a,o)){let r=i.clone();r.dropAllAttributes(),s<0&&r.reverse(),this.removeSpanBetween(e,t,n),e.setSegmentToIndex(e.getVertexIndex(t),r);return}}}else if(c.isEqualPoint2D(i.getStartXY())){if(l.isEqualPoint2D(i.getEndXY())){let s=i.clone();s.dropAllAttributes();let c=this.verifySegmentFitnessCurves(e,t,n,r,s,a,o);if(c)return U(c>0),this.removeSpanBetween(e,t,n),void e.setSegmentToIndex(e.getVertexIndex(t),s)}}else if(l.isEqualPoint2D(i.getStartXY())&&c.isEqualPoint2D(i.getEndXY())){let s=i.getReversed();s.dropAllAttributes();let c=this.verifySegmentFitnessCurves(e,t,n,r,s,a,o);if(c)return U(c>0),this.removeSpanBetween(e,t,n),void e.setSegmentToIndex(e.getVertexIndex(t),s)}this.processSpanSplitSegmentCurves(e,t,n,r,i,a,o)}processSpan_(e,t,n,r,i,a,o){this.m_type===0?this.processSpanSmartTe_(e,t,n,r,i,a,o):this.processSpanCurves_(e,t,n,r,i,a,o)}processSpanSplitSegmentCurves(e,t,n,r,i,a,o){if(i.isLine()||this.fitSegmentToSpanCurves(e,t,n,r,i,a,o))return;let s=o*o,c=r,l=t,u=e.getXY(t),d=i.getClosestCoordinate(u,!1),f=i.getCoord2D(d),p=!1,m=z.sqrDistance(u,f);if(m>s){let r=e.getNextVertex(t);if(this.approximateSpanSectionCurves(e,t,i,a,o),r===n)return;l=r,p=!0,--c}let h=n,g=e.getXY(n);d=i.getClosestCoordinate(g,!1);let _=i.getCoord2D(d),v=!1,y=z.sqrDistance(g,_);if(y>s){let t=e.getPrevVertex(n);if(this.approximateSpanSectionCurves(e,t,i,a,o),t===l)return;h=t,v=!0,--c}if((p||v)&&this.fitSegmentToSpanCurves(e,l,h,c,i,a,o))return;let b=!1;if(!p&&m>0){let n=e.getNextVertex(t);if(this.approximateSpanSectionCurves(e,t,i,a,o),n===h)return;l=n,p=!0,b=!0,--c}if(!v&&y>0){let t=e.getPrevVertex(n);if(this.approximateSpanSectionCurves(e,t,i,a,o),t===l)return;h=t,v=!0,b=!0,--c}if(b&&this.fitSegmentToSpanCurves(e,l,h,c,i,a,o))return;let x=l;for(;;){let t=e.getNextVertex(x);if(this.approximateSpanSectionCurves(e,x,i,a,o),x=t,x===h)return}}fitSegmentToSpanCurves(e,t,n,r,i,a,o){let c=[];c.push(e.getXY(t));let l=t,u=new Q;for(;;){e.querySegment(l,u,!1,!0);let t=[.1,.25,.4,.5,.6,.75,.9,1],i=0;for(let e of t)(r===2||1&i)&&c.push(u.get().getCoord2D(e)),i++;if(l=e.getNextVertex(l),l===n)break}let d=(()=>{let e=c[0].compare(c.at(-1));if(e===0){let t=new s(0);qg(c,c.length,t),e=t.getResult()>=0?-1:1}return e>0})();d&&c.reverse();let f=i.clone();if(f.dropAllAttributes(),d&&f.reverse(),f.setSegmentFromCoordsForStitcher(c,c.length),d&&f.reverse(),f.snapControlPoints(this.m_tolerance*this.m_tolerance),this.verifySegmentFitnessCurves(e,t,n,r,f,a,o)){this.removeSpanBetween(e,t,n);let r=e.getVertexIndex(t);return e.setSegmentToIndex(r,f),!0}return!1}approximateSpanSectionCurves(e,t,n,r,i){let a=new Q;if(!e.querySegment(t,a,!0,!1))return;let o=n.getGeometryType();if(o!==a.get().getGeometryType()){if(o===L.enumEllipticArc){if(a.get().getGeometryType()!==L.enumRationalBezier2)return;if(n.projectionBehavior()===0){let n=[];Xg(!1,a.get(),i,n,this.m_progressTracker);let r=e.getNextVertex(t),o=e.getPathFromVertex(t),s=new q,l=t;for(let t=1,i=n.length;t<i;t++){let i=n[t],u=a.get().getCoord2D(n[t-1]),d=a.get().getCoord2D(c(n[t-1],i,.5));a.get().queryCoord(i,s);let f=s.getXY(),p=new xu;p.constructCircularArcThreePoint(u,f,d);let m=-1;i<1&&(m=e.insertVertex(o,r,s)),e.setSegmentToIndex(e.getVertexIndex(l),p),l=m}return}{let n=C(z,3);a.get().queryControlPoints(n);let r=[0,0,0];a.get().queryWeights(r);let i=iu(r),o=new xu;bd(n,i*i,null,!1,o),e.setSegmentToIndex(e.getVertexIndex(t),o);return}}B(`approximate_span_section_`)}}verifySegmentFitnessCurves(e,t,n,r,i,a,o){let s=e.getXY(t),c=e.getXY(n);if(!s.isEqualPoint2D(i.getStartXY())||!c.isEqualPoint2D(i.getEndXY()))return 0;let l=0;if(i.isClosed()){let e=i.getCoord2D(.1).sub(s);l=i.getCoord2D(.7).sub(s).crossProduct(e)>=0?1:-1}let u=H(Yr.s_maxMonotonicPartParams,NaN),d=i.getMonotonicPartParams(u.length,u);d--;let f=new Z,p=[1,.5,.75,.25],m=0,h=t,g=s.clone();for(;;){let t=e.getNextVertex(h),r=e.getSegment(h);r===null&&(e.queryLineConnector(h,f,!0),r=f);for(let e=t===n?1:0;e<p.length;e++){let t=r.getCoord2D(p[e]);if(!i.isCloserThanDistance(t,I.unit(),o))return 0}if(d>1)for(let e=1;e<d;){let t=i.getCoord2D(u[e]);r.isCloserThanDistance(t,I.unit(),o)?(u[d-1]=W(u[e],u[e]=u[d-1]),d--):e++}if(l){let e=r.getCoord2D(.25);m+=e.sub(s).crossProduct(g.sub(s)),g.assign(e),e.assign(r.getCoord2D(.75)),m+=e.sub(s).crossProduct(g.sub(s)),g.assign(e)}if(h=t,h===n)return d>1?0:l?m<0?-l:l:1}}removeSpanBetween(e,t,n){e.setSegmentToIndex(e.getVertexIndex(t),null);let r=e.getNextVertex(t);r!==n&&e.removeVertices(r,n)}static st_stitchCurvesImpl(e,t,n,r,i){if(!t.hasSegmentParentage())return;s_(t);let a=n===-1?t.getFirstGeometry():n;for(;a!==-1;)if(Dt(t.getGeometryType(a))){for(let n=t.getFirstPath(a);n!==-1;n=t.getNextPath(n)){let a=t.getPathSize(n),o=t.isClosedPath(n);o&&(a+=1);let s=t.getFirstVertex(n),c=t.getSegmentParentage(s);if(o){if(c!==-1&&!t.getSegmentParentageBreakVertex(s)){let e=t.getPrevVertex(s),n=s;for(let r=0;;r++){let i=t.getSegmentParentage(e);if(c!==i){U(i===-1);break}if(s=e,t.getSegmentParentageBreakVertex(e))break;if(e===n){s=n,t.setSegmentParentageBreakVertex(s,!0);break}e=t.getPrevVertex(e),U(r<a)}}}else U(c===-1||t.getSegmentParentageBreakVertex(s));let l=s;for(let n=0;n<a&&l!==-1;){let o=t.getSegmentParentage(l);if(o===-1){if(n++,l=t.getNextVertex(l),l===s)break;continue}let c=0,u=-1,d=l;c=1;let f=t.getNextVertex(d);for(;n<a&&f!==-1;){n++,u=f,c++;let e=t.getSegmentParentage(f);if(e===-1||t.getSegmentParentageBreakVertex(f))break;U(e===o),f=t.getNextVertex(f)}if(u===-1){U(0);break}if(!i){let n=e.m_originalPlanarSegments[o];e.processSpan_(t,d,u,c,n,o,r)}if(l=u,l===s)break}}if(n!==-1)break;a=t.getNextGeometry(a)}else a=n===-1?t.getNextGeometry(a):-1}static st_stitchCurvesFromLinesImpl(e,t,n,r,i){let a=n===-1?t.getFirstGeometry():n;for(;a!==-1;){for(let n=t.getFirstPath(a);n!==-1;n=t.getNextPath(n)){let a=t.getPathSize(n);t.isClosedPath(n)&&(a+=1);let o=!0,s=!1,c=t.getFirstVertex(n),l=c;for(let n=0;n<a&&l!==-1;){let u=t.getSegmentParentage(l);if(u===-1||o){o=!1,n++,l=t.getNextVertex(l),s=!0;continue}let d,f,p=0;if(s?(d=t.getPrevVertex(l),f=l,U(d!==-1),U(f!==d),U(t.getSegmentParentage(d)===-1||c===d)):(d=l,f=t.getNextVertex(d),n++,U(f!==-1),U(f!==d),u=t.getSegmentParentage(f)),p=2,s=!1,u===-1||t.getSegmentParentageBreakVertex(f)){l=f;continue}let m=t.getNextVertex(f);for(n++;n<a&&m!==-1;){f=m,p++;let e=t.getSegmentParentage(m);if(e===-1||t.getSegmentParentageBreakVertex(m))break;U(e===u),n++,m=t.getNextVertex(m)}if(!i){let n=e.m_originalPlanarSegments[u];e.processSpan_(t,d,f,p,n,u,r)}l=f}}if(n!==-1)break;a=t.getNextGeometry(a)}}static st_stitchCurvesFromCurvesImpl(e,t,n,r,i){let a=n===-1?t.getFirstGeometry():n;for(;a!==-1;)if(Dt(t.getGeometryType(a))){for(let n=t.getFirstPath(a);n!==-1;n=t.getNextPath(n)){let a=t.getPathSize(n),o=t.isClosedPath(n);o&&(a+=1);let s=t.getFirstVertex(n);if(o){if(t.getSegmentParentage(s)!==-1){let e=s;for(let r=0;!t.getSegmentParentageBreakVertex(e);r++){if(r===a){s=t.getFirstVertex(n),t.setSegmentParentageBreakVertex(e,!0);break}e=t.getPrevVertex(e)}}}else U(t.getSegmentParentage(s)===-1||t.getSegmentParentageBreakVertex(s));let c=s;for(let n=0;n<a&&c!==-1;){let o=t.getSegmentParentage(c);if(o===-1){n++,c=t.getNextVertex(c);continue}let s=0,l=-1,u=c;s=1;let d=t.getNextVertex(u);for(;n<a&&d!==-1;){n++,l=d,s++;let e=t.getSegmentParentage(d);if(e===-1||t.getSegmentParentageBreakVertex(d))break;U(e===o),d=t.getNextVertex(d)}if(l===-1)break;if(!i){let n=e.m_originalPlanarSegments[o];e.processSpan_(t,u,l,s,n,o,r)}c=l}}if(n!==-1)break;a=t.getNextGeometry(a)}else a=n===-1?t.getNextGeometry(a):-1}static regularizeCurve(e,t,n,r){let i=t.snapControlPoints(r*r);if(i){let r=e.getVertexIndex(n),i=t.clone();e.setSegmentToIndex(r,i)}if(t.getGeometryType()===Gc.type){let a=[],o=t.calculateSpecialPointsForCracking(r,a);if(o>0){let s=[];if(o>1){for(let e=0;e<o;e++)if(s.push(t.getCoord2D(a[e])),e>0){let t=(Math.abs(s[e].x)+Math.abs(s[e].y))*j(),n=z.distance(s[e-1],s[e]);if(n<t&&n>0){let t=new z;Ee(s[e-1],s[e],.5,t),s[e-1]=t,s[e]=t}}}e.splitSegment(n,a,o),i=e.snapControlPoints(n,o+1,r*r)||i;for(let t=0;t<o;t++)n=e.getNextVertex(n),e.setSegmentParentageBreakVertex(n,!0);return o}}return i?0:-1}};function h_(e,t,n,r,i){return new b_(e,n,t,r,i).do_()}function g_(e,t,n){let r=Vn(e);return up(t.getX(),t.getY(),n.getX(),n.getY(),Ct(r))}function __(e,t,n=1,r=1,i=1,a=1){if(r>a)return e;if(a>r)return t;let o=[0],s=[0],c=new q;return pp(e,t,n,r,i,a,c,s,o),c}function v_(e,t,n){return b_.fixCurveTwoPointLoops(e,t,n)}function y_(e){return Vn(e)}var b_=class e{constructor(e,t,n,r,i){this.m_shape=e,this.m_progressTracker=t,this.m_tolerance=n,this.m_bFilterDegenerateSegments=r,this.m_bTrackChanges=i,this.m_progressCounter=0}do_(){let t=new En(this.m_tolerance.tolerance,this.m_tolerance.resolution),n=y_(t),r=Hn(t),i=r*1.00001;r*=1.000001;let a=!1,o=this.m_shape.getTotalPointCount()+10>30?1e3:(this.m_shape.getTotalPointCount()+10)*(this.m_shape.getTotalPointCount()+10),s=this.m_shape.hasPointFeatures();for(let t=0;;t++){this.m_shape.dbgCheckSelection(),t>o&&B(`crack_and_cluster_iteration_exceeded`),this.m_shape.dbgVerifyMonotone();let c=-1;t===0&&(c=this.firstCrack_(),a||=c>0);let l=this.cluster_(n);if(this.m_shape.dbgVerifyMonotone(),a||=l,this.m_bFilterDegenerateSegments){let e=this.m_shape.filterClosePoints(n,!0,!1,this.m_bTrackChanges,-1)!==0;a||=e,this.m_shape.dbgVerifyMonotone()}let u=this.m_shape.snapControlPointsOnSelection(i*i);a||=u,this.m_shape.dbgCheckSelection();let d=!1;if((t===0&&c===-1||s||Ip(!0,this.m_shape,r,null,this.m_progressTracker))&&(d=this.crack_(i),a||=d,this.m_shape.dbgVerifyMonotone()),!d&&!e.fixCurveTwoPointLoops(this.m_shape,n,this.m_progressTracker)){this.m_shape.dbgVerifyMonotone();break}}return a&&c_(this.m_shape),a}cluster_(e){return lp(this.m_shape,e,-1,this.m_bTrackChanges,this.m_progressTracker)}crack_(e){return Fp(this.m_shape,e,this.m_bTrackChanges,this.m_progressTracker)}static fixCurveTwoPointLoops(e,t,n){if(!e.hasCurves())return!1;e.dbgVerifyCurves();let r=e.createUserIndexUninitialized(),i=new sn(0),a=e.queryVertexIteratorOnSelection();for(let t=a.next();t!==-1;t=a.next())i.add(t),e.setUserIndex(t,r,-1);if(i.size()===0)return!1;i.add(-1),e.sortVerticesSimpleByY(i,0,i.size()-1);let o=0,s=e.getXY(i.read(o)),c=new z(NaN,NaN),l=[];for(let t=1,n=i.size();t<n;++t){let n=i.read(t),a=n===-1?c:e.getXY(n);if(a.equals(s))continue;let u=[];for(let n=o;n<t;n++){let t=i.read(n),a=e.getPrevVertex(t);if(a!==-1&&e.getUserIndex(a,r)===-1){let t=x_(e.getXY(a),e.getSegment(a));z.sqrDistance(s,t.otherPt)!==0&&(t.vert=a,t.dir=-1,u.push(t)),e.setUserIndex(a,r,1)}let o=e.getNextVertex(t);if(o!==-1&&e.getUserIndex(t,r)===-1){let n=x_(e.getXY(o),e.getSegment(t));z.sqrDistance(s,n.otherPt)!==0&&(n.vert=t,n.dir=1,u.push(n)),e.setUserIndex(t,r,1)}}if(u.length>1){u.sort((e,t)=>w_(e,t));let e=x_(c.clone(),null);u.push(e);let t=0;for(let e=1,n=u.length;e<n;e++)if(!u[e].otherPt.equals(u[e-1].otherPt)){if(e-t>1&&u[t].seg!==null){let n=!1,r=t;for(let i=t+1;i<e;i++)if(!S_(u[r],u[i])){n=!0;break}if(n)for(let n=t;n<e&&u[n].seg!==null;n++)l.push(u[n].vert)}t=e}}o=t,s.setCoordsPoint2D(a)}for(let n of l){let r=e.getSegment(n);U(r!==null);let i=e.getXY(n),a=e.getXY(e.getNextVertex(n));if(z.distance(i,a)<3*t)e.setSegmentToIndex(e.getVertexIndex(n),null);else{let t=r.lengthToT(.5*r.calculateLength2D());e.splitSegment(n,[t],1)}}return e.removeUserIndex(r),l.length>0}firstCrack_(){let e=this.m_shape.getEnvelope2D(this.m_progressTracker),t=Pn(null,e,!0).total();if(4*t<this.m_tolerance.total()){let e=!1,n=1.1*t,r=t,i=this.cluster_(n);e||=i;let a=0;this.m_bFilterDegenerateSegments&&(a=this.m_shape.filterClosePoints(0,!0,!1,this.m_bTrackChanges,-1));let o=this.crack_(r);return e||=o,e?1:a?2:0}return-1}progress_(e=!1){this.m_progressCounter++,!e&&4095&this.m_progressCounter||(this.m_progressCounter=0)}};function x_(e,t){return{otherPt:e,seg:t,vert:-1,dir:0}}function S_(e,t){if(U(e.otherPt.equals(t.otherPt)),e.seg===null)return t.seg===null;if(t.seg===null)return!1;let n=e.seg.getGeometryType();if(n!==t.seg.getGeometryType())return!1;if(n===L.enumBezier){let n=e.seg,r=t.seg,i=n.getControlPoint1(),a=n.getControlPoint2();e.dir===-1&&(a=W(i,i=a));let o=r.getControlPoint1(),s=r.getControlPoint2();return t.dir===-1&&(s=W(o,o=s)),i.equals(o)&&a.equals(s)}if(n===L.enumRationalBezier2){let n=e.seg,r=t.seg,i=n.getControlPoint1(),a=r.getControlPoint1();if(!i.equals(a))return!1;let o=[0,0,0];n.queryWeights(o),e.dir===-1&&(o[2]=W(o[0],o[0]=o[2]));let s=[0,0,0];return r.queryWeights(s),t.dir===-1&&(s[2]=W(s[0],s[0]=s[2])),o[0]===s[0]&&o[1]===s[1]&&o[2]===s[2]}B(``)}function C_(e,t){if(e.seg===null||t.seg===null)return e.seg===null?t.seg===null?0:1:-1;let n=e.seg.getGeometryType(),r=t.seg.getGeometryType();return n<r?-1:n>r?1:0}function w_(e,t){let n=e.otherPt.compare(t.otherPt);return n===0?C_(e,t):n}var T_=V,E_=Ne,D_=Se;function O_(e){switch(e){case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;case 0:return 0;default:U(0,`unrecognized cut side`)}return 3}function k_(){return{unsplitBehavior:0,allCrossRoadsImpassable:!1,ogcRule:!1}}function A_(e,t,n,r,i,a,o){let s=new W_(i);s.m_bOGCOutput=!0;let c=e.getGeometryType()===L.enumPolygon&&e.getFillRule()===1&&!Un(r);return s.planarSimplifyImpl_(e,t,c,n,r,i,a,o)}function j_(e,t,n,r,i,a,o,s){return new W_(a).planarSimplifyImpl_(e,t,n,r,i,a,o,s)}function M_(e,t,n,r){let i=new W_(r),a=new os,o=a.addGeometry(t),s=i.planarSimplifyNoCrackingAndCluster(e,a,o,n);return U(s,`planar_simplify_no_cracking_and_cluster`),a.getGeometry(o)}function N_(e,t,n,r,i,a,o){return U(0),{}}function P_(e,t,n,r){return U(0),{}}function F_(e,t,n){return K_(e,t,n)}function I_(e,t,n,r){if(e.isEmpty()||t.isEmpty()||e.getDimension()>t.getDimension())return q_(J_(e),e,t,`-`);let i=new G;e.queryEnvelope(i);let a=new G;t.queryEnvelope(a);let o=new G;o.setCoords({env2D:i}),o.mergeEnvelope2D(a);let s=Pn(n,o,!0),c=a.clone(),l=Vn(s);if(c.inflateCoords(l,l),!i.isIntersecting(c))return q_(J_(e),e,t,`-`);let u=new W_(r),d=new os,f=d.addGeometry(J_(e)),p=d.addGeometry(J_(t)),m=0,h=0,g=null;if(d.hasCurves()){g=new p_;let e=d.getEnvelope2D(r);h=d_(s.total());let t=u_(s.total(),e);m=f_(t,h),r_(d,t,s.total(),12e3,g,null,r)}u.setEditShapeCrackAndCluster(d,s.add(m));let _=u.difference(f,p);g!==null&&g.stitchCurves(d,_,h,!0);let v=q_(d.getGeometry(_),e,t,`-`);return T_(v.getGeometryType())&&(v.getImpl().setIsSimple(4,s.total()),v.getGeometryType()===L.enumPolygon&&v.getImpl().updateOGCFlagsProtected()),v}function L_(e,t,n,r){if(e.getDimension()>t.getDimension())return q_(J_(e),e,t,`^`);if(e.getDimension()<t.getDimension()||e.isEmpty())return q_(J_(t),e,t,`^`);if(t.isEmpty())return q_(J_(e),e,t,`^`);let i=new G;e.queryEnvelope(i);let a=new G;t.queryEnvelope(a);let o=new G;o.setCoords({env2D:i}),o.mergeEnvelope2D(a);let s=Pn(n,o,!0),c=new W_(r),l=new os,u=l.addGeometry(J_(e)),d=l.addGeometry(J_(t)),f=0,p=null;if(l.hasCurves()){p=new p_;let e=l.getEnvelope2D(r);f=d_(s.total()),r_(l,u_(s.total(),e),s.total(),12e3,p,null,r)}c.setEditShapeCrackAndCluster(l,s);let m=c.symmetricDifference(u,d);p!==null&&p.stitchCurves(l,m,f,!0);let h=q_(l.getGeometry(m),e,t,`^`);return T_(h.getGeometryType())&&(h.getImpl().setIsSimple(4,s.total()),h.getGeometryType()===L.enumPolygon&&h.getImpl().updateOGCFlagsProtected()),h}function R_(e,t,n){return G_(e,t,n,!0)}function z_(e,t,n){return e.isEmpty()||t.isEmpty()?e.createInstance():g_(n,e,t)?new q({copy:__(e,t)}):e.createInstance()}function B_(e,t,n,r){let i=G.constructEmpty();e.queryEnvelope(i);let a=G.constructEmpty();t.queryEnvelope(a);let o=G.constructEmpty();o.setCoords({env2D:i}),o.mergeEnvelope2D(a);let s=Pn(n,o,!0),c=new G(a),l=Vn(s);if(c.inflateCoords(l,l),!i.isIntersecting(c)){if(e.getDimension()<=t.getDimension())return q_(J_(e.createInstance()),e,t,`&`);if(e.getDimension()>t.getDimension())return q_(J_(t.createInstance()),e,t,`&`)}let u=new W_(r),d=new os,f=d.addGeometry(J_(e)),p=d.addGeometry(J_(t)),m=0,h=0,g=null;if(d.hasCurves()){g=new p_;let e=d.getEnvelope2D(r);h=d_(s.total());let t=u_(s.total(),e);m=f_(t,h),r_(d,t,s.total(),12e3,g,null,r)}u.setEditShapeCrackAndCluster(d,s.add(m));let _=u.intersection(f,p);g!==null&&g.stitchCurves(d,_,h,!0);let v=q_(d.getGeometry(_),e,t,`&`);return T_(v.getGeometryType())&&(v.getImpl().setIsSimple(4,s.total()),v.getGeometryType()===L.enumPolygon&&v.getImpl().updateOGCFlagsProtected()),v}function V_(e,t,n,r){let i=[,,,],a=G.constructEmpty();e.queryEnvelope(a);let o=G.constructEmpty();t.queryEnvelope(o);let s=G.constructEmpty();s.setCoords({env2D:a}),s.mergeEnvelope2D(o);let c=Pn(n,s,!0),l=new G(o),u=Vn(c);if(l.inflateCoords(u,u),!a.isIntersecting(l)){if(e.getDimension()<=t.getDimension()){let n=q_(J_(e.createInstance()),e,t,`&`);return i[n.getDimension()]=n,i}if(e.getDimension()>t.getDimension()){let n=q_(J_(t.createInstance()),e,t,`&`);return i[n.getDimension()]=n,i}}let d=new W_(r),f=new os,p=f.addGeometry(J_(e)),m=f.addGeometry(J_(t)),h=0,g=0,_=null;if(f.hasCurves()){_=new p_;let e=f.getEnvelope2D(r);g=d_(c.total());let t=u_(c.total(),e);h=f_(t,g),r_(f,t,c.total(),12e3,_,null,r)}d.setEditShapeCrackAndCluster(f,c.add(h)),f.dbgVerifyCurves();let v=d.intersectionEx(p,m);for(let n of v){_!==null&&_.stitchCurves(f,n,g,!1);let r=q_(f.getGeometry(n),e,t,`&`);T_(r.getGeometryType())&&(r.getImpl().setIsSimple(4,c.total()),r.getGeometryType()===L.enumPolygon&&r.getImpl().updateOGCFlagsProtected()),i[r.getDimension()]=r}return _!==null&&_.clearStitcher(f),i}function H_(e,t,n,r,i,a=!1){t===0&&R(`not enough geometries to dissolve`);let o=0;for(let n=0,r=t;n<r;n++)o=Math.max(e[n].getDimension(),o);if(o===2||o===1)return new W_(r).dissolveMultiPaths_(o,!1,e,t,n,i,a);let s=0,c=-1;for(let n=0,r=t;n<r;n++)e[n].getDimension()===o&&(c===-1&&(c=n),e[n].isEmpty()||(c=n,s++));if(s<2)return J_(e[c]);let l=Yt.constructEmpty(),u=new os,d=-1;for(let n=0,r=t;n<r;n++)if(e[n].getDimension()===o&&!e[n].isEmpty()){d===-1?d=u.addGeometry(J_(e[n])):u.appendGeometry(d,J_(e[n]));let t=Yt.constructEmpty();e[n].queryLooseEnvelope(t),l.mergeEnv3D(t)}let f=Pn(n,l.getEnvelope2D(),!0),p=new W_(r);if(a){let e=Fn(n,l.getEnvelopeZs(),!0);return p.planarSimplify3DImpl_(u,f,e,0,!0)}return p.m_bOGCOutput=!0,p.planarSimplifyMultiPoints(u,f,!1,-1)}function U_(e,t,n,r,i,a=!1){t<2&&R(`not enough geometries to dissolve`);let o=0;for(let n=0,r=t;n<r;n++)o=Math.max(e[n].getDimension(),o);if(o===2||o===1)return new W_(r).dissolveMultiPaths_(o,!0,e,t,n,i,a);let s=Yt.constructEmpty(),c=new os,l=-1,u=0,d=-1;for(let n=0,r=t;n<r;n++)if(e[n].getDimension()===o&&(d===-1&&(d=n),!e[n].isEmpty())){d=n,l===-1?l=c.addGeometry(J_(e[n])):c.appendGeometry(l,J_(e[n]));let t=Yt.constructEmpty();e[n].queryLooseEnvelope(t),s.mergeEnv3D(t),u++}if(u<2)return J_(e[d]);let f=o===0?n:null,p=Pn(f,s.getEnvelope2D(),!0),m=new W_(r);if(a){let e=Fn(f,s.getEnvelopeZs(),!0);return m.m_bOGCOutput=!0,m.planarSimplify3DImpl_(c,p,e,0,!0)}return m.planarSimplifyMultiPoints(c,p,!0,-1)}var W_=class{constructor(e){this.m_topoGraph=null,this.m_maskLookup=[],this.m_dummyPt1=z.getNAN(),this.m_dummyPt2=z.getNAN(),this.m_fromEdgeForPolylines=-1,this.m_progressCounter=0,this.m_bOGCOutput=!1,this.m_progressTracker=e}linesToPolygonsImpl(e,t){let n=0,i=0,a=null;if(e.hasCurves()){a=new p_;let r=e.getEnvelope2D(this.m_progressTracker);i=d_(t.total());let o=u_(t.total(),r);n=f_(o,i),r_(e,o,t.total(),12e3,a,null,this.m_progressTracker)}this.setEditShapeCrackAndCluster(e,t.add(n));let o=this.m_topoGraph.createUserIndexForChains(),s=this.m_topoGraph.getFirstChain();this.m_topoGraph.setChainUserIndex(s,o,1);for(let e=this.m_topoGraph.getChainFirstIsland(s);e!==-1;e=this.m_topoGraph.getChainNextInParent(e))this.m_topoGraph.setChainUserIndex(e,o,1);let c=[];for(let t=this.m_topoGraph.getFirstChain();t!==-1;t=this.m_topoGraph.getChainNext(t)){if(this.m_topoGraph.getChainUserIndex(t,o)===1)continue;this.m_topoGraph.setChainUserIndex(t,o,1);for(let e=this.m_topoGraph.getChainFirstIsland(t);e!==-1;e=this.m_topoGraph.getChainNextInParent(e))this.m_topoGraph.setChainUserIndex(e,o,1);if(this.m_topoGraph.getChainArea(t)===0)continue;let n=this.m_topoGraph.extractPolygonFromChainAndIslands(e,-1,t,-1);a?.stitchCurves(e,n,i,!1);let r=e.getGeometry(n);c.push(r)}return new r(c)}autoCompleteImpl(e,t,n){let i=0,a=0,o=null;if(e.hasCurves()){o=new p_;let t=e.getEnvelope2D(this.m_progressTracker);a=d_(n.total());let r=u_(n.total(),t);i=f_(r,a),r_(e,r,n.total(),12e3,o,null,this.m_progressTracker)}this.setEditShapeCrackAndCluster(e,n.add(i));let s=this.m_topoGraph.getGeometryID(t),c=this.m_topoGraph.createUserIndexForChains(),l=this.m_topoGraph.getFirstChain();this.m_topoGraph.setChainUserIndex(l,c,1);for(let e=this.m_topoGraph.getChainFirstIsland(l);e!==-1;e=this.m_topoGraph.getChainNextInParent(e))this.m_topoGraph.setChainUserIndex(e,c,1);let u=[];for(let t=this.m_topoGraph.getFirstChain();t!==-1;t=this.m_topoGraph.getChainNext(t)){if(this.m_topoGraph.getChainUserIndex(t,c)===1)continue;this.m_topoGraph.setChainUserIndex(t,c,1);for(let e=this.m_topoGraph.getChainFirstIsland(t);e!==-1;e=this.m_topoGraph.getChainNextInParent(e))this.m_topoGraph.setChainUserIndex(e,c,1);if(this.m_topoGraph.getChainParentage(t)!==0)continue;let n=this.m_topoGraph.getChainHalfEdge(t),r=n,i=!1;do{let e=this.m_topoGraph.getHalfEdgeTwin(r);if(this.m_topoGraph.getHalfEdgeChain(e)!==t&&(this.m_topoGraph.getHalfEdgeParentage(r)&s)!==0){i=!0;break}r=this.m_topoGraph.getHalfEdgeNext(r)}while(r!==n);if(!i||this.m_topoGraph.getChainArea(t)===0)continue;let l=this.m_topoGraph.extractPolygonFromChainAndIslands(e,-1,t,-1);o!==null&&o.stitchCurves(e,l,a,!1);let d=e.getGeometry(l);u.push(d)}return new r(u)}setEditShape(e,t=!1){this.m_topoGraph===null&&(this.m_topoGraph=new np),this.m_topoGraph.setEditShape(e,this.m_progressTracker,!0,t)}setEditShapeCrackAndCluster(e,t){h_(e,t,this.m_progressTracker,!0,!1);for(let t=e.getFirstGeometry();t!==-1;t=e.getNextGeometry(t))e.getGeometryType(t)===L.enumPolygon&&Qp(e,t,-1,this.m_bOGCOutput,-1,this.m_progressTracker);this.setEditShape(e)}setHalfEdgeOrientations_(e,t){let n=this.m_topoGraph.getShape();for(let r=n.getFirstGeometry();r!==-1;r=n.getNextGeometry(r))if(r===t)for(let t=n.getFirstPath(r);t!==-1;t=n.getNextPath(t)){let r=n.getFirstVertex(t);if(r===-1)continue;let i=n.getNextVertex(r);for(;i!==-1;){let t=this.m_topoGraph.getClusterFromVertex(r),a=this.m_topoGraph.getClusterFromVertex(i),o=this.m_topoGraph.getHalfEdgeConnector(t,a);if(o!==-1){let t=this.m_topoGraph.getHalfEdgeTwin(o);this.m_topoGraph.setHalfEdgeUserIndex(o,e,1),this.m_topoGraph.setHalfEdgeUserIndex(t,e,2)}r=i,i=n.getNextVertex(r)}}}flushVertices_(e,t){let n=this.m_topoGraph.getShape(),r=n.hasSegmentParentage(),i=new Q,a=n.insertPath(e,-1);t.push(t[0]);let o=t.length,s=-1;for(let e=0;e<o;e++){let c=t[e];if(s=n.addVertex(a,c),!r)continue;let l=this.m_topoGraph.getClusterFromVertex(c);if(e>0&&this.m_topoGraph.isBreakNode(l)&&n.setSegmentParentageBreakVertex(s,!0),e<o-1){let r=this.m_topoGraph.getHalfEdgeConnector(l,this.m_topoGraph.getClusterFromVertex(t[e+1])),a=this.m_topoGraph.getSegmentParentage(r);n.setSegmentParentageAndBreak(s,a,e>0||this.m_topoGraph.isBreakNode(l)),this.m_topoGraph.isHalfEdgeCurve(r)&&(this.m_topoGraph.querySegmentXY(r,i),n.setSegmentToIndex(n.getVertexIndex(s),i.get().clone()))}}if(r){let e=this.m_topoGraph.getClusterFromVertex(t[o-1]);this.m_topoGraph.isBreakNode(e)&&n.setSegmentParentageBreakVertex(s,!0)}n.setClosedPath(a,!0)}processPolygonCuts_(e,t,n,r){let i=this.m_topoGraph.getGeometryID(n),a=this.m_topoGraph.getGeometryID(r),o=[],s=this.m_topoGraph.getShape(),c=this.m_topoGraph.createUserIndexForHalfEdges();for(let n=this.m_topoGraph.getFirstCluster();n!==-1;n=this.m_topoGraph.getNextCluster(n)){let r=this.m_topoGraph.getClusterHalfEdge(n);if(r===-1)continue;let l=r;do{if(this.m_topoGraph.getHalfEdgeUserIndex(l,c)!==1){let n=l,r=l,u=!1,d=0;do{if(this.m_topoGraph.setHalfEdgeUserIndex(n,c,1),!u&&(this.m_topoGraph.getHalfEdgeParentage(n)&a)!==0&&(this.m_topoGraph.getHalfEdgeFaceParentage(n)&i)!==0&&(r=n,u=!0),u){let t=this.m_topoGraph.getHalfEdgeOrigin(n),r=this.m_topoGraph.getClusterVertexIterator(t),i=this.m_topoGraph.getVertexFromVertexIterator(r);o.push(i),e!==-1&&(this.m_topoGraph.getHalfEdgeParentage(n)&a)!==0&&(d|=this.m_topoGraph.getHalfEdgeUserIndex(n,e))}n=this.m_topoGraph.getHalfEdgeNext(n)}while(n!==r);if(u&&this.m_topoGraph.getChainArea(this.m_topoGraph.getHalfEdgeChain(r))>0){let e=s.createGeometry(L.enumPolygon);this.flushVertices_(e,o),t!==-1&&s.setGeometryUserIndex(e,t,d)}o.length=0}l=this.m_topoGraph.getHalfEdgeNext(this.m_topoGraph.getHalfEdgeTwin(l))}while(l!==r)}this.m_topoGraph.deleteUserIndexForHalfEdges(c)}cutPolygonPolyline_(e,t,n,r){this.m_topoGraph.removeSpikes_();let i=-1;e!==-1&&(i=this.m_topoGraph.createUserIndexForHalfEdges(),this.setHalfEdgeOrientations_(i,n)),this.processPolygonCuts_(i,e,t,n),i!==-1&&(this.m_topoGraph.deleteUserIndexForHalfEdges(i),i=-1);let a=this.m_topoGraph.getShape();for(let e=a.getFirstGeometry();e!==-1;e=a.getNextGeometry(e))e!==t&&e!==n&&r.push(e);r.sort((e,t)=>{let n=a.getFirstPath(e),r=a.getRingArea(n),i=a.getFirstPath(t),o=a.getRingArea(i);return r<o?-1:r>o?1:0})}cut(e,t,n,r,i){let a=this.m_topoGraph.getShape().getGeometryType(n),o=this.m_topoGraph.getShape().getGeometryType(r),s=Se(a),c=Se(o);if(s!==2||c!==1){if(s===1&&c===1){new X_(this,e,t,n,r,i).Do();return}B(``)}else this.cutPolygonPolyline_(t,n,r,i)}progress_(e=!1){}isGoodParentage(e){return e>=0&&e<this.m_maskLookup.length&&this.m_maskLookup[e]}normalizeInputGeometry(e){let t=e.getGeometryType();if(t===L.enumEnvelope){let t=new X({vd:e.getDescription()});return e.isEmpty()||t.addEnvelope(e,!1),t}if(t===L.enumPoint){let t=new ii({vd:e.getDescription()});return e.isEmpty()||t.add(e),t}if(Ne(t)){let t=new Bi({vd:e.getDescription()});return e.isEmpty()||t.addSegment(e,!0),t}return t!==L.enumMultiPoint&&t!==L.enumPolyline&&t!==L.enumPolygon&&R(`Unexpected geometry type`),e}dissolveNonSimplePolygons(e,t,n,r){U(t>0);let i=new os,a=0,o=-1;for(let n=0,r=t;n<r;n++)e[n].getDimension()===2&&(o===-1&&(o=n),e[n].isEmpty()||(a++,i.addGeometry(e[n])));return a===0?(U(o>=0),this.normalizeInputGeometry(e[o])):this.planarSimplifyPolygons(i,n,!0,!1,-1,!0)}dissolveMultiPaths_(e,t,n,r,i,a,o){U(e>=1&&e<=2),U(r>0);let s=8&a?1:2,c=Yt.constructEmpty(),l=0,u=-1,d=!0;for(let t=0,i=r;t<i;t++)if(n[t].getDimension()===e&&(u===-1&&(u=t),!n[t].isEmpty())){u=t,l++;let r=Yt.constructEmpty();if(n[t].queryLooseEnvelope(r),c.mergeEnv3D(r),e===2&&d&&n[t].getGeometryType()===L.enumPolygon)if(16&a){let e=n[t].getImpl().getIsSimple(0,[0]),r=this.m_bOGCOutput?e===5:qn(e);d&&=r}else{let e=Wn(n[t],0);d&&=e}}if(l<2&&(U(u>=0),l===0||!(16&a)))return this.normalizeInputGeometry(n[u]);if(!d){let e=Pn(t?null:i,c.getEnvelope2D(),!0);return this.dissolveNonSimplePolygons(n,r,e,a)}let f=n.slice(0,r),p=Pn(i,c.getEnvelope2D(),!0),m=10*Vn(p),h=new En(0,0);if(o&&(h=Fn(i,c.getEnvelopeZs(),!0)),l===1&&e===1&&s===2&&!t)return o?N_():this.m_bOGCOutput?A_(f[u],p,!1,-1,this.m_progressTracker,s,!1):j_(f[u],p,!1,!1,-1,this.m_progressTracker,s,!1);let g=new wn;g.startConstruction();let _=e===2?3:4,v=0;for(let n=0,i=r;n<i;n++){if(f[n].getDimension()!==e||f[n].isEmpty())continue;let r=f[n].getGeometryType();if(r!==L.enumEnvelope){if(Ne(r)?(f[n]=this.normalizeInputGeometry(f[n]),r=L.enumPolyline):U(V(r)),e===1){U(r===L.enumPolyline);let e=-1;o?U(0,`3d not implemented yet`):e=f[n].getImpl().getIsSimple(p.total(),[0]),(this.m_bOGCOutput?e!==5:!qn(e))&&(t?_=-1:(o?U(0,`3d not implemented yet`):this.m_bOGCOutput?f[n]=A_(f[n],p,!1,-1,this.m_progressTracker,s,!1):f[n]=j_(f[n],p,!1,!1,-1,this.m_progressTracker,s,!1),U(qn(f[n].getImpl().getIsSimple(p.total(),[0])))))}else{U(r===L.enumPolygon);let e=f[n].getImpl().getIsSimple(0,[0]);U(Un(e))}let i=f[n].getImpl();for(let e=0,t=i.getPathCount();e<t;e++){let t=G.constructEmpty();i.queryLoosePathEnvelope(e,t),t.inflateCoords(m,m),g.addEnvelope(v,t),v++}}else{U(r===L.enumEnvelope);let e=G.constructEmpty();f[n].queryLooseEnvelope(e),e.inflateCoords(m,m),g.addEnvelope(v,e),v++,_=-1}}g.endConstruction();let y=v,b=H(y,-2147483647),x=H(y,-1),S=0;u=-1,v=0;for(let t=0,n=r;t<n;t++){if(f[t].getDimension()!==e||(u===-1&&(u=t),f[t].isEmpty()))continue;u=t,S++;let n=f[t].getGeometryType();if(V(n))for(let e=0,n=f[t].getPathCount();e<n;e++)x[v]=t,b[v]=-e-1,v++;else U(n===L.enumEnvelope),x[v]=t,b[v]=-1,v++}if(S<2&&e===2)return U(u>=0),this.normalizeInputGeometry(f[u]);let C=y;for(;g.next()&&C>0;){this.progress_();let e=g.getHandleA(),t=g.getHandleB(),n=g.getElement(e),r=g.getElement(t);x[n]!==x[r]&&(b[n]<0&&(C--,b[n]=-(b[n]+1)),b[r]<0&&(C--,b[r]=-(b[r]+1)))}let w=new os,T=!1,E=0;for(let t=0,n=r;t<n;t++){if(f[t].getDimension()!==e||f[t].isEmpty())continue;let n=f[t].getGeometryType(),r=E,i=0,a=0,o=V(n)?f[t]:null;for(let e=r,n=b.length;e<n&&x[e]===t;e++)b[e]>=0&&(i++,a+=o?o.getPathSize(b[e]):wt(f[t])),E++;if(a>.95*wt(f[t])){w.addGeometry(this.normalizeInputGeometry(f[t]));for(let e=r;e<E;e++)b[e]<0&&(b[e]=-(b[e]+1))}else{if(i===0){T=!0;continue}{T=!0,U(V(n)),U(o!=null);let e=new X({vd:f[t].getDescription()}),i=new Bi({vd:f[t].getDescription()}),a=n===L.enumPolygon?e:i;for(let e=r;e<E;e++)b[e]>=0&&a.addPath(o,b[e],!0);w.addGeometry(a)}}}let D;if(w.getFirstGeometry()!==-1){let n=e===2,r=t?Pn(null,c.getEnvelope2D(),!0):p,i=new En(0,0);if(o&&(i=t?Fn(null,c.getEnvelopeZs(),!0):h),e===2&&!(2&a)){w.collapseAllGeometriesToFirst();let e=0,t=null;if(w.hasCurves()&&!w.hasSegmentParentage()){t=new p_;let n=w.getEnvelope2D(this.m_progressTracker);e=d_(r.total()),r_(w,u_(r.total(),n),r.total(),12e3,t,null,this.m_progressTracker)}jp(w,w.getFirstGeometry(),r.total(),this.m_progressTracker),t!==null&&t.stitchCurves(w,-1,e,!0)}if(o)D=this.planarSimplify3DImpl_(w,r,i,s,!0);else if(e===2)D=this.planarSimplifyPolygons(w,r,n,t,-1,!1);else{let e=k_();e.ogcRule=this.m_bOGCOutput,e.allCrossRoadsImpassable=!0,e.unsplitBehavior=s,D=this.planarSimplifyPolylines(w,r,t,e,-1)}T||(_=D.getImpl().getIsSimple(r.total(),[0]))}else U(T),U(u>=0),D=e===2?new X({vd:f[u].getDescription()}):new Bi({vd:f[u].getDescription()});if(T){let e=0;for(let t=0,n=b.length;t<n;t++){let n=x[t];if(!(n<0)&&b[t]<0){let r=f[n].getGeometryType(),i=V(r)?f[n]:null;if(i){let n=-(b[t]+1);e+=i.getPathSize(n)}else e+=4}}D.reserve(D.getPointCount()+e);for(let e=0,t=b.length;e<t;e++){let t=x[e];if(!(t<0)&&b[e]<0){let n=f[t].getGeometryType(),r=V(n)?f[t]:null;if(r){let t=-(b[e]+1);D.addPath(r,t,!0)}else n===L.enumEnvelope?D.addEnvelope(f[t],!1):(U(Ne(n)),D.addSegment(f[t],!0))}}}let O=0;if(e===2?_!==-1&&(_=3,O=t?0:p.total()):(U(e===1),t||_===-1||(O=p.total())),o||D.getImpl().setIsSimple(_,O),!t&&T)if(e===2){if(!o)return new mv().execute(D,i,!1,this.m_progressTracker);U(0,`3d not yet implemented`)}else e===1&&s!==1&&(D=o?P_():M_(this.m_bOGCOutput,D,s,this.m_progressTracker),D.getImpl().setIsSimple(_,O));return D}dissolveTopoGraphCommonEdges_(){let e=this.m_topoGraph.createUserIndexForHalfEdges(),t=[];for(let n=this.m_topoGraph.getFirstCluster();n!==-1;n=this.m_topoGraph.getNextCluster(n)){let r=this.m_topoGraph.getClusterHalfEdge(n),i=r;if(r!==-1)do{if(this.progress_(),this.m_topoGraph.getHalfEdgeUserIndex(i,e)!==1){let n=this.m_topoGraph.getHalfEdgeTwin(i);this.m_topoGraph.setHalfEdgeUserIndex(n,e,1),this.m_topoGraph.setHalfEdgeUserIndex(i,e,1);let r=this.m_topoGraph.getHalfEdgeFaceParentage(i);if(this.isGoodParentage(r)){let e=this.m_topoGraph.getHalfEdgeFaceParentage(n);this.isGoodParentage(e)&&t.push(i)}}i=this.m_topoGraph.getHalfEdgeNext(this.m_topoGraph.getHalfEdgeTwin(i))}while(i!==r)}this.m_topoGraph.deleteUserIndexForHalfEdges(e),this.m_topoGraph.deleteEdgesBreakFaces_(t)}chooseVertexByOrder(e,t,n,r){let i=kt(),a=-1;for(let r=this.m_topoGraph.getClusterVertexIterator(e);r!==-1;r=this.m_topoGraph.incrementVertexIterator(r)){let e=this.m_topoGraph.getVertexFromVertexIterator(r),o=t.getUserIndex(e,n);o>=0&&o<i&&(i=o,a=e)}U(a!==-1);let o=t.getUserIndex(a,r);return o>0&&(t.setUserIndex(a,r,--o),o===0&&t.setUserIndex(a,n,-1)),a}chooseVertexFromCluster_(e,t){return this.m_topoGraph.getVertexDominantFromCluster(e,t)}chooseVertexFromVertexCluster_(e,t){return this.m_topoGraph.getVertexDominant(e,t)}collectPolygonPathsPreservingFrom_(e,t,n,r,i){let a=this.m_topoGraph.getShape();if(a.getGeometryType(e)!==L.enumPolygon)return;let o=a.hasSegmentParentage(),s=new Q;for(let c=a.getFirstPath(e);c!==-1;c=a.getNextPath(c)){let e=a.getFirstVertex(c);this.m_topoGraph.getClusterFromVertex(e);let l=this.m_topoGraph.getHalfEdgeFromVertex(e);if(l===-1)continue;let u=this.m_topoGraph.getHalfEdgeUserIndex(l,n);if(u===1||u===2)continue;let d=this.m_topoGraph.getHalfEdgeFaceParentage(l);if(!this.isGoodParentage(d)){this.m_topoGraph.setHalfEdgeUserIndex(l,n,2);continue}this.m_topoGraph.setHalfEdgeUserIndex(l,n,1);let f=a.insertPath(t,-1);a.setClosedPath(f,!0);let p=l,m=e,h=this.m_topoGraph.getClusterFromVertex(m),g=1;do{this.progress_();let e=this.chooseVertexFromVertexCluster_(m,i),t=a.addVertex(f,e);if(this.m_topoGraph.isHalfEdgeCurve(p)&&(this.m_topoGraph.querySegmentXY(p,s),a.setSegmentToIndex(a.getVertexIndex(t),s.get().clone())),o){let e=this.m_topoGraph.getSegmentParentage(p);a.setSegmentParentageAndBreak(t,e,this.m_topoGraph.isBreakNode(h))}let c,l;r!==-1&&this.m_topoGraph.setClusterUserIndex(h,r,1),this.m_topoGraph.setHalfEdgeUserIndex(p,n,1),p=this.m_topoGraph.getHalfEdgeNext(p);do c=g===1?a.getNextVertex(m):a.getPrevVertex(m),l=c===-1?-1:this.m_topoGraph.getClusterFromVertex(c);while(l===h);let u=this.m_topoGraph.getHalfEdgeOrigin(p);if(u!==l){do c=g===1?a.getPrevVertex(m):a.getNextVertex(m),l=c===-1?-1:this.m_topoGraph.getClusterFromVertex(c);while(l===h);if(u!==l){l=u;let e=this.m_topoGraph.getClusterVertexIterator(l);c=this.m_topoGraph.getVertexFromVertexIterator(e)}else g=-g}h=l,m=c}while(p!==l)}}topoOperationPolygonPolygonHelper_(e,t,n,r,i,a){this.progress_(!0),e!==-1&&this.collectPolygonPathsPreservingFrom_(e,n,i,a,r),t!==-1&&this.collectPolygonPathsPreservingFrom_(t,n,i,a,r);let o=new Q,s=this.m_topoGraph.getShape();s.dbgVerifyCurves();let c=s.hasSegmentParentage();for(let e=this.m_topoGraph.getFirstCluster();e!==-1;e=this.m_topoGraph.getNextCluster(e)){let t=this.m_topoGraph.getClusterHalfEdge(e);if(t===-1)continue;let l=t;do{this.progress_();let e=this.m_topoGraph.getHalfEdgeUserIndex(l,i);if(e!==1&&e!==2){let e=this.m_topoGraph.getHalfEdgeFaceParentage(l);if(this.isGoodParentage(e)){let e=s.insertPath(n,-1);s.setClosedPath(e,!0);let t=l;do{let n=this.m_topoGraph.getHalfEdgeVertexIterator(t),l=-1;if(n!==-1)l=this.m_topoGraph.getVertexFromVertexIterator(n);else{let e=this.m_topoGraph.getHalfEdgeVertexIterator(this.m_topoGraph.getHalfEdgeTwin(t));l=this.m_topoGraph.getVertexFromVertexIterator(e),l=s.getNextVertex(l)}let u=this.chooseVertexFromVertexCluster_(l,r),d=s.addVertex(e,u);if(c){let e=this.m_topoGraph.getSegmentParentage(t),n=this.m_topoGraph.getHalfEdgeOrigin(t);s.setSegmentParentageAndBreak(d,e,this.m_topoGraph.isBreakNode(n))}if(this.m_topoGraph.isHalfEdgeCurve(t)&&(this.m_topoGraph.querySegmentXY(t,o),s.setSegmentToIndex(s.getVertexIndex(d),o.get().clone())),this.m_topoGraph.setHalfEdgeUserIndex(t,i,1),a!==-1){let e=this.m_topoGraph.getClusterFromVertex(u);this.m_topoGraph.setClusterUserIndex(e,a,1)}t=this.m_topoGraph.getHalfEdgeNext(t)}while(t!==l)}else this.m_topoGraph.setHalfEdgeUserIndex(l,i,2)}l=this.m_topoGraph.getHalfEdgeNext(this.m_topoGraph.getHalfEdgeTwin(l))}while(l!==t)}}topoOperationPolygonPolygon_(e,t,n,r=!1){this.dissolveTopoGraphCommonEdges_();let i=this.m_topoGraph.getShape(),a=i.createGeometry(L.enumPolygon),o=this.m_topoGraph.createUserIndexForHalfEdges();return this.topoOperationPolygonPolygonHelper_(e,t,a,n,o,-1),this.m_topoGraph.deleteUserIndexForHalfEdges(o),r||Qp(i,a,3,this.m_bOGCOutput,-1,this.m_progressTracker),a}topoOperationPolyline_(e,t){let n=k_();return n.allCrossRoadsImpassable=!1,n.ogcRule=t,n.unsplitBehavior=0,this.topoOperationPolylineSimplifyOrPolylineTopoHelper_(-1,e,!1,n).first}topoOperationMultiPoint_(){let e=this.m_topoGraph.getShape(),t=e.createGeometry(L.enumMultiPoint),n=e.insertPath(t,-1);for(let t=this.m_topoGraph.getFirstCluster();t!==-1;t=this.m_topoGraph.getNextCluster(t)){let r=this.m_topoGraph.getClusterParentage(t);if(this.isGoodParentage(r)){let r=-1;for(let n=this.m_topoGraph.getClusterVertexIterator(t);n!==-1;n=this.m_topoGraph.incrementVertexIterator(n)){let t=this.m_topoGraph.getVertexFromVertexIterator(n);r===-1&&(r=t);let i=e.getGeometryFromPath(e.getPathFromVertex(t)),a=this.m_topoGraph.getGeometryID(i);if(this.isGoodParentage(a)){r=t;break}}e.addVertex(n,r)}}return t}intersection(e,t){let n=this.m_topoGraph.getShape().getGeometryType(e),r=this.m_topoGraph.getShape().getGeometryType(t),i=Se(n),a=Se(r),o=this.m_topoGraph.getGeometryID(e),s=this.m_topoGraph.getGeometryID(t);U(o>=0),U(s>=0),this.m_maskLookup.length=0,this.m_maskLookup.length=1+(o|s),this.m_maskLookup[o|s]=!0;let c=-1;return this.m_topoGraph.getShape().getVertexDescription().getAttributeCount()>1&&(c=e),i===2&&a===2?this.topoOperationPolygonPolygon_(e,t,c):i===1&&a>0||a===1&&i>0?this.topoOperationPolyline_(c,this.m_bOGCOutput):i===0||a===0?this.topoOperationMultiPoint_():void B(``)}topoOperationPolygonPolygonEx(e,t,n){let r=this.m_topoGraph.getShape(),i=r.createGeometry(L.enumPolygon),a=r.createGeometry(L.enumPolyline),o=r.createGeometry(L.enumMultiPoint);this.dissolveTopoGraphCommonEdges_();let s=-1,c=this.m_topoGraph.createUserIndexForHalfEdges(),l=this.m_topoGraph.createUserIndexForClusters();r.dbgVerifyCurves(),this.topoOperationPolygonPolygonHelper_(e,t,i,n,c,l),r.dbgVerifyCurves();let u=r.hasSegmentParentage(),d=new Q;for(let e=this.m_topoGraph.getFirstCluster();e!==-1;e=this.m_topoGraph.getNextCluster(e)){let t=this.m_topoGraph.getClusterHalfEdge(e);if(t===-1)continue;let i=t;do{let t=this.m_topoGraph.getHalfEdgeUserIndex(i,c),o=this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgeTwin(i),c),s=t|o;if(s===2){let f=this.m_topoGraph.getHalfEdgeParentage(i);if(this.isGoodParentage(f)){let p=r.insertPath(a,-1),m=i,h=this.chooseVertexFromCluster_(e,n),g=r.addVertex(p,h);if(u){let e=this.m_topoGraph.getSegmentParentage(i),t=this.m_topoGraph.getHalfEdgeOrigin(i);r.setSegmentParentageAndBreak(g,e,this.m_topoGraph.isBreakNode(t))}this.m_topoGraph.isHalfEdgeCurve(i)&&(this.m_topoGraph.querySegmentXY(i,d),r.setSegmentToIndex(r.getVertexIndex(g),d.get().clone())),this.m_topoGraph.setClusterUserIndex(e,l,1);do{this.progress_();let e=this.m_topoGraph.getHalfEdgeTo(m),a=this.chooseVertexFromCluster_(e,n);if(g=r.addVertex(p,a),u){let e=this.m_topoGraph.getSegmentParentage(i),t=this.m_topoGraph.getHalfEdgeOrigin(i);r.setSegmentParentageAndBreak(g,e,this.m_topoGraph.isBreakNode(t))}if(this.m_topoGraph.setHalfEdgeUserIndex(m,c,1),this.m_topoGraph.setHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgeTwin(m),c,1),this.m_topoGraph.setClusterUserIndex(e,l,1),m=this.m_topoGraph.getHalfEdgeNext(m),t=this.m_topoGraph.getHalfEdgeUserIndex(m,c),o=this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgeTwin(m),c),s=t|o,s!==2)break;if(f=this.m_topoGraph.getHalfEdgeParentage(m),!this.isGoodParentage(f)){this.m_topoGraph.setHalfEdgeUserIndex(m,c,1),this.m_topoGraph.setHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgeTwin(m),c,1);break}this.m_topoGraph.isHalfEdgeCurve(i)&&m!==i&&(this.m_topoGraph.querySegmentXY(i,d),r.setSegmentToIndex(r.getVertexIndex(g),d.get().clone()))}while(m!==i)}else this.m_topoGraph.setHalfEdgeUserIndex(i,c,1),this.m_topoGraph.setHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgeTwin(i),c,1)}i=this.m_topoGraph.getHalfEdgeNext(this.m_topoGraph.getHalfEdgeTwin(i))}while(i!==t)}for(let e=this.m_topoGraph.getFirstCluster();e!==-1;e=this.m_topoGraph.getNextCluster(e)){if(this.progress_(),this.m_topoGraph.getClusterUserIndex(e,l)===1)continue;let t=this.m_topoGraph.getClusterParentage(e);if(this.isGoodParentage(t)){s===-1&&(s=r.insertPath(o,-1));let t=this.m_topoGraph.getClusterVertexIterator(e),i=-1;if(t!==-1){i=this.m_topoGraph.getVertexFromVertexIterator(t);let e=this.chooseVertexFromVertexCluster_(i,n);r.addVertex(s,e)}}}this.m_topoGraph.deleteUserIndexForClusters(l),this.m_topoGraph.deleteUserIndexForHalfEdges(c),r.dbgVerifyCurves(),Qp(r,i,3,this.m_bOGCOutput,-1,this.m_progressTracker);let f=[-1,-1,-1];return f[0]=o,f[1]=a,f[2]=i,f}topoOperationPolylinePolylineOrPolygonEx(e,t){let n=k_();return n.allCrossRoadsImpassable=!1,n.ogcRule=t,n.unsplitBehavior=0,this.topoOperationPolylineSimplifyOrPolylineTopoHelper_(-1,e,!0,n)}topoOperationMultiPoint(){let e=this.m_topoGraph.getShape(),t=e.createGeometry(L.enumMultiPoint),n=e.insertPath(t,-1);for(let t=this.m_topoGraph.getFirstCluster();t!==-1;t=this.m_topoGraph.getNextCluster(t)){let r=this.m_topoGraph.getClusterParentage(t);if(this.isGoodParentage(r)){let r=-1;for(let n=this.m_topoGraph.getClusterVertexIterator(t);n!==-1;n=this.m_topoGraph.incrementVertexIterator(n)){let t=this.m_topoGraph.getVertexFromVertexIterator(n);r===-1&&(r=t);let i=e.getGeometryFromPath(e.getPathFromVertex(t)),a=this.m_topoGraph.getGeometryID(i);if(this.isGoodParentage(a)){r=t;break}}e.addVertex(n,r)}}return t}intersectionEx(e,t){let n=this.m_topoGraph.getShape().getGeometryType(e),r=this.m_topoGraph.getShape().getGeometryType(t),i=D_(n),a=D_(r),o=this.m_topoGraph.getGeometryID(e),s=this.m_topoGraph.getGeometryID(t);U(o>=0),U(s>=0),this.m_maskLookup.length=0,this.m_maskLookup.length=1+(o|s),this.m_maskLookup[o|s]=!0;let c=-1;if(this.m_topoGraph.getShape().getVertexDescription().getAttributeCount()>1&&(c=e),i===2&&a===2)return this.topoOperationPolygonPolygonEx(e,t,c);if(i===1&&a>0||a===1&&i>0){let{first:e,second:t}=this.topoOperationPolylinePolylineOrPolygonEx(c,this.m_bOGCOutput);return[t,e]}if(i===0||a===0){let e=[];return e.push(this.topoOperationMultiPoint()),e}B(``)}getCombinedHalfEdgeParentage(e){return this.m_topoGraph.getHalfEdgeParentage(e)|this.m_topoGraph.getHalfEdgeFaceParentage(e)|this.m_topoGraph.getHalfEdgeFaceParentage(this.m_topoGraph.getHalfEdgeTwin(e))}prevailingDirection(e,t){let n=this.getCombinedHalfEdgeParentage(t),r=this.m_topoGraph.getHalfEdgeOrigin(t),i=this.m_topoGraph.getHalfEdgeTo(t),a=0,o=0;for(let s=this.m_topoGraph.getClusterVertexIterator(r);s!==-1;s=this.m_topoGraph.incrementVertexIterator(s)){let r=this.m_topoGraph.getVertexFromVertexIterator(s),c=e.getPathFromVertex(r),l=e.getGeometryFromPath(c),u=this.m_topoGraph.getGeometryID(l),d=e.getFirstVertex(c),f=(u&n)!==0;f&&d===r&&(this.m_fromEdgeForPolylines=t);let p=e.getNextVertex(r);if(p!==-1&&this.m_topoGraph.getClusterFromVertex(p)===i){if(a++,f){if(this.m_fromEdgeForPolylines===-1&&d===p){let e=this.m_topoGraph.getHalfEdgeNext(t);this.isGoodParentage(this.getCombinedHalfEdgeParentage(e))&&(this.m_fromEdgeForPolylines=e)}o++}}else{let n=e.getPrevVertex(r);if(n!==-1&&this.m_topoGraph.getClusterFromVertex(n)===i&&(a--,f)){if(this.m_fromEdgeForPolylines===-1&&d===n){let e=this.m_topoGraph.getHalfEdgeNext(t);this.isGoodParentage(this.getCombinedHalfEdgeParentage(e))&&(this.m_fromEdgeForPolylines=e)}o--}}}return this.m_topoGraph.queryXY(r,this.m_dummyPt1),this.m_topoGraph.queryXY(i,this.m_dummyPt2),(o===0?a:o)*z.distance(this.m_dummyPt1,this.m_dummyPt2)}tryMoveThroughCrossroadBackwards(e,t){let n=this.m_topoGraph.getHalfEdgePrev(e),r=this.m_topoGraph.getHalfEdgeTwin(n);if(!t){if(this.m_topoGraph.isStrongPathNode(this.m_topoGraph.getHalfEdgeOrigin(e)))return-1;let t=this.m_topoGraph.getHalfEdgeTwin(e);if(r===this.m_topoGraph.getHalfEdgeNext(t))return n}let i=r,a=-1;for(;i!==e;){let e=this.getCombinedHalfEdgeParentage(i);if(this.isGoodParentage(e)){if(a!==-1)return-1;a=this.m_topoGraph.getHalfEdgeTwin(i)}i=this.m_topoGraph.getHalfEdgeTwin(this.m_topoGraph.getHalfEdgePrev(i))}return a}tryMoveThroughCrossroadForward(e,t){let n=this.m_topoGraph.getHalfEdgeNext(e),r=this.m_topoGraph.getHalfEdgeTwin(n);if(!t){let t=this.m_topoGraph.getHalfEdgeTwin(e);if(this.m_topoGraph.isStrongPathNode(this.m_topoGraph.getHalfEdgeOrigin(t)))return-1;if(r===this.m_topoGraph.getHalfEdgePrev(t))return n}let i=r,a=-1;for(;i!==e;){let e=this.getCombinedHalfEdgeParentage(i);if(this.isGoodParentage(e)){if(a!==-1)return-1;a=this.m_topoGraph.getHalfEdgeTwin(i)}i=this.m_topoGraph.getHalfEdgeTwin(this.m_topoGraph.getHalfEdgeNext(i))}return a}isOnALoop(e,t){let n=e,r=2*this.m_topoGraph.getShape().getTotalPointCount()+10;for(let i=0;i<r;i++){if(this.m_topoGraph.getHalfEdgeUserIndex(n,t)===1)return!1;let r=this.m_topoGraph.getHalfEdgeNext(n);if(r===this.m_topoGraph.getHalfEdgeTwin(n))return!1;if(n=r,n===e)return!0}B(`is_on_a_loop_`)}restorePolylineParts(e,t,n,r,i,a,o,s,c,l){U(i===-1&&a>=0&&o>=0||a===-1&&o===-1),U(s===-1&&l.unsplitBehavior!==1||s!==-1&&l.unsplitBehavior===1);let u=l.ogcRule,d=l.allCrossRoadsImpassable,f=l.unsplitBehavior===1,p=l.unsplitBehavior===0,m=this.m_topoGraph.getShape(),h=m.hasSegmentParentage(),g=e,_=this.m_topoGraph.getHalfEdgeTwin(g),v=new Q;this.m_fromEdgeForPolylines=-1;let y=this.prevailingDirection(m,g),b=g,x=-1,S=!1,C=!1,w=!1;if(!f)for(;;){let t=this.m_topoGraph.getHalfEdgePrev(g);if(t===_){w=!0;break}let r=this.m_topoGraph.getHalfEdgeNext(_);if(this.m_topoGraph.isStrongPathNode(this.m_topoGraph.getHalfEdgeOrigin(r))){S=!0;break}if(this.m_topoGraph.getHalfEdgeTwin(t)!==r){if(d){S=!0;break}if(g=this.tryMoveThroughCrossroadBackwards(g,!0),g===-1){S=!0;break}_=this.m_topoGraph.getHalfEdgeTwin(g)}else g=t,_=r;if(this.m_topoGraph.getHalfEdgeUserIndex(g,n)===1){w=!0;break}if(g===e){x=e,C=!0;break}let i=this.getCombinedHalfEdgeParentage(g);if(!this.isGoodParentage(i))break;b=g,y+=this.prevailingDirection(m,g)}if(x===-1){for(g=e,_=this.m_topoGraph.getHalfEdgeTwin(g),x=g;;){let e=this.m_topoGraph.getHalfEdgeNext(g),t=this.m_topoGraph.isStrongPathNode(this.m_topoGraph.getHalfEdgeOrigin(e));if(t){S=!0;break}if(e===_){w=!0;break}if(s!==-1){let e=this.m_topoGraph.getHalfEdgeOrigin(_);if(this.m_topoGraph.getClusterUserIndex(e,s)===1){S=!0;break}}let r=this.m_topoGraph.getHalfEdgePrev(_);if(this.m_topoGraph.getHalfEdgeTwin(e)!==r){if(t||d){S=!0;break}if(g=this.tryMoveThroughCrossroadForward(g,!0),g===-1){S=!0;break}_=this.m_topoGraph.getHalfEdgeTwin(g)}else g=e,_=r;if(this.m_topoGraph.getHalfEdgeUserIndex(g,n)===1){w=!0;break}let i=this.getCombinedHalfEdgeParentage(g);if(!this.isGoodParentage(i))break;x=g,y+=this.prevailingDirection(m,g)}let t=this.m_topoGraph.getHalfEdgeOrigin(b);C=this.m_topoGraph.getHalfEdgeTo(x)===t}else if(this.m_fromEdgeForPolylines!==-1){b=e,x=this.tryMoveThroughCrossroadBackwards(b,!1),U(x!==-1);let t=this.m_topoGraph.getHalfEdgeTwin(b);this.m_topoGraph.getHalfEdgeNext(t)}let T=C;C||w||c&&(T=this.isOnALoop(e,n),T||=this.isOnALoop(_,n));let E=y>=0,D=!1;T&&S&&(C?(D=u,E&&(D||f||p)&&b!==e&&(U(!f),b=e,D=!1)):(f||E&&p)&&(b=e));let O=0;for(g=b;_=this.m_topoGraph.getHalfEdgeTwin(g),this.m_topoGraph.setHalfEdgeUserIndex(g,n,1),this.m_topoGraph.setHalfEdgeUserIndex(_,n,1),O++,g!==x;)g=d?this.m_topoGraph.getHalfEdgeNext(g):this.tryMoveThroughCrossroadForward(g,!1);E||(x=W(b,b=x),x=this.m_topoGraph.getHalfEdgeTwin(x),b=this.m_topoGraph.getHalfEdgeTwin(b));let k=m.insertPath(t,-1);g=b;let A=this.m_topoGraph.getHalfEdgeOrigin(b),j;j=a===-1?this.chooseVertexFromCluster_(A,i):this.chooseVertexByOrder(A,m,a,o),this.m_topoGraph.isStrongPathNode(A)&&m.setStrongPathStart(k,!0);let M=m.addVertex(k,j),N=M;r!==-1&&this.m_topoGraph.setClusterUserIndex(A,r,1);let P=0,ee=D?Math.trunc((O+1)/2):-1,te=-1,F=!0,ne=-1;for(;;){if(h){let e=this.m_topoGraph.getSegmentParentage(g),t=this.m_topoGraph.getHalfEdgeOrigin(g);m.setSegmentParentageAndBreak(N,e,F||this.m_topoGraph.isBreakNode(t))}F=!1,this.m_topoGraph.isHalfEdgeCurve(g)&&(this.m_topoGraph.querySegmentXY(g,v),m.setSegmentToIndex(m.getVertexIndex(N),v.get().clone())),te!==-1&&o!==-1&&m.addToUserIndex(te,o,-1);let e=d?this.m_topoGraph.getHalfEdgeNext(g):this.tryMoveThroughCrossroadForward(g,!1),n=this.m_topoGraph.getHalfEdgeTo(g),s;if(s=a===-1?this.chooseVertexFromCluster_(n,i):this.chooseVertexByOrder(n,m,a,o),M=m.addVertex(k,s),ne=n,r!==-1&&this.m_topoGraph.setClusterUserIndex(n,r,1),h&&this.m_topoGraph.isBreakNode(n)&&m.setSegmentParentageBreakVertex(M,!0),te=s,P++,D&&P===ee&&(k=m.insertPath(t,-1),M=m.addVertex(k,s),F=!0,o!==-1&&m.addToUserIndex(s,o,-1),te=-1),g===x)break;g=e,N=M}ne!==-1&&this.m_topoGraph.isStrongPathNode(ne)&&m.setStrongPathEnd(k,!0)}topoOperationPolylineSimplify_(e,t){return this.topoOperationPolylineSimplifyOrPolylineTopoHelper_(e,-1,!1,t).first}topoOperationPolylineSimplifyOrPolylineTopoHelper_(e,t,n,r){U(t===-1||e===-1);let i=this.m_topoGraph.getShape(),a=t=>t=e===-1?t===-1?i.getFirstGeometry():i.getNextGeometry(t):t===-1?e:-1,o=i.createGeometry(L.enumPolyline),s=-1;n&&(s=this.m_topoGraph.createUserIndexForClusters());let c=this.m_topoGraph.createUserIndexForHalfEdges(),l=t===-1?i.createUserIndex():-1,u=t===-1?i.createUserIndex():-1,d=-1;if(r.unsplitBehavior===1){d=this.m_topoGraph.createUserIndexForClusters();for(let e=a(-1);e!==-1;e=a(e))for(let t=i.getFirstPath(e);t!==-1;t=i.getNextPath(t)){{let e=i.getFirstVertex(t),n=this.m_topoGraph.getClusterFromVertex(e);this.m_topoGraph.setClusterUserIndex(n,d,1)}if(!i.isClosedPath(t)){let e=i.getLastVertex(t),n=this.m_topoGraph.getClusterFromVertex(e);this.m_topoGraph.setClusterUserIndex(n,d,1)}}}if(t===-1){let e=0;for(let t=a(-1);t!==-1;t=a(t))for(let n=i.getFirstPath(t);n!==-1;n=i.getNextPath(n))if(i.isClosedPath(n)){let t=i.getFirstVertex(n);for(let r=0,a=i.getPathSize(n);r<a;r++,t=i.getNextVertex(t))i.setUserIndex(t,l,e++),i.setUserIndex(t,u,2)}else{let t=i.getFirstVertex(n);i.setUserIndex(t,l,e++),i.setUserIndex(t,u,1);let r=i.getNextVertex(t);for(let t=1,a=i.getPathSize(n)-1;t<a;++t)i.setUserIndex(r,l,e++),i.setUserIndex(r,u,2),r=i.getNextVertex(r);i.setUserIndex(r,l,e++),i.setUserIndex(r,u,1)}}for(let e=a(-1);e!==-1;e=a(e))for(let n=i.getFirstPath(e);n!==-1;n=i.getNextPath(n)){let e=i.getFirstVertex(n);for(let a=0,f=i.getPathSize(n);a<f;a++,e=i.getNextVertex(e)){let n=this.m_topoGraph.getHalfEdgeFromVertex(e);if(n===-1||this.m_topoGraph.getHalfEdgeUserIndex(n,c)===1)continue;let i=this.getCombinedHalfEdgeParentage(n);if(this.isGoodParentage(i)){let e=a===0;this.restorePolylineParts(n,o,c,s,t,l,u,d,e,r)}}}let f=-1;if(n){f=i.createGeometry(L.enumMultiPoint);let e=-1;for(let n=this.m_topoGraph.getFirstCluster();n!==-1;n=this.m_topoGraph.getNextCluster(n))if(this.progress_(),this.m_topoGraph.getClusterUserIndex(n,s)!==1){let r=this.m_topoGraph.getClusterParentage(n);if(this.isGoodParentage(r)){e===-1&&(e=i.insertPath(f,-1));let r=this.m_topoGraph.getClusterVertexIterator(n);if(r!==-1){let a;this.m_topoGraph.getVertexFromVertexIterator(r),a=l===-1?this.chooseVertexFromCluster_(n,t):this.chooseVertexByOrder(n,i,l,u),i.addVertex(e,a)}}}}return u!==-1&&i.removeUserIndex(u),l!==-1&&i.removeUserIndex(l),s!==-1&&i.removeUserIndex(s),this.m_topoGraph.deleteUserIndexForHalfEdges(c),lt(o,f)}difference(e,t){let n=this.m_topoGraph.getShape().getGeometryType(e),r=this.m_topoGraph.getShape().getGeometryType(t),i=Se(n),a=Se(r);if(i>a)return e;let o=this.m_topoGraph.getGeometryID(e),s=this.m_topoGraph.getGeometryID(t);if(this.m_maskLookup.length=0,this.m_maskLookup.length=1+(o|s),this.m_maskLookup[o]=!0,i===2&&a===2){let n=-1;return this.m_topoGraph.getShape().getVertexDescription().getAttributeCount()>1&&(n=e),this.topoOperationPolygonPolygon_(e,t,n)}if(i===1&&a===2){let t=k_();return t.allCrossRoadsImpassable=!1,t.ogcRule=this.m_bOGCOutput,t.unsplitBehavior=0,this.topoOperationPolylineSimplifyOrPolylineTopoHelper_(e,-1,!1,t).first}if(i===1&&a===1){let t=k_();return t.allCrossRoadsImpassable=!0,t.ogcRule=this.m_bOGCOutput,t.unsplitBehavior=0,this.topoOperationPolylineSimplifyOrPolylineTopoHelper_(e,-1,!1,t).first}if(i===0)return this.topoOperationMultiPoint_();B(``)}symmetricDifference(e,t){let n=this.m_topoGraph.getShape().getGeometryType(e),r=this.m_topoGraph.getShape().getGeometryType(t),i=D_(n),a=D_(r),o=this.m_topoGraph.getGeometryID(e),s=this.m_topoGraph.getGeometryID(t);return U(o>=0),U(s>=0),this.m_maskLookup.length=0,this.m_maskLookup.length=1+(o|s),this.m_maskLookup[o]=!0,this.m_maskLookup[o]=!0,this.m_maskLookup[s]=!0,i===2&&a===2?this.topoOperationPolygonPolygon_(e,t,-1):i===1&&a===1?this.topoOperationPolyline_(-1,this.m_bOGCOutput):i===0&&a===0?this.topoOperationMultiPoint():void B(``)}planarSimplifyNoCrackingAndCluster(e,t,n,r){this.m_bOGCOutput=e,this.m_topoGraph=new np;let i=t.getFillRule(n),a=t.getGeometryType(n);if(i!==1||a===L.enumMultiPoint?this.m_topoGraph.setAndSimplifyEditShapeAlternate(t,n,this.m_progressTracker):this.m_topoGraph.setAndSimplifyEditShapeWinding(t,n,this.m_progressTracker),this.m_topoGraph.dirtyCheckFailed())return!1;this.m_topoGraph.setCheckDirtyPlanesweepTolerance(NaN);let o=this.m_topoGraph.getGeometryID(n);if(U(o>=0),this.m_maskLookup.length=0,this.m_maskLookup.length=o+1,this.m_maskLookup[o]=!0,t.getGeometryType(n)===L.enumPolygon||i===1&&t.getGeometryType(n)!==L.enumMultiPoint){t.setFillRule(n,0);let a=this.topoOperationPolygonPolygon_(n,-1,-1);if(t.swapGeometry(a,n),t.removeGeometry(a),i===1&&this.m_bOGCOutput)return this.planarSimplifyNoCrackingAndCluster(e,t,n,r)}else if(t.getGeometryType(n)===L.enumPolyline){let e=k_();e.ogcRule=this.m_bOGCOutput,e.allCrossRoadsImpassable=!0,e.unsplitBehavior=r;let i=this.topoOperationPolylineSimplify_(t.getFirstGeometry(),e);t.swapGeometry(i,n),t.removeGeometry(i)}else if(t.getGeometryType(n)===L.enumMultiPoint){let e=this.topoOperationMultiPoint_();t.swapGeometry(e,n),t.removeGeometry(e)}else B(``);return!0}unsplitPolylineExact(e){return U(0),new Bi}planarSimplifyPolylines(e,t,n,r,i){for(let t=e.getFirstGeometry();t!==-1;t=e.getNextGeometry(t)){let n=e.getGeometryType(t);U(n===L.enumPolyline)}let a=0,o=0,s=null;if(e.hasCurves()&&!e.hasSegmentParentage()){s=new p_;let n=e.getEnvelope2D(this.m_progressTracker);o=d_(t.total());let r=u_(t.total(),n);a=f_(r,o),r_(e,r,t.total(),12e3,s,null,this.m_progressTracker)}{let n=y_(t.add(a));e.filterClosePoints(n,!1,!1,!1,-1)}if(this.m_topoGraph=new np,i!==4&&i!==5)if(s===null&&n){let r=new Ap(this.m_progressTracker,!1);r.sweepVertical(e,t.total()),r.hadComplications()?(h_(e,t,this.m_progressTracker,!0,!1),n=!1):this.m_topoGraph.setCheckDirtyPlanesweepTolerance(t.total())}else h_(e,t.add(a),this.m_progressTracker,!0,!1),n=!1;else n=!1;e.removeSelection(),e.collapseAllGeometriesToFirst();let c=e.getFirstGeometry();if(this.m_topoGraph.setAndSimplifyEditShapeAlternate(e,c,this.m_progressTracker),this.m_topoGraph.dirtyCheckFailed())return U(n&&s===null),this.m_topoGraph.removeShape(),this.m_topoGraph=null,this.planarSimplifyPolylines(e,t,!1,r,-1);this.m_topoGraph.setCheckDirtyPlanesweepTolerance(NaN);let l=this.m_topoGraph.getGeometryID(c);U(l>=0),this.m_maskLookup.length=0,this.m_maskLookup.length=l+1,this.m_maskLookup[l]=!0;let u=this.topoOperationPolylineSimplify_(e.getFirstGeometry(),r);s!==null&&s.stitchCurves(e,u,o,!0);let d=e.getGeometry(u);return n||d.getImpl().setIsSimple(4,t.total()),d}planarSimplifyMultiPoints(e,t,n,r){for(let t=e.getFirstGeometry();t!==-1;t=e.getNextGeometry(t)){let n=e.getGeometryType(t);U(n===L.enumMultiPoint)}this.m_topoGraph=new np,r!==4&&r!==5&&h_(e,t,this.m_progressTracker,!0,!1),n=!1,e.removeSelection(),e.collapseAllGeometriesToFirst();let i=e.getFirstGeometry();if(this.m_topoGraph.setAndSimplifyEditShapeAlternate(e,i,this.m_progressTracker),this.m_topoGraph.dirtyCheckFailed())return U(n),this.m_topoGraph.removeShape(),this.m_topoGraph=null,this.planarSimplifyMultiPoints(e,t,!1,-1);this.m_topoGraph.setCheckDirtyPlanesweepTolerance(NaN);let a=this.m_topoGraph.getGeometryID(i);U(a>=0),this.m_maskLookup.length=0,this.m_maskLookup.length=a+1,this.m_maskLookup[a]=!0;let o=this.topoOperationMultiPoint(),s=e.getGeometry(o);return n||s.getImpl().setIsSimple(4,t.total()),s}planarSimplifyPolygons(e,t,n,r,i,a){for(let t=e.getFirstGeometry();t!==-1;t=e.getNextGeometry(t)){let r=e.getGeometryType(t);U(r===L.enumPolygon||r===L.enumPolyline&&n)}let o=0,s=0,c=null;if(e.hasCurves()&&!e.hasSegmentParentage()){c=new p_;let n=e.getEnvelope2D(this.m_progressTracker);s=d_(t.total());let r=u_(t.total(),n);o=f_(r,s),r_(e,r,t.total(),12e3,c,null,this.m_progressTracker)}if(a){h_(e,t.add(o),this.m_progressTracker,!0,!1);for(let t=e.getFirstGeometry();t!==-1;t=e.getNextGeometry(t))e.getGeometryType(t)===L.enumPolygon&&Qp(e,t,-1,!1,-1,this.m_progressTracker)}if(this.m_topoGraph=new np,a||i===4||i===5)r=!1;else if(c===null&&r){let n=new Ap(this.m_progressTracker,!1);n.sweepVertical(e,t.total()),n.hadComplications()?(h_(e,t,this.m_progressTracker,!0,!1),r=!1):this.m_topoGraph.setCheckDirtyPlanesweepTolerance(t.total())}else h_(e,t.add(o),this.m_progressTracker,!0,!1),r=!1;e.removeSelection(),e.collapseAllGeometriesToFirst();let l=e.getFirstGeometry();if(n?this.m_topoGraph.setAndSimplifyEditShapeWinding(e,l,this.m_progressTracker):this.m_topoGraph.setAndSimplifyEditShapeAlternate(e,l,this.m_progressTracker),this.m_topoGraph.dirtyCheckFailed())return U(r&&c===null),this.m_topoGraph.removeShape(),this.m_topoGraph=null,this.planarSimplifyPolygons(e,t,n,!1,-1,!1);this.m_topoGraph.setCheckDirtyPlanesweepTolerance(NaN);let u=this.m_topoGraph.getGeometryID(l);U(u>=0),this.m_maskLookup.length=0,this.m_maskLookup.length=u+1,this.m_maskLookup[u]=!0,e.setFillRule(l,0);let d=this.m_bOGCOutput&&n,f=d,p=this.topoOperationPolygonPolygon_(l,-1,-1,f);d&&(this.m_topoGraph.removeShape(),this.m_topoGraph=null,e.removeGeometry(l),this.m_topoGraph=new np,this.m_topoGraph.setAndSimplifyEditShapeAlternate(e,p,this.m_progressTracker),p=this.topoOperationPolygonPolygon_(p,-1,-1,!1)),c!==null&&c.stitchCurves(e,p,s,!0);let m=e.getGeometry(p);return m.setFillRule(0),r?m.getImpl().setIsSimple(3,0):(m.getImpl().setIsSimple(4,t.total()),m.getImpl().updateOGCFlagsProtected()),m}planarSimplify3DImpl_(e,t,n,r,i){return U(0),{}}planarSimplifyImpl_(e,t,n,r,i,a,o,s){if(e.isEmpty())return e.clone();let c=e.getGeometryType(),l=new os,u=l.addGeometry(e);if(Un(i)&&c===L.enumPolygon&&(n=!1,l.setFillRule(u,0)),s&&(e.hasAttribute(1)&&l.replaceNaNs(1,0),l.removeNaNVertices()),c===L.enumPolygon||c===L.enumPolyline&&n)return this.planarSimplifyPolygons(l,t,n,r,i,!1);if(c===Bi.type){let e=k_();return e.allCrossRoadsImpassable=!0,e.ogcRule=this.m_bOGCOutput,e.unsplitBehavior=o,this.planarSimplifyPolylines(l,t,r,e,i)}if(c===L.enumMultiPoint)return this.planarSimplifyMultiPoints(l,t,r,i);B(`what else?`)}};function G_(e,t,n,r){if(e.isEmpty())return e.createInstance();if(t.isEmpty())return r?e.createInstance():new q({copy:e});let i=[new z],a=[0],o=t.getDimension()===2;return t.getDimension()!==1&&t.getDimension()!==2&&B(``),i[0]=e.getXY(),o?Wg(t,i,1,n.total(),a):Gg(t,i,1,n.total(),a),a[0]===0?e.createInstance():e}function K_(e,t,n,r){let i=e.createInstance(),a=C(z,100),o=Array(100),s=e.getPointCount(),c=!0,l=t.getDimension()===2;t.getDimension()!==1&&t.getDimension()!==2&&B(``);for(let r=0;r<s;){let s=e.queryCoordinates(a,a.length,r,-1)-r;l?Wg(t,a,s,n.total(),o):Gg(t,a,s,n.total(),o);let u=0;for(let t=0;t<s;t++)o[t]===0&&(c&&(c=!1,i.addPoints(e,0,r)),u!==t&&i.addPoints(e,r+u,r+t),u=t+1);c||u===s||i.addPoints(e,r+u,r+s),r+=s}return c?e:i}function q_(e,t,n,r){let i=e.getGeometryType();if(i===L.enumEnvelope){let t=new X({vd:e.getDescription()});return e.isEmpty()||t.addEnvelope(e,!1),t}if(i===L.enumPoint&&(r===`|`||r===`^`)){let t=new ii({vd:e.getDescription()});return e.isEmpty()||t.add(e),t}if(i===L.enumLine){let t=new Bi({vd:e.getDescription()});return e.isEmpty()||t.addSegment(e,!0),t}if(i===L.enumMultiPoint&&r===`-`&&t.getGeometryType()===L.enumPoint){let t=new q({vd:e.getDescription()});return e.isEmpty()||e.getPointByVal(0,t),t}if(i===L.enumMultiPoint&&r===`&`&&t.getGeometryType()===L.enumPoint){let t=new q({vd:e.getDescription()});return e.isEmpty()||e.getPointByVal(0,t),t}return e}function J_(e){let t=e.getGeometryType();if(t===L.enumEnvelope){let t=new X({vd:e.getDescription()});return e.isEmpty()||t.addEnvelope(e,!1),t}if(t===L.enumPoint){let t=new ii({vd:e.getDescription()});return e.isEmpty()||t.add(e),t}if(E_(t)){let t=new Bi({vd:e.getDescription()});return e.isEmpty()||t.addSegment(e,!0),t}return t!==L.enumMultiPoint&&t!==L.enumPolyline&&t!==L.enumPolygon&&R(`Unexpected geometry type`),e}function Y_(e,t,n,r){let i=n===-1?e.getClusterHalfEdge(t):n,a=i;U(e.getHalfEdgeOrigin(i)===t);do r(a),a=e.getHalfEdgeNext(e.getHalfEdgeTwin(a));while(a!==i)}var X_=class{constructor(e,t,n,r,i,a){this.m_rParent=e,this.m_rTopoGraph=e.m_topoGraph,this.m_rShape=this.m_rTopoGraph.getShape(),this.m_IDCuttee=this.m_rTopoGraph.getGeometryID(r),this.m_IDCutter=this.m_rTopoGraph.getGeometryID(i),this.m_IDBoth=this.m_IDCuttee|this.m_IDCutter,this.m_bConsiderTouch=t,this.m_sideIndex=n,this.m_cuttee=r,this.m_cutter=i,this.m_rCutHandles=a,this.m_cutteeBreadcrumbsIndex=this.m_rShape.createUserIndexUninitialized(),this.m_clusterParentageIndex=this.m_rShape.createUserIndexUninitialized();for(let e=this.m_rShape.getFirstPath(this.m_cuttee);e!==-1;e=this.m_rShape.getNextPath(e)){let t=0,n=this.m_rShape.getPathSize(e);for(let r=this.m_rShape.getFirstVertex(e);t<n;t++,r=this.m_rShape.getNextVertex(r))this.m_rShape.setUserIndex(r,this.m_clusterParentageIndex,this.m_rTopoGraph.getClusterParentage(this.m_rTopoGraph.getClusterFromVertex(r)))}}Do(){this.cutPolylinePolyline_(),this.m_rShape.removeUserIndex(this.m_cutteeBreadcrumbsIndex),this.m_rShape.removeUserIndex(this.m_clusterParentageIndex)}setTbd(e){return 8|e}classifyStandardCut(e,t,n,r){let i=this.m_rShape.getPrevVertex(e),a=this.m_rShape.getNextVertex(e),o=i===-1?-1:this.m_rTopoGraph.getHalfEdgeConnector(t,this.m_rTopoGraph.getClusterFromVertex(i)),s=a===-1?-1:this.m_rTopoGraph.getHalfEdgeConnector(t,this.m_rTopoGraph.getClusterFromVertex(a)),c=this.m_rTopoGraph.getHalfEdgeConnector(t,this.m_rTopoGraph.getClusterFromVertex(n)),l=this.m_rTopoGraph.getHalfEdgeConnector(t,this.m_rTopoGraph.getClusterFromVertex(r)),u=1,d=32,f=32;if(Y_(this.m_rTopoGraph,t,l,e=>{e===c&&(u=2),e===o&&(d=u),e===s&&(f=u)}),this.m_bConsiderTouch)d!==32&&this.m_rShape.setUserIndex(i,this.m_cutteeBreadcrumbsIndex,this.m_rShape.getUserIndex(i,this.m_cutteeBreadcrumbsIndex)|d),f!==32&&this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex)|f);else{if(d===32||f===32||d===f&&!(o===c||o===l||s===c||s===l))return 1;this.m_rShape.setUserIndex(i,this.m_cutteeBreadcrumbsIndex,this.m_rShape.getUserIndex(i,this.m_cutteeBreadcrumbsIndex)|d),this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex)|f)}return 0}classifyTouchCut(e,t,n,r){let i=this.m_rShape.getPrevVertex(e),a=this.m_rShape.getNextVertex(e),o=i===-1?-1:this.m_rTopoGraph.getHalfEdgeConnector(t,this.m_rTopoGraph.getClusterFromVertex(i)),s=a===-1?-1:this.m_rTopoGraph.getHalfEdgeConnector(t,this.m_rTopoGraph.getClusterFromVertex(a)),c=n===-1?-1:this.m_rTopoGraph.getHalfEdgeConnector(t,this.m_rTopoGraph.getClusterFromVertex(n)),l=r===-1?-1:this.m_rTopoGraph.getHalfEdgeConnector(t,this.m_rTopoGraph.getClusterFromVertex(r));if(!this.m_bConsiderTouch){let t;return(t=c===o||l===o)?this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex))):(t=c===s||l===s)&&this.m_rShape.setUserIndex(i,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(i,this.m_cutteeBreadcrumbsIndex))),t?0:1}if(o===-1)return this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex))),0;if(s===-1)return this.m_rShape.setUserIndex(i,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(i,this.m_cutteeBreadcrumbsIndex))),0;if(o===s)return this.m_rShape.setUserIndex(i,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(i,this.m_cutteeBreadcrumbsIndex))),this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex))),0;if(l!==-1){if(o===l)return this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex))),0;if(s===l)return this.m_rShape.setUserIndex(i,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(i,this.m_cutteeBreadcrumbsIndex))),0;let n=1;Y_(this.m_rTopoGraph,t,l,t=>{if(t===o){let e=this.m_rShape.getUserIndex(i,this.m_cutteeBreadcrumbsIndex)|n;this.m_rShape.setUserIndex(i,this.m_cutteeBreadcrumbsIndex,e),n=2}else if(t===s){let t=this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex)|n;this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,t),n=2}})}else{if(o===c)return this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex))),0;if(s===c)return this.m_rShape.setUserIndex(i,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(i,this.m_cutteeBreadcrumbsIndex))),0;let n=2;Y_(this.m_rTopoGraph,t,c,t=>{if(t===o){let e=this.m_rShape.getUserIndex(i,this.m_cutteeBreadcrumbsIndex)|n;this.m_rShape.setUserIndex(i,this.m_cutteeBreadcrumbsIndex,e),n=1}else if(t===s){let t=this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex)|n;this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,t),n=1}})}return 0}classifyCutVertex(e,t){let n=0,r=0;for(let i=this.m_rTopoGraph.getClusterVertexIterator(t);i!==-1;i=this.m_rTopoGraph.incrementVertexIterator(i)){let a=this.m_rTopoGraph.getVertexFromVertexIterator(i);if(this.m_rShape.getGeometryFromVertex(a)===this.m_cutter){r++;let i=this.m_rShape.getPrevVertex(a),o=this.m_rShape.getNextVertex(a);n+=i===-1||o===-1?this.classifyTouchCut(e,t,i,o):this.classifyStandardCut(e,t,i,o)}}r&&n===r&&!this.m_bConsiderTouch&&this.m_rShape.setUserIndex(e,this.m_clusterParentageIndex,this.m_IDCuttee)}cutPolylinePolyline_(){this.m_rShape.getGeometryType(this.m_cuttee),this.m_rShape.getGeometryType(this.m_cutter),this.m_rParent.m_maskLookup.length=0,this.m_rParent.m_maskLookup.length=this.m_IDBoth+1,this.m_rParent.m_maskLookup[this.m_IDBoth]=!0;for(let e=this.m_rShape.getFirstPath(this.m_cuttee);e!==-1;e=this.m_rShape.getNextPath(e)){let t=this.m_rShape.getPathSize(e),n=this.m_rShape.getFirstVertex(e);for(let e=0;e<t;++e,n=this.m_rShape.getNextVertex(n))this.m_rShape.setUserIndex(n,this.m_cutteeBreadcrumbsIndex,0);n=this.m_rShape.getFirstVertex(e);for(let e=0;e<t;++e,n=this.m_rShape.getNextVertex(n)){let e=this.m_rTopoGraph.getClusterFromVertex(n);this.m_rTopoGraph.getClusterParentage(e)===this.m_IDBoth&&this.classifyCutVertex(n,e)}}let e=(e,t)=>{let n=this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex),r=this.m_rTopoGraph.getHalfEdgeConnector(this.m_rTopoGraph.getClusterFromVertex(e),this.m_rTopoGraph.getClusterFromVertex(t));return(this.m_rTopoGraph.getHalfEdgeParentage(r)&this.m_IDBoth)===this.m_IDBoth&&(n|=4),n};for(let t=this.m_rShape.getFirstPath(this.m_cuttee);t!==-1;t=this.m_rShape.getNextPath(t)){let n=this.m_rShape.getFirstVertex(t),r=this.m_rShape.isClosedPath(t),i=this.m_rShape.getPathSize(t)+(r?1:0),a=1,o=32;for(let t=this.m_rShape.getNextVertex(n);a<i;++a,n=t,t=this.m_rShape.getNextVertex(t)){let r=e(n,t);this.m_rShape.getUserIndex(n,this.m_clusterParentageIndex)===this.m_IDBoth&&(o=r),o!==32&&this.m_rShape.setUserIndex(n,this.m_cutteeBreadcrumbsIndex,o|r)}n=this.m_rShape.getLastVertex(t);let s=32;a=1;for(let t=this.m_rShape.getPrevVertex(n);a<i;++a,n=t,t=this.m_rShape.getPrevVertex(t)){let r=e(t,n);this.m_rShape.getUserIndex(n,this.m_clusterParentageIndex)===this.m_IDBoth&&(s=r),s!==32&&this.m_rShape.setUserIndex(t,this.m_cutteeBreadcrumbsIndex,s|r)}}let t=-1,n=-1,r=32,i=this.m_rShape.hasSegmentParentage(),a=new Q;for(let e=this.m_rShape.getFirstPath(this.m_cuttee);e!==-1;e=this.m_rShape.getNextPath(e)){let o=this.m_rShape.isClosedPath(e),s=this.m_rShape.getPathSize(e)+(o?1:0),c=1,l=this.m_rShape.getFirstVertex(e),u=-1,d=!0;for(let e=this.m_rShape.getNextVertex(l);c<s;++c,e=this.m_rShape.getNextVertex(e)){let o=this.m_rShape.getUserIndex(l,this.m_cutteeBreadcrumbsIndex);o===8?o=3:(o&=-9,4&o?o=4:3&~o||(o=3)),o===r?this.m_rShape.getUserIndex(l,this.m_clusterParentageIndex)===this.m_IDBoth&&o!==4&&(u=this.m_rShape.addVertex(n,l),i&&this.m_rTopoGraph.isBreakNode(this.m_rTopoGraph.getClusterFromVertex(l))&&this.m_rShape.setSegmentParentageBreakVertex(u,!0),n=this.m_rShape.insertPath(t,-1),d=!0):(t!==-1&&(u=this.m_rShape.addVertex(n,l),i&&this.m_rTopoGraph.isBreakNode(this.m_rTopoGraph.getClusterFromVertex(l))&&this.m_rShape.setSegmentParentageBreakVertex(u,!0),this.m_rCutHandles.push(t),this.m_rShape.setGeometryUserIndex(t,this.m_sideIndex,r)),t=this.m_rShape.createGeometry(L.enumPolyline),n=this.m_rShape.insertPath(t,-1),r=o,d=!0),u=this.m_rShape.addVertex(n,l);let s=this.m_rTopoGraph.getClusterFromVertex(l);!d&&i&&this.m_rTopoGraph.isBreakNode(s)&&this.m_rShape.setSegmentParentageBreakVertex(u,!0);let c=this.m_rTopoGraph.getHalfEdgeFromVertex(l);if(i){let e=this.m_rTopoGraph.getSegmentParentage(c);this.m_rShape.setSegmentParentageAndBreak(u,e,d||this.m_rTopoGraph.isBreakNode(s))}this.m_rTopoGraph.isHalfEdgeCurve(c)&&(this.m_rTopoGraph.querySegmentXY(c,a),this.m_rShape.setSegmentToIndex(this.m_rShape.getVertexIndex(u),a.get().clone())),l=e,d=!1}u=this.m_rShape.addVertex(n,l),i&&this.m_rTopoGraph.isBreakNode(this.m_rTopoGraph.getClusterFromVertex(l))&&this.m_rShape.setSegmentParentageBreakVertex(u,!0),this.m_rCutHandles.push(t),this.m_rShape.setGeometryUserIndex(t,this.m_sideIndex,r),t=-1,n=-1,r=32}}};function Z_(e,t,n,r,i){if(r&&(r.m_reason=0,r.m_vertexIndex1=-1,r.m_vertexIndex2=-1),e.isEmpty())return 5;let a=e.getGeometryType();if(a===L.enumPoint)return nv(e,r);let o=Ln(t,e,!1).total();if(a===L.enumEnvelope){let t=e,n=new G;return t.queryEnvelope(n),n.isDegenerate(o)?(r&&(r.m_reason=4,r.m_vertexIndex1=-1,r.m_vertexIndex2=-1),0):5}if(Ne(a)){let a=e,o=new Bi({vd:a.getDescription()});return o.addSegment(a,!0),$_(o,t,n,r,i)}let s=e.getImpl().getIsSimple(o,[0]),c=n?-1:s;if(qn(c)||c===0)return c;let l=new pv(e,t,c,i,!1);return a===L.enumMultiPoint||a===L.enumPolyline||a===L.enumPolygon?c=l.isSimplePlanarImpl():B(``),e.getImpl().setIsSimple(c,o),r&&r.assign(l.m_nonSimpleResult),c}function Q_(e,t,n,r,i){if(r&&(r.m_reason=0,r.m_vertexIndex1=-1,r.m_vertexIndex2=-1),e.isEmpty())return 5;let a=e.getGeometryType();if(a===L.enumPoint)return nv(e,r);let o=Ln(t,e,!1).total();if(a===L.enumEnvelope){let t=e,n=new G;return t.queryEnvelope(n),n.isDegenerate(o)?(r&&(r.m_reason=4,r.m_vertexIndex1=-1,r.m_vertexIndex2=-1),0):5}if(Ne(a)){let a=e,o=new Bi({vd:a.getDescription()});return o.addSegment(a,!0),Q_(o,t,n,r,i)}Fe(a),d(a)||xt(`OGC simplify is not implemented for this geometry type`);let s=e.getImpl().getIsSimple(o,[0]),c=n?-1:s;if(c===5||c===0)return c;let l=new pv(e,t,c,i,!0);return a===L.enumMultiPoint||a===L.enumPolyline||a===L.enumPolygon?(c=l.isSimplePlanarImpl(),qn(c)&&(c=5)):B(``),e.getImpl().setIsSimple(c,o),r&&r.assign(l.m_nonSimpleResult),c}function $_(e,t,n,r,i){if(r&&(r.m_reason=0,r.m_vertexIndex1=-1,r.m_vertexIndex2=-1),e.isEmpty())return 5;let a=e.getGeometryType();if(a===L.enumPoint)return nv(e,r);let o=Ln(t,e,!1).total();if(a===L.enumEnvelope){let t=e,n=G.constructEmpty();return t.queryEnvelope(n),n.isDegenerate(o)?(r&&(r.m_reason=4,r.m_vertexIndex1=-1,r.m_vertexIndex2=-1),0):5}if(Ne(a)){let a=e,o=new Bi({vd:a.getDescription()});return o.addSegment(a,!0),$_(o,t,n,r,i)}let s=e.getImpl().getIsSimple(o,[0]),c=n?-1:s;if(c!==-1)return c;let l=new pv(e,t,c,i,!1);return a===L.enumMultiPoint?c=l.multipointIsSimpleAsFeature():a===L.enumPolyline?c=l.polylineIsSimpleAsFeature():a===L.enumPolygon?c=l.polygonIsSimpleAsFeature():B(``),e.getImpl().setIsSimple(c,o),r&&r.assign(l.m_nonSimpleResult),c}function ev(e,t,n,r){if(e.isEmpty())return e;let i=e.getGeometryType();if(i===L.enumPoint){let t=new jt;if(nv(e,t),t.m_reason===3){let t=e.clone();return t.replaceNaNs(1,0),t}return t.m_reason===2?e.createInstance():e}if(i===L.enumEnvelope){let n=Ln(t,e,!0).total(),r=e,i=G.constructEmpty();return r.queryEnvelope(i),i.isDegenerate(n)?r.createInstance():e}if(Ne(i)){let i=e,a=new Bi({vd:i.getDescription()});return a.addSegment(i,!0),ev(a,t,n,r)}Fe(i);let a=Ln(t,e,!1).total(),o=e.getImpl().getIsSimple(a,[0]),s=n?-1:o;if(qn(s)){if(i===L.enumPolygon&&e.getFillRule()!==0){let t=e.clone();return t.setFillRule(0),t}return e}if((i===L.enumMultiPoint||i===L.enumPolyline)&&s>=1)return e;let c=new pv(e,t,s,r,!1),l;return i===L.enumMultiPoint?l=c.multipointSimplifyAsFeature():i===L.enumPolyline?l=c.polylineSimplifyAsFeature():i===L.enumPolygon?l=c.polygonSimplifyAsFeature():B(``),l}function tv(e,t,n,r){if(e.isEmpty())return e;let i=e.getGeometryType();if(i===L.enumPoint){let t=new jt;if(nv(e,t),t.m_reason===3){let t=e.clone();return t.replaceNaNs(1,0),t}return t.m_reason===2?e.createInstance():e}if(i===L.enumEnvelope){let n=e,r=new G;n.queryEnvelope(r);let i=Ln(t,e,!0).total();return r.isDegenerate(i)?n.createInstance():e}if(Ne(i)){let i=e,a=new Bi({vd:i.getDescription()});return a.addSegment(i,!0),tv(a,t,n,r)}Fe(i),d(i)||xt(`OGC simplify is not implemented for this geometry type`);let a=Ln(t,e,!1).total(),o=e.getImpl().getIsSimple(a,[0]),s=n?-1:o;if(s===5){if(i===L.enumPolygon&&e.getFillRule()!==0){let t=e.clone();return t.setFillRule(0),t}return e}return A_(e,Ln(t,e,!0),!1,s,r,0,!0)}function nv(e,t){let n=e.getX(),r=e.getY();if(!Number.isFinite(n)||!Number.isFinite(r))return t&&(t.m_reason=2,t.m_vertexIndex1=-1,t.m_vertexIndex2=-1),0;if(e.hasAttribute(1)){let n=e.getZ();if(!Number.isFinite(n))return t&&(t.m_reason=Number.isNaN(n)?3:2,t.m_vertexIndex1=-1,t.m_vertexIndex2=-1),0}return 5}var rv=class{constructor(){this.m_segment=null,this.m_vertexIndex=-1,this.m_pathIndex=-1,this.m_flags=0}setReversed(e){this.m_flags&=-2,this.m_flags|=e?1:0}getReversed(){return!!(1&this.m_flags)}getRightSide(){return this.getReversed()?0:1}};function iv(){return{x:-1,y:-1,ipath:-1,ivertex:-1,ipolygon:-1}}function av(e,t,n,r,i){return{x:e,y:t,ipath:n,ivertex:r,ipolygon:i}}function ov(e,t){return e.x===t.x&&e.y===t.y&&e.ipath===t.ipath&&e.ivertex===t.ivertex&&e.ipolygon===t.ipolygon}function sv(e,t){e.x=t.x,e.y=t.y,e.ipath=t.ipath,e.ivertex=t.ivertex,e.ipolygon=t.ipolygon}function cv(){return{x:-1,y:-1,ipath:-1,ivertex:-1,bBoundary:!1,bEndPoint:!1}}function lv(e,t,n,r,i,a){return{x:e,y:t,ipath:n,ivertex:r,bBoundary:i,bEndPoint:a}}function uv(e,t){e.x=t.x,e.y=t.y,e.ipath=t.ipath,e.ivertex=t.ivertex,e.bBoundary=t.bBoundary,e.bEndPoint=t.bEndPoint}var dv=class extends vn{constructor(e){super(),this.m_helper=e}compare(e,t,n){let r=e.getElement(n),i=this.m_helper.m_xy.read(2*t)-this.m_helper.m_xy.read(2*r);return i<0?-1:i>0?1:0}},fv=class extends vn{constructor(e){super(),this.m_helper=e}compare(e,t,n){let r=e.getElement(n),i=this.m_helper.m_edges[t],a=this.m_helper.m_edges[r],o=i.getReversed(),s=a.getReversed(),c=i.m_segment.intersectionOfYMonotonicWithAxisX(this.m_helper.m_yScanline,0),l=a.m_segment.intersectionOfYMonotonicWithAxisX(this.m_helper.m_yScanline,0);if(c===l){let e=o?i.m_segment.getStartY():i.m_segment.getEndY(),t=s?a.m_segment.getStartY():a.m_segment.getEndY(),n=Math.min(e,t),r=.5*(n-this.m_helper.m_yScanline)+this.m_helper.m_yScanline;r===this.m_helper.m_yScanline&&(r=n),c=i.m_segment.intersectionOfYMonotonicWithAxisX(r,0),l=a.m_segment.intersectionOfYMonotonicWithAxisX(r,0)}return c<l?-1:c>l?1:0}},pv=class e{constructor(e,t,n,r,i){this.m_multiVertexGeom=null,this.m_edges=[],this.m_freeEdges=[],this.m_lineEdgesRecycle=[],this.m_newEdges=[],this.m_recycledSegIter=null,this.m_crossOverHelperList=new bn,this.m_progressTracker=null,this.m_progressCounter=0,this.m_AET=new yn,this.m_xyToNode1=null,this.m_xyToNode2=null,this.m_pathOrientations=null,this.m_pathParentage=null,this.m_xy=null,this.m_pairs=[],this.m_pairIndices=null,this.m_pathsForOGCTests=[],this.m_curveStitcher=null,this.m_editShape=null,this.m_multiPathStitcher=null,this.m_nonSimpleResult=new jt,this.m_progressCounter=0,this.m_progressTracker=r,this.m_geometry=e,this.m_knownSimpleResult=n,this.m_sr=t;let a=Ln(t,e,!1);this.m_toleranceIsSimple=a,this.m_toleranceIsSimpleClustering=Vn(a),this.m_toleranceIsSimpleCracking=Hn(a),this.m_toleranceSimplify=Ln(t,e,!0),this.m_description=this.m_geometry.getDescription(),this.m_attributeCount=this.m_description.getAttributeCount(),this.m_bOGCRestrictions=i,this.m_bPlanarSimplify=this.m_bOGCRestrictions,this.m_unknownOrientationPathCount=-1,this.m_yScanline=0,this.m_progressCounter=0}isSimplePlanarImpl(){if(this.m_bPlanarSimplify=!0,!this.checkStructure())return 0;let e=this.m_geometry.getGeometryType();return V(e)&&!this.checkDegenerateSegments(!1)?0:this._CheckClustering()?V(e)?this._CheckCracking()?this.m_geometry.getGeometryType()===L.enumPolyline?this.checkSelfIntersectionsPolylinePlanar()?4:0:this._CheckSelfIntersections()?this._CheckValidRingOrientation():0:0:5:0}isSimplePlanarImpl3D(){return U(0),7}generateSortedPairs(e){let t=null;V(e.getGeometryType())&&(t=e);let n=(this.m_bPlanarSimplify||this.m_bOGCRestrictions)&&t!==null,r=e.getPointCount();this.m_xy=e.getAttributeStreamRef(0),this.m_pairs.length=0,this.m_pairIndices=new sn(0),n&&(this.m_pathsForOGCTests.length=0);let i=0;for(let e=0;e<r;e++)if(this.m_pairs.push(2*e),this.m_pairs.push(2*e+1),this.m_pairIndices.add(2*e),this.m_pairIndices.add(2*e+1),n){for(;e>=t.getPathEnd(i);)i++;this.m_pathsForOGCTests.push(i)}let a=new fn,o={parent:this,workPt:new z,userSort(e,t,r){r.sort(e,t,(e,t)=>this.parent.compareVerticesForPlanarClustering(e,t,n))},getValue(e){let t=this.parent.m_pairs[e],n=t>>1;return this.parent.m_xy.queryPoint2D(2*n,this.workPt),this.workPt.y+(1&t?this.parent.m_toleranceIsSimpleClustering:-this.parent.m_toleranceIsSimpleClustering)}};a.sort(this.m_pairIndices,0,2*r,o)}_TestToleranceDistancePlanar(e,t){let n=this.m_xy.read(2*e),r=this.m_xy.read(2*e+1),i=this.m_xy.read(2*t),a=this.m_xy.read(2*t+1);return up(n,r,i,a,this.m_toleranceIsSimpleClustering*this.m_toleranceIsSimpleClustering)?this.m_geometry.getDimension()===0?!1:n===i&&r===a:!0}checkStructure(){let e=this.m_geometry.getGeometryType();if(V(e)){let e=this.m_geometry.getImpl(),t=this.m_geometry.getGeometryType()===L.enumPolygon?3:2;for(let n=0,r=e.getPathCount();n<r;n++)if(e.getPathSize(n)<t){if(e.hasNonLinearSegments()&&e.hasNonLinearSegmentsPath(n)&&e.getPathSize(n)>0)continue;return this.m_nonSimpleResult=new jt(1,n,0),!1}}if(d(e)){let e=this.m_geometry.getImpl(),t=e.getAttributeStreamRef(0);for(let n=0,r=e.getPointCount();n<r;n++)if(!t.readPoint2D(2*n).isFinite())return this.m_nonSimpleResult=new jt(2,n,0),!1;if(this.m_geometry.hasAttribute(1)){let t=e.getAttributeStreamRef(1);for(let n=0,r=e.getPointCount();n<r;n++){let e=t.read(n);if(!Number.isFinite(e))return Number.isNaN(e)?this.m_nonSimpleResult=new jt(3,n,0):this.m_nonSimpleResult=new jt(2,n,0),!1}}}return!0}checkDegenerateSegments(e){let t=this.m_geometry.getImpl(),n=t.querySegmentIterator(),r=t.hasAttribute(1),i=r?In(this.m_sr,t,!1).total():0,a=t.hasNonLinearSegments(),o=this.m_toleranceIsSimple.total();for(;n.nextPath();)for(;n.hasNextSegment();){let t=n.nextSegment(),s=t.calculateLowerLength2D();if(!(s>o)&&!(a&&t.isCurve()&&(s=t.calculateLength2D(),s>o))){if(e&&r){let e=t.getStartAttributeAsDbl(1,0),n=t.getEndAttributeAsDbl(1,0);if(Math.abs(n-e)>i)continue}return this.m_nonSimpleResult=new jt(4,n.getStartPointIndex(),-1),!1}}return!0}checkDegenerateSegments3D(){return U(0),!1}_CheckClustering(){let e=this.m_geometry.getImpl();this.generateSortedPairs(e);let t=e.getPointCount();this.m_AET.clear(),this.m_AET.setComparator(new dv(this)),this.m_AET.setCapacity(t);for(let e=0,n=2*t;e<n;e++){this.progress_();let t=this.m_pairIndices.read(e),n=this.m_pairs[t],r=n>>1;if(1&n){let e=this.m_AET.search(r),t=this.m_AET.getPrev(e),n=this.m_AET.getNext(e);if(this.m_AET.deleteNode(e),t!==yn.st_nullNode()&&n!==yn.st_nullNode()&&!this._TestToleranceDistancePlanar(this.m_AET.getElement(t),this.m_AET.getElement(n)))return this.m_nonSimpleResult=new jt(5,this.m_AET.getElement(t),this.m_AET.getElement(n)),!1}else{let e=this.m_AET.addElement(r),t=this.m_AET.getPrev(e);if(t!==yn.st_nullNode()&&!this._TestToleranceDistancePlanar(this.m_AET.getElement(t),r))return this.m_nonSimpleResult=new jt(5,r,this.m_AET.getElement(t)),!1;let n=this.m_AET.getNext(e);if(n!==yn.st_nullNode()&&!this._TestToleranceDistancePlanar(this.m_AET.getElement(n),r))return this.m_nonSimpleResult=new jt(5,r,this.m_AET.getElement(n)),!1}}return!0}_CheckCracking(){let e=this.m_geometry.getImpl(),t=e.getPointCount();return!e.hasNonLinearSegments()&&t<10?this._CheckCrackingBrute():this._CheckCrackingPlanesweep()}_CheckCrackingPlanesweep(){if(this.m_editShape=new os,this.m_editShape.addGeometry(this.m_geometry),this.m_editShape.hasCurves()){this.m_curveStitcher=new p_;let e=G.constructEmpty();this.m_geometry.queryEnvelope(e);let t=u_(this.m_toleranceSimplify.total(),e),n=new jt;if(o_(this.m_editShape,t,this.m_toleranceSimplify.total(),12e3,n,this.m_curveStitcher,null,this.m_progressTracker),n.m_reason!==0)return this.m_editShape=null,this.m_nonSimpleResult.assign(n),!1}let e=new jt;return Ip(!1,this.m_editShape,this.m_toleranceIsSimpleCracking,e,this.m_progressTracker)?(this.m_curveStitcher==null?(e.m_vertexIndex1=this.m_editShape.getVertexIndex(e.m_vertexIndex1),e.m_vertexIndex2=this.m_editShape.getVertexIndex(e.m_vertexIndex2)):(e.m_vertexIndex1=this.m_curveStitcher.getOriginalVertexIndex(this.m_editShape,e.m_vertexIndex1),e.m_vertexIndex2=this.m_curveStitcher.getOriginalVertexIndex(this.m_editShape,e.m_vertexIndex2),this.m_curveStitcher=null),this.m_editShape=null,this.m_nonSimpleResult.assign(e),!1):(this.m_curveStitcher??(this.m_editShape=null),!0)}_CheckCrackingBrute(){let e=this.m_geometry.getImpl(),t=e.querySegmentIterator(),n=e.querySegmentIterator();for(;t.nextPath();)for(;t.hasNextSegment();){let e=t.nextSegment();if(!t.isLastSegmentInPath()||!t.isLastPath()){n.resetTo(t);do for(;n.hasNextSegment();){let r=n.nextSegment(),i=Id(!0,e,r,this.m_toleranceIsSimpleCracking,!0);if(i)return this.m_nonSimpleResult=new jt(i===2?7:6,t.getStartPointIndex(),n.getStartPointIndex()),!1}while(n.nextPath())}}return!0}_CheckSelfIntersections(){let e=this.m_geometry.getImpl();this.m_curveStitcher!==null&&(this.m_multiPathStitcher=this.m_editShape.getGeometry(this.m_editShape.getFirstGeometry()),e=this.m_multiPathStitcher.getImpl(),this.generateSortedPairs(e)),this.m_edges.length=0,this.m_lineEdgesRecycle.length=0,this.m_recycledSegIter=e.querySegmentIterator(),this.m_recycledSegIter.setCirculator(!0);let t=[],n=e.getPointCount(),r=NaN,i=0;for(let e=0,a=2*n;e<a;e++){this.progress_();let n=this.m_pairIndices.read(e),a=this.m_pairs[n];if(1&a)continue;let o=a>>1,s=this.m_xy.read(2*o),c=this.m_xy.read(2*o+1);if(t.length&&(s!==r||c!==i)){if(!this.processBunchForSelfIntersectionTest(t))return!1;t.length=0}t.push(o),r=s,i=c}return!!this.processBunchForSelfIntersectionTest(t)}checkSelfIntersectionsPolylinePlanar(){let e=this.m_geometry.getImpl(),t=[];for(let n=0,r=e.getPathCount();n<r;n++)t.push(e.isClosedPathInXYPlane(n));let n=cv(),r,i,a;{let o=this.m_pairIndices.read(0),s=this.m_pairs[o]>>1,c=this.m_xy.readPoint2D(2*s),l=this.m_pathsForOGCTests[s];r=t[l],i=e.getPathStart(l),a=e.getPathEnd(l)-1,n.bEndPoint=s===i||s===a,this.m_bOGCRestrictions?n.bBoundary=!r&&n.bEndPoint:n.bBoundary=n.bEndPoint,n.ipath=l,n.x=c.x,n.y=c.y,n.ivertex=s}for(let o=1,s=this.m_pairIndices.size();o<s;o++){let s=this.m_pairIndices.read(o),c=this.m_pairs[s];if(1&c)continue;let l=c>>1,u=this.m_xy.readPoint2D(2*l),d=this.m_pathsForOGCTests[l],f;d!==n.ipath&&(r=t[d],i=e.getPathStart(d),a=e.getPathEnd(d)-1);let p=l===i||l===a;f=this.m_bOGCRestrictions?!r&&p:p;let m=lv(u.x,u.y,d,l,f,p);if(m.x===n.x&&m.y===n.y){if(this.m_bOGCRestrictions){if(!(m.bBoundary&&n.bBoundary||m.ipath===n.ipath&&m.bEndPoint&&n.bEndPoint))return this.m_nonSimpleResult=new jt(10,m.ivertex,n.ivertex),!1}else if(!m.bEndPoint||!n.bEndPoint)return this.m_nonSimpleResult=new jt(7,m.ivertex,n.ivertex),!1}uv(n,m)}return!0}checkSelfIntersectionsPolylinePlanar3D(e){return U(0),!1}checkSelfIntersectionsPolygonsOGC(){let e=this.m_geometry.getImpl(),t=[],n=-1,r=!1;for(let i=0,a=e.getPathCount();i<a;i++)e.isExteriorRingOGC(i)&&(r=!1,n++,i<a-1&&(e.isExteriorRingOGC(i+1)||(r=!0))),t.push(r?n:-1);let i=iv();{let e=this.m_pairIndices.read(0),n=this.m_pairs[e]>>1,r=this.m_xy.readPoint2D(2*n),a=this.m_pathsForOGCTests[n];i.ipath=a,i.x=r.x,i.y=r.y,i.ivertex=n,i.ipolygon=t[a]}let a=[];for(let e=1,n=this.m_pairIndices.size();e<n;e++){let n=this.m_pairIndices.read(e),r=this.m_pairs[n];if(1&r)continue;let o=r>>1,s=this.m_xy.readPoint2D(2*o),c=this.m_pathsForOGCTests[o],l=av(s.x,s.y,c,o,t[c]);if(l.x===i.x&&l.y===i.y){if(l.ipath===i.ipath)return this.m_nonSimpleResult=new jt(11,l.ivertex,i.ivertex),!1;t[l.ipath]>=0&&t[l.ipath]===t[i.ipath]&&(a.length!==0&&ov(a.at(-1),i)||a.push({...i}),a.push(l))}sv(i,l)}if(a.length===0)return!0;let o=new bn(!0);t.fill(-1);let s=-1,c=new z;for(let e=0,n=a.length;e<n;e++){let n=a[e];n.x===c.x&&n.y===c.y||(s=o.createList(0),c.x=n.x,c.y=n.y);let r=t[n.ipath];r===-1&&(r=o.createList(2),t[n.ipath]=r),o.addElement(r,s),o.addElement(s,r)}let l=[];for(let e=o.getFirstList();e!==-1;e=o.getNextList(e)){let n=o.getListData(e);if(1&n||!(2&n))continue;let r=-1;for(l.push(e),l.push(-1);l.length;){let e=l.at(-1);l.pop();let t=l.at(-1);l.pop();let n=o.getListData(t);if(1&n){r=2&n?t:e;break}o.setListData(t,1|n);for(let n=o.getFirst(t);n!==-1;n=o.getNext(n)){let r=o.getData(n);r!==e&&(l.push(r),l.push(t))}}if(r!==-1){let e=t.indexOf(r);return this.m_nonSimpleResult=new jt(12,e,-1),!1}}return!0}_CheckValidRingOrientation(){let e=this.m_multiPathStitcher===null?this.m_geometry.getImpl():this.m_multiPathStitcher.getImpl();if(e.calculateArea2D()<=0)return this.m_nonSimpleResult=new jt(8,e.getPathCount()===1?1:-1,-1),0;if(e.getPathCount()===1)return this.m_bOGCRestrictions&&!this.checkSelfIntersectionsPolygonsOGC()?0:4;this.m_pathOrientations=new on(e.getPathCount(),0),this.m_pathParentage=new sn(e.getPathCount(),-1);let t=-1,n=0;for(let r=0,i=e.getPathCount();r<i;r++){let i=e.calculateRingArea2D(r);if(this.m_pathOrientations.write(r,i<0?0:8),i>0)t=r,n=i;else{if(i===0)return this.m_nonSimpleResult=new jt(8,r,-1),0;if((t<0||n<Math.abs(i))&&(this.m_nonSimpleResult=new jt(9,r,-1),this.m_bOGCRestrictions))return 0;this.m_pathParentage.write(r,t)}}this.m_unknownOrientationPathCount=e.getPathCount(),this.m_newEdges.length=0;let r=e.getPointCount();this.m_yScanline=NaN;let i=[];this.m_xyToNode1=new sn(r,yn.st_nullNode()),this.m_xyToNode2=new sn(r,yn.st_nullNode()),this.m_freeEdges.length=0,this.m_AET.clear(),this.m_AET.setComparator(new fv(this));for(let e=0,t=2*r;this.m_unknownOrientationPathCount>0&&e<t;e++){let t=this.m_pairIndices.read(e),n=this.m_pairs[t];if(1&n)continue;let r=n>>1,a=this.m_xy.read(2*r+1);if(a!==this.m_yScanline&&i.length){if(!this.processBunchForRingOrientationTest(i))return 0;i.length=0}i.push(r),this.m_yScanline=a}return this.m_unknownOrientationPathCount>0&&!this.processBunchForRingOrientationTest(i)?0:this.m_bOGCRestrictions?this.m_nonSimpleResult.m_reason===0&&this.checkSelfIntersectionsPolygonsOGC()?5:0:this.m_nonSimpleResult.m_reason===0?4:3}processBunchForSelfIntersectionTest(e){if(e.length===1)return!0;for(let t=0,n=e.length;t<n;t++){let n=e[t];this.m_recycledSegIter.resetToVertex(n,-1);let r=this.m_recycledSegIter.previousSegment();this.m_edges.push(this.createEdge(r,n,this.m_recycledSegIter.getPathIndex(),!0)),this.m_recycledSegIter.nextSegment();let i=this.m_recycledSegIter.nextSegment();this.m_edges.push(this.createEdge(i,n,this.m_recycledSegIter.getPathIndex(),!1))}this.m_edges.sort((e,t)=>this.edgeAngleCompare(e,t));let t=this.m_crossOverHelperList.getFirstList();t===-1&&(t=this.m_crossOverHelperList.createList(0)),this.m_crossOverHelperList.reserveNodes(this.m_edges.length);for(let e=0,n=this.m_edges.length;e<n;e++)this.m_crossOverHelperList.addElement(t,e);let n=!0,r=-1,i=-1;for(;n;){n=!1;let e=this.m_crossOverHelperList.getFirst(t);if(e===-1)break;let a=this.m_crossOverHelperList.getNext(e);for(;a!==-1;){let o=this.m_crossOverHelperList.getData(e),s=this.m_crossOverHelperList.getData(a);if(r=this.m_edges[o].m_vertexIndex,i=this.m_edges[s].m_vertexIndex,r!==i)e=a,a=this.m_crossOverHelperList.getNext(e);else if(n=!0,this.m_crossOverHelperList.deleteElement(t,e),e=this.m_crossOverHelperList.getPrev(a),a=this.m_crossOverHelperList.deleteElement(t,a),a===-1||e===-1)break}}let a=this.m_crossOverHelperList.getListSize(t);if(this.m_crossOverHelperList.clear(t),a>0)return this.m_nonSimpleResult=new jt(7,r,i),!1;for(let t=0,n=e.length;t<n;t++)this.recycleEdge(this.m_edges[t]);return this.m_edges.length=0,!0}processBunchForRingOrientationTest(e){for(let t=0,n=e.length;t<n;t++){let n=e[t],r=this.m_xyToNode1.read(n);if(r!==yn.st_nullNode()){let e=this.m_AET.getElement(r);this.m_freeEdges.push(e),this.m_AET.deleteNode(r),this.recycleEdge(this.m_edges[e]),this.m_edges[e]=null,this.m_xyToNode1.write(n,yn.st_nullNode())}if(r=this.m_xyToNode2.read(n),r!==yn.st_nullNode()){let e=this.m_AET.getElement(r);this.m_freeEdges.push(e),this.m_AET.deleteNode(r),this.recycleEdge(this.m_edges[e]),this.m_edges[e]=null,this.m_xyToNode2.write(n,yn.st_nullNode())}}for(let t=0,n=e.length;t<n;t++){let n=e[t];this.m_recycledSegIter.resetToVertex(n,-1);let r=this.m_recycledSegIter.previousSegment();if(r.getStartY()>r.getEndY()){let e=this.m_recycledSegIter.getStartPointIndex(),t=this.createEdge(r,n,this.m_recycledSegIter.getPathIndex(),!0),i;this.m_freeEdges.length>0?(i=this.m_freeEdges.at(-1),this.m_freeEdges.pop(),this.m_edges[i]=t):(i=this.m_edges.length,this.m_edges.push(t));let a=this.m_AET.addElement(i);this.m_xyToNode1.read(e)===yn.st_nullNode()?this.m_xyToNode1.write(e,a):this.m_xyToNode2.write(e,a),3&this.m_pathOrientations.read(this.m_recycledSegIter.getPathIndex())||this.m_newEdges.push(a)}this.m_recycledSegIter.nextSegment();let i=this.m_recycledSegIter.nextSegment();if(i.getStartY()<i.getEndY()){let e=this.m_recycledSegIter.getEndPointIndex(),t=this.createEdge(i,n,this.m_recycledSegIter.getPathIndex(),!1),r;this.m_freeEdges.length>0?(r=this.m_freeEdges.at(-1),this.m_freeEdges.pop(),this.m_edges[r]=t):(r=this.m_edges.length,this.m_edges.push(t));let a=this.m_AET.addElement(r);this.m_xyToNode1.read(e)===yn.st_nullNode()?this.m_xyToNode1.write(e,a):this.m_xyToNode2.write(e,a),3&this.m_pathOrientations.read(this.m_recycledSegIter.getPathIndex())||this.m_newEdges.push(a)}}for(let e=0,t=this.m_newEdges.length;e<t&&this.m_unknownOrientationPathCount>0;e++){let t=this.m_newEdges[e],n=this.m_AET.getElement(t),r=this.m_edges[n].m_pathIndex;if(!(3&this.m_pathOrientations.read(r))){let e=-1,n=this.m_AET.getPrev(t),r=t,i=0;{let t=-1,a=null,o=-1,s=0;for(;n!==yn.st_nullNode()&&(t=this.m_AET.getElement(n),a=this.m_edges[t],o=a.m_pathIndex,s=this.m_pathOrientations.read(o),!(3&s));)r=n,n=this.m_AET.getPrev(n);n===yn.st_nullNode()?(i=1,n=r):(e=(3&s)==1?o:this.m_pathParentage.read(o),i=a.getRightSide()?0:1,n=this.m_AET.getNext(n))}do{let t=this.m_AET.getElement(n),a=this.m_edges[t],o=a.m_pathIndex,s=this.m_pathOrientations.read(o);if(!(3&s)){if(i!==a.getRightSide())return this.m_nonSimpleResult=new jt(8,o,-1),!1;let t=i&&!a.getReversed()?1:2;if(s=-4&s|t,this.m_pathOrientations.write(o,s),t===2&&this.m_nonSimpleResult.m_reason===0){let t=this.m_pathParentage.read(o);if(t!==e&&(this.m_nonSimpleResult=new jt(9,o,t),this.m_bOGCRestrictions))return!1}if(this.m_unknownOrientationPathCount--,!this.m_unknownOrientationPathCount)return!0}e=(3&s)==1?o:this.m_pathParentage.read(o),r=n,n=this.m_AET.getNext(n),i=i?0:1}while(r!==t)}}return this.m_newEdges.length=0,!0}createEdge(e,t,n,r){let i;return e.getGeometryType()===L.enumLine?i=this.createEdgeLine(e):(i=new rv,i.m_segment=e.clone()),i.m_vertexIndex=t,i.m_pathIndex=n,i.m_flags=0,i.setReversed(r),i}createEdgeLine(e){let t;return this.m_lineEdgesRecycle.length>0?(t=this.m_lineEdgesRecycle.at(-1),this.m_lineEdgesRecycle.pop(),e.copyTo(t.m_segment)):(t=new rv,t.m_segment=e.clone()),t}recycleEdge(e){e.m_segment.getGeometryType()===L.enumLine&&this.m_lineEdgesRecycle.push(e)}static isShortSegment(e,t,n,r){let i=e.calculateLowerLength2D();if(i<=n){let a=!0;if(e.isCurve()&&(i=e.calculateLength2D(),a=i<=n),a){if(t){let t=e.getEndAttributeAsDbl(1,0);Number.isNaN(t)&&(t=0);let n=e.getStartAttributeAsDbl(1,0);return Number.isNaN(n)&&(n=0),Math.abs(n-t)<=r}return!0}return!1}return!1}static isShortSegmentPoints(e,t,n,r,i){if(n){let n=e.getXYZ(),a=t.getXYZ();return Kn(n,a,r,i)}{let n=e.getXY(),i=t.getXY();return z.sqrDistance(n,i)<=r*r}}removeDegenerateSegmentsFromCurvedPath(t,n,r,i){let a=t.hasAttribute(1),o=t.querySegmentIterator();o.resetToPath(n),U(o.nextPath());let s=this.m_toleranceSimplify.total(),c=!1,l=!0,u=new q,d=new q,f=new z;for(;o.hasNextSegment();){this.progress_();let t=o.nextSegment();if(e.isShortSegment(t,a,s,r))if(c){if(t.queryEnd(d),e.isShortSegmentPoints(u,d,a,s,r))continue;l&&=(i.startPathPoint(u),!1),t.queryEnd(u),i.lineToPoint(u),c=!1}else f.assign(t.getStartXY()),t.queryStart(u),c=!0;else if(c)if(t.isCurve()){let n=t.clone();if(n.setCoordsForIntersector(f,t.getEndXY(),!1),n.setStart(u),e.isShortSegment(n,a,s,r))continue;i.addSegment(n,l),l=!1,c=!1}else{if(t.queryEnd(d),e.isShortSegmentPoints(u,d,a,s,r))continue;l&&=(i.startPathPoint(u),!1),i.lineToPoint(d),c=!1}else i.addSegment(t,l),l=!1}if(l||!c)return;t.isClosedPath(n)?t.getPointByVal(t.getPathStart(n),u):t.getPointByVal(t.getPathEnd(n)-1,u);let p=i.querySegmentIterator();p.resetToLastPath(),p.resetToLastSegment();let m=i.getDescription().getAttributeCount()>1;for(U(p.previousPath());p.hasPreviousSegment();){let t=p.previousSegment();if(t.isCurve()){let n=t.clone();if(n.setCoordsForIntersector(t.getStartXY(),u.getXY(),!1),!e.isShortSegment(n,a,s,r)){m&&n.setEnd(u);let e=p.getEndPointIndex();for(let t=i.getPointCount()-1;t>=e;t--)i.removePoint(t);i.addSegment(n,!1);return}}else if(t.queryStart(d),!e.isShortSegmentPoints(d,u,a,s,r)){let e=p.getEndPointIndex();for(let t=i.getPointCount()-1;t>=e;t--)i.removePoint(t);i.lineToPoint(u);return}}i.removePath(i.getPathCount()-1)}multipointIsSimpleAsFeature(){if(!this.checkStructure())return 0;let e=this.m_geometry.getImpl();this.m_multiVertexGeom=e;let t=e.getPointCount(),n=H(t,0);for(let e=0;e<t;e++)n[e]=e;n.sort((e,t)=>this.compareVerticesMultiPoint(e,t));for(let e=1;e<t;e++)if(this.compareVerticesMultiPoint(n[e-1],n[e])===0)return this.m_nonSimpleResult=new jt(5,n[e-1],n[e]),0;return 1}polylineIsSimpleAsFeature(){return this.checkStructure()&&this.checkDegenerateSegments(!0)?1:0}polygonIsSimpleAsFeature(){return this.isSimplePlanarImpl()}multipointSimplifyAsFeature(){let t=this.m_geometry.getImpl(),n=e.hasNanZs(t),r,i=this.m_geometry;n&&(r=this.m_geometry.clone(),t=r.getImpl(),r.replaceNaNs(1,Rt.getDefaultValue(1)),i=r),this.m_multiVertexGeom=t;let a=t.getPointCount(),o=H(a,0);for(let e=0;e<a;e++)o[e]=e;o.sort((e,t)=>this.compareVerticesMultiPoint(e,t));let s=Array(a);s.fill(!1);let c=-1;for(let e=0;e<a;e++){let n=o[e];t.getXY(n).isFinite()&&((c<0||this.compareVerticesMultiPoint(c,n)!==0)&&(s[n]=!0),c=n)}let l=this.m_geometry.createInstance(),u=0,d=0;for(let e=0;e<a;e++)s[e]?d=e+1:(u<d&&l.addPoints(i,u,d),u=e+1);return u<d&&l.addPoints(i,u,d),l.getImpl().setIsSimple(1,this.m_toleranceSimplify.total()),l}polylineSimplifyAsFeature(){let e=this.m_geometry.getImpl(),t=e.querySegmentIterator(),n=e.querySegmentIterator(),r=this.m_geometry.createInstance(),i=this.m_geometry,a=e.hasAttribute(1),o=a?In(this.m_sr,e,!0).total():0,s=[],c=[],l=null;a&&(l=e.getAttributeStreamRef(1));let u=new q,d=e.hasNonLinearSegments(),f=this.m_toleranceSimplify.total();for(;t.nextPath();){if(n.nextPath(),e.getPathSize(t.getPathIndex())<2)continue;if(d&&e.hasNonLinearSegmentsPath(t.getPathIndex())){this.removeDegenerateSegmentsFromCurvedPath(e,t.getPathIndex(),o,r);continue}n.resetToLastSegment();let p=0,m=0,h=!0,g=!0;for(;t.hasNextSegment();){this.progress_();let r=t.nextSegment(),i=n.previousSegment();if(t.getStartPointIndex()>n.getStartPointIndex())break;if(h){let n=t.getStartPointIndex();e.getXY(n).isNAN()||(h=!1,s.push(n))}if(g){let t=n.getEndPointIndex();e.getXY(t).isNAN()||(c.push(t),g=!1)}if(!h){let n=s.at(-1),i=t.getEndPointIndex();if(i-n>1){let t=new z;t.setSub(e.getXY(n),e.getXY(i)),p=t.length()}else p=r.calculateLength2D();if(p>f)s.push(i),p=0;else if(a){let e=l.read(n);Number.isNaN(e)&&(e=0);let t=l.read(i);Number.isNaN(t)&&(t=0),Math.abs(t-e)>o&&(s.push(i),p=0)}}if(!g){let t=c.at(-1),r=n.getStartPointIndex();if(r-t>1){let n=new z;n.setSub(e.getXY(t),e.getXY(r)),m=n.length()}else m=i.calculateLength2D();if(m>f)c.push(r),m=0;else if(a){let e=l.read(t);Number.isNaN(e)&&(e=0);let n=l.read(r);Number.isNaN(n)&&(n=0),Math.abs(n-e)>o&&(c.push(r),m=0)}}}if(s.length>0&&c.length>0&&(s.at(-1)<c.at(-1)?s.length>c.length?s.pop():c.pop():(s.at(-1)===c.at(-1)||c.pop(),c.pop())),c.length+s.length>=2){let e=!1;for(let t=0,n=s.length;t<n;t++)i.getPointByVal(s[t],u),e?r.lineToPoint(u):(r.startPathPoint(u),e=!0);for(let t=c.length-1;t>0;t--)i.getPointByVal(c[t],u),e?r.lineToPoint(u):(r.startPathPoint(u),e=!0);i.isClosedPath(t.getPathIndex())?r.closePathWithLine():c.length>0&&(i.getPointByVal(c[0],u),r.lineToPoint(u))}s.length=0,c.length=0}return a&&r.replaceNaNs(1,0),r.getImpl().setIsSimple(1,f),r}polygonSimplifyAsFeature(){return this.simplifyPlanar()}simplifyPlanar(){if(this.m_geometry.getFillRule()===1&&!Un(this.m_knownSimpleResult))return j_(this.m_geometry,this.m_toleranceSimplify,!0,!1,this.m_knownSimpleResult,this.m_progressTracker,0,!0);let e=new os;if(e.addGeometry(this.m_geometry),this.m_geometry.hasAttribute(1)&&e.replaceNaNs(1,0),e.removeNaNVertices(),e.getTotalPointCount()!==0){let t=null,n=0,r=0;if(e.hasCurves()){t=new p_;let i=G.constructEmpty();this.m_geometry.queryEnvelope(i);let a=u_(this.m_toleranceSimplify.total(),i);n=d_(this.m_toleranceSimplify.total()),r=f_(a,n),r_(e,a,this.m_toleranceSimplify.total(),12e3,t,null,this.m_progressTracker)}Un(this.m_knownSimpleResult)||h_(e,this.m_toleranceSimplify.add(r),this.m_progressTracker,!0,!1),this.m_geometry.getGeometryType()===L.enumPolygon&&Qp(e,e.getFirstGeometry(),this.m_knownSimpleResult,!1,-1,this.m_progressTracker),t!==null&&t.stitchCurves(e,e.getFirstGeometry(),n,!0)}let t=e.getGeometry(e.getFirstGeometry());return t.getGeometryType()===L.enumPolygon&&(t.getImpl().updateOGCFlagsProtected(),t.setFillRule(0)),t.getImpl().setIsSimple(4,this.m_toleranceSimplify.total()),t}progress_(){}static hasNanZs(e){if(e.hasAttribute(1)){let t=e.getAttributeStreamRef(1);for(let n=0,r=e.getPointCount();n<r;n++){let e=t.read(n);if(Number.isNaN(e))return!0}}return!1}compareVerticesForPlanarClustering(e,t,n){if(e===t)return 0;let r=this.m_pairs[e],i=this.m_pairs[t],a=r>>1,o=i>>1,s=this.m_xy.readPoint2D(2*a);s.y+=1&r?this.m_toleranceIsSimpleClustering:-this.m_toleranceIsSimpleClustering;let c=this.m_xy.readPoint2D(2*o);c.y+=1&i?this.m_toleranceIsSimpleClustering:-this.m_toleranceIsSimpleClustering;let l=s.compare(c);if(l===0&&n){let e=this.m_pathsForOGCTests[a]-this.m_pathsForOGCTests[o];return Ye(e)}return l}compareVerticesMultiPoint(e,t){if(e===t)return 0;let n=this.m_multiVertexGeom.getXY(e),r=this.m_multiVertexGeom.getXY(t),i=!n.isFinite(),a=!r.isFinite();if(i||a)return i<a?-1:i>a?1:0;if(n.y<r.y)return-1;if(n.y>r.y)return 1;if(n.x<r.x)return-1;if(n.x>r.x)return 1;for(let n=1;n<this.m_attributeCount;n++){let r=this.m_description.getSemantics(n),i=Rt.getComponentCount(r);for(let n=0;n<i;n++){let i=this.m_multiVertexGeom.getAttributeAsDbl(r,e,n),a=this.m_multiVertexGeom.getAttributeAsDbl(r,t,n),o=_t(i,a);if(o!==0)return o}}return 0}edgeAngleCompare(e,t){if(e===t)return 0;let n=e.m_segment.getTangent(e.getReversed()?1:0);e.getReversed()&&n.negateThis();let r=t.m_segment.getTangent(t.getReversed()?1:0);t.getReversed()&&r.negateThis();let i=n.getQuarter(),a=r.getQuarter();if(a===i){let e=n.crossProduct(r);return e<0?1:e>0?-1:0}return i<a?-1:1}},mv=class{getOperatorType(){return 10103}accelerateGeometry(e,t,n){return!1}canAccelerateGeometry(e){return!1}supportsCurves(){return!0}isSimpleAsFeature(e,t,n,r,i){let a=$_(e,t,n,r,i);return Jn(e.getGeometryType(),a)}isSimplePlanarDONOTUSE(e,t,n,r,i){let a=Z_(e,t,n,r,i);return qn(a)}executeMany(e,t,n,r){return new hv(e,t,n,r)}execute(e,t,n,i){let a=new r([e]),o=this.executeMany(a,t,n,i).next();return o||B(`null geometry`),o}},hv=class extends n{constructor(e,t,n,r){super(),this.m_progressTracker=r,this.m_bForceSimplify=n,this.m_index=-1,this.m_inputGeometryCursor=e,this.m_spatialReference=t}next(){let e=this.m_inputGeometryCursor.next();return e?(this.m_index=this.m_inputGeometryCursor.getGeometryID(),this.simplify(e)):null}getGeometryID(){return this.m_index}tock(){return!1}getRank(){return 1}simplify(e){if(e||R(``),e.getGeometryType()===L.enumGeometryCollection){let t=fr(e,-1),n=new mv().executeMany(t,this.m_spatialReference,this.m_bForceSimplify,this.m_progressTracker),r=e.createInstance();for(let e=n.next();e!=null;e=n.next())r.addGeometry(e);return r}return ev(e,this.m_spatialReference,this.m_bForceSimplify,this.m_progressTracker)}};function gv(e,t,n){let r=new G;e.queryEnvelope(r);let i=new G;t.queryEnvelope(i);let a=new G(i);if(a.inflate(2*n),!a.isIntersecting(r))return 4;let o=e.getGeometryType(),s=t.getGeometryType();if(o===L.enumEnvelope&&r.containsEnvelope(a))return 1;if(s===L.enumEnvelope){let e=new G(r);if(e.inflate(2*n),i.containsEnvelope(e))return 2}return 0}var _v=class e{constructor(e,t,n,r){this.m_intersectorGeom=null,this.m_sr=null,this.m_dimensionMask=-1,this.m_progressTracker=null,this.m_intersectorGeomType=L.enumUnknown,this.m_geomIntersectorEmptyGeom=null,this.m_intersectorGeom=e,this.m_sr=t,this.m_dimensionMask=n,this.m_progressTracker=r,this.m_intersectorGeomType=e.getGeometryType()}intersect(e){let t=this.tryFastImplementation(e);if(t!==null)return t;let n=An(this.m_intersectorGeom,e),r=Pn(this.m_sr,n,!0).total(),i=G.constructEmpty();this.m_intersectorGeom.queryEnvelope(i);let a=G.constructEmpty();e.queryEnvelope(a),i.inflateCoords(2*r,2*r),i.intersect(a),i.inflateCoords(100*r,100*r);let o=qd(this.m_intersectorGeom,i,0,0,this.m_progressTracker),s=qd(e,i,0,0,this.m_progressTracker);return e.getDimension()>this.m_intersectorGeom.getDimension()&&(o=W(s,s=o)),B_(s,o,this.m_sr,this.m_progressTracker)}intersectEx(e){let t=this.tryFastImplementation(e);if(t!==null){let n=[];return n.length=3,n[t.getDimension()]=t,this.prepareVector(e.getDescription(),this.m_dimensionMask,n)}let n=An(this.m_intersectorGeom,e),r=Pn(this.m_sr,n,!0).total(),i=G.constructEmpty();this.m_intersectorGeom.queryEnvelope(i);let a=G.constructEmpty();e.queryEnvelope(a),i.inflateCoords(2*r,2*r),i.intersect(a),i.inflateCoords(100*r,100*r);let o=qd(this.m_intersectorGeom,i,0,0,this.m_progressTracker),s=qd(e,i,0,0,this.m_progressTracker);e.getDimension()>this.m_intersectorGeom.getDimension()&&(o=W(s,s=o));let c=V_(s,o,this.m_sr,this.m_progressTracker);return this.prepareVector(e.getDescription(),this.m_dimensionMask,c)}init(e,t,n,r=null){U(0)}static intersectPoints(e,t,n){let r=An(e,t);return z_(e,t,Pn(n,r,!0))}tryFastImplementation(t){let n=t.getGeometryType();if(this.m_intersectorGeomType===L.enumPoint&&n===L.enumPoint){let n=e.intersectPoints(t,this.m_intersectorGeom,this.m_sr);if(this.m_dimensionMask!==-1){let e=new ii({vd:n.getDescription()});return n.isEmpty()||e.add(n),e}return n}if(n===L.enumEnvelope&&this.m_intersectorGeomType===L.enumEnvelope&&(this.m_dimensionMask===-1||this.m_dimensionMask===4)){let e=t,n=this.m_intersectorGeom,r=new lr({copy:e});return r.intersect(n),r}let r=An(t,this.m_intersectorGeom),i=Pn(this.m_sr,r,!0),a=t.isEmpty(),o=this.m_intersectorGeom.isEmpty(),s=a||o;if(!s){let e=gv(this.m_intersectorGeom,t,i.total());if(e===4)s=!0;else{if(2&e)return this.m_intersectorGeom;if(1&e)return t}}if(s){let r=Se(n),i=Se(this.m_intersectorGeomType);return r<i?e.ReturnEmpty(t,a):r>i||r===0&&n===L.enumMultiPoint&&this.m_intersectorGeomType===L.enumPoint?this.ReturnEmptyIntersector():e.ReturnEmpty(t,a)}if(n===L.enumEnvelope&&Se(this.m_intersectorGeomType)===0||this.m_intersectorGeomType===L.enumEnvelope&&Se(n)===0){let e=n===L.enumEnvelope?t:this.m_intersectorGeom,r=n===L.enumEnvelope?this.m_intersectorGeom:t,a=G.constructEmpty();return e.queryEnvelope(a),qd(r,a,i.total(),0,this.m_progressTracker)}if(Se(n)===0&&Se(this.m_intersectorGeomType)>0||Se(n)>0&&Se(this.m_intersectorGeomType)===0){if(n===L.enumMultiPoint)return F_(t,this.m_intersectorGeom,i);if(n===L.enumPoint)return R_(t,this.m_intersectorGeom,i);if(this.m_intersectorGeomType===L.enumMultiPoint)return F_(this.m_intersectorGeom,t,i);if(this.m_intersectorGeomType===L.enumPoint)return R_(this.m_intersectorGeom,t,i);B(``)}return null}ReturnEmptyIntersector(){return this.m_geomIntersectorEmptyGeom===null&&(this.m_geomIntersectorEmptyGeom=this.m_intersectorGeom.createInstance()),this.m_geomIntersectorEmptyGeom}static ReturnEmpty(e,t){return t?e:e.createInstance()}prepareVector(e,t,n){let i=0;return 1&t?(n[0]||=new ii({vd:e}),i++):n.shift(),2&t?(n[i]||(n[i]=new Bi({vd:e})),i++):n.splice(i,1),4&t?n[i]||(n[i]=new X({vd:e})):n.splice(i,1),new r(n)}},vv=class extends n{constructor(e,t,n,r,i){super(),this.m_smallCursor=null,this.m_progressTracker=r,this.m_geomIntersector=t.next(),this.m_intersector=new _v(this.m_geomIntersector,n,i,r),this.m_index=-1,this.m_inputGeoms=e,this.m_dimensionMask=i,this.m_dimensionMask!==-1&&(this.m_dimensionMask<=0||this.m_dimensionMask>7)&&R(`bad dimension mask`)}next(){if(!this.m_geomIntersector)return null;let e;if(this.m_smallCursor!==null){if(e=this.m_smallCursor.next(),e)return e;this.m_smallCursor=null}for(;e=this.m_inputGeoms.next();)return $e(e),this.m_index=this.m_inputGeoms.getGeometryID(),this.m_dimensionMask===-1?this.m_intersector.intersect(e):(this.m_smallCursor=this.m_intersector.intersectEx(e),this.m_smallCursor.next());return null}getGeometryID(){return this.m_index}tock(){return!0}getRank(){return 1}},yv=class{getOperatorType(){return 1e4}accelerateGeometry(e,t,n){if(!this.canAccelerateGeometry(e))return!1;Ln(t,e,!0);let r=0;return e.getGeometryType()!==L.enumPolygon&&e.getGeometryType()!==L.enumPolyline||!ki(e)||n===0||(r|=e.getImpl().buildQuadTreeAccelerator(n)?1:0),!!r}canAccelerateGeometry(e){return ki(e)}supportsCurves(){return!0}executeMany(e,t,n,r,i=-1){return new vv(e,t,n,r,i)}execute(e,t,n,i){if(e.getGeometryType()===L.enumPoint&&t.getGeometryType()===L.enumPoint)return _v.intersectPoints(e,t,n);let a=new r([e]),o=new r([t]),s=this.executeMany(a,o,n,i,-1).next();return s||B(`null output`),s}};function bv(e,t,n){return t.m_projector.project(e,n)}function xv(e,t,n,r,i){e.m_projector.transformInPlaceZ(t,null,n,r,null,i);let a=r.slice(0,n).filter(e=>!e.isNAN());for(let e=0,t=a.length;e<t;++e)r[e].assign(a[e]);return a.length}function Sv(e,t,n,r,i){return e.m_projector.transformInPlaceZ(t,null,n,r,null,i)}function Cv(e,t,n,r){if(e&&t&&t.isPannable()||R(`fold_into_360_range_geodetic`),e.isEmpty())return e;if(n===4)return wv(e,t,r);let i=e,a=i.getGeometryType();if(V(a)){i=kb(e,t);let r=new G;i.queryEnvelope(r);let a=Pn(t,r,!1).total(),o=t.getPannableExtent(),s=Math.floor((r.xmin-o.xmin)/o.width())*o.width()+o.xmin,c=i;for(;s<r.xmax;)s>r.xmin+a&&s<r.xmax-a&&(c=Db(c,t,n,!0,s)),s+=o.width();i=c}else{if(a===L.enumEnvelope){let e=new X({vd:i.getDescription()});return e.addEnvelope(i,!1),Cv(e,t,n,r)}if(Ne(a)){let e=new Bi({vd:i.getDescription()});return e.addSegment(i,!0),Cv(e,t,n,r)}}return wv(i,t,r)}function wv(e,t,n){if(e&&t&&t.isPannable()||R(``),e.isEmpty())return e;let r,i=e.getGeometryType();if(i===L.enumEnvelope){let t=new X({vd:e.getDescription()});t.addEnvelope(e,!1),r=t}else if(Ne(i)){let t=new Bi({vd:e.getDescription()});t.addSegment(e,!0),r=t}else r=e;let a=kb(r,t);return a.isEmpty()?a:bb(a,t,0,a!==e,0,n)}function Tv(e,t,n){if(!t.isPannable()||e.isEmpty())return e;let r=t.getPannableExtent().width(),i=.5*r,a=e.queryInterval(0,0);if(a.width()<i||!d(e.getGeometryType())){if(Number.isNaN(n))return e;let t=a.getCenter();if(Math.abs(t-n)<=i)return e;{let i=new At,a=y((n-t)/r)*r;i.setShiftCoords(a,0);let o=e.clone();return o.applyTransformation(i),o}}let o=e.getGeometryType(),s=e,c=s.getAttributeStreamRef(0),l=e.clone(),u=l.getAttributeStreamRef(0),f=0,p=0,m=0,h=V(o)?0:-1,g=I.constructEmpty(),_=!1;for(let e=0,t=s.getPointCount();e<t;e++){let t=c.read(2*e);e===p&&(V(o)?(h===0&&Number.isNaN(n)&&(_=!0),h>0&&Number.isNaN(n)&&(n=g.getCenter(),_=!1),p=s.getPathEnd(h),h++):p=s.getPointCount(),Number.isNaN(n)?m=t:(m=n,f=0));let a=t-m;Math.abs(a)>i&&(a=y(a/r)*r,f-=a,Math.abs(f)<.1*r&&(f=0));let l=t+f;u.write(2*e,l),_&&g.mergeCoordinate(l),m=t}return l.notifyModified(),l}var Ev=`missing implementation`;function Dv(e,t,n,r){let i=t.getCoordinateSystemType();if(i===0){let r=new QS;return t.queryPrecisionDescriptor(r),Ov(e,r,t,n)}let a=e;r!==2&&r!==3||!t.isPannable()||(a=wv(a,t,n));let o=new QS;if(t.queryPrecisionDescriptor(o),a=Ov(a,o,t,n),r===0||a.isEmpty())return a;if(i===1){if(r===1){let e=new G;a.queryLooseEnvelope(e);let r=t.getPannableExtent(),i=.01*r.width();return r.xmin=e.xmin-i,r.xmax=e.xmax+i,new Qd().execute(a,r,t,n)}return a}if(i===2){let e=t.getPCSHorizon();if(r===1||r===2){let r=new yv().execute(a,e,t,n);return r===e?r.clone():r}return a}if(i===3)return a;B(Ev)}function Ov(e,t,n,r){let i=t.getXYGridRange(),a=e.hasAttribute(1),o=e.hasAttribute(2),s=new I,c=new I;a&&(s=t.getZGridRange()),o&&(c=t.getMGridRange());let l=new Qd().execute(e,i,n,r);if(a){let t=l.queryInterval(1,0);s.contains(t)||(e===l&&(l=l.clone()),ir(l,s,1,0))}if(o){let t=l.queryInterval(2,0);c.contains(t)||(e===l&&(l=l.clone()),ir(l,c,2,0))}return l}var kv=class{constructor(e){this.m_inputPCSHorizonClipOption=0,this.m_outputPCSHorizonClipOption=0,this.m_bDontGeonormalizePolygon=!1,this.m_bClipOutCurvedPoles=!1,this.m_bNormalizeOutputGeometry=!1,this.m_bDontHackPolesInGeogToGeog=!1,this.m_centralMeridianOfOutputGCS=0,this.m_densificationStepInput=0,e||R(``),this.m_projTransform=e,this.m_bClipOutCurvedPoles=!1;let t=this.m_projTransform.getExtendedParamsImpl();this.m_bNormalizeOutputGeometry=t.normalizeResultGeometry,this.m_bNormalizeOutputGeometry&&(t.legacyHorizonClipping?this.m_bNormalizeOutputGeometry=!1:this.m_projTransform.getOutputSR().isPannable()||(this.m_bNormalizeOutputGeometry=!1)),t.clipWithInputHorizon?(this.m_inputPCSHorizonClipOption=0,!t.legacyHorizonClipping&&this.m_projTransform.getInputSR().isPannable()&&(this.m_inputPCSHorizonClipOption=this.m_bNormalizeOutputGeometry?4:2)):this.m_inputPCSHorizonClipOption=1,t.clipWithOutputHorizon?(this.m_outputPCSHorizonClipOption=0,!t.legacyHorizonClipping&&this.m_projTransform.getOutputSR().isPannable()&&(this.m_outputPCSHorizonClipOption=this.m_bNormalizeOutputGeometry?4:2)):this.m_outputPCSHorizonClipOption=1,this.m_centralMeridianOfOutputGCS=t.centralMeridianOfOutputGCS,this.m_densificationStepInput=t.densificationStep;let n=this.m_projTransform.getExtendedParamsInternal();this.m_bDontGeonormalizePolygon=n.hasFlag(2147483648),this.m_bDontHackPolesInGeogToGeog=n.hasFlag(1073741824),this.m_bClipOutCurvedPoles=n.hasFlag(536870912)}project(e,t){if(this.m_projTransform.isIdentity()||e.isEmpty())return e;let n=e.getGeometryType();if(n===L.enumPoint)return this.projectPoint(e,t);let r=this.m_projTransform.getInputSR().getCoordinateSystemType(),i=this.m_projTransform.getOutputSR().getCoordinateSystemType(),a=this.m_projTransform.getInputSR(),o=this.m_projTransform.getOutputSR();if(r===0&&r===i){let t=jv(a,o),n=e.clone();return n.applyTransformation(t),n}switch(n){case L.enumPolyline:case L.enumPolygon:return this.projectMultiPath(e,t);case L.enumMultiPoint:return this.projectMultiPoint(e,t);case L.enumEnvelope:return this.projectEnvelope(e,t);case L.enumGeometryCollection:return this.projectGeometryCollection(e,t);default:B(``)}}projectPoint(e,t){let n=[e.getXY()],r,i=null;(r=e.hasAttribute(1))&&(i=[e.getZ()]),this.transformInPlaceZ(n,i,1,n,i,null);let a=e.clone();return a.setXY(n[0]),r&&a.setZ(i[0]),a}projectMultiPoint(e,t){let n=new ii({copy:e}),r=this.m_projTransform.getInputSR(),i=this.m_projTransform.getOutputSR(),a=r.getCoordinateSystemType(),o=i.getCoordinateSystemType();if(a===3&&U(0),n=Lb(n,r,this.m_inputPCSHorizonClipOption,t),n.isEmpty())return n;a===2&&Gb(r,0,n),rx(this.m_projTransform,n,!1);let s=0;o===3&&U(0);let c=o===2;return c?s=i.getCentralMeridian():Number.isNaN(this.m_centralMeridianOfOutputGCS)||(s=this.m_centralMeridianOfOutputGCS),c&&this.m_outputPCSHorizonClipOption!==0||(n=bb(n,BS(i),s,!1,0,t)),c&&(n=hb(n,i,this.m_outputPCSHorizonClipOption,t),Hb(i,n,this.m_bNormalizeOutputGeometry),n.isEmpty()),n}projectMultiPath(e,t){let n=e.getGeometryType();return n===L.enumPolygon?this.projectPolygon(e,t):n===L.enumPolyline?this.projectPolyline(e,t):void B(`project_multi_path_`)}projectEnvelope(e,t){this.m_projTransform.getInputSR(),this.m_projTransform.getOutputSR();let n=this.m_projTransform.isVertical()&&e.hasAttribute(1),r=I.constructEmpty();if(n&&(r=e.queryInterval(1,0)),r.width()>0){let n=e.clone();n.setInterval(1,0,r.vmin,r.vmin);let i=this.projectEnvelopeHelper(n,t);n.setInterval(1,0,r.vmax,r.vmax);let a=this.projectEnvelopeHelper(n,t);return i.merge(a),i}return this.projectEnvelopeHelper(e,t)}projectPolygon(e,t){U(e.getGeometryType()===L.enumPolygon),U(!this.m_projTransform.isIdentity()),U(!e.isEmpty());let n=this.m_projTransform.getInputSR(),r=this.m_projTransform.getOutputSR(),i=n.getCoordinateSystemType(),a=r.getCoordinateSystemType(),o=new X({copy:e});i===3&&U(0),a===3&&U(0);let s=i===2,c=a===2,l=s?n.getGCS():n,u=c?r.getGCS():r,d=!c&&!this.m_bDontHackPolesInGeogToGeog,f=!1,p=Lb(o,n,this.m_inputPCSHorizonClipOption,t);if(p.isEmpty())return p;let m=this.m_densificationStepInput,h=!Number.isNaN(m),g;h&&(p=new rf().execute(p,m,0,0,t));let _=c?r.getPCSInfo():null,v=NaN;s&&(v=n.getCentralMeridian());let y=r.getGCSSplitLines()!==null;if(this.m_bDontGeonormalizePolygon){let e=p;if(s&&(ex(n,v,e),h)){let e=n.getUnitsPerMillimeter();m*=n.getGCS().getUnitsPerMillimeter()/e}if(ax(this.m_projTransform,e,d),h){let e=n.getGCS().getUnitsPerMillimeter();m*=r.getGCS().getUnitsPerMillimeter()/e}g=e}else{let e=new Bi({vd:p.getDescription()});if(e.addAndExplicitlyOpenAllPaths(p,!1),s){if(ex(n,v,e),h){let e=n.getUnitsPerMillimeter();m*=n.getGCS().getUnitsPerMillimeter()/e}if(this.m_bClipOutCurvedPoles){let r=n.getPCSInfo(),i=r.getSouthPoleGeometry()===vC.PE_POLE_LINE_CURVED,a=r.getNorthPoleGeometry()===vC.PE_POLE_LINE_CURVED;if(i||a){let n=G.constructEmpty();e.queryLooseEnvelope(n),n.inflateCoords(1,1);let r=89.9999*l.getOneDegreeGCSUnit();i&&(n.ymin=-r),a&&(n.ymax=r),e=Yd(e,n,l,0,0,t)}}}if(ax(this.m_projTransform,e,d),h){let e=BS(n).getUnitsPerMillimeter();m*=BS(r).getUnitsPerMillimeter()/e}let i=NaN;c?(_=r.getPCSInfo(),i=r.getCentralMeridian()):Number.isNaN(this.m_centralMeridianOfOutputGCS)||(i=this.m_centralMeridianOfOutputGCS);let a=Av(n)|Av(r),o=10*u.getTolerance(0);this.m_bDontHackPolesInGeogToGeog&&(a=3,o=10*u.getTolerance(0)),g=Tb(p,n,e,u,i,t,a,o,this.m_bNormalizeOutputGeometry),a=0}if(y&&(U(!r.isPannable()),g=ob(g,r,t)),c){if(!f){let e=u.getPannableExtent().width();if(g.queryInterval(0,0).width()>=e-10*u.getTolerance(0)){let e=_.getNorthPoleLocation(),t=_.getSouthPoleLocation(),n=_.getNorthPoleGeometry(),r=_.getSouthPoleGeometry(),i=0;n===vC.PE_POLE_POINT&&e!==vC.PE_POLE_OUTSIDE_BOUNDARY&&(i=1),r===vC.PE_POLE_POINT&&t!==vC.PE_POLE_OUTSIDE_BOUNDARY&&(i|=2),f||=i!==0}}g=hb(g,r,this.m_outputPCSHorizonClipOption,t),h&&(g=new rf().execute(g,m,0,0,t)),Wb(r,g,this.m_bNormalizeOutputGeometry)}return g.isEmpty()||f&&(g=new mv().execute(g,r,!1,t)),g}projectPolyline(e,t){U(e.getGeometryType()===L.enumPolyline),U(!this.m_projTransform.isIdentity()),U(!e.isEmpty());let n=this.m_projTransform.getInputSR(),r=this.m_projTransform.getOutputSR(),i=n.getCoordinateSystemType(),a=r.getCoordinateSystemType(),o=new Bi({copy:e});i===3&&U(0),a===3&&U(0);let s=i===2,c=a===2;s&&n.getGCS();let l=c?r.getGCS():r,u=!c&&!this.m_bDontHackPolesInGeogToGeog,d=Lb(o,n,this.m_inputPCSHorizonClipOption,t);if(d.isEmpty())return d;let f=NaN;s&&(f=n.getCentralMeridian());let p=r.getGCSSplitLines()!==null,m=this.m_densificationStepInput,h=!Number.isNaN(m),g;if(h&&(d=new rf().execute(d,m,0,0,t)),this.m_bDontGeonormalizePolygon){if(s&&(ex(n,f,d),h)){let e=n.getUnitsPerMillimeter();m*=n.getGCS().getUnitsPerMillimeter()/e}if(ax(this.m_projTransform,d,u),h){let e=n.getGCS().getUnitsPerMillimeter();m*=r.getGCS().getUnitsPerMillimeter()/e}g=d}else{let e=new Bi({vd:d.getDescription()});if(e.addAndExplicitlyOpenAllPaths(d,!1),s&&(ex(n,f,e),h)){let e=n.getUnitsPerMillimeter();m*=n.getGCS().getUnitsPerMillimeter()/e}if(ax(this.m_projTransform,e,u),h){let e=n.getGCS().getUnitsPerMillimeter();m*=r.getGCS().getUnitsPerMillimeter()/e}let i=NaN;c?i=r.getCentralMeridian():Number.isNaN(this.m_centralMeridianOfOutputGCS)||(i=this.m_centralMeridianOfOutputGCS);let a=Av(n)|Av(r),o=10*l.getTolerance(0);this.m_bDontHackPolesInGeogToGeog&&(a=3,o=0),g=Eb(d,n,e,l,i,t,a,o,this.m_bNormalizeOutputGeometry),a=0}return p&&(U(!r.isPannable()),g=ob(g,r,t)),c&&(g=hb(g,r,this.m_outputPCSHorizonClipOption,t),h&&(g=new rf().execute(g,m,0,0,t)),Wb(r,g,this.m_bNormalizeOutputGeometry)),g.isEmpty(),g}projectGeometryCollection(e,t){return U(0),{}}projectEnvelopeHelper(e,t){let n=(e.height()+e.width())/400;if(n!==0){let r=new rf().execute(e,n,0,0,t),i=this.projectMultiPath(r,t),a=new lr({vd:e.getDescription()});if(i.isEmpty()){let n=Math.min(e.height(),e.width()),i=Ln(this.m_projTransform.getInputSR(),e,!0).total();if(n>100*i){let e=G.constructEmpty(),t=Pn(this.m_projTransform.getOutputSR(),e,!0).total(),r=this.m_projTransform.getInputSR().getOneMeter()/this.m_projTransform.getOutputSR().getOneMeter();if(n>100*Math.max(i,t*r))return a}let o=new Bi;o.addAndExplicitlyOpenAllPaths(r,!1),this.projectMultiPath(o,t).queryEnvelope(a);let s=new ii({vd:e.getDescription()});s.reserve(4);let c=new q;for(let t=0;t<4;t++)e.queryCornerByVal(t,c),s.add(c);let l=this.projectMultiPoint(s,t),u=new lr;return l.queryEnvelope(u),a.merge(u),a}return i.queryEnvelope(a),a}{let n=e.getCenterXY(),r=new q(n),i=this.projectPoint(r,t),a=new lr({vd:e.getDescription()});if(i.isEmpty())a.setEmpty();else{e.copyTo(a);let t=i.getXY();a.setCoords(t.x,t.y,t.x,t.y)}return a}}transformInPlace(e,t,n,r){return U(0),0}transformInPlaceZ(e,t,n,r,i,a){if(this.m_projTransform.isIdentity())return e!==r&&De(r,e,n),t!==i&&Qe(i,t,0,0,n),n;let o=this.m_projTransform,s=o.getInputSR(),c=o.getOutputSR(),l=s.getCoordinateSystemType(),u=c.getCoordinateSystemType();if(l===0&&l===u)return jv(s,c).transformPoints2D(e,n,r),o.isVertical()&&U(0),n;l===3&&xt(`image: transform_in_place_`),u===3&&xt(`image: transform_in_place_`),Rb(e,n,r,s,this.m_inputPCSHorizonClipOption),i!==t&&Qe(i,t,0,0,n),l===2&&tx(s,0,r,n),lx(this.m_projTransform,r,i,n,!1);let d=0,f=u===2;f?d=c.getCentralMeridian():Number.isNaN(this.m_centralMeridianOfOutputGCS)||(d=this.m_centralMeridianOfOutputGCS),f&&this.m_outputPCSHorizonClipOption!==0||xb(r,n,c.getGCS(),d),f&&(yb(r,n,c,this.m_outputPCSHorizonClipOption),Bb(c,r,n,!1));let p=n;for(let e=0;e<n;++e)r[e].isNAN()&&(i&&(i[e]=NaN),p--);return p}};function Av(e){if(e.getCoordinateSystemType()!==2)return 0;let t=0,n=e.getPCSInfo(),r=n.getNorthPoleLocation(),i=n.getSouthPoleLocation(),a=n.getNorthPoleGeometry(),o=n.getSouthPoleGeometry();return a===vC.PE_POLE_POINT&&r!==vC.PE_POLE_OUTSIDE_BOUNDARY&&(t=1),o===vC.PE_POLE_POINT&&i!==vC.PE_POLE_OUTSIDE_BOUNDARY&&(t|=2),t}function jv(e,t){let n=e.getHorzUnitFactor(),r=t.getHorzUnitFactor(),i=1,a=1,o=20015077/180;e.getUnit().getUnitType()===1&&(i=o),t.getUnit().getUnitType()===1&&(a=o);let s=n/r*(i===a?1:i/a),c=new At;return c.setScaleCoords(s,s),c}var Mv=class{getOperatorType(){return 10300}supportsCurves(){return!0}accelerateGeometry(e,t,n){return!1}canAccelerateGeometry(e){return!1}executeMany(e,t,n){return!t||t.isIdentity()?e:new Nv(e,t,n)}execute(e,t,n){return t.isIdentity()?e:bv(e,t,n)}transform(e,t,n,r,i=!0){return i?xv(e,t,n,r,null):Sv(e,t,n,r,null)}transform3D(e,t,n,r,i=!0){return U(0),0}foldInto360Range(e,t){return wv(e,t,null)}foldInto360RangeGeodetic(e,t,n){return Cv(e,t,n,null)}normalizeGeometryEx(e,t,n,r,i=0){return Sy(e,t,n,r,i)}normalizeGeometry(e,t,n){return Tv(e,t,n)}clipToSpatialReference(e,t,n,r=0){return Dv(e,t,n,r)}},Nv=class extends n{constructor(e,t,n){super(),this.m_projTrans=t,this.m_progressTracker=n,this.m_index=-1,e||R(``),this.m_inputGeoms=e}next(){let e=this.m_inputGeoms.next();return e==null?null:(ut(e),$e(e),this.m_index=this.m_inputGeoms.getGeometryID(),bv(e,this.m_projTrans,this.m_progressTracker))}getGeometryID(){return this.m_index}tock(){return!0}getRank(){return 1}};function Pv(e,t,n,r,i,a,o=!1){e||R(`Geometry.Geodetic_densify.densify`);let s=e.getGeometryType();if($e(e),e.isEmpty()||Be(s))return e;let c=new Bv;c.m_sr=t,c.m_gcs=t.getGCS(),c.m_transform=c.m_gcs===t?null:t.getSRToGCSTransform(),c.m_progressTracker=a;let l=ES(),u,d,f;if(c.m_gcs.querySpheroidData(l),c.m_a=l.majorSemiAxis,c.m_eSquared=l.e2,c.m_rpu=c.m_gcs.getUnit().getUnitToBaseFactor(),c.m_gcsTolerance=c.m_gcs.getTolerance(0),c.m_radTolerance=c.m_gcsTolerance*c.m_rpu,c.m_maxLength=r,c.m_maxDeviation=i,c.m_curveType=n,s===L.enumEnvelope){let t=new X({vd:e.getDescription()});t.addEnvelope(e,!1),u=t,s=L.enumPolygon}else if(Ne(s)){let t=new Bi({vd:e.getDescription()});t.addSegment(e,!0),u=t,s=L.enumPolyline}else u=e;if(c.m_curveType!==4){if(U(V(s)),d=c.replaceCurvesWithLinesAndProjectToGCSAsMultiPoint_(u),d.isEmpty())return d;d=Fv(c.m_rpu,d);let e=c.geodeticDensify(d);o||(e=new Mv().foldInto360RangeGeodetic(e,c.m_gcs,c.m_curveType)),f=c.m_transform&&!c.m_transform.isIdentity()?new Mv().execute(e,c.m_transform.getInverse(),a):e}else{let e;if(U(V(s)),t.isPannable())e=kb(u,t);else{let n=t.getPCSHorizon();e=new yv().execute(u,n,t,a),e===n&&(e=n.clone())}if(d=e,d.isEmpty())return d;f=c.shapePreservingDensify(d)}return f}function Fv(e,t){let n=new G;if(t.queryLooseEnvelope(n),n.width()*e<Math.PI)return t;let r=!1,i=t.querySegmentIterator(),a=new z,o=new z;for(;i.nextPath();)for(;i.hasNextSegment();){let t=i.nextSegment();if(a.setCoordsPoint2D(t.getStartXY()),o.setCoordsPoint2D(t.getEndXY()),a.scale(e),o.scale(e),Math.abs(a.x-o.x)>Math.PI){if(!Lv(a,o)){r=!0;break}if(Math.abs(a.x-o.x)>2*Math.PI){r=!0;break}}}if(!r)return t;let s=t.createInstance();s.reserve(t.getPointCount());let c=t.getDescription().getAttributeCount()>1,l=new z,u=new z,d=new z(0,0),f=new z(0,0),p=new q;for(i.resetToFirstPath();i.nextPath();){let t=NaN,n=0;for(;i.hasNextSegment();){let r=i.nextSegment();if(a.setCoordsPoint2D(r.getStartXY()),o.setCoordsPoint2D(r.getEndXY()),a.scale(e),o.scale(e),Number.isNaN(t)?(n=Qv(a.x,NaN,n),d.setCoordsPoint2D(a)):d.setCoordsPoint2D(f),t=d.x,Lv(a,o)){if(o.x-a.x>2*Math.PI)for(;o.x-a.x>2*Math.PI;)o.x-=2*Math.PI;else if(o.x-a.x<2*-Math.PI)for(;o.x-a.x<2*-Math.PI;)o.x+=2*Math.PI;n=Qv(o.x,NaN,n),f.setCoordsPoint2D(o)}else l.setCoordsPoint2D(o),iy(l),n=Qv(l.x,t,n),f.setCoords(n+l.x,l.y);if(Math.abs(f.x-o.x)<.5&&f.setCoordsPoint2D(o),c)r.queryCoord(0,p),u.setCoordsPoint2D(d),u.scale(1/e),p.setXY(u),i.isFirstSegmentInPath()?s.startPathPoint(p):s.lineToPoint(p),i.isLastSegmentInPath()&&!i.isPathClosed()&&(r.queryCoord(1,p),u.setCoordsPoint2D(f),u.scale(1/e),p.setXY(u),s.lineToPoint(p));else{i.isFirstSegmentInPath()&&s.insertPath2D(-1,null,0,0,!0);let t=s.getPathCount()-1;u.setCoordsPoint2D(d),u.scale(1/e),s.insertPoint2D(t,-1,u),i.isLastSegmentInPath()&&!i.isPathClosed()&&(u.setCoordsPoint2D(f),u.scale(1/e),s.insertPoint2D(t,-1,u))}}}return s}function Iv(e,t,n,r,i,a,o,s,c,l,u,d){let f=new z,p=new z,m=r.compare(i)>0;Xv(m,r,i,f,p);let h=Uv(e,t,n,f,p,a,o,s,c,l,null,u,d);return m&&Yv(c,l,null,u),h}function Lv(e,t){return!(!dC(e.y,nt)||!dC(t.y,nt))||!(!dC(e.y,-nt)||!dC(t.y,-nt))}function Rv(e,t){return!(!dC(e.y,nt)||dC(t.y,nt))||!(!dC(e.y,-nt)||dC(t.y,-nt))}function zv(e,t){return!(!dC(t.y,nt)||dC(e.y,nt))||!(!dC(t.y,-nt)||dC(e.y,-nt))}var Bv=class{constructor(){this.m_sr=null,this.m_gcs=null,this.m_transform=null,this.m_progressTracker=null,this.m_a=0,this.m_eSquared=0,this.m_rpu=0,this.m_gcsTolerance=0,this.m_radTolerance=0,this.m_maxLength=0,this.m_maxDeviation=0,this.m_curveType=0}geodeticDensify(e){let t=e.createInstance(),n=e.querySegmentIterator(),r=[],i=[],a=new Q,o=e.getDescription().getAttributeCount()>1;for(;n.nextPath();){let e=[0];for(;n.hasNextSegment();){let s=n.nextSegment(),c=s.getStartXY(),l=s.getEndXY();c.scale(this.m_rpu),l.scale(this.m_rpu);let u=new z,d=new z,f=c.compare(l)>0;Xv(f,c,l,u,d),r.length=0,i.length=0,this.m_maxLength>0?Uv(this.m_a,this.m_eSquared,this.m_curveType,u,d,this.m_maxLength,this.m_maxDeviation,this.m_radTolerance,null,null,o?i:null,r,e):Wv(),f&&Yv(null,null,o?i:null,r),r[0].setCoordsPoint2D(s.getStartXY()),r.at(-1).setCoordsPoint2D(s.getEndXY());let p=1/this.m_rpu;for(let e=1,t=r.length-1;e<t;e++)r[e].scale(p);if(o){let e=Zv(f,s,a);Hv(n.isFirstSegmentInPath(),n.isLastSegmentInPath()&&!n.isPathClosed(),s,e,i,r,t)}else Vv(n.isFirstSegmentInPath(),n.isLastSegmentInPath()&&!n.isPathClosed(),r,t)}}return t}shapePreservingDensify(e){let t=e.createInstance(),n=e.querySegmentIterator(),r=[],i=[],a=new Q,o=e.getDescription().getAttributeCount()>1;for(;n.nextPath();)for(;n.hasNextSegment();){let e=n.nextSegment(),s=e.getStartXY(),c=e.getEndXY(),l=s.compare(c)>0,u=Zv(l,e,a);r.length=0,i.length=0,Jv(this.m_a,this.m_eSquared,this.m_rpu,u,this.m_sr,this.m_maxLength,this.m_maxDeviation,o?i:null,r),l&&Yv(null,null,o?i:null,r),o?Hv(n.isFirstSegmentInPath(),n.isLastSegmentInPath()&&!n.isPathClosed(),e,u,i,r,t):Vv(n.isFirstSegmentInPath(),n.isLastSegmentInPath()&&!n.isPathClosed(),r,t)}return t}replaceCurvesWithLinesAndProjectToGCSAsMultiPoint_(e){let t=e.hasNonLinearSegments();if((!this.m_transform||this.m_transform.isIdentity())&&(e=kb(e,this.m_gcs),!t))return e;let n=e.createInstance();n.reserveParts(e.getPointCount(),e.getPathCount());for(let t=0,r=e.getPathCount();t<r;++t){let r=new ii,i=e.getPathStart(t),a=e.getPathEnd(t);r.addPoints(e,i,a);let o=e.isClosedPath(t),s=!1;if(o&&a-i===1&&e.hasNonLinearSegmentsPath(t)){let t=new q;e.getPointByVal(i,t),r.add(t),s=!0}if(this.m_transform&&!this.m_transform.isIdentity()){if(o&&!s){let t=new q;e.getPointByVal(i,t),r.add(t)}if(r=new Mv().execute(r,this.m_transform,this.m_progressTracker),o&&r.getPointCount()>1){let e=r.getXY(0),t=r.getXY(r.getPointCount()-1);e.equals(t)&&r.removePoint(r.getPointCount()-1)}}r.getPointCount()>1&&(n.addPathMultiPoint(r,0,-1,!0),o&&n.closePathWithLine())}return n}};function Vv(e,t,n,r){e&&r.insertPath2D(-1,null,0,0,!0);let i=r.getPathCount()-1;r.insertPointsFromPoints(i,-1,n,0,n.length-1,!0),t&&r.insertPoint2D(i,-1,n.at(-1))}function Hv(e,t,n,r,i,a,o){o.reserve(o.getPointCount()+a.length-1);let s=new q;if(n.queryStart(s),e?o.startPathPoint(s):o.lineToPoint(s),a.length>2){let e=r.calculateLength2D();for(let t=1;t<a.length-1;t++){let n=r.lengthToT(i[t]*e);r.queryCoord(n,s),s.setXY(a[t]),o.lineToPoint(s)}}t&&(n.queryEnd(s),o.lineToPoint(s))}function Uv(n,r,i,a,o,s,c,l,d,f,p,m,h){let g={stack:[],error:void 0,hasError:!1};try{let e=t(g,new mC,!1),_=t(g,new mC,!1),v=t(g,new mC,!1);xC.geodeticDistance(n,r,a.x,a.y,o.x,o.y,v,e,_,i);let y=v.val,b=e.val,x=_.val,S=b,C=x;S<0&&(S+=2*Math.PI),C<0&&(C+=2*Math.PI),d&&(d[0]=S),f&&(f[0]=C);let w=NaN,T=NaN;if(p!==null){let e=SC.q90(n,r),t=SC.q(n,r,a.y);w=(e-t)/y,T=(e+t)/y}let E=Rv(a,o),D=zv(a,o),O=E||D,k=ny(a,o,l),A=t(g,new u(new mC,new mC),!1),j=new z,M=new z,N=new z;h[0]=Qv(a.x,NaN,h[0]);let P=h[0];if(y<=s)return m.push(a.clone()),h[0]=Qv(o.x,NaN,h[0]),p?.push(0),O?(E&&$v(a,o,p,m),D&&ey(a,o,p,m)):k?ty(a,o,b,w,T,p,m):c>0&&(M.setCoords(a.x-P,a.y),j.setCoords(o.x-h[0],o.y),P=Gv()),m.push(o.clone()),y;let ee=1+Math.ceil(y/s),te=y/(ee-1),F=new z;m.push(a.clone()),F.setCoordsPoint2D(a),M.setCoords(a.x-h[0],a.y),p!==null&&p.push(0);for(let e=1;e<ee;e++){let t;if(e<ee-1){let o=e*te;xC.geodeticCoordinate(n,r,a.x,a.y,o,b,A.at(0),A.at(1),i),j.setCoords(A.at(0).val,A.at(1).val),h[0]=Qv(j.x,F.x,h[0]),N.setCoords(h[0]+j.x,j.y),t=e/(ee-1)}else h[0]=Qv(o.x,NaN,h[0]),j.setCoords(o.x-h[0],o.y),N.setCoordsPoint2D(o),t=1;O?(e===1&&E&&$v(a,N,p,m),e===ee-1&&D&&ey(F,o,p,m)):k?ry(F,N,l)&&(a.x<o.x?F.x>N.x&&(h[0]+=2*Math.PI,N.setCoords(h[0]+j.x,j.y)):F.x<N.x&&(h[0]-=2*Math.PI,N.setCoords(h[0]+j.x,j.y)),ty(F,N,b,w,T,p,m)):c>0&&Gv(),m.push(N.clone()),p?.push(t),F.setCoordsPoint2D(N),M.setCoordsPoint2D(j),P=h[0]}return y}catch(e){g.error=e,g.hasError=!0}finally{e(g)}}function Wv(e,t,n,r,i,a,o,s,c,l){U(0)}function Gv(e,t,n,r,i,a,o,s,c,l,u,d,f,p,m){return U(0),0}function Kv(e,t,n,r){let i=yf(e,t,n),a=yf(e,t,r);return K.distance(i,a)}function qv(e,t,n,r,i,a,o,s){let l=[],u=C(Array,8),d=2,f=i.getCoord2D(a);u[0][0]=f.x,u[0][1]=f.y,f=i.getCoord2D(o),u[1][0]=f.x,u[1][1]=f.y;let p=e=>{if(n!==null){let t=gC.projToGeog(n,e,u);U(t===e)}for(let e of u)e[0]*=r,e[1]*=r};p(2),l.push(yf(e,t,new z(u[0][0],u[0][1]))),l.push(yf(e,t,new z(u[1][0],u[1][1])));let m=K.distance(l[0],l[1]);if(m>s)return m;let h=0;for(d=3;d<=17;){let n=1/(d-1),r=0;for(let e=1;e<d;++e)if(1&e){let t=c(a,o,e*n);i.queryCoord2D(t,f),u[r][0]=f.x,u[r][1]=f.y,r++}p(r);let g=1;for(let n=0;n<r;++n)l.splice(g,0,yf(e,t,new z(u[n][0],u[n][1]))),g++;g=0;let _=l[g];g++;let v=0;for(;g!==l.length;++g){let e=l[g];v+=K.distance(_,e),_=e}if(v>s)return v;if(h=v-m,U(h>=0||Math.abs(h)<1e-14*v),h<0&&(h=0),m=v,v+h<=s)return v+h;d=2*d-1}return m+h}function Jv(e,t,n,r,i,a,o,s,l){let u=r.isCurve(),d=Ff(e,t)*Math.PI*179/180,f=a;a>0&&!(a>d)||(f=d);let p=o,m=p>0,h=NaN;m&&(h=Vf(e,t,p));let g=i.getCoordinateSystemType()===1,_=null;g||(_=i.getPECoordSys());let v=i.getTolerance(0),y=r.getStartXY(),b=r.getEndXY(),x=new z,S=new z;if(g)x.setCoordsPoint2D(y),x.scale(n),S.setCoordsPoint2D(b),S.scale(n);else{let e=[y.x,y.y,b.x,b.y];gC.projToGeog(_,2,e),x.setCoords(e[0],e[1]),x.scale(n),S.setCoords(e[2],e[3]),S.scale(n)}let C=0,w=0,T=[],E=[],D=[];T.push(b.clone()),E.push(S.clone()),D.push(1),l.push(y.clone()),s!==null&&s.push(w);let O=i.isPannable(),k=y.clone(),A=[.5,.33333333333333337,.6666666666666666,.16666666666666669,.8333333333333333],j=5;u||(m?(A[0]=.5,A[1]=.25,A[2]=.75,j=3):j=1),U(f>0);let M=e=>{if(e=e.clone(),_!==null){let t=[e.x,e.y];gC.projToGeog(_,1,t),e.setCoords(t[0],t[1])}return e.scale(n),e};for(;E.length>0;){let a=T.at(-1).clone();S.assign(E.at(-1));let o=D.at(-1),d=!1,p=NaN,y=qv(e,t,_,n,r,w,o,f),b=f>=y&&Math.abs(x.y-S.y)<.9*Math.PI;g&&b&&(b=Math.abs(x.x-S.x)<.9*Math.PI);let N=new z,P=new z,ee=!1;if(!m&&b&&b&&(ee=!0),r.calculateSubLength(w,o)<=v&&(ee=!0),!ee)for(let s=0;s<j;s++){let l=c(w,o,A[s]),f=new z;r.queryCoord2D(l,f);let _=M(f);if(s===0&&(p=l,N.setCoordsPoint2D(f),P.setCoordsPoint2D(_),!b)){d=!0;break}if(U(m),g&&Math.abs(x.x-_.x)>=Math.PI){d=!0;break}let v=new z,y=new z;u?(v=z.lerp(k,a,A[s]),y=M(v)):(v=f.clone(),y=_.clone());let C=Ef(e,t,x,S,A[s]),T=C.clone();if(g?(T.x/=n,T.y/=n):(T.x/=n,T.y/=n,Sv(i.getGCSToSRTransform(),[T],1,[T],null)),T.isNAN()){let n=yf(e,t,_),r=yf(e,t,x),i=yf(e,t,S),{second:a}=kf(e,t,n,r,i,2,null);if(a>h){d=!0;break}}else{if(O){let e=i.getPannableExtent().width(),t=c(r.getStartX(),r.getEndX(),.5);for(;T.x<t-.5*e;)T.x+=e;for(;T.x>=t+.5*e;)T.x-=e}let n=r.getClosestCoordinateOnInterval(T,new I(w,o),-1),a=r.getCoord2D(n);a=M(a);let s=Kv(e,t,a,C);if(s>h){if(s<4*h){let n=yf(e,t,a),r=yf(e,t,x),i=yf(e,t,S),{second:o}=kf(e,t,n,r,i,2,null);s=o}if(s>h){d=!0;break}}else if(u){let n=yf(e,t,_),r=yf(e,t,x),i=yf(e,t,S),{second:a}=kf(e,t,n,r,i,3,null);if(a<=h){n=yf(e,t,y);let{second:o}=kf(e,t,n,r,i,3,null);a=o}if(a>h){d=!0;break}}}}d?(T.push(N.clone()),E.push(P.clone()),D.push(p)):(T.pop(),E.pop(),D.pop(),l.push(a.clone()),C+=y,s!==null&&s.push(C),k.setCoordsPoint2D(a),x.setCoordsPoint2D(S),w=o)}if(s!==null){let e=1/C;for(let t=0;t<s.length;t++)s[t]*=e}}function Yv(e,t,n,r){if(r.reverse(),n!==null&&n.reverse(),e){let n=e[0];e[0]=t[0],t[0]=n}}function Xv(e,t,n,r,i){e?(r.setCoordsPoint2D(n),i.setCoordsPoint2D(t)):(r.setCoordsPoint2D(t),i.setCoordsPoint2D(n))}function Zv(e,t,n){return e?(n.create(t.getGeometryType()),t.copyTo(n.get()),n.get().reverse(),n.get()):t}function Qv(e,t,n){if(Number.isNaN(t)){for(;n-e>Math.PI;)n-=2*Math.PI;for(;e-n>Math.PI;)n+=2*Math.PI;return n}return n+e-t>Math.PI?n-=2*Math.PI:t-(n+e)>Math.PI&&(n+=2*Math.PI),n}function $v(e,t,n,r){if(e.y>0){let i=new z;i.setCoords(t.x,nt),dC(e.x,i.x)||dC(t.y,i.y)||(r.push(i),n!==null&&n.push(0))}else{let i=new z;i.setCoords(t.x,-nt),dC(e.x,i.x)||dC(t.y,i.y)||(r.push(i),n!==null&&n.push(0))}}function ey(e,t,n,r){if(t.y>0){let i=new z;i.setCoords(e.x,nt),dC(t.x,i.x)||dC(e.y,i.y)||(r.push(i),n!==null&&n.push(1))}else{let i=new z;i.setCoords(e.x,-nt),dC(t.x,i.x)||dC(e.y,i.y)||(r.push(i),n!==null&&n.push(1))}}function ty(e,t,n,r,i,a,o){if(pC(n)){if(nt-e.y>0){let t=new z;t.setCoords(e.x,nt),o.push(t),a!==null&&a.push(r)}if(nt-t.y>0){let e=new z;e.setCoords(t.x,nt),o.push(e),a!==null&&a.push(r)}}else{if(nt+e.y>0){let t=new z;t.setCoords(e.x,-nt),o.push(t),a!==null&&a.push(i)}if(nt+t.y>0){let e=new z;e.setCoords(t.x,-nt),o.push(e),a!==null&&a.push(i)}}}function ny(e,t,n){return!(!ry(e,t,n)||dC(e.y,nt)||dC(e.y,-nt)||dC(t.y,nt)||dC(t.y,-nt))}function ry(e,t,n){return Math.abs(Math.abs(e.x-t.x)-Math.PI)<=n}function iy(e){if(e.x<-Math.PI)for(;e.x<-Math.PI;)e.x+=2*Math.PI;else if(e.x>Math.PI)for(;e.x>Math.PI;)e.x-=2*Math.PI}function ay(n,r,i,a){let o={stack:[],error:void 0,hasError:!1};try{let e=[i.x],s=[i.y-a],c=[i.x],l=[i.y+a];Pf(e,s),Pf(c,l);let u=t(o,new mC,!1),d=t(o,new mC,!1);return xC.greatEllipticDistance(n,r,i.x,i.y,e[0],s[0],u,null,null),xC.greatEllipticDistance(n,r,i.x,i.y,c[0],l[0],d,null,null),Math.min(u.val,d.val)}catch(e){o.error=e,o.hasError=!0}finally{e(o)}}function oy(e,t,n,r,i){let a=new G;n.queryEnvelope(a);let o=Ln(null,n,!0).total();if(t.xmin-a.xmin<=o&&a.xmax-t.xmax<=o)return n;let s=t.width(),c=0;for(;t.xmin+c*s<a.xmin;)c++;for(;t.xmin+c*s>a.xmin;)c--;let l=c*s,u=new At;u.setShiftCoords(-l,0);let d=n;d.applyTransformation(u);let f=new G;d.queryEnvelope(f);let p=null;if(f.xmax>t.xmax){let n=0,r=new G;r.setCoords({env2D:t}),--r.ymin,r.ymax+=1;let a=d;for(;r.xmin<f.xmax;){f.xmax>r.xmax&&(a=Db(a,e,2,!0,r.xmax));let o=kn(a,r),c=Pn(null,o,!0).total(),l=qd(a,r,c,NaN,i);p===null?p=l===a?l.clone():l:(u.setShiftCoords(-n*s,0),l.applyTransformation(u),p.add(l,!1)),n++,r.xmin=r.xmax,r.xmax=t.xmax+n*s}}else p=d;return p}var sy=class{constructor(e,t){this.m_basisX=new K,this.m_basisY=new K,this.m_normal=new K,U(e.getCoordinateSystemType()===1),this.m_gcs=e;let n=ES();e.querySpheroidData(n),this.m_a=n.majorSemiAxis,this.m_e2=n.e2,this.m_rpu=e.getUnit().getUnitToBaseFactor(),this.m_curvCenterRad=t.mul(this.m_rpu);let r=this.m_curvCenterRad.x,i=this.m_curvCenterRad.y,a=Math.cos(r),o=Math.sin(r),s=Math.cos(i),c=Math.sin(i);this.m_cartCenter3D=xf(this.m_a,this.m_e2,a,o,s,c),this.m_normal.setCoordsPoint3D(this.m_cartCenter3D),this.m_d=this.m_cartCenter3D.length(),this.m_normal.divThis(this.m_d),K.selectRightHandedBasisFromNormal(this.m_normal,this.m_basisX,this.m_basisY),this.m_northPolePcs=this.projectPoint(z.construct(0,.5*Math.PI/this.m_rpu)),this.m_southPolePcs=this.projectPoint(z.construct(0,.5*-Math.PI/this.m_rpu))}project(e){let t=e.getGeometryType();if(d(t)){ut(e);let t=e;return this.projectMultiVertex(t)}R(`Gnomonic.project`)}unproject(e,t,n){let r=e.getGeometryType();if(d(r)){ut(e);let i=e,a=[];if(r===L.enumPolygon){let e=i.getPathCount();for(let t=0;t<e;t++){let e=i.calculateRingArea2D(t);a.push(e)}}return this.unprojectMultiVertex(t,i),V(r)?(gy(this.m_gcs,0,i),cy(a,this.m_gcs,0,i,n)):i=bb(i,this.m_gcs,0,!0,0,n),i}R(`Gnomonic.unproject`)}projectPoint(e){let t=e.mul(this.m_rpu),n=yf(this.m_a,this.m_e2,t),r=this.m_normal.dotProduct(n);if(r<=0)return z.construct(NaN,NaN);let i=this.m_d/r,a=n.mul(i).sub(this.m_cartCenter3D),o=new z;return o.x=this.m_basisX.dotProduct(a),o.y=this.m_basisY.dotProduct(a),o}unprojectPoint(e){let t=this.m_cartCenter3D.add(this.m_basisX.mul(e.x).add(this.m_basisY.mul(e.y)));return wf(this.m_a,this.m_e2,t).divide(this.m_rpu)}projectMultiVertex(e){let t=e.getImpl(),n=!0,r=new z,i=new z;for(let e=0,a=t.getPointCount();e<a;e++)t.queryXY(e,r),r.y*this.m_rpu>.5*Math.PI?i.assign(this.m_northPolePcs):r.y*this.m_rpu<.5*-Math.PI?i.assign(this.m_southPolePcs):i.assign(this.projectPoint(r)),t.setXYNoCurves(e,i),i.isNAN()&&(n=!1);return t.notifyModifiedFlags(2001),n}unprojectMultiVertex(e,t){let n=t.getImpl(),r=e*e,i=!this.m_northPolePcs.isNAN(),a=!this.m_southPolePcs.isNAN();for(let e=0,t=n.getPointCount();e<t;e++){let t=n.getXY(e),o=new z;i&&z.sqrDistance(t,this.m_northPolePcs)<=r?(o.setCoords(this.m_curvCenterRad.x,.5*Math.PI),o.scale(1/this.m_rpu)):a&&z.sqrDistance(t,this.m_southPolePcs)<=r?(o.setCoords(this.m_curvCenterRad.x,.5*-Math.PI),o.scale(1/this.m_rpu)):o=this.unprojectPoint(t),n.setXYNoCurves(e,o)}n.notifyModifiedFlags(2001)}};function cy(e,t,n,r,i){let a=r.getGeometryType(),o=t.getPannableExtent(),s=r,c=!1,l=!1;if(a===L.enumPolygon){let r=new G,a=z.construct(n,0);r.setCoords({env2D:o}),r.centerAt(a),c=ly(e,t,r,s,i);let u=hy(t,r,s,i);u!==s&&(l=!0),s=u}else s=new Mv().foldInto360RangeGeodetic(s,t,2);a===L.enumPolygon&&(c||l)&&(s=new mv().execute(s,t,!1,i)),s!==r&&(r.setEmpty(),r.add(s,!1))}function ly(e,t,n,r,i){let a=uy(n,r),o=dy(e,t,n,r,i);return a||o}function uy(e,t){let n=new G;t.queryEnvelope(n);let r=dC(e.ymax,n.ymax),i=dC(e.ymin,n.ymin),a=r||i;return!!a&&(fy(e,t),a)}function dy(e,t,n,r,i){let a=[],o=[],s=.5*n.width();for(let c=0;c<r.getPathCount();c++){let l=r.getXY(r.getPathStart(c)),u=r.getXY(r.getPathEnd(c)-1),d=e[c]<0;if(Math.abs(l.x-u.x)>s){let e=py(d,t,n,c,r,i);a.push(e),o.push(c)}else if(!d&&r.calculateRingArea2D(c)<0){let e=my(t,n,c,r,i);a.push(e),o.push(c)}}if(a.length===0)return!1;let c=new X({vd:r.getDescription()}),l=0,u=o[l];for(let e=0;e<r.getPathCount();e++)e===u?(c.add(a[l],!1),l++,l<o.length&&(u=o[l])):c.addPath(r,e,!0);return r.setEmpty(),r.add(c,!1),!0}function fy(e,t){let n=new X,r=new G;for(let i=0;i<t.getPathCount();i++){t.queryPathEnvelope(i,r);let a=dC(e.ymax,r.ymax),o=dC(e.ymin,r.ymin);if(!(a||o)){n.addPath(t,i,!0);continue}n.insertPath2D(-1,null,0,0,!0);let s=t.getPathStart(i),c=t.getPathEnd(i),l=c-s,u=-1;for(u=s;u<c;u++){let n=t.getXY(u);if(a=dC(e.ymax,n.y),o=dC(e.ymin,n.y),!a&&!o)break}let d=u,f=!1,p=NaN;do{let r=t.getXY(d);a=dC(e.ymax,r.y),o=dC(e.ymin,r.y);let c=s+(d+1-s)%l;if(a||o){let a=z.construct(p,r.y);n.insertPoint2D(i,-1,a);let o=t.getXY(c),s=dC(e.ymax,o.y),l=dC(e.ymin,o.y);s||l||(a=z.construct(o.x,r.y),f?n.setXYNoCurves(n.getPointCount()-1,a):n.insertPoint2D(i,-1,a)),f=!0}else n.insertPoint2D(i,-1,r),p=r.x,f=!1;d=c}while(d!==u)}t.setEmpty(),t.add(n,!1)}function py(e,t,n,r,i,a){let o=new X,s=new X,c=new At,l=i.getXY(i.getPathStart(r)),u=i.getXY(i.getPathEnd(r)-1),d=n.width(),f=.5*d,p=new G;i.queryEnvelope(p);let m=Math.ceil(p.width()/d)+1,h,g;l.x>u.x?(h=-d,g=e?n.ymin:n.ymax):(h=d,g=e?n.ymax:n.ymin),c.setShiftCoords(h,0),o.addPath(i,r,!0),s.add(o,!1);let _=new q;for(let e=0;e<m;e++)s.applyTransformation(c),s.getPointByVal(0,_),o.lineToPoint(_),o.addSegmentsFromPath(s,0,0,s.getSegmentCount()-1,!1);let v=o.getXY(0),y=o.getXY(o.getPointCount()-1);v.y=g,y.y=g,o.lineTo(y);let b=new z;for(b.setCoordsPoint2D(y),b.x-=.5*h;Math.abs(b.x-v.x)>f;)o.lineTo(b),b.x-=.5*h;o.lineTo(v);let x=n.getCenter().x,S=new G;o.queryEnvelope(S);let C=0,w=S.getCenter().x;w-x>f?C=-Math.ceil((w-x-f)/d):x-w>f&&(C=Math.ceil((x-w-f)/d)),C!==0&&(c.setShiftCoords(C*d,0),o.applyTransformation(c));let T=new os,E=T.addGeometry(o);Ob(T,E,t,0,2,!0,n.xmin),Ob(T,E,t,0,2,!0,n.xmax);let D=T.getGeometry(E),O=kn(D,n);O.inflateCoords(0,1);let k=Pn(null,O,!0);return qd(D,n,k.total(),NaN,a)}function my(e,t,n,r,i){let a=t.width(),o=.5*a,s=t.getCenter().x,c=new G;r.queryPathEnvelope(n,c);let l,u=0,d=c.getCenter().x;if(d-s>o?u=-Math.ceil((d-s-o)/a):s-d>o&&(u=Math.ceil((s-d-o)/a)),u!==0){let e=new At;e.setShiftCoords(u*a,0),r.getImpl().applyTransformationToPath(e,n),r.queryPathEnvelope(n,c),d=c.getCenter().x}let f=new G;t.containsExclusiveEnvelope(c)?(l=!1,f.setCoords({env2D:t})):(l=!0,f.setCoords({env2D:t}),f.xmin-=a,f.xmax+=a);let p=r.createInstance();p.addPathPoint2D(null,0,!0);let m=new z;if(m.setCoords(f.xmin,f.ymin),p.insertPoint2D(0,-1,m),m.setCoords(f.xmin,f.ymax),p.insertPoint2D(0,-1,m),m.setCoords(.5*(f.xmin+f.xmax),f.ymax),p.insertPoint2D(0,-1,m),m.setCoords(f.xmax,f.ymax),p.insertPoint2D(0,-1,m),m.setCoords(f.xmax,f.ymin),p.insertPoint2D(0,-1,m),m.setCoords(.5*(f.xmin+f.xmax),f.ymin),p.insertPoint2D(0,-1,m),l){p.addPath(r,n,!0);let o=new At;d<s?o.setShiftCoords(a,0):o.setShiftCoords(-a,0),r.getImpl().applyTransformationToPath(o,n),p.addPath(r,n,!0);let c=new os,l=c.addGeometry(p);Ob(c,l,e,0,2,!0,t.xmin),Ob(c,l,e,0,2,!0,t.xmax),p=c.getGeometry(l);let u=kn(p,t);u.inflateCoords(0,1);let f=Pn(null,u,!0).total();p=qd(p,t,f,NaN,i)}else p.addPath(r,n,!0);return p}function hy(e,t,n,r){let i=new G;n.queryEnvelope(i);let a=Ln(null,n,!0).total();if(t.xmin-i.xmin<=a&&i.xmax-t.xmax<=a)return n;let o=n.createInstance(),s=n.createInstance(),c=new G,l=n.getPathCount();for(let i=0;i<l;i++)n.queryPathEnvelope(i,c),t.xmin-c.xmin<=a&&c.xmax-t.xmax<=a?o.addPath(n,i,!0):(s.setEmpty(),s.addPath(n,i,!0),s=oy(e,t,s,!0,r),o.add(s,!0));return o}function gy(e,t,n){let r=e.getPannableExtent(),i=z.construct(t,0);r.centerAt(i);let a=r.width(),o=.5*a,s=new z;s.setNAN();let c=NaN;for(let e=0;e<n.getPathCount();e++)for(let t=n.getPathStart(e);t<n.getPathEnd(e);t++){let i=n.getXY(t),l=dC(i.y,r.ymax)||dC(r.ymin,i.y);t===n.getPathStart(e)?(s.setNAN(),c=0):s.isNAN()||l||(c=_y(i.x,s.x,o,a,c)),i.x+=c,n.setXYNoCurves(t,i),l||s.setCoordsPoint2D(i)}n.getImpl().notifyModifiedFlags(2001)}function _y(e,t,n,r,i){return i+e-t>n?i-=r:t-(i+e)>n&&(i+=r),i}function vy(e,t,n,r,i,a){let o=t.getAttributeStreamRef(0),s=t.getPointCount(),l=!1,u=new z;for(let e=0;e<s;++e){if(o.queryPoint2D(2*e,u),1&a&&u.y>=n){l=!0;break}if(2&a&&u.y<=-n){l=!0;break}}if(!l)return!1;let d=!1;e&&(d=t.getImpl().isClosedPathInXYPlane(0));let f=new os,p=f.addGeometry(t),m=f.getFirstPath(p),h=-1,g=!0,_=new z,v=new q,y=-1,b=Cy*i/360;for(let e=f.getFirstVertex(m);e!==-1;e=f.getNextVertex(e)){f.queryXY(e,u);let t=1&a&&u.y>=n?1:0;if(t|=2&a&&u.y<=-n?2:0,h>0&&h!==t){if(_.x!==u.x){let t=f.getPrevVertex(e);f.queryPoint(t,v);let n=f.insertVertex(m,e,v);_.x=u.x,f.setXY(n,_)}if(d){let t=y===-1?f.getFirstVertex(m):f.getNextVertex(y),n=f.getPrevVertex(e);for(;t!==n;)t=f.removeVertex(t,!1);if(y!==-1){let e=f.getXY(y),t=f.getXY(n);if(Math.abs(e.x-t.x)>b){f.queryPoint(y,v);let r=f.insertVertex(m,n,v);e.x=c(e.x,t.x,.5),f.setXY(r,e)}}}y=-1}if(t&&(u.y=ft(r,u.y),f.setXY(e,u),!g&&h!==t))if(u.x!==_.x){f.queryPoint(e,v);let t=f.insertVertex(m,e,v);f.setXYCoords(t,_.x,u.y),y=t}else y=e;h=t,_.assign(u),g=!1}if(d){if(y!==-1){let e=f.getNextVertex(y);for(;e!==-1;)e=f.removeVertex(e,!1)}let e=f.getFirstVertex(m),t=f.getLastVertex(m),n=f.getXY(e),r=f.getXY(t);if(!n.equals(r)&&(f.queryPoint(e,v),t=f.insertVertex(m,-1,v),Math.abs(n.x-r.x)>b)){let e=f.insertVertex(m,t,v);n.x=c(n.x,r.x,.5),f.setXY(e,n)}}return t.assignCopy(f.getGeometry(p)),!0}function yy(e,t){let n=new X({vd:e});n.addEnvelope(t,!1);let r=t.width()/180;return n=new rf().execute(n,r,0,0,null),n}function by(e,t){let n=e.getPannableExtent();return Number.isNaN(t)||n.centerAtCoords(t,0),n}function xy(e,t,n){let r=ES();t.querySpheroidData(r);let i=t.getGCS()===t?null:t.getSRToGCSTransform(),a=C(z,100),o=new K(0,0,0),s=e.getPointCount(),c=t.getGCS().getUnit().getUnitToBaseFactor();for(let t=0,n=s;t<n;){let s=Math.min(100,n-t);e.queryCoordinates(a,s,t,t+s),i&&new Mv().transform(i,a,s,a,!1);for(let e=0;e<s;e++){if(a[e].isNAN())continue;a[e].scale(c);let t=yf(r.majorSemiAxis,r.e2,a[e]);o.addThis(t)}t+=s}let l=wf(r.majorSemiAxis,r.e2,o);l.scale(1/c);let u=e;if(!new sy(t.getGCS(),l).project(u))return 0;n.length=e.getPathCount();let d=u.calculateArea2D()<0;for(let t=0,r=e.getPathCount();t<r;t++){let e=u.calculateRingArea2D(t);n[t]=d?e<0:e>0}return d?-1:1}function Sy(e,t,n,r,i){if(!t.isPannable()||e.isEmpty())return e;let a=e.getGeometryType();a===L.enumGeometryCollection&&xt(`not yet impl for geometry collection`);let o=t.getPannableExtent();Number.isNaN(n)&&(n=o.getCenterX());let s=o.width(),c=.5*s,l=i>0,u=e.queryInterval(0,0);if(!l&&u.width()<c||!d(e.getGeometryType())){let t=u.getCenter();if(Math.abs(t-n)<=c)return e;{let r=new At,i=y((n-t)/s)*s;r.setShiftCoords(i,0);let a=e.clone();return a.applyTransformation(r),a}}if(a===L.enumPolygon){let a=new Bi({vd:e.getDescription()});a.addAndExplicitlyOpenAllPaths(e,!1),l&&(a=Pv(a,t,2,i,NaN,null,!0));let o=[];if(!r){{let n=e;l&&(n=new X,n.add(a,!1));let r=xy(e,t,o);if(r)r<0&&a.reverseAllPaths();else{let e=n.getPathCount();for(let t=0;t<e;t++)o.push(n.calculateRingArea2D(t)>0)}}r=o}return new wy(null,r,a,null,t,n,3,0,null).geoNormalizePolygonGeometry(!0)}if(a===L.enumPolyline){let r=new Bi({vd:e.getDescription()});return r.addAndExplicitlyOpenAllPaths(e,!1),l&&(r=Pv(r,t,2,i,NaN,null,!0)),new wy(null,null,r,null,t,n,3,0,null).geoNormalizePolylineGeometry(!0)}if(a===L.enumMultiPoint){let t=e,r=t.getAttributeStreamRef(0),i,a=null,o=n,l=0,u=.1*s;for(let n=0,d=t.getPointCount();n<d;n++){let t=r.read(2*n),d=t-o;if(Math.abs(d)>c&&(d=y(d/s)*s,l-=d,Math.abs(l)<u&&(l=0)),l!==0){a||=(i=e.clone(),i.getAttributeStreamRef(0));let r=t+l;a.write(2*n,r)}o=t}return a?(i.notifyModified(),i):e}B(``)}var Cy=210,wy=class{constructor(e,t,n,r,i,a,o,s,c){this.m_bAdjustedAtPoles=0,this.m_inputPoly=n,this.m_progressTracker=c,this.m_originalGeometry=e,this.m_originalSR=r,this.m_polygonRingFlags=t,this.m_pannableSR=i,this.m_poleSnappingTolerance=s,this.m_poleFlags=o,this.m_bAdjustedAtPoles=0,this.m_pannableExtent=by(this.m_pannableSR,a),this.m_centralLongitude=Number.isNaN(a)?this.m_pannableExtent.getCenterX():a,this.m_width360=this.m_pannableExtent.width(),this.m_degree=this.m_width360/360,this.m_GCSLargeDelta=Cy*this.m_degree,U(this.m_originalGeometry===null&&this.m_originalSR===null||this.m_originalGeometry!==null&&this.m_originalSR!==null)}geonormalizeRing(e,t,n,r,i,a,o){let s=n,c=new Bi({vd:this.m_inputPoly.getDescription()});c.addPath(this.m_inputPoly,e,!0),this.m_poleFlags!==0&&(this.m_bAdjustedAtPoles|=vy(!0,c,this.m_pannableExtent.ymax-this.m_poleSnappingTolerance,this.m_pannableExtent.ymax,this.m_pannableExtent.width(),this.m_poleFlags)?1:0,this.m_bAdjustedAtPoles&&(s=!1));let l=-1;s&&(l=this.m_originalGeometry.getPathStart(e));let u=c.getAttributeStreamRef(0),d=c.getPointCount(),f=0,p=u.read(0),m=0,h=3*this.m_pannableSR.getTolerance(0),g=!1,_=new z,v=new z,y=!1,b=c.hasNonLinearSegments(),x=new z;for(let e=1;e<d;++e){u.queryPoint2D(2*e,x);let t=x.x,n=t+f,i=n-p;if(x.x=n,Math.abs(i)>this.m_GCSLargeDelta){if(s){let t=l+e-1,n=l+(e+1<d?e:0),o=a.read(2*t),c=(a.read(2*n)-o)*r;Math.abs(i-c)>1*this.m_degree&&(s=!1)}s||(f-=ft(this.m_width360,n-p),n=t+f,++m,y=f!==0,x.x=n)}else g||Dn(_,v,x,h)&&(g=!0);y&&(b&&B(`error in geonormalize_ring_ for curves`),u.write(2*e,n)),p=n,_.setCoordsPoint2D(v),v.setCoordsPoint2D(x)}m&&c.notifyModified();let S=c.getXY(0),C=c.getXY(d-1);if(z.distance(S,C)<h){let e=this.finalizeGeoNormalizeClosedRing(c,g,i);o.add(e,!1)}else{t<0&&(this.m_originalGeometry===null?t=1:(U(this.m_originalGeometry!==null),t=this.m_originalGeometry.calculateRingArea2D(e)>0?1:0));let n=this.finalizeGeoNormalizeOpenedRing(t>0,c);o.add(n,!1)}}geoNormalizePolygonGeometry(e){U(this.m_originalSR&&this.m_originalGeometry||!this.m_originalGeometry&&!this.m_originalSR),U(this.m_pannableSR.isPannable());let t=null,n=NaN,r=!!this.m_originalSR&&this.m_originalSR.isPannable();r&&(t=this.m_originalGeometry.getAttributeStreamRef(0),n=this.m_width360/this.m_originalSR.getPannableExtent().width()),this.m_bAdjustedAtPoles=0;let i=new X({vd:this.m_inputPoly.getDescription()});for(let a=0,o=this.m_inputPoly.getPathCount();a<o;++a){let o=this.m_polygonRingFlags?this.m_polygonRingFlags[a]?1:0:-1;this.geonormalizeRing(a,o,r,n,e,t,i)}let a=this.m_pannableSR.getTolerance(0),o=this.m_pannableExtent.width()/180;Pb(i,this.m_pannableExtent,.1*a,!1);let s=G.constructEmpty();if(s.setCoords({env2D:this.m_pannableExtent}),e){let e=!0;for(let t=0;t<2;t++){e=!0;let t=G.constructEmpty();for(let n=0,r=i.getPathCount();n<r;n++)if(i.queryPathEnvelope(n,t),!(s.xmin<=t.xmin&&s.xmax>=t.xmax||t.xmin>=s.xmax||t.xmax<=s.xmin)){e=!1;break}if(e)break;s.move(.5*this.m_width360,0)}e||s.setCoords({env2D:this.m_pannableExtent})}let c=qd(i,s,a,o,this.m_progressTracker),l=i!==c,u=this.m_originalGeometry?this.m_originalGeometry.calculateArea2D():1,d=c.calculateArea2D(),f=0;if(d>0&&u<0)f=1;else if(d<=0&&u>0)if(d===0){if(this.m_originalSR){let e=NaN;this.m_originalSR.getCoordinateSystemType()===2?e=this.m_originalSR.getPCSHorizon().calculateArea2D():this.m_originalSR.getCoordinateSystemType()===1&&(e=this.m_originalSR.getPannableExtent().getArea()),u>.99*e&&(f=-1)}}else f=-1;if(f!==0){let e=yy(c.getDescription(),s);e.add(c,!1),l=!0,c=e}return l&&(c=new mv().execute(c,this.m_pannableSR,!1,this.m_progressTracker)),c}geoNormalizePolylineGeometry(e){U(this.m_pannableSR.isPannable());let t=null,n=this.m_originalSR&&this.m_originalSR.isPannable(),r=1;n&&(U(this.m_originalGeometry),r=this.m_width360/this.m_originalSR.getPannableExtent().width(),t=this.m_originalGeometry.getAttributeStreamRef(0));let i=this.m_pannableExtent.width(),a=i*fe()*4,o=e,s=NaN,c=I.constructEmpty();this.m_bAdjustedAtPoles=0;let l=new Bi({vd:this.m_inputPoly.getDescription()});for(let e=0,u=this.m_inputPoly.getPathCount();e<u;++e){let u=n,d=new Bi({vd:this.m_inputPoly.getDescription()});d.addPath(this.m_inputPoly,e,!0);let f=this.m_inputPoly.isClosedPath(e);this.m_poleFlags!==0&&(this.m_bAdjustedAtPoles|=vy(f,d,this.m_pannableExtent.ymax-this.m_poleSnappingTolerance,this.m_pannableExtent.ymax,i,this.m_poleFlags)?1:0,this.m_bAdjustedAtPoles&&(u=!1));let p=-1,m=d.getPointCount(),h=!1;u&&(p=this.m_originalGeometry.getPathStart(e),h=this.m_originalGeometry.isClosedPath(e));let g=d.getAttributeStreamRef(0),_=0,v=g.read(0),y=0,b=new z,x=new z,S=!1,C=d.hasNonLinearSegments(),w=new z;for(let e=1;e<m;++e){g.queryPoint2D(2*e,w);let n=w.x,i=n+_,a=i-v;if(w.x=i,Math.abs(a)>this.m_GCSLargeDelta){if(u){let n=p+e-1,i=p;(!h||e+1<m)&&(i+=e);let o=t.read(2*n),s=(t.read(2*i)-o)*r;Math.abs(a-s)>1*this.m_degree&&(u=!1)}u||(_-=ft(this.m_width360,i-v),i=n+_,++y,S=_!==0,w.x=i)}S&&(C&&B(`error in geonormalize_ring_ for curves`),g.write(2*e,i)),v=i,b.setCoordsPoint2D(x),x.setCoordsPoint2D(w)}if(y&&d.notifyModified(),o){let e=!1;if(!d.isEmpty()){let t=G.constructEmpty();if(d.queryEnvelope(t),t.width()>=i||t.ymin<=this.m_pannableExtent.ymin||t.ymax>=this.m_pannableExtent.ymax)e=!0;else{if(Number.isNaN(s)){let e=this.m_centralLongitude-.5*i;s=t.xmin,s+=Math.round((e-t.xmin)/i)*i,s>e&&(s-=i),U(s<=e),s<e&&(s+=i),U(s>=e)}let n=Math.round((s-t.xmin)/i)*i;if(t.xmin+n>s+a&&(n-=i),t.xmin+n<s-a&&(n+=i),c.mergeCoordinate(t.xmin+n),c.mergeCoordinate(t.xmax+n),e=c.width()>=i,!e){let e=new At;e.setShiftCoords(n,0),d.applyTransformation(e)}}}l.add(d,!1),e&&(l=(()=>{let e=new Bi({vd:l.getDescription()});for(let t=0,n=l.getPathCount();t<n;++t){let n=new Bi({vd:l.getDescription()});n.addPath(l,t,!0);let r=bb(n,this.m_pannableSR,this.m_centralLongitude,!0,0,this.m_progressTracker);e.add(r,!1)}return e})(),o=!1)}else{let e=bb(d,this.m_pannableSR,this.m_centralLongitude,!0,0,this.m_progressTracker);l.add(e,!1)}}if(o)return l;let u=this.m_pannableSR.getTolerance(0),d=this.m_pannableExtent.width()/180;return Pb(l,this.m_pannableExtent,.1*u,!1),qd(l,this.m_pannableExtent,u,d,this.m_progressTracker)}finalizeGeoNormalizeOpenedRing(e,t){let n=t.getPointCount(),r=t.getXY(0),i=t.getXY(n-1);{let e=Math.abs(i.x-r.x),t=Math.round(e/this.m_width360)*this.m_width360;U(Math.abs(e-t)<this.m_pannableSR.getTolerance(0))}let a=Ye(i.x-r.x),o=G.constructEmpty();t.queryLooseEnvelope(o);let s=this.m_pannableExtent.getCenterX(),c=0,l=s-this.m_width360,u=s+this.m_width360;if(a>=0){let e=Math.ceil((l-o.xmin)/this.m_width360);for(e*=this.m_width360;l>o.xmin+e;)e+=this.m_width360;for(;l<o.xmax+e;)e-=this.m_width360;for(c=e,o.width()>720&&(u=l+360*Math.ceil(o.width()/360));u<o.xmax;)u+=this.m_width360}else{let e=Math.ceil((u-o.xmax)/this.m_width360);for(e*=this.m_width360;u<o.xmax+e;)e-=this.m_width360;for(;u>o.xmin+e;)e+=this.m_width360;for(c=e,o.width()>720&&(l=u-360*Math.ceil(o.width()/360));l>o.xmin;)l-=this.m_width360}let d=Math.round(Math.abs(i.x-r.x)/this.m_width360)*this.m_width360,f=a*d,p=o.clone();p.move(c,0);let m=new z(0,0),h=new At;h.setShiftCoords(c,0),t.applyTransformation(h);let g=new Bi({vd:t.getDescription()});g.add(t,!1),m.assign(t.getXY(n-1));let _=0,v=g.getXY(0).x;for(;a>0?p.xmax<u:p.xmin>l;)p.move(f,0),h.xd=f,t.applyTransformation(h),v+=f,this.m_pannableExtent.xmin<=v&&this.m_pannableExtent.xmax>=v&&(_=g.getPointCount()-1),t.setXY(0,m),m.assign(t.getXY(n-1)),g.addSegmentsFromPath(t,0,0,n-1,!1);let y=new X({vd:g.getDescription()});y.add(g,!1);let b=g.getXY(0),x=g.getXY(g.getPointCount()-1),S=a<0?e:!e,C=y.getPointCount()-1;if(S){let e=new z(x.x,this.m_pannableExtent.ymax);y.lineTo(e);let t=new z(this.m_pannableExtent.getCenterX(),this.m_pannableExtent.ymax);y.lineTo(t);let n=new z(b.x,this.m_pannableExtent.ymax);y.lineTo(n)}else{let e=new z(x.x,this.m_pannableExtent.ymin);y.lineTo(e);let t=new z(this.m_pannableExtent.getCenterX(),this.m_pannableExtent.ymin);y.lineTo(t);let n=new z(b.x,this.m_pannableExtent.ymin);y.lineTo(n)}if(y.interpolateAttributesPath(0,C,0),y.getImpl().changeRingStartPoint(_),d>this.m_width360){let e=new X({copy:y});h.setShiftCoords(this.m_width360,0),e.applyTransformation(h),y.add(e,!1)}return y}finalizeGeoNormalizeClosedRing(e,t,n){let r=new X({vd:e.getDescription()});if(r.add(e,!1),r.hasNonLinearSegments()&&(()=>{let e=r.getPointCount()-2;return r.getSegmentType(e)!==L.enumLine})()){let e=new Q,t=r.getPointCount()-2;r.getSegmentBuffer(t,e,!1),r.removePointFromPath(0,t+1),r.closeLastPathWithSegment(e.get())}else r.removePointFromPath(0,r.getPointCount()-1);let i=G.constructEmpty();r.queryLooseEnvelope(i);let a=Math.ceil((this.m_pannableExtent.xmin-i.xmin)/this.m_width360);for(a*=this.m_width360;this.m_pannableExtent.xmin>i.xmin+a;)a+=this.m_width360;for(;this.m_pannableExtent.xmin<i.xmax+a;)a-=this.m_width360;if(a+=this.m_width360,a!==0){i.move(a,0);let e=new At;e.setShiftCoords(a,0),r.applyTransformation(e)}if(this.m_pannableExtent.xmin<=i.xmin&&this.m_pannableExtent.xmax>=i.xmax){if(t){let e=r.calculateArea2D(),t=new mv().execute(r,this.m_pannableSR,!0,this.m_progressTracker);if(t!==r){let n=t.calculateArea2D();Ye(e)!==Ye(n)&&t.reverseAllPaths(),r.assignMove(t)}}let e;if(e=new X(n?{copy:r}:{move:r}),n)for(;i.xmin<this.m_pannableExtent.xmax;){i.move(this.m_width360,0);let t=new At;t.setShiftCoords(this.m_width360,0),r.applyTransformation(t),e.add(r,!1)}return e}let o=new X({vd:e.getDescription()});o.add(r,!1);let s=t||i.width()>this.m_width360-10*this.m_pannableSR.getTolerance(0);for(;i.xmin<this.m_pannableExtent.xmax;){i.move(this.m_width360,0);let e=new At;e.setShiftCoords(this.m_width360,0),r.applyTransformation(e),o.add(r,!1)}if(s){let e=o.calculateArea2D();o.setFillRule(1),o=new mv().execute(o,this.m_pannableSR,!0,this.m_progressTracker);let t=o.calculateArea2D();Ye(e)!==Ye(t)&&o.reverseAllPaths()}return o}geonormalize_ring_(e,t,n,r,i,a,o){U(0)}};function Ty(e){U(0);let t=Qx(e),n=new Oy;return n.setVertProj_(t),n}function Ey(e,t=!0){return U(0),{}}function Dy(e){return mS()}var Oy=class{constructor(){this.m_hashCode=0,this.m_peVertSysVal=null,this.m_verticalUnit=new _S,this.m_verticalShift=0,this.m_userVerticalWKID=0,this.m_bIsDepth=!1}getType(){return U(0),0}getID(){return U(0),0}getLatestID(){return this.m_peVertSysVal?this.m_peVertSysVal.getLatestID():0}getOldID(){return this.m_peVertSysVal?this.m_peVertSysVal.getOldID():0}getText(){return U(0),``}getTextExtended(e){return U(0),``}getText2(e){return U(0),``}getUnit(){return U(0),{}}equals(e){return U(0),!1}equalForProjection(e){return U(0),!1}getPeVertcsCopy(){return U(0),{}}getOneMeter(){return 1/this.m_verticalUnit.getUnitToBaseFactor()}getUnitToBaseFactor(){return U(0),0}isDepth(){return U(0),!1}getVerticalShift(){return U(0),0}isCustomWkid(){return!!this.m_peVertSysVal&&this.m_peVertSysVal.isCustomWkid()}getHashCode(){return this.m_hashCode}setVertProj_(e){this.m_peVertSysVal=e}getPEVerticalCoordSys(){return this.m_peVertSysVal?this.m_peVertSysVal.m_peVertcs:null}};function ky(e,t,n,r,i){if(e.equals(t))return!1;if(r){let n=1,a=0,o=1,s=1,c=0,l=1;Number.isNaN(e.m_heightMetersPerUnit)||(n=e.m_heightMetersPerUnit,a=e.m_heightZ0,o=e.m_heightSign,s=t.m_heightMetersPerUnit,c=t.m_heightZ0,l=t.m_heightSign);let u=o*l*n/s;for(let e=0;e<i;e++)r[e]=(r[e]-a)*u+c}let a=1,o=0;if(Number.isNaN(e.m_XYToRadians)||(a=e.m_XYToRadians/t.m_XYToRadians,o=e.m_PrimeMeridianDegrees-t.m_PrimeMeridianDegrees,o!==0&&(o=hu(o),o/=t.m_XYToRadians)),Array.isArray(n)){let e=n;for(let t=0;t<i;t++)e[t][0]=e[t][0]*a+o,e[t][1]=e[t][1]*a}else{let e=n;for(let t=0;t<i;t++){let n=t<<1;e[n]=e[n]*a+o,e[n+1]=e[n+1]*a}}return!0}function Ay(){return{m_heightMetersPerUnit:0,m_heightSign:0,m_heightZ0:0,m_XYToRadians:0,m_PrimeMeridianDegrees:0,assign(e){this.m_heightMetersPerUnit=e.m_heightMetersPerUnit,this.m_heightSign=e.m_heightSign,this.m_heightZ0=e.m_heightZ0,this.m_XYToRadians=e.m_XYToRadians,this.m_PrimeMeridianDegrees=e.m_PrimeMeridianDegrees},equals(e){return te(this.m_heightSign,e.m_heightSign)&&te(this.m_heightMetersPerUnit,e.m_heightMetersPerUnit)&&te(this.m_heightZ0,e.m_heightZ0)&&te(this.m_XYToRadians,e.m_XYToRadians)&&te(this.m_PrimeMeridianDegrees,e.m_PrimeMeridianDegrees)},initFromGcsAndVcsPe(e,t){this.m_heightSign=1,this.m_heightMetersPerUnit=NaN,this.m_heightZ0=0,this.m_XYToRadians=NaN,this.m_PrimeMeridianDegrees=NaN,t&&U(0),e&&(this.m_XYToRadians=e.getUnit().getUnitFactor(),this.m_PrimeMeridianDegrees=e.getPrimem().getLongitude())},initFromGcsAndVcs(e,t){let n=e?e.getPECoordSys():null,r=t?t.getPEVerticalCoordSys():null;this.initFromGcsAndVcsPe(n,r)},processUnitParams(e){Number.isNaN(this.m_heightMetersPerUnit)&&(this.m_heightMetersPerUnit=e.m_heightMetersPerUnit,this.m_heightSign=e.m_heightSign,this.m_heightZ0=e.m_heightZ0),Number.isNaN(this.m_XYToRadians)&&(this.m_XYToRadians=e.m_XYToRadians,this.m_PrimeMeridianDegrees=e.m_PrimeMeridianDegrees)}}}var jy=class{constructor(e){this.m_constantsLoaded=-1,this.m_isUsable=-1,this.m_inputSR=null,this.m_outputSR=null,this.m_inputSRHorz=null,this.m_outputSRHorz=null,this.m_inputVCS=null,this.m_outputVCS=null,this.m_hashCode=0,this.m_areaOfUse=new lr,this.m_inputUnitParams=Ay(),this.m_outputUnitParams=Ay(),U(e),this.m_geogTran=e,this.m_vertTran=null,this.m_latestID=hC.getCode(this.m_geogTran),this.m_latestID<0&&(this.m_latestID=0);let t=this.m_geogTran.getGeogcs1();hC.getCode(t);let n=this.m_geogTran.getGeogcs2();hC.getCode(n),this.initUnitParams()}getLatestId(){return this.m_latestID}getText(){return this.m_geogTran?this.m_geogTran.toString():(U(0),``)}getGeogtran(){return this.m_geogTran}getVerttran(){return null}loadConstants(e){let t=this.m_constantsLoaded;if(t===-1){if(!e){this.m_geogTran||B(`vcs not impl`);let t=this.m_geogTran.getParameters();t[$.PE_PARM_ND]!==null&&(e=t[$.PE_PARM_ND].getValue()===0)}t=this.m_geogTran.loadConstants()?1:0,this.m_constantsLoaded=t}return t!==0}isUsable(){let e=this.m_isUsable;return e===-1&&(this.m_geogTran?this.m_isUsable=e=this.m_geogTran?1:0:this.m_isUsable=e=this.m_vertTran?1:0),e===1}getInputSr(e){return this.updateSrs(),e?this.m_inputSR:this.m_inputSRHorz}getOutputSr(e){return this.updateSrs(),e?this.m_outputSR:this.m_outputSRHorz}getHashCode(){let e=this.m_hashCode;return e===0&&(e=this.m_latestID>0?je(this.m_latestID):at(this.getText()),e===0&&(e=345),this.m_hashCode=e),e}isGeogtran(){return this.m_geogTran!==null}prepareOrThrow(){}getName(){return this.isGeogtran()?this.getGeogtran().getName():(xt(`vcs not impl`),``)}updateSrs(){if(this.m_inputSR||this.m_inputVCS)return;let e,t,n,r,i,a;if(this.m_geogTran){let o=this.m_geogTran.getGeogcs1(),s=Xx(o),c=this.m_geogTran.getGeogcs2(),l=Xx(c),u=-1,d=-1;u=s.getVcsCode(),d=l.getVcsCode(),n=FS(o,null,null,1),r=FS(c,null,null,1),u>0&&d>0?(i=Ty(u),a=Ty(d),e=RS(),t=RS()):(e=n,t=r)}else U(0);this.m_inputSR||this.m_inputVCS||(this.m_inputSR=e,this.m_outputSR=t,this.m_inputSRHorz=n,this.m_outputSRHorz=r,this.m_inputVCS=i,this.m_outputVCS=a)}initUnitParams(){if(this.m_inputUnitParams.m_heightSign=1,this.m_inputUnitParams.m_heightMetersPerUnit=NaN,this.m_inputUnitParams.m_heightZ0=0,this.m_outputUnitParams.m_heightSign=1,this.m_outputUnitParams.m_heightMetersPerUnit=NaN,this.m_outputUnitParams.m_heightZ0=0,this.m_inputUnitParams.m_XYToRadians=NaN,this.m_inputUnitParams.m_PrimeMeridianDegrees=NaN,this.m_outputUnitParams.m_XYToRadians=NaN,this.m_outputUnitParams.m_PrimeMeridianDegrees=NaN,this.m_vertTran)U(0);else if(this.m_geogTran){let e=this.m_geogTran,t=e.getGeogcs1();this.m_inputUnitParams.m_XYToRadians=t.getUnit().getUnitFactor(),this.m_inputUnitParams.m_PrimeMeridianDegrees=t.getPrimem().getLongitude(),t=e.getGeogcs2(),this.m_outputUnitParams.m_XYToRadians=t.getUnit().getUnitFactor(),this.m_outputUnitParams.m_PrimeMeridianDegrees=t.getPrimem().getLongitude()}}};function My(e,t,n,r,i,a,o){let s=null;t&&(s=t.getPEVerticalCoordSys());let c=null;e&&(c=e.getPECoordSys());let l=null;r&&(l=r.getPEVerticalCoordSys());let u=null;if(n&&(u=n.getPECoordSys()),!(c||s||u||l))return!1;let d=Ay();d.initFromGcsAndVcsPe(c,s);let f=Ay();return f.initFromGcsAndVcsPe(u,l),ky(d,f,i,a,o)}function Ny(e,t,n,r,i,a,o,s){let c=t,l=e,u=Ay();u.initFromGcsAndVcsPe(l,c),s.assign(r?n.m_outputUnitParams:n.m_inputUnitParams),s.processUnitParams(u),u.processUnitParams(s),o>0&&ky(u,s,i,a,o)}function Py(e,t,n,r,i,a,o,s){let c=Ay();c.assign(n?t.m_inputUnitParams:t.m_outputUnitParams),c.processUnitParams(e);let l=null;r&&(l=r.getPECoordSys());let u=Ay();u.initFromGcsAndVcsPe(l,null),u.processUnitParams(c),c.processUnitParams(u),s>0&&ky(c,u,a,o,s)}function Fy(e,t,n,r,i,a,o,s,c){let l=Ay(),u=Ay();l.assign(n?t.m_inputUnitParams:t.m_outputUnitParams),u.assign(i?r.m_outputUnitParams:r.m_inputUnitParams),l.processUnitParams(e),u.processUnitParams(l),l.processUnitParams(u),s>0&&ky(l,u,a,o,s),c.assign(u)}function Iy(e,t,n,r,i,a,o){let s=t.getVerttran(),c=t.getGeogtran();if(o.assign(n?t.m_inputUnitParams:t.m_outputUnitParams),o.processUnitParams(e),a>0){t.prepareOrThrow();let e=n?$.PE_TRANSFORM_2_TO_1:$.PE_TRANSFORM_1_TO_2;s?sx():cx(c,a,r,i,e)}}function Ly(e,t,n,r,i){let a=e.getVerttran(),o=e.getGeogtran();if(i>0){e.prepareOrThrow();let s=t?$.PE_TRANSFORM_2_TO_1:$.PE_TRANSFORM_1_TO_2;a?sx():cx(o,i,n,r,s)}}var Ry=class{supportsCurves(){return!0}accelerateGeometry(e,t,n){return zy(e,t,n)}canAccelerateGeometry(e){return By(e)}};function zy(e,t,n){if(!By(e))return!1;zn(t,e,!1);let r=0,i=e.getGeometryType();return V(i)&&ki(e)&&n!==0&&(r|=e.getImpl().buildQuadTreeAccelerator(n)?1:0),V(i)&&Ai(e)&&n!==0&&(r|=e.getImpl().buildQuadTreeForPathsAccelerator(n)?1:0),r>0}function By(e){return ki(e)||Ai(e)}var Vy=class extends Ry{getOperatorType(){return 8}execute(e,t,n,r){return Nm(e,t,n,1,r)}};function Hy(e,t,n,r){if(e.isEmpty()||t.isEmpty())return e;let i=e.getDimension(),a=t.getDimension();if(i>a)return e;let o=e.getGeometryType(),s=t.getGeometryType(),c=new G,l=new G,u=new G;e.queryEnvelope(c),t.queryEnvelope(l),u.setCoords({env2D:c}),u.mergeEnvelope2D(l);let d=Pn(n,u,!0),f=Vn(d),p=new G;if(p.setCoords({env2D:c}),p.inflateCoords(f,f),!p.isIntersecting(l))return e;if(i===1&&a===2){let i=$y(e,t,s,n,r);if(i)return i}if(o===L.enumPoint){let n;switch(Ne(s)?(n=new Bi({vd:t.getDescription()}),n.addSegment(t,!0)):n=t,s){case L.enumPolygon:return Gy(e,n,d);case L.enumPolyline:return Ky(e,n,d);case L.enumMultiPoint:return qy(e,n,d);case L.enumEnvelope:return Jy(e,n,d);case L.enumPoint:return Yy(e,n,d);default:R(`invalid shape type`)}}else if(o===L.enumMultiPoint)switch(s){case L.enumPolygon:return Xy(e,t,d);case L.enumEnvelope:return Zy(e,t,d);case L.enumPoint:return Qy(e,t,d)}let m=new G(c);return m.inflate(100*d.total()),I_(e,qd(t,m,0,0,r),n,r)}var Uy=class{getOperatorType(){return 10002}supportsCurves(){return!0}accelerateGeometry(e,t,n){return!1}canAccelerateGeometry(e){return!1}executeMany(e,t,n,r){return new Wy(e,t,n,r)}execute(e,t,n,i){return this.executeMany(new r([e]),new r([t]),n,i).next()}},Wy=class extends n{constructor(e,t,n,r){super(),this.m_progressTracker=r,this.m_index=-1,this.m_inputGeoms=e,this.m_spatialReference=n,this.m_geomSubtractor=t.next()||new X}next(){let e=this.m_inputGeoms.next();return e?($e(e),ht(e),this.m_index=this.m_inputGeoms.getGeometryID(),Hy(e,this.m_geomSubtractor,this.m_spatialReference,this.m_progressTracker)):null}getGeometryID(){return this.m_index}tock(){return!0}getRank(){return 1}};function Gy(e,t,n,r){return Vg(t,e,n.total())===0?e:e.createInstance()}function Ky(e,t,n,r){let i=e.getXY(),a=t.querySegmentIterator(),o=Vn(n),s=o*o;for(;a.nextPath();)for(;a.hasNextSegment();){let t=a.nextSegment(),r=new G;if(t.queryEnvelope(r),r.inflateCoords(o,o),!r.contains(i))continue;if(t.isIntersectingPoint(i,n.total()))return e.createInstance();let c=t.getStartXY();if(z.sqrDistance(i,c)<=s||(c=t.getEndXY(),z.sqrDistance(i,c)<=s))return e.createInstance()}return e}function qy(e,t,n,r){let i=t.getImpl().getAttributeStreamRef(0),a=t.getPointCount(),o=e.getXY(),s=Vn(n),c=s*s,l=new z;for(let t=0;t<a;t++)if(i.queryPoint2D(2*t,l),z.sqrDistance(l,o)<=c)return e.createInstance();return e}function Jy(e,t,n,r){let i=new G;t.queryEnvelope(i),i.inflate(n.total());let a=e.getXY();return i.contains(a)?e.createInstance():e}function Yy(e,t,n,r){let i=Vn(n),a=i*i,o=e.getXY(),s=t.getXY();return z.sqrDistance(o,s)<=a?e.createInstance():e}function Xy(e,t,n,r){let i=new G;t.queryEnvelope(i),i.inflate(n.total());let a=e.getPointCount(),o=!1,s=H(a,!1),c=new z;for(let r=0;r<a;r++)e.queryXY(r,c),i.contains(c)&&Hg(t,c,n.total())!==0&&(o=!0,s[r]=!0);if(!o)return e;let l=e.createInstance();for(let t=0;t<a;t++)s[t]||l.addPoints(e,t,t+1);return l}function Zy(e,t,n,r){let i=new G;t.queryEnvelope(i),i.inflate(n.total());let a=e.getPointCount(),o=!1,s=H(a,!1),c=new z;for(let t=0;t<a;t++)e.queryXY(t,c),i.contains(c)&&(o=!0,s[t]=!0);if(!o)return e;let l=e.createInstance();for(let t=0;t<a;t++)s[t]||l.addPoints(e,t,t+1);return l}function Qy(e,t,n,r){let i=e.getImpl().getAttributeStreamRef(0),a=e.getPointCount(),o=t.getXY(),s=!1,c=H(a,!1),l=Vn(n),u=l*l,d=new z;for(let e=0;e<a;e++)i.queryPoint2D(2*e,d),z.sqrDistance(d,o)<=u&&(s=!0,c[e]=!0);if(!s)return e;let f=e.createInstance();for(let t=0;t<a;t++)c[t]||f.addPoints(e,t,t+1);return f}function $y(e,t,n,r,i){let a=new lr;e.queryEnvelope(a);let o=new G;t.queryEnvelope(o),a.merge(o);let s=.1*a.width(),c=.1*a.height();a.inflateCoords(s,c);let l=new X;l.addEnvelope(a,!1);let u=l.getImpl();if(n===L.enumPolygon){let e=t.getImpl();u.add(e,!0)}else u.addEnvelope(t,!0);return new _v(l,r,-1,i).tryFastImplementation(e)}var eb=class{getOperatorType(){return 10001}supportsCurves(){return!0}accelerateGeometry(e,t,n){return!1}canAccelerateGeometry(e){return!1}executeMany(e,t,n,r=0){return new ib(e,t,n,r)}execute(e,t,n,i){let a=new r([e,t]),o=new ib(a,n,i,0).next();return o||B(`null output`),o}};function tb(){return{geom:null,vertexCount:-1,bUnioned:!1,location:new z}}function nb(e,t){return z.compareZorder(e.location,t.location)?-1:e.location.equals(t.location)?0:1}var rb=class{constructor(){this.binVertexCount=0,this.geometries=[]}addPair(e){this.binVertexCount+=e.vertexCount,this.geometries.push(e)}sort(){this.geometries.sort((e,t)=>nb(e,t))}geomCount(){return this.geometries.length}geomPairs(){return this.geometries}clear(){this.binVertexCount=0,this.geometries.length=0}getBinVertexCount(){return this.binVertexCount}},ib=class e extends n{constructor(e,t,n,r,a=!1){super(),this.m_index=-1,this.m_currentDim=-1,this.m_bDone=!1,this.m_unionBins=[],this.m_readyGeoms=i(4),this.m_dimGeomCounts=H(4,0),this.m_addedGeoms=0,this.m_maxDimension=-1,this.m_bHadGeometry=H(4,!1),this.m_complexUnionGeoms=i(4),this.m_totalNonEmptyGeomCounters=H(4,0),this.m_progressTracker=n,this.m_bUnionAllDimensions=!!(4&r),this.m_bPreserveAllPathEnds=!!(8&r),this.m_inputGeoms=e,this.m_spatialReference=t,this.m_options=r,this.m_bIs3D=a}next(){if(this.m_bDone&&this.m_currentDim===this.m_maxDimension)return null;for(;!this.step_(););if(this.m_maxDimension===-1)return null;if(this.m_bUnionAllDimensions){if(this.m_currentDim===-1){for(let e=0;e<=this.m_maxDimension;e++)if(this.m_bHadGeometry[e]){this.m_complexUnionGeoms[e]=this.getResultGeometry(e);for(let t=e+1;t<=this.m_maxDimension;t++)this.m_complexUnionGeoms[t]=this.getResultGeometry(t),this.m_bHadGeometry[t]&&!this.m_complexUnionGeoms[t].isEmpty()&&(this.m_bIs3D?U(0):this.m_complexUnionGeoms[e]=new Uy().execute(this.m_complexUnionGeoms[e],this.m_complexUnionGeoms[t],this.m_spatialReference,this.m_progressTracker))}}for(;this.m_currentDim++,(this.m_currentDim>this.m_maxDimension||this.m_currentDim<0)&&B(``),!this.m_bHadGeometry[this.m_currentDim];);if(this.m_index++,this.m_currentDim===0&&this.m_complexUnionGeoms[this.m_currentDim].getGeometryType()===L.enumPoint){let e=new ii({vd:this.m_complexUnionGeoms[this.m_currentDim].getDescription()});return this.m_complexUnionGeoms[this.m_currentDim].isEmpty()||e.add(this.m_complexUnionGeoms[this.m_currentDim]),e}return this.m_complexUnionGeoms[this.m_currentDim]}return this.m_index=0,this.m_currentDim=this.m_maxDimension,this.getResultGeometry(this.m_maxDimension)}getGeometryID(){return this.m_index}getRank(){return 1}tock(){return this.step_()}getResultGeometry(e){return this.m_readyGeoms[e]}finishDim(e,t,n){let r=t;if(!n)return 16&this.m_options&&(r=H_([r],1,this.m_spatialReference,this.m_progressTracker,this.m_options,this.m_bIs3D)),r;if(1&this.m_options)return r;if(e===1)if(!(8&this.m_options)&&(16&this.m_options||this.m_totalNonEmptyGeomCounters[e]>1)){r=H_([r],1,this.m_spatialReference,this.m_progressTracker,16|this.m_options,this.m_bIs3D);let e=r.getImpl().getIsSimple(0,[0]);U(this.m_bIs3D||qn(e))}else this.m_totalNonEmptyGeomCounters[e]===1&&(this.m_bIs3D?U(0):r=new mv().execute(r,this.m_spatialReference,!1,this.m_progressTracker));else this.m_bIs3D?U(0):r=new mv().execute(r,this.m_spatialReference,!1,this.m_progressTracker);if(e===0&&r.getGeometryType()===L.enumPoint){let e=new ii({vd:r.getDescription()});r.isEmpty()||e.add(r),r=e}return r}static getLevel(e){let t=wt(e),n=t>0?(Math.log(t)-Math.log(32))/Math.log(4):0;return n<0&&(n=0),Math.floor(n)}step_(){if(this.m_bDone)return!0;let e;if(this.m_inputGeoms?(e=this.m_inputGeoms.next(),e===null?(this.m_bDone=!0,this.m_inputGeoms=null):(this.checkAndThrow(e),e.isEmpty()||this.m_totalNonEmptyGeomCounters[e.getDimension()]++)):e=null,e!==null){let t=e.getDimension();this.m_bHadGeometry[t]=!0,(t>=this.m_maxDimension||this.m_bUnionAllDimensions)&&(this.addGeom(t,!1,e),t>this.m_maxDimension&&!this.m_bUnionAllDimensions&&this.removeAllBinsWithLowerDimension(t))}if(this.m_addedGeoms>0)for(let e=0;e<=this.m_maxDimension;e++){for(;this.m_dimGeomCounts[e]>1;){let t=this.collectGeometriesToUnion(e);if(t===null)break;{let n;n=1&this.m_options?H_(t,t.length,this.m_spatialReference,this.m_progressTracker,this.m_options,this.m_bIs3D):U_(t,t.length,this.m_spatialReference,this.m_progressTracker,8|this.m_options,this.m_bIs3D),this.addGeom(e,!0,n)}}if(this.m_bDone&&(U(this.m_dimGeomCounts[e]<=1),this.m_dimGeomCounts[e]!==0)){let t=this.m_unionBins[e].entries().next().value,n=t[1].geomPairs()[0].geom,r=t[1].geomPairs()[0].bUnioned;this.m_unionBins[e].clear(),this.m_readyGeoms[e]=this.finishDim(e,n,r)}}return this.m_bDone}addGeom(t,n,r){let i=tb();i.geom=r;let a=wt(r);i.vertexCount=a;let o=G.constructEmpty();r.queryEnvelope(o),i.location=a>0?o.getCenter():new z(0,0);let s=e.getLevel(r);if(t+1>this.m_unionBins.length)for(;this.m_unionBins.length<Math.max(2,t+1);)this.m_unionBins.push(new Map);let c=null,l=this.m_unionBins[t].get(s);l&&(c=l),c===null&&(c=new rb,this.m_unionBins[t].set(s,c)),i.bUnioned=n,c.addPair(i),this.m_dimGeomCounts[t]++,this.m_addedGeoms++,this.m_maxDimension=Math.max(this.m_maxDimension,t)}removeAllBinsWithLowerDimension(e){for(let t=0;t<e;t++)this.m_unionBins[t].clear(),this.m_addedGeoms-=this.m_dimGeomCounts[t],this.m_dimGeomCounts[t]=0}collectGeometriesToUnion(e){if(1&this.m_options&&!this.m_bDone)return null;let t=null,n=[];for(let t of this.m_unionBins[e].keys())n.push(t);v(n);for(let r=0;r<n.length;r++){if(n[r]===-1)continue;let i=this.m_unionBins[e].get(n[r]);{let a=i.getBinVertexCount()>5e3&&i.geomCount()>=4;if(this.m_bDone||a){for(let i=0;i<r;i++){if(n[i]===-1)continue;let r=this.m_unionBins[e].get(n[i]);r.sort(),this.m_dimGeomCounts[e]-=r.geomCount(),this.m_addedGeoms-=r.geomCount();for(let e of r.geomPairs())t||=[],t.push(e.geom);r.clear(),this.m_unionBins[e].delete(n[i]),n[i]=-1}i.sort(),this.m_dimGeomCounts[e]-=i.geomCount(),this.m_addedGeoms-=i.geomCount();for(let e of i.geomPairs())t||=[],t.push(e.geom);if(i.clear(),this.m_unionBins[e].delete(n[r]),n[r]=-1,!this.m_bDone)break}}}return t}checkAndThrow(e){this.m_bIs3D&&(e.getDimension()>1&&ve(),e.hasAttribute(1)||R(`Geometry must have Zs`)),$e(e)}},ab=class extends Ry{getOperatorType(){return 3}execute(e,t,n,r=null){return Nm(e,t,n,4,r)}};function ob(e,t,n){let r=t.getGCSSplitLines();if(r===null)return e;let i=t.getGCS(),a=i.getPannableExtent().width(),o=G.constructEmpty();e.queryLooseEnvelope(o);let s=I.constructEmpty();o.queryIntervalX(s);let c=r.querySegmentIterator(),l=null,u=new At;for(;c.nextPath();)for(;c.hasNextSegment();){let e=c.nextSegment(),t=e.queryInterval(0,0),n=I.constructEmpty();n.setCoordsFromEnvelope(t);let r=0;for(;n.vmax>s.vmin;)n.move(-a),r--;for(;n.vmin<=s.vmax;){if(n.isIntersecting(s)){l===null&&(l=new Bi);let t=new Z({start:e.getStartXY(),end:e.getEndXY()});r!==0&&(u.setShiftCoords(r*a,0),t.applyTransformation(u)),l.addSegment(t,!0)}n.move(a),++r}}if(l!==null){let t=Ln(i,l,!0);return Lp(e,l,Vn(t),n)}return e}function sb(e,t,n){let r=e.getName();return XS(r)||(n||t>0?(r=e.toString($.PE_STR_NAME_CANON|$.PE_STR_AUTH_NONE),r=fb(r)):r=e.toString($.PE_STR_AUTH_TOP)),r}function cb(e,t,n,r){return U(0),``}function lb(e,t=-1){if((t>1||t<-1)&&R(`verbosity`),t===-1)return e.toString();{let n=t===0?$.PE_STR_AUTH_TOP:$.PE_STR_AUTH_ALL;return e.toString(n)}}function ub(e,t){(t>1||t<-1)&&R(`verbosity`);let n=$.PE_STR_FMT_WKT2;return t!==-1&&(n|=t===0?$.PE_STR_AUTH_TOP:$.PE_STR_AUTH_ALL),e.toString(n)}function db(e){return U(0),``}function fb(e){return e.toLocaleUpperCase(`en-US`)}function pb(e,t,n){let r=e.getPCSHorizon();if(r.getGeometryType()===L.enumPolygon){let i=e.getDefaultPrecisionSR().getTolerance(0),a=r;for(let e=0;e<n;e++)Hg(a,t[e],i)!==1&&t[e].setNAN();return}if(r.getGeometryType()===L.enumEnvelope){let e=r;for(let r=0;r<n;r++)e.contains(t[r])||t[r].setNAN();return}R(``)}function mb(e,t,n,r){for(let i=0;i<t;i++){if(e[i].y<n.ymin||e[i].y>n.ymax){e[i].setNAN();continue}let t=e[i].x;e[i].x=Cb(t,n,r)}}function hb(e,t,n,r){if(e.isEmpty()||n===1)return e;let i=e.getGeometryType();if(i===L.enumPoint){let r=e,i=r.getXY();return yb([i],1,t,n)===0||i.isNAN()?r.setEmpty():r.setXY(i),e}if(i===L.enumMultiPoint){let r=e,i=e.createInstance(),a=r.getPointCount();i.reserve(a);let o=r.getAttributeStreamRef(0),s=r.getDescription().getAttributeCount()>1,c=new q,l=Float64Array.from(o.getArray());if(yb(l,a,t,n)>0)for(let e=0,t=2*a;e<t;e+=2)Number.isNaN(l[e])||(s?(r.getPointByVal(e>>1,c),c.setXYCoords(l[e],l[e+1]),i.add(c)):i.addXY(l[e],l[e+1]));return i}let a=e,o=t.getOneDegreeGCSUnit(),s=90*o,c=180*o,l=360*o,u=t.getCentralMeridian(),d=.5*o,f=G.constructEmpty();a.queryEnvelope(f);let p=t.getGCSHorizon(),m=t.getGCSHorisonIsInclusive(),h=p.getGeometryType()===L.enumEnvelope,g=G.constructEmpty();p.queryEnvelope(g);let _=t.getGCS();if(n!==2&&n!==4||(g.xmin=u-c,g.xmax=g.xmin+l),n===4){if(!(f.width()>l-o)){let e=G.constructEmpty();e.setCoords({xmin:f.xmin-o,ymin:g.ymin,xmax:f.xmax+o,ymax:g.ymax}),a=new Qd().execute(a,e,_,r);let t=Math.floor((u-f.getCenterX())/l);for(f.move(t*l,0);f.xmin>g.xmax;)--t,f.move(-l,0);for(;f.xmin<g.xmin;)t+=1,f.move(l,0);if(t!==0){let e=new At;e.setShiftCoords(t*l,0),a.applyTransformation(e)}return a}n=2}if(n===2&&(g.xmin=u-c,g.xmax=g.xmin+l),f.ymin<-s||f.ymax>s){let e=G.constructEmpty();if(e.setCoords({xmin:f.xmin-o,ymin:-s,xmax:f.xmax+o,ymax:s}),a=new Qd().execute(a,e,_,r),a.isEmpty())return a;a.queryEnvelope(f)}if(m&&(g.ymax<f.ymin||g.ymin>f.ymax))return a.createInstance();f.width()>l&&(a=Mb(a,u-c,l,_,!0,0,!0,r),a.queryEnvelope(f));let v=jb(f.xmin,f.xmax,g.xmin,g.xmax,l);if(v!==0&&f.move(v,0),f.xmax>g.xmax||f.xmin<g.xmin){if(f.xmax>g.xmax)for(;f.xmin>=g.xmax;)f.move(-l,0),v-=l;for(;f.xmin<g.xmax-l;)f.move(l,0),v+=l}let y=zn(_,p,!1);if(v!==0){let e=new At;e.setShiftCoords(v,0),a.applyTransformation(e),v=0}if(m){if(h&&g.containsEnvelope(f))return a;let e=[,,];for(let t=0;t<2;t++){let n;if(h?n=V(i)?qd(a,g,y,d,r):qd(a,g,y,0,r):(n=new yv().execute(a,p,_,r),n===p&&(n=n.clone())),g.xmin<=f.xmin&&g.xmax>=f.xmax||g.xmin>=f.xmin&&g.xmax<=f.xmax)return n;if(e[t]=n,t===0){f.move(-l,0);let e=new At;e.setShiftCoords(-l,0),a.applyTransformation(e)}}return V(i)?e[0].add(e[1],!1):B(`intersect_with_GCS_horizon: unexpected geometry type`),e[0]}{if(g.ymax<f.ymin||g.ymin>f.ymax)return a;let e=0;for(;!a.isEmpty()&&f.xmax>g.xmin;){if(e!==0){let t=new At;t.setShiftCoords(e,0),a.applyTransformation(t)}if(new ab().execute(a,p,_,r)||(a=new Uy().execute(a,p,_,r),p===a&&(a=a.clone())),e!==0){let t=new At;t.setShiftCoords(-e,0),a.applyTransformation(t)}e-=l,f.move(-l,0)}return a}}function gb(n,r,i,a,o,s){let c={stack:[],error:void 0,hasError:!1};try{if(s===2)return Mf(n,r,i,a,o);if(Math.abs(i.x-a.x)>=Math.PI||!Tx(i.x,a.x,o))return NaN;i.x>a.x&&(a=W(i,i=a));let e=t(c,new mC,!1),l=t(c,new mC,!1),u=t(c,new mC,!1),d=i.clone();xC.geodeticDistance(n,r,i.x,i.y,a.x,a.y,l,e,null,s);let f=l.val,p=0,m=1;for(;f*(m-p)>1e-12*n;){let t=.5*(p+m);if(xC.geodeticCoordinate(n,r,i.x,i.y,f*t,e.val,l,u,s),d.x=l.val,d.y=u.val,d.x===o)return d.y;if(Tx(i.x,d.x,o))m=t;else{if(!Tx(a.x,d.x,o))return NaN;p=t}}return d.y}catch(e){c.error=e,c.hasError=!0}finally{e(c)}}function _b(e,t){let n;if(Array.isArray(e)){let r=e;n=new Float64Array(2*t);for(let e=0,i=0;e<t;e++,i+=2)n[i]=r[e].x,n[i+1]=r[e].y}else n=e;return n}function vb(e,t,n,r){for(let i=0,a=0;i<r;i++,a+=2)t[n+i].x=e[a],t[n+i].y=e[a+1]}function yb(e,t,n,r){if(t===0||r===1)return t;let i=_b(e,t);if(r===2){let r=n.getPannableExtentInGCS(),a=t;for(let e=0,n=2*t;e<n;e+=2)(i[e+1]>r.ymax||i[e+1]<r.ymin)&&(i[e]=NaN,a--);return a?(Nb(i,t,r.xmin,r.width(),!0),e!==i&&vb(i,e,0,t),a):(e!==i&&vb(i,e,0,t),0)}let a=n.getOneDegreeGCSUnit(),o=90*a,s=180*a,c=360*a,l=t;for(let e=0,n=2*t;e<n;e+=2)(i[e+1]>o||i[e+1]<-o)&&(i[e]=NaN,l--);if(!l)return e!==i&&vb(i,e,0,t),0;let u=G.constructEmpty();u.setFromPoints(i,t);let d=n.getGCSHorizon(),f=n.getGCSHorisonIsInclusive(),p=d.getGeometryType()===L.enumEnvelope,m=G.constructEmpty();if(d.queryEnvelope(m),f&&(m.ymax<u.ymin||m.ymin>u.ymax))return e!==i&&vb(i,e,0,t),0;if(f)if(Nb(i,t,m.getCenterX()-s,c,!0),l=t,p)for(let e=0,n=2*t;e<n;e+=2)m.containsCoords(i[e],i[e+1])||(i[e]=NaN,l--);else{let e=zn(n.getGCS(),d,!1),r=new z;for(let n=0,a=2*t;n<a;n+=2)r.setCoords(i[n],i[n+1]),Hg(d,r,e)!==0||(i[n]=NaN,l--)}else{Nb(i,t,-s,c,!0),l=t;let e=zn(n.getGCS(),d,!1),r=new z;for(let n=0,a=2*t;n<a;n+=2){r.setCoords(i[n],i[n+1]),r.isNAN()&&l--;let t=Ab(r.x,m.xmin,m.xmax,c);r.x+=t,Hg(d,r,e)!==0&&(i[n]=NaN,l--)}}return e!==i&&vb(i,e,0,t),l}function bb(e,t,n,r,i,a){if(t.isPannable()||R(`fold_into_360_degree_range`),e.isEmpty())return e;let o,s;if(t.getCoordinateSystemType()===2){let e=t.getPannableExtent();s=e.xmin,o=e.width()}else{let e=t.getOneDegreeGCSUnit();o=360*e,s=n-180*e}return Mb(e,s,o,t,r,i,!0,a)}function xb(e,t,n,r){let i,a;if(n.getCoordinateSystemType()===2){let e=n.getPannableExtent();i=e.xmin,a=e.width()}else{let e=n.getOneDegreeGCSUnit();a=360*e,i=r-180*e}Nb(e,t,i,a)}function Sb(e,t){let n=t.width(),r=We(e-t.vmin,n);return r<0&&(r+=n),t.snapClip(r+t.vmin)}function Cb(e,t,n){return e>t.xmax&&e-t.xmax<n?t.xmax:e<t.xmin&&t.xmin-e<n?t.xmin:e}function wb(e,t,n){if(e[0]<t.vmin||e[0]>t.vmax||n&&e[0]===t.vmax){let n=t.width();return e[0]+=Math.ceil((t.vmin-e[0])/n)*n,e[0]=t.snapClip(e[0]),!0}return!1}function Tb(e,t,n,r,i,a,o,s,c){return new wy(e,null,n,t,r,i,o,s,a).geoNormalizePolygonGeometry(c)}function Eb(e,t,n,r,i,a,o,s,c){return new wy(e,null,n,t,r,i,o,s,a).geoNormalizePolylineGeometry(c)}function Db(e,t,n,r,i){let a=new os,o=a.addGeometry(e);return Ob(a,o,t,zn(t,e,!1),n,r,i),a.getGeometry(o)}function Ob(n,r,i,a,o,s,c){let l={stack:[],error:void 0,hasError:!1};try{U(AS()),i.isPannable()||ge(`insert_geodetic_points`);let e=i.getPannableExtent(),u=i.getGCS(),d=ES();u.querySpheroidData(d);let f=u.getUnit().getUnitToBaseFactor(),p=d.majorSemiAxis,m=d.e2,h=0,g=new I;e.queryIntervalX(g);let _=null,v=H(4,NaN);i.getCoordinateSystemType()===2?(_=i.getPECoordSys(),s?(v[0]=Sb(c,g),v[1]=e.getCenterY(),gC.projToGeog(_,1,v),h=v[0]*f):(v[0]=e.getCenterX(),v[1]=c,gC.projToGeog(_,1,v),h=v[1]*f)):h=c*f,s||h===0||o===2||ge(`insert_geodetic_points: 1`);let y=t(l,new mC,!1),b=new z,x=new z,S=new z,w=new z,T=new z,E=new z;for(let e=n.getFirstPath(r);e!==-1;e=n.getNextPath(e)){let t=n.getFirstVertex(e);n.queryXY(t,S);let r=!1,l=n.getNextVertex(t);for(let e=l;e!==-1;e=n.getNextVertex(e)){if(e===l){if(r)break;r=!0}if(n.queryXY(e,w),s&&(a<c-S.x&&w.x-c>a||a<c-w.x&&S.x-c>a)||!s&&(c!==0||a<-S.y&&w.y>a||a<-w.y&&S.y>a))do{if(Math.abs(S.x-w.x)>=.5*g.width())break;i.getCoordinateSystemType()===2?(v[0]=Sb(S.x,g),v[1]=S.y,v[2]=Sb(w.x,g),v[3]=w.y,$b(_,2,v,0),T.x=v[0]*f,T.y=v[1]*f,E.y=v[3]*f):(T.x=S.x*f,T.y=S.y*f,E.y=w.y*f),E.x=(w.x-S.x)*Math.PI*2/g.width()+T.x;let t=0,r=C(z,2);if(s){if(x.x=h,x.y=gb(p,m,T,E,h,o),Number.isNaN(x.y))break;r[0]=x,t=1}else if(o===2){let e=[0,0];if(t=Nf(p,m,T,E,h,e),!t)break;r[0].x=e[0],r[0].y=h,t===2&&(r[1].x=e[1],r[1].y=h)}else{if(x.x=Ex(p,m,T,E,o),Number.isNaN(x.x))break;x.y=0,r[0]=x,t=1}let a=-1;for(let l=0;l<t;l++){xC.geodeticDistance(p,m,T.x,T.y,E.x,E.y,y,null,null,o);let t=y.val;xC.geodeticDistance(p,m,T.x,T.y,r[l].x,r[l].y,y,null,null,o);let u=y.val;i.getCoordinateSystemType()===2?(v[0]=r[l].x/f,v[1]=r[l].y/f,gC.geogToProj(_,1,v),s?(b.y=v[1],b.x=c):(b.x=Dx(v[0],S.x,w.x,g),b.y=c)):s?(b.x=c,b.y=r[l].y/f):(b.x=Dx(r[l].x/f,S.x,w.x,g),b.y=c);let d=t>0?_e(u/t,0,1):.5;if(d===0||d===1||a>d)continue;let h=n.getPrevVertex(e);n.splitSegment(h,[d],1);let x=n.getNextVertex(h);n.setXYCoords(x,b.x,b.y),a=d}}while(0);S.setCoordsPoint2D(w)}}}catch(e){l.error=e,l.hasError=!0}finally{e(l)}}function kb(e,t){U(t.isPannable());let n=t.getPannableExtent();if(e.getGeometryType()===L.enumPoint){let t=e.getY();return n.ymin<=t&&t<=n.ymax?e:e.createInstance()}let r=G.constructEmpty();e.queryEnvelope(r);let i=G.constructEmpty();i.setCoords({env2D:n}),i.xmin=r.xmin,i.xmax=r.xmax,i.inflateCoords(.01*i.height(),0);let a=Rn(t,r,!1),o;return o=i.containsEnvelope(r)?e:qd(e,i,a,0,null),o}function Ab(e,t,n,r){return y((.5*(n+t)-e)/r)*r}function jb(e,t,n,r,i){return e>=n&&t<=r?0:Ab(.5*(t+e),n,r,i)}function Mb(e,t,n,r,i,a,o,s){let c=e.getGeometryType(),l=I.constructEmpty();l.setCoords(t,t+n);let u=[0];if(c===L.enumPoint){if(u[0]=e.getX(),wb(u,l,o)){let t=i?e:e.clone();return t.setX(u[0]),t}return e}let d=G.constructEmpty();if(e.queryEnvelope(d),d.isEmpty())return e;if(c===L.enumMultiPoint){let t=i?e:e.clone(),n=t.getImpl(),r=n.getAttributeStreamRef(0),a=2*n.getPointCount(),s=!1;for(let e=0;e<a;e+=2)u[0]=r.read(e),wb(u,l,o)&&(r.write(e,u[0]),s=!0);return s&&n.notifyModifiedFlags(2001),t}let f=I.constructEmpty();if(d.queryIntervalX(f),l.contains(f))return l.vmax,f.vmax,e;let p=G.constructEmpty();if(p.setCoords({env2D:d}),f.width()===0){let t=f.vmin;t+=Math.ceil((l.vmin-t)/n)*n,t=l.snapClip(t);let r=i?e:e.clone();return r.setAttributeBasic(0,0,t),r}if(c===L.enumEnvelope){let t=i?e:e.clone();return d.intersect(p),t.setEnvelope(d),t}let m=.1*Math.max(d.height(),d.width())*1;p.inflateCoords(0,m);let h=e,g=r.getTolerance(0),_=new At;for(;;){let e=Math.floor((f.vmin-t)/n),i=Math.ceil((f.vmax-t)/n);if(!(i-e>3))break;{let o=Math.floor(.5*(i+e));p.xmin=d.xmin-m,p.xmax=t+n*o;let l=qd(h,p,g,a,s);p.xmin=p.xmax,p.xmax=d.xmax+m;let u=qd(h,p,g,a,s);_.setShiftCoords((o-i)*n,0),u.applyTransformation(_),c===L.enumPolygon?h=new eb().execute(l,u,r,s):(h=l,h.add(u,!1)),h.queryEnvelope(d),d.queryIntervalX(f)}}p.xmin=t,p.xmax=t+n;let v=G.constructEmpty();v.setCoords({env2D:p}),v.inflateCoords(g,0);let y=Math.floor((d.xmin-p.xmin)/n)*n,b;y?(p.move(y,0),_.setShiftCoords(-y,0)):_.setIdentity(),b=c===L.enumPolyline?new Bi({vd:h.getDescription()}):new X({vd:h.getDescription()});let x=G.constructEmpty(),S=G.constructEmpty();for(;d.xmax>p.xmin;){let e=qd(h,p,g,0,s);e.queryEnvelope(S);let t=!1;t=c===L.enumPolyline?!e.isEmpty()&&(S.width()>g||S.height()>g):!e.isEmpty()&&(c!==L.enumPolygon||S.width()>g),t&&(e.applyTransformation(_),e.queryEnvelope(S),b.queryEnvelope(x),x.inflateCoords(g,g),x.isIntersecting(S)&&c===L.enumPolygon?b=new eb().execute(b,e,r,s):b.add(e,!1)),p.move(n,0),_.shiftCoords(-n,0)}return b}function Nb(e,t,n,r,i=!0){let a=new I;a.setCoords(n,n+r);let o=[0];if(Array.isArray(e)){let n=e;for(let e=0;e<t;e++)a.containsRightExclusive(n[e].x)||(o[0]=n[e].x,wb(o,a,i),n[e].x=o[0])}else{let n=e;for(let e=0;e<t;e++){let t=e<<1;a.containsRightExclusive(n[t])||(o[0]=n[t],wb(o,a,i),n[t]=o[0])}}}function Pb(e,t,n,r=!0){if(e.isEmpty())return;let i=e.getGeometryType();if(!r||i!==L.enumPolygon)if(d(i)){let r=!1;if(V(i)&&e.hasNonLinearSegments()){let i=e.getImpl(),a=i.getAttributeStreamRef(0),o=i.getSegmentFlagsStreamRef();U(o!==null);for(let e=0,s=i.getPathCount();e<s;e++){let s=!0,c=i.isClosedPath(e),l=i.getPathEnd(e);c&&i.getPathSize(e)>0&&(s=(31&o.read(l-1))==1);for(let c=i.getPathStart(e);c<l;c++)if((31&o.read(c))==1){if(s){let e=a.read(2*c),i=Cb(e,t,n);i!==e&&(r=!0,a.write(2*c,i))}s=!0}else s=!1}}else{let i=e.getImpl(),a=i.getAttributeStreamRef(0);for(let e=0,o=i.getPointCount();e<o;e++){let i=a.read(2*e),o=Cb(i,t,n);o!==i&&(r=!0,a.write(2*e,o))}}r&&e.getImpl().notifyModifiedFlags(2001)}else if(i===L.enumEnvelope){let r=e,i=G.constructEmpty();r.queryEnvelope(i),i.xmin=Cb(i.xmin,t,n),i.xmax=Cb(i.xmax,t,n),r.setEnvelope(i)}else if(i===L.enumPoint){let r=e;r.setX(Cb(r.getX(),t,n))}else B(``)}function Fb(e,t,n){let r=new z;return r.x=Cb(e.x,t,n),r.y=e.y,r}function Ib(e,t){if(t.isEmpty())return 0;let n=e.getPECoordSys();if(n.getProjection().getCode()===$.PE_PRJ_AZIMUTHAL_EQUIDISTANT){let r=ES();e.querySpheroidData(r);let i=n.getParameters();if(i[$.PE_PARM_LAM0]===null||i[$.PE_PARM_PHI0]===null)return 0;let a=[i[$.PE_PARM_LAM0].getValue(),i[$.PE_PARM_PHI0].getValue()];gC.geogToProj(n,1,a);let o=new z(a[0],a[1]),s=G.constructEmpty();t.queryEnvelope(s);let c=C(z,4);s.queryCorners(c);let l=0,u=e.getOneMeter(),d=Math.max(r.majorSemiAxis,r.minorSemiAxis)*Math.PI,f=Math.min(r.majorSemiAxis,r.minorSemiAxis)*Math.PI;f-=d/180,d*=u,f*=u;for(let e=0;e<4;e++){let t=z.distance(c[e],o);if(t>d)l++;else if(t>f)return-1}if(l===0)return 1;if(l===4){let e=G.constructEmpty();return e.setCoords({center:o,width:d,height:d}),s.isIntersectingNe(e)?-1:0}return-1}return-1}function Lb(e,t,n,r){let i=e.getGeometryType();U(i===L.enumPolygon||i===L.enumPolyline||i===L.enumMultiPoint);let a=t.getCoordinateSystemType();if(a===2){let a=e;if(n===0){let n=Ib(t,e);if(n===0)return e.createInstance();if(n===1)return e;let i=t.getPCSHorizon(),o=i.getGeometryType(),s=t.getDefaultPrecisionSR();if(o===L.enumEnvelope){let n=G.constructEmpty();i.queryEnvelope(n);let o=Rn(s,n,!1);a=qd(e,n,o,5e4*t.getOneMeterPCSUnit(),r)}else new Vy().execute(i,e,s,r)||(a=new yv().execute(a,i,s,r),a===i&&(a=a.clone()))}else if(t.isPannable()){let e=G.constructEmpty();a.queryEnvelope(e);let o=t.getPannableExtent();o.containsEnvelope(e)||(Pb(a,o,t.getTolerance(0)),n!==2&&n!==4||(a=kb(a,t)),n===4?i===L.enumPolygon&&e.width()>2*o.width()&&(a=Mb(a,-2*o.width(),2*o.width(),t,!0,0,!0,r)):a=bb(a,t,0,!0,1e5*t.getOneMeterPCSUnit(),r))}return a}if(U(a===1),i===L.enumMultiPoint)return Pb(e,t.getPannableExtent(),t.getTolerance(0)),e;{let n=G.constructEmpty();e.queryEnvelope(n);let a=e,o=t.getPannableExtent();if(n.ymin<o.ymin||n.ymax>o.ymax){let e=Math.max(1,n.calculateToleranceFromEnvelope()),i=new G(n.xmin-e,o.ymin,n.xmax+e,o.ymax);if(a=new Qd().execute(a,i,t,r),a.isEmpty())return a}return i===L.enumPolygon&&n.width()>2*o.width()&&(a=Mb(a,-2*o.width(),2*o.width(),t,!0,0,!0,r)),a}}function Rb(e,t,n,r,i,a){let o=r.getCoordinateSystemType();if(o===2){if(i===0)n!==e&&De(n,e,t),pb(r,n,t);else if(n!==e&&De(n,e,t),r.isPannable()){let e=r.getTolerance(0);mb(n,t,r.getPannableExtent(),e),xb(n,t,r,0)}}else{U(o===1);let i=r.getTolerance(0),a=r.getPannableExtent();for(let r=0;r<t;r++)n[r].assign(Fb(e[r],a,i))}}function zb(e,t){let n=t.getPointCount();if(!n)return;let r=t.getImpl(),i=r.getAttributeStreamRef(0),a=e;gC.geogToProj(a,n,i.getArray()),r.notifyModifiedFlags(2001)}function Bb(e,t,n,r){if(!n)return;let i=e.getPECoordSys();if(n===1){if(t[0].isNAN())return;let n=[t[0].x,t[0].y];if(gC.geogToProj(i,1,n),r){let{first:r,second:i}=e.m_peCoordSysVal.getGeogToProjFactors();n[0]=r*(t[0].x-e.getCentralMeridian())+i}t[0].setCoords(n[0],n[1]);return}let a=e.isPannable(),o=a?e.getPannableExtent().width():0,s=179*o/360,c=0;a&&(c=e.getCentralMeridian());let l=new Float64Array(2*256);for(let u=0;u<n;){for(let e=u;e<n&&t[e].isNAN();++e)u++;let d=Math.min(256,n-u);if(d>0){for(let e=1,n=u+1;e<d;++e,++n)if(t[n].isNAN()){d=e;break}for(let e=0;e<d;++e){let n=e<<1;l[n]=t[u+e].x,l[n+1]=t[u+e].y}if(gC.geogToProj(i,d,l),r){let{first:n,second:r}=e.m_peCoordSysVal.getGeogToProjFactors();for(let e=0;e<d;++e)l[e<<1]=n*(t[u+e].x-c)+r}if(a)for(let e=0,n=u;e<d;e++,n++){let r=e<<1,i=l[r],a=Ye(i),u=t[n].x-c;a*Ye(u)<0&&Math.abs(i)>s&&(l[r]-=a*o)}vb(l,t,u,d),u+=d}}}function Vb(e,t,n,r){let i=new ii({vd:t.getDescription()}),a;i.addPoints(t,0,-1),a=new Mv().execute(i,e,r);let o=t.getPointCount();if(n.setEmpty(),e.getInputSR().isPannable()){if(o!==a.getPointCount())return!1;let r=new G;t.queryEnvelope(r);let i=new G;a.queryEnvelope(i);let s=r.width(),c=i.width();if(s!==0&&c!==0){let t=c/s,n=e.getOutputSR().getPannableExtent().width()/e.getInputSR().getPannableExtent().width();if(Math.abs(t/n-1)>1e-10)return!1}else if(s!==0||c!==0)return!1;n.add(t,!1);for(let e=0;e<o;e++){let t=a.getXY(e);n.setXY(e,t)}return!0}return!1}function Hb(e,t,n){U(!n||e.isPannable());let r=t.getPointCount();if(!r)return;let i=t.getImpl(),a=i.getAttributeStreamRef(0),o=e.getPECoordSys(),s=0,c=a.readRange(0,2*r),l=()=>{gC.geogToProj(o,r,c)},u=e.isPannable()&&!n,d=u?e.getPannableExtent().width():0,f=179*d/360;if(e.isPannable()&&(s=e.getCentralMeridian(),n)){let t=e.m_peCoordSysVal.getGeogToProjFactors(),n=t.first,i=t.second;l=()=>{gC.geogToProj(o,r,c);for(let e=0;e<r;e++){let t=e<<1,r=a.read(t);c[t]=n*(r-s)+i}}}if(l(),u)for(let e=0;e<r;e++){let t=e<<1,n=c[t],r=Ye(n),i=a.read(t)-s;r*Ye(i)<0&&Math.abs(n)>f&&(c[t]+=-r*d)}a.writeRangeFromArray(0,2*r,c,!0,1),i.notifyModifiedFlags(2001)}function Ub(e,t,n){switch(t.getGeometryType()){case L.enumLine:gx(e,t,n);return;case L.enumBezier:Sx(e,t,n);return;case L.enumEllipticArc:vx(e,t,n);return;case L.enumBezier2:Cx();return;case L.enumRationalBezier2:wx();return;default:B(``)}}function Wb(e,t,n){if(!t.hasNonLinearSegments())return void Hb(e,t,n);if(U(!n||e.isPannable()),t.isEmpty())return;let r=e.getPECoordSys(),i=e.isPannable(),a=i?e.getPannableExtent().width():0,o=179*a/360,s=0;i&&(s=e.getCentralMeridian());let c=t.createInstance();c.reserveParts(t.getPointCount(),t.getPathCount());let l=t.getImpl(),u=new Q;for(let d=0,f=t.getPathCount();d<f;++d)if(l.hasNonLinearSegmentsPath(d)){let t=!0,r=-1,i=l.getPathStart(d),a=i+l.getSegmentCountPath(d);l.isClosedPath(d)&&(r=a-1);let o=new z;for(let s=i;s<a;++s){if(l.getSegmentBuffer(s,u,!1),Ub(e,u.get(),n),!t&&(u.get().getStartXY().equals(o)||u.get().moveTo(o)),s!==r)c.addSegment(u.get(),t);else{if(t){let e=new q;u.get().queryStart(e),c.startPathPoint(e)}c.closeLastPathWithSegment(u.get())}o.assign(u.get().getEndXY()),t=!1}}else{let e=1024,n,u=l.getPathSize(d),f=Math.min(u,e);c.insertPath(-1,t,d,!0);let p=l.getAttributeStreamRef(0),m=c.getAttributeStreamRef(0);for(let t=l.getPathStart(d),c=l.getPathEnd(d);t<c;){if(n=p.readRange(t,f),gC.geogToProj(r,f,n),i)for(let e=0;e<f;e++){let t=e<<1,r=n[t],i=Ye(r),c=p.read(2*(0+e))-s;i*Ye(c)<0&&Math.abs(r)>o&&(n[t]+=-i*a)}m.writeRangeFromArray(t,f,n,!0,1),t+=f,u-=f,f=Math.min(u,e)}}t.assignMove(c)}function Gb(e,t,n){let r=1e3,i=n.getPointCount();if(!i)return;let a=n.getImpl(),o=a.getAttributeStreamRef(0),s=Math.min(i,r),c=0,l=e.getPECoordSys();Number.isNaN(t)&&(t=0);let u=e.isPannable(),d=e.getOneDegreeGCSUnit(),f=360*d,p=179*d,m;for(;i;){if(m=o.readRange(2*c,2*s),$b(l,s,m,t),u)for(let e=0;e<s;e++){let n=e<<1,r=m[n]-t,i=Ye(r),a=o.read(2*(c+e));i*Ye(a)<0&&Math.abs(r)>p&&(m[n]+=-i*f)}o.writeRangeFromArray(2*c,2*s,m,!0,1),c+=s,i-=s,s=Math.min(i,r)}a.notifyModifiedFlags(2001)}function Kb(e,t,n){switch(n.getGeometryType()){case L.enumLine:qb(e,t,n);return;case L.enumBezier:Xb(e,t,n);return;case L.enumEllipticArc:Jb(e,t,n);return;case L.enumBezier2:Zb();return;case L.enumRationalBezier2:Qb();return;default:B(``)}}function qb(e,t,n){let r=[n.getStartXY(),n.getEndXY()];tx(e,t,r,2),n.setStartXY(r[0]),n.setEndXY(r[1]),n.normalizeAfterEndpointChange()}function Jb(e,t,n){if(n.projectionBehavior()===0)Yb(e,t,n);else{let r=n.isClosed()&&n.isMajor(),i=[n.getStartXY(),r?n.getCenter():n.getEndXY()],a=[i[0].clone(),i[1].clone()];yx(e,t,a,2);let o=new At;o.initializeFromTwoPointsArray(i,a),n.applyTransformation(o);let s=r?0:1;n.setCoordsForIntersector(a[0],a[s],!1)}}function Yb(e,t,n){bx(!1,e,t,n,!1)}function Xb(e,t,n){let r=C(z,4);n.queryControlPoints(r),yx(e,t,r,4),n.setControlPoints(r)}function Zb(e,t,n){U(0)}function Qb(e,t,n){U(0)}function $b(e,t,n,r){let i=gC.projToGeogCenter(e,t,n,r);for(let e=0;e<t;++e){let t=e<<1;U(Number.isFinite(n[t]+n[t+1]))}return i}function ex(e,t,n){if(!n.hasNonLinearSegments())return void Gb(e,t,n);if(n.isEmpty())return;let r=e.getPECoordSys();Number.isNaN(t)&&(t=0);let i=e.isPannable(),a=e.getOneDegreeGCSUnit(),o=360*a,s=179*a,c=n.createInstance();c.reserveParts(n.getPointCount(),n.getPathCount());let l=n.getImpl(),u=new Q;for(let a=0,d=n.getPathCount();a<d;++a)if(l.hasNonLinearSegmentsPath(a)){let n=!0,r=-1,i=l.getPathStart(a),o=i+l.getSegmentCountPath(a);l.isClosedPath(a)&&(r=o-1);let s=new z;for(let a=i;a<o;++a){if(l.getSegmentBuffer(a,u,!1),Kb(e,t,u.get()),!n&&(u.get().getStartXY().equals(s)||u.get().moveTo(s)),a!==r)c.addSegment(u.get(),n);else{if(n){let e=new q;u.get().queryStart(e),c.startPathPoint(e)}c.closeLastPathWithSegment(u.get())}s.assign(u.get().getEndXY()),n=!1}}else{let e=1e3,u,d=l.getPathSize(a),f=Math.min(d,e);c.insertPath(-1,n,a,!0);let p=l.getAttributeStreamRef(0),m=c.getAttributeStreamRef(0);for(let n=l.getPathStart(a),c=l.getPathEnd(a);n<c;){if(u=p.readRange(2*n,2*f),$b(r,f,u,t),i)for(let e=0;e<f;e++){let r=e<<1,i=u[r]-t,a=Ye(i),c=p.read(2*n);a*Ye(c)<0&&Math.abs(i)>s&&(u[r]+=-a*o)}m.writeRangeFromArray(2*n,2*f,u,!0,1),n+=f,d-=f,f=Math.min(d,e)}}n.assignMove(c)}function tx(e,t,n,r){let i=e.getPECoordSys();Number.isNaN(t)&&(t=0);let a=e.isPannable(),o=e.getOneDegreeGCSUnit(),s=360*o,c=179*o,l=new Float64Array(2*256);for(let e=0;e<r;){for(let t=e;t<r&&n[t].isNAN();++t)e++;let o=Math.min(256,r-e);if(o>0){for(let t=1,r=e+1;t<o;++t,++r)if(n[r].isNAN()){o=t;break}for(let t=0;t<o;t++){let r=t<<1;l[r]=n[e+t].x,l[r+1]=n[e+t].y}if($b(i,o,l,t),a)for(let r=0,i=e;r<o;++r,++i){let e=r<<1,a=n[i].x,o=l[e]-t,u=Ye(o);u*Ye(a)<0&&Math.abs(o)>c&&(l[e]-=u*s)}for(let t=0;t<o;t++){let r=t<<1;n[e+t].x=l[r],n[e+t].y=l[r+1]}e+=o}}}function nx(e,t,n,r){U(0)}function rx(e,t,n){let r=t.getPointCount();if(!r)return!1;let i=t.getImpl(),a=i.getAttributeStreamRef(0),o=null,s=e.getInputSR(),c=e.getOutputSR();s.getVCS(),c.getVCS();let l=s.getOneDegreeGCSUnit(),u=c.getOneDegreeGCSUnit(),d=e.isVertical();d&&t.hasAttribute(1)&&(o=i.getAttributeStreamRef(1));let f=e.getDatumTransformation(),p=!!f&&f.getType()===1;if(p||o===null||(nx(o.getArray()),o=null),!f||f.count()===0){let e=s.getGcsUnitFactor()/c.getGcsUnitFactor(),t=(s.getPrimeMeridian()-c.getPrimeMeridian())*u,n=-90*l,o=90*l,d=0,f=a.getArray(),p=[0];for(let e=1,t=2*r;e<t;)p[0]=f[e],d|=it(p,n,o)?1:0,f[e]=p[0],e+=2;if(t!==0||e!==1){d=1;let n=a.getArray();for(let i=0,a=2*r;i<a;){let r=n[i];r*=e,r+=t,n[i]=r,n[i+1]*=e,i+=2}}return d!==0&&i.notifyModifiedFlags(2001),!!d}let m=1e3,h=Math.min(r,m),g=H(h,NaN),_=H(h,NaN),v=null;o!==null&&(v=new Float64Array(h));let y=0,b=NaN,x=NaN,S=360*u,C=u/l;n&&(x=90*u,b=89.9*l,_.fill(0));let w=!0,T=0;for(;r;){let e=!1,t=a.readRange(2*y,2*h);for(let e=0;e<h;e++)g[e]=t[e<<1];if(n)for(let n=0;n<h;n++){let r=1+(n<<1),i=Math.abs(t[r])-b;if(i>0){let a=t[r];t[r]=ft(b,a),_[n]=ft(i,a),e=!0}}let i=t[0];if(p){let e=f;v&&o.queryRange(y,h,v,!0,1),e.transform(!1,t,v,h),v&&o.writeRangeFromArray(y,h,v,!0,1)}else f.transform(!1,t,h);w&&=(T=t[0]-C*i,!1);for(let e=0;e<h;e++){let n=e<<1,r=t[n]-g[e]*C-T;Math.abs(r)>200&&(t[n]+=r>0?-S:S)}if(e){for(let e=0;e<h;e++)if(_[e]){let n=1+(e<<1);t[n]+=C*_[e],t[n]>x?t[n]=x:t[n]<-x&&(t[n]=-x)}_.fill(0)}a.writeRangeFromArray(2*y,2*h,t,!0,1),d&&o&&o.writeRangeFromArray(y,h,v,!0,1),y+=h,r-=h,h=Math.min(r,m)}return i.notifyModifiedFlags(2001),!0}function ix(e,t,n){switch(t.getGeometryType()){case L.enumLine:return ux(e,t,n);case L.enumBezier:return px(e,t,n);case L.enumEllipticArc:return dx(e,t,n);case L.enumBezier2:return mx();case L.enumRationalBezier2:return hx();default:B(``)}}function ax(e,t,n){if(!t.hasNonLinearSegments())return rx(e,t,n);if(t.isEmpty())return!1;let r=t.createInstance();r.reserveParts(t.getPointCount(),t.getPathCount());let i=t.getImpl(),a=new Q;for(let o=0,s=t.getPathCount();o<s;++o){let t=!0,s=-1,c=i.getPathStart(o),l=c+i.getSegmentCountPath(o);i.isClosedPath(o)&&(s=l-1);let u=new z;for(let o=c;o<l;++o){if(i.getSegmentBuffer(o,a,!1),ix(e,a.get(),n),!t&&(a.get().getStartXY().equals(u)||a.get().moveTo(u)),o!==s)r.addSegment(a.get(),t);else{if(t){let e=new q;a.get().queryStart(e),r.startPathPoint(e)}r.closeLastPathWithSegment(a.get())}u.assign(a.get().getEndXY()),t=!1}}return t.assignMove(r),!0}function ox(e,t,n,r,i,a){if(e.isIdentityGeogToGeog()){let n=90*e.getInputSR().getOneDegreeGCSUnit(),i=0,a=[0];for(let e=0;e<r;e++)a[0]=t[e].y,i|=it(a,-n,n)?1:0,t[e].y=a[0];return i}let o=e.getInputSR(),s=e.getOutputSR(),c=o.getVCS(),l=s.getVCS(),u=o.getOneDegreeGCSUnit(),d=90*u,f=s.getOneDegreeGCSUnit(),p=e.isVertical(),m=e.getDatumTransformation(),h=!!m&&m.getType()===1;if(p||(n=null),!m||m.count()===0){let e=0,i=[0];for(let n=0;n<r;n++)i[0]=t[n].y,e|=it(i,-d,d)?1:0,t[n].y=i[0];return e|=My(o.getGCS(),c,s.getGCS(),l,t,n,r)?1:0,e}h||n===null||nx();let g=1024,_=Math.min(r,g),v=H(_,NaN),y=H(_,NaN),b=0,x=NaN,S=NaN,C=360*f,w=f/u;i&&(S=90*f,x=89.9*u);let T=!0,E=0,D=r;for(;D;){let e=!1;for(let e=0;e<_;e++)v[e]=t[e+b].x;if(i)for(let n=0;n<_;n++){let r=Math.abs(t[n+b].y)-x;if(r>0){let i=t[n+b].y;t[n+b].y=ft(x,i),y[n]=ft(r,i),e=!0}}let r=t[0].x;h?m.transform(!1,t,n,_):m.transform(!1,t,_),T&&=(E=t[0].x-w*r,!1);for(let e=0;e<_;e++){let n=t[b+e].x-v[e]*w-E;Math.abs(n)>200&&(n>0?t[b+e].x-=C:t[b+e].x+=C)}if(e){for(let e=0;e<_;e++)y[e]&&(t[b+e].y+=w*y[e],t[b+e].y>S?t[b+e].y=S:t[b+e].y<-S&&(t[b+e].y=-S));y.fill(0,0,_)}b+=_,D-=_,_=Math.min(D,g)}return 1}function sx(e,t,n,r,i){return U(0),0}function cx(e,t,n,r,i){U(r===null),U(t<2147483647);let a=Array.isArray(n),o;o=a?Re(n):n;let s=_C.geogToGeog(e,t,o,null,i);return a&&Tt(o,n),s}function lx(e,t,n,r,i,a){let o=0,s=!0,c=0;for(let a=0;a<r;++a)t[a].isNAN()?s||=(o|=ox(e,t.slice(c,a-c),n?n.slice(c,a-c):null,a-c,i),c=a,!0):s&&=(c=a,!1);return s||(o|=ox(e,c===0?t:t.slice(c),n?c===0?n:n.slice(c):null,r-c,i)),o!==0}function ux(e,t,n){let r=[t.getStartXY(),t.getEndXY()],i=[0,0],a=null;t.hasAttribute(1)&&(a=i,a[0]=t.getAttributeAsDbl(0,1,0),a[1]=t.getAttributeAsDbl(1,1,0));let o=lx(e,r,a,2,n);return t.setStartXY(r[0]),t.setEndXY(r[1]),a&&(t.setStartAttribute(1,0,a[0]),t.setEndAttribute(1,0,a[1])),t.normalizeAfterEndpointChange(),o}function dx(e,t,n){if(t.projectionBehavior()===0)return fx(e,t,n);let r=t.getStartXY().equals(t.getEndXY()),i=C(z,3),a=C(z,3),o=[0,0,0],s=null;i[0].assign(t.getStartXY()),i[1].assign(r?t.getCenter():t.getEndXY());let l=!1;t.hasAttribute(1)&&(s=o,s[0]=t.getAttributeAsDbl(0,1,0),s[1]=t.getAttributeAsDbl(1,1,0),s[2]=c(s[0],s[1],.5),r&&(s[1]=s[2])),a[0].setCoordsPoint2D(i[0]),a[1].setCoordsPoint2D(i[1]);let u=new At;if(r||t.isDegenerateToLine())l=lx(e,a,s,2,n),u.initializeFromTwoPoints(i[0],i[1],a[0],a[1]);else{let r=new z;t.queryCoord2D(.5,r),i[2].setCoordsPoint2D(r),a[2].setCoordsPoint2D(r),l=lx(e,a,s,3,n),u.setFromTwoTriangles(i,a)}return u.isIdentity()||(t.applyTransformation(u),t.setStartXY(a[0]),t.setEndXY(r?a[0]:a[1]),t.normalizeAfterEndpointChange()),s&&(t.setStartAttribute(1,0,s[0]),t.setEndAttribute(1,0,r?s[0]:s[1])),l}function fx(e,t,n){let r=[t.getStartXY(),t.getEndXY(),t.getInteriorPoint(),t.getCenter()],i=4;t.isDegenerateToLine()&&(i=2);let a=[0,0,0,0],o=null;if(t.hasAttribute(1)){o=a,o[0]=t.getAttributeAsDbl(0,1,0),o[1]=t.getAttributeAsDbl(1,1,0);let e=c(o[0],o[1],.5);o[2]=e,o[3]=e}let s=t.getStartXY().equals(t.getEndXY())&&!t.isDegenerateToLine(),l=lx(e,r,o,i,n);return s?t.constructCircleCenterAndPoint(r[3],r[0],!t.isClockwise()):t.isDegenerateToLine()?t.constructLineCircularArc(r[0],r[1]):t.constructCircularArcThreePoint(r[0],r[1],r[2]),o&&(t.setStartAttribute(1,0,o[0]),t.setEndAttribute(1,0,o[1])),l}function px(e,t,n){let r=C(z,4);t.queryControlPoints(r);let i=[0,0,0,0],a=null;t.hasAttribute(1)&&(a=i,a[0]=t.getAttributeAsDbl(0,1,0),a[3]=t.getAttributeAsDbl(1,1,0),a[1]=c(a[0],a[3],.5),a[2]=a[1]);let o=lx(e,r,a||null,r.length,n);return t.setControlPoints(r),a&&(t.setStartAttribute(1,0,a[0]),t.setEndAttribute(1,0,a[3])),t.normalizeAfterEndpointChange(),o}function mx(e,t,n){return U(0),!1}function hx(e,t,n){return U(0),!1}function gx(e,t,n){let r=[t.getStartXY(),t.getEndXY()];Bb(e,r,2,n),t.setStartXY(r[0]),t.setEndXY(r[1]),t.normalizeAfterEndpointChange()}function _x(e,t,n,r){Bb(e,t,n,r)}function vx(e,t,n){if(t.projectionBehavior()===0)xx(e,t,n);else{let r=t.isClosed()&&t.isMajor(),i=[t.getStartXY(),r?t.getCenter():t.getEndXY()],a=[i[0].clone(),i[1].clone()];_x(e,a,2,n);let o=new At;o.initializeFromTwoPointsArray(i,a),t.applyTransformation(o);let s=r?0:1;t.setCoordsForIntersector(a[0],a[s],!1)}}function yx(e,t,n,r){tx(e,t,n,r);let i=new G;i.setFromPoints(n,r);let a=e.getOneDegreeGCSUnit(),o=360*a,s=180*a;if(i.width()>s){for(let e=0;e<r;e++)for(;n[e].x<t;)n[e].x+=o;if(i.setFromPoints(n,r),i.xmax>s+t)for(let e=0;e<r;e++)n[e].x-=o}}function bx(e,t,n,r,i){let a=C(z,3),o=0,s=!1,c=!1,l=r.isDegenerateToLine();l?(a[0].assign(r.getStartXY()),a[1].assign(r.getEndXY()),a[2].setCoords(0,0),o=2):r.isClosed()&&r.isMajor()?(s=!0,c=!r.isClockwise(),a[0].assign(r.getStartXY()),a[1].assign(r.getCenter()),a[2].setCoords(0,0),o=2):(a[0].assign(r.getStartXY()),a[1].assign(r.getEndXY()),a[2].assign(r.getInteriorPoint()),o=3),e?_x(t,a,o,i):yx(t,n,a,o),l?r.constructLineCircularArc(a[0],a[1]):s?r.constructCircleCenterAndPoint(a[1],a[0],c):r.constructCircularArcThreePoint(a[0],a[1],a[2])}function xx(e,t,n){bx(!0,e,0,t,n)}function Sx(e,t,n){let r=C(z,4);t.queryControlPoints(r),_x(e,r,4,n),t.setControlPoints(r)}function Cx(e,t,n){U(0)}function wx(e,t,n){U(0)}function Tx(e,t,n){let r=gu(e),i=gu(t),a=yu(r,i),o=yu(r,gu(n));return o===0||a>0&&o>0&&o<=a||a<0&&o<0&&o>=a}function Ex(n,r,i,a,o){let s={stack:[],error:void 0,hasError:!1};try{let e=i.clone(),c=a.clone();if(o===2){let t=[0,0];return Nf(n,r,e,c,0,t),t[0]}if(e.y>c.y){let t=new z;t.assign(e),e.assign(c),c.assign(t)}let l=t(s,new mC,!1),u=t(s,new mC,!1),d=t(s,new mC,!1),f=new I;if(f.setCoords(e.y,c.y),!f.containsCoordinate(0)||Math.abs(e.x-c.x)>=Math.PI)return NaN;if(e.x===c.x)return e.x;xC.geodeticDistance(n,r,e.x,e.y,c.x,c.y,u,l,null,o);let p=u.val,m=0,h=1,g=e.clone();for(;p*(h-m)>1e-12*n;){let t=.5*(m+h);if(xC.geodeticCoordinate(n,r,e.x,e.y,p*t,l.val,u,d,o),g.x=u.val,g.y=d.val,f.setCoords(e.y,g.y),g.y===0)return g.x;if(f.containsCoordinate(0))h=t;else{if(f.setCoords(c.y,g.y),!f.containsCoordinate(0))return U(!1),NaN;m=t}}return g.x}catch(e){s.error=e,s.hasError=!0}finally{e(s)}}function Dx(e,t,n,r){let i=new I;i.setCoords(t,n);let a=r.width(),o=Math.floor((e-t)/a)*a+e,s=i.getCenter();for(;Math.abs(o-s)>Math.abs(o+a-s);)o+=a;return o}var Ox=class extends n{constructor(){super(),this.m_geometryDeque=[],this.m_index=-1}next(){if(this.m_geometryDeque.length>0){this.m_index++;let e=this.m_geometryDeque[0];return this.m_geometryDeque.shift(),e}return null}getGeometryID(){return this.m_index}tick(e){this.m_geometryDeque.push(e)}tock(){return!0}getRank(){return 1}};function kx(e,t){return e===t||e!==null&&t!==null&&e.m_csType===t.m_csType&&(e.m_WKID===0&&t.m_WKID===0?e.m_hashCode===t.m_hashCode&&e.m_canonicalWkt===t.m_canonicalWkt:e.m_WKID===t.m_WKID)}function Ax(e,t){return e===t||e!==null&&t!==null&&e.m_csType===t.m_csType&&(e.m_WKID===0&&t.m_WKID===0?e.m_csType===1?e.m_peCoordSys.isEqual(t.m_peCoordSys):e.m_peCoordSys===t.m_peCoordSys:e.m_WKID===t.m_WKID)}var jx=class{constructor(e,t=!0){this.m_PCSHorizon=null,this.m_GCSHorizon=null,this.m_GCSSplitLines=null,this.m_bGCSHorisonIsInclusive=!1,this.m_oneMeterPCS=0,this.m_oneDegreeGCS=0,this.m_gcsUnitFactor=0,this.m_northPole=z.getNAN(),this.m_southPole=z.getNAN(),this.m_polesUpdated=0,this.m_domain=G.constructEmpty(),this.m_primeMeridian=NaN,this.m_geogToProjFactor=1,this.m_geogToProjOffset=0,this.m_geogToProjFactorsUpdated=0,this.m_oneMillimeter=0,this.m_centralMeridian=0,this.m_pPCSInfoNoDomain=null,this.m_oldWKID=-1973,this.m_vcsWKID=-1,this.m_bIsPannable=!1,this.m_bCached=!1,this.m_pannableExtent=G.constructEmpty(),this.m_pannableExtentGCS=G.constructEmpty(),this.m_areaOfUse=null,this.m_canonicalWkt=``,this.m_peCoordSys=e,this.m_WKID=hC.getCode(e),this.m_WKID<=0?(this.m_WKID=0,this.m_canonicalWkt=sb(e,0,!0),this.m_hashCode=at(this.m_canonicalWkt)):this.m_hashCode=D(this.m_WKID);let n=this.m_peCoordSys.getType();this.m_csType=n===$.PE_TYPE_PROJCS?2:1,U(n===$.PE_TYPE_PROJCS||n===$.PE_TYPE_GEOGCS),n===$.PE_TYPE_PROJCS&&(e.loadConstants()||R(`PeProjcs.loadConstants failed`));let r=n===$.PE_TYPE_GEOGCS?this.m_peCoordSys:this.m_peCoordSys.getGeogcs();n!==$.PE_TYPE_GEOGCS&&hC.getCode(r),this.m_unit=pf(e),this.m_primeMeridian=r.getPrimem().getLongitude();{let e=r.getUnit().getUnitFactor();this.m_gcsUnitFactor=e;let t=Math.PI/(180*e);Math.abs(t-1)<1e-10&&(t=1),this.m_oneDegreeGCS=t}if(n===$.PE_TYPE_PROJCS){let e=this.m_peCoordSys,t=e.getUnit().getUnitFactor();this.m_oneMeterPCS=1/t,this.m_oneMillimeter=.001/t,this.m_pPCSInfoNoDomain=vC.generate(e,vC.PE_PCSINFO_OPTION_NONE),this.m_pPCSInfoNoDomain||B(`cannot create pcs info`),this.m_bIsPannable=this.m_pPCSInfoNoDomain.isPannableRectangle(),this.m_centralMeridian=this.m_pPCSInfoNoDomain.getCentralMeridian()}else{this.m_bIsPannable=!0,this.m_polesUpdated=1,this.m_oneMeterPCS=0;let e=1/r.getUnit().getUnitFactor();this.m_oneMillimeter=.001/r.getDatum().getSpheroid().getAxis()*e,this.m_centralMeridian=0}this.m_bIsPannable&&(this.updateGCSHorizon(),this.updatePCSHorizon(),this.updatePoles(),this.updateDomain(),this.updatePannableExtent(),this.updatePannableExtentGCS())}[Symbol.dispose](){}getHashCode(){return this.m_hashCode}getPCSHorizonPannable(){return this.m_PCSHorizon}getGCSHorizonPannable(){return this.m_GCSHorizon}getPCSInfo(){return U(this.m_pPCSInfoNoDomain),this.m_pPCSInfoNoDomain}getCentralMeridian(){return this.m_centralMeridian}updateGCSHorizon(){if(this.m_peCoordSys.getType()!==$.PE_TYPE_PROJCS)return;let e=!0,t=this.m_peCoordSys,n=t.getGeogcs(),r=t.horizonGcsGenerate();if(!r)return;U(r.length>0);let i=r[0].getNump(),a=r[0].getKind(),o,s;e=r[0].getInclusive()>0;let c=this.getOneDegreeGCSUnit(),l=90*c,u=360*c,d=370*c,f=180*c*$.PE_HORIZON_DELTA/Math.PI,p=G.constructEmpty(),m=null;if(i>1){for(let e=1;e<i;e++)if(r[e].getKind()===$.PE_HORIZON_LINE){m||=new Bi;let t=r[e].getCoord();m.startPathCoords(t[0][0],t[0][1]),m.lineToCoords(t[1][0],t[1][1])}}if(a===$.PE_HORIZON_RECT){let t=r[0].getCoord();if(p.setFromPoints([new z(t[0][0],t[0][1]),new z(t[1][0],t[1][1])],2),Math.abs(p.ymax-l)<1e-7*f&&(p.ymax=l),Math.abs(p.ymin+l)<1e-7*f&&(p.ymin=-l),p.width()>d){let e=-400*c,t=e+5*u;p.setCoords({xmin:e,ymin:p.ymin,xmax:t,ymax:p.ymax})}let n=new lr({env2D:p});this.m_GCSHorizon||(this.m_GCSHorizon=n,this.m_bGCSHorisonIsInclusive=e)}else{let t=this.getPCSInfo().isGcsHorizonMultiOverlap(),a=FS(n,null,null,1),d=[],f=new I;for(let e=0;e<i;e++){if(r[e].getKind()!==$.PE_HORIZON_POLY)continue;o=r[e].getSize();let t=r[e].getCoord(),n=G.constructEmpty();n.setFromPoints(M(t),o),d.push(new I(n.xmin,n.xmax)),n.width(),f.merge(d.at(-1))}let p=!1,h=new I;f.width()>u&&d.length>1?(h.vmin=this.getCentralMeridian()-u,h.vmax=h.vmin+2*u,p=!0,t=!0):(h.vmin=f.vmin,h.vmax=h.vmin+u);let g=e=>{let t=0;for(;d[e].vmin+t<h.vmin;)t+=u;for(;d[e].vmax+t-u>h.vmin;)t-=u;return t},_=new X;if(t){let e=new Ox,t=new eb().executeMany(e,a,null);for(let n=0;n<i;n++){if(r[n].getKind()!==$.PE_HORIZON_POLY)continue;o=r[n].getSize();let i=r[n].getCoord();s=r[n].getInclusive()>0;let a=new X;if(a.addPathPoint2D(M(i),o-1,!0),p){let t=g(n),r=d[n].clone();r.move(t);let i=t,o=new At;do{o.setShiftCoords(i,0);let t=a.clone();t.applyTransformation(o),e.tick(t),e.tock(),i+=u,r.move(u)}while(r.vmin<h.vmax)}else e.tick(a),t.tock()}_=t.next()}else{_=new X;for(let t=0;t<i;t++){if(r[t].getKind()!==$.PE_HORIZON_POLY)continue;o=r[t].getSize();let n=r[t].getCoord();if(s=r[t].getInclusive()>0,U(s===e),p){let e=new X;e.addPathPoint2D(M(n),o-1,!0);let r=g(t),i=d[t].clone();i.move(r);let a=r,s=new At;do{if(a!==0){s.setShiftCoords(a,0);let t=new X({copy:e});t.applyTransformation(s),_.addPath(t,0,!0)}else _.addPath(e,0,!0);a+=u,i.move(u)}while(i.vmin<h.vmax)}else _.addPathPoint2D(M(n),o-1,!0)}}p&&(_=new Qd().execute(_,new G(h.vmin,-l-c,h.vmax,l+c),a,null)),e?new yv().accelerateGeometry(_,a,1):new Uy().accelerateGeometry(_,a,1),new ab().accelerateGeometry(_,a,1),this.m_GCSHorizon===null&&(this.m_GCSHorizon=_,this.m_bGCSHorisonIsInclusive=e,this.m_GCSSplitLines=m)}}updateAreaOfUse(){return null}updatePCSHorizon(){if(this.m_peCoordSys.getType()!==$.PE_TYPE_PROJCS)return;let e=this.m_peCoordSys.horizonPcsGenerate();if(!e)return;let t;this.getPCSInfo();let n=e[0].getKind();e[0].getInclusive();let r=G.constructEmpty(),i=e[0].getNump(),a=!1;if(n===$.PE_HORIZON_RECT){let n=e[0].getCoord();r.setFromPoints(M(n),2),t=new lr({env2D:r})}else{let n=-1;for(let t=0;t<i;t++)e[t].getKind()===$.PE_HORIZON_POLY&&(n=t);U(n>=0);let r=e[n].getSize()-1,o=e[n].getCoord(),s=new X;t=s,s.addPathPoint2D(M(o),r,!0),a=!0}if(this.getPCSInfo().isDensificationNeeded()){U(n!==$.PE_HORIZON_RECT);let e=1e5*this.getOneMeterPCSUnit();t=new rf().execute(t,e,0,0,null)}if(a){{let e=new lr;t.queryEnvelope(e),t.calculateArea2D(),t.calculateLength2D(),t.getExteriorRingCount()}new yv().accelerateGeometry(t,null,1)}this.m_PCSHorizon===null&&(this.m_PCSHorizon=t)}updatePannableExtent(){let e=this.m_peCoordSys.getType();if(e===$.PE_TYPE_PROJCS){let e=this.m_peCoordSys,t=this.getPCSInfo().getCentralMeridian(),n=e.getGeogcs();n||B(``);let r=[t+1/n.getUnit().getUnitFactor()*Math.PI,0];gC.geogToProj(e,1,r);let i=r[0],a=e.getParameters()[$.PE_PARM_X0].getValue(),o=this.getPCSHorizon(),s=G.constructEmpty();o.queryEnvelope(s);let c=Math.abs(i-a),l=c+a,u=-1*c+a,d=s.ymax,f=s.ymin;this.m_pannableExtent.setCoords({xmin:u,ymin:f,xmax:l,ymax:d})}else if(e===$.PE_TYPE_GEOGCS){let e=1/this.m_peCoordSys.getUnit().getUnitFactor()*Math.PI;this.m_pannableExtent.setCoords({xmin:-e,ymin:-e/2,xmax:e,ymax:e/2})}else B(``)}updatePannableExtentGCS(){let e=this.m_peCoordSys.getType();if(e===$.PE_TYPE_PROJCS){let e=this.m_peCoordSys,t=this.m_centralMeridian,n=e.getGeogcs();n||B(``);let r=1/n.getUnit().getUnitFactor()*Math.PI,i=this.getGCSHorizon(),a=G.constructEmpty();i.queryEnvelope(a),this.m_pannableExtentGCS.setCoords({xmin:t-r,ymin:a.ymin,xmax:t+r,ymax:a.ymax})}else if(e===$.PE_TYPE_GEOGCS){let e=1/this.m_peCoordSys.getUnit().getUnitFactor()*Math.PI;this.m_pannableExtentGCS.setCoords({xmin:-e,ymin:-e/2,xmax:e,ymax:e/2})}else B(``)}updateDomain(){if(this.m_csType===1){let e=400*this.getOneDegreeGCSUnit();this.m_domain=G.construct(-e,-e,e,e)}else{U(this.m_csType===2);let e=vC.generate(this.m_peCoordSys,vC.PE_PCSINFO_OPTION_DOMAIN);e||B(`generate pcs info failed`);let t=new G(e.getDomainMinx(),e.getDomainMiny(),e.getDomainMaxx(),e.getDomainMaxy());this.m_domain.isEmpty()&&this.m_domain.setCoords({env2D:t})}}updatePoles(){if(this.m_peCoordSys.getType()===$.PE_TYPE_PROJCS){let e=90*this.getOneDegreeGCSUnit(),t=[[0,e],[0,-e]];gC.geogToProj(this.m_peCoordSys,2,t);let n=this.getPCSInfo().getNorthPoleLocation()!==vC.PE_POLE_OUTSIDE_BOUNDARY,r=this.getPCSInfo().getSouthPoleLocation()!==vC.PE_POLE_OUTSIDE_BOUNDARY;this.m_polesUpdated||=(n&&this.m_northPole.setCoords(t[0][0],t[0][1]),r&&this.m_southPole.setCoords(t[1][0],t[1][1]),1)}else this.m_polesUpdated=1}updateGeogToProjFactors(){if(this.m_peCoordSys.getType()===$.PE_TYPE_PROJCS){let e=this.getOneDegreeGCSUnit(),t=this.m_pPCSInfoNoDomain.getCentralMeridian(),n=[0,0,0,0];n[0]=t,n[1]=0,n[2]=t+e,n[3]=0;let r=gC.geogToProj(this.m_peCoordSys,2,n);U(r===2);let i=(n[2]-n[0])/e,a=n[0];this.m_geogToProjFactorsUpdated===0&&(this.m_geogToProjFactor=i,this.m_geogToProjOffset=a,this.m_geogToProjFactorsUpdated=1)}else this.m_geogToProjFactorsUpdated=1}getOneMeterPCSUnit(){return this.m_oneMeterPCS}getOneDegreeGCSUnit(){return this.m_oneDegreeGCS}getGcsUnitFactor(){return this.m_gcsUnitFactor}getUnitsPerMillimeter(){return this.m_oneMillimeter}getGCSSplitLines(){return this.m_bIsPannable?null:(this.m_GCSHorizon||this.updateGCSHorizon(),this.m_GCSSplitLines)}getGCSHorizon(){return this.m_bIsPannable?this.getGCSHorizonPannable():(this.m_GCSHorizon!==null||this.updateGCSHorizon(),this.m_GCSHorizon)}getGCSHorisonIsInclusive(){return this.m_bIsPannable||this.getGCSHorizon(),this.m_bGCSHorisonIsInclusive}getPCSHorizon(){return this.m_bIsPannable?this.getPCSHorizonPannable():(this.m_PCSHorizon!==null||this.updatePCSHorizon(),this.m_PCSHorizon)}getPole(e){return this.m_bIsPannable||this.m_polesUpdated!==0||this.updatePoles(),e?this.m_southPole:this.m_northPole}getGeogToProjFactors(){return this.m_geogToProjFactorsUpdated===0&&this.updateGeogToProjFactors(),lt(this.m_geogToProjFactor,this.m_geogToProjOffset)}getDomainXY(){if(this.m_bIsPannable)return this.m_domain.clone();let e=!1;return e=this.m_domain.isEmpty(),e&&this.updateDomain(),this.m_domain.clone()}getPrimeMeridian(){return this.m_primeMeridian}getLatestID(){return this.m_WKID}getOldID(){let e=this.m_oldWKID;if(e<0){if(e=0,this.m_WKID>0){let t=[0];kC(this.m_peCoordSys.getType(),this.m_WKID,t,[0])||B(`query_code_change`),e=t[0]}this.m_oldWKID=e}return e}isCustomWkid(){return!1}isPannable(){return this.m_bIsPannable}getPannableExtent(){return this.m_pannableExtent.clone()}getPannableExtentGCS(){return this.m_pannableExtentGCS.clone()}getAreaOfUse(){return this.m_areaOfUse===null?this.updateAreaOfUse():this.m_areaOfUse}getVcsCode(){return 0}saveMemory(){}getCSType(){return this.m_csType}getUnit(){return this.m_unit}setCached(){this.m_bCached=!0}getCached(){return this.m_bCached}static equal(e,t){return!1}static equal_for_projection(e,t){return!1}},Mx=class{constructor(e,t=!0){this.m_oneMeter=0,this.m_WKID=-1,this.m_oldWKID=-1,this.m_canonicalWkt=`not yet implemented`,this.m_model=0,this.m_unit=new _S,this.m_cached=!1}setCached(e=!0){this.m_cached=e}getCached(){return this.m_cached}getOneMeterUnit(){return 0}getLatestID(){return this.m_WKID}getOldID(){let e=this.m_oldWKID;return e<0&&(e=0,this.m_WKID>0&&(e=this.m_WKID),this.m_oldWKID=e),e}getModel(){return 0}isCustomWkid(){return!1}getVerticalUnit(){return this.m_unit}static equal(e,t){return!1}static equal_for_projection(e,t){return!1}};function Nx(e,t,n){return Px(e,t,G.constructEmpty())}function Px(e,t,n,r){return Ix(!0,e,t,n)}function Fx(e,t,n,r){return Lx(!0,e,t,n,r)}function Ix(e,t,n,r,i){return AS()||a(`cannot create projection transformation`),t.hasVCS()&&n.hasVCS()?Bx():Vx(t,n,r)}function Lx(e,t,n,r,i,o){return AS()||a(`cannot create projection transformation`),new Kx(e?2:1,t,n,r,i,o)}function Rx(e,t,n,r,i,o=!1){if(t&&n||R(``),AS()||a(`cannot obtain geotransformation list`),e===1&&t.hasVCS()&&n.hasVCS())return xt(`hv xform not impl`),[];{let e=VC(t,n,r,i,o),a=[];for(let t of e)a.push(t);return a}}function zx(){return{centralMeridianOfOutputGCS:NaN,densificationStep:NaN,clipWithInputHorizon:!0,clipWithOutputHorizon:!0,legacyHorizonClipping:!1,normalizeResultGeometry:!1,equals(e){return te(this.centralMeridianOfOutputGCS,e.centralMeridianOfOutputGCS)&&te(this.densificationStep,e.densificationStep)&&this.clipWithInputHorizon===e.clipWithInputHorizon&&this.clipWithOutputHorizon===e.clipWithOutputHorizon&&this.legacyHorizonClipping===e.legacyHorizonClipping&&this.normalizeResultGeometry===e.normalizeResultGeometry}}}function Bx(e,t,n,r){return U(0),{}}function Vx(e,t,n,r){e&&t||R(`!inputSR || !outputSR`);let i=e.getLatestID(),a=t.getLatestID();if(i===3857&&a===4326){if(e.m_bDefaultDescriptor&&t.m_bDefaultDescriptor)return cS()}else if(i===4326&&a===3857&&e.m_bDefaultDescriptor&&t.m_bDefaultDescriptor)return lS();let o=G.constructEmpty();o.setCoords({env2D:n});let s=e.getCoordinateSystemType(),c=t.getCoordinateSystemType();if(s===0||c===0)return Hx(e,t);let l=e.getGCS().getLatestID(),u=t.getGCS().getLatestID();if(l>0&&l===u)return Hx(e,t);let d=new tS(e,t,n);{let e=rS(d);if(e)return e}let f=Rx(0,e,t,o,1,!0);return iS(d,Hx(e,t,f.length?f[0]:void 0))}function Hx(e,t,n,r,i){return new Kx(1,e,t,n,r,i)}function Ux(){return{flagsMask:0,setFlag(e,t){t?this.flagsMask|=e:this.flagsMask&=~e},hasFlag(e){return(this.flagsMask&e)!==0}}}function Wx(){return{m_extendedParams:zx(),m_extendedParamsInternal:Ux()}}function Gx(){return Wx()}var Kx=class e{constructor(e,t,n,r,i,a){let o,s;this.m_datumTran=null,this.m_bIdentity=!0,this.m_bIdentityGeogToGeog=!0,this.m_bVertical=!1,this.m_bNormalize=!1,t&&n||R(`!inputSR || !outputSR`),r&&r.getType()===0&&(r.m_bReadOnly=!0),this.m_bNormalize=!1,e!==1&&(o=t.getVCS(),s=n.getVCS(),this.m_bVertical=o!=null&&s!=null),this.m_inputSR=t,this.m_outputSR=n,this.m_bIdentity=!1,this.m_bIdentityGeogToGeog=!1,U(!this.m_params),i&&(this.m_params=Wx(),this.m_params.m_extendedParams=i),a&&(this.m_params||=Wx(),this.m_params.m_extendedParamsInternal=a);let c=!1,l=r!=null,u=t.getCoordinateSystemType(),d=n.getCoordinateSystemType();if(n.isPannable()&&u!==0&&i){let e=i.centralMeridianOfOutputGCS;if(!Number.isNaN(e)&&n.isPannable()){let t=n.getPannableExtent(),r=t.getCenterX();if(r!==e){let n=Math.ceil(t.width());e+n!==r+n&&(c=!0)}}}let f=i&&i.normalizeResultGeometry;if(t.equals(n))return this.m_bIdentity=!c,this.m_bIdentityGeogToGeog=!0,void this.updateProjector();this.m_bIdentity=!l&&t.equalForProjection(n,this.m_bVertical)&&!c,this.m_bIdentity?this.m_bIdentityGeogToGeog=!0:u!==0&&d!==0&&(f&&this.m_outputSR.isPannable()&&(this.m_bNormalize=f),this.m_datumTran=r||null,this.m_bIdentityGeogToGeog=(!this.m_datumTran||this.m_datumTran.count()===0)&&this.m_inputSR.getGCS().equalForProjection(this.m_outputSR.getGCS(),this.m_bVertical)),this.updateProjector()}getInputSR(){return this.m_inputSR}getOutputSR(){return this.m_outputSR}getDatumTransformation(){return this.m_datumTran}getInverse(){let t=new e(1,this.m_outputSR,this.m_inputSR,this.m_datumTran?.createInverse());return t.m_bIdentity=this.m_bIdentity,t.m_bVertical=this.m_bVertical,t.m_bIdentityGeogToGeog=this.m_bIdentityGeogToGeog,t.updateProjector(),t}isIdentity(){return this.m_bIdentity}getExtendedParams(){return this.m_params?this.m_params.m_extendedParams:Gx().m_extendedParams}equals(e){return U(0),!1}isVertical(){return this.m_bVertical}isMatchingTransformation(e,t){return U(0),!1}getGeographicTransformations(){return this.m_datumTran}getExtendedParamsImpl(){return this.m_params?this.m_params.m_extendedParams:Gx().m_extendedParams}getExtendedParamsInternal(){return this.m_params?this.m_params.m_extendedParamsInternal:Gx().m_extendedParamsInternal}isIdentityGeogToGeog(){return this.m_bIdentityGeogToGeog}normalizeOutput(){return this.m_bNormalize}updateProjector(){this.m_projector=new kv(this)}},qx=new Map,Jx=new Map,Yx=new Map;function Xx(e){let t=e.getCode();if(t>0)return gS(t)||hS(hC.coordsys(t));let n=e.getName();if(Jx.has(n)){let t=Jx.get(n);if(t&&t.deref()){let n=t.deref();if(n.m_peCoordSys.isEqual(e))return n}}return t=hC.getCode(e),hS(t>0?hC.coordsys(t):e)}function Zx(e){e<=0&&Te(e);{let t=gS(e);if(t)return t}let t=wC(hC.coordsys(e));t.get()||Te(e);let n=hS(t.release());return n.getLatestID()!==e&&qx.set(e,new WeakRef(n)),n}function Qx(e){let t=new Mx({},!0);return t.m_WKID=e,t}function $x(e){let t=wC(hC.fromString($.PE_TYPE_COORDSYS,e));return t.get()||pt(e),Xx(t.release())}function eS(e){Jx.delete(e.m_peCoordSys.getName()),Yx.delete(sb(e.m_peCoordSys,0,!1))}var tS=class{constructor(e,t,n){this.m_hashCode=-1,e&&(this.m_inputSR=e,this.m_outputSR=t,this.m_env=n.clone(),this.m_hashCode=this.m_inputSR.getHashCode(),this.m_hashCode=we(this.m_hashCode,this.m_outputSR.getHashCode()),this.m_env.isEmpty()||(this.m_hashCode=we(this.m_hashCode,Ae(this.m_env.xmin)),this.m_hashCode=we(this.m_hashCode,Ae(this.m_env.xmax)),this.m_hashCode=we(this.m_hashCode,Ae(this.m_env.ymin)),this.m_hashCode=we(this.m_hashCode,Ae(this.m_env.ymax))))}getHashCode(){return this.m_hashCode}equals(e){return!(this.m_inputSR&&!e.m_inputSR||!this.m_inputSR&&e.m_inputSR)&&this.m_env.equals(e.m_env)&&this.m_inputSR.equals(e.m_inputSR)&&this.m_outputSR.equals(e.m_outputSR)}clear(){this.m_inputSR=void 0,this.m_outputSR=void 0,this.m_hashCode=-1,this.m_env=void 0}},nS=new Map;function rS(e){if(nS.has(e.getHashCode()))return nS.get(e.getHashCode())}function iS(e,t){return nS.set(e.getHashCode(),t),t}var aS,oS,sS;function cS(){return aS||=Fx($S(),tC()),aS}function lS(){return oS||=cS().getInverse(),oS}function uS(){return sS||=hC.unit(9001),sS}function dS(e){return wC(hC.coordsys(e)).get()!==null}var fS=new Map;function pS(e){if(fS.has(e))return fS.get(e);{let t=dS(e);return fS.set(e,t),t}}function mS(e){return!1}function hS(e){let t=wC(e),n=e.getCode();if(n>0){let e=gS(n);if(e)return e}let r=e.getName(),i=Jx.get(r);if(i){let t=i.deref();if(t&&t.m_peCoordSys.isEqual(e))return t}let a=new jx(t.release());if(n>0)return a.setCached(),qx.set(n,new WeakRef(a)),Jx.set(r,new WeakRef(a)),a;let o=sb(e,0,!1);if(i=Yx.get(o),i){let e=i.deref();if(e)return e}return a.setCached(),Yx.set(o,new WeakRef(a)),a}function gS(e){let t=qx.get(e);if(t)return t.deref()}var _S=class extends sf{constructor(e){e===void 0?(super(),this.m_wkid=9001,this.m_peUnit=null):typeof e==`number`?(super(),this.m_factor=e,this.m_wkid=0):(super(e),e||(this.m_factor=1,this.m_wkid=9001,this.m_peUnit=uS()))}getUnitType(){return 0}convertFromMeters(e){return e/this.getUnitToBaseFactor()}convertToMeters(e){return e*this.getUnitToBaseFactor()}},vS=`0123456789bcdefghjkmnpqrstuvwxyz`.split(``);function yS(e,t,n){let r=H(t,`R`),i=0,a=0;for(let n=0;n<t;n++){let o=e[i]>>a&31;if(a+=5,a>31){let t=37-a;o&=(1<<t)-1,a-=32,i++,o|=(e[i]&(1<<a)-1)<<t}let s=vS[o];r[t-1-n]=s}return n>t?r.push(...`0`.repeat(n-t)):n<t&&(r.length=n),r.join(``)}function bS(e,t,n,r,i){U(r>>5<i.length);let a=t,o=n;for(let t=r;t>=0;t-=2){let n=31&t,r=.5*(o+a);e>=r?(i[t>>5]|=1<<n,a=r):o=r}}var xS=new Set,SS=2147483645n,CS=9007199254740990n,wS=`operation is not supported for unknown coordinate systems`,TS;function ES(){return{majorSemiAxis:0,e2:0,minorSemiAxis:0,flattening:0,isSphere(){return this.e2===0}}}function DS(e,t,n){e.majorSemiAxis=t,e.minorSemiAxis=t*(1-n),e.e2=n*(2-n),e.flattening=n}function OS(e){if(hC)return;OC(e);let t=xS;xS=null,t.forEach(e=>{let t=e.deref();t&&t.attachToPe()})}function kS(e){DC(e)}function AS(){return!!hC}function jS(){return!!TC}function MS(){return!!hC||!!TC}function NS(e,t,n){return U(MS()),oC(e,t===void 0?0:t,null,!1)}function PS(e,t){U(MS());let n=new ZS,r;return AS()?(r=$x(e),n.setHorzProj_(r),n.m_vertcs=null,n.m_userWKID=r.getLatestID()):(r=EC(e),n.m_unit=r.isPCS?new _S(r.metersOrRadiansPerUnit):new uf(r.metersOrRadiansPerUnit)),rC(n.m_precisionDescriptor,r,null,1),n.m_bDefaultDescriptor=!0,n.m_userWKT=e,n.calculateHashCode(),n.initDbgName(),n}function FS(e,t,n,r,i=!0){let a=null;return t&&(a=Ey(t,i)),IS(e,a,n,r,i)}function IS(e,t,n,r,i){e||R(`!PE_coord_sys`);let a=new ZS,o;return o=i?Xx(e):new jx(e,!1),rC(a.m_precisionDescriptor,o,t,r),a.m_bDefaultDescriptor=!0,a.setHorzProj_(o),a.m_vertcs=t,a.m_userWKID=o.getLatestID(),a.calculateHashCode(),a.initDbgName(),a}function LS(e,t,n=!1){e.getCoordinateSystemType()===3&&R(`image spatial reference cannot be altered`);let r=new ZS,i=e;return r.m_peCoordSysVal=i.m_peCoordSysVal,r.m_vertcs=i.m_vertcs,r.m_unit=i.m_unit,r.m_precisionDescriptor.assign(t),r.m_localZToXYFactor=i.m_localZToXYFactor,(Number.isNaN(r.m_precisionDescriptor.m_falseX)||Number.isNaN(r.m_precisionDescriptor.m_falseY))&&(r.m_precisionDescriptor.m_falseX=i.m_precisionDescriptor.m_falseX,r.m_precisionDescriptor.m_falseY=i.m_precisionDescriptor.m_falseY),r.m_precisionDescriptor.snapPrecision(),r.m_precisionDescriptor.fixTolerance(),r.m_userWKID=i.m_userWKID,r.m_precisionDescriptor.equals(i.m_precisionDescriptor)?r.m_bDefaultDescriptor=i.m_bDefaultDescriptor:r.m_bDefaultDescriptor=!1,n&&(r.m_bDefaultDescriptor=!0),r.calculateHashCode(),r.initDbgName(),r}function RS(e,t,n){return{}}function zS(e,t,n){t===void 0&&(t=1),(t<=0||!Number.isFinite(t))&&R(``),e||t===1||R(`null Unit has to have z_to_xy_factor equal to 1`);let r=new ZS;r.m_unit=e;let i=e||new _S(9001);return aC(r.m_precisionDescriptor,i,null,1),r.m_bDefaultDescriptor=!0,Number.isNaN(r.m_precisionDescriptor.m_falseX)&&R(`NAN false X/Y are not allowed here`),r.m_localZToXYFactor=t,r.calculateHashCode(),r.initDbgName(),r}function BS(e){let t=e.getCoordinateSystemType();return t===1?e:(t===3&&U(0),e.getGCS())}function VS(e){return U(MS()),jS()?AC(e):pS(e)}function HS(e){if(AS())return wC(hC.fromString($.PE_TYPE_COORDSYS,e)).get()!==null;try{return EC(e),!0}catch{}return!1}var US;function WS(){return US||=(()=>{let e=Math.trunc(Math.random()*Ve()),t=Date.now();return`|abba_000|${e.toString(16)}|${t.toString(16)}|`})(),US}(function(e){e[e.utmDefault=0]=`utmDefault`,e[e.utmNorthSouth=1]=`utmNorthSouth`})(TS||={});var GS,KS,qS,JS=0;function YS(e=``){let t=`${WS()}${JS++}`;return e!==``&&(t+=`|${e}`),t}function XS(e){return e.startsWith(WS())}var ZS=class e{destroy(){eS(this.m_peCoordSysVal),this.getCoordinateSystemType()===1||this.getCoordinateSystemType()===2?this.getPECoordSys().destroy():B(`SpatialReference.destroy`)}constructor(){this.m_vertcs=null,this.m_peCoordSysVal=null,this.m_userWKID=0,this.m_userWKT=null,this.m_geogSpatialReference=null,this.m_srToGcs=null,this.m_gcsToSr=null,this.m_defaultPrecisionSR=null,this.m_localZToXYFactor=-1,this.m_precisionDescriptor=new QS,this.m_hashCode=0,this.m_bDefaultDescriptor=!1,nC(this.m_precisionDescriptor),xS&&xS.add(new WeakRef(this))}attachToPe(){(this.m_userWKID>0?NS(this.m_userWKID):PS(this.m_userWKT)).copyTo(this,!1)}copyTo(e,t=!0){(t||e.m_bDefaultDescriptor)&&(e.m_bDefaultDescriptor=this.m_bDefaultDescriptor,e.m_precisionDescriptor.assign(this.m_precisionDescriptor)),e.m_defaultPrecisionSR=null,e.m_gcsToSr=this.m_gcsToSr,e.m_geogSpatialReference=this.m_geogSpatialReference,e.m_hashCode=this.m_hashCode,e.m_localZToXYFactor=this.m_localZToXYFactor,e.m_peCoordSysVal=this.m_peCoordSysVal,e.m_srToGcs=this.m_srToGcs,e.m_userWKID=this.m_userWKID,e.m_userWKT=this.m_userWKT,e.m_vertcs=this.m_vertcs,e.m_unit=this.m_unit}getHashCode(){return this.m_hashCode}getHashCodeHorizontal(){let e=0;return e=this.m_peCoordSysVal?this.m_peCoordSysVal.getHashCode():this.m_unit?this.m_unit.getHashCode():305419891,e}updateTransform(e){if(this.getCoordinateSystemType()===1)return Fx(this,this,null);let t=e?this.m_srToGcs:this.m_gcsToSr;if(t)return t;let n=this.getGCS(),r=this;t=e?Fx(r,n,null):Fx(n,r,null);let i=t;return(e?this.m_srToGcs:this.m_gcsToSr)||(e?this.m_srToGcs=i:this.m_gcsToSr=i,t)}getHashCodeVertical(){return this.m_vertcs?this.m_vertcs.getHashCode():0}calculateHashCode(){let e=this.getHashCodeHorizontal(),t=this.getHashCodeVertical(),n=this.m_precisionDescriptor.getHashCode();e=we(e,t),this.m_hashCode=we(e,n)}initDbgName(){}setHorzProj_(e){this.m_peCoordSysVal=e,this.m_unit=this.m_peCoordSysVal.getUnit()}getTolerance(e=0){return this.m_precisionDescriptor.getTolerance(e)}getResolution(e=0){return this.m_precisionDescriptor.getResolution(e)}getPECoordSys(){return this.m_peCoordSysVal?this.m_peCoordSysVal.m_peCoordSys:null}getPCSInfo(){return this.throwIfNotGCSOrPCS(),U(this.m_peCoordSysVal),this.m_peCoordSysVal.getPCSInfo()}getCentralMeridian(){return this.throwIfNotGCSOrPCS(),this.getCoordinateSystemType()===1?0:this.getPCSInfo().getCentralMeridian()}getCoordinateSystemType(){let e=this.getPECoordSys();if(e)switch(e.getType()){case $.PE_TYPE_GEOGCS:return 1;case $.PE_TYPE_PROJCS:return 2;default:return 0}else{if((this.m_userWKID>0||this.m_userWKT)&&this.m_unit instanceof _S)return 2;if(this.m_unit instanceof uf)return 1}return 0}getID(){return this.m_userWKID}getLatestID(){return this.m_peCoordSysVal?this.m_peCoordSysVal.getLatestID():this.m_userWKID}getOldID(){return this.m_peCoordSysVal?this.m_peCoordSysVal.getOldID():this.m_userWKID}getVerticalID(){return xt(`vcs not implemented`),0}getLatestVerticalID(){return this.m_vertcs?this.m_vertcs.getLatestID():0}getOldVerticalID(){return xt(`vcs not implemented`),0}getPEVerticalCoordSys(){return null}getPole(e){return this.throwIfNotGCSOrPCS(),U(this.m_peCoordSysVal),this.m_peCoordSysVal.getPole(e)}getText(){let e=this.getPECoordSys();return e?lb(e):this.m_userWKT??``}getTextExtended(e){let t=this.getPECoordSys();return t?this.getPEVerticalCoordSys()?cb(null,t,this.getPEVerticalCoordSys()):lb(t,e):this.m_userWKT??``}getText2(e=-1){let t=this.getPECoordSys();return t?ub(t,e):this.m_userWKT??``}getUnit(){return this.m_unit}getUnitsPerMillimeter(){return this.m_peCoordSysVal?this.m_peCoordSysVal.getUnitsPerMillimeter():this.m_unit instanceof _S?.001/this.m_unit.getUnitToBaseFactor():this.m_unit instanceof uf?.001/(EC(this.m_userWKT??this.m_userWKID).semiMajor*this.m_unit.getUnitToBaseFactor()):(ge(`sr object not in valid state`),0)}getAuthorityName(){return this.getPECoordSys()?db():``}getVerticalUnit(){return xt(`vcs not implemented`),{}}getVCS(){return this.m_vertcs}hasVCS(){return!1}getGCSHorisonIsInclusive(){return this.throwIfNotGCSOrPCS(),U(this.m_peCoordSysVal),this.m_peCoordSysVal.getGCSHorisonIsInclusive()}getGCSHorizon(){return this.throwIfNotGCSOrPCS(),U(this.m_peCoordSysVal),this.m_peCoordSysVal.getGCSHorizon()}getGCS(){let e=this.getCoordinateSystemType();if(e===0)ge(wS);else{if(e===1)return this;e===3&&ge(`image cs not supported`)}if(this.m_geogSpatialReference)return this.m_geogSpatialReference;let t;if(this===$S()||this===eC())t=tC();else{U(this.m_peCoordSysVal);let e=this.m_peCoordSysVal.m_peCoordSys.getGeogcs();e||B(``),t=FS(e,this.m_vertcs,null,this.m_precisionDescriptor.getPrecision(),this.m_peCoordSysVal.getCached())}return this.m_geogSpatialReference?t=this.m_geogSpatialReference:this.m_geogSpatialReference=t,t}getGCSSplitLines(){return this.throwIfNotGCSOrPCS(),U(this.m_peCoordSysVal),this.m_peCoordSysVal.getGCSSplitLines()}toGCS(e,t){if(e.length===0)return 0;e.length>t.length&&R(`coordsSrc.size() > coordsDst.size()`);let n=this.getCoordinateSystemType();if(n===0&&ge(wS),n===1)return De(t,e,e.length),e.length;U(this.m_peCoordSysVal);let r=this.getSRToGCSTransform();return new Mv().transform(r,e,e.length,t)}toGeohash(e,t=8){let n=e.clone();n.scale(this.getGCS().getUnit().getID()===9102?1:this.getGCS().getUnit().getUnitToBaseFactor()/Math.PI*180),n.x<-180?(n.x=We(n.x,360),n.x<-180&&(n.x+=360)):n.x>180&&(n.x=We(n.x,360),n.x>180&&(n.x-=360)),n.y>90&&(n.y=90),n.y<-90&&(n.y=-90);let r=5*t,i=new Uint32Array(4);return bS(n.x,-180,180,r-1,i),bS(n.y,-90,90,r-2,i),yS(i,t,t)}isPannable(){let e=this.getCoordinateSystemType();return e!==0&&e!==3&&(U(this.m_peCoordSysVal),this.m_peCoordSysVal.isPannable())}getPannableExtent(){return this.isPannable()||R(`!is_pannable`),U(this.m_peCoordSysVal),this.m_peCoordSysVal.getPannableExtent()}getPannableExtentInGCS(){return this.isPannable()||R(`!is_pannable`),U(this.m_peCoordSysVal),this.m_peCoordSysVal.getPannableExtentGCS()}throwIfNotGCSOrPCS(){let e=this.getCoordinateSystemType();e!==1&&e!==2&&R(`Not a GCS or PCS`)}getDomainXY(){return this.throwIfNotGCSOrPCS(),U(this.m_peCoordSysVal),this.m_peCoordSysVal.getDomainXY()}getFullWorldExtent(){return this.throwIfNotGCSOrPCS(),this.isPannable()?this.getPannableExtent():this.getDomainXY()}queryPrecisionDescriptor(e){if(e.assign(this.m_precisionDescriptor),Number.isNaN(e.m_falseX))if(AS()||a(`cannot query precision descriptor`),U(this.m_peCoordSysVal!==null),this.m_precisionDescriptor.m_precision!==2){let t=this.m_peCoordSysVal.getDomainXY();e.m_falseX=t.xmin,e.m_falseY=t.ymin}else e.m_falseX=-Number.MAX_VALUE,e.m_falseY=-Number.MAX_VALUE}queryPrecisionDescriptorWithoutFalseXY(e){e.assign(this.m_precisionDescriptor),e.m_falseX=NaN,e.m_falseY=NaN}queryDefaultPrecisionDescriptorWithoutFalseXY(e){if(this.m_bDefaultDescriptor)e.assign(this.m_precisionDescriptor);else{let t=this.getCoordinateSystemType();t===0?aC(e,this.m_unit,this.m_vertcs,this.m_precisionDescriptor.getPrecision()):t===3?xt(`image cs`):rC(e,this.m_peCoordSysVal,this.m_vertcs,this.m_precisionDescriptor.getPrecision())}e.m_falseX=NaN,e.m_falseY=NaN}horizontalEqual(e){return kx(this.m_peCoordSysVal,e.m_peCoordSysVal)}verticalEqual(e){return this.m_vertcs!==null==(e.m_vertcs!==null)&&(!this.m_vertcs||this.m_vertcs.equals(e.m_vertcs))}equals(e){let t=e;if(this===t)return!0;if(!this.horizontalEqual(t)||!this.verticalEqual(t)||!t.m_peCoordSysVal&&(U(!this.m_peCoordSysVal),this.m_unit!==null!=(t.m_unit!==null)||this.m_unit&&!this.m_unit.equals(t.m_unit)||this.m_localZToXYFactor!==t.m_localZToXYFactor))return!1;if(!this.m_bDefaultDescriptor||!t.m_bDefaultDescriptor){if(this.m_peCoordSysVal){if(!this.m_precisionDescriptor.equalsWithoutFalseXY(t.m_precisionDescriptor))return!1;U(t.m_peCoordSysVal);let e=this.m_precisionDescriptor.m_falseX,n=this.m_precisionDescriptor.m_falseY;if(Number.isNaN(e)){let t=this.m_peCoordSysVal.getDomainXY();e=t.xmin,n=t.ymin}let r=t.m_precisionDescriptor.m_falseX,i=t.m_precisionDescriptor.m_falseY;if(Number.isNaN(r)){let e=t.m_peCoordSysVal.getDomainXY();r=e.xmin,i=e.ymin}return e===r&&n===i}return this.m_precisionDescriptor.equals(t.m_precisionDescriptor)}return!0}equalForProjection(e,t){if(this===e)return!0;let n=this.getCoordinateSystemType(),r=e.getCoordinateSystemType();if(n===0||r===0)return n===0&&r===0?(!t||this.getZToXYFactor()===e.getZToXYFactor())&&(!this.getUnit()||!e.getUnit()||this.getUnit().equals(e.getUnit())):n!==3&&r!==3&&(this.getUnit()===null||e.getUnit()===null||(!t||this.getZToXYFactor()===e.getZToXYFactor())&&this.getUnit().equals(e.getUnit()));if(n!==r)return!1;if(n===3)return this.equals(e);if(Ax(this.m_peCoordSysVal,e.m_peCoordSysVal)){if(!t)return!0;if(this.m_vertcs!==null==(e.m_vertcs!==null))return!this.m_vertcs||this.m_vertcs.equalForProjection(e.m_vertcs)}return!1}equalHorizontal(e){return this.horizontalEqual(e)}equalVertical(e){return U(0),!1}equalVerticalVCS(e){return U(0),!1}convergenceAngle(e){return U(0),0}getPeCoordsysCopy(){if(this.m_peCoordSysVal){let e=this.m_peCoordSysVal.m_peCoordSys;return e||B(`cannot clone coord sys`),e}return null}getPeVertcsCopy(){return U(0),0}throwIfLocal(){this.getCoordinateSystemType()===0&&R(wS)}getPrimeMeridian(){return this.throwIfLocal(),U(this.m_peCoordSysVal),this.m_peCoordSysVal.getPrimeMeridian()}getSRToGCSTransform(){return this.updateTransform(!0)}getGCSToSRTransform(){return this.updateTransform(!1)}getOneMeter(){return 1e3*this.getUnitsPerMillimeter()}getOneMeterPCSUnit(){return this.throwIfNotGCSOrPCS(),U(this.m_peCoordSysVal),this.m_peCoordSysVal.getOneMeterPCSUnit()}getDefaultPrecisionSR(){if(this.m_bDefaultDescriptor)return this;if(this.m_defaultPrecisionSR===null){let e=new QS;this.queryDefaultPrecisionDescriptorWithoutFalseXY(e),this.m_defaultPrecisionSR=LS(this,e,!0)}return this.m_defaultPrecisionSR}getPCSHorizon(){return this.throwIfNotGCSOrPCS(),U(this.m_peCoordSysVal),this.m_peCoordSysVal.getPCSHorizon()}getHorzUnitFactor(){return this.m_unit?this.m_unit.getUnitToBaseFactor():1}querySpheroidData(e){this.throwIfNotGCSOrPCS(),U(this.m_peCoordSysVal);let t=this.getGCS().getPECoordSys().getDatum().getSpheroid(),n=t.getFlattening();DS(e,t.getAxis(),n)}getAreaOfUse(){this.getCoordinateSystemType()===0&&ge(``),U(this.m_peCoordSysVal);let e=this.m_peCoordSysVal.getAreaOfUse();return e===null?new af:new af({geom:e.clone(),sr:NS(4326)})}getZToXYFactor(){return 1}isCustomWkid(){return!1}getOneDegreeGCSUnit(){return this.throwIfNotGCSOrPCS(),U(this.m_peCoordSysVal),this.m_peCoordSysVal.getOneDegreeGCSUnit()}getGcsUnitFactor(){return this.throwIfNotGCSOrPCS(),U(this.m_peCoordSysVal),this.m_peCoordSysVal.getGcsUnitFactor()}snapGeometry(e){if(e.isEmpty()||this.m_precisionDescriptor.getPrecision()===2)return!1;let t=e.getGeometryType();if(d(t))return this.snapMultiVertex_(e);if(t===L.enumPoint)return this.snapPoint_(e);if(t===L.enumEnvelope)return this.snapEnvelope_(e);if(Ne(t))return this.snapSegment_(e);if(t===L.enumGeometryCollection){let t=e,n=!1;for(let e=0,r=t.getGeometryCount();e<r;++e)n=this.snapGeometry(t.getGeometry(e))||n;return n}B(`what else?`)}snapMultiVertex_(e){if(U(!e.isEmpty()),U(this.m_precisionDescriptor.getPrecision()!==2),V(e.getGeometryType())){let t=e;if(t.hasNonLinearSegments())return this.snapGeometryWithCurves_(t)}let t=e.getImpl(),n=t.getDescription(),r=!1;for(let e=0,i=n.getAttributeCount();e<i;e++){let i=n.getSemantics(e),a=t.getAttributeStreamRef(i);r=this.snapAttributes(i,a,0,t.getPointCount())||r}return r&&t.notifyModifiedFlags(2001),r}snapPoint_(e){return!1}snapEnvelope_(e){return!1}snapSegment_(e){U(!e.isEmpty()),U(this.m_precisionDescriptor.getPrecision()!==2);let t=new QS;this.queryPrecisionDescriptor(t);let n=e.getStartXY(),r=new z;r.x=sC(n.x,t.getFalseX(),t.getGridUnitsXY()),r.y=sC(n.y,t.getFalseY(),t.getGridUnitsXY());let i=!r.equals(n),a=e.getEndXY(),o=new z;o.x=sC(a.x,t.getFalseX(),t.getGridUnitsXY()),o.y=sC(a.y,t.getFalseY(),t.getGridUnitsXY()),i||=!o.equals(a),i&&e.changeEndPoints2D(r,o);let s=(t,n,r)=>{let i=!1;{let a=e.getStartAttributeAsDbl(t,0),o=sC(a,n,r),s=!te(o,a);i||=s,s&&e.setStartAttribute(t,0,o)}{let a=e.getEndAttributeAsDbl(t,0),o=sC(a,n,r),s=!te(o,a);i||=s,s&&e.setEndAttribute(t,0,o)}return i},c=i?1:0;return e.hasAttribute(1)&&(c|=s(1,t.getFalseZ(),t.getGridUnitsZ())?1:0),e.hasAttribute(2)&&(c|=s(2,t.getFalseM(),t.getGridUnitsM())?1:0),!!c}snapGeometryWithCurves_(e){U(!e.isEmpty()),U(this.m_precisionDescriptor.getPrecision()!==2);let t=e.createInstance(),n=new Q,r=0;for(let i=0,a=e.getPathCount();i<a;++i){let a=e.getSegmentCountPath(i);if(a===0){if(t.addPath(e,i,!0),t.getPathSize(i)===1){let e=new q;t.getPointByVal(t.getPointCount()-1,e),r|=this.snapGeometry(e)?1:0,t.setPointByVal(t.getPointCount()-1,e)}continue}let o=e.isClosedPath(i);for(let s=0,c=o?a-1:a;s<c;++s)e.getSegmentFromPath(i,s,n,!1),r|=this.snapGeometry(n.get())?1:0,t.addSegment(n.get(),s===0);o&&(e.getSegmentFromPath(i,a-1,n,!1),r|=this.snapGeometry(n.get())?1:0,a===1?t.addPathFromClosedSegment(n.get(),!1):t.closeLastPathWithSegment(n.get()))}return r&&t.copyTo(e),!!r}snapAttributes(t,n,r,i){let a=!1,o=new QS;if(this.queryPrecisionDescriptor(o),t===0){let t=n;for(let n=r;n<i;n++){let r=t.read(2*n),i=e.s_SnapValue(r,o.getFalseX(),o.getGridUnitsXY()),s=t.read(2*n+1),c=e.s_SnapValue(s,o.getFalseY(),o.getGridUnitsXY());a=a||i!==r||c!==s,a&&(t.write(2*n,i),t.write(2*n+1,c))}}else if(t===1){let t=n;for(let n=r;n<i;n++){let r=t.read(n),i=e.s_SnapValue(r,o.getFalseZ(),o.getGridUnitsZ());a||=!te(i,r),a&&t.write(n,i)}}else if(t===2){let t=n;for(let n=r;n<i;n++){let r=t.read(n),i=e.s_SnapValue(r,o.getFalseM(),o.getGridUnitsM());a||=!te(i,r),a&&t.write(n,i)}}return a}static s_SnapValue(e,t,n){return y((e-t)*n)/n+t}},QS=class e{constructor(){let e=CS,t=1e-4,n=.001,r=t*Number(e)*.5;this.m_precision=1,this.m_falseX=-r,this.m_falseY=-r,this.m_unitsXY=Number(e)/(2*r),this.m_falseM=-1e5,this.m_unitsM=1/t,this.m_falseZ=-1e5,this.m_unitsZ=1/t,this.m_toleranceXY=n,this.m_toleranceM=n,this.m_toleranceZ=n}getHashCode(){let e=7777,t=7777;return t=we(t,this.m_falseM),t=we(t,this.m_unitsM),e=we(e,this.m_unitsXY),t=we(t,this.m_toleranceXY),e=we(e,this.m_falseZ),t=we(t,this.m_toleranceZ),e=we(e,this.m_unitsZ),t=we(t,this.m_toleranceM),e=we(e,this.m_precision),we(e,t)}clone(){let t=new e;return t.m_falseX=this.m_falseX,t.m_falseY=this.m_falseY,t.m_unitsXY=this.m_unitsXY,t.m_falseZ=this.m_falseZ,t.m_unitsZ=this.m_unitsZ,t.m_falseM=this.m_falseM,t.m_unitsM=this.m_unitsM,t.m_toleranceXY=this.m_toleranceXY,t.m_toleranceZ=this.m_toleranceZ,t.m_toleranceM=this.m_toleranceM,t.m_precision=this.m_precision,t}assign(e){return this.m_falseX=e.m_falseX,this.m_falseY=e.m_falseY,this.m_unitsXY=e.m_unitsXY,this.m_falseZ=e.m_falseZ,this.m_unitsZ=e.m_unitsZ,this.m_falseM=e.m_falseM,this.m_unitsM=e.m_unitsM,this.m_toleranceXY=e.m_toleranceXY,this.m_toleranceZ=e.m_toleranceZ,this.m_toleranceM=e.m_toleranceM,this.m_precision=e.m_precision,this}initialize2D(e,t){}getTolerance(e){switch(e){case 0:return this.m_toleranceXY;case 1:return this.m_toleranceZ;case 2:return this.m_toleranceM;default:return 0}}getResolution(e){if(this.m_precision===2)return 0;switch(e){case 0:return 1/this.m_unitsXY;case 1:return 1/this.m_unitsZ;case 2:return 1/this.m_unitsM;default:return 0}}getFalseX(){return this.m_falseX}getFalseY(){return this.m_falseY}getFalseZ(){return this.m_falseZ}getFalseM(){return this.m_falseM}getGridUnitsXY(){return this.m_unitsXY}getGridUnitsZ(){return this.m_unitsZ}getGridUnitsM(){return this.m_unitsM}getPrecision(){return this.m_precision}static getLimit32(){return 2147483645}static getLimit64(){return 9007199254740990n}static getLimitFloat(){return 0}getXYGridRange(){let t=new G;switch(this.m_precision){case 0:{let n=e.getLimit32()/this.getGridUnitsXY();t.setCoords({xmin:this.getFalseX(),ymin:this.getFalseY(),xmax:this.getFalseX()+n,ymax:this.getFalseY()+n})}break;case 1:{let n=Number(e.getLimit64())/this.getGridUnitsXY();t.setCoords({xmin:this.getFalseX(),ymin:this.getFalseY(),xmax:this.getFalseX()+n,ymax:this.getFalseY()+n})}break;case 2:t.setCoords({xmin:-Number.MAX_VALUE,ymin:-Number.MAX_VALUE,xmax:Number.MAX_VALUE,ymax:Number.MAX_VALUE});break;default:t.setEmpty(),B(``)}return t}getZGridRange(){let t=new I;switch(this.m_precision){case 0:{let n=e.getLimit32()/this.getGridUnitsZ();t.setCoords(this.getFalseZ(),this.getFalseZ()+n)}break;case 1:{let n=Number(e.getLimit64())/this.getGridUnitsZ();t.setCoords(this.getFalseZ(),this.getFalseZ()+n)}break;case 2:t.setCoords(-Number.MAX_VALUE,Number.MAX_VALUE);break;default:t.setEmpty(),B(``)}return t}getMGridRange(){let t=new I;switch(this.m_precision){case 0:{let n=e.getLimit32()/this.getGridUnitsM();t.setCoords(this.getFalseM(),this.getFalseM()+n)}break;case 1:{let n=Number(e.getLimit64())/this.getGridUnitsM();t.setCoords(this.getFalseM(),this.getFalseM()+n)}break;case 2:t.setCoords(-Number.MAX_VALUE,Number.MAX_VALUE);break;default:t.setEmpty(),B(``)}return t}setTolerance(e,t){switch(t<0&&R(`tol < 0`),Number.isFinite(t)||R(`tol is not finite`),e){case 0:this.m_toleranceXY=t;break;case 1:this.m_toleranceZ=t;break;case 2:this.m_toleranceM=t;break;default:R(`cannot set tolerance for this attribute`)}}setGridParams(e,t,n){Number.isFinite(e)&&Number.isFinite(t)&&Number.isFinite(n)||R(`grid params are not finite`),n<1&&R(`grid units cannot be smaller than 1.0`),this.m_falseX=e,this.m_falseY=t,this.m_unitsXY=n}setZParams(e,t){Number.isFinite(e)&&Number.isFinite(t)||R(`grid params are not finite`),t<1&&R(`grid units cannot be smaller than 1.0`),this.m_falseZ=e,this.m_unitsZ=t}setMParams(e,t){Number.isFinite(e)&&Number.isFinite(t)||R(`grid params are not finite`),t<1&&R(`grid units cannot be smaller than 1.0`),this.m_falseM=e,this.m_unitsM=t}setPrecision(e){}equals(e){return this===e||te(this.m_falseX,e.m_falseX)&&te(this.m_falseY,e.m_falseY)&&this.equalsWithoutFalseXY(e)}snapPrecision(){if(this.m_precision===2)return;let e=(e,t,n,r)=>{if(!Number.isFinite(t)||!Number.isFinite(n))return n;if(n<1)return 1;if(!r)return n;let i=Number(e)/n;return Math.trunc((t+i-t)*n)>e&&(n=e/(t+i-t)),Math.max(1,n)},t=Number(this.m_precision===0?SS:CS);this.m_unitsXY=e(t,this.m_falseX,this.m_unitsXY,!0),this.m_unitsXY=e(t,this.m_falseY,this.m_unitsXY,!0),this.m_unitsZ=e(t,this.m_falseZ,this.m_unitsZ,!1),this.m_unitsM=e(t,this.m_falseM,this.m_unitsM,!1)}verifyPrecision(){if(this.m_precision===2)return!0;let e=(e,t,n,r)=>{if(n<1||!Number.isFinite(t)||!Number.isFinite(n))return!1;if(!r)return!0;let i=Number(e)/n;return!(BigInt((t+i-t)*n)>e)},t=this.m_precision===0?SS:CS;return!!e(t,this.m_falseX,this.m_unitsXY,!0)&&!!e(t,this.m_falseY,this.m_unitsXY,!0)&&!!e(t,this.m_falseZ,this.m_unitsZ,!1)&&!!e(t,this.m_falseM,this.m_unitsM,!1)}fixTolerance(){this.m_precision!==2&&(this.m_toleranceXY=Math.max(2/this.m_unitsXY,this.m_toleranceXY),this.m_toleranceZ=Math.max(2/this.m_unitsZ,this.m_toleranceZ),this.m_toleranceM=Math.max(2/this.m_unitsM,this.m_toleranceM),(Number.isNaN(this.m_falseX)||Number.isNaN(this.m_falseY))&&(this.m_falseX=this.m_falseY=NaN))}equalsWithoutFalseXY(e){return this===e||this.m_unitsXY===e.m_unitsXY&&this.m_falseZ===e.m_falseZ&&this.m_unitsZ===e.m_unitsZ&&this.m_falseM===e.m_falseM&&this.m_unitsM===e.m_unitsM&&this.m_toleranceXY===e.m_toleranceXY&&this.m_toleranceZ===e.m_toleranceZ&&this.m_toleranceM===e.m_toleranceM&&this.m_precision===e.m_precision}setBestXyDomainFromEnvelope(e,t){}setBestZDomainFromZRange(e,t,n){}setBestMDomainFromMRange(e,t,n){}};function $S(){return(!GS||AS()&&GS.getPECoordSys()===null)&&(GS=oC(3857,0,null,!0)),GS}function eC(){return(!KS||AS()&&KS.getPECoordSys()===null)&&(KS=oC(102100,0,null,!0)),KS}function tC(){return(!qS||AS()&&qS.getPECoordSys()===null)&&(qS=oC(4326,0,null,!0)),qS}function nC(e){e.m_falseX=0,e.m_falseY=0,e.m_unitsXY=1,e.m_falseZ=0,e.m_unitsZ=1,e.m_falseM=0,e.m_unitsM=1,e.m_toleranceXY=100*fe(),e.m_toleranceZ=100*fe(),e.m_toleranceM=100*fe(),e.m_precision=2}function rC(e,t,n,r){let i=t instanceof jx;nC(e),e.m_precision=r,e.m_falseX=NaN,e.m_falseY=NaN;let a=1e-4,o=.001,s=i?t.m_csType:t.isPCS?2:1;s===1?e.m_unitsXY=1/((r===0?1/18e5:1e-9)*(i?t.getOneDegreeGCSUnit():Math.PI/t.metersOrRadiansPerUnit/180)):s===2?e.m_unitsXY=1/((r===0?o:a)*(i?t.getOneMeterPCSUnit():1/t.metersOrRadiansPerUnit)):R(`unrecognized cs type`),e.m_falseM=-1e5,e.m_unitsM=1/(r===0?o:a),e.m_unitsM=Math.max(1,e.m_unitsM),e.m_unitsXY=Math.max(1,e.m_unitsXY);let c=0,l=0;r!==0&&r!==1||(c=2/e.m_unitsXY,l=2/e.m_unitsM),e.m_toleranceXY=Math.max(c,i?t.getUnitsPerMillimeter():s===2?.001/t.metersOrRadiansPerUnit:.001/(t.semiMajor*t.metersOrRadiansPerUnit)),e.m_toleranceM=Math.max(o,l),iC(e,n)}function iC(e,t){let n=1e-4,r=.001;e.m_falseZ=-1e5,t?e.m_unitsZ=1/((e.m_precision===0?r:n)*t.getOneMeter()):e.m_unitsZ=1/(e.m_precision===0?r:n),e.m_unitsZ=Math.max(1,e.m_unitsZ);let i=0;e.m_precision!==0&&e.m_precision!==1||(i=2/e.m_unitsZ),e.m_toleranceZ=Math.max(t?t.getOneMeter()*r:r,i)}function aC(e,t,n,r){nC(e),e.m_precision=r;let i=r===0?SS:CS,a=1e-4,o=.001,s=1,c=1,l=.001;t&&(c=t.getUnitToBaseFactor()),t&&t.getUnitType()===1?(s=400*Math.PI/180,l=8.983152841195215e-9*Math.PI/180/c):(s=(r===0?o:a)*Number(i)*.5,l=o/c),s/=c,e.m_falseX=-s,e.m_falseY=-s,e.m_unitsXY=Number(i)/(2*s),e.m_falseM=-1e5,e.m_unitsM=1/(r===0?o:a),e.m_unitsM=Math.max(1,e.m_unitsM),e.snapPrecision();let u=0,d=0;e.m_precision!==0&&e.m_precision!==1||(d=2/e.m_unitsM,u=2/e.m_unitsXY),e.m_toleranceXY=Math.max(u,l),e.m_toleranceM=Math.max(o,d),iC(e,n)}function oC(e,t,n,r){if(!r&&t<=0){if(e===3857)return $S();if(e===102100)return eC();if(e===4326)return tC()}let i=new ZS,a,o=null;return AS()?(a=Zx(e),t>0?o=null:t=0,i.setHorzProj_(a),i.m_vertcs=o):(a=EC(e),i.m_unit=a.isPCS?new _S(a.metersOrRadiansPerUnit):new uf(a.metersOrRadiansPerUnit)),rC(i.m_precisionDescriptor,a,o,1),i.m_bDefaultDescriptor=!0,i.m_userWKID=e,i.calculateHashCode(),i.initDbgName(),i}function sC(e,t,n){return y((e-t)*n)/n+t}var cC=null,lC=3552713678800501e-30;function uC(e,t,n){return e===t||Math.abs(e-t)<=n*(1+(Math.abs(e)+Math.abs(t))/2)}function dC(e,t){return uC(e,t,lC)}function fC(e,t){return e===0||Math.abs(e)<=t}function pC(e){return fC(e,lC)}var mC,hC,$,gC,_C,vC,yC,bC,xC,SC,CC;function wC(e){return{_this:e,get(){return this._this},reset(e){this._this=e},release(){let e=this._this;return this._this=null,e}}}var TC=null;function EC(e){U(TC);let t=TC(e);return t.semiMajor=t.isPCS?NaN:NC(e),t}function DC(e){TC=e,U(TC)}function OC(e){let t=e;hC=t.PeFactory,U(hC),CC=t.PeGCSExtent,U(CC),xC=t.PeLineType,U(xC),SC=t.PeMath,U(SC),mC=t.PeDouble,U(mC),$=t.PeDefs,U($),gC=t.PeCSTransformations,U(gC),_C=t.PeGTTransformations,U(_C),vC=t.PePCSInfo,U(vC),yC=t.PeGTlistExtended,U(yC),hC.initialize(),bC=t.PeGTlistExtendedEntry,U(bC),$.PE_TYPE_ANGUNIT=512,$.PE_STR_AUTH_ALL=2,vC.PE_POLE_LINE_STRAIGHT=2,vC.PE_POLE_LINE_CURVED=3,$.PE_PARM_LAM0=2,$.PE_PARM_PHI0=6,$.PE_PRJ_AZIMUTHAL_EQUIDISTANT=43032,$.PE_PRJ_LAMBERT_AZIMUTHAL_EQAREA=43033,$.PE_PRJ_ALBERS=43007,$.PE_PRJ_CYLINDRICAL_EQAREA=43034,$.PE_TYPE_VERTCS=8,$.PE_LINETYPE_GEODESIC=0,$.PE_LINETYPE_LOXODROME=1,$.PE_LINETYPE_GREAT_ELLIPTIC=2,$.PE_LINETYPE_NORMAL_SECTION=3,yC.PE_GTLIST_OPTS_USABLE=1,TC=null}function kC(e,t,n,r){return t<=0?(n[0]=0,r[0]=0,!1):(n[0]=t,r[0]=t,!0)}function AC(e){return U(jS()),!!TC(e).isPCS||jC(e)}function jC(e){return hC&&ge(`pe has been loaded. no-pe methods should not be used at this point.`),cC||PC(),cC.has(e)}var MC=/(?:ELLIPSOID|SPHEROID)\["(?:\w|[-()])+",(\d+\.\d+)/;function NC(e){if(hC&&ge(`pe has been loaded. no-pe methods should not be used at this point.`),typeof e==`string`){let t=e.match(MC);t&&t.length===2||R(`bad gcs wkt`);let n=Number.parseFloat(t[1]);return Number.isFinite(n)||R(`bad gcs wkt`),n}return cC||PC(),cC.has(e)||ge(`gcs wkid not found`),cC.get(e)}function PC(){for(let e in cC=new Map,cf){let t=Number.parseFloat(e),n=cf[e];if(Array.isArray(n))for(let e of n)cC.set(e,t);else cC.set(n,t)}lf()}function FC(e,t){let n=hC.geogtran(e);return n||Te(e),new BC(n,t)}function IC(e,t){let n=hC.fromString($.PE_TYPE_GEOGTRAN,e);return n||pt(e),new BC(n,t)}function LC(e,t){return new BC(e,t)}var RC=je(0),zC=je(1),BC=class e{constructor(t,n){if(t instanceof e)return this.m_geogTranWrapper=t.m_geogTranWrapper,this.m_bInverted=n?!t.m_bInverted:t.m_bInverted,void(this.m_hashCode=we(this.m_geogTranWrapper.getHashCode(),this.m_bInverted?zC:RC));this.m_geogTranWrapper=new jy(t),this.m_bInverted=n,this.m_hashCode=we(this.m_geogTranWrapper.getHashCode(),this.m_bInverted?zC:RC)}getID(){return this.m_geogTranWrapper.getLatestId()}getLatestID(){return this.m_geogTranWrapper.getLatestId()}getText(){return this.m_geogTranWrapper.getText()}getTextExtended(e){if(!this.m_geogTranWrapper.getGeogtran())return``;if(e===-1)return this.m_geogTranWrapper.getGeogtran().toString();{let t=e===0?$.PE_STR_AUTH_TOP:$.PE_STR_AUTH_ALL;return this.m_geogTranWrapper.getGeogtran().toString(t)}}getText2(e=-1){let t=$.PE_STR_FMT_WKT2;return e!==-1&&(t|=e===0?$.PE_STR_AUTH_TOP:$.PE_STR_AUTH_ALL),this.m_geogTranWrapper.getGeogtran().toString(t)}getName(){return this.m_geogTranWrapper&&this.m_geogTranWrapper.getGeogtran()?this.m_geogTranWrapper.getGeogtran().getName():``}getInputSpatialReference(){return this.m_bInverted?this.m_geogTranWrapper.getOutputSr(!1):this.m_geogTranWrapper.getInputSr(!1)}getOutputSpatialReference(){return this.m_bInverted?this.m_geogTranWrapper.getInputSr(!1):this.m_geogTranWrapper.getOutputSr(!1)}getInverse(){return new e(this,!0)}isInverted(){return this.m_bInverted}getHashCode(){return this.m_hashCode}GetPeGeogtran(){return this.m_geogTranWrapper.getGeogtran()}equals(e){let t=e;return t===this||this.m_bInverted===t.m_bInverted&&(this.GetPeGeogtran()===t.GetPeGeogtran()||this.getID()===t.getID()&&!(this.getID()===0&&!this.GetPeGeogtran().isEqual(t.GetPeGeogtran())))}referencesMissingData(){return!!this.m_geogTranWrapper&&!this.m_geogTranWrapper.isUsable()}getWrapper(){return this.m_geogTranWrapper}};function VC(e,t,n,r,i){let a=e.getGCS(),o=t.getGCS(),s=a.getPECoordSys(),c=o.getPECoordSys(),l=null;if(!n.isEmpty()){let t=n.clone();if(!t.isEmpty()&&e.getCoordinateSystemType()===2){let n=new lr({env2D:t}),r=Fx(e,a,null);n=new Mv().execute(n,r,null),n.queryEnvelope(t)}if(!t.isEmpty()){let e=s.getPrimem().getLongitude(),n=s.getUnit().getUnitFactor();l=new CC(t.xmin,t.ymin,t.xmax,t.ymax,e,n)}}let u=r;u>=Ve()&&(u=0);let d=[],f=yC.PE_GTLIST_OPTS_COMMON;i||(f&=~yC.PE_GTLIST_OPTS_USABLE);for(let e=0;e<2;e++){d.length=0;let e=u,t=yC.getGTlist(s,c,2,f,l,e),n=!1;if(t&&t.length>0)for(let e=0,a=t.length;e<a;e++){let a=UC([t[e]]);if(U(a),i&&a.referencesMissingData())n=!0;else if(d.push(a),r>0&&d.length===r)break}if(!n)break;u===0||(u=0)}return l&&l.destroy(),d}function HC(){return new WC([],null,null,null)}function UC(e){U(e!==null);let t=new GC,n=e[0].getSteps();if(n){let r=e[0].getEntries();for(let e=0;e<n;e++){let n=r[e].getDirection()!==0,i=LC(r[e].getGeogtran(),n);t.add(i)}return t.create()}return null}var WC=class{constructor(e,t,n,r){this.m_bReadOnly=!0,this.m_name=``,this.m_fastTrack=-1,this.m_bNameIsSet=!1,this.m_transforms=e,t&&(this.m_name=t,this.m_bNameIsSet=!0),this.m_inputSr=n,this.m_outputSr=r}getType(){return 0}getName(){if(this.m_bNameIsSet)return this.m_name;if(this.m_transforms.length===0)return``;let e=``;for(let t of this.m_transforms)e.length>0&&(e+=` + `),t.isInverted()&&(e+=`~`),e+=t.getName();return e}count(){return this.m_transforms.length}createInverse(){return this.getInverse()}getHashCode(){let e=1973;for(let t=0;t<this.m_transforms.length;t++)e=we(e,this.m_transforms[t].getHashCode());return e}equals(e){return U(0),!1}referencesMissingData(){if(this.m_transforms.length===0)return!1;for(let e of this.m_transforms)if(e.referencesMissingData())return!0;return!1}isMatchingTransformation(e,t){return U(0),!1}validateTransformation(e,t){return U(0),!1}nameIsSet(){return U(0),!1}getInputSpatialReference(){return this.m_inputSr}getOutputSpatialReference(){return this.m_outputSr}getStep(e){return(e<0||e>this.count())&&E(``),this.m_transforms[e]}getInverse(){let e=new GC;return e.addSteps(this,!0),e.setInputSpatialReference(this.m_outputSr),e.setOutputSpatialReference(this.m_inputSr),e.create()}transform(e,t,n){if(this.count()===0)return;let r=this.m_inputSr,i=this.m_outputSr;if(e&&(i=W(r,r=i)),this.m_transforms.length===0)return void My(r,null,i,null,t,null,n);let a=this.m_fastTrack;if(a===1)return void Qr(e,this.m_transforms,r=>{Ly(r.getWrapper(),e!==r.isInverted(),t,null,n)});let o=Ay();a===-1&&o.initFromGcsAndVcs(r,null);let s=Ay(),c=e?this.m_transforms.length-1:0,l=e?-1:1;for(let i=0,u=this.m_transforms.length;i<u;i++,c+=l){if(i===0){let i=this.m_transforms[c];Ny(r.getPECoordSys(),null,i.getWrapper(),e!==i.isInverted(),t,null,n,s),a===-1&&(o.equals(s)||(a=0)),o.assign(s)}else{let r=this.m_transforms[c-l],i=this.m_transforms[c];Fy(o,r.getWrapper(),e!==r.isInverted(),i.getWrapper(),e!==i.isInverted(),t,null,n,s),a===-1&&(o.equals(s)||(a=0)),o.assign(s)}let u=this.m_transforms[c];Iy(o,u.getWrapper(),e!==u.isInverted(),t,null,n,s),o.assign(s)}let u=this.m_transforms[c-l];Py(o,u.getWrapper(),e!==u.isInverted(),i,null,t,null,n),a===-1&&(s.initFromGcsAndVcs(i,null),o.equals(s)||(a=0)),this.m_fastTrack=a===0?0:1}},GC=class{constructor(){this.m_transforms=[],this.m_inputGCS=null,this.m_outputGCS=null,this.m_name=``,this.m_bNameIsSet=!1}getInputSpatialReference(){return this.m_inputGCS===null?this.count()>0?this.m_transforms[0].getInputSpatialReference():null:this.m_inputGCS}setInputSpatialReference(e){this.m_inputGCS=e?e.getGCS():null}getOutputSpatialReference(){return this.m_outputGCS===null?this.count()>0?this.m_transforms.at(-1).getOutputSpatialReference():null:this.m_outputGCS}setOutputSpatialReference(e){this.m_outputGCS=e?e.getGCS():null}getName(){if(this.m_bNameIsSet)return this.m_name;if(this.m_transforms.length===0)return``;let e=``;for(let t of this.m_transforms)e.length>0&&(e+=` + `),t.isInverted()&&(e+=`~`),e+=t.getName();return e}count(){return this.m_transforms.length}getStep(e){return(e<0||e>this.count())&&E(``),this.m_transforms[e]}setStep(e,t){U(0)}add(e){this.m_transforms.push(e)}addSteps(e,t){if(t)for(let t=e.count()-1;t>=0;--t)this.add(e.getStep(t).getInverse());else for(let t=0;t<e.count();++t)this.add(e.getStep(t))}clear(){this.m_transforms=[],this.m_name=``,this.m_bNameIsSet=!1,this.m_inputGCS=null,this.m_outputGCS=null}remove(e){U(0)}create(){let e=this.getInputSpatialReference(),t=this.getOutputSpatialReference(),n=new WC(this.m_transforms,this.m_bNameIsSet?this.m_name:null,e,t);return n.m_bReadOnly=!0,this.clear(),n}};export{QS as $,ii as $t,HS as A,Rn as An,ab as At,By as B,rf as Bt,kS as C,Mn as Cn,Mv as Ct,dC as D,$t as Dn,em as Dt,NS as E,q as En,YS as Et,Sb as F,Rx as Ft,Px as G,Ba as Gt,zS as H,qd as Ht,AS as I,zv as It,Vb as J,os as Jt,Fv as K,hd as Kt,SC as L,zb as Lt,Fx as M,gC as Mt,Iv as N,yv as Nt,wf as O,Gn as On,af as Ot,FS as P,IC as Pt,r_ as Q,$o as Qt,zx as R,zy as Rt,j_ as S,Qt as Sn,ZS as St,Pv as T,K as Tn,jS as Tt,Lv as U,fs as Ut,Wg as V,Qd as Vt,Lb as W,Ui as Wt,u_ as X,od as Xt,BS as Y,gd as Yt,sy as Z,fr as Zt,Lx as _,En as _n,Nm as _t,mC as a,Lu as an,d_ as at,Hg as b,tn as bn,eC as bt,O_ as c,us as cn,p_ as ct,hC as d,Tu as dn,tv as dt,Q as en,eb as et,HC as f,rn as fn,XS as ft,FC as g,kn as gn,Ob as gt,VS as h,jn as hn,Vy as ht,MS as i,$r as in,_f as it,L_ as j,ay as jt,Ux as k,lr as kn,GC as kt,Dy as l,hs as ln,i_ as lt,Uy as m,Ln as mn,rm as mt,kb as n,Ou as nn,$ as nt,xC as o,Z as on,yf as ot,W_ as p,Pn as pn,Q_ as pt,PS as q,Bi as qt,OS as r,Ni as rn,oy as rt,mv as s,X as sn,Kx as st,Ox as t,Gc as tn,df as tt,ES as u,ss as un,$S as ut,Rv as v,Vn as vn,Lf as vt,Nx as w,Wn as wn,Mb as wt,LS as x,nn as xn,tx as xt,Ry as y,An as yn,tC as yt,Bb as z,RS as zt};