import{$l as e,A_ as t,Ag as n,Bl as r,Fl as i,Gl as a,Hg as o,Hl as s,I_ as c,Jg as l,Jl as u,Kg as d,Kl as f,Ll as p,PS as m,Pt as ee,Ql as te,Rl as ne,SS as re,W_ as ie,Wg as ae,Xg as oe,Zl as se,_t as ce,id as le,iu as ue,k_ as de,kg as fe,np as pe,nu as me,ql as he,tu as ge}from"./index-BqmCqmfp.js";import{n as _e,t as ve}from"./quatf64-CJzmL3cc.js";import{l as ye,o as be,r as h}from"./quat-Bk_ZaVz9.js";import{r as xe,t as Se}from"./vectorStacks-CKtslZxP.js";import{b as Ce}from"./plane-CTjDePZl.js";import{t as we}from"./computeTranslationToOriginAndRotation-BC3OuSky.js";import{t as Te}from"./spatialReferenceEllipsoidUtils-DBtdxVkA.js";var Ee=class{constructor(e,t,n=t){this.data=e,this.size=t,this.stride=n}},De=class extends Ee{constructor(e,t,n,r=!1,i=n){super(e,n,i),this.indices=t,this.exclusive=r}},g=1e-6,Oe=l(),ke=l();function Ae(e,t){let{data:n,size:r}=e,i=n.length/r;if(i<=0)return;let a=new $e(e);nt(Oe,a.minProj,a.maxProj),rt(Oe,Oe,.5),I(ke,a.maxProj,a.minProj);let o=tt(ke),s=new et;s.quality=o,i<14&&(e=new Ee(new Float64Array(a.buffer,112,42),3));let c=l(),u=l(),d=l(),f=l(),p=l(),m=l(),ee=l();switch(je(a,e,ee,c,u,d,f,p,m,s)){case 1:We(Oe,ke,t);return;case 2:qe(e,f,t);return}Pe(e,ee,c,u,d,f,p,m,s),Je(e,s.b0,s.b1,s.b2,j,M);let te=l();I(te,M,j),s.quality=tt(te),s.quality<o?Qe(s.b0,s.b1,s.b2,j,M,te,t):We(Oe,ke,t)}function je(e,t,n,r,i,a,o,s,c,l){return Fe(e,r,i),at(r,i)<g?1:(I(o,r,i),z(o,o),Ie(t,r,o,a)<g?2:(I(s,i,a),z(s,s),I(c,a,r),z(c,c),R(n,s,o),z(n,n),D(t,n,o,s,c,l),0))}var Me=l(),Ne=l(),_=l(),v=l(),y=l(),b=l(),x=l(),S=l();function Pe(e,t,n,r,i,a,o,s,c){Le(e,t,n,Me,Ne),Me[0]!==void 0&&(I(_,Me,n),z(_,_),I(v,Me,r),z(v,v),I(y,Me,i),z(y,y),R(b,v,a),z(b,b),R(x,y,o),z(x,x),R(S,_,s),z(S,S),D(e,b,a,v,_,c),D(e,x,o,y,v,c),D(e,S,s,_,y,c)),Ne[0]!==void 0&&(I(_,Ne,n),z(_,_),I(v,Ne,r),z(v,v),I(y,Ne,i),z(y,y),R(b,v,a),z(b,b),R(x,y,o),z(x,x),R(S,_,s),z(S,S),D(e,b,a,v,_,c),D(e,x,o,y,v,c),D(e,S,s,_,y,c))}function Fe(e,t,n){let r=at(e.maxVert[0],e.minVert[0]),i=0;for(let t=1;t<7;++t){let n=at(e.maxVert[t],e.minVert[t]);n>r&&(r=n,i=t)}L(t,e.minVert[i]),L(n,e.maxVert[i])}var C=[0,0,0];function Ie(e,t,n,r){let{data:i,size:a}=e,o=-1/0,s=0;for(let e=0;e<i.length;e+=a){C[0]=i[e]-t[0],C[1]=i[e+1]-t[1],C[2]=i[e+2]-t[2];let r=n[0]*C[0]+n[1]*C[1]+n[2]*C[2],a=n[0]*n[0]+n[1]*n[1]+n[2]*n[2],c=C[0]*C[0]+C[1]*C[1]+C[2]*C[2]-r*r/a;c>o&&(o=c,s=e)}return L(r,i,s),o}var w=le();function Le(e,t,n,r,i){Ue(e,t,w,i,r);let a=ot(n,t);w[1]-g<=a&&(r[0]=void 0),w[0]+g>=a&&(i[0]=void 0)}var Re=l(),ze=l(),Be=l(),T=l(),E=l(),Ve=l();function D(e,t,n,r,i,a){if(it(t)<g)return;R(Re,n,t),R(ze,r,t),R(Be,i,t),O(e,t,w),E[1]=w[0],T[1]=w[1],Ve[1]=T[1]-E[1];let o=[n,r,i],s=[Re,ze,Be];for(let n=0;n<3;++n){O(e,o[n],w),E[0]=w[0],T[0]=w[1],O(e,s[n],w),E[2]=w[0],T[2]=w[1],Ve[0]=T[0]-E[0],Ve[2]=T[2]-E[2];let r=tt(Ve);r<a.quality&&(L(a.b0,o[n]),L(a.b1,t),L(a.b2,s[n]),a.quality=r)}}var He=l();function O(e,t,n){let{data:r,size:i}=e;n[0]=1/0,n[1]=-1/0;for(let e=0;e<r.length;e+=i){let i=r[e]*t[0]+r[e+1]*t[1]+r[e+2]*t[2];n[0]=Math.min(n[0],i),n[1]=Math.max(n[1],i)}}function Ue(e,t,n,r,i){let{data:a,size:o}=e;L(r,a),L(i,r),n[0]=ot(He,t),n[1]=n[0];for(let e=o;e<a.length;e+=o){let o=a[e]*t[0]+a[e+1]*t[1]+a[e+2]*t[2];o<n[0]&&(n[0]=o,L(r,a,e)),o>n[1]&&(n[1]=o,L(i,a,e))}}function We(e,t,n){n.center=e,n.halfSize=u(t,t,.5),n.quaternion=_e}var k=l(),A=l(),Ge=l(),j=l(),M=l(),Ke=l();function qe(e,t,n){L(k,t),Math.abs(t[0])>Math.abs(t[1])&&Math.abs(t[0])>Math.abs(t[2])?k[0]=0:Math.abs(t[1])>Math.abs(t[2])?k[1]=0:k[2]=0,it(k)<g&&(k[0]=k[1]=k[2]=1),R(A,t,k),z(A,A),R(Ge,t,A),z(Ge,Ge),Je(e,t,A,Ge,j,M),I(Ke,M,j),Qe(t,A,Ge,j,M,Ke,n)}function Je(e,t,n,r,i,a){O(e,t,w),i[0]=w[0],a[0]=w[1],O(e,n,w),i[1]=w[0],a[1]=w[1],O(e,r,w),i[2]=w[0],a[2]=w[1]}var N=l(),Ye=l(),Xe=l(),P=t(1,0,0,0,1,0,0,0,1),Ze=ve();function Qe(e,t,n,r,i,a,o){P[0]=e[0],P[1]=e[1],P[2]=e[2],P[3]=t[0],P[4]=t[1],P[5]=t[2],P[6]=n[0],P[7]=n[1],P[8]=n[2],o.quaternion=st(Ze,P),nt(N,r,i),rt(N,N,.5),rt(Ye,e,N[0]),rt(Xe,t,N[1]),nt(Ye,Ye,Xe),rt(Xe,n,N[2]),o.center=ue(Ye,Ye,Xe),o.halfSize=u(N,a,.5)}var F=7,$e=class{constructor(e){this.minVert=Array(F),this.maxVert=Array(F);let t=64*F;this.buffer=new ArrayBuffer(t);let n=0;this.minProj=new Float64Array(this.buffer,n,F),n+=8*F,this.maxProj=new Float64Array(this.buffer,n,F),n+=8*F;for(let e=0;e<F;++e)this.minVert[e]=new Float64Array(this.buffer,n,3),n+=24;for(let e=0;e<F;++e)this.maxVert[e]=new Float64Array(this.buffer,n,3),n+=24;for(let e=0;e<F;++e)this.minProj[e]=1/0,this.maxProj[e]=-1/0;let r=Array(F),i=Array(F),{data:a,size:o}=e;for(let e=0;e<a.length;e+=o){let t=a[e];t<this.minProj[0]&&(this.minProj[0]=t,r[0]=e),t>this.maxProj[0]&&(this.maxProj[0]=t,i[0]=e),t=a[e+1],t<this.minProj[1]&&(this.minProj[1]=t,r[1]=e),t>this.maxProj[1]&&(this.maxProj[1]=t,i[1]=e),t=a[e+2],t<this.minProj[2]&&(this.minProj[2]=t,r[2]=e),t>this.maxProj[2]&&(this.maxProj[2]=t,i[2]=e),t=a[e]+a[e+1]+a[e+2],t<this.minProj[3]&&(this.minProj[3]=t,r[3]=e),t>this.maxProj[3]&&(this.maxProj[3]=t,i[3]=e),t=a[e]+a[e+1]-a[e+2],t<this.minProj[4]&&(this.minProj[4]=t,r[4]=e),t>this.maxProj[4]&&(this.maxProj[4]=t,i[4]=e),t=a[e]-a[e+1]+a[e+2],t<this.minProj[5]&&(this.minProj[5]=t,r[5]=e),t>this.maxProj[5]&&(this.maxProj[5]=t,i[5]=e),t=a[e]-a[e+1]-a[e+2],t<this.minProj[6]&&(this.minProj[6]=t,r[6]=e),t>this.maxProj[6]&&(this.maxProj[6]=t,i[6]=e)}for(let e=0;e<F;++e){let t=r[e];L(this.minVert[e],a,t),t=i[e],L(this.maxVert[e],a,t)}}},et=class{constructor(){this.b0=oe(1,0,0),this.b1=oe(0,1,0),this.b2=oe(0,0,1),this.quality=0}};function tt(e){return e[0]*e[1]+e[0]*e[2]+e[1]*e[2]}function nt(e,t,n){e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2]}function I(e,t,n){e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2]}function rt(e,t,n){e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n}function L(e,t,n=0){e[0]=t[n],e[1]=t[n+1],e[2]=t[n+2]}function R(e,t,n){let r=t[0],i=t[1],a=t[2],o=n[0],s=n[1],c=n[2];e[0]=i*c-a*s,e[1]=a*o-r*c,e[2]=r*s-i*o}function z(e,t){let n=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(n>0){let r=1/Math.sqrt(n);e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r}}function it(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}function at(e,t){let n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i}function ot(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function st(e,t){let n=t[0]+t[4]+t[8];if(n>0){let r=Math.sqrt(n+1);e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r}else{let n=0;t[4]>t[0]&&(n=1),t[8]>t[3*n+n]&&(n=2);let r=(n+1)%3,i=(n+2)%3,a=Math.sqrt(t[3*n+n]-t[3*r+r]-t[3*i+i]+1);e[n]=.5*a,a=.5/a,e[3]=(t[3*r+i]-t[3*i+r])*a,e[r]=(t[3*r+n]+t[3*n+r])*a,e[i]=(t[3*i+n]+t[3*n+i])*a}return e}var ct=class t{constructor(e=ae,t=St,n=_e){this._data=[e[0],e[1],e[2],t[0],t[1],t[2],n[0],n[1],n[2],n[3]]}clone(){return t.fromData(this._data)}invalidate(){this._data[3]=-1}get isValid(){return this._data[3]>=0}static fromData(e){let n=new t;return n._copyFromData(e),n}static fromJSON(e){return new t(e.center,e.halfSize,e.quaternion)}copy(e){this._copyFromData(e.data)}_copyFromData(e){for(let t=0;t<10;++t)this._data[t]=e[t]}get center(){return e(Se.get(),this._data[0],this._data[1],this._data[2])}get centerX(){return this._data[0]}get centerY(){return this._data[1]}get centerZ(){return this._data[2]}getCenter(e){return e[0]=this._data[0],e[1]=this._data[1],e[2]=this._data[2],e}set center(e){this._data[0]=e[0],this._data[1]=e[1],this._data[2]=e[2]}setCenter(e,t,n){this._data[0]=e,this._data[1]=t,this._data[2]=n}get halfSize(){return e(Se.get(),this._data[3],this._data[4],this._data[5])}get halfSizeX(){return this._data[3]}get halfSizeY(){return this._data[4]}get halfSizeZ(){return this._data[5]}getHalfSize(e){return e[0]=this._data[3],e[1]=this._data[4],e[2]=this._data[5],e}set halfSize(e){this._data[3]=e[0],this._data[4]=e[1],this._data[5]=e[2]}get quaternion(){return be(xe.get(),this._data[6],this._data[7],this._data[8],this._data[9])}getQuaternion(e){return e[0]=this._data[6],e[1]=this._data[7],e[2]=this._data[8],e[3]=this._data[9],e}set quaternion(e){this._data[6]=e[0],this._data[7]=e[1],this._data[8]=e[2],this._data[9]=e[3]}get data(){return this._data}getCorners(e){let t=this._data,n=be(B,t[6],t[7],t[8],t[9]);for(let r=0;r<8;++r){let i=e[r];i[0]=(1&r?-1:1)*t[3],i[1]=(2&r?-1:1)*t[4],i[2]=(4&r?-1:1)*t[5],p(i,i,n),i[0]+=t[0],i[1]+=t[1],i[2]+=t[2]}}doesIntersectFrustumConservativeApproximation(e){return this.intersectPlane(e[0])<=0&&this.intersectPlane(e[1])<=0&&this.intersectPlane(e[2])<=0&&this.intersectPlane(e[3])<=0&&this.intersectPlane(e[4])<=0&&this.intersectPlane(e[5])<=0}get radius(){let e=this._data[3],t=this._data[4],n=this._data[5];return Math.sqrt(e*e+t*t+n*n)}intersectSphere(e){H[0]=this._data[0]-e[0],H[1]=this._data[1]-e[1],H[2]=this._data[2]-e[2];let t=this.getQuaternion(V);return h(B,t),p(H,H,B),he(H,H),U[0]=Math.min(H[0],this._data[3]),U[1]=Math.min(H[1],this._data[4]),U[2]=Math.min(H[2],this._data[5]),r(U,H)<e[3]*e[3]}intersectSphereWithMBS(e,t=this.radius){let n=this._data;H[0]=n[0]-e[0],H[1]=n[1]-e[1],H[2]=n[2]-e[2];let i=e[3],a=i+t;return!(s(H)>a*a)&&(B[0]=-n[6],B[1]=-n[7],B[2]=-n[8],B[3]=n[9],p(H,H,B),he(H,H),U[0]=Math.min(H[0],n[3]),U[1]=Math.min(H[1],n[4]),U[2]=Math.min(H[2],n[5]),r(U,H)<i*i)}intersectPlane(e){let t=e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3],n=this.projectedRadius(Ce(e));return t>n?1:t<-n?-1:0}intersectRay(e,t,n=0){let r=this._data,i=B;i[0]=-r[6],i[1]=-r[7],i[2]=-r[8],i[3]=r[9],H[0]=e[0]-r[0],H[1]=e[1]-r[1],H[2]=e[2]-r[2];let a=p(H,H,B),o=p(U,t,B),s=-1/0,c=1/0,l=this.getHalfSize(J);for(let e=0;e<3;e++){let t=a[e],r=o[e],i=l[e]+n;if(Math.abs(r)>1e-6){let e=(i-t)/r,n=(-i-t)/r;s=Math.max(s,Math.min(e,n)),c=Math.min(c,Math.max(e,n))}else if(t>i||t<-i)return!1}return s<=c}projectedArea(t,n,r,a){let o=this.getQuaternion(V);h(B,o),H[0]=t[0]-this._data[0],H[1]=t[1]-this._data[1],H[2]=t[2]-this._data[2],p(H,H,B);let s=this.getHalfSize(J),l=H[0]<-s[0]?-1:H[0]>s[0]?1:0,u=H[1]<-s[1]?-1:H[1]>s[1]?1:0,d=H[2]<-s[2]?-1:H[2]>s[2]?1:0,f=Math.abs(l)+Math.abs(u)+Math.abs(d);if(f===0)return 1/0;let m=f===1?4:6,te=6*(l+3*u+9*d+13);ie(Y,o),c(Y,Y,s);let ne=this.getCenter(q);for(let t=0;t<m;t++){let r=dt[te+t];e(H,((1&r)<<1)-1,(2&r)-1,((4&r)>>1)-1),i(H,H,Y),ue(W,ne,H),W[3]=1,ee(W,W,n);let a=1/Math.max(1e-6,W[3]);G[2*t]=W[0]*a,G[2*t+1]=W[1]*a}let re=2*m-2,ae=G[0]*(G[3]-G[re+1])+G[re]*(G[1]-G[re-1]);for(let e=2;e<re;e+=2)ae+=G[e]*(G[e+3]-G[e-1]);return Math.abs(ae)*r*a*.125}projectedRadius(e){let t=this.getQuaternion(V);return h(B,t),p(H,e,B),Math.abs(H[0]*this._data[3])+Math.abs(H[1]*this._data[4])+Math.abs(H[2]*this._data[5])}minimumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]-this.projectedRadius(Ce(e))}maximumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]+this.projectedRadius(Ce(e))}toAaBoundingBox(e){let t=this.getQuaternion(V),n=ie(Y,t),r=this._data[3]*Math.abs(n[0])+this._data[4]*Math.abs(n[3])+this._data[5]*Math.abs(n[6]),i=this._data[3]*Math.abs(n[1])+this._data[4]*Math.abs(n[4])+this._data[5]*Math.abs(n[7]),a=this._data[3]*Math.abs(n[2])+this._data[4]*Math.abs(n[5])+this._data[5]*Math.abs(n[8]);e[0]=this._data[0]-r,e[1]=this._data[1]-i,e[2]=this._data[2]-a,e[3]=this._data[0]+r,e[4]=this._data[1]+i,e[5]=this._data[2]+a}transform(e,t,r,i=0,a=Te(r),o=Te(t),s=n(t,o)){if(r===a)t.isGeographic?_t(this,e,t,i,o):gt(this,e,t,i,o,s);else if(t.isWGS84&&(r.isWebMercator||m(r)))pt(t,this,r,e,i);else if(t.isWebMercator&&m(r))mt(t,this,r,e,i);else{let n=this.getCenter(q);n[2]+=i,fe(n,t,0,n,r,0),e.center=n,this!==e&&(e.quaternion=this.getQuaternion(V),e.halfSize=this.getHalfSize(J))}}},B=ve(),V=ve(),lt=ve(),H=l(),U=l(),W=ce();function ut(e,t=new ct){return Ae(e,t),t}var G=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],dt=(()=>{let e=new Int8Array(162),t=0,n=n=>{for(let r=0;r<n.length;r++)e[t+r]=n[r];t+=6};return n([6,2,3,1,5,4]),n([0,2,3,1,5,4]),n([0,2,3,7,5,4]),n([0,1,3,2,6,4]),n([0,1,3,2,0,0]),n([0,1,5,7,3,2]),n([0,1,3,7,6,4]),n([0,1,3,7,6,2]),n([0,1,5,7,6,2]),n([0,1,5,4,6,2]),n([0,1,5,4,0,0]),n([0,1,3,7,5,4]),n([0,2,6,4,0,0]),n([0,0,0,0,0,0]),n([1,3,7,5,0,0]),n([2,3,7,6,4,0]),n([2,3,7,6,0,0]),n([2,3,1,5,7,6]),n([0,1,5,7,6,2]),n([0,1,5,7,6,4]),n([0,1,3,7,6,4]),n([4,5,7,6,2,0]),n([4,5,7,6,0,0]),n([4,5,1,3,7,6]),n([0,2,3,7,5,4]),n([6,2,3,7,5,4]),n([6,2,3,1,5,4]),e})();function ft(t,n,r,i,a){let s=t.getQuaternion(V);a.quaternion=s,h(B,s);let c=t.getCenter(q),l=t.getHalfSize(J);if(i===1){p(Z,c,B),he(Q,Z),se($,Q,l),ne($,Q,$);let i=me($);ue($,Q,l);let o=me($);if(i<r)a.center=c,e(Z,r,r,r),a.halfSize=ue(Z,l,Z);else{let e=o>0?1+n/o:1,s=i>0?1+r/i:1,c=(s+e)/2,d=(s-e)/2;u($,Q,d),a.halfSize=ge($,$,l,c),u($,Q,c),ge($,$,l,d),te(Z,Z),f(Z,$,Z);let m=t.getQuaternion(lt);a.center=p(Z,Z,m)}}else{a.center=ge(Z,c,o,(r+n)/2);let e=p(Z,o,B);he(e,e),a.halfSize=ge(Q,l,e,(r-n)/2)}return a}function pt(e,t,n,r,i){t.getCenter(q),q[2]+=i;let a=Te(n);fe(q,e,0,q,a,0),ht(a,t,q,n,r)}function mt(e,t,n,r,i){t.getCenter(q),q[2]+=i,ht(e,t,q,n,r)}function ht(e,t,n,r,i){let a=t.getQuaternion(V),o=ie(Y,a),s=t.getHalfSize(J);for(let e=0;e<8;++e){for(let t=0;t<3;++t)K[t]=s[t]*(e&1<<t?-1:1);for(let t=0;t<3;++t){let r=n[t];for(let e=0;e<3;++e)r+=K[e]*o[3*e+t];vt[3*e+t]=r}}fe(vt,e,0,vt,r,0,8),ut(yt,i)}function gt(t,r,i,o,s=Te(i),c=n(i,s)){t.getCorners(xt),t.getCenter(K),K[2]+=o,we(i,K,X,s),r.setCenter(X[12],X[13],X[14]);let l=2*Math.sqrt(1+X[0]+X[5]+X[10]);B[0]=(X[6]-X[9])/l,B[1]=(X[8]-X[2])/l,B[2]=(X[1]-X[4])/l,B[3]=.25*l;let u=t.getQuaternion(V);r.quaternion=ye(B,B,u),h(B,B),e(Q,0,0,0);let d=r.getCenter(bt);for(let e of xt)e[2]+=o,c(e,0,e,0),ne(Z,e,d),p(Z,Z,B),he(Z,Z),a(Q,Q,Z);r.halfSize=Q}function _t(t,n,r,i,a=Te(r)){let o=re(r),s=1+Math.max(0,i)/(o.radius+t.centerZ);t.getCenter(K),K[2]+=i,fe(K,r,0,K,a,0),n.center=K;let c=t.getQuaternion(V);n.quaternion=c,h(B,c),e(Z,0,0,1),p(Z,Z,B);let l=t.getHalfSize(J);e(Z,l[0]*Math.abs(Z[0]),l[1]*Math.abs(Z[1]),l[2]*Math.abs(Z[2])),u(Z,Z,o.inverseFlattening),ue(Z,l,Z),n.halfSize=u(Z,Z,s)}var vt=Array(24),yt=new Ee(vt,3),K=l(),q=l(),bt=l(),J=l(),Y=de(),X=pe(),xt=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],Z=l(),Q=l(),$=l(),St=d(-1,-1,-1);export{De as i,ft as n,Ee as r,ct as t};