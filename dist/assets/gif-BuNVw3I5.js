import{tw as e}from"./index-BqmCqmfp.js";var t,n={},r={},i={};function a(){return t?i:(t=1,Object.defineProperty(i,`__esModule`,{value:!0}),i.loop=i.conditional=i.parse=void 0,i.parse=function e(t,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:r;if(Array.isArray(n))n.forEach(function(n){return e(t,n,r,i)});else if(typeof n==`function`)n(t,r,i,e);else{var a=Object.keys(n)[0];Array.isArray(n[a])?(i[a]={},e(t,n[a],r,i[a])):i[a]=n[a](t,r,i,e)}return r},i.conditional=function(e,t){return function(n,r,i,a){t(n,r,i)&&a(n,e,r,i)}},i.loop=function(e,t){return function(n,r,i,a){for(var o=[],s=n.pos;t(n,r,i);){var c={};if(a(n,e,r,c),n.pos===s)break;s=n.pos,o.push(c)}return o}},i)}var o,s,c={};function l(){if(o)return c;o=1,Object.defineProperty(c,`__esModule`,{value:!0}),c.readBits=c.readArray=c.readUnsigned=c.readString=c.peekBytes=c.readBytes=c.peekByte=c.readByte=c.buildStream=void 0,c.buildStream=function(e){return{data:e,pos:0}};var e=function(){return function(e){return e.data[e.pos++]}};c.readByte=e,c.peekByte=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return function(t){return t.data[t.pos+e]}};var t=function(e){return function(t){return t.data.subarray(t.pos,t.pos+=e)}};c.readBytes=t,c.peekBytes=function(e){return function(t){return t.data.subarray(t.pos,t.pos+e)}},c.readString=function(e){return function(n){return Array.from(t(e)(n)).map(function(e){return String.fromCharCode(e)}).join(``)}},c.readUnsigned=function(e){return function(n){var r=t(2)(n);return e?(r[1]<<8)+r[0]:(r[0]<<8)+r[1]}},c.readArray=function(e,n){return function(r,i,a){for(var o=typeof n==`function`?n(r,i,a):n,s=t(e),c=Array(o),l=0;l<o;l++)c[l]=s(r);return c}};var n=function(e,t,n){for(var r=0,i=0;i<n;i++)r+=e[t+i]&&2**(n-i-1);return r};return c.readBits=function(t){return function(r){for(var i=e()(r),a=Array(8),o=0;o<8;o++)a[7-o]=!!(i&1<<o);return Object.keys(t).reduce(function(e,r){var i=t[r];return i.length?e[r]=n(a,i.index,i.length):e[r]=a[i.index],e},{})}},c}function u(){return s||(s=1,function(e){Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0;var t=a(),n=l(),r={blocks:function(e){for(var t=0,r=[],i=e.data.length,a=0,o=(0,n.readByte)()(e);o!==t&&o;o=(0,n.readByte)()(e)){if(e.pos+o>=i){var s=i-e.pos;r.push((0,n.readBytes)(s)(e)),a+=s;break}r.push((0,n.readBytes)(o)(e)),a+=o}for(var c=new Uint8Array(a),l=0,u=0;u<r.length;u++)c.set(r[u],l),l+=r[u].length;return c}},i=(0,t.conditional)({gce:[{codes:(0,n.readBytes)(2)},{byteSize:(0,n.readByte)()},{extras:(0,n.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,n.readUnsigned)(!0)},{transparentColorIndex:(0,n.readByte)()},{terminator:(0,n.readByte)()}]},function(e){var t=(0,n.peekBytes)(2)(e);return t[0]===33&&t[1]===249}),o=(0,t.conditional)({image:[{code:(0,n.readByte)()},{descriptor:[{left:(0,n.readUnsigned)(!0)},{top:(0,n.readUnsigned)(!0)},{width:(0,n.readUnsigned)(!0)},{height:(0,n.readUnsigned)(!0)},{lct:(0,n.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,t.conditional)({lct:(0,n.readArray)(3,function(e,t,n){return 2**(n.descriptor.lct.size+1)})},function(e,t,n){return n.descriptor.lct.exists}),{data:[{minCodeSize:(0,n.readByte)()},r]}]},function(e){return(0,n.peekByte)()(e)===44}),s=(0,t.conditional)({text:[{codes:(0,n.readBytes)(2)},{blockSize:(0,n.readByte)()},{preData:function(e,t,r){return(0,n.readBytes)(r.text.blockSize)(e)}},r]},function(e){var t=(0,n.peekBytes)(2)(e);return t[0]===33&&t[1]===1}),c=(0,t.conditional)({application:[{codes:(0,n.readBytes)(2)},{blockSize:(0,n.readByte)()},{id:function(e,t,r){return(0,n.readString)(r.blockSize)(e)}},r]},function(e){var t=(0,n.peekBytes)(2)(e);return t[0]===33&&t[1]===255}),u=(0,t.conditional)({comment:[{codes:(0,n.readBytes)(2)},r]},function(e){var t=(0,n.peekBytes)(2)(e);return t[0]===33&&t[1]===254});e.default=[{header:[{signature:(0,n.readString)(3)},{version:(0,n.readString)(3)}]},{lsd:[{width:(0,n.readUnsigned)(!0)},{height:(0,n.readUnsigned)(!0)},{gct:(0,n.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,n.readByte)()},{pixelAspectRatio:(0,n.readByte)()}]},(0,t.conditional)({gct:(0,n.readArray)(3,function(e,t){return 2**(t.lsd.gct.size+1)})},function(e,t){return t.lsd.gct.exists}),{frames:(0,t.loop)([i,c,u,o,s],function(e){var t=(0,n.peekByte)()(e);return t===33||t===44})}]}(r)),r}var d,f={};function p(){return d?f:(d=1,Object.defineProperty(f,`__esModule`,{value:!0}),f.deinterlace=void 0,f.deinterlace=function(e,t){for(var n=Array(e.length),r=e.length/t,i=function(r,i){var a=e.slice(i*t,(i+1)*t);n.splice.apply(n,[r*t,t].concat(a))},a=[0,4,2,1],o=[8,8,4,2],s=0,c=0;c<4;c++)for(var l=a[c];l<r;l+=o[c])i(l,s),s++;return n},f)}var m,h,g={};function _(){return m?g:(m=1,Object.defineProperty(g,`__esModule`,{value:!0}),g.lzw=void 0,g.lzw=function(e,t,n){var r,i,a,o,s,c,l,u,d,f,p,m,h,g,_,v,y=4096,b=-1,x=n,S=Array(n),C=Array(y),w=Array(y),T=Array(y+1);for(s=(i=1<<(f=e))+1,r=i+2,l=b,a=(1<<(o=f+1))-1,u=0;u<i;u++)C[u]=0,w[u]=u;for(p=m=h=g=_=v=0,d=0;d<x;){if(g===0){if(m<o){p+=t[v]<<m,m+=8,v++;continue}if(u=p&a,p>>=o,m-=o,u>r||u==s)break;if(u==i){a=(1<<(o=f+1))-1,r=i+2,l=b;continue}if(l==b){T[g++]=w[u],l=u,h=u;continue}for(c=u,u==r&&(T[g++]=h,u=l);u>i;)T[g++]=w[u],u=C[u];h=255&w[u],T[g++]=h,r<y&&(C[r]=l,w[r]=h,(++r&a)===0&&r<y&&(o++,a+=r)),l=c}g--,S[_++]=T[g],d++}for(d=_;d<x;d++)S[d]=0;return S},g)}function v(){if(h)return n;h=1,Object.defineProperty(n,`__esModule`,{value:!0}),n.decompressFrames=n.decompressFrame=n.parseGIF=void 0;var e=s(u()),t=a(),r=l(),i=p(),o=_();function s(e){return e&&e.__esModule?e:{default:e}}n.parseGIF=function(n){var i=new Uint8Array(n);return(0,t.parse)((0,r.buildStream)(i),e.default)};var c=function(e){for(var t=e.pixels.length,n=new Uint8ClampedArray(4*t),r=0;r<t;r++){var i=4*r,a=e.pixels[r],o=e.colorTable[a]||[0,0,0];n[i]=o[0],n[i+1]=o[1],n[i+2]=o[2],n[i+3]=a===e.transparentIndex?0:255}return n},d=function(e,t,n){if(e.image){var r=e.image,a=r.descriptor.width*r.descriptor.height,s=(0,o.lzw)(r.data.minCodeSize,r.data.blocks,a);r.descriptor.lct.interlaced&&(s=(0,i.deinterlace)(s,r.descriptor.width));var l={pixels:s,dims:{top:e.image.descriptor.top,left:e.image.descriptor.left,width:e.image.descriptor.width,height:e.image.descriptor.height}};return r.descriptor.lct&&r.descriptor.lct.exists?l.colorTable=r.lct:l.colorTable=t,e.gce&&(l.delay=10*(e.gce.delay||10),l.disposalType=e.gce.extras.disposal,e.gce.extras.transparentColorGiven&&(l.transparentIndex=e.gce.transparentColorIndex)),n&&(l.patch=c(l)),l}console.warn(`gif frame does not have associated image.`)};return n.decompressFrame=d,n.decompressFrames=function(e,t){return e.frames.filter(function(e){return e.image}).map(function(n){return d(n,e.gct,t)})},n}var y=v(),b,x,S;function C(e,t){return b??=document.createElement(`canvas`),b.width=e,b.height=t,b.getContext(`2d`,{willReadFrequently:!0})}async function w(t,n){let r=y.parseGIF(t),i=y.decompressFrames(r,!0),{width:a,height:o}=r.lsd,s=C(a,o),c=[],l=[],u=0;for(let t of i){let n=e(t.delay||100);l.push(n),u+=n;let r=T(new ImageData(t.patch,t.dims.width,t.dims.height)),i=t.disposalType===3?s.getImageData(t.dims.left,t.dims.top,t.dims.width,t.dims.height):void 0;s.drawImage(r,t.dims.left,t.dims.top);let d=s.getImageData(0,0,a,o);c.push(d),t.disposalType===1||(t.disposalType===2?s.clearRect(t.dims.left,t.dims.top,t.dims.width,t.dims.height):t.disposalType===3&&s.putImageData(i,t.dims.left,t.dims.top))}return{frameCount:i.length,duration:u,frameDurations:l,getFrame:e=>c[e],width:a,height:o}}function T(e){return x??=document.createElement(`canvas`),S??=x.getContext(`2d`,{willReadFrequently:!0}),x.width=e.width,x.height=e.height,S.putImageData(e,0,0),x}var E=[71,73,70];function D(e){let t=new Uint8Array(e);return!E.some((e,n)=>e!==t[n])}function O(e){if(!D(e))return!1;let t=new DataView(e),n=t.getUint8(10),r=13+(128&n?3*2**(1+(7&n)):0),i=0,a=!1;for(;!a;){switch(t.getUint8(r++)){case 33:if(!o())return!1;break;case 44:s();break;case 59:a=!0;break;default:return!1}if(i>1)return!0}function o(){switch(t.getUint8(r++)){case 249:c();break;case 1:l();break;case 254:u();break;case 255:d();break;default:return!1}return!0}function s(){i++,r+=8;let e=t.getUint8(r++);r+=128&e?3*2**(1+(7&e)):0,r++,f()}function c(){r++,r+=4,f()}function l(){i++,r++,r+=12,f()}function u(){f()}function d(){r++,r+=8,r+=3,f()}function f(){let e;for(;e=t.getUint8(r++);)r+=e}return!1}export{O as isAnimatedGIF,D as isGIF,w as parseGif};