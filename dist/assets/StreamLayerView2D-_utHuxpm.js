import{CD as e,Kb as t,MC as n,Pa as r,_E as i,kC as a,mm as o,ua as s,vT as c,wT as l}from"./index-BqmCqmfp.js";import"./memoryEstimations-O7VgDRVG.js";import"./OptimizedFeature-Dx4_lHip.js";import"./OptimizedGeometry-f3I9Z6C1.js";import"./OptimizedFeatureSet-DlHqIhoP.js";import"./featureConversionUtils-7vyVIZ6j.js";import"./streamLayerUtils-BMw-RtDi.js";import"./QueueProcessor-C8_CgXms.js";import"./bundle-BMKKOu1E.js";import"./earcut-Drx511Ix.js";import"./featurePopupQueryUtils-D4olkuib.js";import"./layerViewUtils-Bbe7IKvz.js";import"./popupUtils-h58HBZOO.js";import"./urlUtils-CtPsFIu4.js";import"./pbf-CwGh07vG.js";import"./pbfQueryUtils-DOeTJOP2.js";import"./queryUtils-GIY2oFHT.js";import"./query-D8IHih8e.js";import"./tagSymbols-CNjeVVdC.js";import"./constants-hGT2UJiZ.js";import"./queryUtils-BA7HiGeg.js";import"./FixedIntervalBinParameters-BO-nZFQ3.js";import"./floorFilterUtils-CQ-SmVM_.js";import"./GeometryUtils-DBkUrkz1.js";import"./VertexAttributeLocations-IAhvKZqd.js";import"./VertexElementDescriptor-BGWnA0Rs.js";import"./AttributeBinsFeatureSet-Cw3XBtzs.js";import"./locationUtils-DmjCjKC3.js";import"./parquetUtils-BveyfTr9.js";import"./parquet-79J3NX0y.js";import"./labelPoint-B7zLrA23.js";import"./FeatureMetadata-H6WAS0Lx.js";import"./AttributeBinsQuery-DyK0zHZB.js";import"./fontUtils-CWolFklQ.js";import"./CIMSymbolHelper-bdBsF42t.js";import"./rasterizingUtils-B0Pd5uE0.js";import"./Rect-BMNJQxpm.js";import"./BoundingBox-DnR5UeUT.js";import"./BidiEngine-CpIovbIK.js";import"./densifyCurvedGeometry-C2XDhl14.js";import"./config-BSvujflG.js";import"./WGLContainer-Caxzva6E.js";import"./utils-DBLYSlue.js";import"./ProgramTemplate-ks-pn-xm.js";import"./VertexArrayObject-Dzn28byJ.js";import"./BufferObject-lp8QWmVQ.js";import"./VertexBuffer-DL5rIQzc.js";import"./vec3f32-CZ7wi78s.js";import"./Container-DgT8F3N0.js";import"./EffectView-CvH-XuUh.js";import"./GraphShaderModule-D5xwSwIQ.js";import"./FramebufferObject-CkeUwNOD.js";import"./ShaderBuilder-C3C7fUwK.js";import"./LayerView2D-DVE2Teoj.js";import"./LayerView-DKEUJRIQ.js";import"./RefreshableLayerView-CNJlNdyl.js";import{n as u,t as d}from"./FeatureLayerView2D-KHEVvpED.js";import"./timeSupport-RxzvaDaJ.js";import"./UpdateTracking2D-yw0xaCSk.js";import"./TechniqueInstance-BhM4b8eb.js";import"./TileContainer-BwjyXNO3.js";import"./FeatureCommandQueue-COnDeivB.js";import"./constants-BOI_CTg-.js";import"./utils-CY7cI7hp.js";import"./CircularArray-Bnt6GPkP.js";import"./featureReductionUtils-DBH-XoP8.js";import"./FeatureIdInfo-tnzYk6tz.js";import"./SDFHelper-DcS4hwwo.js";import"./highlightOptionsUtils-DiIoW0j2.js";var f=t=>{let r=t,i=class extends r{resume(){this._isUserPaused=!1,this.suspended||this._doResume()}pause(){this._isUserPaused=!0,this.suspended||this._doPause()}disconnect(){this._doDisconnect()}connect(){this._doConnect()}clear(){this._doClear()}constructor(...e){super(...e),this._isUserPaused=!1,this.filter=null}get connectionStatus(){return(this._isUserPaused||this.suspended)&&this._streamConnectionStatus===`connected`?`paused`:this._streamConnectionStatus}_onSuspendedChange(e){e?this._doPause():this._isUserPaused||this._doResume()}};return e([n()],i.prototype,`_isUserPaused`,void 0),e([n({readOnly:!0})],i.prototype,`connectionStatus`,null),e([n({type:s})],i.prototype,`filter`,void 0),i=e([a(`esri.views.layers.StreamLayerView`)],i),i},p=class extends f(d){constructor(){super(...arguments),this.pipelineConnectionStatus=`disconnected`,this.pipelineErrorString=null}initialize(){this.addHandles([t(()=>this.layer.customParameters,async e=>{(await this.getWorker()).streamMessenger.updateCustomParameters(e)}),this.layer.on(`send-message-to-socket`,async e=>{(await this.getWorker()).streamMessenger.sendMessageToSocket(e)}),this.layer.on(`send-message-to-client`,async e=>{(await this.getWorker()).streamMessenger.sendMessageToClient(e),this._isUserPaused&&`type`in e&&e.type===`clear`&&this.incrementSourceRefreshVersion()}),t(()=>this.layer.purgeOptions,()=>this._update()),t(()=>this.suspended,this._onSuspendedChange.bind(this))],`constructor`),this._doResume()}destroy(){this._doPause()}get connectionError(){return this.pipelineErrorString?new i(`stream-controller`,this.pipelineErrorString):null}on(e,t){if(Array.isArray(e))return l(e.map(e=>this.on(e,t)));let n=[`data-received`,`message-received`].includes(e);n&&this.getWorker().then(t=>t.streamMessenger.enableEvent(e,!0));let r=super.on(e,t),i=this;return c(()=>{r.remove(),n&&(i._workerProxy.closed||i.hasEventListener(e)||i.getWorker().then(t=>t.streamMessenger.enableEvent(e,!1)))})}async queryLatestObservations(e,t){if(!(this.layer.timeInfo?.endField||this.layer.timeInfo?.startField||this.layer.timeInfo?.trackIdField))throw new i(`streamlayer-no-timeField`,`queryLatestObservation can only be used with services that define a TrackIdField`);let n=await this.getWorker();return u(n.features.executeQueryForLatestObservations(this._cleanUpQuery(e),t).then(e=>{let t=r.fromJSON(e);return t.features.forEach(e=>{e.layer=this.layer,e.sourceLayer=this.layer,e.origin=this.layer.graphicOrigin}),t}),new r({features:[]}))}detach(){super.detach(),this.pipelineConnectionStatus=`disconnected`}async queryObjectIds(e,t){return(await super.queryObjectIds(e,t)).filter(o)}get _streamConnectionStatus(){return this.pipelineConnectionStatus}_doPause(){this._refreshInterval!=null&&(clearInterval(this._refreshInterval),this._refreshInterval=null)}_doResume(){this._refreshInterval??=setInterval(()=>this.incrementSourceRefreshVersion(),this.layer.updateInterval)}_doDisconnect(){this.getWorker().then(e=>e.streamMessenger.disconnect()),this._doPause()}_doConnect(){this.getWorker().then(e=>e.streamMessenger.connect()),this.resume()}_doClear(){this.getWorker().then(e=>e.streamMessenger.clear()),this._refreshInterval??this.incrementSourceRefreshVersion()}_createClientOptions(){let e=super._createClientOptions(),t=this;return{...e,get container(){return t.featureContainer},setProperty:e=>{this.set(e.propertyName,e.value)}}}};e([n()],p.prototype,`pipelineConnectionStatus`,void 0),e([n()],p.prototype,`pipelineErrorString`,void 0),e([n({readOnly:!0})],p.prototype,`connectionError`,null),e([n({readOnly:!0})],p.prototype,`_streamConnectionStatus`,null),p=e([a(`esri.views.2d.layers.StreamLayerView2D`)],p);var m=p;export{m as default};