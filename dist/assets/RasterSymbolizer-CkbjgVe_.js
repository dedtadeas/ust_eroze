const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/lerc-wasm-ByvE-D0_.js","assets/_commonjsHelpers-D6ht1XAa.js"])))=>i.map(i=>d[i]);
import{AE as e,Ax as t,CD as n,Cw as r,Hx as i,MC as a,Sx as o,Ux as s,Xw as c,_E as l,aC as u,aT as d,gE as f,iC as p,kC as m,nC as h,oC as g,uT as _,vC as v,vE as y}from"./index-BqmCqmfp.js";import{n as b}from"./_commonjsHelpers-D6ht1XAa.js";import{r as x,s as S}from"./pixelRangeUtils-DMjHgTK0.js";import{f as C,m as w,n as T,t as E}from"./colorUtils-uG2qTogT.js";import{n as D,t as O}from"./PixelBlock-CjVaas_l.js";import{D as k,O as A,S as j,x as M,y as N}from"./vectorFieldUtils-yzcuu25U.js";var P=p()({RSP_NearestNeighbor:`nearest`,RSP_BilinearInterpolation:`bilinear`,RSP_CubicConvolution:`cubic`,RSP_Majority:`majority`}),F=p()({esriNoDataMatchAny:`any`,esriNoDataMatchAll:`all`}),I=p()({U1:`u1`,U2:`u2`,U4:`u4`,U8:`u8`,S8:`s8`,U16:`u16`,S16:`s16`,U32:`u32`,S32:`s32`,F32:`f32`,F64:`f64`,C64:`c64`,C128:`c128`,UNKNOWN:`unknown`}),ee=[`random`,`ndvi`,`ndvi2`,`ndvi3`,`elevation`,`gray`,`hillshade`],L=[{id:`aspect`,type:`multipart`,colorRamps:[{fromColor:[190,190,190],toColor:[255,45,8]},{fromColor:[255,45,8],toColor:[255,181,61]},{fromColor:[255,181,61],toColor:[255,254,52]},{fromColor:[255,254,52],toColor:[0,251,50]},{fromColor:[0,251,50],toColor:[255,254,52]},{fromColor:[0,253,255],toColor:[0,181,255]},{fromColor:[0,181,255],toColor:[26,35,253]},{fromColor:[26,35,253],toColor:[255,57,251]},{fromColor:[255,57,251],toColor:[255,45,8]}]},{id:`black-to-white`,fromColor:[0,0,0],toColor:[255,255,255]},{id:`blue-bright`,fromColor:[204,204,255],toColor:[0,0,224]},{id:`blue-light-to-dark`,fromColor:[211,229,232],toColor:[46,100,140]},{id:`blue-green-bright`,fromColor:[203,245,234],toColor:[48,207,146]},{id:`blue-green-light-to-dark`,fromColor:[216,242,237],toColor:[21,79,74]},{id:`brown-light-to-dark`,fromColor:[240,236,170],toColor:[102,72,48]},{id:`brown-to-blue-green-diverging-right`,type:`multipart`,colorRamps:[{fromColor:[156,85,31],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[33,130,145]}]},{id:`brown-to-blue-green-diverging-dark`,type:`multipart`,colorRamps:[{fromColor:[110,70,45],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[48,100,102]}]},{id:`coefficient-bias`,fromColor:[214,214,255],toColor:[0,57,148]},{id:`cold-to-hot-diverging`,type:`multipart`,colorRamps:[{fromColor:[69,117,181],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[214,47,39]}]},{id:`condition-number`,type:`multipart`,colorRamps:[{fromColor:[0,97,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,34,0]}]},{id:`cyan-to-purple`,type:`multipart`,colorRamps:[{fromColor:[0,245,245],toColor:[0,0,245]},{fromColor:[0,0,245],toColor:[245,0,245]}]},{id:`cyan-light-to-blue-dark`,type:`multipart`,colorRamps:[{fromColor:[182,237,240],toColor:[31,131,224]},{fromColor:[31,131,224],toColor:[9,9,145]}]},{id:`distance`,fromColor:[255,200,0],toColor:[0,0,255]},{id:`elevation1`,type:`multipart`,colorRamps:[{fromColor:[175,240,233],toColor:[255,255,179]},{fromColor:[255,255,179],toColor:[0,128,64]},{fromColor:[0,128,64],toColor:[252,186,3]},{fromColor:[252,186,3],toColor:[128,0,0]},{fromColor:[120,0,0],toColor:[105,48,13]},{fromColor:[105,48,13],toColor:[171,171,171]},{fromColor:[171,171,171],toColor:[255,252,255]}]},{id:`elevation2`,type:`multipart`,colorRamps:[{fromColor:[118,219,211],toColor:[255,255,199]},{fromColor:[255,255,199],toColor:[255,255,128]},{fromColor:[255,255,128],toColor:[217,194,121]},{fromColor:[217,194,121],toColor:[135,96,38]},{fromColor:[135,96,38],toColor:[150,150,181]},{fromColor:[150,150,181],toColor:[181,150,181]},{fromColor:[181,150,181],toColor:[255,252,255]}]},{id:`errors`,fromColor:[255,235,214],toColor:[196,10,10]},{id:`gray-light-to-dark`,fromColor:[219,219,219],toColor:[69,69,69]},{id:`green-bright`,fromColor:[204,255,204],toColor:[14,204,14]},{id:`green-light-to-dark`,fromColor:[220,245,233],toColor:[34,102,51]},{id:`green-to-blue`,type:`multipart`,colorRamps:[{fromColor:[32,204,16],toColor:[0,242,242]},{fromColor:[0,242,242],toColor:[2,33,227]}]},{id:`orange-bright`,fromColor:[255,235,204],toColor:[240,118,5]},{id:`orange-light-to-dark`,fromColor:[250,233,212],toColor:[171,65,36]},{id:`partial-spectrum`,type:`multipart`,colorRamps:[{fromColor:[242,241,162],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]},{fromColor:[252,3,69],toColor:[176,7,237]},{fromColor:[176,7,237],toColor:[2,29,173]}]},{id:`partial-spectrum-1-diverging`,type:`multipart`,colorRamps:[{fromColor:[135,38,38],toColor:[240,149,12]},{fromColor:[240,149,12],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[74,80,181]},{fromColor:[74,80,181],toColor:[39,32,122]}]},{id:`partial-spectrum-2-diverging`,type:`multipart`,colorRamps:[{fromColor:[115,77,42],toColor:[201,137,52]},{fromColor:[201,137,52],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[91,63,176]},{fromColor:[91,63,176],toColor:[81,13,97]}]},{id:`pink-to-yellow-green-diverging-bright`,type:`multipart`,colorRamps:[{fromColor:[158,30,113],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[99,110,45]}]},{id:`pink-to-yellow-green-diverging-dark`,type:`multipart`,colorRamps:[{fromColor:[97,47,73],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[22,59,15]}]},{id:`precipitation`,type:`multipart`,colorRamps:[{fromColor:[194,82,60],toColor:[237,161,19]},{fromColor:[237,161,19],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,219,0]},{fromColor:[0,219,0],toColor:[32,153,143]},{fromColor:[32,153,143],toColor:[11,44,122]}]},{id:`prediction`,type:`multipart`,colorRamps:[{fromColor:[40,146,199],toColor:[250,250,100]},{fromColor:[250,250,100],toColor:[232,16,20]}]},{id:`purple-bright`,fromColor:[255,204,255],toColor:[199,0,199]},{id:`purple-to-green-diverging-bright`,type:`multipart`,colorRamps:[{fromColor:[77,32,150],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[20,122,11]}]},{id:`purple-to-green-diverging-dark`,type:`multipart`,colorRamps:[{fromColor:[67,14,89],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[24,79,15]}]},{id:`purple-blue-bright`,fromColor:[223,184,230],toColor:[112,12,242]},{id:`purple-blue-light-to-dark`,fromColor:[229,213,242],toColor:[93,44,112]},{id:`purple-red-bright`,fromColor:[255,204,225],toColor:[199,0,99]},{id:`purple-red-light-to-dark`,fromColor:[250,215,246],toColor:[143,17,57]},{id:`red-bright`,fromColor:[255,204,204],toColor:[219,0,0]},{id:`red-light-to-dark`,fromColor:[255,224,224],toColor:[143,10,10]},{id:`red-to-blue-diverging-bright`,type:`multipart`,colorRamps:[{fromColor:[196,69,57],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[48,95,207]}]},{id:`red-to-blue-diverging-dark`,type:`multipart`,colorRamps:[{fromColor:[107,13,13],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[13,53,97]}]},{id:`red-to-green`,type:`multipart`,colorRamps:[{fromColor:[245,0,0],toColor:[245,245,0]},{fromColor:[245,245,0],toColor:[0,245,0]}]},{id:`red-to-green-diverging-bright`,type:`multipart`,colorRamps:[{fromColor:[186,20,20],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[54,145,33]}]},{id:`red-to-green-diverging-dark`,type:`multipart`,colorRamps:[{fromColor:[97,21,13],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[16,69,16]}]},{id:`slope`,type:`multipart`,colorRamps:[{fromColor:[56,168,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]}]},{id:`spectrum-full-bright`,type:`multipart`,colorRamps:[{fromColor:[255,0,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,0,255]}]},{id:`spectrum-full-dark`,type:`multipart`,colorRamps:[{fromColor:[153,0,0],toColor:[153,153,0]},{fromColor:[153,153,0],toColor:[0,153,153]},{fromColor:[0,153,153],toColor:[0,0,153]}]},{id:`spectrum-full-light`,type:`multipart`,colorRamps:[{fromColor:[255,153,153],toColor:[255,255,153]},{fromColor:[255,255,153],toColor:[153,255,255]},{fromColor:[153,255,255],toColor:[153,153,255]}]},{id:`surface`,type:`multipart`,colorRamps:[{fromColor:[112,153,89],toColor:[242,238,162]},{fromColor:[242,238,162],toColor:[242,206,133]},{fromColor:[242,206,133],toColor:[194,140,124]},{fromColor:[194,140,124],toColor:[255,242,255]}]},{id:`temperature`,type:`multipart`,colorRamps:[{fromColor:[255,252,255],toColor:[255,0,255]},{fromColor:[255,0,255],toColor:[0,0,255]},{fromColor:[0,0,255],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,255,0]},{fromColor:[0,255,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,128,0]},{fromColor:[255,128,0],toColor:[128,0,0]}]},{id:`white-to-black`,fromColor:[255,255,255],toColor:[0,0,0]},{id:`yellow-to-dark-red`,type:`multipart`,colorRamps:[{fromColor:[255,255,128],toColor:[242,167,46]},{fromColor:[242,167,46],toColor:[107,0,0]}]},{id:`yellow-to-green-to-dark-blue`,type:`multipart`,colorRamps:[{fromColor:[255,255,128],toColor:[56,224,9]},{fromColor:[56,224,9],toColor:[26,147,171]},{fromColor:[26,147,171],toColor:[12,16,120]}]},{id:`yellow-to-red`,fromColor:[245,245,0],toColor:[255,0,0]},{id:`yellow-green-bright`,fromColor:[236,252,204],toColor:[157,204,16]},{id:`yellow-green-light-to-dark`,fromColor:[215,240,175],toColor:[96,107,45]}],R=new u({Aspect:`aspect`,"Black to White":`black-to-white`,"Blue Bright":`blue-bright`,"Blue Light to Dark":`blue-light-to-dark`,"Blue-Green Bright":`blue-green-bright`,"Blue-Green Light to Dark":`blue-green-light-to-dark`,"Brown Light to Dark":`brown-light-to-dark`,"Brown to Blue Green Diverging, Bright":`brown-to-blue-green-diverging-right`,"Brown to Blue Green Diverging, Dark":`brown-to-blue-green-diverging-dark`,"Coefficient Bias":`coefficient-bias`,"Cold to Hot Diverging":`cold-to-hot-diverging`,"Condition Number":`condition-number`,"Cyan to Purple":`cyan-to-purple`,"Cyan-Light to Blue-Dark":`cyan-light-to-blue-dark`,Distance:`distance`,"Elevation #1":`elevation1`,"Elevation #2":`elevation2`,Errors:`errors`,"Gray Light to Dark":`gray-light-to-dark`,"Green Bright":`green-bright`,"Green Light to Dark":`green-light-to-dark`,"Green to Blue":`green-to-blue`,"Orange Bright":`orange-bright`,"Orange Light to Dark":`orange-light-to-dark`,"Partial Spectrum":`partial-spectrum`,"Partial Spectrum 1 Diverging":`partial-spectrum-1-diverging`,"Partial Spectrum 2 Diverging":`partial-spectrum-2-diverging`,"Pink to YellowGreen Diverging, Bright":`pink-to-yellow-green-diverging-bright`,"Pink to YellowGreen Diverging, Dark":`pink-to-yellow-green-diverging-dark`,Precipitation:`precipitation`,Prediction:`prediction`,"Purple Bright":`purple-bright`,"Purple to Green Diverging, Bright":`purple-to-green-diverging-bright`,"Purple to Green Diverging, Dark":`purple-to-green-diverging-dark`,"Purple-Blue Bright":`purple-blue-bright`,"Purple-Blue Light to Dark":`purple-blue-light-to-dark`,"Purple-Red Bright":`purple-red-bright`,"Purple-Red Light to Dark":`purple-red-light-to-dark`,"Red Bright":`red-bright`,"Red Light to Dark":`red-light-to-dark`,"Red to Blue Diverging, Bright":`red-to-blue-diverging-bright`,"Red to Blue Diverging, Dark":`red-to-blue-diverging-dark`,"Red to Green":`red-to-green`,"Red to Green Diverging, Bright":`red-to-green-diverging-bright`,"Red to Green Diverging, Dark":`red-to-green-diverging-dark`,Slope:`slope`,"Spectrum-Full Bright":`spectrum-full-bright`,"Spectrum-Full Dark":`spectrum-full-dark`,"Spectrum-Full Light":`spectrum-full-light`,Surface:`surface`,Temperature:`temperature`,"White to Black":`white-to-black`,"Yellow to Dark Red":`yellow-to-dark-red`,"Yellow to Green to Dark Blue":`yellow-to-green-to-dark-blue`,"Yellow to Red":`yellow-to-red`,"Yellow-Green Bright":`yellow-green-bright`,"Yellow-Green Light to Dark":`yellow-green-light-to-dark`});function z(e,t){if(!e||!t||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]>t[n]+2||e[n]<t[n]-2)return!1;return!0}function te(e){let t=e.clone();return t.fromColor=e.toColor,t.toColor=e.fromColor,t}function ne(e){if(e.type===`multipart`){let t=e.clone();return t.colorRamps?.length&&(t.colorRamps=t.colorRamps.reverse().map(e=>te(e))),t}return te(e)}function B(e,t){let n=t??L;if(e.type===`algorithmic`){let t=e.fromColor.toRgb(),r=e.toColor.toRgb();return n.find(e=>z(t,e.fromColor)&&z(r,e.toColor))?.id}if(e.weights?.length)return;let r=e.colorRamps?.map(e=>({fromColor:e.fromColor.toRgb(),toColor:e.toColor.toRgb()}));return n.find(e=>{let t=e.colorRamps;return!(!r||!t||r.length!==t.length)&&t.every((e,t)=>z(r[t].fromColor,e.fromColor)&&z(r[t].toColor,e.toColor))})?.id}function re(e,t,n=!1){if(!e)return;let r=!1,i=B(e,t);return i!=null||n||(r=!0,i=B(e=ne(e),t)),i?{id:i,inverted:r}:void 0}function V(e,t=!1){let n=typeof e==`string`?e:re(e,void 0,t)?.id;return n?R.toJSON(n):null}function ie(e,t=`esriCIELabAlgorithm`){let n=L.find(({id:t})=>t===e);return n?n.colorRamps?{type:`multipart`,colorRamps:n.colorRamps.map(e=>({type:`algorithmic`,algorithm:t,fromColor:[...e.fromColor],toColor:[...e.toColor]}))}:{type:`algorithmic`,algorithm:t,fromColor:[...n.fromColor],toColor:[...n.toColor]}:null}function ae(e){e??={};let t=e.numColors||256,n=e.distanceOffset||0,r=e.isCustomInterval==null?e.distanceInterval!==null&&e.distanceInterval!==1/(t-1):e.isCustomInterval,i=e.distanceInterval||1/(t-1);return{...e,numColors:t,distanceOffset:n,interpolateAlpha:!!e.interpolateAlpha,distanceInterval:i,isCustomInterval:r,weights:e.weights}}function oe(e,t,n){let{numColors:r,distanceOffset:i,distanceInterval:a,isCustomInterval:o}=n,s=e.s===0,c=t.s===0,l=e.h,u=t.h;s&&!c?l=u:c&&!s&&(t={...t,h:l},u=l);let d=Math.abs(u-l),f=0;d<360/2?f=(u-l)*a:(d=360-d,f=l>u?d*a:-d*a);let p=(t.s-e.s)*a,m=(t.v-e.v)*a,{s:h,v:g}=e,_=l;if(i){let e=i/a;_=(_+e*f+360)%360,h+=e*p,g+=e*m}let v=[];for(let e=0;e<r-1;e++)v.push({h:_,s:h,v:g}),_=(_+f+360)%360,h+=p,g+=m;return v.push(o?{h:_,s:h,v:g}:t),v}function se(e,t,n){let{numColors:r,distanceOffset:i,distanceInterval:a,isCustomInterval:o}=n,{l:s,a:c,b:l}=e,u=(t.l-s)*a,d=(t.a-c)*a,f=(t.b-l)*a,p=[];if(i){let e=i/a;s+=e*u,c+=e*d,l+=e*f}for(let e=0;e<r-1;e++)p.push({l:s,a:c,b:l}),s+=u,c+=d,l+=f;return p.push(o?{l:s,a:c,b:l}:t),p}function ce(e,t,n){let{numColors:r,distanceOffset:i,distanceInterval:a,isCustomInterval:o}=n,s=e.h,c=t.h,l=2*Math.PI,u=0;if(s<=c){let e=c-s,t=c-s-l;u=Math.abs(t)<Math.abs(e)?t:e}else{let e=c+l-s,t=c-s;u=Math.abs(t)<Math.abs(e)?t:e}let d=u*a,f=(t.l-e.l)*a,p=(t.c-e.c)*a,{l:m,c:h,h:g}=e;if(i){let e=i/a;m+=e*f,h+=e*p,g=(g+e*d+l)%l}let _=[];for(let e=0;e<r-1;e++)_.push({l:m,c:h,h:g}),m+=f,h+=p,g=(g+d+l)%l;return _.push(o?{l:m,c:h,h:g}:t),_}function le(e,t){let{fromColor:n,toColor:r}=e,i=n.length===3?[...n,255]:[...n],a=r.length===3?[...r,255]:[...r],o=e.algorithm||`esriCIELabAlgorithm`,s=ae(t),{numColors:c,distanceOffset:l,isCustomInterval:u,interpolateAlpha:d}=s;if(c===1&&l===0)return[i];if(c===2&&l===0&&!u)return[i,a];let f={r:i[0],g:i[1],b:i[2]},p={r:a[0],g:a[1],b:a[2]},m=o===`esriCIELabAlgorithm`?se(T(f),T(p),s):o===`esriHSVAlgorithm`?oe(E(f),E(p),s):ce(w(f),w(p),s),h=[],g=i[3]??255,_=((a[3]??255)-g)/(c-1);for(let e=0;e<c;e++){let{r:t,g:n,b:r}=C(m[e]),i=d?Math.round(g+_*e):255;h.push([t,n,r,i])}return h}function ue(e,t){let{colorRamps:n}=e;if(t??=n.map(({start:e,stop:t})=>e==null||t==null?-1:t-e),t.length!==n.length||t.some(e=>e<0))return Array.from({length:n.length},()=>1/n.length);let r=t.reduce((e,t)=>e+t);return t.map(e=>e/r)}function de(e,t){let{numColors:n,interpolateAlpha:r}=ae(t),i=ue(e,t?.weights),{colorRamps:a}=e,o=[],s=1/(n-1),c=0,l=!1;for(let e=0;e<a.length;e++){let t=o.length,u=l?0:t*s-c;c+=i[e];let d=e===a.length-1?n-1-t:(i[e]-u)/s;if(l=Math.ceil(d)===d,d=Math.ceil(d),d===0)continue;let f=le(a[e],{numColors:d,interpolateAlpha:r,distanceOffset:u/i[e],distanceInterval:s/i[e]});o.push(...f)}let u=[...a[a.length-1].toColor];return u.length===3&&u.push(255),o.push(u),o}function fe(e,t){let n=f(e)?e.toJSON():e;return n.type===`multipart`?de(n,t):le(n,t)}function pe(e,t){let n=fe(e,t),r=t?.interpolateAlpha;return n.forEach((e,t)=>{e.unshift(t),r||e.pop()}),n}function me(e){let t=[];for(let n=0;n<e.length;n+=4){let r=E({r:e[n],g:e[n+1],b:e[n+2]});t.push([r.h/60,r.s/100,255*r.v/100])}return t}function he(e){let t=E(e);return{type:`HsvColor`,Hue:t.h,Saturation:t.s,Value:t.v,AlphaValue:255}}function ge(e){return{Algorithm:e.toJSON()?.Algorithm||`esriHSVAlgorithm`,type:`AlgorithmicColorRamp`,FromColor:he(e.fromColor),ToColor:he(e.toColor)}}function _e(e){let t=V(e);if(!t)return null;if(e.type===`algorithmic`)return{...ge(e),Name:t};if(e.colorRamps){let n=e.colorRamps.map(ge);return{type:`MultiPartColorRamp`,NumColorRamps:n.length,ArrayOfColorRamp:n,Name:t}}return null}function ve(e){let t=[...e].reverse().map(e=>{let t=e.toString(16);return t.length<2?`0`+t:t});return 4294967295&Number.parseInt(t.join(``),16)}var ye=new u({none:`none`,standardDeviation:`standard-deviation`,histogramEqualization:`histogram-equalization`,minMax:`min-max`,percentClip:`percent-clip`,sigmoid:`sigmoid`}),be={0:`none`,3:`standardDeviation`,4:`histogramEqualization`,5:`minMax`,6:`percentClip`,9:`sigmoid`},xe;function H(e){return e=Number(e),isNaN(e)?void 0:e}var U=class extends v{constructor(){super(...arguments),this.name=null,this.minWavelength=void 0,this.maxWavelength=void 0,this.radianceBias=void 0,this.radianceGain=void 0,this.reflectanceBias=void 0,this.reflectanceGain=void 0,this.solarIrradiance=void 0}static{xe=this}clone(){return new xe({name:this.name,minWavelength:this.minWavelength,maxWavelength:this.maxWavelength,radianceBias:this.radianceBias,radianceGain:this.radianceGain,reflectanceBias:this.reflectanceBias,reflectanceGain:this.reflectanceGain,solarIrradiance:this.solarIrradiance})}};n([a({json:{name:`BandName`,write:!0}})],U.prototype,`name`,void 0),n([a({json:{read:{source:[`WavelengthMin`,`Wavelength`],reader:(e,t)=>H(t.WavelengthMin??t.Wavelength)},write:{target:`WavelengthMin`}}})],U.prototype,`minWavelength`,void 0),n([a({json:{name:`WavelengthMax`,read:{reader:H},write:!0}})],U.prototype,`maxWavelength`,void 0),n([a({json:{name:`RadianceBias`,read:{reader:H},write:!0}})],U.prototype,`radianceBias`,void 0),n([a({json:{name:`RadianceGain`,read:{reader:H},write:!0}})],U.prototype,`radianceGain`,void 0),n([a({json:{name:`ReflectanceBias`,read:{reader:H},write:!0}})],U.prototype,`reflectanceBias`,void 0),n([a({json:{name:`ReflectanceGain`,read:{reader:H},write:!0}})],U.prototype,`reflectanceGain`,void 0),n([a({json:{name:`SolarIrradiance`,read:{reader:H},write:!0}})],U.prototype,`solarIrradiance`,void 0),U=xe=n([m(`esri.layers.support.RasterBandInfo`)],U);var Se;function Ce(e){return e=Number(e),isNaN(e)?void 0:e}var W=Se=class extends v{constructor(){super(...arguments),this.acquisitionDate=void 0,this.cloudCover=void 0,this.productName=void 0,this.sensorName=null,this.sensorAzimuth=void 0,this.sensorElevation=void 0,this.sunAzimuth=void 0,this.sunElevation=void 0}readAcquisitionDate(e){return new Date(e)}writeAcquisitionDate(e,t){t.AcquisitionDate=e.getTime()}clone(){return new Se({acquisitionDate:this.acquisitionDate,cloudCover:this.cloudCover,productName:this.productName,sensorName:this.sensorName,sensorAzimuth:this.sensorAzimuth,sensorElevation:this.sensorElevation,sunAzimuth:this.sunAzimuth,sunElevation:this.sunElevation})}};n([a({type:Date,json:{name:`AcquisitionDate`,write:!0}})],W.prototype,`acquisitionDate`,void 0),n([i(`acquisitionDate`)],W.prototype,`readAcquisitionDate`,null),n([g(`acquisitionDate`)],W.prototype,`writeAcquisitionDate`,null),n([a({json:{name:`CloudCover`,read:{reader:Ce},write:!0}})],W.prototype,`cloudCover`,void 0),n([a({json:{name:`ProductName`,write:!0}})],W.prototype,`productName`,void 0),n([a({json:{name:`SensorName`,write:!0}})],W.prototype,`sensorName`,void 0),n([a({json:{name:`SensorAzimuth`,read:{reader:Ce},write:!0}})],W.prototype,`sensorAzimuth`,void 0),n([a({json:{name:`SensorElevation`,read:{reader:Ce},write:!0}})],W.prototype,`sensorElevation`,void 0),n([a({json:{name:`SunAzimuth`,read:{reader:Ce},write:!0}})],W.prototype,`sunAzimuth`,void 0),n([a({json:{name:`SunElevation`,read:{reader:Ce},write:!0}})],W.prototype,`sunElevation`,void 0),W=Se=n([m(`esri.layers.support.RasterSensorInfo`)],W);var we,G=we=class extends v{constructor(){super(...arguments),this.blockWidth=void 0,this.blockHeight=void 0,this.compression=null,this.origin=null,this.firstPyramidLevel=null,this.maximumPyramidLevel=null,this.pyramidScalingFactor=2,this.pyramidBlockWidth=null,this.pyramidBlockHeight=null,this.isBsqTile=!1,this.isVirtualTileInfo=!1,this.tileInfo=null,this.transposeInfo=null,this.blockBoundary=null}clone(){return new we({blockWidth:this.blockWidth,blockHeight:this.blockHeight,compression:this.compression,origin:e(this.origin),firstPyramidLevel:this.firstPyramidLevel,maximumPyramidLevel:this.maximumPyramidLevel,pyramidResolutions:e(this.pyramidResolutions),pyramidScalingFactor:this.pyramidScalingFactor,pyramidBlockWidth:this.pyramidBlockWidth,pyramidBlockHeight:this.pyramidBlockHeight,isBsqTile:this.isBsqTile,isVirtualTileInfo:this.isVirtualTileInfo,tileInfo:e(this.tileInfo),transposeInfo:e(this.transposeInfo),blockBoundary:e(this.blockBoundary)})}};n([a({type:Number,json:{write:!0}})],G.prototype,`blockWidth`,void 0),n([a({type:Number,json:{write:!0}})],G.prototype,`blockHeight`,void 0),n([a({type:String,json:{write:!0}})],G.prototype,`compression`,void 0),n([a({type:t,json:{write:!0}})],G.prototype,`origin`,void 0),n([a({type:Number,json:{write:!0}})],G.prototype,`firstPyramidLevel`,void 0),n([a({type:Number,json:{write:!0}})],G.prototype,`maximumPyramidLevel`,void 0),n([a({json:{write:!0}})],G.prototype,`pyramidResolutions`,void 0),n([a({type:Number,json:{write:!0}})],G.prototype,`pyramidScalingFactor`,void 0),n([a({type:Number,json:{write:!0}})],G.prototype,`pyramidBlockWidth`,void 0),n([a({type:Number,json:{write:!0}})],G.prototype,`pyramidBlockHeight`,void 0),n([a({json:{write:!0}})],G.prototype,`isBsqTile`,void 0),n([a({type:Boolean,json:{write:!0}})],G.prototype,`isVirtualTileInfo`,void 0),n([a({json:{write:!0}})],G.prototype,`tileInfo`,void 0),n([a()],G.prototype,`transposeInfo`,void 0),n([a({json:{write:!0}})],G.prototype,`blockBoundary`,void 0),G=we=n([m(`esri.layers.support.RasterStorageInfo`)],G);var Te,K=Te=class extends v{constructor(e){super(e),this.attributeTable=null,this.bandCount=null,this.colormap=null,this.extent=null,this.format=void 0,this.height=null,this.width=null,this.histograms=null,this.keyProperties={},this.multidimensionalInfo=null,this.noDataValue=null,this.pixelSize=null,this.pixelType=null,this.isPseudoSpatialReference=!1,this.spatialReference=null,this.statistics=null,this.storageInfo=null,this.transform=null}get bandInfos(){let e=this.keyProperties.BandProperties,{bandCount:t}=this;if(!e?.length||e.length<t){let e=[];for(let n=1;n<=t;n++)e.push(new U({name:`band_`+n}));return e}let n=e.map(e=>U.fromJSON(e));for(let e=0;e<n.length;e++)n[e].name=n[e].name||`band_`+(e+1);return n}get dataType(){let e=this.keyProperties?.DataType?.toLowerCase()??`generic`;return e===`stdtime`?`standard-time`:e}get nativeExtent(){return this._get(`nativeExtent`)||this.extent}set nativeExtent(e){e&&this._set(`nativeExtent`,e)}get nativePixelSize(){if(this.transform==null||!this.transform.affectsPixelSize)return this.pixelSize;let e=this.nativeExtent;return{x:e.width/this.width,y:e.height/this.height}}get hasMultidimensionalTranspose(){return!!this.storageInfo?.transposeInfo}get sensorInfo(){if(this.keyProperties?.SensorName)return W.fromJSON(this.keyProperties)}clone(){return new Te({attributeTable:e(this.attributeTable),bandCount:this.bandCount,colormap:e(this.colormap),extent:e(this.extent),format:this.format,height:this.height,width:this.width,histograms:e(this.histograms),keyProperties:e(this.keyProperties),multidimensionalInfo:e(this.multidimensionalInfo),noDataValue:this.noDataValue,pixelSize:e(this.pixelSize),pixelType:this.pixelType,isPseudoSpatialReference:this.isPseudoSpatialReference,spatialReference:e(this.spatialReference),statistics:e(this.statistics),storageInfo:e(this.storageInfo),transform:e(this.transform)})}};n([a({json:{write:!0}})],K.prototype,`attributeTable`,void 0),n([a({json:{write:!0}})],K.prototype,`bandCount`,void 0),n([a({readOnly:!0})],K.prototype,`bandInfos`,null),n([a({json:{write:!0}})],K.prototype,`colormap`,void 0),n([a({type:String,readOnly:!0})],K.prototype,`dataType`,null),n([a({type:o,json:{write:!0}})],K.prototype,`extent`,void 0),n([a({type:o,json:{write:!0}})],K.prototype,`nativeExtent`,null),n([a({json:{write:!0}})],K.prototype,`nativePixelSize`,null),n([a({json:{write:!0}})],K.prototype,`format`,void 0),n([a({json:{write:!0}})],K.prototype,`height`,void 0),n([a({json:{write:!0}})],K.prototype,`width`,void 0),n([a({json:{write:!0}})],K.prototype,`hasMultidimensionalTranspose`,null),n([a({json:{write:!0}})],K.prototype,`histograms`,void 0),n([a({json:{write:!0}})],K.prototype,`keyProperties`,void 0),n([a({json:{write:!0}})],K.prototype,`multidimensionalInfo`,void 0),n([a({json:{write:!0}})],K.prototype,`noDataValue`,void 0),n([a({json:{write:!0}})],K.prototype,`pixelSize`,void 0),n([a({type:I.apiValues,json:{write:!0}})],K.prototype,`pixelType`,void 0),n([a()],K.prototype,`isPseudoSpatialReference`,void 0),n([a({readOnly:!0})],K.prototype,`sensorInfo`,null),n([a({type:s,json:{write:!0}})],K.prototype,`spatialReference`,void 0),n([a({json:{write:!0}})],K.prototype,`statistics`,void 0),n([a({type:G,json:{write:!0}})],K.prototype,`storageInfo`,void 0),n([a({json:{write:!0}})],K.prototype,`transform`,void 0),K=Te=n([m(`esri.layers.support.RasterInfo`)],K);var Ee,De={exports:{}};function Oe(){return Ee||(Ee=1,t=De,(e=function(){function e(){this.pos=0,this.bufferLength=0,this.eof=!1,this.buffer=null}return e.prototype={ensureBuffer:function(e){var t=this.buffer,n=t?t.byteLength:0;if(e<n)return t;for(var r=512;r<e;)r<<=1;for(var i=new Uint8Array(r),a=0;a<n;++a)i[a]=t[a];return this.buffer=i},getByte:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},getBytes:function(e){var t=this.pos;if(e){this.ensureBuffer(t+e);for(var n=t+e;!this.eof&&this.bufferLength<n;)this.readBlock();var r=this.bufferLength;n>r&&(n=r)}else{for(;!this.eof;)this.readBlock();n=this.bufferLength}return this.pos=n,this.buffer.subarray(t,n)},lookChar:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(e,t,n){for(var r=e+t;this.bufferLength<=r&&!this.eof;)this.readBlock();return new Stream(this.buffer,e,t,n)},skip:function(e){e||=1,this.pos+=e},reset:function(){this.pos=0}},e}(),n=function(){if(!self||!self.Uint32Array)return null;var t=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),n=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),r=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),i=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59e4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],a=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];function o(e){throw Error(e)}function s(t){var n=0,r=t[n++],i=t[n++];r!=-1&&i!=-1||o(`Invalid header in flate stream`),(15&r)!=8&&o(`Unknown compression method in flate stream`),((r<<8)+i)%31!=0&&o(`Bad FCHECK in flate stream`),32&i&&o(`FDICT bit set in flate stream`),this.bytes=t,this.bytesPos=n,this.codeSize=0,this.codeBuf=0,e.call(this)}return s.prototype=Object.create(e.prototype),s.prototype.getBits=function(e){for(var t,n=this.codeSize,r=this.codeBuf,i=this.bytes,a=this.bytesPos;n<e;)(t=i[a++])===void 0&&o(`Bad encoding in flate stream`),r|=t<<n,n+=8;return t=r&(1<<e)-1,this.codeBuf=r>>e,this.codeSize=n-=e,this.bytesPos=a,t},s.prototype.getCode=function(e){for(var t=e[0],n=e[1],r=this.codeSize,i=this.codeBuf,a=this.bytes,s=this.bytesPos;r<n;){var c;(c=a[s++])===void 0&&o(`Bad encoding in flate stream`),i|=c<<r,r+=8}var l=t[i&(1<<n)-1],u=l>>16,d=65535&l;return(r==0||r<u||u==0)&&o(`Bad encoding in flate stream`),this.codeBuf=i>>u,this.codeSize=r-u,this.bytesPos=s,d},s.prototype.generateHuffmanTable=function(e){for(var t=e.length,n=0,r=0;r<t;++r)e[r]>n&&(n=e[r]);for(var i=1<<n,a=new Uint32Array(i),o=1,s=0,c=2;o<=n;++o,s<<=1,c<<=1)for(var l=0;l<t;++l)if(e[l]==o){var u=0,d=s;for(r=0;r<o;++r)u=u<<1|1&d,d>>=1;for(r=u;r<i;r+=c)a[r]=o<<16|l;++s}return[a,n]},s.prototype.readBlock=function(){function e(e,t,n,r,i){for(var a=e.getBits(n)+r;a-- >0;)t[m++]=i}var s=this.getBits(3);if(1&s&&(this.eof=!0),(s>>=1)!=0){var c,l;if(s==1)c=i,l=a;else if(s==2){for(var u=this.getBits(5)+257,d=this.getBits(5)+1,f=this.getBits(4)+4,p=Array(t.length),m=0;m<f;)p[t[m++]]=this.getBits(3);for(var h=this.generateHuffmanTable(p),g=0,_=(m=0,u+d),v=Array(_);m<_;){var y=this.getCode(h);y==16?e(this,v,2,3,g):y==17?e(this,v,3,3,g=0):y==18?e(this,v,7,11,g=0):v[m++]=g=y}c=this.generateHuffmanTable(v.slice(0,u)),l=this.generateHuffmanTable(v.slice(u,_))}else o(`Unknown block type in flate stream`);for(var b=(M=this.buffer)?M.length:0,x=this.bufferLength;;){var S=this.getCode(c);if(S<256)x+1>=b&&(b=(M=this.ensureBuffer(x+1)).length),M[x++]=S;else{if(S==256)return void(this.bufferLength=x);var C=(S=n[S-=257])>>16;C>0&&(C=this.getBits(C)),g=(65535&S)+C,S=this.getCode(l),(C=(S=r[S])>>16)>0&&(C=this.getBits(C));var w=(65535&S)+C;x+g>=b&&(b=(M=this.ensureBuffer(x+g)).length);for(var T=0;T<g;++T,++x)M[x]=M[x-w]}}}else{var E,D=this.bytes,O=this.bytesPos;(E=D[O++])===void 0&&o(`Bad block header in flate stream`);var k=E;(E=D[O++])===void 0&&o(`Bad block header in flate stream`),k|=E<<8,(E=D[O++])===void 0&&o(`Bad block header in flate stream`);var A=E;(E=D[O++])===void 0&&o(`Bad block header in flate stream`),(A|=E<<8)!=(65535&~k)&&o(`Bad uncompressed block length in flate stream`),this.codeBuf=0,this.codeSize=0;var j=this.bufferLength,M=this.ensureBuffer(j+k),N=j+k;this.bufferLength=N;for(var P=j;P<N;++P){if((E=D[O++])===void 0){this.eof=!0;break}M[P]=E}this.bytesPos=O}},s}())!==void 0&&(t.exports=n)),De.exports;var e,t,n}var ke=b(Oe()),Ae=class e{constructor(e){this._canvas=null,this._ctx=null,e&&(this._canvas=e.canvas,this._ctx=e.ctx||e.canvas&&e.canvas.getContext(`2d`))}decode(t,n,r){if(!t||t.byteLength<10)throw new l(`imagecanvasdecoder: decode`,`required a valid encoded data as input.`);let{width:i=0,height:a=0,format:o}=n,{applyJpegMask:s}=n;if(s&&(!i||!a))throw new l(`imagecanvasdecoder: decode`,`image width and height are needed to apply jpeg mask directly to canvas`);return new Promise((l,u)=>{let f=null;o===`jpg`&&s&&(f=e._getMask(t,{width:i,height:a}));let p=new Blob([new Uint8Array(t)],{type:`image/`+o==`jpg`?`jpeg`:o}),m=URL.createObjectURL(p),h=new Image,g;h.src=m,h.onload=()=>{if(URL.revokeObjectURL(m),c(r))return void u(d());i=h.width,a=h.height,this._canvas&&this._ctx?(this._canvas.width===i&&this._canvas.height===a||(this._canvas.width=i,this._canvas.height=a),this._ctx.clearRect(0,0,i,a)):(this._canvas=document.createElement(`canvas`),this._canvas.width=i,this._canvas.height=a,this._ctx=this._canvas.getContext(`2d`)),this._ctx.drawImage(h,0,0);let e=this._ctx.getImageData(0,0,i,a),t;if(g=e.data,n.renderOnCanvas){if(f)for(t=0;t<f.length;t++)f[t]?g[4*t+3]=255:g[4*t+3]=0;this._ctx.putImageData(e,0,0),l(null);return}let o=i*a,s=new Uint8Array(o),p=new Uint8Array(o),_=new Uint8Array(o);if(f)for(t=0;t<o;t++)s[t]=g[4*t],p[t]=g[4*t+1],_[t]=g[4*t+2];else for(f=new Uint8Array(o),t=0;t<o;t++)s[t]=g[4*t],p[t]=g[4*t+1],_[t]=g[4*t+2],f[t]=g[4*t+3];l({width:i,height:a,pixels:[s,p,_],mask:f,pixelType:`u8`})},h.onerror=()=>{URL.revokeObjectURL(m),u(`cannot load image`)}})}static _getMask(e,t){let n=null;try{let r=new Uint8Array(e),i=Math.ceil(r.length/2),a=0,o=r.length-2;for(a=i;a<o&&(r[a]!==255||r[a+1]!==217);a++);if(a+=2,a<r.length-1){let e=new ke(r.subarray(a)).getBytes();n=new Uint8Array(t.width*t.height);let i=0;for(let t=0;t<e.length;t++)for(let r=7;r>=0;r--)n[i++]=e[t]>>r&1}}catch{}return n}},je,Me={exports:{}};function Ne(){return je||(je=1,e=Me,t=function(){var e=function(){function e(e){this.message=`JPEG error: `+e}return e.prototype=Error(),e.prototype.name=`JpegError`,e.constructor=e,e}();return function(){if(!self||!self.Uint8ClampedArray)return null;var t=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),n=4017,r=799,i=3406,a=2276,o=1567,s=3784,c=5793,l=2896;function u(){this.decodeTransform=null,this.colorTransform=-1}function d(e,t){for(var n,r,i=0,a=[],o=16;o>0&&!e[o-1];)o--;a.push({children:[],index:0});var s,c=a[0];for(n=0;n<o;n++){for(r=0;r<e[n];r++){for((c=a.pop()).children[c.index]=t[i];c.index>0;)c=a.pop();for(c.index++,a.push(c);a.length<=n;)a.push(s={children:[],index:0}),c.children[c.index]=s.children,c=s;i++}n+1<o&&(a.push(s={children:[],index:0}),c.children[c.index]=s.children,c=s)}return a[0].children}function f(e,t,n){return 64*((e.blocksPerLine+1)*t+n)}function p(n,r,i,a,o,s,c,l,u){var d=i.mcusPerLine,p=i.progressive,m=r,h=0,_=0;function v(){if(_>0)return _--,h>>_&1;if((h=n[r++])===255){var t=n[r++];if(t)throw new e(`unexpected marker `+(h<<8|t).toString(16))}return _=7,h>>>7}function y(t){for(var n=t;;){if(typeof(n=n[v()])==`number`)return n;if(typeof n!=`object`)throw new e(`invalid huffman sequence`)}}function b(e){for(var t=0;e>0;)t=t<<1|v(),e--;return t}function x(e){if(e===1)return v()===1?1:-1;var t=b(e);return t>=1<<e-1?t:t+(-1<<e)+1}function S(e,n){var r=y(e.huffmanTableDC),i=r===0?0:x(r);e.blockData[n]=e.pred+=i;for(var a=1;a<64;){var o=y(e.huffmanTableAC),s=15&o,c=o>>4;if(s!==0){var l=t[a+=c];e.blockData[n+l]=x(s),a++}else{if(c<15)break;a+=16}}}function C(e,t){var n=y(e.huffmanTableDC),r=n===0?0:x(n)<<u;e.blockData[t]=e.pred+=r}function w(e,t){e.blockData[t]|=v()<<u}var T=0;function E(e,n){if(T>0)T--;else for(var r=s,i=c;r<=i;){var a=y(e.huffmanTableAC),o=15&a,l=a>>4;if(o!==0){var d=t[r+=l];e.blockData[n+d]=x(o)*(1<<u),r++}else{if(l<15){T=b(l)+(1<<l)-1;break}r+=16}}}var D,O=0;function k(n,r){for(var i,a,o=s,l=c,d=0;o<=l;){var f=t[o];switch(O){case 0:if(d=(a=y(n.huffmanTableAC))>>4,(i=15&a)==0)d<15?(T=b(d)+(1<<d),O=4):(d=16,O=1);else{if(i!==1)throw new e(`invalid ACn encoding`);D=x(i),O=d?2:3}continue;case 1:case 2:n.blockData[r+f]?n.blockData[r+f]+=v()<<u:--d===0&&(O=O===2?3:0);break;case 3:n.blockData[r+f]?n.blockData[r+f]+=v()<<u:(n.blockData[r+f]=D<<u,O=0);break;case 4:n.blockData[r+f]&&(n.blockData[r+f]+=v()<<u)}o++}O===4&&--T===0&&(O=0)}function A(e,t,n,r,i){var a=n%d;t(e,f(e,(n/d|0)*e.v+r,a*e.h+i))}function j(e,t,n){t(e,f(e,n/e.blocksPerLine|0,n%e.blocksPerLine))}var M,N,P,F,I,ee,L=a.length;ee=p?s===0?l===0?C:w:l===0?E:k:S;var R,z,te,ne,B=0;for(z=L===1?a[0].blocksPerLine*a[0].blocksPerColumn:d*i.mcusPerColumn;B<z;){var re=o?Math.min(z-B,o):z;for(N=0;N<L;N++)a[N].pred=0;if(T=0,L===1)for(M=a[0],I=0;I<re;I++)j(M,ee,B),B++;else for(I=0;I<re;I++){for(N=0;N<L;N++)for(te=(M=a[N]).h,ne=M.v,P=0;P<ne;P++)for(F=0;F<te;F++)A(M,ee,B,P,F);B++}_=0,(R=g(n,r))&&R.invalid&&(console.log(`decodeScan - unexpected MCU data, next marker is: `+R.invalid),r=R.offset);var V=R&&R.marker;if(!V||V<=65280)throw new e(`marker was not found`);if(!(V>=65488&&V<=65495))break;r+=2}return(R=g(n,r))&&R.invalid&&(console.log(`decodeScan - unexpected Scan data, next marker is: `+R.invalid),r=R.offset),r-m}function m(t,u,d){var f,p,m,h,g,_,v,y,b,x,S,C,w,T,E,D,O,k=t.quantizationTable,A=t.blockData;if(!k)throw new e(`missing required Quantization Table.`);for(var j=0;j<64;j+=8)b=A[u+j],x=A[u+j+1],S=A[u+j+2],C=A[u+j+3],w=A[u+j+4],T=A[u+j+5],E=A[u+j+6],D=A[u+j+7],b*=k[j],(x|S|C|w|T|E|D)===0?(O=c*b+512>>10,d[j]=O,d[j+1]=O,d[j+2]=O,d[j+3]=O,d[j+4]=O,d[j+5]=O,d[j+6]=O,d[j+7]=O):(x*=k[j+1],S*=k[j+2],C*=k[j+3],w*=k[j+4],T*=k[j+5],E*=k[j+6],D*=k[j+7],p=(f=(f=c*b+128>>8)+(p=c*w+128>>8)+1>>1)-p,O=(m=S)*s+(h=E)*o+128>>8,m=m*o-h*s+128>>8,v=(g=(g=l*(x-D)+128>>8)+(v=T<<4)+1>>1)-v,_=(y=(y=l*(x+D)+128>>8)+(_=C<<4)+1>>1)-_,h=(f=f+(h=O)+1>>1)-h,m=(p=p+m+1>>1)-m,O=g*a+y*i+2048>>12,g=g*i-y*a+2048>>12,y=O,O=_*r+v*n+2048>>12,_=_*n-v*r+2048>>12,v=O,d[j]=f+y,d[j+7]=f-y,d[j+1]=p+v,d[j+6]=p-v,d[j+2]=m+_,d[j+5]=m-_,d[j+3]=h+g,d[j+4]=h-g);for(var M=0;M<8;++M)b=d[M],((x=d[M+8])|(S=d[M+16])|(C=d[M+24])|(w=d[M+32])|(T=d[M+40])|(E=d[M+48])|(D=d[M+56]))===0?(O=(O=c*b+8192>>14)<-2040?0:O>=2024?255:O+2056>>4,A[u+M]=O,A[u+M+8]=O,A[u+M+16]=O,A[u+M+24]=O,A[u+M+32]=O,A[u+M+40]=O,A[u+M+48]=O,A[u+M+56]=O):(p=(f=4112+((f=c*b+2048>>12)+(p=c*w+2048>>12)+1>>1))-p,O=(m=S)*s+(h=E)*o+2048>>12,m=m*o-h*s+2048>>12,h=O,v=(g=(g=l*(x-D)+2048>>12)+(v=T)+1>>1)-v,_=(y=(y=l*(x+D)+2048>>12)+(_=C)+1>>1)-_,O=g*a+y*i+2048>>12,g=g*i-y*a+2048>>12,y=O,O=_*r+v*n+2048>>12,_=_*n-v*r+2048>>12,b=(b=(f=f+h+1>>1)+y)<16?0:b>=4080?255:b>>4,x=(x=(p=p+m+1>>1)+(v=O))<16?0:x>=4080?255:x>>4,S=(S=(m=p-m)+_)<16?0:S>=4080?255:S>>4,C=(C=(h=f-h)+g)<16?0:C>=4080?255:C>>4,w=(w=h-g)<16?0:w>=4080?255:w>>4,T=(T=m-_)<16?0:T>=4080?255:T>>4,E=(E=p-v)<16?0:E>=4080?255:E>>4,D=(D=f-y)<16?0:D>=4080?255:D>>4,A[u+M]=b,A[u+M+8]=x,A[u+M+16]=S,A[u+M+24]=C,A[u+M+32]=w,A[u+M+40]=T,A[u+M+48]=E,A[u+M+56]=D)}function h(e,t){for(var n=t.blocksPerLine,r=t.blocksPerColumn,i=new Int16Array(64),a=0;a<r;a++)for(var o=0;o<n;o++)m(t,f(t,a,o),i);return t.blockData}function g(e,t,n){function r(t){return e[t]<<8|e[t+1]}var i=e.length-1,a=n<t?n:t;if(t>=i)return null;var o=r(t);if(o>=65472&&o<=65534)return{invalid:null,marker:o,offset:t};for(var s=r(a);!(s>=65472&&s<=65534);){if(++a>=i)return null;s=r(a)}return{invalid:o.toString(16),marker:s,offset:a}}return u.prototype={parse:function(n){function r(){var e=n[c]<<8|n[c+1];return c+=2,e}function i(){var e=r(),t=c+e-2,i=g(n,t,c);i&&i.invalid&&(console.log(`readDataBlock - incorrect length, next marker is: `+i.invalid),t=i.offset);var a=n.subarray(c,t);return c+=a.length,a}function a(e){for(var t=Math.ceil(e.samplesPerLine/8/e.maxH),n=Math.ceil(e.scanLines/8/e.maxV),r=0;r<e.components.length;r++){L=e.components[r];var i=Math.ceil(Math.ceil(e.samplesPerLine/8)*L.h/e.maxH),a=Math.ceil(Math.ceil(e.scanLines/8)*L.v/e.maxV),o=t*L.h,s=n*L.v*64*(o+1);L.blockData=new Int16Array(s),L.blocksPerLine=i,L.blocksPerColumn=a}e.mcusPerLine=t,e.mcusPerColumn=n}var o,s,c=0,l=null,u=null,f=[],m=[],_=[],v=r();if(v!==65496)throw new e(`SOI not found`);for(v=r();v!==65497;){var y,b,x;switch(v){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var S=i();v===65504&&S[0]===74&&S[1]===70&&S[2]===73&&S[3]===70&&S[4]===0&&(l={version:{major:S[5],minor:S[6]},densityUnits:S[7],xDensity:S[8]<<8|S[9],yDensity:S[10]<<8|S[11],thumbWidth:S[12],thumbHeight:S[13],thumbData:S.subarray(14,14+3*S[12]*S[13])}),v===65518&&S[0]===65&&S[1]===100&&S[2]===111&&S[3]===98&&S[4]===101&&(u={version:S[5]<<8|S[6],flags0:S[7]<<8|S[8],flags1:S[9]<<8|S[10],transformCode:S[11]});break;case 65499:for(var C=r()+c-2;c<C;){var w=n[c++],T=new Uint16Array(64);if(w>>4){if(w>>4!=1)throw new e(`DQT - invalid table spec`);for(b=0;b<64;b++)T[t[b]]=r()}else for(b=0;b<64;b++)T[t[b]]=n[c++];f[15&w]=T}break;case 65472:case 65473:case 65474:if(o)throw new e(`Only single frame JPEGs supported`);r(),(o={}).extended=v===65473,o.progressive=v===65474,o.precision=n[c++],o.scanLines=r(),o.samplesPerLine=r(),o.components=[],o.componentIds={};var E,D=n[c++],O=0,k=0;for(y=0;y<D;y++){E=n[c];var A=n[c+1]>>4,j=15&n[c+1];O<A&&(O=A),k<j&&(k=j);var M=n[c+2];x=o.components.push({h:A,v:j,quantizationId:M,quantizationTable:null}),o.componentIds[E]=x-1,c+=3}o.maxH=O,o.maxV=k,a(o);break;case 65476:var N=r();for(y=2;y<N;){var P=n[c++],F=new Uint8Array(16),I=0;for(b=0;b<16;b++,c++)I+=F[b]=n[c];var ee=new Uint8Array(I);for(b=0;b<I;b++,c++)ee[b]=n[c];y+=17+I,(P>>4?m:_)[15&P]=d(F,ee)}break;case 65501:r(),s=r();break;case 65498:r();var L,R=n[c++],z=[];for(y=0;y<R;y++){var te=o.componentIds[n[c++]];L=o.components[te];var ne=n[c++];L.huffmanTableDC=_[ne>>4],L.huffmanTableAC=m[15&ne],z.push(L)}var B=n[c++],re=n[c++],V=n[c++],ie=p(n,c,o,z,s,B,re,V>>4,15&V);c+=ie;break;case 65535:n[c]!==255&&c--;break;default:if(n[c-3]===255&&n[c-2]>=192&&n[c-2]<=254){c-=3;break}throw new e(`unknown marker `+v.toString(16))}v=r()}for(this.width=o.samplesPerLine,this.height=o.scanLines,this.jfif=l,this.eof=c,this.adobe=u,this.components=[],y=0;y<o.components.length;y++){var ae=f[(L=o.components[y]).quantizationId];ae&&(L.quantizationTable=ae),this.components.push({output:h(o,L),scaleX:L.h/o.maxH,scaleY:L.v/o.maxV,blocksPerLine:L.blocksPerLine,blocksPerColumn:L.blocksPerColumn})}this.numComponents=this.components.length},_getLinearizedBlockData:function(e,t){var n,r,i,a,o,s,c,l,u,d,f,p=this.width/e,m=this.height/t,h=0,g=this.components.length,_=e*t*g,v=new Uint8ClampedArray(_),y=new Uint32Array(e),b=4294967288;for(c=0;c<g;c++){for(r=(n=this.components[c]).scaleX*p,i=n.scaleY*m,h=c,f=n.output,a=n.blocksPerLine+1<<3,o=0;o<e;o++)l=0|o*r,y[o]=(l&b)<<3|7&l;for(s=0;s<t;s++)for(d=a*((l=0|s*i)&b)|(7&l)<<3,o=0;o<e;o++)v[h]=f[d+y[o]],h+=g}var x=this.decodeTransform;if(x)for(c=0;c<_;)for(l=0,u=0;l<g;l++,c++,u+=2)v[c]=(v[c]*x[u]>>8)+x[u+1];return v},_isColorConversionNeeded:function(){return this.adobe?!!this.adobe.transformCode:this.numComponents===3?this.colorTransform!==0:this.colorTransform===1},_convertYccToRgb:function(e){for(var t,n,r,i=0,a=e.length;i<a;i+=3)t=e[i],n=e[i+1],r=e[i+2],e[i]=t-179.456+1.402*r,e[i+1]=t+135.459-.344*n-.714*r,e[i+2]=t-226.816+1.772*n;return e},_convertYcckToRgb:function(e){for(var t,n,r,i,a=0,o=0,s=e.length;o<s;o+=4)t=e[o],n=e[o+1],r=e[o+2],i=e[o+3],e[a++]=n*(-660635669420364e-19*n+.000437130475926232*r-54080610064599e-18*t+.00048449797120281*i-.154362151871126)-122.67195406894+r*(-.000957964378445773*r+.000817076911346625*t-.00477271405408747*i+1.53380253221734)+t*(.000961250184130688*t-.00266257332283933*i+.48357088451265)+i*(-.000336197177618394*i+.484791561490776),e[a++]=107.268039397724+n*(219927104525741e-19*n-.000640992018297945*r+.000659397001245577*t+.000426105652938837*i-.176491792462875)+r*(-.000778269941513683*r+.00130872261408275*t+.000770482631801132*i-.151051492775562)+t*(.00126935368114843*t-.00265090189010898*i+.25802910206845)+i*(-.000318913117588328*i-.213742400323665),e[a++]=n*(-.000570115196973677*n-263409051004589e-19*r+.0020741088115012*t-.00288260236853442*i+.814272968359295)-20.810012546947+r*(-153496057440975e-19*r-.000132689043961446*t+.000560833691242812*i-.195152027534049)+t*(.00174418132927582*t-.00255243321439347*i+.116935020465145)+i*(-.000343531996510555*i+.24165260232407);return e},_convertYcckToCmyk:function(e){for(var t,n,r,i=0,a=e.length;i<a;i+=4)t=e[i],n=e[i+1],r=e[i+2],e[i]=434.456-t-1.402*r,e[i+1]=119.541-t+.344*n+.714*r,e[i+2]=481.816-t-1.772*n;return e},_convertCmykToRgb:function(e){for(var t,n,r,i,a=0,o=1/255,s=0,c=e.length;s<c;s+=4)t=e[s]*o,n=e[s+1]*o,r=e[s+2]*o,i=e[s+3]*o,e[a++]=255+t*(-4.387332384609988*t+54.48615194189176*n+18.82290502165302*r+212.25662451639585*i-285.2331026137004)+n*(1.7149763477362134*n-5.6096736904047315*r-17.873870861415444*i-5.497006427196366)+r*(-2.5217340131683033*r-21.248923337353073*i+17.5119270841813)-i*(21.86122147463605*i+189.48180835922747),e[a++]=255+t*(8.841041422036149*t+60.118027045597366*n+6.871425592049007*r+31.159100130055922*i-79.2970844816548)+n*(-15.310361306967817*n+17.575251261109482*r+131.35250912493976*i-190.9453302588951)+r*(4.444339102852739*r+9.8632861493405*i-24.86741582555878)-i*(20.737325471181034*i+187.80453709719578),e[a++]=255+t*(.8842522430003296*t+8.078677503112928*n+30.89978309703729*r-.23883238689178934*i-14.183576799673286)+n*(10.49593273432072*n+63.02378494754052*r+50.606957656360734*i-112.23884253719248)+r*(.03296041114873217*r+115.60384449646641*i-193.58209356861505)-i*(22.33816807309886*i+180.12613974708367);return e},getData:function(t,n,r){if(this.numComponents>4)throw new e(`Unsupported color mode`);var i=this._getLinearizedBlockData(t,n);if(this.numComponents===1&&r){for(var a=i.length,o=new Uint8ClampedArray(3*a),s=0,c=0;c<a;c++){var l=i[c];o[s++]=l,o[s++]=l,o[s++]=l}return o}if(this.numComponents===3&&this._isColorConversionNeeded())return this._convertYccToRgb(i);if(this.numComponents===4){if(this._isColorConversionNeeded())return r?this._convertYcckToRgb(i):this._convertYcckToCmyk(i);if(r)return this._convertCmykToRgb(i)}return i}},u}()},(n=t())!==void 0&&(e.exports=n)),Me.exports;var e,t,n}var Pe=b(Ne()),Fe=class{static decode(e,t=!1){let n=new Uint8Array(e),r=new Pe;r.parse(n);let{width:i,height:a,numComponents:o,eof:s}=r,c=r.getData(i,a,!0),l=i*a,u,d=null,f=0,p=0,m=0;if(!t&&s<n.length-1)try{let e=new ke(n.subarray(s)).getBytes();d=new Uint8Array(l);let t=0;for(f=0;f<e.length;f++)for(m=7;m>=0;m--)d[t++]=e[f]>>m&1}catch{}if(o===1&&c.length===i*a){let e=new Uint8Array(c.buffer);u=[e,e,e]}else{for(u=[],f=0;f<3;f++)u.push(new Uint8Array(l));for(m=0,p=0;p<l;p++)for(f=0;f<3;f++)u[f][p]=c[m++]}return{width:i,height:a,pixels:u,mask:d}}},Ie=[{pixelType:`S8`,size:1,ctor:Int8Array,range:[-128,127]},{pixelType:`U8`,size:1,ctor:Uint8Array,range:[0,255]},{pixelType:`S16`,size:2,ctor:Int16Array,range:[-32768,32767]},{pixelType:`U16`,size:2,ctor:Uint16Array,range:[0,65536]},{pixelType:`S32`,size:4,ctor:Int32Array,range:[-2147483648,2147483647]},{pixelType:`U32`,size:4,ctor:Uint32Array,range:[0,4294967296]},{pixelType:`F32`,size:4,ctor:Float32Array,range:[-34027999387901484e22,34027999387901484e22]},{pixelType:`F64`,size:8,ctor:Float64Array,range:[-17976931348623157e292,17976931348623157e292]}],Le=null;function Re(){return Le||(Le=r(()=>import(`./lerc-wasm-ByvE-D0_.js`),__vite__mapDeps([0,1])).then(e=>e.l).then(({default:e})=>e({locateFile:e=>h(`esri/layers/support/rasterFormats/${e}`)})).then(e=>{Ve(e)}),Le)}var ze={getBlobInfo:null,decode:null};function Be(e){return 16+(e>>3<<3)}function q(e,t,n){n.set(e.slice(t,t+n.length))}function Ve(e){let{_malloc:t,_free:n,_lerc_getBlobInfo:r,_lerc_getDataRanges:i,_lerc_decode_4D:a,asm:o}=e,s,c=Object.values(o).find(t=>t&&`buffer`in t&&t.buffer===e.HEAPU8.buffer),l=e=>{let n=e.map(e=>Be(e)),r=n.reduce((e,t)=>e+t),i=t(r);s=new Uint8Array(c.buffer);let a=n[0];n[0]=i;for(let e=1;e<n.length;e++){let t=n[e];n[e]=n[e-1]+a,a=t}return n};ze.getBlobInfo=e=>{let t=new Uint8Array(48),a=new Uint8Array(24),[o,u,d]=l([e.length,t.length,a.length]);s.set(e,o),s.set(t,u),s.set(a,d);let f=r(o,e.length,u,d,12,3);if(f)throw n(o),Error(`lerc-getBlobInfo: error code is ${f}`);s=new Uint8Array(c.buffer),q(s,u,t),q(s,d,a);let p=new Uint32Array(t.buffer),m=new Float64Array(a.buffer),[h,g,,_,v,y,b,x,S,C,w]=p,T={version:h,depthCount:C,width:_,height:v,validPixelCount:b,bandCount:y,blobSize:x,maskCount:S,dataType:g,minValue:m[0],maxValue:m[1],maxZerror:m[2],statistics:[],bandCountWithNoData:w};if(w&&C>1)return n(o),T;if(C===1&&y===1)return n(o),T.statistics.push({minValue:m[0],maxValue:m[1]}),T;let E=C*y*8,D=new Uint8Array(E),O=new Uint8Array(E),k=o,A=0,j=0,M=!1;if(s.byteLength<o+2*E?(n(o),M=!0,[k,A,j]=l([e.length,E,E]),s.set(e,k)):[A,j]=l([E,E]),s.set(D,A),s.set(O,j),f=i(k,e.length,C,y,A,j),f)throw n(k),M||n(A),Error(`lerc-getDataRanges: error code is ${f}`);s=new Uint8Array(c.buffer),q(s,A,D),q(s,j,O);let N=new Float64Array(D.buffer),P=new Float64Array(O.buffer),F=T.statistics;for(let e=0;e<y;e++)if(C>1){let t=N.slice(e*C,(e+1)*C),n=P.slice(e*C,(e+1)*C),r=Math.min.apply(null,t),i=Math.max.apply(null,n);F.push({minValue:r,maxValue:i,depthStats:{minValues:t,maxValues:n}})}else F.push({minValue:N[e],maxValue:P[e]});return n(k),M||n(A),T},ze.decode=(e,t)=>{let{maskCount:r,depthCount:i,bandCount:o,width:u,height:d,dataType:f,bandCountWithNoData:p}=t,m=Ie[f],h=u*d,g=new Uint8Array(h*o),_=h*i*o*m.size,v=new Uint8Array(_),y=new Uint8Array(o),b=new Uint8Array(8*o),[x,S,C,w,T]=l([e.length,g.length,v.length,y.length,b.length]);s.set(e,x),s.set(g,S),s.set(v,C),s.set(y,w),s.set(b,T);let E=a(x,e.length,r,S,i,u,d,o,f,C,w,T);if(E)throw n(x),Error(`lerc-decode: error code is ${E}`);s=new Uint8Array(c.buffer),q(s,C,v),q(s,S,g);let D=null;if(p){q(s,w,y),q(s,T,b),D=[];let e=new Float64Array(b.buffer);for(let t=0;t<y.length;t++)D.push(y[t]?e[t]:null)}return n(x),{data:v,maskData:g,noDataValues:D}}}function He(e,t,n,r,i){if(n<2)return e;let a=new r(t*n);for(let r=0,i=0;r<t;r++)for(let o=0,s=r;o<n;o++,s+=t)a[s]=e[i++];return a}function Ue(e,t={}){let n=t.inputOffset??0,r=e instanceof Uint8Array?e.subarray(n):new Uint8Array(e,n),i=ze.getBlobInfo(r),{data:a,maskData:o,noDataValues:s}=ze.decode(r,i),{width:c,height:l,bandCount:u,depthCount:d,dataType:f,maskCount:p,statistics:m}=i,h=Ie[f],g=new h.ctor(a.buffer),_=[],v=[],y=c*l,b=y*d;for(let e=0;e<u;e++){let n=g.subarray(e*b,(e+1)*b);if(t.returnInterleaved)_.push(n);else{let e=He(n,y,d,h.ctor);_.push(e)}v.push(o.subarray(e*b,(e+1)*b))}let x=p===0?null:p===1?v[0]:new Uint8Array(y);if(p>1){x.set(v[0]);for(let e=1;e<v.length;e++){let t=v[e];for(let e=0;e<y;e++)x[e]=x[e]&t[e]}}let{noDataValue:S}=t,C=S!=null&&h.range[0]<=S&&h.range[1]>=S;if(p>0&&C)for(let e=0;e<u;e++){let t=_[e],n=v[e]||x;for(let e=0;e<y;e++)n[e]===0&&(t[e]=S)}let w=p===u&&u>1?v:null,{pixelType:T}=h;return{width:c,height:l,bandCount:u,pixelType:T,depthCount:d,statistics:m,pixels:_,mask:x,bandMasks:w,noDataValues:s}}function We(e,t,n,r=!0){if(t%4!=0||n%4!=0){let i=new ArrayBuffer(4*Math.ceil(n/4)),a=new Uint8Array(i),o=new Uint8Array(e,t,n);if(r)for(let e=0;e<a.length;e+=4)a[e]=o[e+3],a[e+1]=o[e+2],a[e+2]=o[e+1],a[e+3]=o[e];else a.set(o);return new Uint32Array(a.buffer)}if(r){let r=new Uint8Array(e,t,n),i=new Uint8Array(r.length);for(let e=0;e<i.length;e+=4)i[e]=r[e+3],i[e+1]=r[e+2],i[e+2]=r[e+1],i[e+3]=r[e];return new Uint32Array(i.buffer)}return new Uint32Array(e,t,n/4)}function Ge(){let e=[];for(let t=0;t<=257;t++)e[t]=[t];return e}function Ke(e,t){for(let n=0;n<t.length;n++)e.push(t[n])}var J=new Set;function qe(e,t,n,r=!0){let i=We(e,t,n,r),a=9,o=Ge(),s=32,c=o.length,l=[],u=1,d=i[0],f=0,p=i.length,m=8*(4*p-n),h=[];for(;d!=null;){if(s>=a)s-=a,f=d>>>32-a,d<<=a;else{f=d>>>32-s,d=i[u++];let e=a-s;s=32-e,f=(f<<e)+(d>>>s),d<<=e}if(f===257)break;if(f===256){a=9,o=Ge(),c=o.length,l=[];continue}let e=o[f];if(e==null){if(f>o.length)throw Error(`data integrity issue: code does not exist on code page`);l.push(l[0]),o[c++]=l.slice(),Ke(h,l)}else Ke(h,e),l.push(e[0]),l.length>1&&(o[c++]=l.slice()),l=e.slice();if(J.has(c)&&a++,s===0&&(d=i[u++],s=32),u>p||u===p&&s<=m)break}return new Uint8Array(h)}J.add(511),J.add(1023),J.add(2047),J.add(4095),J.add(8191);var Je=new Set([`uint8`,`int8`,`uint16`,`int16`,`uint32`,`int32`,`int64`,`uint64`]),Ye=new Map([[`uint8`,{byteCount:1,ctor:Uint8Array}],[`int8`,{byteCount:1,ctor:Int8Array}],[`uint16`,{byteCount:2,ctor:Uint16Array}],[`int16`,{byteCount:2,ctor:Int16Array}],[`uint32`,{byteCount:4,ctor:Uint32Array}],[`int32`,{byteCount:4,ctor:Int32Array}],[`uint64`,{byteCount:8,ctor:BigUint64Array}],[`int64`,{byteCount:8,ctor:BigInt64Array}]]),Xe;function Ze(){return Xe??=r(async()=>{let{default:e}=await import(`./qb3-wasm-aAXLRr_i.js`);return{default:e}},[]).then(({default:e})=>e({locateFile:e=>h(`esri/layers/support/rasterFormats/${e}`)})).then(e=>{et(e)}),Xe}var Qe={getBlobInfo:null,decode:null};function $e(e){if(!Ye.has(e))throw Error(`Unsupported data type: `+e);return Ye.get(e)}function et(e){let{_GetInfo:t,_decode:n,_malloc:r,_free:i,writeArrayToMemory:a,UTF8ToString:o}=e;Qe.getBlobInfo=e=>{e.length>1e3&&(e=e.slice(0,1e3));let n=r(e.length);a(e,n);let s=t(n,e.length);if(i(n),!s)return null;let c=o(s);i(s);try{let e=JSON.parse(c);return{width:e.xsize,height:e.ysize,bandCount:e.nbands,dataType:e.dtype,mode:e.mode,bandMap:e.bandmap}}catch{return null}},Qe.decode=(t,r)=>{let{dataType:i,width:a,height:o,bandCount:s}=r;if(!Je.has(i))throw Error(`Unsupported data type: `+i);let{_malloc:c,_free:l}=e,u=c(t.length);e.writeArrayToMemory(t,u);let{ctor:d,byteCount:f}=$e(i),p=a*o*s*f,m=c(p),h=c(1024);if(n(u,t.length,m,h)===0)throw l(u),l(m),l(h),Error(`Decoding failed: `+e.UTF8ToString(h));let g=new d(e.HEAPU8.slice(m,m+p).buffer);if(l(u),l(m),l(h),g instanceof BigInt64Array||g instanceof BigUint64Array){let e=new Float64Array(g.length);for(let t=0;t<g.length;t++)e[t]=Number(g[t]);return e}return g}}function tt(e){let t=new Uint8Array(e),n=Qe.getBlobInfo(t);if(!n)return null;let r=Qe.decode(t,n);if(!r)return null;let{width:i,height:a,bandCount:o,dataType:s}=n,{ctor:c}=$e(s),l=c===BigInt64Array||c===BigUint64Array?Float64Array:c,u=Array.from({length:o},()=>new l(i*a));for(let e=0,t=0;e<i*a;e++)for(let n=0;n<o;n++)u[n][e]=r[t++];return{width:i,height:a,pixels:u}}var nt=(e,t)=>{let n=t.width*t.height,r=t.pixelType;return Math.floor(e.byteLength/(n*rt(r)))},rt=e=>{let t=1;switch(e){case Uint8Array:case Int8Array:t=1;break;case Uint16Array:case Int16Array:t=2;break;case Uint32Array:case Int32Array:case Float32Array:t=4;break;case Float64Array:t=8}return t},it=(e,t)=>{if(8*e.byteLength<t)return null;let n=new Uint8Array(e,0,Math.ceil(t/8)),r=new Uint8Array(t),i=0,a=0,o=0,s=0;for(o=0;o<n.length-1;o++)for(a=n[o],s=7;s>=0;s--)r[i++]=a>>s&1;for(s=7;i<t-1;)a=n[n.length-1],r[i++]=a>>s&1,s--;return r},at=class{static decode(e,t){let n=t.pixelType,r=[],i=t.width*t.height,a=nt(e,t),{bandIds:o,format:s}=t,c=o?.length||nt(e,t),l=e.byteLength-e.byteLength%(i*rt(n)),u=new n(e,0,i*a),d,f,p,m,h=null;if(s===`bip`)for(d=0;d<c;d++){for(p=new n(i),m=o?o[d]:d,f=0;f<i;f++)p[f]=u[f*a+m];r.push(p)}else if(s===`bsq`)for(d=0;d<c;d++)m=o?o[d]:d,r.push(u.subarray(m*i,(m+1)*i));return l<e.byteLength-1&&(h=it(e.slice(l),i)),{pixels:r,mask:h}}};function ot(e,t){let n=0,r=``,i=0,a=0,o=e.length;for(;n<o;)a=e[n++],i=a>>4,i<8?i=1:i===15?(i=4,a=(7&a)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++]):i===14?(i=3,a=(15&a)<<12|(63&e[n++])<<6|63&e[n++]):(i=2,a=(31&a)<<6|63&e[n++]),(a!==0||t)&&(r+=String.fromCharCode(a));return r}var Y=(()=>{let e=[];return e[254]=`NEWSUBFILETYPE`,e[255]=`SUBFILETYPE`,e[256]=`IMAGEWIDTH`,e[257]=`IMAGELENGTH`,e[258]=`BITSPERSAMPLE`,e[259]=`COMPRESSION`,e[262]=`PHOTOMETRICINTERPRETATION`,e[263]=`THRESHHOLDING`,e[264]=`CELLWIDTH`,e[265]=`CELLLENGTH`,e[266]=`FILLORDER`,e[269]=`DOCUMENTNAME`,e[270]=`IMAGEDESCRIPTION`,e[271]=`MAKE`,e[272]=`MODEL`,e[273]=`STRIPOFFSETS`,e[274]=`ORIENTATION`,e[277]=`SAMPLESPERPIXEL`,e[278]=`ROWSPERSTRIP`,e[279]=`STRIPBYTECOUNTS`,e[280]=`MINSAMPLEVALUE`,e[281]=`MAXSAMPLEVALUE`,e[282]=`XRESOLUTION`,e[283]=`YRESOLUTION`,e[284]=`PLANARCONFIGURATION`,e[285]=`PAGENAME`,e[286]=`XPOSITION`,e[287]=`YPOSITION`,e[288]=`FREEOFFSETS`,e[289]=`FREEBYTECOUNTS`,e[290]=`GRAYRESPONSEUNIT`,e[291]=`GRAYRESPONSECURVE`,e[292]=`T4OPTIONS`,e[293]=`T6OPTIONS`,e[296]=`RESOLUTIONUNIT`,e[297]=`PAGENUMBER`,e[300]=`COLORRESPONSEUNIT`,e[301]=`TRANSFERFUNCTION`,e[305]=`SOFTWARE`,e[306]=`DATETIME`,e[315]=`ARTIST`,e[316]=`HOSTCOMPUTER`,e[317]=`PREDICTOR`,e[318]=`WHITEPOINT`,e[319]=`PRIMARYCHROMATICITIES`,e[320]=`COLORMAP`,e[321]=`HALFTONEHINTS`,e[322]=`TILEWIDTH`,e[323]=`TILELENGTH`,e[324]=`TILEOFFSETS`,e[325]=`TILEBYTECOUNTS`,e[326]=`BADFAXLINES`,e[327]=`CLEANFAXDATA`,e[328]=`CONSECUTIVEBADFAXLINES`,e[330]=`SUBIFD`,e[332]=`INKSET`,e[333]=`INKNAMES`,e[334]=`NUMBEROFINKS`,e[336]=`DOTRANGE`,e[337]=`TARGETPRINTER`,e[338]=`EXTRASAMPLES`,e[339]=`SAMPLEFORMAT`,e[340]=`SMINSAMPLEVALUE`,e[341]=`SMAXSAMPLEVALUE`,e[342]=`TRANSFERRANGE`,e[347]=`JPEGTABLES`,e[512]=`JPEGPROC`,e[513]=`JPEGIFOFFSET`,e[514]=`JPEGIFBYTECOUNT`,e[515]=`JPEGRESTARTINTERVAL`,e[517]=`JPEGLOSSLESSPREDICTORS`,e[518]=`JPEGPOINTTRANSFORM`,e[519]=`JPEGQTABLES`,e[520]=`JPEGDCTABLES`,e[521]=`JPEGACTABLES`,e[529]=`YCBCRCOEFFICIENTS`,e[530]=`YCBCRSUBSAMPLING`,e[531]=`YCBCRPOSITIONING`,e[532]=`REFERENCEBLACKWHITE`,e[700]=`XMP`,e[33550]=`GEOPIXELSCALE`,e[33922]=`GEOTIEPOINTS`,e[33432]=`COPYRIGHT`,e[42112]=`GDAL_METADATA`,e[42113]=`GDAL_NODATA`,e[50844]=`RPCCOEFFICIENT`,e[34264]=`GEOTRANSMATRIX`,e[34735]=`GEOKEYDIRECTORY`,e[34736]=`GEODOUBLEPARAMS`,e[34737]=`GEOASCIIPARAMS`,e[34665]=`EXIFIFD`,e[34853]=`GPSIFD`,e[40965]=`INTEROPERABILITYIFD`,e})(),st=(()=>{let e=Y.slice();return e[36864]=`ExifVersion`,e[40960]=`FlashpixVersion`,e[40961]=`ColorSpace`,e[42240]=`Gamma`,e[37121]=`ComponentsConfiguration`,e[37122]=`CompressedBitsPerPixel`,e[40962]=`PixelXDimension`,e[40963]=`PixelYDimension`,e[37500]=`MakerNote`,e[37510]=`UserComment`,e[40964]=`RelatedSoundFile`,e[36867]=`DateTimeOriginal`,e[36868]=`DateTimeDigitized`,e[36880]=`OffsetTime`,e[36881]=`OffsetTimeOriginal`,e[36882]=`OffsetTimeDigitized`,e[37520]=`SubSecTime`,e[37521]=`SubSecTimeOriginal`,e[37522]=`SubSecTimeDigitized`,e[37888]=`Temperature`,e[37889]=`Humidity`,e[37890]=`Pressure`,e[37891]=`WaterDepth`,e[37892]=`Acceleration`,e[37893]=`CameraElevationAngle`,e[42016]=`ImageUniqueID`,e[42032]=`CameraOwnerName`,e[42033]=`BodySerialNumber`,e[42034]=`LensSpecification`,e[42035]=`LensMake`,e[42036]=`LensModel`,e[42037]=`LensSerialNumber`,e[33434]=`ExposureTime`,e[33437]=`FNumber`,e[34850]=`ExposureProgram`,e[34852]=`SpectralSensitivity`,e[34855]=`PhotographicSensitivity`,e[34856]=`OECF`,e[34864]=`SensitivityType`,e[34865]=`StandardOutputSensitivity`,e[34866]=`RecommendedExposureIndex`,e[34867]=`ISOSpeed`,e[34868]=`ISOSpeedLatitudeyyy`,e[34869]=`ISOSpeedLatitudezzz`,e[37377]=`ShutterSpeedValue`,e[37378]=`ApertureValue`,e[37379]=`BrightnessValue`,e[37380]=`ExposureBiasValue`,e[37381]=`MaxApertureValue`,e[37382]=`SubjectDistance`,e[37383]=`MeteringMode`,e[37384]=`LightSource`,e[37385]=`Flash`,e[37386]=`FocalLength`,e[37396]=`SubjectArea`,e[41483]=`FlashEnergy`,e[41484]=`SpatialFrequencyResponse`,e[41486]=`FocalPlaneXResolution`,e[41487]=`FocalPlaneYResolution`,e[41488]=`FocalPlaneResolutionUnit`,e[41492]=`SubjectLocation`,e[41493]=`ExposureIndex`,e[41495]=`SensingMethod`,e[41728]=`FileSource`,e[41729]=`SceneType`,e[41730]=`CFAPattern`,e[41985]=`CustomRendered`,e[41986]=`ExposureMode`,e[41987]=`WhiteBalance`,e[41988]=`DigitalZoomRatio`,e[41989]=`FocalLengthIn35mmFilm`,e[41990]=`SceneCaptureType`,e[41991]=`GainControl`,e[41992]=`Contrast`,e[41993]=`Saturation`,e[41994]=`Sharpness`,e[41995]=`DeviceSettingDescription`,e[41996]=`SubjectDistanceRange`,e})(),ct=`GPSVersionID.GPSLatitudeRef.GPSLatitude.GPSLongitudeRef.GPSLongitude.GPSAltitudeRef.GPSAltitude.GPSTimeStamp.GPSSatellites.GPSStatus.GPSMeasureMode.GPSDOP.GPSSpeedRef.GPSSpeed.GPSTrackRef.GPSTrack.GPSImgDirectionRef.GPSImgDirection.GPSMapDatum.GPSDestLatitudeRef.GPSDestLatitude.GPSDestLongitudeRef.GPSDestLongitude.GPSDestBearingRef.GPSDestBearing.GPSDestDistanceRef.GPSDestDistance.GPSProcessingMethod.GPSAreaInformation.GPSDateStamp.GPSDifferential.GPSHPositioningError`.split(`.`),lt=(()=>{let e=[];return e[1024]=`GTModelTypeGeoKey`,e[1025]=`GTRasterTypeGeoKey`,e[1026]=`GTCitationGeoKey`,e[2048]=`GeographicTypeGeoKey`,e[2049]=`GeogCitationGeoKey`,e[2050]=`GeogGeodeticDatumGeoKey`,e[2051]=`GeogPrimeMeridianGeoKey`,e[2052]=`GeogLinearUnitsGeoKey`,e[2053]=`GeogLinearUnitSizeGeoKey`,e[2054]=`GeogAngularUnitsGeoKey`,e[2055]=`GeogAngularUnitSizeGeoKey`,e[2056]=`GeogEllipsoidGeoKey`,e[2057]=`GeogSemiMajorAxisGeoKey`,e[2058]=`GeogSemiMinorAxisGeoKey`,e[2059]=`GeogInvFlatteningGeoKey`,e[2061]=`GeogPrimeMeridianLongGeoKey`,e[2060]=`GeogAzimuthUnitsGeoKey`,e[3072]=`ProjectedCSTypeGeoKey`,e[3073]=`PCSCitationGeoKey`,e[3074]=`ProjectionGeoKey`,e[3075]=`ProjCoordTransGeoKey`,e[3076]=`ProjLinearUnitsGeoKey`,e[3077]=`ProjLinearUnitSizeGeoKey`,e[3078]=`ProjStdParallel1GeoKey`,e[3079]=`ProjStdParallel2GeoKey`,e[3080]=`ProjNatOriginLongGeoKey`,e[3081]=`ProjNatOriginLatGeoKey`,e[3082]=`ProjFalseEastingGeoKey`,e[3083]=`ProjFalseNorthingGeoKey`,e[3084]=`ProjFalseOriginLongGeoKey`,e[3085]=`ProjFalseOriginLatGeoKey`,e[3086]=`ProjFalseOriginEastingGeoKey`,e[3087]=`ProjFalseOriginNorthingGeoKey`,e[3088]=`ProjCenterLongGeoKey`,e[3090]=`ProjCenterEastingGeoKey`,e[3091]=`ProjCenterNorthingGeoKey`,e[3092]=`ProjScaleAtNatOriginGeoKey`,e[3093]=`ProjScaleAtCenterGeoKey`,e[3094]=`ProjAzimuthAngleGeoKey`,e[3095]=`ProjStraightVertPoleLongGeoKey`,e[4096]=`VerticalCSTypeGeoKey`,e[4097]=`VerticalCitationGeoKey`,e[4098]=`VerticalDatumGeoKey`,e[4099]=`VerticalUnitsGeoKey`,e})(),ut=(e,t)=>{let n=(t||Y)[e];return n===void 0&&(n=`unknown`+String(e)),n},dt=new Map([[`EXIFIFD`,st],[`GPSIFD`,ct]]),ft=(()=>{let e=new ArrayBuffer(4),t=new Uint8Array(e);return new Uint32Array(e)[0]=1,t[0]===1})(),pt=[0,1,1,2,4,8,1,1,2,4,8,4,8,-1,-1,-1,8,8,8],mt=4294967296,ht=new Set([1,5,6,7,8,34712,34887]);function gt(e,t){let n=`unknown`;return e===3?n=t===64?`f64`:`f32`:e===1?t===1?n=`u1`:t===2?n=`u2`:t===4?n=`u4`:t<=8?n=`u8`:t<=16?n=`u16`:t<=32&&(n=`u32`):e===2&&(t<=8?n=`s8`:t<=16?n=`s16`:t<=32&&(n=`s32`)),n}function _t(e){let t=null;switch(e?e.toLowerCase():`f32`){case`u1`:case`u2`:case`u4`:case`u8`:t=Uint8Array;break;case`u16`:t=Uint16Array;break;case`u32`:t=Uint32Array;break;case`s8`:t=Int8Array;break;case`s16`:t=Int16Array;break;case`s32`:t=Int32Array;break;case`f64`:t=Float64Array;break;default:t=Float32Array}return t}function vt(e,t){return{x:t[0]*e.x+t[1]*e.y+t[2],y:t[3]*e.x+t[4]*e.y+t[5]}}function yt(e,t){return e.get(t)?.values}function X(e,t){return e.get(t)?.values}function bt(e,t){return e.get(t)?.values?.[0]}function Z(e,t){return e.get(t)?.values?.[0]}function xt(e,t,n,r=0,i=Y,a=4){let o=a===8,s=o?Rt(new DataView(e,n,8),0,t):new DataView(e,n,2).getUint16(0,t),c=4+2*a,l=o?8:2,u=l+s*c;if(n+u>e.byteLength)return{success:!1,ifd:null,nextIFD:null,requiredBufferSize:u};let d=a===8?8:4,f=n+u+d<=e.byteLength?Bt(new DataView(e,n+u,d),0,t,a===8):null,p=n+l,m=new Map,h,g,_,v,y,b=0,x=0;for(let n=0;n<s;n++){g=new DataView(e,p+c*n,c),_=g.getUint16(0,t),y=g.getUint16(2,t),v=ut(_,i);let o=[];a===2?(b=g.getUint16(4,t),x=g.getUint16(6,t)):a===4?(b=g.getUint32(4,t),x=g.getUint32(8,t)):a===8&&(b=Bt(g,4,t,!0),x=Bt(g,12,t,!0),o.push(g.getUint32(12,t)),o.push(g.getUint32(16,t))),h={id:_,type:y,valueCount:b,valueOffset:x,valueOffsets:o,values:null},Mt(e,t,h,r,!1,a),m.set(v,h)}return{success:!0,ifd:m,nextIFD:f,requiredBufferSize:u}}var St=(e,t)=>Ue(e,{inputOffset:t}).pixels[0];function Ct(e,t){if(t%8==0)return e;let n=t>16?32:t>8?16:8;n>8&&(e=Et(e,n===32?4:2));let r=n===32?Uint32Array:n===16?Uint16Array:Uint8Array,i=new r(e),a=Math.floor(8*e.byteLength/t+1e-6),o=new r(a),s=(1<<t)-1,c=0,l=0,u=0;for(let e=0;e<a;e++)if(l===0&&(u=i[c++],l=n),l>=t)o[e]=u>>>l-t&s,l-=t;else{let r=t-l,a=(u&s)<<r&s;u=i[c++],l=n-r,a+=u>>>l,o[e]=a}return o.buffer}function wt(e,t,n){let r=new Pe;r.parse(e),r.colorTransform=n===6?-1:0;let i=r.getData(r.width,r.height,t!==1&&t!==4);return new Uint8Array(i.buffer)}function Tt(e){let t=new ke(e).getBytes(),n=new ArrayBuffer(t.length),r=new Uint8Array(n);return r.set(t),r}function Et(e,t){let n=new Uint8Array(e),r=new Uint8Array(n.length);if(t===2)for(let e=0;e<n.length;e+=2)r[e]=n[e+1],r[e+1]=n[e];else if(t===4)for(let e=0;e<n.length;e+=4)r[e]=n[e+3],r[e+1]=n[e+2],r[e+2]=n[e+1],r[e+3]=n[e];else for(let e=0;e<n.length;e+=8)r[e]=n[e+7],r[e+1]=n[e+6],r[e+2]=n[e+5],r[e+3]=n[e+4],r[e+4]=n[e+3],r[e+5]=n[e+2],r[e+6]=n[e+1],r[e+7]=n[e];return r.buffer}async function Dt(e,t,n,r,i){let a=ft===t,o=Z(n,`BITSPERSAMPLE`),s=Z(n,`SAMPLESPERPIXEL`)??1,c=Z(n,`PHOTOMETRICINTERPRETATION`),l=Z(n,`SAMPLEFORMAT`)??1,u=gt(l,o),d=Z(n,`COMPRESSION`)??1,f=_t(u),p,m,h;if(d===34887)return await Re(),St(e,r);if(d===1)p=e.slice(r,r+i),m=new Uint8Array(p);else if(d===8||d===32946)m=new Uint8Array(e,r,i),m=Tt(m),p=m.buffer;else if(d===6)m=new Uint8Array(e,r,i),m=wt(m,s,c),p=m.buffer;else if(d===7){let t=n.get(`JPEGTABLES`).values,a=t.length-2;m=new Uint8Array(a+i-2);for(let e=0;e<a;e++)m[e]=t[e];let o=new Uint8Array(e,r+2,i-2);for(let e=0;e<o.length;e++)m[a+e]=o[e];m=wt(m,s,c),p=m.buffer}else{if(d!==5)throw Error(`tiff-decode: unsupport compression `+d);m=qe(e,r,i,t),p=m.buffer}if(p=Ct(p,o),a||o<=8)h=new f(p);else{let e=o>32?8:o>16?4:2;h=new f(Et(m.buffer,e))}let g=Z(n,`PREDICTOR`)??1,_=Z(n,`TILEWIDTH`),v=Z(n,`TILELENGTH`);if(g>1&&(d===5||d===8||d===32946)&&_&&v){let e=Pt(n),t=new f(h.length);t.set(h),h=Wt(t,v,_,l===3&&g===3,e?1:s)}return h}async function Ot(e,t,n){let r=X(n,`TILEOFFSETS`);if(r===void 0)return null;let i=X(n,`TILEBYTECOUNTS`),{width:a,height:o,pixelType:s,tileWidth:c,tileHeight:l}=Nt([n]),u=Pt(n,t),d=Z(n,`SAMPLESPERPIXEL`)||t.planes,f=a*o,p=Z(n,`BITSPERSAMPLE`),m=(Z(n,`COMPRESSION`)??1)===34887,h=_t(s),g=[];for(let e=0;e<d;e++)g.push(new h(f));let _,v,y,b,x,S,C,w,T,E,D,O,k,A=Math.ceil(a/c),j=new Uint8Array(f).fill(255),M=!1;if(p%8==0)if(m&&u&&d>1){let s=Math.round(r.length/d);for(_=0;_<s;_++){S=Math.floor(_/A)*l,C=_%A*c,w=S*a+C;for(let s=0;s<d;s++){let u=_*d+s;for(i[u]===0?(y=null,M=!0):y=await Dt(e,t.littleEndian,n,r[u],i[u]),E=0,T=w,O=Math.min(c,a-C),D=Math.min(l,o-S),k=g[s],b=0;b<D;b++)for(T=w+b*a,E=b*c,x=0;x<O;x++,T++,E++)y?k[T]=y[E]:j[T]=0}}}else for(_=0;_<r.length;_++)for(S=Math.floor(_/A)*l,C=_%A*c,w=S*a+C,i[_]===0?(y=null,M=!0):y=await Dt(e,t.littleEndian,n,r[_],i[_]),E=0,T=w,O=Math.min(c,a-C),D=Math.min(l,o-S),v=0;v<d;v++)if(k=g[v],u||m)for(b=0;b<D;b++)for(T=w+b*a,E=c*l*v+b*c,x=0;x<O;x++,T++,E++)y?k[T]=y[E]:j[T]=0;else for(b=0;b<D;b++)for(T=w+b*a,E=b*c*d+v,x=0;x<O;x++,T++,E+=d)y?k[T]=y[E]:j[T]=0;return{width:a,height:o,pixelType:s,pixels:g,mask:M?j:void 0}}var kt=(e,t,n)=>{let r=ft===t.littleEndian,i=X(n,`STRIPOFFSETS`);if(i===void 0)return null;let{width:a,height:o,pixelType:s}=Nt([n]),c=Z(n,`SAMPLESPERPIXEL`)||t.planes,l=Z(n,`PHOTOMETRICINTERPRETATION`),u=a*o,d=Z(n,`BITSPERSAMPLE`),f=_t(s),p=new f(u*c),m=X(n,`STRIPBYTECOUNTS`),h=Z(n,`ROWSPERSTRIP`),g=Z(n,`COMPRESSION`)??1,_,v,y,b,x,S,C,w,T;if(d%8==0)for(_=0;_<i.length;_++){if(x=_*(h*a)*c,s===`u8`||s===`s8`||r)g===8||g===32946?(C=new Uint8Array(e,i[_],m[_]),C=Tt(C),S=C.buffer):g===6?(C=new Uint8Array(e,i[_],m[_]),C=wt(C,c,l),S=C.buffer):g===5?(C=qe(e,i[_],m[_],t.littleEndian),S=C.buffer):S=e.slice(i[_],i[_]+m[_]),S=Ct(S,d),b=new f(S);else{switch(g===6||g===8||g===32946?(C=new Uint8Array(e,i[_],m[_]),w=Tt(C),S=w.buffer):(S=new ArrayBuffer(m[_]),C=new Uint8Array(e,i[_],m[_]),w=new Uint8Array(S)),s){case`u16`:case`s16`:for(y=0;y<C.length;y+=2)w[y]=C[y+1],w[y+1]=C[y];break;case`u32`:case`s32`:case`f32`:for(y=0;y<C.length;y+=4)w[y]=C[y+3],w[y+1]=C[y+2],w[y+2]=C[y+1],w[y+3]=C[y]}S=Ct(S,d),b=new f(S)}p.set(b,x)}let E=[];if(c===1)E.push(p);else for(_=0;_<c;_++){for(T=new f(u),v=0;v<u;v++)T[v]=p[v*c+_];E.push(T)}return{width:a,height:o,pixelType:s,pixels:E}},At=(e,t,n)=>{if(!(e&&e.length>0&&t&&n))return null;let r,i,a,o=e[0].length,s=e.length,c=new Uint8Array(o);for(let l=0;l<s;l++)if(r=e[l],i=t[l],a=n[l],l===0)for(let e=0;e<o;e++)c[e]=r[e]<i||r[e]>a?0:1;else for(let e=0;e<o;e++)c[e]&&(c[e]=r[e]<i||r[e]>a?0:1);return c},jt=e=>{if(!e)return null;let t=e.match(/<Item(.*?)Item>/gi);if(!t||t.length===0)return null;let n=new Map,r,i,a,o,s;for(let e=0;e<t.length;e++)r=t[e],i=r.slice(6,r.indexOf(`>`)),o=r.indexOf(`sample=`),o>-1&&(s=r.slice(o+8,r.indexOf(`"`,o+8))),o=r.indexOf(`name=`),o>-1&&(i=r.slice(o+6,r.indexOf(`"`,o+6))),i&&(a=r.slice(r.indexOf(`>`)+1,r.indexOf(`</Item>`)).trim(),s==null?n.set(i,a):n.has(i)?n.get(i)[s]=a:n.set(i,[a])),s=null;let c=n.get(`STATISTICS_MINIMUM`),l=n.get(`STATISTICS_MAXIMUM`),u=n.get(`STATISTICS_MEAN`),d=n.get(`STATISTICS_STDDEV`),f=null;if(c&&l){f=[];for(let e=0;e<c.length;e++)f.push({min:parseFloat(c[e]),max:parseFloat(l[e]),avg:u&&parseFloat(u[e]),stddev:d&&parseFloat(d[e])})}let p=n.get(`BandName`),m=n.get(`WavelengthMin`),h=n.get(`WavelengthMax`),g=null;if(p){g=[];for(let e=0;e<p.length;e++)g.push({BandName:p[e],WavelengthMin:m&&parseFloat(m[e]),WavelengthMax:h&&parseFloat(h[e])})}return{statistics:f,bandProperties:g,dataType:n.get(`DataType`),rawMetadata:n}};function Mt(e,t,n,r=0,i=!1,a=4){if(n.values)return!0;let o=n.type,s=n.valueCount,c=n.valueOffset,l=[],u=pt[o],d=8*u,f=s*u,p=s*pt[o]*8,m,h,g=a===8?64:32,_=n.valueOffsets;if(p>g&&f>(i?e.byteLength:e?e.byteLength-c+r:0))return n.offlineOffsetSize=[c,f],n.values=null,!1;if(p<=g){if(!t)if(g<=32)c>>>=32-p;else{let e=_?.length?_[0]:c>>>0,t=_?.length?_[1]:Math.round((c-e)/mt);p<=32?(c=e>>>32-p,_[0]=c):(c=e*2**(32-p)+(t>>>32-p),_[0]=e,_[1]=t>>>32-p)}if(s===1&&d===g)l=[c];else if(g===64){let e=_?.length?_[0]:c>>>0,t=_?.length?_[1]:Math.round((c-e)/mt),n=e,r=32;for(h=1;h<=s;h++){let e=32-d*h%32;if(r<d){let i=n<<e>>>32-r,a=t<<32-r>>>32-r;n=t,l.push(i+a*2**(d-r)),r-=32-(d-r)}else l.push(n<<e>>>32-d),r-=d;r===0&&(r=32,n=t)}}else for(h=1;h<=s;h++){let e=32-d*h;l.push(c<<e>>>32-d)}}else{c-=r,i&&(c=0);for(let n=c;n<c+f;n+=u){switch(o){case 1:case 2:case 7:m=new DataView(e,n,1).getUint8(0);break;case 3:m=new DataView(e,n,2).getUint16(0,t);break;case 4:case 13:m=new DataView(e,n,4).getUint32(0,t);break;case 5:m=new DataView(e,n,4).getUint32(0,t)/new DataView(e,n+4,4).getUint32(0,t);break;case 6:m=new DataView(e,n,1).getInt8(0);break;case 8:m=new DataView(e,n,2).getInt16(0,t);break;case 9:m=new DataView(e,n,4).getInt32(0,t);break;case 10:m=new DataView(e,n,4).getInt32(0,t)/new DataView(e,n+4,4).getInt32(0,t);break;case 11:m=new DataView(e,n,4).getFloat32(0,t);break;case 12:m=new DataView(e,n,8).getFloat64(0,t);break;case 16:case 18:m=Rt(new DataView(e,n,8),0,t);break;case 17:m=zt(new DataView(e,n,8),0,t);break;default:m=null}l.push(m)}}if(o===2){let e=``,t=l;for(l=[],h=0;h<t.length;h++)t[h]===0&&e!==``?(l.push(e),e=``):e+=String.fromCharCode(t[h]);e===``&&l.length!==0||l.push(e)}return n.values=l,!0}function Nt(e){let t=e[0],n=Z(t,`TILEWIDTH`),r=Z(t,`TILELENGTH`),i=Z(t,`IMAGEWIDTH`),a=Z(t,`IMAGELENGTH`),o=Z(t,`BITSPERSAMPLE`),s=Z(t,`SAMPLESPERPIXEL`),c=Z(t,`SAMPLEFORMAT`)??1,l=gt(c,o),u=Pt(t),d=yt(t,`GDAL_NODATA`),f=null;d?.length&&(f=d.map(e=>parseFloat(e)),f.some(e=>isNaN(e))&&(f=null));let p=Z(t,`COMPRESSION`)??1,m;switch(p){case 1:m=`NONE`;break;case 2:case 3:case 4:case 32771:m=`CCITT`;break;case 5:m=`LZW`;break;case 6:case 7:m=`JPEG`;break;case 32773:m=`PACKBITS`;break;case 8:case 32946:m=`DEFLATE`;break;case 34712:m=`JPEG2000`;break;case 34887:m=`LERC`;break;default:m=String(p)}let h=!0,g=``;ht.has(p)||(h=!1,g+=`unsupported tag compression `+p),c>3&&(h=!1,g+=`unsupported tag sampleFormat `+c),o>32&&o!==64&&(h=!1,g+=`unsupported tag bitsPerSample `+o);let _=bt(t,`GEOASCIIPARAMS`),v;if(_){let e=_.split(`|`).find(e=>e.includes(`ESRI PE String = `)),t=e?e.replace(`ESRI PE String = `,``):``;v=t.startsWith(`COMPD_CS`)||t.startsWith(`PROJCS`)||t.startsWith(`GEOGCS`)?{wkid:null,wkt:t}:null}let y=X(t,`GEOTIEPOINTS`),b=X(t,`GEOPIXELSCALE`),x=X(t,`GEOTRANSMATRIX`),S=t.has(`GEOKEYDIRECTORY`)?t.get(`GEOKEYDIRECTORY`).data:null,C,w,T=!1,E=!1;if(S){T=Z(S,`GTRasterTypeGeoKey`)===2;let e=Z(S,`GTModelTypeGeoKey`);if(e===2){let e=Z(S,`GeographicTypeGeoKey`);e>=1024&&e<=32766&&(v={wkid:e}),v||e!==32767||(E=!0,v={wkid:4326})}else if(e===1){let e=Z(S,`ProjectedCSTypeGeoKey`);e>=1024&&e<=32766&&(v={wkid:e})}}if(b&&y&&y.length>=6?(C=[b[0],0,y[3]-y[0]*b[0],0,-Math.abs(b[1]),y[4]-y[1]*b[1]],T&&(C[2]-=.5*C[0]+.5*C[1],C[5]-=.5*C[3]+.5*C[4])):x&&x.length===16&&(C=T?[x[0],x[1],x[3]-.5*x[0],x[4],x[5],x[7]-.5*x[5]]:[x[0],x[1],x[3],x[4],x[5],x[7]]),C){let e=[{x:0,y:a},{x:0,y:0},{x:i,y:a},{x:i,y:0}],t,n=1/0,r=1/0,o=-1/0,s=-1/0;for(let i=0;i<e.length;i++)t=vt(e[i],C),n=t.x>n?n:t.x,o=t.x<o?o:t.x,r=t.y>r?r:t.y,s=t.y<s?s:t.y;w={xmin:n,xmax:o,ymin:r,ymax:s,spatialReference:v}}else w={xmin:-.5,ymin:.5-a,xmax:i-.5,ymax:.5,spatialReference:v};E&&(w.xmax-w.xmin>400||Math.max(Math.abs(w.xmin),Math.abs(w.xmax))>361)&&(v=null,w.spatialReference=null);let D=Ft(e),O,k,A,j,M;if(D.length>0){A=Math.round(Math.log(i/Z(D[0],`IMAGEWIDTH`))/Math.LN2);let e=D[D.length-1];j=D.length,O=Z(e,`TILEWIDTH`),k=Z(e,`TILELENGTH`)}O=j!=null&&j>0?O||n:null,k=j!=null&&j>0?k||r:null,n&&(M=[{maxCol:Math.ceil(i/n)-1,maxRow:Math.ceil(a/r)-1,minRow:0,minCol:0}],D.forEach(e=>{M.push({maxCol:Math.ceil(Z(e,`IMAGEWIDTH`)/Z(e,`TILEWIDTH`))-1,maxRow:Math.ceil(Z(e,`IMAGELENGTH`)/Z(e,`TILELENGTH`))-1,minRow:0,minCol:0})}));let N=bt(e[0],`GDAL_METADATA`),P=jt(N);g+=` `+Ut({width:i,height:a,tileWidth:n,tileHeight:r,planes:s,ifds:e});let F=It(e).length===D.length+1,I=D?.length?D.map(e=>({x:i/Z(e,`IMAGEWIDTH`),y:a/Z(e,`IMAGELENGTH`)})):void 0;return{width:i,height:a,tileWidth:n,tileHeight:r,planes:s,isBSQ:u,pixelType:l,compression:m,noData:f,hasMaskBand:F,isSupported:h,pyramidResolutions:I,message:g,extent:w,isPseudoGeographic:E,affine:b?null:C,firstPyramidLevel:A,maximumPyramidLevel:j,pyramidBlockWidth:O,pyramidBlockHeight:k,tileBoundary:M,metadata:P}}function Pt(e,t){let n=yt(e,`PLANARCONFIGURATION`);return n?n[0]===2:!!t&&t.isBSQ}function Ft(e){return e.filter(e=>Z(e,`NEWSUBFILETYPE`)===1)}function It(e){return e.filter(e=>{let t=!(4&~(Z(e,`NEWSUBFILETYPE`)??0)),n=Z(e,`PHOTOMETRICINTERPRETATION`)===4;return t&&n})}function Lt(e){let{littleEndian:t,isBigTiff:n,firstIFDPos:r}=Vt(e),i=r,a=[];do{let r=Ht(e,t,i,0,Y,n?8:4);if(!r.success)break;a.push(r.ifd),i=r.nextIFD}while(i>0);return{...Nt(a),littleEndian:t,isBigTiff:n,ifds:a,pyramidIFDs:Ft(a),maskIFDs:It(a)}}function Rt(e,t,n){let r=e.getUint32(t,n),i=e.getUint32(t+4,n);return n?i*mt+r:r*mt+i}function zt(e,t,n){let r=n?e.getInt32(t,n):e.getUint32(t,n),i=n?e.getUint32(t+4,n):e.getInt32(t+4,n),a=(n?r:i)>=0?1:-1;return n?r*=a:i*=a,a*(n?i*mt+r:r*mt+i)}function Bt(e,t,n,r){return r?Rt(e,t,n):e.getUint32(t,n)}function Vt(e){let t=new DataView(e,0,16),n=t.getUint16(0,!1),r=null;if(n===18761)r=!0;else{if(n!==19789)throw Error(`unexpected endianess byte`);r=!1}let i=t.getUint16(2,r);if(i!==42&&i!==43)throw Error(`unexpected tiff identifier`);let a=4,o=i===43;if(o){let e=t.getUint16(a,r);if(a+=2,e!==8||t.getUint16(a,r)!==0)throw Error(`unsupported bigtiff version`);a+=2}return{littleEndian:r,isBigTiff:o,firstIFDPos:Bt(t,a,r,o)}}function Ht(e,t,n,r=0,i=Y,a=4){let o=xt(e,t,n,r,i,a),s,c=o.ifd;if(c){if(dt.forEach((n,i)=>{c.has(i)&&(s=c.get(i),s.data=xt(e,t,s.valueOffset-r,r,n).ifd)}),c.has(`GEOKEYDIRECTORY`)){s=c.get(`GEOKEYDIRECTORY`);let n=s.values;if(n&&n.length>4){let i=n[0]+`.`+n[1]+`.`+n[2];s.data=xt(e,t,s.valueOffset+6-r,r,lt,2).ifd,s.data&&s.data.set(`GEOTIFFVersion`,{id:0,type:2,valueCount:1,valueOffset:null,values:[i]})}}if(c.has(`XMP`)){s=c.get(`XMP`);let e=s.values;typeof e[0]==`number`&&s.type===7&&(s.values=[ot(new Uint8Array(e))])}}return o}function Ut(e){let{width:t,height:n,tileHeight:r,tileWidth:i}=e,a=e.planes,o=i?i*r:t*n,s=Z(e.ifds[0],`BITSPERSAMPLE`),c=``;return o*a>2**30/(s>8?s/8:1)&&(c=i?`tiled tiff exceeding 1 gigabits per tile is not supported`:`scanline tiff exceeding 1 gigabits is not supported`),c}function Wt(e,t,n,r,i){let a=r?4:1,o=n*a*i;r&&(e=new Uint8Array(e.buffer));for(let n=0;n<t;n++){let t=n*o;for(let n=i;n<o;n++)e[t+n]+=e[t+n-i]}if(!r)return e;let s=new Uint8Array(e.length),c=n*i;for(let n=0;n<t;n++){let t=n*o;for(let n=0;n<c;n++)for(let r=0;r<a;r++)s[t+n*a+r]=e[t+n+(a-r-1)*c]}return new Float32Array(s.buffer)}async function Gt(e,t){let{headerInfo:n,ifd:r,offsets:i,sizes:a}=t,o=[];for(let t=0;t<i.length;t++){a[t];let s=await Dt(e,n.littleEndian,r,i[t],a[t]||e.byteLength);o.push(s)}let s=Pt(r,n),c=Z(r,`BITSPERSAMPLE`),l=gt(Z(r,`SAMPLEFORMAT`)??1,c),u=Z(r,`SAMPLESPERPIXEL`)||n.planes,d=_t(l),f=Z(r,`TILEWIDTH`),p=Z(r,`TILELENGTH`),m=Z(r,`COMPRESSION`)??1,h=f*p,g,_=[],v=o[0],y=m===34887;for(let e=0;e<u;e++){if(g=new d(h),o.length===u)v=o[e],v.length===h&&(g=v);else if(v.length)if(s||y)g=v.length===h?v:v.slice(h*e,h*(e+1));else for(let t=0;t<h;t++)g[t]=v[t*u+e];_.push(g)}let b=n.noData?n.noData[0]:t.noDataValue,S=n.metadata?n.metadata.statistics:null,C=S?S.map(e=>e.min):null,w=S?S.map(e=>e.max):null,T={pixelType:l,width:f,height:p,pixels:_,noDataValue:b};return b==null?C&&w&&t.applyMinMaxConstraint&&(T.mask=At(_,C,w)):x(T,b,{matchAllNoData:t?.matchAllNoData}),T}async function Kt(e,t={}){let n=t.pyramidLevel||0,r=t.headerInfo||Lt(e),{ifds:i,noData:a}=r;if(i.length===0)throw Error(`no valid image file directory`);let o=Ut(r);if(o)throw o;let s=null,c=n===-1?i[i.length-1]:i[n],l=a??t.noDataValue;return s=r.tileWidth?await Ot(e,r,c):kt(e,r,c),s&&(l!=null&&x(s,l,{matchAllNoData:a==null&&t?.matchAllNoData}),s)}var qt=function(e){var t,n,r,i,a,o;function s(e){var t,n,r,i,a,o,s,c,l,u,d,f,p;for(this.data=e,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},a=null;;){switch(t=this.readUInt32(),c=function(){var e,t;for(t=[],e=0;e<4;++e)t.push(String.fromCharCode(this.data[this.pos++]));return t}.call(this).join(``),c){case`IHDR`:this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case`acTL`:this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case`PLTE`:this.palette=this.read(t);break;case`fcTL`:a&&this.animation.frames.push(a),this.pos+=4,a={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},i=this.readUInt16(),r=this.readUInt16()||100,a.delay=1e3*i/r,a.disposeOp=this.data[this.pos++],a.blendOp=this.data[this.pos++],a.data=[];break;case`IDAT`:case`fdAT`:for(c===`fdAT`&&(this.pos+=4,t-=4),e=a?.data||this.imgData,d=0;0<=t?d<t:d>t;0<=t?++d:--d)e.push(this.data[this.pos++]);break;case`tRNS`:switch(this.transparency={},this.colorType){case 3:if(this.transparency.indexed=this.read(t),(l=255-this.transparency.indexed.length)>0)for(f=0;0<=l?f<l:f>l;0<=l?++f:--f)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(t)[0];break;case 2:this.transparency.rgb=this.read(t)}break;case`tEXt`:o=(u=this.read(t)).indexOf(0),s=String.fromCharCode.apply(String,u.slice(0,o)),this.text[s]=String.fromCharCode.apply(String,u.slice(o+1));break;case`IEND`:a&&this.animation.frames.push(a),this.colors=function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this),this.hasAlphaChannel=(p=this.colorType)===4||p===6,n=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*n,this.colorSpace=function(){switch(this.colors){case 1:return`DeviceGray`;case 3:return`DeviceRGB`}}.call(this),this.imgData=new Uint8Array(this.imgData);return;default:this.pos+=t}if(this.pos+=4,this.pos>this.data.length)throw Error(`Incomplete or corrupt PNG file`)}}return s.load=function(e,t,n){var r;return typeof t==`function`&&(n=t),(r=new XMLHttpRequest).open(`GET`,e,!0),r.responseType=`arraybuffer`,r.onload=function(){var e;return e=new s(new Uint8Array(r.response||r.mozResponseArrayBuffer)),typeof t?.getContext==`function`&&e.render(t),typeof n==`function`?n(e):void 0},r.send(null)},n=1,r=2,t=0,s.prototype.read=function(e){var t,n;for(n=[],t=0;0<=e?t<e:t>e;0<=e?++t:--t)n.push(this.data[this.pos++]);return n},s.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},s.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},s.prototype.decodePixels=function(e){var t,n,r,i,a,o,s,c,l,u,d,f,p,m,h,g,_,v,y,b,x,S,C;if(e??=this.imgData,e.length===0)return new Uint8Array;for(e=(e=new ke(e)).getBytes(),g=(f=this.pixelBitlength/8)*this.width,p=new Uint8Array(g*this.height),o=e.length,h=0,m=0,n=0;m<o;){switch(e[m++]){case 0:for(i=y=0;y<g;i=y+=1)p[n++]=e[m++];break;case 1:for(i=b=0;b<g;i=b+=1)t=e[m++],a=i<f?0:p[n-f],p[n++]=(t+a)%256;break;case 2:for(i=x=0;x<g;i=x+=1)t=e[m++],r=(i-i%f)/f,_=h&&p[(h-1)*g+r*f+i%f],p[n++]=(_+t)%256;break;case 3:for(i=S=0;S<g;i=S+=1)t=e[m++],r=(i-i%f)/f,a=i<f?0:p[n-f],_=h&&p[(h-1)*g+r*f+i%f],p[n++]=(t+Math.floor((a+_)/2))%256;break;case 4:for(i=C=0;C<g;i=C+=1)t=e[m++],r=(i-i%f)/f,a=i<f?0:p[n-f],h===0?_=v=0:(_=p[(h-1)*g+r*f+i%f],v=r&&p[(h-1)*g+(r-1)*f+i%f]),s=a+_-v,c=Math.abs(s-a),u=Math.abs(s-_),d=Math.abs(s-v),l=c<=u&&c<=d?a:u<=d?_:v,p[n++]=(t+l)%256;break;default:throw Error(`Invalid filter algorithm: `+e[m-1])}h++}return p},s.prototype.decodePalette=function(){var e,t,n,r,i,a,o,s;for(n=this.palette,a=this.transparency.indexed||[],i=new Uint8Array((a.length||0)+n.length),r=0,n.length,e=0,t=o=0,s=n.length;o<s;t=o+=3)i[r++]=n[t],i[r++]=n[t+1],i[r++]=n[t+2],i[r++]=a[e++]??255;return i},s.prototype.copyToImageData=function(e,t){var n,r,i,a,o,s,c,l,u,d;if(r=this.colors,u=null,n=this.hasAlphaChannel,this.palette.length&&(u=this._decodedPalette??=this.decodePalette(),r=4,n=!0),l=(i=e.data||e).length,o=u||t,a=s=0,r===1)for(;a<l;)c=u?4*t[a/4]:s,d=o[c++],i[a++]=d,i[a++]=d,i[a++]=d,i[a++]=n?o[c++]:this.transparency.grayscale&&this.transparency.grayscale===d?0:255,s=c;else for(;a<l;)c=u?4*t[a/4]:s,i[a++]=o[c++],i[a++]=o[c++],i[a++]=o[c++],i[a++]=n?o[c++]:this.transparency.rgb&&this.transparency.rgb[1]===o[c-3]&&this.transparency.rgb[3]===o[c-2]&&this.transparency.rgb[5]===o[c-1]?0:255,s=c},s.prototype.decode=function(){var e;return e=new Uint8Array(this.width*this.height*4),this.copyToImageData(e,this.decodePixels()),e},a=e.document&&e.document.createElement(`canvas`),o=a&&a.getContext(`2d`),i=function(e){var t;return o.width=e.width,o.height=e.height,o.clearRect(0,0,e.width,e.height),o.putImageData(e,0,0),(t=new Image).src=a.toDataURL(),t},s.prototype.decodeFrames=function(e){var t,n,r,a,o,s,c,l;if(this.animation){for(l=[],n=o=0,s=(c=this.animation.frames).length;o<s;n=++o)t=c[n],r=e.createImageData(t.width,t.height),a=this.decodePixels(new Uint8Array(t.data)),this.copyToImageData(r,a),t.imageData=r,l.push(t.image=i(r));return l}},s.prototype.renderFrame=function(e,i){var a,o,s;return a=(o=this.animation.frames)[i],s=o[i-1],i===0&&e.clearRect(0,0,this.width,this.height),s?.disposeOp===n?e.clearRect(s.xOffset,s.yOffset,s.width,s.height):s?.disposeOp===r&&e.putImageData(s.imageData,s.xOffset,s.yOffset),a.blendOp===t&&e.clearRect(a.xOffset,a.yOffset,a.width,a.height),e.drawImage(a.image,a.xOffset,a.yOffset)},s.prototype.animate=function(e){var t,n,r,i,a,o,s=this;return n=0,o=this.animation,i=o.numFrames,r=o.frames,a=o.numPlays,(t=function(){var o,c;if(o=n++%i,c=r[o],s.renderFrame(e,o),i>1&&n/i<a)return s.animation._timeout=setTimeout(t,c.delay)})()},s.prototype.stopAnimation=function(){return clearTimeout(this.animation?._timeout)},s.prototype.render=function(e){var t,n;return e._png&&e._png.stopAnimation(),e._png=this,e.width=this.width,e.height=this.height,t=e.getContext(`2d`),this.animation?(this.decodeFrames(t),this.animate(t)):(n=t.createImageData(this.width,this.height),this.copyToImageData(n,this.decodePixels()),t.putImageData(n,0,0))},s}(self),Jt=new Set([`jpg`,`png`,`bmp`,`gif`]);async function Yt(e,t){if(!ft)throw new l(`rasterCoded:decode`,`lerc decoder is not supported on big endian platform`);await Re();let{offset:n}=t,{width:r,height:i,pixelType:a,statistics:o,depthCount:s,noDataValues:c,bandMasks:u,pixels:d,mask:f}=Ue(e,{inputOffset:n,returnInterleaved:t.returnInterleaved}),p=new O({width:r,height:i,pixelType:a.toLowerCase(),pixels:d,mask:f,statistics:o.map(({minValue:e,maxValue:t})=>new D(e,t)),bandMasks:u,depthCount:s,noDataValues:c});return o?.length||p.updateStatistics(),p}async function Xt(e,t){await Ze();let n=tt(e);if(!n)throw new l(`rasterCodec:decode`,`failed to decode the input data.`);let{width:r,height:i,pixels:a}=n,o=new O({width:r,height:i,pixelType:`u16`,pixels:a});return o.updateStatistics(),o}async function Zt(e,t){let n=await Kt(e,{...t,noDataValue:t.tiffNoDataValue,matchAllNoData:t.matchAllNoData});_(n);let r=new O({width:n.width,height:n.height,pixels:n.pixels,pixelType:n.pixelType.toLowerCase(),mask:n.mask,bandMasks:n.bandMasks,statistics:null});return r.updateStatistics(),r}async function Qt(e,t){let n=await Gt(e,t.customOptions),r=new O({width:n.width,height:n.height,pixels:n.pixels,pixelType:n.pixelType.toLowerCase(),mask:n.mask,statistics:null});return r.updateStatistics(),r}function $t(e,t){let n=t.pixelType||`u8`,r=O.getPixelArrayConstructor(n),i=n===`u8`?e:new r(e.buffer),a=[],o=t.planes||1;if(o===1)a.push(i);else for(let n=0;n<o;n++){let s=(t.width||1)*(t.height||e.length),c=new r(s);for(let e=0;e<s;e++)c[e]=i[e*o+n];a.push(c)}let s=new O({width:t.width||1,height:t.height||e.length,pixels:a,pixelType:n,statistics:null});return s.updateStatistics(),s}function en(e,t){return $t(new ke(new Uint8Array(e)).getBytes(),t)}function tn(e,t){return $t(qe(e,t.offset,t.eof,!t.isInputBigEndian),t)}function nn(e,t,n){let{pixelTypeCtor:r}=ln(t.pixelType),i=(0,at.decode)(e,{width:t.width,height:t.height,pixelType:r,format:n}),a=new O({width:t.width,height:t.height,pixels:i.pixels,pixelType:t.pixelType,mask:i.mask,statistics:null});return a.updateStatistics(),a}function rn(e,t){let n=Fe.decode(e,t.hasNoZlibMask??void 0),r=new O({width:n.width,height:n.height,pixels:n.pixels,pixelType:`u8`,mask:n.mask,statistics:null});return r.updateStatistics(),r}function an(e,t){let n=new Uint8Array(e),r=new qt(n),{width:i,height:a}=t,o=i*a,s=r.decode(),c,l=0,u=0,d=new Uint8Array(o);for(l=0;l<o;l++)d[l]=s[4*l+3];let f=new O({width:i,height:a,pixels:[],pixelType:`u8`,mask:d,statistics:[]});for(l=0;l<3;l++){for(c=new Uint8Array(o),u=0;u<o;u++)c[u]=s[4*u+l];f.addData({pixels:c})}return f.updateStatistics(),f}async function on(e,t,n,r){let i=new Ae,a={applyJpegMask:!1,format:t,...n},o=await i.decode(e,a,r),s=new O(o);return s.updateStatistics(),s}function sn(e){if(e==null)throw new l(`rasterCodec:decode`,`parameter encodeddata is required.`);let t=new Uint8Array(e,0,10),n=``;return t[0]===255&&t[1]===216?n=`jpg`:t[0]===137&&t[1]===80&&t[2]===78&&t[3]===71?n=`png`:t[0]===67&&t[1]===110&&t[2]===116&&t[3]===90&&t[4]===73&&t[5]===109&&t[6]===97&&t[7]===103&&t[8]===101&&t[9]===32?n=`lerc`:t[0]===76&&t[1]===101&&t[2]===114&&t[3]===99&&t[4]===50&&t[5]===32?n=`lerc2`:t[0]===73&&t[1]===73&&t[2]===42&&t[3]===0||t[0]===77&&t[1]===77&&t[2]===0&&t[3]===42||t[0]===73&&t[1]===73&&t[2]===43&&t[3]===0||t[0]===77&&t[1]===77&&t[2]===0&&t[3]===43?n=`tiff`:t[0]===71&&t[1]===73&&t[2]===70?n=`gif`:t[0]===66&&t[1]===77?n=`bmp`:t[0]===81&&t[1]===66&&t[2]===51?n=`qb3`:String.fromCharCode.apply(null,t).toLowerCase().includes(`error`)&&(n=`error`),n}function cn(e){let t=null;switch(e){case`lerc`:case`lerc2`:t=Yt;break;case`jpg`:t=rn;break;case`png`:t=an;break;case`bsq`:case`bip`:t=(t,n)=>nn(t,n,e);break;case`tiff`:t=Zt;break;case`deflate`:t=en;break;case`lzw`:t=tn;break;case`qb3`:t=Xt;break;case`error`:t=()=>{throw new l(`rasterCodec:decode`,`input data contains error`)};break;default:t=()=>{throw new l(`rasterCodec:decode`,`unsupported raster format`)}}return t}function ln(e){let t=null,n=null;switch(e?e.toLowerCase():`f32`){case`u1`:case`u2`:case`u4`:case`u8`:n=255,t=Uint8Array;break;case`u16`:n||=65535,t=Uint16Array;break;case`u32`:n||=2**32-1,t=Uint32Array;break;case`s8`:n||=-128,t=Int8Array;break;case`s16`:n||=-32768,t=Int16Array;break;case`s32`:n||=0-2**31,t=Int32Array;break;default:t=Float32Array}return{pixelTypeCtor:t,noDataValue:n}}function un(e,t=1){if(!e)return;let{pixels:n,width:r,height:i,mask:a}=e;if(!n||n.length===0)return;let o=n.length,s=r-1,c=i-1,l=[],u,d,f,p,m,h,g=null,_=O.getPixelArrayConstructor(e.pixelType);if(t===0){for(u=0;u<o;u++){for(m=n[u],h=new _(s*c),d=0;d<c;d++)for(p=d*r,f=0;f<s;f++)h[d*s+f]=m[p+f];l.push(h)}if(a!=null)for(g=new Uint8Array(s*c),d=0;d<c;d++)for(p=d*r,f=0;f<s;f++)g[d*s+f]=a[p+f]}else{for(u=0;u<o;u++){for(m=n[u],h=new _(s*c),d=0;d<c;d++)for(p=d*r,f=0;f<s;f++)h[d*s+f]=(m[p+f]+m[p+f+1]+m[p+r+f]+m[p+r+f+1])/4;l.push(h)}if(a)for(g=new Uint8Array(s*c),d=0;d<c;d++)for(p=d*r,f=0;f<s;f++)g[d*s+f]=Math.min.apply(null,[a[p+f],a[p+f+1],a[p+r+f],a[p+r+f+1]])}e.width=s,e.height=c,e.mask=g,e.pixels=l}function dn(e){let t=sn(e);return t===`lerc2`?t=`lerc`:t===`error`&&(t=``),t}async function fn(e,t={},n){if(e==null)throw new l(`rasterCodec:decode`,`missing encodeddata parameter.`);let r=t.format?.toLowerCase();if(!(r!==`bsq`&&r!==`bip`||t.width!=null&&t.height!=null))throw new l(`rasterCodec:decode`,`requires width and height in options parameter.`);if(r===`tiff`&&t.customOptions)return Qt(e,t);if((!r||r!==`bsq`&&r!==`bip`&&r!==`deflate`&&r!==`lzw`)&&(r=sn(e)),t.useCanvas&&Jt.has(r))return on(e,r,t,n);let i=cn(r),a;t.isPoint&&((t={...t}).width!=null&&t.width++,t.height!=null&&t.height++);let{offsets:o}=t;if(o&&o.length>1){let n=o.map((n,r)=>i(e.slice(n,o[r+1]),t)),r=await Promise.all(n);a=r[0],a.pixels=r.map(e=>e.pixels[0]);let s=r.map(e=>e.mask);r.some(e=>e!=null)&&(s.forEach((e,t)=>{e??(s[t]=new Uint8Array(a.width*a.height).fill(255))}),a.bandMasks=s,a.mask=O.combineBandMasks(s)),a.updateStatistics()}else a=await i(e,{...t,offset:o?.[0]??t.offset});return r!==`jpg`&&t.noDataValue!=null&&a.depthCount===1&&x(a,t.noDataValue,{customFloatTolerance:t.tolerance}),t.isPoint&&un(a),a}function pn(e){return[`u8`,`s8`].includes(e.pixelType)&&e.statistics?.[0]?.min!=null&&e.statistics[0]?.max!=null&&e.bandCount===1}function mn(e,t){let{attributeTable:n,bandCount:r}=e;return n==null&&pn(e)?!0:!(n==null||r>1||t&&n.fields.find(e=>e.name.toLowerCase()===t.toLowerCase())==null)}function hn(e){let{bandCount:t,dataType:n,pixelType:r}=e;return n===`elevation`||n===`generic`&&t===1&&(r===`s16`||r===`s32`||r===`f32`||r===`f64`)}function gn(e,t=!1){let{bandCount:n,colormap:r,pixelType:i}=e;return n===1&&(!!r?.length||!t&&i===`u8`)}function _n(e,t=!1){let{attributeTable:n,bandCount:r}=e;return r===1&&(!t||n!=null||e.histograms!=null)}function vn(e){let{dataType:t}=e;return t===`vector-uv`||t===`vector-magdir`}function yn(e){let{dataType:t}=e;return t===`vector-uv`||t===`vector-magdir`}function bn(e){return!!e?.length&&e.length<=16384}var xn=1,Sn=[.299,.587,.114];function Cn(e){if(e==null)return!1;let{max:t,min:n,size:r}=e;return(t-n)/r===1&&n>=-.5&&Math.abs(n%1)===.5&&t<=255.5}function wn(e,t=256){t=Math.min(t,256);let{size:n,counts:r}=e,i=new Float64Array(n);i[0]=r[0]/t;for(let e=1;e<n;e++)i[e]=i[e-1]+r[e]/t;let a=new Uint8Array(t),o=t/i[i.length-1];if(n<=t){let r=Cn(e)?Math.max(0,Math.round(e.min+.5)):0;for(let e=r;e<t;e++)a[e]=e>=n+r?255:Math.min(255,Math.trunc(i[e-r]*o))}else{let e=i.map(e=>Math.min(255,Math.trunc(e*o)));for(let r=0;r<t;r++)a[r]=e[Math.round(n/t)];a[t-1]=255}return a}function Tn(e){let{minCutOff:t,maxCutOff:n,gamma:r,pixelType:i,rounding:a}=e;if(![`u8`,`u16`,`s8`,`s16`].includes(i))return null;let o=t.length,s=i===`s8`?-127:i===`s16`?-32767:0,c=[`u16`,`s16`].includes(i)?65536:256,l=[],u=[],{minOutput:d=0,maxOutput:f=255}=e,p=f-d;for(let e=0;e<o;e++)u[e]=n[e]-t[e],l[e]=u[e]===0?0:p/u[e];let m=[];if(r&&r.length>=o){let e=zn(o,r);for(let i=0;i<o;i++){let o=[];for(let l=0;l<c;l++){if(u[i]===0){o[l]=d;continue}let c=l+s,m=(c-t[i])/u[i],h=1;if(r[i]>1&&(h-=(1/p)**(m*e[i])),c<n[i]&&c>t[i]){let e=h*p*m**(1/r[i])+d;o[l]=a===`floor`?Math.floor(e):a===`round`?Math.round(e):e}else c>=n[i]?o[l]=f:o[l]=d}m[i]=o}}else for(let e=0;e<o;e++){let r=[];for(let i=0;i<c;i++){let o=i+s;if(o<=t[e])r[i]=d;else if(o>=n[e])r[i]=f;else{let n=(o-t[e])*l[e]+d;r[i]=a===`floor`?Math.floor(n):a===`round`?Math.round(n):n}}m[e]=r}if(e.contrastOffset!=null){let t=En(e.contrastOffset,e.brightnessOffset);for(let e=0;e<o;e++){let n=m[e];for(let e=0;e<c;e++)n[e]=t[n[e]]}}return{lut:m,offset:s}}function En(e,t){let n=Math.min(Math.max(e,-100),100),r=Math.min(Math.max(t??0,-100),100),i=new Uint8Array(256);for(let e=0;e<256;e++){let t=0;n>0&&n<100?t=(200*e-25500+510*r)/(2*(100-n))+128:n<=0&&n>-100?t=(200*e-25500+510*r)*(100+n)/2e4+128:n===100?(t=200*e-25500+256*(100-n)+510*r,t=t>0?255:0):n===-100&&(t=128),i[e]=t>255?255:t<0?0:t}return i}function Dn(e,t,n){let r=[];for(let i=0;i<t.length;i++){let a=0,o=0,s=0;`min`in t[i]?{min:a,max:o,avg:s}=t[i]:[a,o,s]=t[i];let c=s??0;e!==`u8`&&(c=255*(c-a)/(o-a)),n&&(c*=Sn[i]),r.push(On(c))}return r}function On(e){if(e<=0||e>=255)return xn;let t=e+(e===150?0:e<150?45*Math.cos(.01047*e):17*Math.sin(.021*e)),n=Math.log(e/255),r=Math.log(t/255);if(r===0)return xn;let i=n/r;return isNaN(i)?xn:Math.min(9.9,Math.max(.01,i))}function kn(e,t,n){let{min:r,max:i,count:a,avg:o,mode:s,median:c}=jn(e,t,!0);if(a===0)return{statistics:{min:0,max:0,avg:0,stddev:0,count:a,mode:0,median:0},histogram:null};let l={min:r,max:i,avg:o,mode:s,count:a,median:c},u=Nn(e,t,o,!n.includeSkewnessKurtosis);u&&(l.stddev=u.stddev,n.includeSkewnessKurtosis&&(l.skewness=u.skewness,l.kurtosis=u.kurtosis));let d=n?.histogramSize??256,f=!!n?.pixelType&&[`u8`,`s8`,`u4`,`u2`,`u1`].includes(n.pixelType),p=!n?.skipHistograms;if(c==null){let n=An({band:e,mask:t,min:r,max:i,size:1e4,use8BitHistogram:f});if(c=Mn(e,t,n,50),p&&f&&d===256)return{statistics:l,histogram:n}}return p?{statistics:l,histogram:An({band:e,mask:t,min:r,max:i,size:d,use8BitHistogram:f&&d===256})}:{statistics:l,histogram:null}}function An(e){let{band:t,mask:n,min:r,max:i,use8BitHistogram:a}=e;if(a){let e=i-r+1,a=new Uint32Array(e);for(let e=0;e<t.length;e++)n&&!n[e]||a[t[e]-r]++;return{min:r-.5,max:i+.5,size:e,counts:a}}let o=e.size??256,s=new Uint32Array(o),c=(i-r)/o;if(c===0){let e=n?n.reduce((e,t)=>e+(t?1:0),0):t.length;return{min:r,max:i,size:1,counts:new Uint32Array(1).fill(e)}}let l=new Uint32Array(o+1),u=1/c;for(let e=0;e<t.length;e++)n&&!n[e]||l[Math.floor((t[e]-r)*u)]++;for(let e=0;e<o-1;e++)s[e]=l[e];return s[o-1]=l[o-1]+l[o],{min:r,max:i,size:o,counts:s}}function jn(e,t,n=!1,r=!1){let i=1/0,a=-1/0,o=0,s=0,c=0,l=0,u=e.length,d=new Map;for(let n=0;n<u;n++){let r=e[n];if(!t||t[n]){let e=(d.get(r)??0)+1;d.set(r,e),e>l&&(l=e,c=r),i=r<i?r:i,a=r>a?r:a,o+=r,s++}}let f=s>0?o/s:0,p=i===a?i:void 0,m=i===a?i:void 0,h=i===a?i:void 0;if(n&&s>0&&s<2**24){let n=e.slice();if(t){let r=0;for(let i=0;i<u;i++){let a=e[i];t[i]&&(n[r++]=a)}}n=n.slice(0,s),n.sort((e,t)=>e-t);let i=s>>>1;p=s%2?n[Math.floor(i)]:(n[i-1]+n[i])/2,r&&(m=n[Math.floor(.25*s)],h=n[Math.floor(.75*s)])}return{min:i,max:a,count:s,avg:f,mode:c,median:p,quartile1:m,quartile3:h}}function Mn(e,t,n,r=50){let{counts:i,min:a,max:o,size:s}=n,c=i.reduce((e,t)=>e+t)*(r/=100),l=0,u=0;for(;u<i.length&&(l+=i[u],!(l>=c+1));u++);let d=(o-a)/s,f=a+d*u,p=a+d*(u+1);if(d===1&&Math.abs(a%1)===.5)return f+.5;let m=e.slice(0,i[u]).fill(0);for(let n=0,r=0;n<e.length;n++)if(!t||t[n]){let t=e[n];t>=f&&t<p&&(m[r++]=t)}m.sort((e,t)=>e-t);let h=l-Math.floor(c)-1;return m[Math.max(0,m.length-1-h)]}function Nn(e,t,n,r=!1,i=!1){let a=0,o=0,s=0,c=0;for(let i=0;i<e.length;i++)if(!t||t[i]){let t=e[i]-n,l=t*t;if(a+=l,!r){let e=l*t;o+=e,s+=e*t}c++}if(c<2)return null;a/=c-1;let l=Math.sqrt(a);return r?{stddev:l}:(s/=c,{stddev:l,skewness:i?o*(c/((c-1)*(c-2)))/a**1.5:o/c/a**1.5,kurtosis:s/(a*a)})}function Pn(e,t){let{pixels:n,mask:r,pixelType:i,bandMasks:a}=e,o=n.map((e,n)=>kn(e,a?.[n]??r,{pixelType:i,...t}));return{statistics:o.map(({statistics:e})=>e),histograms:o.map(({histogram:e})=>e)}}function Fn(e){if(!e?.pixels?.length)return null;let{pixels:t,mask:n,bandMasks:r,pixelType:i}=e,a=e.width*e.height,o=t.length,s=[],c=[],l,u;for(let d=0;d<o;d++){let o=new Uint32Array(256),f=t[d],p=r?.[d]??n;if(i===`u8`){if(l=255,u=0,p){for(let e=0;e<a;e++)if(p[e]){let t=f[e];l=t<l?t:l,u=t>u?t:u,o[t]++}}else for(let e=0;e<a;e++){let t=f[e];l=t<l?t:l,u=t>u?t:u,o[t]++}o=o.slice(l,u+1)}else{let t=!1;e.statistics||(e.updateStatistics(),t=!0);let n=e.statistics;l=n[d].minValue,u=n[d].maxValue;let r=(u-l)/256;if(r===0){!n||e.validPixelCount||t||e.updateStatistics();let r=(e.validPixelCount||e.width*e.height)/256;for(let e=0;e<256;e++)o[e]=Math.round(r*(e+1))-Math.round(r*e)}else{let e=new Uint32Array(257);for(let t=0;t<a;t++)p&&!p[t]||e[Math.floor((f[t]-l)/r)]++;for(let t=0;t<255;t++)o[t]=e[t];o[255]=e[255]+e[256]}}let m=i===`u8`?l-.5:l,h=i===`u8`?u+.5:u;s.push({min:m,max:h,size:o.length,counts:o});let g=0,_=0,v=0;for(let e=0;e<o.length;e++)g+=o[e],_+=e*o[e];let y=_/g;for(let e=0;e<o.length;e++)v+=o[e]*(e-y)**2;let b=Math.sqrt(v/(g-1)),x=(h-m)/o.length,S=(y+(i===`u8`?0:.5))*x+l,C=b*x;c.push({min:l,max:u,avg:S,stddev:C})}return{statistics:c,histograms:s}}function In(e){let t=[];for(let n=0;n<e.length;n++){let{min:r,max:i,size:a,counts:o}=e[n],s=0,c=0;for(let e=0;e<a;e++)s+=o[e],c+=e*o[e];let l=c/s,u=0;for(let e=0;e<a;e++)u+=o[e]*(e-l)**2;let d=(i-r)/a,f=(l+.5)*d+r,p=Math.sqrt(u/(s-1))*d;t.push({min:r,max:i,avg:f,stddev:p})}return t}function Ln(e,t){let{pixelBlock:n,bandIds:r,returnHistogramLut:i,rasterInfo:a}=t,o=null,s=null,c=e.stretchType;if(typeof c==`number`&&(c=be[c]),e.dra)if(c===`minMax`&&n?.statistics)o=n.statistics.map(e=>[e.minValue,e.maxValue,0,0]);else{let e=Fn(n);o=e==null?null:e.statistics,s=e==null?null:e.histograms}else o=e.statistics?.length?e.statistics:a.statistics,s=`histograms`in e?e.histograms:void 0,s||=a.histograms;c!==`percentClip`&&c!==`histogramEqualization`||s?.length||(c=`minMax`);let l=o?.length||s?.length||a.bandCount,u=[],d=[];o&&!Array.isArray(o[0])&&(o=o.map(e=>[e.min,e.max,e.avg,e.stddev]));let[f,p]=S(a.pixelType);if(!o?.length){o=[];for(let e=0;e<l;e++)o.push([f,p,1,1]);c===`standardDeviation`&&(c=`minMax`)}switch(c){case`none`:for(let e=0;e<l;e++)u[e]=f,d[e]=p;break;case`minMax`:for(let e=0;e<l;e++){let t=o[e];u[e]=t[0],d[e]=t[1]}break;case`standardDeviation`:{let{numberOfStandardDeviations:t=2}=e;for(let e=0;e<l;e++){let n=o[e];u[e]=n[2]-t*n[3],d[e]=n[2]+t*n[3],u[e]<n[0]&&(u[e]=n[0]),d[e]>n[1]&&(d[e]=n[1])}}break;case`histogramEqualization`:_(s);for(let e=0;e<l;e++)u[e]=s[e].min,d[e]=s[e].max;break;case`percentClip`:_(s);for(let t=0;t<s.length;t++){let n=s[t],r=new Uint32Array(n.size),i=[...n.counts];i.length>=20&&(i[0]=i[1]=i[2]=i[i.length-1]=i[i.length-2]=0);let a=0,o=(n.max-n.min)/n.size,c=n.min===-.5&&o===1?.5:0;for(let e=0;e<n.size;e++)a+=i[e],r[e]=a;let l=(e.minPercent||0)*a/100;u[t]=n.min+c;for(let e=0;e<n.size;e++)if(r[e]>l){u[t]=n.min+o*(e+c);break}l=(1-(e.maxPercent||0)/100)*a,d[t]=n.max+c;for(let e=n.size-2;e>=0;e--)if(r[e]<l){d[t]=n.min+o*(e+2-c);break}if(d[t]<u[t]){let e=u[t];u[t]=d[t],d[t]=e}}break;default:for(let e=0;e<l;e++){let t=o[e];u[e]=t[0],d[e]=t[1]}}let m,h,g;return c===`histogramEqualization`?(_(s),h=s[0].size||256,m=0,i&&(g=s.map(e=>wn(e)))):(h=e.max||255,m=e.min||0),Rn({minCutOff:u,maxCutOff:d,maxOutput:h,minOutput:m,histogramLut:g},r)}function Rn(e,t){if(t==null||t.length===0)return e;let n=Math.max.apply(null,t),{minCutOff:r,maxCutOff:i,minOutput:a,maxOutput:o,histogramLut:s}=e;return r.length===t.length||r.length<=n?e:{minCutOff:t.map(e=>r[e]),maxCutOff:t.map(e=>i[e]),histogramLut:s?t.map(e=>s[e]):null,minOutput:a,maxOutput:o}}function zn(e,t){let n=new Float32Array(e);for(let r=0;r<e;r++)t[r]>1?t[r]>2?n[r]=6.5+(t[r]-2)**2.5:n[r]=6.5+100*(2-t[r])**4:n[r]=1;return n}function Bn(e,t){if(!e?.pixels?.length)return e;let{mask:n,bandMasks:r,width:i,height:a,pixels:o}=e,{minCutOff:s,maxCutOff:c,minOutput:l,maxOutput:u,gamma:d}=t,f=i*a,p=t.outputPixelType||`u8`,m=e.pixels.map(()=>O.createEmptyBand(p,f)),h=m.length,g=u-l,_=[],v=[];for(let e=0;e<h;e++)v[e]=c[e]-s[e],_[e]=v[e]===0?0:g/v[e];let y=p.startsWith(`u`)||p.startsWith(`s`),b=d&&d.length>=h,x=!!t.isRenderer;if(b){let e=zn(h,d);for(let t=0;t<h;t++){let i=r?.[t]??n;for(let n=0;n<f;n++)if(i==null||i[n]){if(v[t]===0){m[t][n]=l;continue}let r=o[t][n],i=(r-s[t])/v[t],a=1;if(d[t]>1&&(a-=(1/g)**(i*e[t])),r<c[t]&&r>s[t]){let e=a*g*i**(1/d[t])+l;m[t][n]=x?Math.floor(e):y?Math.round(e):e}else r>=c[t]?m[t][n]=u:m[t][n]=l}}}else for(let e=0;e<h;e++){let t=r?.[e]??n;for(let n=0;n<f;n++)if(t==null||t[n]){let t=o[e][n];if(t<c[e]&&t>s[e]){let r=(t-s[e])*_[e]+l;m[e][n]=x?Math.floor(r):y?Math.round(r):r}else t>=c[e]?m[e][n]=u:m[e][n]=l}}let S=new O({width:i,height:a,mask:n,bandMasks:r,pixels:m,pixelType:p});return S.updateStatistics(),S}var Q=1,Vn=1/111e3;function Hn(e){let{altitude:t,azimuth:n}=e,{hillshadeType:r,pixelSizePower:i=1,pixelSizeFactor:a=1,scalingType:o,isGCS:s,resolution:c}=e,l=r===`multi-directional`?2*e.zFactor:e.zFactor,{x:u,y:d}=c,f=l/(8*u),p=l/(8*d);if(s&&l>.001&&(f/=900900900900901e-20,p/=900900900900901e-20),o===`adjusted`)if(s){let e=u*Vn,t=d*Vn;f=(l+e**i*a)/(8*e),p=(l+t**i*a)/(8*t)}else f=(l+u**i*a)/(8*u),p=(l+d**i*a)/(8*d);let m=(90-t)*Math.PI/180,h=Math.cos(m),g=(360-n+90)*Math.PI/180,_=Math.sin(m)*Math.cos(g),v=Math.sin(m)*Math.sin(g),y=[315,270,225,360,180,0],b=[60,60,60,60,60,90],x=new Float32Array([3,5,3,2,1,4]),S=x.reduce((e,t)=>e+t),C=x.map(e=>e/S),w=r===`multi-directional`?y.length:1,T=new Float32Array(6),E=new Float32Array(6),D=new Float32Array(6);if(r===`multi-directional`)for(let e=0;e<w;e++)t=b[e],n=y[e],m=(90-t)*Math.PI/180,h=Math.cos(m),g=(360-n+90)*Math.PI/180,_=Math.sin(m)*Math.cos(g),v=Math.sin(m)*Math.sin(g),T[e]=h,E[e]=_,D[e]=v;else T.fill(h),E.fill(_),D.fill(v);return{resolution:c,factor:[f,p],sinZcosA:_,sinZsinA:v,cosZ:h,sinZcosAs:[...E],sinZsinAs:[...D],cosZs:[...T],weights:[...C],hillshadeType:[`traditional`,`multi-directional`].indexOf(r)}}function Un(e,t){let{width:n,height:r}=e,i=n*r,a=new Uint8Array(i),o=e.mask!=null,s;if(o){s=new Uint8Array(e.mask);for(let e=0;e<s.length;e++)s[e]&&(a[e]=1,s[e]=1)}let c=e.pixels[0],l=new Float32Array(i),u=new Float32Array(i),d,f=0;if(t){let{resolution:e}=t,n=e?(e.x+e.y)/2:1;f=200*t.zFactor/(n*n),d=new Float32Array(i)}let p=t?.curvatureType,m,h,g,_,v,y,b,x;for(let e=Q;e<r-Q;e++){let t=e*n;for(let e=Q;e<n-Q;e++){let r=t+e;if(!s||s[r]!==0){if(s){if(s[r-n-1]+s[r-n]+s[r-n+1]+s[r-1]+s[r+1]+s[r+n-1]+s[r+n]+s[r+n+1]<7){a[r]=0;continue}m=s[r-n-1]?c[r-n-1]:c[r],h=s[r-n]?c[r-n]:c[r],g=s[r-n+1]?c[r-n+1]:c[r],_=s[r-1]?c[r-1]:c[r],v=s[r+1]?c[r+1]:c[r],y=s[r+n-1]?c[r+n-1]:c[r],b=s[r+n]?c[r+n]:c[r],x=s[r+n+1]?c[r+n+1]:c[r]}else m=c[r-n-1],h=c[r-n],g=c[r-n+1],_=c[r-1],v=c[r+1],y=c[r+n-1],b=c[r+n],x=c[r+n+1];if(l[r]=g+v+v+x-(m+_+_+y),u[r]=y+b+b+x-(m+h+h+g),d!=null){let e=c[r],t=.5*(_+v)-e,n=.5*(h+b)-e;if(p===`standard`)d[r]=-f*(t+n);else{let e=(-m+g+y-x)/4,i=(-_+v)/2,a=(h-b)/2,o=i*i,s=a*a,c=o+s;c&&(d[r]=p===`profile`?f*(t*o+n*s+e*i*a)/c:-f*(t*s+n*o-e*i*a)/c)}}}}}return{outMask:o?a:null,dzxs:l,dzys:u,curvatures:d}}function Wn(e,t,n){for(let r=0;r<n;r++)e[r*t]=e[r*t+1],e[(r+1)*t-1]=e[(r+1)*t-2];for(let r=1;r<t-1;r++)e[r]=e[r+t],e[r+(n-1)*t]=e[r+(n-2)*t]}function Gn(e,t){if(!k(e))return e;let{factor:n,sinZcosA:r,sinZsinA:i,cosZ:a,sinZcosAs:o,sinZsinAs:s,cosZs:c,weights:l}=Hn(t),[u,d]=n,f=t.hillshadeType===`traditional`,{width:p,height:m}=e,h=new Uint8Array(p*m),{dzxs:g,dzys:_,outMask:v}=Un(e);for(let e=Q;e<m-Q;e++){let t=e*p;for(let e=Q;e<p-Q;e++){let n=t+e;if(!v||v[n]){let e=g[n]*u,t=_[n]*d,p=Math.sqrt(1+e*e+t*t),m=0;if(f){let n=255*(a+i*t-r*e)/p;n<0&&(n=0),m=n}else{let n=s.length;for(let r=0;r<n;r++){let n=255*(c[r]+s[r]*t-o[r]*e)/p;n<0&&(n=0),m+=n*l[r]}}h[n]=255&m}}}return Wn(h,p,m),new O({width:p,height:m,pixels:[h],mask:v,pixelType:`u8`,validPixelCount:e.validPixelCount,statistics:[new D(0,255)]})}function Kn(e,t,n,r){if(!k(e)||!k(t))return;let{min:i,max:a}=r,o=e.pixels[0],{pixels:s,mask:c}=t,l=s[0],u=255.00001/(a-i),d=new Uint8ClampedArray(l.length),f=new Uint8ClampedArray(l.length),p=new Uint8ClampedArray(l.length),m=n.length-1;for(let e=0;e<l.length;e++){if(c&&c[e]===0)continue;let t=Math.floor((l[e]-i)*u),[r,a]=n[t<0?0:t>m?m:t],s=o[e],h=s*a,g=h*(1-Math.abs(r%2-1)),_=s-h;switch(Math.floor(r)){case 0:d[e]=h+_,f[e]=g+_,p[e]=_;break;case 1:d[e]=g+_,f[e]=h+_,p[e]=_;break;case 2:d[e]=_,f[e]=h+_,p[e]=g+_;break;case 3:d[e]=_,f[e]=g+_,p[e]=h+_;break;case 4:d[e]=g+_,f[e]=_,p[e]=h+_;break;case 5:case 6:d[e]=h+_,f[e]=_,p[e]=g+_}}e.pixels=[d,f,p],e.updateStatistics()}function qn(e,t){if(!k(e))return e;let n=t.zFactor,r=t.pixelSizePower??1,i=t.pixelSizeFactor??1,a=t.slopeType,o=t.isGCS,{x:s,y:c}=t.resolution,l=n/(8*s),u=n/(8*c);o&&Math.abs(n-1)<1e-4&&(l/=900900900900901e-20,u/=900900900900901e-20),a===`adjusted`&&(l=(n+s**r*i)/(8*s),u=(n+c**r*i)/(8*c));let{dzxs:d,dzys:f,outMask:p}=Un(e),{width:m,height:h}=e,g=new Float32Array(m*h);for(let e=Q;e<h-Q;e++){let t=e*m;for(let e=Q;e<m-Q;e++){let n=t+e;if(!p||p[n]){let r=d[n]*l,i=f[n]*u,o=Math.sqrt(r*r+i*i);g[t+e]=a===`percent-rise`?100*o:57.2957795*Math.atan(o)}}}Wn(g,m,h);let _=new O({width:m,height:h,pixels:[g],mask:p,pixelType:`f32`,validPixelCount:e.validPixelCount});return _.updateStatistics(),_}function Jn(e,t={}){if(!k(e))return e;let{resolution:n}=t,r=n?1/n.x:1,i=n?1/n.y:1,{dzxs:a,dzys:o,outMask:s}=Un(e),{width:c,height:l}=e,u=new Float32Array(c*l);for(let e=Q;e<l-Q;e++){let t=e*c;for(let e=Q;e<c-Q;e++){let n=t+e;if(!s||s[n]){let s=a[n]*r,c=o[n]*i,l=-1;s===0&&c===0||(l=90-57.29578*Math.atan2(c,-s),l<0&&(l+=360),l===360?l=0:l>360&&(l%=360)),u[t+e]=l}}}return Wn(u,c,l),new O({width:c,height:l,pixels:[u],mask:s,pixelType:`f32`,validPixelCount:e.validPixelCount,statistics:[new D(-1,360)]})}function Yn(e,t){if(!k(e))return e;let{curvatures:n,outMask:r}=Un(e,t),{width:i,height:a}=e;Wn(n,i,a);let o=new O({width:i,height:a,pixels:[n],mask:r,pixelType:`f32`,validPixelCount:e.validPixelCount});return o.updateStatistics(),o}function Xn(e,t,n){let{hillshadeType:r,altitude:i,azimuth:a,zFactor:o,pixelSizeFactor:s,pixelSizePower:c,slopeType:l}=e;return{hillshadeType:r,altitude:i,azimuth:a,zFactor:o,pixelSizePower:c,pixelSizeFactor:s,scalingType:l===`scaled`?`adjusted`:`none`,resolution:t,isGCS:n}}var $=class extends v{constructor(e){super(e),this.lookup={rendererJSON:{}},this.canRenderInWebGL=!1}bind(){let{rendererJSON:e}=this;if(!e)return{success:!1};let t;switch(this.lookup={rendererJSON:{}},e.type){case`uniqueValue`:t=this._updateUVRenderer(e);break;case`rasterColormap`:t=this._updateColormapRenderer(e);break;case`rasterStretch`:t=this._updateStretchRenderer(e);break;case`classBreaks`:t=this._updateClassBreaksRenderer(e);break;case`rasterShadedRelief`:t=this._updateShadedReliefRenderer(e);break;case`vectorField`:t=this._updateVectorFieldRenderer();break;case`flowRenderer`:t=this._updateFlowRenderer()}return t}symbolize(e){let t=e?.pixelBlock;if(!$n(t))return t;if(e.simpleStretchParams&&this.rendererJSON.type===`rasterStretch`)return this.simpleStretch(t,e.simpleStretchParams);try{let n;switch(t.pixels.length>3&&(t=t.extractBands(e.bandIds??[0,1,2])),this.rendererJSON.type){case`uniqueValue`:case`rasterColormap`:n=this._symbolizeColormap(t);break;case`classBreaks`:n=this._symbolizeClassBreaks(t);break;case`rasterStretch`:n=this._symbolizeStretch(t,e.bandIds);break;case`rasterShadedRelief`:{let r=e.extent,i=r.spatialReference.isGeographic,a={x:(r.xmax-r.xmin)/t.width,y:(r.ymax-r.ymin)/t.height};n=this._symbolizeShadedRelief(t,{isGCS:i,resolution:a});break}}return n}catch(e){return y.getLogger(this).error(`symbolize`,e.message),t}}simpleStretch(e,t){if(!$n(e))return e;try{return e.pixels.length>3&&(e=e.extractBands([0,1,2])),Bn(e,{...t,isRenderer:!0})}catch(t){return y.getLogger(this).error(`symbolize`,t.message),e}}generateWebGLParameters(e){let{rendererJSON:t}=this;switch(t.type){case`uniqueValue`:case`rasterColormap`:case`classBreaks`:return this._generateColormapWebGLParams(t.type===`classBreaks`);case`rasterStretch`:return this._generateStretchWebGLParams(e.pixelBlock,t,e.bandIds);case`rasterShadedRelief`:return this._generateShadedReliefWebGLParams(t,e.isGCS,e.resolution??void 0);case`vectorField`:return this._generateVectorFieldWebGLParams(t);default:return null}}_isLUTChanged(e){let t=this.lookup.rendererJSON;if(!t)return!0;let{rendererJSON:n}=this;if(`colorRamp`in n&&n.colorRamp){let r=n.colorRamp;if(e)return JSON.stringify(r)!==JSON.stringify(t.colorRamp)}return JSON.stringify(n)!==JSON.stringify(t)}_symbolizeColormap(e){return this._isLUTChanged()&&!this.bind().success?e:j(e,this.lookup.colormapLut)}_symbolizeClassBreaks(e){let{canUseIndexedLUT:t}=this._analyzeClassBreaks(this.rendererJSON);return this._isLUTChanged()&&!this.bind().success?e:t?j(e,this.lookup.colormapLut):A(e,this.lookup.remapLut??[])}_symbolizeStretch(e,t){if(!e)return null;let{rasterInfo:n,lookup:r}=this,{pixelType:i,bandCount:a}=n,o=this.rendererJSON,s=[`u8`,`u16`,`s8`,`s16`].includes(i),c,{dra:l}=o,{gamma:u}=r;if(l&&(t=null),o.stretchType===`histogramEqualization`){let i=l?null:r.histogramLut,a=Ln(o,{rasterInfo:n,pixelBlock:e,bandIds:t,returnHistogramLut:!i}),s=n.pixelType===`u8`&&!l&&Cn(n.histograms?.[0])?e:Bn(e,{...a,gamma:u,isRenderer:!0});c=M(s,{lut:l?a.histogramLut:t?.length?t.map(e=>i[e]):i,offset:0})}else if(s){let s;if(l){let r=Ln(o,{rasterInfo:n,pixelBlock:e,bandIds:t});s=Tn({pixelType:i,...r,gamma:u,rounding:`floor`})}else{if(this._isLUTChanged()&&!this.bind().success)return e;s=r.stretchLut}if(!s)return e;a>1&&t!=null&&t.length===e?.pixels.length&&s.lut.length===a&&(s={lut:t.map(e=>s.lut[e]),offset:s.offset}),c=M(e,s)}else{let r=Ln(o,{rasterInfo:n,pixelBlock:e,bandIds:t});c=Bn(e,{...r,gamma:u,isRenderer:!0})}if(o.colorRamp){if(this._isLUTChanged(!0)&&!this.bind().success)return e;c=j(c,r.colormapLut)}return c}_symbolizeShadedRelief(e,t){let n=this.rendererJSON,r={...n,...t},i=Gn(e,r);if(!n.colorRamp||this._isLUTChanged(!0)&&!this.bind().success)return i;let{hsvMap:a}=this.lookup;if(!a)return i;let o=this.rasterInfo.statistics?.[0]??{min:0,max:8e3};return Kn(i,e,a,o),i}_isVectorFieldData(){let{bandCount:e,dataType:t}=this.rasterInfo;return e===2&&(t===`vector-magdir`||t===`vector-uv`)}_updateVectorFieldRenderer(){return this._isVectorFieldData()?{success:!0}:{success:!1,error:`Unsupported data type "${this.rasterInfo.dataType}"; VectorFieldRenderer only supports "vector-magdir" and "vector-uv".`}}_updateFlowRenderer(){return this._isVectorFieldData()?{success:!0}:{success:!1,error:`Unsupported data type "${this.rasterInfo.dataType}"; FlowRenderer only supports "vector-magdir" and "vector-uv".`}}_updateUVRenderer(e){let{bandCount:t,attributeTable:n,pixelType:r}=this.rasterInfo,i=e.field1;if(!i)return{success:!1,error:`Unsupported renderer; missing UniqueValueRenderer.field.`};let a=e.defaultSymbol,o=t===1&&[`u8`,`s8`].includes(r);if(!mn(this.rasterInfo,i)&&!o)return{success:!1,error:`Unsupported data; UniqueValueRenderer is only supported on single band data with a valid raster attribute table.`};let s=[];if(n!=null){let t=n.fields.find(e=>e.name.toLowerCase()===`value`);if(!t)return{success:!1,error:`Unsupported data; the data's raster attribute table does not have a value field.`};n.features.forEach(n=>{let r=(e.uniqueValueInfos?.find(e=>String(e.value)===String(n.attributes[i])))?.symbol?.color;r?s.push([n.attributes[t.name]].concat(r)):a&&s.push([n.attributes[t.name]].concat(a.color))})}else{if(i.toLowerCase()!==`value`)return{success:!1,error:`Unsupported renderer; UniqueValueRenderer.field must be "Value" when raster attribute table is not available.`};e.uniqueValueInfos?.forEach(e=>{let t=e?.symbol?.color;t?s.push([parseInt(``+e.value,10)].concat(t)):a&&s.push([parseInt(``+e.value,10)].concat(a?.color))})}if(s.length===0)return{success:!1,error:`Invalid UniqueValueRenderer. Cannot find matching records in the raster attribute table.`};let c=N({colormap:s});return this.lookup={rendererJSON:e,colormapLut:c},this.canRenderInWebGL=bn(c?.indexedColormap),{success:!0}}_updateColormapRenderer(e){if(!gn(this.rasterInfo))return{success:!1,error:`Unsupported data; the data source does not have a colormap.`};let t=e.colormapInfos.map(e=>[e.value].concat(e.color)).sort((e,t)=>e[0]-t[0]);if(!t||t.length===0)return{success:!1,error:`Unsupported renderer; ColormapRenderer must have meaningful colormapInfos.`};let n=N({colormap:t});return this.lookup={rendererJSON:e,colormapLut:n},this.canRenderInWebGL=bn(n?.indexedColormap),{success:!0}}_updateShadedReliefRenderer(e){if(!hn(this.rasterInfo))return{success:!1,error:`Unsupported data type "${this.rasterInfo.dataType}"; ShadedReliefRenderer only supports "elevation", or single band float/s16 data.`};if(e.colorRamp){let t=pe(e.colorRamp,{interpolateAlpha:!0}),n=N({colormap:t}),r=me(n.indexedColormap);this.lookup={rendererJSON:e,colormapLut:n,hsvMap:r}}else this.lookup={rendererJSON:e};return this.canRenderInWebGL=!0,{success:!0}}_analyzeClassBreaks(e){let{attributeTable:t,pixelType:n}=this.rasterInfo,r=t?.fields.find(e=>e.name.toLowerCase()===`value`),i=t?.fields.find(t=>t.name.toLowerCase()===e.field.toLowerCase()),a=r!=null&&i!==null;return{canUseIndexedLUT:[`u8`,`u16`,`s8`,`s16`].includes(n)||a,tableValueField:r,tableBreakField:i}}_updateClassBreaksRenderer(e){let{attributeTable:t}=this.rasterInfo,{canUseIndexedLUT:n,tableValueField:r,tableBreakField:i}=this._analyzeClassBreaks(e),a=e.classBreakInfos;if(!a?.length)return{success:!1,error:`Unsupported renderer; missing or invalid ClassBreaksRenderer.classBreakInfos.`};let o=a.sort((e,t)=>e.classMaxValue-t.classMaxValue),s=o[o.length-1],c=e.minValue;if(!n){let t=[];for(let e=0;e<o.length;e++)t.push({value:o[e].classMinValue??c,mappedColor:o[e].symbol.color}),c=o[e].classMaxValue;return t.push({value:s.classMaxValue,mappedColor:s.symbol.color}),this.lookup={rendererJSON:e,remapLut:t},this.canRenderInWebGL=!1,{success:!0}}let l=[];if(t!=null&&r!=null&&i!==null&&r!==i){let n=r.name,a=i.name,s=o[o.length-1],{classMaxValue:u}=s;c=e.minValue;for(let e of t.features){let t=e.attributes[n],r=e.attributes[a],i=r===u?s:r<c?null:o.find(({classMaxValue:e})=>e>r);i&&l.push([t].concat(i.symbol.color))}}else{let[t,n]=S(this.rasterInfo.pixelType);c=Math.max(t,Math.floor(e.minValue));for(let e=0;e<o.length;e++){let t=o[e],r=Math.min(n,Math.ceil(t.classMaxValue));for(let e=c;e<r;e++)l.push([e].concat(t.symbol.color));c=r}s.classMaxValue!==c&&c!==n||l.push([c].concat(s.symbol.color))}let u=N({colormap:l,fillUnspecified:!1});return this.lookup={rendererJSON:e,colormapLut:u},this.canRenderInWebGL=bn(u?.indexedColormap),{success:!0}}_updateStretchRenderer(e){let{stretchType:t,dra:n}=e;if(!(t===`none`||e.statistics?.length||Qn(this.rasterInfo.statistics)||n))return{success:!1,error:`Unsupported renderer; StretchRenderer.customStatistics is required when dynamic range adjustment is not used.`};let r=e.histograms||this.rasterInfo.histograms;!Zn(e.stretchType)||r?.length||n||(t=`minMax`);let{computeGamma:i,useGamma:a,colorRamp:o}=e,{gamma:s}=e;if(a&&i&&!s?.length){let t=e.statistics?.length?e.statistics:this.rasterInfo.statistics;s=Dn(this.rasterInfo.pixelType,t)}let c=this.rasterInfo.pixelType,l=!n&&[`u8`,`u16`,`s8`,`s16`].includes(c);if(t===`histogramEqualization`){let t=r.map(e=>wn(e));this.lookup={rendererJSON:e,histogramLut:t}}else if(l){let t=Ln(e,{rasterInfo:this.rasterInfo}),n=Tn({pixelType:c,...t,gamma:a?s:null,rounding:`floor`});this.lookup={rendererJSON:e,stretchLut:n}}else this.lookup={rendererJSON:e};if(o&&!er(o)){let t=pe(o,{interpolateAlpha:!0});this.lookup.colormapLut=N({colormap:t}),this.lookup.rendererJSON=e}return this.lookup.gamma=a&&s?.length?s:null,this.canRenderInWebGL=t!==`histogramEqualization`,{success:!0}}_generateColormapWebGLParams(e){let{indexedColormap:t,offset:n}=this.lookup.colormapLut||{};return{colormap:t,colormapOffset:n,isClassBreaks:e,type:`lut`}}_generateStretchWebGLParams(e,t,n){let{colormapLut:r}=this.lookup,i=t.colorRamp?r?.indexedColormap:null,a=t.colorRamp?r?.offset:null;t.stretchType===`histogramEqualization`&&(t={...t,stretchType:`minMax`});let{gamma:o}=this.lookup,s=!(!t.useGamma||!o?.some(e=>e!==1)),c=0;e!=null&&(c=e.getPlaneCount(),c===2&&((e=e.clone()).statistics=[e.statistics[0]],e.pixels=[e.pixels[0]]));let{bandCount:l}=this.rasterInfo,u=Math.min(3,n?.length||c||l,l),d=i||s?1:255,f=new Float32Array(u);if(s&&o)for(let e=0;e<u;e++)o[e]>1?o[e]>2?f[e]=6.5+(o[e]-2)**2.5:f[e]=6.5+100*(2-o[e])**4:f[e]=1;let p=s&&o?[o[0],o[1]??o[0],o[2]??o[0]]:[1,1,1],m=s?[f[0],f[1]??f[0],f[2]??f[0]]:[1,1,1];if(t.dra&&e==null&&(t.stretchType===`minMax`||t.stretchType===`standardDeviation`))return{bandCount:u,minOutput:(t.min??0)/d,maxOutput:(t.max??255)/d,minCutOff:[0,0,0],maxCutOff:[1,1,1],factor:[1,1,1],useGamma:s,gamma:p,gammaCorrection:m,colormap:i,colormapOffset:a,stretchType:t.stretchType,dynamicRangeAdjustment:t.dra,numberOfStandardDeviations:t.numberOfStandardDeviations??2,type:`stretch`};let{minCutOff:h,maxCutOff:g,minOutput:_,maxOutput:v}=Ln(t,{rasterInfo:this.rasterInfo,pixelBlock:e,bandIds:n});h.length===1&&(h[2]=h[1]=h[0]),g.length===1&&(g[2]=g[1]=g[0]);let y=g.map((e,t)=>g[t]===h[t]?0:(v-_)/(g[t]-h[t])/d);return{bandCount:u,minOutput:_/d,maxOutput:v/d,minCutOff:h,maxCutOff:g,factor:y,useGamma:s,gamma:p,gammaCorrection:m,colormap:i,colormapOffset:a,stretchType:t.stretchType,type:`stretch`}}_generateShadedReliefWebGLParams(e,t=!1,n={x:0,y:0}){let{colormapLut:r}=this.lookup,i=e.colorRamp?r?.indexedColormap:null,a=e.colorRamp?r?.offset:null,o={...e,isGCS:t,resolution:n},s=Hn(o),c=this.rasterInfo.statistics?.[0];return{...s,minValue:c?.min??0,maxValue:c?.max??8e3,hillshadeType:e.hillshadeType===`traditional`?0:1,type:`hillshade`,colormap:i,colormapOffset:a}}_generateVectorFieldWebGLParams(e){let{style:t,inputUnit:n,outputUnit:r,visualVariables:i,symbolTileSize:a,flowRepresentation:o}=e,s=this.rasterInfo.statistics?.[0].min??0,c=this.rasterInfo.statistics?.[0].max??50,l=i?.find(e=>e.type===`sizeInfo`)??{maxDataValue:c,maxSize:.8*a,minDataValue:s,minSize:.2*a},u=l.minDataValue??s,d=l.maxDataValue??c,f=l.maxSize!=null&&l.minSize!=null?[l.minSize/a,l.maxSize/a]:[.2,.8];t===`wind_speed`&&(f[0]=f[1]=(f[0]+f[1])/2);let p=u!=null&&d!=null?[u,d]:null,m=null;if(t===`classified_arrow`)if(u!=null&&d!=null&&l!=null){m=[];let e=(l.maxDataValue-l.minDataValue)/5;for(let t=0;t<6;t++)m.push(l.minDataValue+e*t)}else m=[0,1e-6,3.5,7,10.5,14];let h=o===`flow_to`==(t===`ocean_current_kn`||t===`ocean_current_m`)?0:Math.PI,g=i?.find(e=>e.type===`rotationInfo`);return{breakValues:m,dataRange:p,inputUnit:n,outputUnit:r,symbolTileSize:a,symbolPercentRange:f,style:t||`single_arrow`,rotation:h,rotationType:this.rasterInfo.storageInfo?.tileInfo&&this.rasterInfo.dataType===`vector-uv`?`geographic`:g?.rotationType||e.rotationType,type:`vectorField`}}};function Zn(e){return e===`percentClip`||e===`histogramEqualization`}function Qn(e){return e!=null&&e.length>0&&e[0].min!=null&&e[0].max!=null}function $n(e){return k(e)&&e.validPixelCount!==0}function er(e){return e.type===`algorithmic`&&[`0,0,0,255`,`0,0,0`].includes(e.fromColor.join(`,`))&&[`255,255,255,255`,`255,255,255`].includes(e.toColor.join(`,`))}n([a({json:{write:!0}})],$.prototype,`rendererJSON`,void 0),n([a({type:K,json:{write:!0}})],$.prototype,`rasterInfo`,void 0),n([a({json:{write:!0}})],$.prototype,`lookup`,void 0),n([a()],$.prototype,`canRenderInWebGL`,void 0),$=n([m(`esri.renderers.support.RasterSymbolizer`)],$);export{F as $,Mt as A,be as B,mn as C,Pt as D,fn as E,Y as F,_e as G,pe as H,lt as I,R as J,ve as K,ot as L,Nt as M,It as N,Ft as O,ft as P,P as Q,K as R,_n as S,dn as T,L as U,ye as V,me as W,V as X,ee as Y,fe as Z,Bn as _,Yn as a,yn as b,Gn as c,Pn as d,I as et,Tn as f,Fn as g,zn as h,Xn as i,Ht as j,Vt as k,Jn as l,In as m,Hn as n,qn as o,En as p,ie as q,Kn as r,Vn as s,$ as t,Ln as u,bn as v,gn as w,vn as x,hn as y,G as z};