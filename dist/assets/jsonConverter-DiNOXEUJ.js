import{Ux as e,_S as t,oS as n,sS as r,zS as i}from"./index-BqmCqmfp.js";import{I as a,Jt as o,Wt as s,Xt as c,cn as l,gt as u,in as d,kt as f,ln as p,m,o as h,st as g,vn as _,wn as v}from"./Point2D-UYEfE6HP.js";import{$ as y,$t as b,A as x,C as S,Cn as C,Dn as w,E as T,En as E,H as D,I as O,Kt as k,Ot as A,Sn as j,Xt as M,Yt as N,an as P,bn as F,en as I,fn as L,h as R,hn as z,kn as B,l as ee,q as te,qt as V,rn as ne,sn as H,tn as re,x as ie,xn as ae}from"./UnitFactory-J9WMNXdY.js";O()||S(e=>{let a,o;typeof e==`number`?a=e:o=e;let s={wkid:a,wkt:o},c,l;if(o){c=r(o);let e=i(s);if(!c&&!e)throw Error(`Unsupported WKT type: ${o}`)}else c=!i(s);return l=a&&n.has(a)?Math.PI/200:c?t(s):Math.PI/180,{isPCS:c,metersOrRadiansPerUnit:l,semiMajor:0,wkidOrWkt:e}});function oe(){if(this.m_i===-1)return this.m_i=0,{value:{m_token:1,m_value:null},done:!1};if(this.m_i<this.m_keys.length){let e=this.m_bReturnKey,t=Math.trunc(this.m_i);return this.m_bReturnKey=!this.m_bReturnKey,this.m_i+=.5,e?{value:{m_token:5,m_value:this.m_keys[t]},done:!1}:{value:{m_token:6,m_value:this.m_o[this.m_keys[t]]},done:!1}}return{value:{m_token:3,m_value:null},done:!0}}function se(){if(this.m_i===-1)return this.m_i=0,{value:{m_token:2,m_value:null},done:!1};if(this.m_i<this.m_a.length){let e={value:{m_token:6,m_value:this.m_a[this.m_i++]},done:!1};return this.m_strict||e.value.m_value===void 0&&(e.value.m_value=NaN),e}return{value:{m_token:4,m_value:null},done:!0}}var ce=class{createJSONObjectIterator(e){return{m_iteratorType:`object`,m_o:e,m_keys:this.m_options.strict?Object.keys(e):Object.keys(e).filter(t=>e[t]!==void 0),m_i:-1,m_bReturnKey:!0,next:oe}}createJSONArrayIterator(e){return{m_iteratorType:`array`,m_strict:this.m_options.strict,m_i:-1,m_a:e,next:se}}constructor(e,t){this.m_currentToken=0,this.m_options=t?{...t}:{strict:!0};let n=e;this.m_iteratorStack=[n instanceof Array?this.createJSONArrayIterator(n):this.createJSONObjectIterator(n)],this.m_nextFlatToken={m_value:null,m_token:0}}nextToken(){if(this.m_iteratorStack.length===0)return this.m_currentToken=0;switch(this.m_nextFlatToken=this.m_iteratorStack.at(-1).next().value,this.m_currentValue=void 0,this.m_nextFlatToken.m_token){case 1:return this.m_currentToken=1;case 3:return this.m_iteratorStack.pop(),this.m_currentToken=3;case 2:return this.m_currentToken=2;case 4:return this.m_iteratorStack.pop(),this.m_currentToken=4;case 5:return this.m_currentValue=this.m_nextFlatToken.m_value,this.m_currentToken=5;case 6:if(this.m_nextFlatToken.m_value instanceof Array)return this.m_iteratorStack.push(this.createJSONArrayIterator(this.m_nextFlatToken.m_value)),this.nextToken();if(this.m_nextFlatToken.m_value instanceof Object)return this.m_iteratorStack.push(this.createJSONObjectIterator(this.m_nextFlatToken.m_value)),this.nextToken();if(typeof this.m_nextFlatToken.m_value==`number`)return this.m_currentValue=this.m_nextFlatToken.m_value,Number.isSafeInteger(this.m_currentValue)&&this.m_currentValue>=s()&&this.m_currentValue<=u()?this.m_currentToken=8:this.m_currentToken=7;if(typeof this.m_nextFlatToken.m_value==`string`)return this.m_currentValue=this.m_nextFlatToken.m_value,this.m_currentToken=6;if(typeof this.m_nextFlatToken.m_value==`boolean`)return this.m_currentValue=this.m_nextFlatToken.m_value,this.m_currentToken=this.m_nextFlatToken.m_value?11:12;if(typeof this.m_nextFlatToken.m_value==`object`)return this.m_currentValue=null,this.m_currentToken=10;p(`unrecognized json element type`)}return p(`unrecognized json element type`),0}currentToken(){return this.m_currentToken}skipChildren(){if(this.m_iteratorStack.length!==0)switch(this.m_currentValue=void 0,this.m_nextFlatToken.m_token){case 1:this.m_iteratorStack.pop(),this.m_nextFlatToken.m_token=3,this.m_currentToken=3;return;case 2:this.m_iteratorStack.pop(),this.m_nextFlatToken.m_token=4,this.m_currentToken=4;return}}currentString(){return this.m_currentToken!==6&&this.m_currentToken!==5&&d(`invalid token`),this.m_currentValue}currentDoubleValue(){return this.m_currentToken!==7&&this.m_currentToken!==8&&d(`invalid token`),this.m_currentValue}currentInt32Value(){return this.m_currentToken!==8&&d(`invalid token`),this.m_currentValue}currentInt64Value(){return _(0),0n}currentBoolValue(){return this.m_currentToken!==12&&this.m_currentToken!==11&&d(`invalid token`),this.m_currentValue}isError(){return 0}},U=class{constructor(){this.m_pendingKey=null,this.m_acceptedObject=null,this.m_currentObject=[]}reset(){this.m_pendingKey=null,this.m_acceptedObject=null,this.m_currentObject.length=0}startObject(){let e={};this.m_pendingKey?(this.m_currentObject.at(-1)[this.m_pendingKey]=e,this.m_pendingKey=null):Array.isArray(this.m_currentObject.at(-1))&&this.m_currentObject.at(-1).push(e),this.m_currentObject.push(e)}startArray(){let e=[];this.m_pendingKey?(this.m_currentObject.at(-1)[this.m_pendingKey]=e,this.m_pendingKey=null):Array.isArray(this.m_currentObject.at(-1))&&this.m_currentObject.at(-1).push(e),this.m_currentObject.push(e)}endObject(){this.m_acceptedObject=this.m_currentObject.at(-1),this.m_currentObject.pop()}endArray(){this.m_currentObject.pop()}addFieldName(e){this.m_pendingKey=e}addValue_(e){this.m_pendingKey?(this.m_currentObject.at(-1)[this.m_pendingKey]=e,this.m_pendingKey=null):this.m_currentObject.at(-1).push(e)}addString(e){this.addValue_(e)}addDouble(e,t){this.addValue_(e)}addInt64(e){_(0)}addInt32(e){this.addValue_(e)}addBool(e){this.addValue_(e)}addNull(){this.addValue_(null)}getObject(){return this.m_acceptedObject}},W=class e{constructor(e){this.m_buffer=null,this.m_view=null,this.m_sz=0,this.m_offset=0,this.m_bOwnsBuffer=!0,this.m_bLittleEndian=!0,this.m_element=new ArrayBuffer(8),this.m_elementBytes=new Uint8Array(this.m_element),this.m_elementView=new DataView(this.m_element),this.m_elementDouble=new Float64Array(this.m_element),this.m_elementFloat=new Float32Array(this.m_element),this.m_elementInt64=new BigInt64Array(this.m_element),this.m_elementInt32=new Int32Array(this.m_element),this.m_elementInt16=new Int16Array(this.m_element),e.sz===void 0?e.move?(this.m_sz=e.move.m_sz,this.m_buffer=e.move.m_buffer,this.m_view=e.move.m_view,this.m_bOwnsBuffer=e.move.m_bOwnsBuffer,this.m_bLittleEndian=e.move.m_bLittleEndian,e.move.m_buffer=null,e.move.m_view=null,e.move.m_sz=0,e.move.m_bOwnsBuffer=!0):p(`unrecognized constructor options`):(this.m_sz=e.sz,e.buffer?(this.m_sz<0&&o(`size out of range`),this.m_buffer=e.buffer,this.m_offset=e.offset===void 0?0:e.offset,this.m_view=e.offset===void 0?new DataView(this.m_buffer):new DataView(e.buffer,e.offset,e.sz),this.m_bOwnsBuffer=!1,this.m_bLittleEndian=!0):(this.m_sz<0&&o(`size out of range`),this.m_sz>0&&(this.m_buffer=new ArrayBuffer(this.m_sz),this.m_view=new DataView(this.m_buffer))))}swapBytesDouble(){this.doSwap()&&(this.m_elementDouble[0]=this.m_elementBytes[0]<<56|this.m_elementBytes[1]<<48|this.m_elementBytes[2]<<40|this.m_elementBytes[3]<<32|this.m_elementBytes[4]<<24|this.m_elementBytes[5]<<16|this.m_elementBytes[6]<<8|this.m_elementBytes[7])}swapBytesInt32(){this.doSwap()&&(this.m_elementInt32[0]=this.m_elementBytes[0]<<24|this.m_elementBytes[1]<<16|this.m_elementBytes[2]<<8|this.m_elementBytes[3])}getOffset(){return this.m_offset}assignMove(e){return this===e||(this.clear(),this.m_sz=e.m_sz,this.m_buffer=e.m_buffer,this.m_view=e.m_view,this.m_bOwnsBuffer=e.m_bOwnsBuffer,this.m_bLittleEndian=e.m_bLittleEndian,e.m_buffer=null,e.m_sz=0,e.m_bOwnsBuffer=!0),this}doSwap(){return this.m_bLittleEndian!==(e.getNativeByteOrder()===1)}setNativeByteOrder(){this.m_bLittleEndian=e.getNativeByteOrder()===1}setOrder(e){this.m_bLittleEndian=e===1}getOrder(){return this.m_bLittleEndian?1:0}getView(){return this.m_view||c(`buffer not defined`),this.m_view}static getNativeByteOrder(){return 1}clear(){this.m_buffer=null,this.m_sz=0,this.m_bOwnsBuffer=!0}size(){return this.m_sz}readDouble(e){return this.doSwap()?(this.m_elementDouble[0]=this.m_view.getFloat64(e,this.m_bLittleEndian),this.swapBytesDouble(),this.m_elementDouble[0]):this.m_view.getFloat64(e,this.m_bLittleEndian)}writeDouble(e,t){this.m_elementDouble[0]=t,this.swapBytesDouble(),this.m_view.setFloat64(e,this.m_elementDouble[0],this.m_bLittleEndian)}readInt32(e){return this.doSwap()?(this.m_elementInt32[0]=this.m_view.getInt32(e,this.m_bLittleEndian),this.swapBytesInt32(),this.m_elementInt32[0]):this.m_view.getInt32(e,this.m_bLittleEndian)}writeInt32(e,t){this.m_elementInt32[0]=t,this.swapBytesInt32(),this.m_view.setInt32(e,this.m_elementInt32[0],this.m_bLittleEndian)}getPtr(){return this.m_buffer}setSizeNoRealloc(e){_(e>=0&&e<=this.m_sz),this.m_sz=e}};function G(e,t,n,r,i,a){let o=!1,s=!1,c=!1,u=!1,f=!1,p=!1,m=!1,h=!1,g=!1,v=!1,y=!1,b=!1,x=!1,S=!1,C=!1,w=!1,T=!1,D=!1,O=!1,k=!1,A=!1,j=!1,M=!1,N=!1,P=NaN,F=NaN,I=NaN,R=NaN,ee=0,te=NaN,V=NaN,ne=NaN,H=NaN,re=NaN,ie=NaN,ae=NaN,oe=NaN,se=0,ce=0,U=!1,W=!1,G=null,K=null,J=null,Y=null,X=null;for(;n.nextToken()!==3;){let a=n.currentString();if(n.nextToken(),a===`spatialReference`){if(i&&!o){o=!0,n.currentToken()===1?Y=le(n):n.currentToken()!==10&&d(`failed to parse spatial reference: object or null is expected`);continue}}else if(r)if(a===`hasZ`){if(!s){s=!0,U=n.currentToken()===11;continue}}else if(a===`hasM`){if(!c){c=!0,W=n.currentToken()===11;continue}}else if(a===`rings`){if(!(f||p||e!==l.enumUnknown&&e!==l.enumPolygon)){f=!0,{geometry:X,as:G,bs:K}=ue(!0,!1,t,n);continue}}else if(a===`curveRings`){if(!p&&(e===l.enumUnknown||e===l.enumPolygon)){p=!0,{geometry:X,as:G,bs:K}=ue(!0,!0,t,n);continue}}else if(a===`paths`){if(!(m||h||e!==l.enumUnknown&&e!==l.enumPolyline)){m=!0,{geometry:X,as:G,bs:K}=ue(!1,!1,t,n);continue}}else if(a===`curvePaths`){if(!h&&(e===l.enumUnknown||e===l.enumPolyline)){h=!0,{geometry:X,as:G,bs:K}=ue(!1,!0,t,n);continue}}else if(a===`points`){if(!g&&(e===l.enumUnknown||e===l.enumMultiPoint)){g=!0,{geometry:X,as:G,bs:K}=de(t,n);continue}}else if(a===`ids`){if(!u){u=!0,J=fe(t,n);continue}}else if(a===`x`){if(!v&&(e===l.enumUnknown||e===l.enumPoint)){v=!0,P=q(n);continue}}else if(a===`y`){if(!y&&(e===l.enumUnknown||e===l.enumPoint)){y=!0,F=q(n);continue}}else if(a===`z`){if(!b&&(e===l.enumUnknown||e===l.enumPoint)){b=!0,I=q(n);continue}}else if(a===`m`){if(!x&&(e===l.enumUnknown||e===l.enumPoint)){x=!0,R=q(n);continue}}else if(a===`id`){if(!S&&(e===l.enumUnknown||e===l.enumPoint)){S=!0,ee=pe(n);continue}}else if(a===`xmin`){if(!C&&(e===l.enumUnknown||e===l.enumEnvelope)){C=!0,te=q(n);continue}}else if(a===`ymin`){if(!w&&(e===l.enumUnknown||e===l.enumEnvelope)){w=!0,V=q(n);continue}}else if(a===`mmin`){if(!A&&(e===l.enumUnknown||e===l.enumEnvelope)){A=!0,ae=q(n);continue}}else if(a===`zmin`){if(!O&&(e===l.enumUnknown||e===l.enumEnvelope)){O=!0,re=q(n);continue}}else if(a===`idmin`){if(!M&&(e===l.enumUnknown||e===l.enumEnvelope)){M=!0,se=pe(n);continue}}else if(a===`xmax`){if(!T&&(e===l.enumUnknown||e===l.enumEnvelope)){T=!0,ne=q(n);continue}}else if(a===`ymax`){if(!D&&(e===l.enumUnknown||e===l.enumEnvelope)){D=!0,H=q(n);continue}}else if(a===`mmax`){if(!j&&(e===l.enumUnknown||e===l.enumEnvelope)){j=!0,oe=q(n);continue}}else if(a===`zmax`){if(!k&&(e===l.enumUnknown||e===l.enumEnvelope)){k=!0,ie=q(n);continue}}else if(a===`idmax`){if(!N&&(e===l.enumUnknown||e===l.enumEnvelope)){N=!0,ce=pe(n);continue}}else a===`materials`&&_(0);n.skipChildren()}if(f||p||m||h||g){let e=null,t=null,n=X;U&&(X.addAttribute(1),e=G,e||=L(n.getPointCount(),NaN)),W&&(X.addAttribute(2),t=U?K:G),J!=null&&X.addAttribute(3),U&&e!=null&&n.setAttributeStreamRef(1,e),W&&t!=null&&n.setAttributeStreamRef(2,t),J!=null&&me(n,J)}else if(v||y||x||b||S){z(P,F)||d(`failed to parse point: x and y must be finite or nan`),(Number.isNaN(F)||Number.isNaN(P))&&(P=NaN,F=NaN);let e=new E({x:P,y:F});b&&e.setZ(I),x&&e.setM(R),S&&e.setID(ee),X=e}else if(C||w||T||D||O||k||A||j||M||N){(Number.isNaN(V)||Number.isNaN(ne)||Number.isNaN(H))&&(te=NaN);let e=new B({xmin:te,ymin:V,xmax:ne,ymax:H});O&&k&&e.setInterval(1,0,re,ie),A&&j&&e.setInterval(2,0,ae,oe),M&&N&&e.setInterval(3,0,se,ce),X=e}return{...X?{geom:X}:{},...Y?{sr:Y}:{}}}function K(e){let t=!1;for(;e.nextToken()!==3;){let n=e.currentString();e.nextToken(),n===`uwkid`?t||(t=!0,e.currentToken()===8&&e.currentInt32Value()):e.skipChildren()}return null}function le(e){let t=!1,n=!1,r=!1,i=!1,a=!1,o=!1,s=!1,c=!1,l=!1,u=!1,d=!1,f=!1,p=!1,m=!1,h=!1,g=!1,_=!1,v=-1,b=-1,S=-1,C=-1,w=0,E=0,O=0,k=0,A=0,j=0,M=0,N=0,P=0,F=0,I=``,L=``,z=null;for(;e.nextToken()!==3;){let y=e.currentString();e.nextToken(),y===`wkid`?t||(t=!0,e.currentToken()===8&&(v=e.currentInt32Value())):y===`latestWkid`?n||(n=!0,e.currentToken()===8&&(b=e.currentInt32Value())):y===`wkt`?a||(a=!0,e.currentToken()===6&&(I=e.currentString())):y===`wkt2`?a||e.currentToken()===6&&(L=e.currentString()):y===`vcsWkid`?r||(r=!0,e.currentToken()===8&&(S=e.currentInt32Value())):y===`latestVcsWkid`?i||(i=!0,e.currentToken()===8&&(C=e.currentInt32Value())):y===`xyTolerance`?s||(s=!0,o=!0,w=e.currentDoubleValue()):y===`zTolerance`?c||(c=!0,o=!0,E=e.currentDoubleValue()):y===`mTolerance`?l||(l=!0,o=!0,O=e.currentDoubleValue()):y===`falseX`?u||(u=!0,o=!0,M=e.currentDoubleValue()):y===`falseY`?d||(d=!0,o=!0,N=e.currentDoubleValue()):y===`falseZ`?f||(f=!0,o=!0,P=e.currentDoubleValue()):y===`falseM`?p||(p=!0,o=!0,F=e.currentDoubleValue()):y===`xyUnits`?m||(m=!0,o=!0,k=e.currentDoubleValue()):y===`zUnits`?h||(h=!0,o=!0,A=e.currentDoubleValue()):y===`mUnits`?g||(g=!0,o=!0,j=e.currentDoubleValue()):y===`unit`?_||(_=!0,z=K(e)):e.skipChildren()}C<=0&&S>0&&(C=S),S<=0&&C>0&&(S=C);let B=null,V=!0;if(I.length!==0&&(V=!1,x(I)&&(B=te(I))),B||L.length===0||(V=!1,x(L)&&(B=te(L))),!B&&b>0&&(V=!1,R(b)&&(C<=0||ee())&&(B=T(b,C))),!B&&v>0&&(V=!1,R(v)&&(S<=0||ee())&&(B=T(v,S))),V&&(B=D(z)),o&&B){let e=new y;B.queryPrecisionDescriptorWithoutFalseXY(e),s&&e.setTolerance(0,w),c&&e.setTolerance(1,E),l&&e.setTolerance(2,O),m&&u&&d&&e.setGridParams(M,N,k),h&&f&&e.setZParams(P,A),g&&p&&e.setMParams(F,j),B=ie(B,e)}return B}function ue(e,t,n,r){r.currentToken()!==2&&d(`failed to parse multipath: array of array of vertices is expected`);let i=e?new H:new V,a=i,o=F(0),s=L(2,0),c=ae(0),l=null,u=null,p=null,_=null,v=null,y=0,b=0,x=0,S=new I,w=f.getNAN(),T=0,E=0,D=e?1:0;for(;r.nextToken()!==4;){r.currentToken()!==2&&d(`failed to parse multipath: ring/path array is expected`);let n=2,i=0,O=!0,k=0,A=0,j=f.getNAN(),M=g(4,NaN),N=g(4,NaN),P=!1;for(r.nextToken();r.currentToken()!==4;){if(t&&r.currentToken()===1)O&&d(`failed to parse multipath: starting vertex array is expected`),p||(p=ae(T-1,1),_=F(T-1,-1),v=L(0)),P=!0,n=1,{segFlag:x,toPointSz:k}=ve(S,M,w,r);else{for(P=!1,r.currentToken()!==2&&d(`failed to parse multipath: array is expected, rings/paths vertices consist of arrays of coordinates`),k=0;r.nextToken()!==4;)k===4&&d(`failed to parse multipath: each vertex array has to have at most 4 elements`),M[k++]=q(r);k<2&&d(`failed to parse multipath: each vertex array has to have at least 2 elements`),C(M[0],M[1])||d(`failed to parse multipath: x and y must be finite`)}r.nextToken();do{if(s.size()===2*T&&s.resize(J(T)),s.writePoint2D(2*T,j.setCoords(M[0],M[1])),l&&l.size()===T&&l.resize(Y(T)),k>2?(l||=L(T+1,NaN),l.write(T,M[2])):l&&l.write(T,NaN),u&&u.size()===T&&u.resize(Y(T)),k>3?(u||=L(T+1,NaN),u.write(T,M[3])):u&&u.write(T,NaN),O)E++,o.add(T),c.add(D),O=!1,A=k,m(N,M,0,0,A);else if(p!==null)if(P){let e=ne(x),t=v.size();v.resize(t+e),p.add(x),_.add(y),S.get().writeInBufferStream(v,y),y+=e,a.incCurveType(x,1),b++}else p.add(1),_.add(-1);T++,i++,w.setCoords(M[0],M[1])}while(i<n&&r.currentToken()===4)}i!==0&&(e&&i>n&&k===A&&h(M,N,k)===0?(T--,i--):p!==null&&(p.add(1),_.add(-1)))}return T&&(o.resize(E),c.resize(E),T>0&&(o.add(T),c.add(0)),a.setAttributeStreamRef(0,s),a.setPathFlagsStreamRef(c),a.setPathStreamRef(o),p!==null&&(a.updateCurveCounter(b),a.setSegmentData(_,v,p,y)),a.notifyModifiedFlags(65535)),{geometry:i,as:l,bs:u}}function de(e,t){t.currentToken()!==2&&d(`failed to parse multipoint: array of vertices is expected`);let n=0,r=new b,i=L(2,0),a=0,o=g(4,NaN),s=new f,c=null,l=null;for(;t.nextToken()!==4;){for(t.currentToken()!==2&&d(`failed to parse multipoint: array is expected, multipoint vertices consist of arrays of cooridinates`),a=0;t.nextToken()!==4;)a===4&&d(`failed to parse multipoint: each vertex array has to have at most 4 elements`),o[a++]=q(t);a<2&&d(`failed to parse multipoint: each vertex array has to have at least 2 elements`),C(o[0],o[1])||d(`failed to parse multipoint: x and y must be finite`),i.size()===2*n&&i.resize(J(n)),i.writePoint2D(2*n,s.setCoords(o[0],o[1])),c&&c.size()===n&&c.resize(Y(n)),a>2?(c||=L(n+1,NaN),c.write(n,o[2])):c&&c.write(n,NaN),l&&l.size()===n&&l.resize(Y(n)),a>3?(l||=L(n+1,NaN),l.write(n,o[3])):l&&l.write(n,NaN),n++}if(n){let e=r.getImpl();e.setAttributeStreamRef(0,i),e.resizeNoInit(n),e.notifyModifiedFlags(65535)}return{geometry:r,as:c,bs:l}}function fe(e,t){t.currentToken()!==2&&d(`failed to parse array of IDs: array of array of integers is expected`);let n=j(2,0),r=0,i=-1;for(;t.nextToken()!==4;){let e=r;n.size()===r&&n.resize(Y(r)),r++;let a=0;for(i===-1?i=t.currentToken()===2?1:0:i===1&&t.currentToken()!==2&&d(`failed to parse array of IDs: array of array of integers is expected`),i===0&&(n.size()===r&&n.resize(Y(r)),n.write(r,pe(t)),a++,r++);t.nextToken()!==4;)n.size()===r&&n.resize(Y(r)),n.write(r,pe(t)),a++,r++;if(n.write(e,a),i===0)break}return n.resize(r),n}function q(e){let t=e.currentToken();if(t===10||t===6&&e.currentString()===`NaN`)return NaN;{let t=e.currentDoubleValue();return Number.isNaN(t)?NaN:t}}function pe(e){return e.currentInt32Value()}function me(e,t){if(e.isEmpty())return;let n=j(2,0),r=e.getGeometryType(),i=0;r===b.type?i=1:r===V.type||r===H.type?i=e.getPathCount():p(`not implemented`),n.resize(e.getPointCount(),0);let a=0;for(let o=0;o<i;++o){let i=t.read(a);a++;let s=a+i,c=0,l=0;r===b.type?c=e.getPointCount():r===V.type||r===H.type?(c=e.getPathSize(o),l=e.getPathStart(o)):p(`not implemented`);for(let e=0,r=Math.min(i,c);e<r;++e)n.write(l,t.read(a)),a++,l++;a=s}e.getImpl().setAttributeStreamRef(3,n)}function J(e){let t=2*Math.trunc(3*(e+1)/2);return t<8?t=8:t<32&&(t=32),t}function Y(e){let t=Math.trunc(3*(e+1)/2);return t<4?t=4:t<16&&(t=16),t}function X(e,t,n,r,i){i>=r.size()&&o(`Byte_buffer out of range access`),e.m_bits=0,e.m_rotation=0,e.m_cosr=1,e.m_sinr=0,e.setStartXY(t),e.setEndXY(n);let a=f.getNAN();a.x=r.readDouble(i),a.y=r.readDouble(i+8);let s=r.readInt32(i+16);if(1&s)return e.m_semiMajorAxis=0,e.m_minorMajorRatio=1,e.m_interior.assign(a),e.m_center.setNAN(),e.m_sweepAngle=0,e.m_startAngle=0,N(e),!1;let c=!!(64&s),l=!!(128&s),u=!!(32&s),d=!!(8&s),p=!!(16&s),m=t.equals(n);return c&&!m&&(c=!1,u=!0),u&&m&&(c=!0,u=!1,a.setCoords(0,0)),c||(l?u?(e.m_semiMajorAxis=1,e.m_minorMajorRatio=0,e.m_interior.assign(a),e.m_center.setNAN(),e.m_sweepAngle=0,e.m_startAngle=0):(e.constructCircularArcThreePoint(t,n,a),m&&d===e.isClockwise()&&e.reverse()):u?(e.m_semiMajorAxis=1,e.m_minorMajorRatio=0,e.m_center.setNAN(),e.m_sweepAngle=0,e.m_startAngle=0,N(e),e.queryCoord2D(.5,e.m_interior)):M(e,t,n,a,d,p)),c&&(e.m_center.assign(t),e.m_startAngle=a.x,e.m_sweepAngle=a.y,P(e,NaN,d,p),e.m_semiMajorAxis=0,e.m_minorMajorRatio=1,e.m_interior.setCoordsPoint2D(t)),e.setProjectionBehavior(0),N(e),!0}function he(e,t,n,r,i){e.m_bits=0,e.m_center.x=r.readDouble(i),e.m_center.y=r.readDouble(i+8),e.m_rotation=r.readDouble(i+16),e.m_semiMajorAxis=r.readDouble(i+24),e.m_minorMajorRatio=r.readDouble(i+32),e.m_XStart=t.x,e.m_YStart=t.y,e.m_XEnd=n.x,e.m_YEnd=n.y;let a=r.readInt32(i+40);if(1&a)return!1;let o=!!(64&a),s=!!(128&a),c=!!(2048&a),l=!!(4096&a);return!(512&a)&&!(1024&a)||s||(o=!0),s&&!t.equals(n)?(s=!1,o=!0):o&&t.equals(n)&&(s=!0,o=!1),s?(e.m_center.assign(t),e.m_startAngle=e.m_center.x,e.m_sweepAngle=e.m_center.y,P(e,NaN,c,l),e.m_semiMajorAxis=0,e.m_interior.setCoordsPoint2D(t)):o?(e.m_center.setNAN(),e.m_semiMajorAxis=1,e.m_minorMajorRatio=0,e.m_center.setNAN(),e.m_sweepAngle=0,e.m_startAngle=0,N(e),e.queryCoord2D(.5,e.m_interior)):e.constructEllipticArcEndPointsCenter(t,n,e.m_semiMajorAxis,e.m_minorMajorRatio,e.m_rotation,!l,c,e.m_center),e.setProjectionBehavior(1),N(e),!0}function ge(e,t,n,r,i){return _(i+32<=r.size()),e.m_cp=a(f,2),e.m_cp[0].x=r.readDouble(i),e.m_cp[0].y=r.readDouble(i+8),e.m_cp[1].x=r.readDouble(i+16),e.m_cp[1].y=r.readDouble(i+24),e.m_XStart=t.x,e.m_YStart=t.y,e.m_XEnd=n.x,e.m_YEnd=n.y,!0}function _e(e,t,n,r,i){return e.m_cp.x=r.readDouble(i),e.m_cp.y=r.readDouble(i+8),e.m_weights[0]=r.readDouble(i+16),e.m_weights[1]=r.readDouble(i+24),e.m_weights[2]=r.readDouble(i+32),e.m_XStart=t.x,e.m_YStart=t.y,e.m_XEnd=n.x,e.m_YEnd=n.y,!0}function ve(e,t,n,r,i){let a={segFlag:0,toPointSz:0},o=r.currentToken();o=r.nextToken();let s=r.currentString(),c=s[0];for((s.length!==1||c!==`a`&&c!==`b`&&c!==`c`&&c!==`n`&&c!==`q`)&&d(`failed to parse curve: expecting "a", "b", "n", "q", or "c"`),o=r.nextToken(),o!==2&&d(`failed to parse curve: start array is expected for curve parameters`),o=r.nextToken(),o!==2&&d(`failed to parse curve: start array is expected for to point`),a.toPointSz=0;r.nextToken()!==4;)a.toPointSz===4&&d(`failed to parse curve: vertex array cannot have more than 4 elements`),t[a.toPointSz++]=q(r);a.toPointSz<2&&d(`failed to parse curve: vertex array must have at least 2 elements`);let l=f.construct(t[0],t[1]),u=f.getNAN(),p=-1,m=-1,h=!1,g=NaN,_=NaN,v=NaN,y=[f.getNAN(),f.getNAN(),f.getNAN()],b=f.getNAN();if(c===`a`){o=r.nextToken(),o!==2&&d(`failed to parse curve: start array is expected for center point`),o=r.nextToken();let e=q(r);o=r.nextToken();let t=q(r);o=r.nextToken(),o!==4&&d(`failed to parse curve: end array is expected for center point`),u.setCoords(e,t),o=r.nextToken(),p=r.currentInt32Value(),o=r.nextToken(),m=r.currentInt32Value(),o=r.nextToken(),o===4?h=!0:(h=!1,g=q(r),o=r.nextToken(),_=q(r),o=r.nextToken(),v=q(r),o=r.nextToken(),o!==4&&d(`failed to parse curve: end array is expected for curve parameters`)),a.segFlag=4}else if(c===`b`){for(let e=0;e<2;e++){o=r.nextToken(),o!==2&&d(`failed to parse curve: start array is expected for control point`),o=r.nextToken();let t=q(r);o=r.nextToken();let n=q(r);o=r.nextToken(),o!==4&&d(`failed to parse curve: end array is expected for control point`),y[e].setCoords(t,n)}o=r.nextToken(),o!==4&&d(`failed to parse curve: end array is expected for curve parameters`),a.segFlag=2}else if(c===`n`){{o=r.nextToken(),o!==2&&d(`failed to parse curve: start array is expected for control point`),o=r.nextToken();let e=q(r);o=r.nextToken();let t=q(r);o=r.nextToken(),o!==4&&d(`failed to parse curve: end array is expected for control point`),y[0].setCoords(e,t)}o=r.nextToken();let e=q(r);o=r.nextToken();let t=q(r);o=r.nextToken();let n=q(r);y[1].setCoords(e,t),y[2].setCoords(n,n),o=r.nextToken(),o!==4&&d(`failed to parse curve: end array is expected for curve parameters`),a.segFlag=8}else if(c===`q`){for(let e=0;e<1;e++){o=r.nextToken(),o!==2&&d(`failed to parse curve: start array is expected for control point`),o=r.nextToken();let t=q(r);o=r.nextToken();let n=q(r);o=r.nextToken(),o!==4&&d(`failed to parse curve: end array is expected for control point`),y[e].setCoords(t,n)}o=r.nextToken(),o!==4&&d(`failed to parse curve: end array is expected for curve parameters`),a.segFlag=16}else{o=r.nextToken(),o!==2&&d(`failed to parse curve: start array is expected for interior point`),o=r.nextToken();let e=q(r);o=r.nextToken();let t=q(r);o=r.nextToken(),o!==4&&d(`failed to parse curve: end array is expected for interior point`),b.setCoords(e,t),o=r.nextToken(),o!==4&&d(`failed to parse curve: end array is expected for curve parameters`),a.segFlag=4}return o=r.nextToken(),o!==3&&d(`failed to parse curve: end object is expected for curve`),c===`a`?(e.createEllipticArc(),h?ye(e.get(),n,l,u,!0,p,m):be(e.get(),n,l,u,p,m,g,_,v)):c===`b`?(e.createCubicBezier(),xe(e.get(),n,l,y)):c===`n`?(e.createQuadraticRationalBezier(),Se(e.get(),n,l,y[0],y[1].x,y[1].y,y[2].x)):c===`q`?(e.createQuadraticBezier(),e.get().construct(n,y[0],l)):(e.createEllipticArc(),ye(e.get(),n,l,b,!1,-1,-1)),a}function ye(e,t,n,r,i,a,o){e.dropAllAttributes();let s=new W({sz:20,buffer:new ArrayBuffer(20)}),c=0;s.writeDouble(c,r.x),c+=8,s.writeDouble(c,r.y),c+=8;let l=0;i?(o||(l|=8),a&&(l|=16)):l|=128,s.writeInt32(c,l),c+=4,X(e,t,n,s,0)}function be(e,t,n,r,i,a,o,s,c){e.dropAllAttributes();let l=new W({sz:44,buffer:new ArrayBuffer(44)}),u=0;l.writeDouble(u,r.x),u+=8,l.writeDouble(u,r.y),u+=8,l.writeDouble(u,o),u+=8,l.writeDouble(u,s),u+=8,l.writeDouble(u,c),u+=8;let d=0;a||(d|=2048),i&&(d|=4096),l.writeInt32(u,d),u+=4,he(e,t,n,l,0)}function xe(e,t,n,r){e.dropAllAttributes();let i=new W({sz:32,buffer:new ArrayBuffer(32)}),a=0;i.writeDouble(a,r[0].x),a+=8,i.writeDouble(a,r[0].y),a+=8,i.writeDouble(a,r[1].x),a+=8,i.writeDouble(a,r[1].y),a+=8,ge(e,t,n,i,0)}function Se(e,t,n,r,i,a,o){e.dropAllAttributes();let s=new W({sz:40,buffer:new ArrayBuffer(40)}),c=0;s.writeDouble(c,r.x),c+=8,s.writeDouble(c,r.y),c+=8,s.writeDouble(c,i),c+=8,s.writeDouble(c,a),c+=8,s.writeDouble(c,o),c+=8,_e(e,t,n,s,0)}function Ce(e,t,n,r,i){let a=e.getGeometryType();if(a===l.enumEllipticArc)return we(e,t,n,r,i);if(a===l.enumBezier)return Te(e,t,n,r,i);if(a===l.enumRationalBezier2)return Ee(e,t,n,r,i);if(a===l.enumBezier2){let a=new re;return a.constructFromQuadraticSegment(e),Te(a,t,n,r,i)}v(``)}function we(e,t,n,r,i){_(!k(e));let a=e.getEndXY(),o=e.hasAttribute(1)&&!t,s=e.hasAttribute(2)&&!n,c=NaN,l=NaN;if(o&&(c=e.getEndAttributeAsDbl(1,0)),s&&(l=e.getEndAttributeAsDbl(2,0)),e.isDegenerateToLine()||e.isDegenerate(0))return Z(o,s,a.x,a.y,c,l,r,i),!0;let u=e.projectionBehavior()===0,d=!!u&&e.isClosed();if(u&&!d)i.startObject(),i.addFieldName(`c`),i.startArray(),Z(o,s,a.x,a.y,c,l,r,i),Q(e.m_interior.x,e.m_interior.y,17,i),i.endArray(),i.endObject();else if(u){i.startObject(),i.addFieldName(`a`),i.startArray(),Z(o,s,a.x,a.y,c,l,r,i),Q(e.m_center.x+0,e.m_center.y+0,17,i);let t=!e.isMajor();i.addInt32(t?1:0);let n=e.isClockwise();i.addInt32(n?1:0),i.endArray(),i.endObject()}else{i.startObject(),i.addFieldName(`a`),i.startArray(),Z(o,s,a.x,a.y,c,l,r,i);let t=e;Q(t.m_center.x,t.m_center.y,17,i);let n=!t.isMajor();i.addInt32(n?1:0);let u=t.isClockwise();i.addInt32(u?1:0),i.addDouble(t.m_rotation,17),i.addDouble(t.m_semiMajorAxis,17),i.addDouble(t.m_minorMajorRatio,17),i.endArray(),i.endObject()}return!1}function Te(e,t,n,r,i){let a=e.getEndXY(),o=e.hasAttribute(1)&&!t,s=e.hasAttribute(2)&&!n,c=NaN,l=NaN;return o&&(c=e.getEndAttributeAsDbl(1,0)),s&&(l=e.getEndAttributeAsDbl(2,0)),i.startObject(),i.addFieldName(`b`),i.startArray(),Z(o,s,a.x,a.y,c,l,r,i),Q(e.m_cp[0].x,e.m_cp[0].y,r,i),Q(e.m_cp[1].x,e.m_cp[1].y,r,i),i.endArray(),i.endObject(),!1}function Ee(e,t,n,r,i){let a=e.getEndXY(),o=e.hasAttribute(1)&&!t,s=e.hasAttribute(2)&&!n,c=NaN,l=NaN;o&&(c=e.getEndAttributeAsDbl(1,0)),s&&(l=e.getEndAttributeAsDbl(2,0)),i.startObject(),i.addFieldName(`n`),i.startArray(),Z(o,s,a.x,a.y,c,l,r,i),Q(e.m_cp.x,e.m_cp.y,r,i);let u=r;return i.addDouble(e.m_weights[0],u),i.addDouble(e.m_weights[1],u),i.addDouble(e.m_weights[2],u),i.endArray(),i.endObject(),!1}function Z(e,t,n,r,i,a,o,s){s.startArray(),s.addDouble(n,o),s.addDouble(r,o),e&&s.addDouble(i,o),t&&s.addDouble(a,o),s.endArray()}function Q(e,t,n,r){r.startArray(),r.addDouble(e,n),r.addDouble(t,n),r.endArray()}var De=class{getOperatorType(){return 10405}accelerateGeometry(e,t,n){return!1}canAccelerateGeometry(e){return!1}supportsCurves(){return!0}execute(e,t,n,r,i,a){Oe(e,t,n,r)}exportSpatialReference(e,t,n,r){_(0)}exportProjectionTransformation(e,t,n,r){_(0)}exportDatumTransformation(e,t,n,r){_(0)}static geometryTypeToString(e){return _(0),``}};function Oe(e,t,n,r,i){if(t||n){if(r.startObject(),t!==null)switch(t.getGeometryType()){case l.enumPolygon:ke(!0,e,t,r);break;case l.enumPolyline:ke(!1,e,t,r);break;case l.enumMultiPoint:Ae(e,t,r);break;case l.enumPoint:je(e,t,r);break;case l.enumEnvelope:Me(e,t,r);break;case l.enumMultipatch:_(0);break;default:p(`exportToJSON`)}n!==null&&(r.addFieldName(`spatialReference`),Pe(e,n,r)),r.endObject()}}function ke(e,t,n,r){let i=n.getImpl(),a=!!(2&t),o=!!(4&t),s=!!(8&t),c=i.hasAttribute(1)&&!a,l=i.hasAttribute(2)&&!o,u=i.hasAttribute(3)&&!s,d=i.hasNonLinearSegments();c&&(r.addFieldName(`hasZ`),r.addBool(!0)),l&&(r.addFieldName(`hasM`),r.addBool(!0)),e?d?r.addFieldName(`curveRings`):r.addFieldName(`rings`):d?r.addFieldName(`curvePaths`):r.addFieldName(`paths`);let f=null,p=[];if(n.isEmpty())r.startArray(),r.endArray();else{let e=17-(31&t>>13);r.startArray();let s=n.getPathCount(),m=0,h=i.getAttributeStreamRef(0),g=null,_=null,y=null,b=new I,x=null,S=null,C=null;d&&(x=i.getSegmentFlagsStreamRef(),S=i.getSegmentIndexStreamRef(),C=i.getSegmentDataStreamRef()),c&&(g=i.getAttributeStreamRef(1)),l&&(_=i.getAttributeStreamRef(2)),u&&(y=i.getAttributeStreamRef(3),f=w(3,0));for(let t=0;t<s;t++){r.startArray(),u&&p.push(0);let i=n.getPathEnd(t);if(m===i){r.endArray();continue}let s=n.isClosedPath(t),d=h.read(2*m),w=h.read(2*m+1),T=c?g.read(m):NaN,E=l?_.read(m):NaN,D=u?y.read(m):0;Fe(c,l,d,w,T,E,e,r);let O=1;u&&(f.add(D),p[p.length-1]++);let k=d,A=w,j=T,M=E,N=D,P=!1,F=0,I=NaN,L=NaN,R=0;for(let t=m+1,n=m,z=s?i+1:i;t<z;t++,n++){let s=x===null?1:31&x.read(n),m,z;if(t<i?(m=h.read(2*t),z=h.read(2*t+1),c&&(I=g.read(t)),l&&(L=_.read(t)),u&&(R=y.read(t))):(m=k,z=A,I=j,L=M,R=N),s!==1){P=!0,s===4?b.createEllipticArc():s===2?b.createCubicBezier():s===16?b.createQuadraticBezier():s===8?b.createQuadraticRationalBezier():v(`JSON export.unsupported curve`);let t=b.get(),i=S.read(n);t.setStartXYCoords(d,w),t.setEndXYCoords(m,z),c&&(t.setStartAttribute(1,0,T),t.setEndAttribute(1,0,I)),l&&(t.setStartAttribute(2,0,E),t.setEndAttribute(2,0,L)),t.readFromBufferStream(C,i),Ce(b.get(),a,o,e,r)&&F++}else Fe(c,l,m,z,I,L,e,r);u&&(f.add(R),p[p.length-1]++),O++,d=m,w=z,T=I,E=L,D=R}P&&F===0||(O<2&&F<1&&(Fe(c,l,d,w,T,E,e,r),O++,u&&(f.add(D),p[p.length-1]++)),s&&O<3&&F<2&&(Fe(c,l,k,A,j,M,e,r),O++,d=k,w=A,T=j,E=M,D=N,u&&(f.add(N),p[p.length-1]++))),r.endArray(),m=i}r.endArray()}if(u){r.addFieldName(`ids`),r.startArray();let e=0;for(let t=0,n=p.length;t<n;++t){let n=p[t];_(n===0||f!==null&&e+n<=f.size()),r.startArray();for(let t=0;t<n;++t)r.addInt32(f.read(e)),e++;r.endArray()}r.endArray()}}function Ae(e,t,n){let r=t.getImpl(),i=r.hasAttribute(1)&&!(2&e),a=r.hasAttribute(2)&&!(4&e),o=r.hasAttribute(3)&&!(8&e);i&&(n.addFieldName(`hasZ`),n.addBool(!0)),a&&(n.addFieldName(`hasM`),n.addBool(!0)),n.addFieldName(`points`);let s=t.getPointCount();if(t.isEmpty())n.startArray(),n.endArray();else{let t=17-(31&e>>13);n.startArray();let o=r.getAttributeStreamRef(0),c=null,l=null;i&&(c=r.getAttributeStreamRef(1)),a&&(l=r.getAttributeStreamRef(2));for(let e=0;e<s;e++){let r=o.read(2*e),s=o.read(2*e+1),u=NaN,d=NaN;i&&(u=c.read(e)),a&&(d=l.read(e)),Fe(i,a,r,s,u,d,t,n)}n.endArray()}if(o){let e=null;r.isEmpty()||(e=r.getAttributeStreamRef(3)),_(s===0||e!==null&&e.size()>=s),n.addFieldName(`ids`),n.startArray();for(let t=0;t<s;t++)n.addInt32(e.read(t));n.endArray()}}function je(e,t,n){let r=t.hasAttribute(1)&&!(2&e),i=t.hasAttribute(2)&&!(4&e),a=t.hasAttribute(3)&&!(8&e);if(t.isEmpty())return n.addFieldName(`x`),n.addNull(),n.addFieldName(`y`),n.addNull(),r&&(n.addFieldName(`z`),n.addNull()),i&&(n.addFieldName(`m`),n.addNull()),void(a&&(n.addFieldName(`id`),n.addInt32(0)));let o=17-(31&e>>13);n.addFieldName(`x`),n.addDouble(t.getX(),o),n.addFieldName(`y`),n.addDouble(t.getY(),o),r&&(n.addFieldName(`z`),n.addDouble(t.getZ(),o)),i&&(n.addFieldName(`m`),n.addDouble(t.getM(),o)),a&&(n.addFieldName(`id`),n.addInt32(t.getID()))}function Me(e,t,n){let r=t.hasAttribute(1)&&!(2&e),i=t.hasAttribute(2)&&!(4&e),a=t.hasAttribute(3)&&!(8&e);if(t.isEmpty())return n.addFieldName(`xmin`),n.addNull(),n.addFieldName(`ymin`),n.addNull(),n.addFieldName(`xmax`),n.addNull(),n.addFieldName(`ymax`),n.addNull(),r&&(n.addFieldName(`zmin`),n.addNull(),n.addFieldName(`zmax`),n.addNull()),i&&(n.addFieldName(`mmin`),n.addNull(),n.addFieldName(`mmax`),n.addNull()),void(a&&(n.addFieldName(`idmin`),n.addInt32(0),n.addFieldName(`idmax`),n.addInt32(0)));let o=17-(31&e>>13);if(n.addFieldName(`xmin`),n.addDouble(t.getXMin(),o),n.addFieldName(`ymin`),n.addDouble(t.getYMin(),o),n.addFieldName(`xmax`),n.addDouble(t.getXMax(),o),n.addFieldName(`ymax`),n.addDouble(t.getYMax(),o),r){let e=t.queryInterval(1,0);n.addFieldName(`zmin`),n.addDouble(e.vmin,o),n.addFieldName(`zmax`),n.addDouble(e.vmax,o)}if(i){let e=t.queryInterval(2,0);n.addFieldName(`mmin`),n.addDouble(e.vmin,o),n.addFieldName(`mmax`),n.addDouble(e.vmax,o)}if(a){let e=t.queryInterval(3,0);n.addFieldName(`idmin`),n.addInt32(e.vmin),n.addFieldName(`idmax`),n.addInt32(e.vmax)}}function Ne(e,t,n){n.startObject();let r=t.getID();r<=0&&d(`cannot export unit that has no valid WKID`),n.addFieldName(`uwkid`),n.addInt32(r),n.endObject()}function Pe(e,t,n){n.startObject();let r=0;t.isCustomWkid()||(r=t.getOldID());let i=0,a=t.getVCS();if(a!==null&&(a.isCustomWkid()||(i=a.getOldID()),i<=0&&(r=0)),r>0){n.addFieldName(`wkid`),n.addInt32(r);let e=t.getLatestID();if(e>0&&e!==r&&(n.addFieldName(`latestWkid`),n.addInt32(e)),i>0){n.addFieldName(`vcsWkid`),n.addInt32(i);let e=t.getLatestVerticalID();e!==i&&(n.addFieldName(`latestVcsWkid`),n.addInt32(e))}}if(t.getCoordinateSystemType()===0)n.addFieldName(`wkid`),n.addNull(),t.getUnit()!==null&&(n.addFieldName(`unit`),Ne(e,t.getUnit(),n));else if(r<=0||1&e){let r=``;64&e&&(r=t.getText2(),n.addFieldName(`wkt2`),n.addString(r));let i=t.getText();i!==r&&(n.addFieldName(`wkt`),n.addString(i))}if(16&e){let e=new y;t.queryPrecisionDescriptor(e),n.addFieldName(`xyTolerance`),n.addDouble(e.getTolerance(0)),n.addFieldName(`zTolerance`),n.addDouble(e.getTolerance(1)),n.addFieldName(`mTolerance`),n.addDouble(e.getTolerance(2)),n.addFieldName(`falseX`),n.addDouble(e.getFalseX()),n.addFieldName(`falseY`),n.addDouble(e.getFalseY()),n.addFieldName(`xyUnits`),n.addDouble(e.getGridUnitsXY()),n.addFieldName(`falseZ`),n.addDouble(e.getFalseZ()),n.addFieldName(`zUnits`),n.addDouble(e.getGridUnitsZ()),n.addFieldName(`falseM`),n.addDouble(e.getFalseM()),n.addFieldName(`mUnits`),n.addDouble(e.getGridUnitsM())}n.endObject()}function Fe(e,t,n,r,i,a,o,s){s.startArray(),s.addDouble(n,o),s.addDouble(r,o),e&&s.addDouble(i,o),t&&s.addDouble(a,o),s.endArray()}var $={s_a:97,s_A:65,s_asterisk:42,s_b:98,s_backslash:92,s_beginArray:91,s_beginObject:123,s_colon:58,s_period:46,s_comma:44,s_doubleQuote:34,s_endArray:93,s_endObject:125,s_e:101,s_E:69,s_f:102,s_F:70,s_forwardslash:47,s_minus:45,s_plus:43,s_n:110,s_N:78,s_r:114,s_t:116,s_u:117,s_zero:48,s_nine:57},Ie=class{constructor(e){this.m_functionStack=[],this.m_pushPositions=[],this.m_utf8Decoder=new TextDecoder(`utf-8`,{fatal:!0}),e===void 0?(this.m_startToken=2**53-1,this.m_endToken=0,this.m_currentTokenType=0,this.m_functionStack.push(()=>this.accept_()),this.m_jsonString=null,this.m_bHasEscapes=!1):e.jsonString?this.resetParserFromString(e.jsonString):e.jsonStream?v(`streaming json parsing not yet impl`):p(`invalid constructor parameter`)}prepSubstrString_(){}getCurrentSubstrString_(){return this.m_jsonString.slice(this.m_startToken,this.m_endToken)}stepOverCharString_(){this.m_endToken++}peekCharString_(){return this.m_jsonString.charCodeAt(this.m_endToken)}getString_(e){let t=this.m_jsonString?.slice(this.m_startToken,this.m_startToken+e-1);return this.m_endToken+=e-1,{s:t,bDone:this.m_endToken>=this.m_jsonString.length}}incrementString_(){this.m_endToken++}eofString_(){return this.m_endToken>=this.m_jsonString.length}setStringFunctions_(){this.m_prepSubstr=this.prepSubstrString_,this.m_getCurrentSubstr=this.getCurrentSubstrString_,this.m_stepOverChar=this.stepOverCharString_,this.m_peekChar=this.peekCharString_,this.m_get=this.getString_,this.m_increment=this.incrementString_,this.m_eof=this.eofString_}setStreamFunctions_(){v(`streaming json parsing not yet impl`)}reset_(){this.m_jsonString=null,this.m_endToken=0,this.m_startToken=2**53-1,this.m_currentTokenType=0,this.m_bHasEscapes=!1,this.m_functionStack.length=0,this.m_functionStack.push(()=>this.start_()),this.m_pushPositions.length=0}resetParserFromString(e){this.reset_(),this.setStringFunctions_(),this.m_jsonString=e}resetParserFromStream(e){v(`streaming json parsing not yet impl`)}resetToPosition(e){return!!this.m_jsonString&&(this.m_endToken=e,this.m_startToken=Number.MAX_VALUE,this.m_currentTokenType=0,this.m_functionStack.length=0,e>=this.m_jsonString.length?(this.m_functionStack.push(()=>this.accept_()),!1):(this.m_functionStack.push(()=>this.start_()),!0))}nextToken(){return this.m_functionStack.at(-1)(),this.m_currentTokenType}currentToken(){return this.m_currentTokenType}currentTokenStartIndex(){return this.m_startToken}currentTokenEndIndex(){return this.m_endToken}currentText(){return _(0),``}childrenAsString(){return _(0),``}skipChildren(){this.skipChildren_()}skipChildren_(){if(this.m_currentTokenType===1){let e=1;do this.m_currentTokenType=this.nextToken(),this.m_currentTokenType===1?e++:this.m_currentTokenType===3&&e--;while(this.m_currentTokenType!==3||e!==0);return}if(this.m_currentTokenType===2){let e=1;do this.m_currentTokenType=this.nextToken(),this.m_currentTokenType===2?e++:this.m_currentTokenType===4&&e--;while(this.m_currentTokenType!==4||e!==0);return}}currentTerminalAsString_(){switch(this.m_currentTokenType){case 7:case 8:case 9:return this.m_getCurrentSubstr().slice(0,this.m_endToken-this.m_startToken);case 10:return`null`;case 11:return`true`;case 12:return`false`}d(`invalid token`)}toUTF8_(e,t){let n=0,r=e;for(;t.charCodeAt(r)===$.s_backslash&&t.charCodeAt(r+1)===$.s_u;)n++,r+=6;r=e;let i=new Uint8Array(n),a=0;for(;t.charCodeAt(r)===$.s_backslash&&t.charCodeAt(r+1)===$.s_u;)i[a++]=Number.parseInt(t.slice(r+2,r+6),16),r+=6;return{u8s:this.m_utf8Decoder.decode(i),end:r}}unquoteCurrentString_(){let e=``,t=1,n=this.m_endToken-this.m_startToken-1,r=0,i=this.m_getCurrentSubstr();for(let a=t;a<n;a++)if(i.charCodeAt(a)!==$.s_backslash)r++;else{switch(r>0&&(e+=i.slice(t,t+r)),i.charCodeAt(++a)){case $.s_doubleQuote:e+=`"`;break;case $.s_u:{let{u8s:t,end:n}=this.toUTF8_(a-1,i);a=n-1,e+=t;break}case $.s_backslash:e+=`\\`;break;case $.s_forwardslash:e+=`/`;break;case $.s_b:e+=`\b`;break;case $.s_f:e+=`\f`;break;case $.s_n:e+=`
`;break;case $.s_r:e+=`\r`;break;case $.s_t:e+=`	`}t=a+1,r=0}return r>0&&(e+=i.slice(t,t+r)),e}currentString(){return this.m_currentTokenType!==5&&this.m_currentTokenType!==6?this.currentTerminalAsString_():this.m_bHasEscapes?this.unquoteCurrentString_():this.m_getCurrentSubstr().slice(1,this.m_endToken-this.m_startToken-2+1)}currentDoubleValue(){if(this.m_currentTokenType!==7&&this.m_currentTokenType!==8&&this.m_currentTokenType!==9&&this.m_currentTokenType!==6&&this.m_currentTokenType!==10&&d(`invalid token`),this.m_currentTokenType===10)return NaN;let e=this.m_getCurrentSubstr(),t=this.m_endToken-this.m_startToken;if(this.m_currentTokenType===6){if(this.currentString()===`NaN`)return NaN;e=e.slice(1),t-=2,t===0&&d(`invalid token`)}let n=Number.parseFloat(e);if(this.m_currentTokenType===6)Number.isNaN(n)&&d(`invalid token`);else if(Number.isNaN(n))return NaN;return n}currentInt32Value(){this.m_currentTokenType!==8&&this.m_currentTokenType!==6&&d(`invalid token`);let e=this.m_getCurrentSubstr(),t=this.m_endToken-this.m_startToken;this.m_currentTokenType===6&&(e=e.slice(1),t-=2,t===0&&d(`invalid token`));let n=parseInt(e);return Number.isNaN(n)&&d(`invalid token`),n}currentInt64Value(){return _(0),0n}currentBoolValue(){return _(0),!1}isError(){return 0}JSONString(){return _(0),``}pushPosition(){return _(0),!1}popPosition(){return _(0),!1}skipCStyleComments_(){_(0)}skipCppStyleComments_(){_(0)}skipComments_(){this.m_prepSubstr();let e=this.m_peekChar();this.m_stepOverChar(),this.m_eof()&&d(`invalid token`),e=this.m_peekChar(),e===$.s_asterisk?this.skipCStyleComments_():e===$.s_forwardslash?this.skipCppStyleComments_():d(`invalid token`)}skipWhiteSpace_(){let e;do{this.m_eof()&&d(`invalid token`);let t=this.m_peekChar();for(;t>=9&&t<=13||t===32;)this.m_increment(),this.m_eof()&&d(`invalid token`),t=this.m_peekChar();t===$.s_forwardslash?(this.m_startToken=this.m_endToken,e=!0,this.skipComments_()):e=!1}while(e)}rightBracket_(){return this.m_peekChar()===$.s_endArray&&(this.m_startToken=this.m_endToken,this.m_increment(),this.m_currentTokenType=4,!0)}rightBrace_(){return this.m_peekChar()===$.s_endObject&&(this.m_startToken=this.m_endToken,this.m_increment(),this.m_currentTokenType=3,!0)}string_(){this.m_prepSubstr(),this.m_bHasEscapes=!1,this.m_stepOverChar(),this.m_eof()&&d(`invalid token`);let e=this.m_peekChar();for(;e!==$.s_doubleQuote;){let t=e===$.s_backslash;if(this.m_stepOverChar(),this.m_eof()&&d(`invalid token`),e=this.m_peekChar(),t)if(this.m_bHasEscapes=!0,e===$.s_doubleQuote||e===$.s_backslash||e===$.s_forwardslash||e===$.s_b||e===$.s_f||e===$.s_n||e===$.s_r||e===$.s_t)this.m_stepOverChar(),this.m_eof()&&d(`invalid token`),e=this.m_peekChar();else if(e===$.s_u)for(let t=0;t<4;t++)this.m_stepOverChar(),this.m_eof()&&d(`invalid token`),e=this.m_peekChar(),e>=$.s_zero&&e<=$.s_nine||e>=$.s_a&&e<=$.s_f||e>=$.s_A&&e<=$.s_F||d(`invalid token`);else d(`invalid token`)}this.m_stepOverChar()}comma_(){return this.m_peekChar()===$.s_comma&&(this.m_increment(),!0)}colon_(){return this.m_peekChar()===$.s_colon&&(this.m_increment(),!0)}fieldNameEnd_(){this.skipWhiteSpace_(),this.m_functionStack.pop(),this.colon_()?(this.skipWhiteSpace_(),this.value_()):d(`invalid token`)}fieldNameStart_(){this.m_startToken=this.m_endToken,this.m_peekChar()!==$.s_doubleQuote&&d(`invalid token`),this.string_(),this.m_currentTokenType=5,this.m_functionStack.push(()=>this.fieldNameEnd_())}pairEnd_(){this.skipWhiteSpace_(),this.comma_()?(this.skipWhiteSpace_(),this.fieldNameStart_()):this.rightBrace_()?this.m_functionStack.pop():d(`invalid token`)}arrayStart_(){this.skipWhiteSpace_(),this.m_functionStack.pop(),this.rightBracket_()||(this.m_functionStack.push(()=>this.elementEnd_()),this.value_())}elementEnd_(){this.skipWhiteSpace_(),this.comma_()?(this.skipWhiteSpace_(),this.value_()):this.rightBracket_()?this.m_functionStack.pop():d(`invalid token`)}objectStart_(){this.skipWhiteSpace_(),this.m_functionStack.pop(),this.rightBrace_()||(this.m_functionStack.push(()=>this.pairEnd_()),this.fieldNameStart_())}valueStartObject_(){this.m_increment(),this.m_currentTokenType=1,this.m_functionStack.push(()=>this.objectStart_())}valueStartArray_(){this.m_increment(),this.m_currentTokenType=2,this.m_functionStack.push(()=>this.arrayStart_())}valueString_(){this.string_(),this.m_currentTokenType=6}int_(){this.m_peekChar()===$.s_zero?this.m_stepOverChar():this.digits_()}digits_(){let e=this.m_peekChar();do this.m_stepOverChar(),this.m_eof()&&d(`invalid token`),e=this.m_peekChar();while(e>=$.s_zero&&e<=$.s_nine)}frac_(){let e=this.m_peekChar();this.m_stepOverChar(),this.m_eof()&&d(`invalid token`),e=this.m_peekChar(),e>=$.s_zero&&e<=$.s_nine||d(`invalid token`),this.digits_()}exp_(){let e=this.m_peekChar();this.m_stepOverChar(),this.m_eof()&&d(`invalid token`),e=this.m_peekChar(),e!==$.s_plus&&e!==$.s_minus||(this.m_stepOverChar(),this.m_eof()&&d(`invalid token`),e=this.m_peekChar()),e>=$.s_zero&&e<=$.s_nine||d(`invalid token`),this.digits_()}valueNumber_(){this.m_prepSubstr();let e=!1,t=this.m_peekChar();if(t===$.s_minus?(this.m_stepOverChar(),this.m_eof()&&d(`invalid token`),t=this.m_peekChar(),e=!0,t>=$.s_zero&&t<=$.s_nine||d(`invalid token`),this.int_()):this.int_(),t=this.m_peekChar(),t===$.s_period)this.m_currentTokenType=7,this.frac_(),t=this.m_peekChar(),t!==$.s_e&&t!==$.s_E||this.exp_();else if(t===$.s_e||t===$.s_E)this.m_currentTokenType=7,this.exp_();else{let t=0;e&&t++;let n=this.m_endToken-this.m_startToken-t;if(n<10)this.m_currentTokenType=8;else if(n===10){let n=this.m_getCurrentSubstr();e?n.slice(t)<=`2147483648`?this.m_currentTokenType=8:this.m_currentTokenType=9:n.slice(t)<=`2147483647`?this.m_currentTokenType=8:this.m_currentTokenType=9}else if(n<19)this.m_currentTokenType=9;else if(n===19){let n=this.m_getCurrentSubstr();e?n.slice(t)<=`9223372036854775808`?this.m_currentTokenType=9:this.m_currentTokenType=7:n.slice(t)<=`9223372036854775807`?this.m_currentTokenType=9:this.m_currentTokenType=7}else this.m_currentTokenType=7}}valueNull_(){let{s:e,bDone:t}=this.m_get(5);t&&d(`invalid token`),e!==`null`&&d(`invalid token`),this.m_currentTokenType=10}valueTrue_(){let{s:e,bDone:t}=this.m_get(5);t&&d(`invalid token`),e!==`true`&&d(`invalid token`),this.m_currentTokenType=11}valueFalse_(){let{s:e,bDone:t}=this.m_get(6);t&&d(`invalid token`),e!==`false`&&d(`invalid token`),this.m_currentTokenType=12}valueNan_(){let{s:e,bDone:t}=this.m_get(4);t&&d(`invalid token`),e!==`NaN`&&d(`invalid token`),this.m_currentTokenType=7}value_(){this.m_startToken=this.m_endToken;let e=this.m_peekChar();e===$.s_beginObject?this.valueStartObject_():e===$.s_beginArray?this.valueStartArray_():e===$.s_doubleQuote?this.valueString_():e===$.s_minus||e>=$.s_zero&&e<=$.s_zero+9?this.valueNumber_():e===$.s_n?this.valueNull_():e===$.s_t?this.valueTrue_():e===$.s_f?this.valueFalse_():e===$.s_N?this.valueNan_():d(`invalid token`)}start_(){this.skipWhiteSpace_(),this.m_functionStack.pop(),this.m_functionStack.push(()=>this.accept_());let e=this.m_peekChar();e!==$.s_beginObject&&e!==$.s_beginArray&&d(`invalid token`),this.value_()}accept_(){this.m_startToken=this.m_endToken,this.m_currentTokenType=0}},Le=class{getOperatorType(){return 10404}accelerateGeometry(e,t,n){return!1}canAccelerateGeometry(e){return!1}supportsCurves(){return!0}execute(e,t,n,r,i,a,o){let s;typeof n==`string`?(s=new Ie({jsonString:n}),s.nextToken()):s=n,s.currentToken()!==1&&d(`failed to import map geometry: start of object is expected`);let c=G(t,e,s,r,i);return new A(c)}importSpatialReference(e){let t=le(e);return t===null&&p(`failed to import spatial reference`),t}importProjectionTransformation(e,t){return _(0),{}}importDatumTransformation(e,t){return _(0),{}}static stringToGeometryType(e){return(e=e.toLowerCase()).startsWith(`esrigeometry`)||d(`string_to_geometry_type`),e.endsWith(`point`)?l.enumPoint:e.endsWith(`envelope`)?l.enumEnvelope:e.endsWith(`multipoint`)?l.enumMultiPoint:e.endsWith(`polyline`)?l.enumPolyline:e.endsWith(`polygon`)?l.enumPolygon:void d(`string_to_geometry_type`)}},Re=new U,ze=new De,Be=new Le;function Ve(e){return Array.isArray(e)?e[0].spatialReference:e.spatialReference}function He(e,t){let{includeGeometry:n=!0,includeSpatialReference:r=!0}=t??{};r&&(e.spatialReference?.latestVcsWkid||e.spatialReference?.vcsWkid)&&(e={...e,spatialReference:{...e.spatialReference}},delete e.spatialReference?.latestVcsWkid,delete e.spatialReference?.vcsWkid);let i=new ce(e,{strict:!1});return i.nextToken(),Be.execute(0,l.enumUnknown,i,n,r)}function Ue(e){let t=null;return[e.map(e=>{if(t==null){let n=We(e);return t=n.getSpatialReference(),n.getGeometry()}return Ge(e)}),t]}function We(t){return t.spatialReference instanceof e&&(t={...t,spatialReference:t.spatialReference.toJSON()}),He(t)}function Ge(e){return He(e,{includeSpatialReference:!1}).getGeometry()}function Ke(t){return t instanceof e&&(t=t.toJSON()),He({x:0,y:0,spatialReference:t},{includeGeometry:!1}).getSpatialReference()}function qe(e,t){return e instanceof A&&(t=e.getSpatialReference(),e=e.getGeometry()),e?.isEmpty()?null:(Re.reset(),ze.execute(0,e,t,Re),Re.getObject())}export{qe as a,We as i,Ve as n,Ge as o,Ke as r,Ue as t};