import{AE as e,Ax as t,Bg as n,CD as r,Gu as i,Il as a,Jg as o,Jl as s,KS as c,Ku as l,Ll as u,Lx as d,MC as f,Ml as p,Ol as m,Px as h,Qx as g,SS as _,Ty as v,Ul as y,Ux as b,Vg as x,WS as S,Wl as C,_S as w,aS as T,e_ as E,ed as D,hy as O,kC as k,nD as A,sS as ee,uD as te,vS as ne,vy as re}from"./index-BqmCqmfp.js";import{n as ie}from"./distanceOperator-5uQbTYel.js";import{r as ae,t as oe}from"./simplifyOperator-CVaMEoed.js";import{t as j}from"./quatf64-CJzmL3cc.js";import{i as M,t as N}from"./quat-Bk_ZaVz9.js";import{i as P}from"./geodesicUtils-DJORTTMv.js";var F,I=F=class extends E{constructor(e){super(e),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit=`meters`}initialize(){let e=this.center,t=this.numberOfPoints;if(this.hasZ=e?.hasZ??!1,this.rings.length!==0||!e)return;let n=g(this.radius,this.radiusUnit,`meters`),r=e.spatialReference,i,a=`geographic`;if(r.isWebMercator?a=`webMercator`:((r.wkid&&c[r.wkid])!=null||(r.wkt2||r.wkt)&&ee(r.wkt2||r.wkt))&&(a=`projected`),this.geodesic){let r;switch(a){case`webMercator`:r=h(e);break;case`projected`:console.error(`Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system`);break;case`geographic`:r=e}i=this._createGeodesicCircle(r,n,t),a===`webMercator`&&(i=d(i))}else{let r;a===`webMercator`||a===`projected`?r=n/w(e.spatialReference):a===`geographic`&&(r=ne(n,`meters`,_(e.spatialReference).radius)),i=this._createPlanarCircle(e,r,t)}this.spatialReference=i.spatialReference,this.addRing(i.rings[0])}clone(){let{center:e,numberOfPoints:t,radius:n,radiusUnit:r,geodesic:i}=this;return new F({center:e?.clone(),numberOfPoints:t,radius:n,radiusUnit:r,geodesic:i})}_createGeodesicCircle(e,t,n){let r=[],i=[e.x,e.y];for(let a=0;a<360;a+=360/n){let n=this.hasZ?[0,0,e.z??0]:[0,0];P(n,i,a,t,b.WGS84),r.push(n)}return r.push(r[0]),new E({rings:[r]})}_createPlanarCircle(e,t,n){let r=[],i=2*Math.PI/n;for(let a=0;a<n;++a){let n=i*a,o=[e.x+Math.cos(-n)*t,e.y+Math.sin(-n)*t];this.hasZ&&o.push(e.z??0),r.push(o)}return r.push(r[0]),new E({spatialReference:e.spatialReference,rings:[r]})}};r([f({type:t})],I.prototype,`center`,void 0),r([f()],I.prototype,`geodesic`,void 0),r([f()],I.prototype,`numberOfPoints`,void 0),r([f()],I.prototype,`radius`,void 0),r([f()],I.prototype,`radiusUnit`,void 0),I=F=r([k(`esri.geometry.Circle`)],I);var L=I;function R(e,t,n=null){return n==null?[e,t]:[e,t,n]}function z(e,t,n=null){return n==null?{x:e,y:t}:{x:e,y:t,z:n}}var B=class{constructor(e){this.spatialReference=e}mapToLocalMultiple(e){return e.map(e=>this.mapToLocal(e)).filter(A)}get doUnnormalization(){return!1}},V=class extends B{constructor(e,t,n=null){super(t),this._defaultZ=n,this.transform=i(),this.transformInv=i(),this.transform=l(e),D(this.transformInv,this.transform)}makeMapPoint(e,t){return R(e,t,this._defaultZ)}mapToLocal(e){return z(this.transform[0]*e[0]+this.transform[2]*e[1]+this.transform[4],this.transform[1]*e[0]+this.transform[3]*e[1]+this.transform[5])}localToMap(e){return R(this.transformInv[0]*e.x+this.transformInv[2]*e.y+this.transformInv[4],this.transformInv[1]*e.x+this.transformInv[3]*e.y+this.transformInv[5],this._defaultZ)}},H=class extends B{constructor(e,t){super(e.spatialReference),this.view=e,this.defaultZ=null,this.pWS=o(),this.tangentFrameUpWS=o(),this.tangentFrameRightWS=o(),this.tangentFrameForwardWS=o(),this.localFrameRightWS=o(),this.localFrameUpWS=o(),this.worldToLocalTransform=j(),this.localToWorldTransform=j(),this.scale=1,this.scale=e.resolution,this.referenceMapPoint=t,this.defaultZ=t.hasZ?t.z:null;let n=e.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,0,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,1,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,2,this.tangentFrameForwardWS);let r=o();s(r,this.tangentFrameForwardWS,a(n,this.tangentFrameForwardWS)),C(this.localFrameRightWS,n,r),m(this.localFrameRightWS,this.localFrameRightWS),y(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),M(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),N(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return this.view.viewingMode===`global`}makeMapPoint(e,t){return R(e,t,this.defaultZ)}mapToLocal(e){let n=o();this.view.renderCoordsHelper.toRenderCoords(new t({x:e[0],y:e[1],spatialReference:this.spatialReference}),n),u(n,n,this.worldToLocalTransform);let r=this.view.renderCoordsHelper.fromRenderCoords(n,new t({spatialReference:this.view.spatialReference}));return r==null?null:z(r.x/this.scale,r.y/this.scale)}localToMap(e){let n=o();this.view.renderCoordsHelper.toRenderCoords(new t({x:e.x*this.scale,y:e.y*this.scale,spatialReference:this.spatialReference}),n),u(n,n,this.localToWorldTransform);let r=this.view.renderCoordsHelper.fromRenderCoords(n,new t({spatialReference:this.view.spatialReference}));return r==null?null:R(r.x,r.y,this.defaultZ)}};function U(e,n){if(e.type===`2d`)return new V(e.state.transform,e.spatialReference,n.length>2?n[2]:null);if(e.type===`3d`){let r=n.length>2?new t({x:n[0],y:n[1],z:n[2],spatialReference:e.spatialReference}):new t({x:n[0],y:n[1],spatialReference:e.spatialReference});return new H(e,r)}return null}function W(e,n){let r=new t({x:e[0],y:e[1],spatialReference:n});return e.length>2&&(r.z=e[2]),r}function G(e,t){return new x({points:e,spatialReference:t})}function K(e,t,r){let i=new n({paths:e,spatialReference:t});return r&&v(i),i}function q(t,n,r,i=!0){let a=e(t);a.forEach(e=>{let t=e[0],n=e[e.length-1];te(t,n)&&e.length!==1||e.push(e[0])});let o=new E({rings:a,spatialReference:n});return o.rings.forEach(e=>{re(e)||e.reverse()}),r&&v(o),i&&!oe(o)&&S(n)&&(o=ae(o)||o),o}function se(e,t,n){let r=t.mapToLocalMultiple(e),i=[],a={x:r[0].x,y:r[0].y},o={x:r[1].x,y:r[1].y},s=Math.round(o.x-a.x),c=Math.round(o.y-a.y),l=Math.max(Math.abs(s),Math.abs(c));if(n){let e={x:a.x+l,y:a.y+l},t={x:a.x-l,y:a.y-l};i.push(z(e.x,t.y),z(t.x,t.y),z(t.x,e.y),z(e.x,e.y))}else{let e={x:s>0?a.x+l:a.x-l,y:c>0?a.y+l:a.y-l};i.push(z(a.x,a.y),z(e.x,a.y),z(e.x,e.y),z(a.x,e.y))}return J(q([i.map(e=>t.localToMap(e)).filter(A)],t.spatialReference,t.doUnnormalization,!0),i,t)}function ce(e,t,n){let r=t.mapToLocalMultiple(e);if(r.length===1){let e=r[0];r=[z(e.x-48,e.y+48),z(e.x+48,e.y-48),z(e.x+48,e.y-48),z(e.x-48,e.y+48)]}let i=[],a={x:r[0].x,y:r[0].y},o={x:r[1].x,y:r[1].y};if(n){let e=Math.round(o.x-a.x),t=Math.round(o.y-a.y);i.push(z(a.x-e,a.y-t),z(o.x,a.y-t),z(o.x,o.y),z(a.x-e,o.y))}else i.push(z(a.x,a.y),z(o.x,a.y),z(o.x,o.y),z(a.x,o.y));return J(q([i.map(e=>t.localToMap(e)).filter(A)],t.spatialReference,t.doUnnormalization,!0),i,t)}function J(e,t,n){let r=Y(t[3],t[2],n),i=Y(t[1],t[2],n),a=Y(t[0],t[1],n),o=Y(t[0],t[3],n);return{geometry:e,midpoints:r!=null&&i!=null&&a!=null&&o!=null?{top:r,right:i,bottom:a,left:o}:null}}function Y(e,t,n){Z[0]=e.x,Z[1]=e.y,Z[2]=0,Q[0]=t.x,Q[1]=t.y,Q[2]=0,p(Z,Z,Q,.5),X.x=Z[0],X.y=Q[1],X.z=Q[2];let r=n.localToMap(X);return r==null?null:W(r,n.spatialReference)}var X=z(0,0,0),Z=o(),Q=o();function le(e,t,n,r){let i=t.mapToLocalMultiple(e),a=null,o=null;if(n)a=i[0],o=i[1];else{let e=i[0],t=i[1],n=Math.round(t.x-e.x),r=Math.round(t.y-e.y),s=Math.max(Math.abs(n),Math.abs(r));a=z(n>0?e.x+s/2:e.x-s/2,r>0?e.y+s/2:e.y-s/2),o=z(Math.abs(n)>Math.abs(r)?a.x-s/2:a.x,Math.abs(n)>Math.abs(r)?a.y:a.y-s/2)}let s=t.localToMap(a),c=t.localToMap(o);if(s==null||c==null)return null;t.doUnnormalization&&O([[s,c]],t.spatialReference);let l=W(s,t.spatialReference),u=W(c,t.spatialReference),d=T(t.spatialReference),f=0;if(S(t.spatialReference))f=d*ie(l,u);else{let e=a.x-o.x,t=a.y-o.y;f=d*Math.sqrt(e*e+t*t)*(r||1)}let p=new L({center:l,radius:f,radiusUnit:`meters`,spatialReference:t.spatialReference});return{geometry:q(p.rings,p.spatialReference,!1),center:l,edge:u}}function $(e,t,n){let r=t.mapToLocalMultiple(e),i=r[0],a=r[1],o=Math.round(a.x-i.x),s=Math.round(a.y-i.y),c=z(n?i.x:i.x+o/2,n?i.y:i.y+s/2),l=n?o:o/2,u=n?s:s/2,d=[],f=2*Math.PI/60;function p(e){let t=Math.cos(e),n=Math.sin(e);return z(l*t+c.x,u*n+c.y)}for(let e=0;e<60;e++)d.push(p(e*f));d.push(d[0]);let{spatialReference:m,doUnnormalization:h}=t,g=q([d.map(e=>t.localToMap(e)).filter(A)],m,h,!1),_=t.localToMap(p(Math.PI/2)),v=t.localToMap(p(0)),y=t.localToMap(p(-Math.PI/2)),b=t.localToMap(p(Math.PI));return{geometry:g,midpoints:_!=null&&v!=null&&y!=null&&b!=null?{top:W(_,m),right:W(v,m),bottom:W(y,m),left:W(b,m)}:null}}export{K as a,U as c,se as i,q as n,le as o,ce as r,$ as s,G as t};