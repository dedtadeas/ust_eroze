import{Fa as e,Fu as t,Sw as n,WT as r,XT as i}from"./index-BqmCqmfp.js";import{t as a}from"./urlUtils-CtPsFIu4.js";import{t as o}from"./pbfQueryUtils-DOeTJOP2.js";import{t as s}from"./queryUtils-GIY2oFHT.js";var c=`Layer does not support extent calculation.`;function l(e,t,n){return s(e,t,n)}async function u(t,n,r,i,a){let o=n.timeExtent?.isEmpty?{data:{features:[]}}:await _(t,n,`json`,i,void 0,a);return e(n,r,o.data),o}async function d(e,t,n,r,i){if(t.timeExtent?.isEmpty)return{data:n.createFeatureResult()};let a=await f(e,t,r,i),s=a;return s.data=o(a.data,n),s}function f(e,t,n,r){return _(e,t,`pbf`,n,void 0,r)}function p(e,t,n,r){return t.timeExtent?.isEmpty?Promise.resolve({data:{objectIds:[]}}):_(e,t,`json`,n,{returnIdsOnly:!0},r)}function m(e,t,n,r){return t.timeExtent?.isEmpty?Promise.resolve({data:{count:0}}):_(e,t,`json`,n,{returnIdsOnly:!0,returnCountOnly:!0},r)}async function h(e,t,n){if(t.timeExtent?.isEmpty)return{data:{count:0,extent:null}};let r=await _(e,t,`json`,n,{returnExtentOnly:!0,returnCountOnly:!0}),i=r.data;if(i.hasOwnProperty(`extent`))return r;if(i.features||i.hasOwnProperty(`count`))throw Error(c);return r}function g(e,t){if(!e.returnIdsOnly||!t.uniqueIdFields)return e;let n={...e,returnUniqueIdsOnly:!0};return delete n.returnIdsOnly,n}async function _(e,o,s,c={},u={},d={}){let f=typeof e==`string`?r(e):e,p=o.geometry?[o.geometry]:[],m=(await t(p,null,{signal:c.signal}))?.[0];m!=null&&((o=o.clone()).geometry=m);let h=a({...f.query,f:s,...g(u,d),...l(o,u,d)});return n(i(f.path,v(o,u)?`query3d`:`query`),{...c,responseType:s===`pbf`?`array-buffer`:`json`,query:{...h,...c.query}})}function v(e,t){return e.formatOf3DObjects!=null&&!(t.returnCountOnly||t.returnExtentOnly||t.returnIdsOnly)}export{m as a,p as i,h as n,u as o,d as r,f as t};