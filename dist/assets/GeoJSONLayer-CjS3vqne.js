const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/editingSupport-DZmD-Wdk.js","assets/editingSupport-z-WY3UuH.js","assets/index-BqmCqmfp.js","assets/index-kIqmb12G.css","assets/AttributeBinsQuery-AhqeSGKe.js","assets/queryUtils-BA7HiGeg.js","assets/FixedIntervalBinParameters-BO-nZFQ3.js","assets/AttributeBinsQuery-DyK0zHZB.js"])))=>i.map(i=>d[i]);
import{Ad as e,CD as t,Cd as n,Cw as r,Ea as i,Fm as a,G as o,Gi as s,H as c,Hi as l,J as u,Ji as d,K as f,Kw as p,L as ee,La as te,MC as m,Mb as ne,Np as h,Pa as g,Q as _,Qi as v,Qw as y,Ra as re,Sx as b,U as ie,Ux as x,WT as S,X as C,Xi as w,Yi as T,Z as E,Zi as D,Zn as O,_E as k,ao as A,bD as j,cm as M,e_ as N,ea as P,fp as F,gp as I,hC as L,hp as ae,it as R,kC as z,ka as B,lt as V,qm as H,rt as U,sa as W,sx as G,ta as K,tt as q,ut as J,vE as Y,va as oe,zr as se}from"./index-BqmCqmfp.js";import"./QueryEngineCapabilities-DPTJ40n4.js";import{i as ce}from"./clientSideDefaults-CpyaF_rm.js";var le=Symbol(`isGeoJSONGraphicOrigin`),X,ue=class extends te{get[(X=le,F)](){return this.layer}get[ae](){return this.layer}get[re](){return this.layer}constructor(e){super(),this[X]=!0,this.type=`geojson`,this.layer=e}get id(){return this.layer.id}},Z=class extends L{constructor(){super(...arguments),this.type=`geojson`,this.refresh=p(async e=>{await this.load();let{extent:t,timeExtent:n}=await this._connection.invoke(`refresh`,e);return this.sourceJSON.extent=t,n&&(this.sourceJSON.timeInfo.timeExtent=[n.start,n.end]),{dataChanged:!0,updates:{extent:this.sourceJSON.extent,timeInfo:this.sourceJSON.timeInfo}}})}load(e){let t=e==null?null:e.signal;return this.addResolvingPromise(this._startWorker(t)),Promise.resolve(this)}destroy(){this._connection?.close(),this._connection=null}applyEdits(e){return this.load().then(()=>this._applyEdits(e))}openPorts(){return this.load().then(()=>this._connection.openPorts())}queryFeatures(e,t={}){return this.load(t).then(()=>this._connection.invoke(`queryFeatures`,e?e.toJSON():null,t)).then(e=>g.fromJSON(e))}queryFeaturesJSON(e,t={}){return this.load(t).then(()=>this._connection.invoke(`queryFeatures`,e?e.toJSON():null,t))}queryFeatureCount(e,t={}){return this.load(t).then(()=>this._connection.invoke(`queryFeatureCount`,e?e.toJSON():null,t))}queryObjectIds(e,t={}){return this.load(t).then(()=>this._connection.invoke(`queryObjectIds`,e?e.toJSON():null,t))}queryExtent(e,t={}){return this.load(t).then(()=>this._connection.invoke(`queryExtent`,e?e.toJSON():null,t)).then(e=>({count:e.count,extent:b.fromJSON(e.extent)}))}querySnapping(e,t={}){return this.load(t).then(()=>this._connection.invoke(`querySnapping`,e,t))}async queryAttributeBins(e,t={}){return await this.load(),this._connection.invoke(`queryAttributeBins`,e?.toJSON(),t)}_applyEdits(e){if(!this._connection)throw new k(`geojson-layer-source:edit-failure`,`Memory source not loaded`);let t=this.layer.objectIdField,n=[],r=[],i=[];if(e.addFeatures)for(let t of e.addFeatures)n.push(this._serializeFeature(t));if(e.deleteFeatures)for(let n of e.deleteFeatures)`objectId`in n&&n.objectId!=null?r.push(n.objectId):`attributes`in n&&n.attributes[t]!=null&&r.push(n.attributes[t]);if(e.updateFeatures)for(let t of e.updateFeatures)i.push(this._serializeFeature(t));return this._connection.invoke(`applyEdits`,{adds:n,updates:i,deletes:r}).then(({extent:e,timeExtent:t,featureEditResults:n})=>(this.sourceJSON.extent=e,t&&(this.sourceJSON.timeInfo.timeExtent=[t.start,t.end]),this._createEditsResult(n)))}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){let t=!0===e.success?null:e.error||{code:void 0,description:``};return{objectId:e.objectId,globalId:e.globalId,error:t?new k(`geojson-layer-source:edit-failure`,t.description,{code:t.code}):null}}_serializeFeature(e){let{attributes:t}=e,n=this._geometryForSerialization(e);return n?{geometry:n.toJSON(),attributes:t}:{attributes:t}}_geometryForSerialization(e){let{geometry:t}=e;return t==null?null:t.type===`mesh`||t.type===`extent`?N.fromExtent(t.extent):t}async _startWorker(e){this._connection=await a(`GeoJSONSourceWorker`,{strategy:j(`feature-layers-workers`)?`dedicated`:`local`,signal:e,registryTarget:this});let{fields:t,spatialReference:n,hasZ:r,geometryType:i,objectIdField:o,url:s,timeInfo:c,customParameters:l}=this.layer,u=this.layer.originOf(`spatialReference`)===`defaults`,d={url:s,customParameters:l,fields:t&&t.map(e=>e.toJSON()),geometryType:H.toJSON(i),hasZ:r,objectIdField:o,timeInfo:c?c.toJSON():null,spatialReference:u?null:n&&n.toJSON()},f=await this._connection.invoke(`load`,d,{signal:e});for(let e of f.warnings)Y.getLogger(this.layer).warn(`#load()`,`${e.message} (title: '${this.layer.title||`no title`}', id: '${this.layer.id??`no id`}')`,{warning:e});f.featureErrors.length&&Y.getLogger(this.layer).warn(`#load()`,`Encountered ${f.featureErrors.length} validation errors while loading features. (title: '${this.layer.title||`no title`}', id: '${this.layer.id??`no id`}')`,{errors:f.featureErrors}),this.sourceJSON=f.layerDefinition,this.capabilities=ce(this.sourceJSON.hasZ,!0)}};t([m()],Z.prototype,`capabilities`,void 0),t([m()],Z.prototype,`type`,void 0),t([m({constructOnly:!0})],Z.prototype,`layer`,void 0),t([m()],Z.prototype,`sourceJSON`,void 0),Z=t([z(`esri.layers.graphics.sources.GeoJSONSource`)],Z);var Q=ie(),$=class extends q(oe(i(R(W(B(u(f(C(E(U(_(A(ne))))))))))))){constructor(e){super(e),this.attributeTableTemplate=null,this.copyright=null,this.dateFieldsTimeZone=null,this.definitionExpression=null,this.displayField=null,this.editingEnabled=!1,this.elevationInfo=null,this.fields=null,this.fieldsIndex=null,this.fullExtent=null,this.geometryType=null,this.graphicOrigin=new ue(this),this.hasZ=void 0,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.operationalLayerType=`GeoJSON`,this.outFields=null,this.popupEnabled=!0,this.popupTemplate=null,this.screenSizePerspectiveEnabled=!0,this.source=new Z({layer:this}),this.spatialReference=x.WGS84,this.templates=null,this.title=`GeoJSON`,this.type=`geojson`}destroy(){this.source?.destroy()}load(e){let t=this.loadFromPortal({supportedTypes:[`GeoJson`],supportsData:!1},e).catch(y).then(()=>this.source.load(e)).then(()=>{this.read(this.source.sourceJSON,{origin:`service`,url:this.parsedUrl}),this.revert([`objectIdField`,`fields`,`timeInfo`],`service`),M(this.renderer,this.fieldsIndex),h(this.timeInfo,this.fieldsIndex)});return this.addResolvingPromise(t),Promise.resolve(this)}set portalItem(e){super.portalItem=e}set timeInfo(e){super.timeInfo=e}get capabilities(){return this.source?this.source.capabilities:null}get createQueryVersion(){return this.commitProperty(`definitionExpression`),this.commitProperty(`timeExtent`),this.commitProperty(`timeOffset`),this.commitProperty(`geometryType`),this.commitProperty(`capabilities`),(this._get(`createQueryVersion`)||0)+1}get defaultPopupTemplate(){return this.createPopupTemplate()}get isTable(){return this.loaded&&this.geometryType==null}get parsedUrl(){return S(this.url)}set renderer(e){M(e,this.fieldsIndex),this._set(`renderer`,e)}set url(e){if(!e)return void this._set(`url`,e);let t=S(e);this._set(`url`,t.path),t.query&&(this.customParameters={...this.customParameters,...t.query})}async applyEdits(e,t){let{applyEdits:n}=await r(async()=>{let{applyEdits:e}=await import(`./editingSupport-DZmD-Wdk.js`);return{applyEdits:e}},__vite__mapDeps([0,1,2,3]));await this.load();let i=await n(this,this.source,e,t);return this.read({extent:this.source.sourceJSON.extent,timeInfo:this.source.sourceJSON.timeInfo},{origin:`service`,ignoreDefaults:!0}),i}createPopupTemplate(e){return ee(this,e)}createQuery(){let e=new n,t=this.capabilities?.data;e.returnGeometry=!0,t&&t.supportsZ&&(e.returnZ=!0),e.outFields=[`*`],e.where=this.definitionExpression||`1=1`;let{timeOffset:r,timeExtent:i}=this;return e.timeExtent=r!=null&&i!=null?i.offset(-r.value,r.unit):i||null,e}getFieldDomain(e,t){return this.getField(e)?.domain}getField(e){return this.fieldsIndex.get(e)}queryFeatures(e,t){return this.load().then(()=>this.source.queryFeatures(n.from(e)||this.createQuery(),t)).then(e=>{if(e?.features)for(let t of e.features)t.layer=t.sourceLayer=this,t.origin=this.graphicOrigin;return e})}queryObjectIds(e,t){return this.load().then(()=>this.source.queryObjectIds(n.from(e)||this.createQuery(),t))}queryFeatureCount(e,t){return this.load().then(()=>this.source.queryFeatureCount(n.from(e)||this.createQuery(),t))}queryExtent(e,t){return this.load().then(()=>this.source.queryExtent(n.from(e)||this.createQuery(),t))}async queryAttributeBins(e,t){let{source:n,capabilities:i}=await this.load();se(e,i,`GeoJSONLayer`);let a=await r(()=>import(`./AttributeBinsQuery-AhqeSGKe.js`),__vite__mapDeps([4,5,2,3,6,7])),o=await n.queryAttributeBins(a.default.from(e),t);if(o.features)for(let e of o.features)e.layer=e.sourceLayer=this;return o}async hasDataChanged(){try{let{dataChanged:e,updates:t}=await this.source.refresh(this.customParameters);return t!=null&&this.read(t,{origin:`service`,url:this.parsedUrl,ignoreDefaults:!0}),e}catch{}return!1}};t([m(l)],$.prototype,`attributeTableTemplate`,void 0),t([m({readOnly:!0,json:{read:!1,write:!1}})],$.prototype,`capabilities`,null),t([m({type:String})],$.prototype,`copyright`,void 0),t([m({readOnly:!0})],$.prototype,`createQueryVersion`,null),t([m(G(`dateFieldsTimeReference`))],$.prototype,`dateFieldsTimeZone`,void 0),t([m({readOnly:!0})],$.prototype,`defaultPopupTemplate`,null),t([m({type:String,json:{name:`layerDefinition.definitionExpression`,write:{enabled:!0,allowNull:!0}}})],$.prototype,`definitionExpression`,void 0),t([m({type:String})],$.prototype,`displayField`,void 0),t([m({type:Boolean})],$.prototype,`editingEnabled`,void 0),t([m(T)],$.prototype,`elevationInfo`,void 0),t([m({type:[e],json:{name:`layerDefinition.fields`,write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:`fields`}}}})],$.prototype,`fields`,void 0),t([m(Q.fieldsIndex)],$.prototype,`fieldsIndex`,void 0),t([m({type:b,json:{name:`extent`}})],$.prototype,`fullExtent`,void 0),t([m({type:[`point`,`polygon`,`polyline`,`multipoint`],json:{read:{reader:H.read}}})],$.prototype,`geometryType`,void 0),t([m({readOnly:!0,clonable:!1})],$.prototype,`graphicOrigin`,void 0),t([m({type:Boolean})],$.prototype,`hasZ`,void 0),t([m(v)],$.prototype,`id`,void 0),t([m({type:Boolean,readOnly:!0})],$.prototype,`isTable`,null),t([m(w)],$.prototype,`labelsVisible`,void 0),t([m({type:[O],json:{name:`layerDefinition.drawingInfo.labelingInfo`,read:{reader:c},write:!0}})],$.prototype,`labelingInfo`,void 0),t([m(s)],$.prototype,`legendEnabled`,void 0),t([m({type:[`show`,`hide`]})],$.prototype,`listMode`,void 0),t([m({type:String,json:{name:`layerDefinition.objectIdField`,write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:`objectIdField`}}}})],$.prototype,`objectIdField`,void 0),t([m(P)],$.prototype,`opacity`,void 0),t([m({type:[`GeoJSON`]})],$.prototype,`operationalLayerType`,void 0),t([m(Q.outFields)],$.prototype,`outFields`,void 0),t([m({readOnly:!0})],$.prototype,`parsedUrl`,null),t([m(d)],$.prototype,`popupEnabled`,void 0),t([m({type:I,json:{name:`popupInfo`,write:!0}})],$.prototype,`popupTemplate`,void 0),t([m({types:V,json:{name:`layerDefinition.drawingInfo.renderer`,write:!0,origins:{service:{name:`drawingInfo.renderer`},"web-scene":{types:J}}}})],$.prototype,`renderer`,null),t([m(D)],$.prototype,`screenSizePerspectiveEnabled`,void 0),t([m({readOnly:!0})],$.prototype,`source`,void 0),t([m({type:x})],$.prototype,`spatialReference`,void 0),t([m({type:[o]})],$.prototype,`templates`,void 0),t([m()],$.prototype,`title`,void 0),t([m({json:{read:!1},readOnly:!0})],$.prototype,`type`,void 0),t([m(K)],$.prototype,`url`,null),$=t([z(`esri.layers.GeoJSONLayer`)],$);var de=$;export{de as default};