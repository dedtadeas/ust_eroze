const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/GroupLayer-0co32-XG.js","assets/index-BqmCqmfp.js","assets/index-kIqmb12G.css","assets/loadUtils-BWnAUV23.js","assets/associatedFeatureServiceUtils-C1iuzbPQ.js","assets/fetchService-BUtv2ntd.js","assets/layersCreator-B-_WTkJO.js","assets/lazyLayerLoader-DjJLNY3M.js","assets/portalLayers-DW_lsX5Z.js","assets/tagSymbols-CNjeVVdC.js","assets/saveUtils-DsVVlvmj.js"])))=>i.map(i=>d[i]);
import{Aw as e,Cw as t,Mw as n,WT as r,_E as i,jb as a,lE as o,yb as s}from"./index-BqmCqmfp.js";import{t as c}from"./associatedFeatureServiceUtils-C1iuzbPQ.js";import{n as l,r as u,t as d}from"./fetchService-BUtv2ntd.js";import{t as f}from"./lazyLayerLoader-DjJLNY3M.js";var p={FeatureLayer:!0,SceneLayer:!0,VideoLayer:!0};async function m(e){let{properties:n,url:r}=e,i={...n,url:r},a=await v(r,n?.customParameters),{Constructor:o,layerId:s,sourceJSON:c,parsedUrl:l,layers:u,tables:d}=a;if(u.length+d.length===0)return s!=null&&(i.layerId=s),c!=null&&(i.sourceJSON=c),new o(i);let f=new(await(t(async()=>{let{default:e}=await import(`./GroupLayer-0co32-XG.js`);return{default:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])))).default({title:l.title});return await _(f,a,i),f}function h(e,t){return e?e.find(({id:e})=>e===t):null}function g(e,t,n,r,i){let a={...i,layerId:t};return e!=null&&(a.url=e),n!=null&&(a.sourceJSON=n),`sublayerTitleMode`in r.prototype&&(a.sublayerTitleMode=`service-name`),new r(a)}async function _(e,t,n){let r=t.sublayerConstructorProvider;for(let{id:i,serverUrl:a}of t.layers){let o=h(t.sublayerInfos,i),s=g(a,i,o,(o&&r?.(o))??t.Constructor,n);e.add(s)}if(t.tables.length){let r=await C(`FeatureLayer`);t.tables.forEach(({id:i,serverUrl:a})=>{let o=g(a,i,h(t.tableInfos,i),r,n);e.tables.add(o)})}}async function v(e,t){let r=n(e);if(r??=await y(e,t),r==null)throw new i(`arcgis-layers:url-mismatch`,"The url '${url}' is not a valid arcgis resource",{url:e});let{serverType:o,sublayer:c}=r,l,f={FeatureServer:`FeatureLayer`,KnowledgeGraphServer:`KnowledgeGraphLayer`,StreamServer:`StreamLayer`,VectorTileServer:`VectorTileLayer`,VideoServer:`VideoLayer`},m=o===`FeatureServer`,h=o===`SceneServer`,g={parsedUrl:r,Constructor:null,layerId:m||h?c??void 0:void 0,layers:[],tables:[]};switch(o){case`MapServer`:if(c!=null){let{type:n}=await u(e,{customParameters:t});switch(l=`FeatureLayer`,n){case`Catalog Layer`:l=`CatalogLayer`;break;case`Catalog Dynamic Group Layer`:throw new i(`arcgis-layers:unsupported`,`fromUrl() not supported for "${n}" layers`)}}else l=await w(e,t)?`TileLayer`:`MapImageLayer`;break;case`ImageServer`:{let{tileInfo:n,cacheType:r}=await u(e,{customParameters:t});l=n?n?.format?.toUpperCase()!==`LERC`||r&&r.toLowerCase()!==`elevation`?`ImageryTileLayer`:`ElevationLayer`:`ImageryLayer`;break}case`SceneServer`:{let e=await u(r.url.path,{customParameters:t});if(l=`SceneLayer`,e){let t=e?.layers;if(e?.layerType===`Voxel`)l=`VoxelLayer`;else if(t?.length){let e=t[0]?.layerType;e!=null&&a[e]!=null&&(l=a[e])}}break}case`3DTilesServer`:throw new i(`arcgis-layers:unsupported`,`fromUrl() not supported for 3DTiles layers`);case`FeatureServer`:if(l=`FeatureLayer`,c!=null){let n=await u(e,{customParameters:t});g.sourceJSON=n,g.preferredUrl=s(),l=d(n.type)}break;default:l=f[o]}if(p[l]&&c==null){let n=await x(e,o,t);if(m&&(g.preferredUrl=n.preferredUrl,g.sublayerInfos=n.layerInfos,g.tableInfos=n.tableInfos),n.layers.length+n.tables.length!==1)g.layers=n.layers,g.tables=n.tables,m&&n.layerInfos?.length&&(g.sublayerConstructorProvider=await T(n.layerInfos));else if(m||h){let e=n.layerInfos?.[0]??n.tableInfos?.[0];if(g.layerId=n.layers[0]?.id??n.tables[0]?.id,g.sourceJSON=e,m){let t=e?.type;l=d(t)}}}return g.Constructor=await C(l),g}async function y(t,n){let i=await u(t,{customParameters:n}),a=null,s=null,c=i.type;if(c===`Feature Layer`||c===`Table`?(a=`FeatureServer`,s=i.id??null):c===`indexedVector`?a=`VectorTileServer`:i.hasOwnProperty(`mapName`)?a=`MapServer`:i.hasOwnProperty(`bandCount`)&&i.hasOwnProperty(`pixelSizeX`)?a=`ImageServer`:i.hasOwnProperty(`maxRecordCount`)&&i.hasOwnProperty(`allowGeometryUpdates`)?a=`FeatureServer`:i.hasOwnProperty(`streamUrls`)?a=`StreamServer`:b(i)?(a=`SceneServer`,s=i.id):i.hasOwnProperty(`layers`)&&b(i.layers?.[0])&&(a=`SceneServer`),!a)return null;let l=s==null?null:e(t);return{title:l!=null&&i.name||o(t),serverType:a,sublayer:s,url:{path:l==null?r(t).path:l.serviceUrl}}}function b(e){return e!=null&&e.hasOwnProperty(`store`)&&e.hasOwnProperty(`id`)&&typeof e.id==`number`}async function x(e,t,n){let r,i,a,o=!1;switch(t){case`FeatureServer`:{let t=await l(e,{customParameters:n});a=s(e,{preferredHost:t.preferredHost}),o=!!t.layersJSON,r=t.layersJSON||t.serviceJSON;break}case`SceneServer`:{let t=await S(e,n);r=t.serviceInfo,i=t.tableServerUrl;break}default:r=await u(e,{customParameters:n})}let c=r?.layers,d=r?.tables;return{preferredUrl:a,layers:c?.map(e=>({id:e.id})).reverse()||[],tables:d?.map(e=>({serverUrl:i,id:e.id})).reverse()||[],layerInfos:o?c:[],tableInfos:o?d:[]}}async function S(e,t){let n=await u(e,{customParameters:t});if(!n.layers?.[0])return{serviceInfo:n};try{let{serverUrl:r}=await c(e),i=await u(r,{customParameters:t}).catch(()=>null);return i&&(n.tables=i.tables),{serviceInfo:n,tableServerUrl:r}}catch{return{serviceInfo:n}}}async function C(e){return(0,f[e])()}async function w(e,t){return(await u(e,{customParameters:t})).tileInfo}async function T(e){if(!e.length)return;let t=new Set,n=[];for(let{type:r}of e)t.has(r)||(t.add(r),n.push(C(d(r))));let r=await Promise.all(n),i=new Map;return Array.from(t).forEach((e,t)=>{i.set(e,r[t])}),e=>i.get(e.type)}export{m as fromUrl};