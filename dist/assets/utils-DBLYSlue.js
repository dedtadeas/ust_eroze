import{SE as e,_E as t,ec as n,ml as r,rc as i,vE as a}from"./index-BqmCqmfp.js";import{t as o}from"./VertexElementDescriptor-BGWnA0Rs.js";import{t as s}from"./BoundingBox-DnR5UeUT.js";function c(e){switch(e){case i.BYTE:case i.UNSIGNED_BYTE:return 1;case i.SHORT:case i.UNSIGNED_SHORT:case i.HALF_FLOAT:return 2;case i.FLOAT:case i.INT:case i.UNSIGNED_INT:return 4}}var l=()=>a.getLogger(`esri.views.2d.engine.webgl.Utils`);function u(e){switch(e){case n.UNSIGNED_BYTE:return 1;case n.UNSIGNED_SHORT_4_4_4_4:return 2;case n.FLOAT:return 4;default:l().error(new t(`webgl-utils`,`Unable to handle type ${e}`));return}}function d(e){switch(e){case n.UNSIGNED_BYTE:return Uint8Array;case n.UNSIGNED_SHORT_4_4_4_4:return Uint16Array;case n.FLOAT:return Float32Array;default:l().error(new t(`webgl-utils`,`Unable to handle type ${e}`));return}}function f(e){let t=0,n=e.map(e=>{let n=new o(e.name,e.count,e.type,t,0,e.normalized||!1);return t+=e.count*c(e.type),n});return n.forEach(e=>e.stride=t),n}var p=e=>{let t=new Map;for(let n of e)t.set(n.name,n.location);return t},m=new Map,h=(e,t)=>{if(!m.has(e)){let n={bufferLayout:f(t),attributes:p(t)};m.set(e,n)}return m.get(e)},g=e=>e.includes(`data:image/svg+xml`);function _(e){let t=[];for(let n=0;n<e.length;n++)t.push(e.charCodeAt(n));return t}function v(e){if(e==null)return``;let{type:t}=e;switch(t){case`CIMMarkerPlacementAlongLineRandomSize`:return`${t}-${e.seed}-${e.randomization}`;case`CIMMarkerPlacementAlongLineVariableSize`:return`${t}-${e.maxRandomOffset}-${e.numberOfSizes}-${e.seed}-${e.variationMethod}`;case`CIMMarkerPlacementAtExtremities`:return`${t}-${e.extremityPlacement}-${e.offsetAlongLine}`;case`CIMMarkerPlacementAtRatioPositions`:return`${t}-${e.beginPosition}-${e.endPosition}-${e.flipFirst}-${JSON.stringify(e.positionArray)}`;case`CIMMarkerPlacementAtMeasuredUnits`:return`${t}-${e.interval}-${e.skipMarkerRate}-${e.placeAtExtremities}`;case`CIMMarkerPlacementInsidePolygon`:return`${t}-${e.stepX}-${e.stepY}-${e.randomness}-${e.gridType}-${e.seed}-${e.shiftOddRows}`;case`CIMMarkerPlacementOnLine`:return`${t}-${e.relativeTo}-${e.startPointOffset}`;case`CIMMarkerPlacementOnVertices`:return`${t}-${e.placeOnControlPoints}-${e.placeOnEndPoints}-${e.placeOnRegularVertices}`;case`CIMMarkerPlacementPolygonCenter`:return`${t}-${e.method}`;default:return`${t}`}}var y=class e{static{this.byteSizeHint=7*Uint32Array.BYTES_PER_ELEMENT}static{this.estimatedMemory=40}constructor(e,t,n,r,i,a,o){this.instanceId=e,this.textureKey=t,this.indexStart=n,this.indexCount=r,this.vertexStart=i,this.vertexCount=a,this.overlaps=o}updateBaseOffsets(e){this.vertexStart+=e.vertexFrom,this.indexStart+=e.indexFrom}clone(){return new e(this.instanceId,this.textureKey,this.indexStart,this.indexCount,this.vertexStart,this.vertexCount,this.overlaps)}static write(e,t,n,r,i,a,o,s){e.push(t),e.push(n),e.push(r),e.push(i),e.push(a),e.push(o),e.push(s)}serialize(e){return e.push(this.instanceId),e.push(this.textureKey),e.push(this.indexStart),e.push(this.indexCount),e.push(this.vertexStart),e.push(this.vertexCount),e.push(this.overlaps),e}static deserialize(t){let n=t.readInt32(),r=t.readInt32(),i=t.readInt32(),a=t.readInt32(),o=t.readInt32(),s=t.readInt32(),c=t.readInt32();return new e(n,r,i,a,o,s,c)}};function b(e,t){if(t!==null){e.push(t.length);for(let n of t)n.serialize(e);return e}e.push(0)}function x(e,t,n){let r=e.readInt32(),i=Array(r);for(let r=0;r<i.length;r++)i[r]=t.deserialize(e,n);return i}var S=class e{static{this.byteSizeHint=2*Uint32Array.BYTES_PER_ELEMENT+y.byteSizeHint}static estimateMemory(e){return 24+y.estimatedMemory*e}constructor(e,t){this.id=e,this.sortKey=t,this.records=[]}serialize(e){return e.push(this.id),e.writeF32(this.sortKey),b(e,this.records),e}static deserialize(t){let n=t.readInt32(),r=t.readF32(),i=new e(n,r);return i.records=x(t,y)??[],i}},C=2,w=class e{constructor(e,t,n,r,i,a,o,s,c,l,u,d=[],f=0,p=0){this.displayId=e,this.labelClassId=t,this.labelIdHash=n,this.hash=r,this.anchorX=i,this.anchorY=a,this.directionX=o,this.directionY=s,this.maxScale=c,this.minScale=l,this.referenceBounds=u,this.bounds=d,this.recordStart=f,this.recordCount=p,this.priority=0,this._colliders=null,this.uniqueSymbol=null,this.selectedForRendering=!1}get xTile(){return this.anchorX}get yTile(){return this.anchorY}colliders(e){if(!this._colliders){let t=e.attributeView,n=this.referenceBounds?.size??0,r=e.layerView.labelingCollisionInfos[0].vvEvaluators[0];if(r!=null){let e=r(t.getVisualVariableData(this.displayId,0));n=isNaN(e)||e==null||e===1/0?n:e}let i=this.minScale?e.layerView.view.featuresTilingScheme.scaleToZoom(this.minScale):0,a=this.maxScale?e.layerView.view.featuresTilingScheme.scaleToZoom(this.maxScale):25,o=this.directionX*(4+n/2),s=this.directionY*(4+n/2);this._colliders=this.bounds.map(e=>({labelId:this.labelIdHash,xTile:this.anchorX,yTile:this.anchorY,dxPixels:e.x-e.halfWidth+o,dyPixels:e.y-e.halfHeight+s,hard:!0,partIndex:1,width:e.width+C,height:e.height+C,angle:0,xScreen:0,yScreen:0,dxScreen:0,dyScreen:0,enabled:!0,minLod:i,maxLod:a}))}return this._colliders}get id(){return this.displayId}serialize(e){e.push(this.displayId),e.push(this.labelClassId),e.push(this.labelIdHash),e.push(this.hash),e.push(this.recordStart),e.push(this.recordCount),e.writeF32(this.anchorX),e.writeF32(this.anchorY),e.writeF32(this.directionX),e.writeF32(this.directionY),e.writeF32(this.maxScale),e.writeF32(this.minScale),this.referenceBounds?(e.writeF32(this.referenceBounds.size),e.writeF32(this.referenceBounds.offsetX),e.writeF32(this.referenceBounds.offsetY)):(e.writeF32(0),e.writeF32(0),e.writeF32(0)),b(e,this.bounds)}static deserialize(t){let n=t.readInt32(),r=t.readInt32(),i=t.readInt32(),a=t.readInt32(),o=t.readInt32(),c=t.readInt32(),l=t.readF32(),u=t.readF32(),d=t.readF32(),f=t.readF32(),p=t.readF32(),m=t.readF32(),h=t.readF32(),g=t.readF32(),_=t.readF32(),v=x(t,s)??[];return new e(n,r,i,a,l,u,d,f,p,m,{size:h,offsetX:g,offsetY:_},v,o,c)}},T=new Float32Array(1),E=new Uint32Array(T.buffer);function D(e){return T[0]=e,E[0]}function O(e){return E[0]=e,T[0]}function k(e,t){return 65535&e|t<<16}function A(e){let t=D(e),n=t>>>31,r=t>>>23&255,i=8388607&t;return r-=127,r>15?n<<15|31744:r<-25?0:(r<-14&&(i+=8388608,i/=2**(-14-r),r=-15),r+=15,i/=8192,i=j(i,1023),n<<15|r<<10|i)}function j(e,t){let n=Math.floor(e),r=e-n;return n<t&&(r>.5||r===.5&&n%2==1)?n+1:n}function M(e){let t=e>>>15,n=e>>10&31,r=1023&e;return t=t?-1:1,n-=15,r/=1024,n>-15?r+=1:n=-14,t*2**n*r}function N(e,t,n,r){let a=n.packPrecisionFactor??1;switch(n.type){case i.BYTE:if(n.count===1)e.setInt8(r+n.offset,t*a);else for(let i=0;i<n.count;i++){let o=i*Int8Array.BYTES_PER_ELEMENT;e.setInt8(r+n.offset+o,t[i]*a)}break;case i.UNSIGNED_BYTE:if(n.count===1)e.setUint8(r+n.offset,t*a);else for(let i=0;i<n.count;i++){let o=i*Uint8Array.BYTES_PER_ELEMENT;e.setUint8(r+n.offset+o,t[i]*a)}break;case i.SHORT:if(n.count===1)e.setInt16(r+n.offset,t*a,!0);else for(let i=0;i<n.count;i++){let o=i*Int16Array.BYTES_PER_ELEMENT;e.setInt16(r+n.offset+o,t[i]*a,!0)}break;case i.UNSIGNED_SHORT:if(n.count===1)e.setUint16(r+n.offset,t*a,!0);else for(let i=0;i<n.count;i++){let o=i*Uint16Array.BYTES_PER_ELEMENT;e.setUint16(r+n.offset+o,t[i]*a,!0)}break;case i.INT:if(n.count===1)e.setInt32(r+n.offset,t*a,!0);else for(let i=0;i<n.count;i++){let o=i*Int32Array.BYTES_PER_ELEMENT;e.setInt32(r+n.offset+o,t[i]*a,!0)}break;case i.UNSIGNED_INT:if(n.count===1)e.setUint32(r+n.offset,t*a,!0);else for(let i=0;i<n.count;i++){let o=i*Uint32Array.BYTES_PER_ELEMENT;e.setUint32(r+n.offset+o,t[i]*a,!0)}break;case i.FLOAT:if(n.count===1)e.setFloat32(r+n.offset,t*a,!0);else for(let i=0;i<n.count;i++){let o=i*Float32Array.BYTES_PER_ELEMENT;e.setFloat32(r+n.offset+o,t[i]*a,!0)}break;case i.HALF_FLOAT:if(n.count===1)e.setUint16(r+n.offset,A(t*a),!0);else for(let i=0;i<n.count;i++){let o=i*Uint16Array.BYTES_PER_ELEMENT;e.setUint16(r+n.offset+o,A(t[i]*a),!0)}}}function P(e,t,n){switch(t.type){case i.BYTE:{if(t.count===1)return e.getInt8(n+t.offset);let r=[];for(let i=0;i<t.count;i++){let a=i*Int8Array.BYTES_PER_ELEMENT;r.push(e.getInt8(n+t.offset+a))}return r}case i.UNSIGNED_BYTE:{if(t.count===1)return e.getUint8(n+t.offset);let r=[];for(let i=0;i<t.count;i++){let a=i*Uint8Array.BYTES_PER_ELEMENT;r.push(e.getUint8(n+t.offset+a))}return r}case i.SHORT:{if(t.count===1)return e.getInt16(n+t.offset,!0);let r=[];for(let i=0;i<t.count;i++){let a=i*Int16Array.BYTES_PER_ELEMENT;r.push(e.getInt16(n+t.offset+a,!0))}return r}case i.UNSIGNED_SHORT:{if(t.count===1)return e.getUint16(n+t.offset,!0);let r=[];for(let i=0;i<t.count;i++){let a=i*Uint16Array.BYTES_PER_ELEMENT;r.push(e.getUint16(n+t.offset+a,!0))}return r}case i.INT:{if(t.count===1)return e.getInt32(n+t.offset,!0);let r=[];for(let i=0;i<t.count;i++){let a=i*Int32Array.BYTES_PER_ELEMENT;r.push(e.getInt32(n+t.offset+a,!0))}return r}case i.UNSIGNED_INT:{if(t.count===1)return e.getUint32(n+t.offset,!0);let r=[];for(let i=0;i<t.count;i++){let a=i*Uint32Array.BYTES_PER_ELEMENT;r.push(e.getUint32(n+t.offset+a,!0))}return r}case i.FLOAT:{if(t.count===1)return e.getFloat32(n+t.offset,!0);let r=[];for(let i=0;i<t.count;i++){let a=i*Float32Array.BYTES_PER_ELEMENT;r.push(e.getFloat32(n+t.offset+a,!0))}return r}case i.HALF_FLOAT:{if(t.count===1)return M(e.getUint16(n+t.offset,!0));let r=[];for(let i=0;i<t.count;i++){let a=i*Uint16Array.BYTES_PER_ELEMENT;r.push(M(e.getUint16(n+t.offset+a,!0)))}return r}}}function F(t){let n=t.map(({name:e,count:t,type:n})=>`${e}.${t}.${n}`).join(`,`);return e(n)}function I(e,t,n,r,i,a,o){if(e.primitiveName===t){let t=r?.readWithDefault(i,a,e[n]&&o);e.type===`text`&&(t=t.toString()),e[n]=t;return}if(`type`in e&&e.type!=null){if(e.effects)for(let s of e.effects)I(s,t,n,r,i,a,o);switch(e.type){case`CIMPointSymbol`:case`CIMLineSymbol`:case`CIMPolygonSymbol`:if(e.symbolLayers)for(let s of e.symbolLayers)I(s,t,n,r,i,a,o);break;case`CIMTextSymbol`:e.symbol&&I(e.symbol,t,n,r,i,a,o);break;case`CIMHatchFill`:e.lineSymbol&&I(e.lineSymbol,t,n,r,i,a,o);break;case`CIMPictureMarker`:case`CIMCharacterMarker`:case`CIMVectorMarker`:if(e.markerPlacement&&I(e.markerPlacement,t,n,r,i,a,o),e.type===`CIMVectorMarker`&&e.markerGraphics)for(let s of e.markerGraphics)I(s,t,n,r,i,a,o),I(s.symbol,t,n,r,i,a,o)}}}var L=400;function R(e){let t=Math.max(1.25*e.width,20);return e.effects!=null&&e.effects.length>0?L:t}export{u as _,P as a,k as c,x as d,y as f,d as g,g as h,N as i,w as l,_ as m,I as n,D as o,h as p,F as r,O as s,R as t,S as u,v};