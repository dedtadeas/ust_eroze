import{$m as e,Fa as t,Fu as n,OS as r,Sw as i,WT as a,XT as o}from"./index-BqmCqmfp.js";import{t as s}from"./urlUtils-CtPsFIu4.js";var c=`Layer does not support extent calculation.`;function l(t,n){let i=t.geometry,a=t.toJSON(),o=a;if(i!=null&&(o.geometry=JSON.stringify(i),o.geometryType=e(i),o.inSR=r(i.spatialReference)),a.topFilter?.groupByFields&&(o.topFilter.groupByFields=a.topFilter.groupByFields.join(`,`)),a.topFilter?.orderByFields&&(o.topFilter.orderByFields=a.topFilter.orderByFields.join(`,`)),a.topFilter&&(o.topFilter=JSON.stringify(o.topFilter)),a.objectIds&&(o.objectIds=a.objectIds.join(`,`)),a.orderByFields&&(o.orderByFields=a.orderByFields.join(`,`)),a.outFields&&!(n?.returnCountOnly||n?.returnExtentOnly||n?.returnIdsOnly)?a.outFields.includes(`*`)?o.outFields=`*`:o.outFields=a.outFields.join(`,`):delete o.outFields,a.outSR?o.outSR=r(a.outSR):i&&a.returnGeometry&&(o.outSR=o.inSR),a.returnGeometry&&delete a.returnGeometry,a.timeExtent){let{start:e,end:t}=a.timeExtent;e==null&&t==null||(o.time=e===t?e:`${e??`null`},${t??`null`}`),delete a.timeExtent}return o}async function u(e,n,r,i){let a=await m(e,n,`json`,i);return t(n,r,a.data),a}async function d(e,t,n){return t.timeExtent!=null&&t.timeExtent.isEmpty?{data:{objectIds:[]}}:m(e,t,`json`,n,{returnIdsOnly:!0})}async function f(e,t,n){return t.timeExtent!=null&&t.timeExtent.isEmpty?{data:{count:0,extent:null}}:m(e,t,`json`,n,{returnExtentOnly:!0,returnCountOnly:!0}).then(e=>{let t=e.data;if(t.hasOwnProperty(`extent`))return e;if(t.features||t.hasOwnProperty(`count`))throw Error(c);return e})}function p(e,t,n){return t.timeExtent!=null&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):m(e,t,`json`,n,{returnIdsOnly:!0,returnCountOnly:!0})}function m(e,t,r,c={},u={}){let d=typeof e==`string`?a(e):e,f=t.geometry?[t.geometry]:[];return c.responseType=`json`,n(f,null,c).then(e=>{let n=e?.[0];n!=null&&((t=t.clone()).geometry=n);let a=s({...d.query,f:r,...u,...l(t,u)});return i(o(d.path,`queryTopFeatures`),{...c,query:{...a,...c.query}})})}export{u as i,f as n,d as r,p as t};