const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/featureLayerUtils-exT5YSi4.js","assets/index-BqmCqmfp.js","assets/index-kIqmb12G.css","assets/originUtils-Xpg5-Q2D.js","assets/utils-yJnMCzaE.js","assets/saveUtils-DsVVlvmj.js","assets/fetchService-BUtv2ntd.js","assets/FeatureLayerSource-EVkqILnf.js","assets/quatf64-CJzmL3cc.js","assets/quat-Bk_ZaVz9.js","assets/memoryEstimations-O7VgDRVG.js","assets/pbf-CwGh07vG.js","assets/MeshLocalVertexSpace-HjmVAuYa.js","assets/MeshTransform-B2p38eYR.js","assets/axisAngleDegrees-Di7q97jx.js","assets/External-Cyg8cgWj.js","assets/meshVertexSpaceUtils-Y8FeTLov.js","assets/OptimizedFeature-Dx4_lHip.js","assets/OptimizedGeometry-f3I9Z6C1.js","assets/OptimizedFeatureSet-DlHqIhoP.js","assets/applyEditsUtils-6Wi1ZwPV.js","assets/editingSupport-z-WY3UuH.js","assets/QueryEngineCapabilities-DPTJ40n4.js","assets/featureConversionUtils-7vyVIZ6j.js","assets/FeatureLayerSource-Hn81GwdL.js","assets/QueryTask-vPpZxMGi.js","assets/executeForIds-CFB4h9Bk.js","assets/query-D8IHih8e.js","assets/urlUtils-CtPsFIu4.js","assets/pbfQueryUtils-DOeTJOP2.js","assets/queryUtils-GIY2oFHT.js","assets/executeQueryJSON-BAg2ttNX.js","assets/executeQueryPBF-DMb74A0k.js","assets/clientSideDefaults-CpyaF_rm.js"])))=>i.map(i=>d[i]);
import{$i as e,AC as t,AE as n,B as r,CD as i,Cd as a,Cr as o,Cw as s,Dr as c,EE as l,ET as u,Ea as d,Er as ee,Fr as te,G as f,Gi as ne,H as re,Hr as ie,Hx as p,Ii as ae,Ir as m,J as oe,Ji as se,Jr as ce,Ka as h,Kb as le,Kw as ue,L as de,La as fe,MC as g,Ma as pe,Mb as me,Mr as he,Na as ge,Np as _e,Nr as ve,Nw as ye,Pr as _,Q as be,Qi as xe,Qw as Se,Ra as Ce,Rr as we,SC as v,Sr as Te,Tr as Ee,U as y,Ux as b,Vb as x,Wr as S,X as C,Xi as w,Y as T,Yn as E,Z as D,Zn as De,_E as O,ai as k,ao as A,cC as Oe,cm as j,da as ke,fp as Ae,gi as je,gp as Me,hC as Ne,hi as Pe,hp as Fe,jr as Ie,kC as M,ka as Le,kr as Re,mT as ze,mi as Be,mm as Ve,na as He,oC as N,qi as Ue,rT as We,rt as Ge,tr as Ke,vE as P,va as qe,wr as Je,xr as Ye,ym as F,z as Xe,za as Ze,zb as Qe,zy as I}from"./index-BqmCqmfp.js";import{d as $e}from"./colorUtils-uG2qTogT.js";import{r as et}from"./cimSymbolUtils-1FVTTBxd.js";import"./gfxUtils-DZoKCRMw.js";import{a as tt,n as nt}from"./utils-5jlQHYup.js";var L={key:`type`,base:ae,errorContext:`renderer`,typeMap:{simple:k,"unique-value":ce,"class-breaks":E}},R=t({types:L});function rt(e,t){let n=e.drawingInfo?.renderer,r=n?R(n,e,t):null;if(r?.type===`simple`)return tt(r.symbol,null)?r.symbol.clone():null}var it=[`#ed5151`,`#149ece`,`#a7c636`,`#9e559c`,`#fc921f`,`#ffde3e`,`#f789d8`,`#b7814a`,`#3caf99`,`#6b6bd6`,`#b54779`,`#7f7f7f`];function at(e,t){return $e(it,e,{offset:!0,shuffle:!0}).reverse().map(e=>{let n=t.clone();return n.type===`cim`?et(n,e):nt(n,e),new k({symbol:n})})}var ot=Symbol(`isSubtypeGroupGraphicOriginSymbol`),z,st=class extends fe{get[(z=ot,Ae)](){return this.sublayer}get[Fe](){return this.sublayer}get[Ce](){return this.layer}constructor(e){super(),this[z]=!0,this.type=`subtype-group`,this.sublayer=e}get layer(){return this.sublayer.parent}get id(){return`${this.layer.id}:__${this.sublayer.id}__`}},B=y(),ct=0;function V(e,t){let n=e.json.write;return typeof n!=`object`&&(n=e.json.write={}),n.ignoreOrigin=!0,t?.spatialOnly&&(n.layerContainerTypes=h),e}function H(e){let t={write:{ignoreOrigin:!0}};return e?.name&&(t.name=e.name),typeof t.write==`object`&&(e?.spatialOnly&&(t.write.layerContainerTypes=h),e?.target&&(t.write.target=e.target)),t}function lt(e){return new k({symbol:ut(e)})}function ut(e){switch(e){case`point`:case`multipoint`:return Be.clone();case`polyline`:return je.clone();case`polygon`:case`multipatch`:return Pe.clone();default:return null}}function dt(e,t){return!!t&&e?.type===`unique-value`&&e.field!=null&&e.field.toLowerCase()===t.toLowerCase()&&!e.field2&&!e.field3&&!e.valueExpression}function U(e,t){return e==null?null:t.subtypes?.find(t=>t.code===e)}function ft(e,t){let n=null;switch(t.geometryType){case`esriGeometryPoint`:case`esriGeometryMultipoint`:n=`point`;break;case`esriGeometryPolyline`:n=`line`;break;case`esriGeometryPolygon`:case`esriGeometryMultiPatch`:n=`polygon`;break;default:t.type,n=null}let r={},i=U(e,t);if(i!=null){let{defaultValues:e}=i;for(let t in e)r[t]=e[t]}return r[t.subtypeField]=e,new f({name:`New Feature`,drawingTool:n,prototype:{attributes:r}})}var W=class extends A(I(Qe(Ne))){constructor(e){super(e),this.attributeTableTemplate=null,this.charts=null,this.editingEnabled=!0,this.fieldOverrides=null,this.fieldsIndex=null,this.formTemplate=null,this.graphicOrigin=new st(this),this.id=`${Date.now().toString(16)}-subtype-sublayer-${ct++}`,this.type=`subtype-sublayer`,this.labelsVisible=!0,this.labelingInfo=null,this.layerType=`ArcGISFeatureLayer`,this.legendEnabled=!0,this.listMode=`show`,this.minScale=0,this.maxScale=0,this.opacity=1,this.parent=null,this.popupEnabled=!0,this.popupTemplate=null,this.subtypeCode=null,this.templates=null,this.title=null,this.visible=!0}load(e){return j(this.renderer,this.fieldsIndex),Promise.resolve(this)}get _titleCreator(){let e=this._get(`_titleCreator`);return ze(e),new r({fieldsIndex:this.fieldsIndex,objectIdField:this.objectIdField,displayField:this.parent?.displayField??``,fields:this.fields,effectivePopupTemplate:this.popupTemplate??this.defaultPopupTemplate})}get capabilities(){return this.parent?.capabilities}get effectiveCapabilities(){return this.parent?.effectiveCapabilities}get effectiveEditingEnabled(){let{parent:e}=this;return e?e.effectiveEditingEnabled&&this.editingEnabled:this.editingEnabled}get elevationInfo(){return this.parent?.elevationInfo}get featureTitleFields(){return[...this._titleCreator.requiredFields]}writeFieldOverrides(e,t,r){let{fields:i,parent:a}=this,o;if(i){o=[];let e=0;i.forEach(({name:t,alias:n,editable:r,visible:i})=>{if(!i)return;let s=a?.fields?.find(e=>e.name===t);if(!s)return;let c={name:t},l=!1;n!==s.alias&&(c.alias=n,l=!0),r!==s.editable&&(c.editable=r,l=!0),o.push(c),l&&e++}),e===0&&o.length===i.length&&(o=null)}else o=n(e);o?.length&&l(r,o,t)}get fields(){let{parent:e,fieldOverrides:t,subtypeCode:n}=this,r=e?.fields;if(!e||!r?.length)return null;let{subtypes:i,subtypeField:a}=e,o=i?.find(e=>e.code===n),s=o?.defaultValues,c=o?.domains,l=[];for(let e of r){let r=e.clone(),{name:i}=r,o=t?.find(e=>e.name===i);if(r.visible=!t?.length||!!o,o){let{alias:e,editable:t}=o;e&&(r.alias=e),!1===t&&(r.editable=!1)}let u=s?.[i]??null;r.defaultValue=i===a?n:u;let d=c?.[i]??null;r.domain=i===a?null:d?d.type===`inherited`?r.domain:d.clone():null,l.push(r)}return l}get floorInfo(){return this.parent?.floorInfo}get isTable(){return!!this.parent?.isTable}get geometryType(){return this.parent?.geometryType}get globalIdField(){return this.parent?this.parent.globalIdField:(P.getLogger(this).error(q(`globalIdField`)),null)}get effectiveScaleRange(){let{minScale:e,maxScale:t}=this;return{minScale:e,maxScale:t}}get objectIdField(){return this.parent||P.getLogger(this).error(q(`objectIdField`)),this.parent?.objectIdField}get defaultPopupTemplate(){return this.createPopupTemplate()}get relationships(){return this.parent?.relationships}set renderer(e){j(e,this.fieldsIndex),this._override(`renderer`,e)}get renderer(){if(this._isOverridden(`renderer`))return this._get(`renderer`);let{parent:e}=this;return e&&!e.isTable&&e.geometryType!==`mesh`?lt(e.geometryType):null}readRendererFromService(e,t,n){if(t.type===`Table`)return null;let r=t.drawingInfo?.renderer,i=R(r,t,n),a,{subtypeCode:o}=this;if(o!=null&&dt(i,t.subtypeField)){let e=i.uniqueValueInfos?.find(({value:e})=>(e=typeof e==`number`?String(e):e)===String(o));e&&(a=new k({symbol:e.symbol}))}else i?.type!==`simple`||i.visualVariables?.length||(a=i);return a}readRenderer(e,t,n){let r=t?.layerDefinition?.drawingInfo?.renderer;if(r)return R(r,t,n)||void 0}get spatialReference(){return this.parent?.spatialReference??b.WGS84}get subtypeField(){return this.parent?.subtypeField}readTemplatesFromService(e,t){return[ft(this.subtypeCode,t)]}readTitleFromService(e,t){let n=U(this.subtypeCode,t);return n==null?null:n.name}get url(){return this.parent?.url}get userHasUpdateItemPrivileges(){return!!this.parent?.userHasUpdateItemPrivileges}async addAttachment(e,t){let{parent:n}=this;if(!n)throw q(`addAttachment`);if(e.getAttribute(n.subtypeField)!==this.subtypeCode)throw new O(`subtype-sublayer:addAttachment`,`The feature provided does not belong to this SubtypeSublayer`);return n.addAttachment(e,t)}async updateAttachment(e,t,n){let{parent:r}=this;if(!r)throw q(`updateAttachment`);if(e.getAttribute(r.subtypeField)!==this.subtypeCode)throw new O(`subtype-sublayer:updateAttachment`,`The feature provided does not belong to this SubtypeSublayer`);return r.updateAttachment(e,t,n)}async deleteAttachments(e,t){let{parent:n}=this;if(!n)throw q(`deleteAttachments`);if(e.getAttribute(n.subtypeField)!==this.subtypeCode)throw new O(`subtype-sublayer:deleteAttachments`,`The feature provided does not belong to this SubtypeSublayer`);return n.deleteAttachments(e,t)}async applyEdits(e,t){if(!this.parent)throw q(`applyEdits`);return this.parent.applyEdits(e,t)}createPopupTemplate(e){let t=this,{parent:n,fields:r,title:i}=this;if(n){let{displayField:e,editFieldsInfo:a,objectIdField:o}=n;t={displayField:e,editFieldsInfo:a,fields:r,objectIdField:o,title:i}}return de(t,e)}createQuery(){if(!this.parent)throw q(`createQuery`);let e=_(this.parent),t=`${this.parent.subtypeField}=${this.subtypeCode}`;return e.where=F(t,this.parent.definitionExpression),e}getFeatureTitle(e,t){return this._titleCreator.getTitle(this,e,t)}getFeatureTitles(e,t){return this._titleCreator.getTitles(this,e,t)}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){if(!t?.excludeImpliedDomains&&this.parent){let t=m(this.parent,e);if(t)return t}return this._getLayerDomain(e)}async queryAttachments(e,t){let n=await this.load();if(!n.parent)throw q(`queryAttachments`);let r=e.clone();return r.where=K(r.where,n.parent.subtypeField,n.subtypeCode),n.parent.queryAttachments(e,t)}async queryFeatureCount(e,t){let n=await this.load();if(!n.parent)throw q(`queryFeatureCount`);return n.parent.queryFeatureCount(G(n.parent,n,e),t)}async queryFeatures(e,t){let n=await this.load();if(!n.parent)throw q(`queryFeatures`);return n.parent.queryFeatures(G(n.parent,n,e),t)}async queryObjectIds(e,t){let n=await this.load();if(!n.parent)throw q(`queryObjectIds`);return n.parent.queryObjectIds(G(n.parent,n,e),t)}async queryRelatedFeatures(e,t){let n=await this.load();if(!n.parent)throw q(`queryRelatedFeatures`);return n.parent.queryRelatedFeatures(e,t)}async queryRelatedFeaturesCount(e,t){let n=await this.load();if(!n.parent)throw q(`queryRelatedFeaturesCount`);return n.parent.queryRelatedFeaturesCount(e,t)}_getLayerDomain(e){let t=this.fieldsIndex.get(e);return t?t.domain:null}};i([g({clonable:!1,readOnly:!0})],W.prototype,`_titleCreator`,null),i([g({type:He,json:H({name:`attributeTableInfo`})})],W.prototype,`attributeTableTemplate`,void 0),i([g({readOnly:!0,json:{read:!1}})],W.prototype,`capabilities`,null),i([g({readOnly:!0,json:{read:!1}})],W.prototype,`effectiveCapabilities`,null),i([g({json:H()})],W.prototype,`charts`,void 0),i([g({type:Boolean,nonNullable:!0,json:H({name:`enableEditing`})})],W.prototype,`editingEnabled`,void 0),i([g({type:Boolean,readOnly:!0})],W.prototype,`effectiveEditingEnabled`,null),i([g({readOnly:!0,json:{read:!1}})],W.prototype,`elevationInfo`,null),i([g({clonable:!1,readOnly:!0})],W.prototype,`featureTitleFields`,null),i([g({json:{name:`layerDefinition.fieldOverrides`,origins:{service:{read:!1}},write:{ignoreOrigin:!0,allowNull:!0}}})],W.prototype,`fieldOverrides`,void 0),i([N(`fieldOverrides`)],W.prototype,`writeFieldOverrides`,null),i([g({...B.fields,readOnly:!0,json:{read:!1}})],W.prototype,`fields`,null),i([g(B.fieldsIndex)],W.prototype,`fieldsIndex`,void 0),i([g({readOnly:!0,json:{read:!1}})],W.prototype,`floorInfo`,null),i([g({type:Ze,json:H({name:`formInfo`})})],W.prototype,`formTemplate`,void 0),i([g({readOnly:!0,clonable:!1})],W.prototype,`graphicOrigin`,void 0),i([g({type:String,clonable:!1,json:{origins:{service:{read:!1},"portal-item":{read:!1}},write:{ignoreOrigin:!0}}})],W.prototype,`id`,void 0),i([g({readOnly:!0,json:{read:!1}})],W.prototype,`isTable`,null),i([g({readOnly:!0,json:{read:!1}})],W.prototype,`geometryType`,null),i([g({readOnly:!0,json:{read:!1}})],W.prototype,`globalIdField`,null),i([g({readOnly:!0,json:{read:!1}})],W.prototype,`type`,void 0),i([g(V(n(w)))],W.prototype,`labelsVisible`,void 0),i([g({type:[De],json:{name:`layerDefinition.drawingInfo.labelingInfo`,origins:{service:{read:!1}},read:{reader:re},write:{ignoreOrigin:!0,layerContainerTypes:h}}})],W.prototype,`labelingInfo`,void 0),i([g({type:[`ArcGISFeatureLayer`],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,layerContainerTypes:h}}})],W.prototype,`layerType`,void 0),i([g(V(n(ne)))],W.prototype,`legendEnabled`,void 0),i([g({type:[`show`,`hide`]})],W.prototype,`listMode`,void 0),i([g((()=>{let e=n(Ue);return e.json.origins.service.read=!1,V(e,{spatialOnly:!0})})())],W.prototype,`minScale`,void 0),i([g((()=>{let t=n(e);return t.json.origins.service.read=!1,V(t,{spatialOnly:!0})})())],W.prototype,`maxScale`,void 0),i([g({readOnly:!0})],W.prototype,`effectiveScaleRange`,null),i([g({readOnly:!0,json:{read:!1}})],W.prototype,`objectIdField`,null),i([g({type:Number,range:{min:0,max:1},nonNullable:!0,json:H({spatialOnly:!0})})],W.prototype,`opacity`,void 0),i([g({clonable:!1})],W.prototype,`parent`,void 0),i([g(V(n(se)))],W.prototype,`popupEnabled`,void 0),i([g({type:Me,json:H({name:`popupInfo`})})],W.prototype,`popupTemplate`,void 0),i([g({readOnly:!0})],W.prototype,`defaultPopupTemplate`,null),i([g({readOnly:!0,json:{read:!1}})],W.prototype,`relationships`,null),i([g({types:L,json:H({target:`layerDefinition.drawingInfo.renderer`,spatialOnly:!0})})],W.prototype,`renderer`,null),i([p(`service`,`renderer`,[`drawingInfo.renderer`,`subtypeField`,`type`])],W.prototype,`readRendererFromService`,null),i([p(`renderer`,[`layerDefinition.drawingInfo.renderer`])],W.prototype,`readRenderer`,null),i([g({readOnly:!0,json:{read:!1}})],W.prototype,`spatialReference`,null),i([g({type:Number,json:{origins:{service:{read:!1}},write:{ignoreOrigin:!0}}})],W.prototype,`subtypeCode`,void 0),i([g({readOnly:!0,json:{read:!1}})],W.prototype,`subtypeField`,null),i([g({type:[f],json:H({name:`layerDefinition.templates`})})],W.prototype,`templates`,void 0),i([p(`service`,`templates`,[`geometryType`,`subtypeField`,`subtypes`,`type`])],W.prototype,`readTemplatesFromService`,null),i([g({type:String,json:H()})],W.prototype,`title`,void 0),i([p(`service`,`title`,[`subtypes`])],W.prototype,`readTitleFromService`,null),i([g({readOnly:!0,json:{read:!1}})],W.prototype,`url`,null),i([g({readOnly:!0})],W.prototype,`userHasUpdateItemPrivileges`,null),i([g({type:Boolean,nonNullable:!0,json:H({name:`visibility`,spatialOnly:!0})})],W.prototype,`visible`,void 0),W=i([M(`esri.layers.support.SubtypeSublayer`)],W);var G=(e,t,n)=>{if(!n)return t.createQuery();let r=a.from(n);return r.where=K(r.where,e.subtypeField,t.subtypeCode),r},K=(e,t,n)=>{let r=RegExp(`${t}\\s*=\\s*\\d+`),i=`${t}=${n}`,a=e??``;return r.test(a)?a.replace(r,i):F(i,a)},q=e=>new O(`subtype-sublayer:parent-missing`,`This sublayer must have a parent SubtypeGroupLayer in order to use ${e}`),J=`SubtypeGroupLayer`;function Y(e,t){return new O(`layer:unsupported`,`Layer (${e.title}, ${e.id}) of type '${e.declaredClass}' ${t}`,{layer:e})}function X(e,t){let n=[];for(let r of e){let e=new W;e.read(r,t),n.push(e)}return n}var Z=y();function Q(){return{name:`layerType`,read:{enabled:!0},write:{enabled:!0,ignoreOrigin:!0,isRequired:!0}}}var $=class extends Ke(qe(ke(Le(oe(C(D(pe(Ge(be(A(d(ge(I(me)))))))))))))){constructor(...e){super(...e),this._sublayerLookup=new Map,this.fields=null,this.fieldsIndex=null,this.outFields=null,this.sublayers=new(v.ofType(W)),this.useUniqueColorsForSublayers=!0,this.supportedSourceTypes=new Set([`Feature Layer`,`Table`]),this.timeInfo=null,this.title=`Layer`,this.type=`subtype-group`,this._debouncedSaveOperations=ue(async(e,t,n)=>{let{save:r,saveAs:i}=await s(async()=>{let{save:e,saveAs:t}=await import(`./featureLayerUtils-exT5YSi4.js`);return{save:e,saveAs:t}},__vite__mapDeps([0,1,2,3,4,5,6]));switch(e){case 0:return r(this,t);case 1:return i(this,n,t)}}),this.addHandles(le(()=>this.sublayers,(e,t)=>this._handleSublayersChange(e,t),x))}destroy(){this.source?.destroy()}normalizeCtorArgs(e,t){return typeof e==`string`?{url:e,...t}:e}load(e){let t=e==null?null:e.signal,n=this.loadFromPortal({supportedTypes:[`Feature Service`]},e).catch(Se).then(async()=>{if(!this.url)throw new O(`subtype-grouplayer:missing-url-or-source`,`SubtypeGroupLayer must be created with either a url or a portal item`);if(this.layerId==null)throw new O(`subtype-grouplayer:missing-layerid`,`layerId is required for a SubtypeGroupLayer created with url`);this._initLayerProperties(await this.createGraphicsSource(t))}).then(()=>c(this,`load`,e));return this.addResolvingPromise(n),Promise.resolve(this)}get createQueryVersion(){return this.commitProperty(`definitionExpression`),this.commitProperty(`timeExtent`),this.commitProperty(`timeOffset`),this.commitProperty(`geometryType`),this.commitProperty(`gdbVersion`),this.commitProperty(`historicMoment`),this.commitProperty(`returnZ`),this.commitProperty(`capabilities`),this.commitProperty(`returnM`),(this._get(`createQueryVersion`)??0)+1}get editingEnabled(){return this.loaded&&this.capabilities!=null&&this.capabilities.operations.supportsEditing&&this.userHasEditingPrivileges}get effectiveEditingEnabled(){return we(this)}get operationalLayerType(){return this.isTable?`SubtypeGroupTable`:`SubtypeGroupLayer`}set source(e){this._get(`source`)!==e&&this._set(`source`,e)}readTitleFromService(e,{name:t}){return this.url?ye(this.url,t):t}async addAttachment(e,t){let n=await ee(this,e,t,J);return this.lastEditsEventDate=new Date,n}async updateAttachment(e,t,n){let r=await he(this,e,t,n,J);return this.lastEditsEventDate=new Date,r}async applyEdits(e,t){return ie(this,e,t)}async createGraphicsSource(e){let{default:t}=await We(s(()=>import(`./FeatureLayerSource-EVkqILnf.js`),__vite__mapDeps([7,8,9,1,2,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33])),e);return new t({layer:this,supportedSourceTypes:this.supportedSourceTypes}).load({signal:e})}createQuery(){let e=_(this),t=this.sublayers.map(e=>e.subtypeCode);return e.where=F(`${this.subtypeField} IN (${t.join(`,`)})`,this.definitionExpression),e}async deleteAttachments(e,t){let n=await S(this,e,t,J);return this.lastEditsEventDate=new Date,n}async fetchRecomputedExtents(e){return Ie(this,e,J)}findSublayerForFeature(e){let t=this.fieldsIndex.get(this.subtypeField),n=e.attributes[t.name];return this.findSublayerForSubtypeCode(n)}findSublayerForSubtypeCode(e){return this._sublayerLookup.get(e)}getFieldDomain(e,t){if(!t?.excludeImpliedDomains){let t=m(this,e);if(t)return t}let n=ve(this,t?.feature);if(n){let t=n.domains?.[e];return t?.type===`inherited`?this._getLayerDomain(e):t}return this._getLayerDomain(e)}loadAll(){return Oe(this,e=>{e(this.sublayers)})}async queryAttachments(e,t){return Ye(this,e,t,J)}async queryFeatures(e,t){let n=await this.load(),r=a.from(e)??n.createQuery(),i=r.outFields??[];i.includes(this.subtypeField)||(i.push(this.subtypeField),r.outFields=i);let o=await n.source.queryFeatures(r,t);if(o?.features)for(let e of o.features)e.origin=this.findSublayerForFeature(e)?.graphicOrigin,e.layer=e.sourceLayer=this.findSublayerForFeature(e);return o}async queryObjectIds(e,t){return(await Re(this,e,t,J)).filter(Ve)}async queryFeatureCount(e,t){return Ee(this,e,t,J)}async queryExtent(e,t){return Je(this,e,t,J)}async queryRelatedFeatures(e,t){return te(this,e,t,J)}async queryRelatedFeaturesCount(e,t){return o(this,e,t,J)}async save(e){return this._debouncedSaveOperations(0,e)}async saveAs(e,t){return this._debouncedSaveOperations(1,t,e)}write(e,t){let{origin:n,layerContainerType:r,messages:i}=t;if(this.isTable){if(n===`web-scene`||n===`web-map`&&r!==`tables`)return i?.push(Y(this,`using a table source cannot be written to web scenes and web maps`)),null}else if(this.loaded&&n===`web-map`&&r===`tables`)return i?.push(Y(this,`using a non-table source cannot be written to tables in web maps`)),null;return this.sublayers?.length?super.write(e,t):(i?.push(new O(`web-document-write:invalid-property`,`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' has invalid value for 'sublayers' property. 'sublayers' collection should contain at least one sublayer`,{layer:this})),null)}serviceSupportsSpatialReference(e){return!!this.loaded&&Xe(this,e)}async getFeatureTitle(e,t){let n=this.findSublayerForFeature(e);return n?await n.getFeatureTitle(e,t):this._getFeatureTitleForUnknownSublayer(e)}async getFeatureTitles(e,t){let n=new Map,r=new Map,i=[r];return e.forEach(e=>{let t=this.findSublayerForFeature(e);if(t)u(n,t,()=>[]).push(e);else{let t=e.getObjectId()??e.attributes[this.objectIdField];r.set(t,this._getFeatureTitleForUnknownSublayer(e))}}),(await Promise.all(Array.from(n).map(([e,n])=>e.getFeatureTitles(n,t)))).forEach(e=>i.push(e)),new Map(i.flatMap(e=>[...e]))}get featureTitleFields(){let e=new Set;for(let t of this.sublayers){let n=t.featureTitleFields;for(let t of n)e.add(t)}return[...e]}_getLayerDomain(e){let t=this.fieldsIndex.get(e);return t?t.domain:null}_initLayerProperties(e){this._set(`source`,e);let{sourceJSON:t}=e;if(t&&(this.sourceJSON=t,this.read(t,{origin:`service`,url:this.parsedUrl})),!this.subtypes?.length)throw new O(`subtype-grouplayer:missing-subtypes`,`SubtypeGroupLayer must be created using a layer with subtypes`);this._verifyFields(),_e(this.timeInfo,this.fieldsIndex)}async hasDataChanged(){return Te(this)}_verifyFields(){let e=this.parsedUrl?.path??`undefined`;this.objectIdField||console.log(`SubtypeGroupLayer: 'objectIdField' property is not defined (url: `+e+`)`),this.isTable||e.search(/\/FeatureServer\//i)!==-1||this.fields?.some(e=>e.type===`geometry`)||console.log(`SubtypeGroupLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: `+e+`)`)}_handleSublayersChange(e,t){t&&(t.forEach(e=>{e.parent=null}),this.removeHandles(`sublayers-owner`),this._sublayerLookup.clear()),e&&(e.forEach(e=>{e.parent=this,this._sublayerLookup.set(e.subtypeCode,e)}),this.addHandles([e.on(`after-add`,({item:e})=>{e.parent=this,this._sublayerLookup.set(e.subtypeCode,e)}),e.on(`after-remove`,({item:e})=>{e.parent=null,this._sublayerLookup.delete(e.subtypeCode)})],`sublayers-owner`))}_getFeatureTitleForUnknownSublayer(e){let{displayField:t,fieldsIndex:n,objectIdField:r}=this;if(t&&n.has(t))return e.attributes[n.get(t).name]??``;let i=e.getObjectId();return i==null?r&&n.has(r)?e.attributes[n.get(r).name]??``:``:i.toString()}};i([g({readOnly:!0})],$.prototype,`createQueryVersion`,null),i([g({readOnly:!0})],$.prototype,`editingEnabled`,null),i([g({readOnly:!0})],$.prototype,`effectiveEditingEnabled`,null),i([g({...Z.fields,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],$.prototype,`fields`,void 0),i([g(Z.fieldsIndex)],$.prototype,`fieldsIndex`,void 0),i([g(xe)],$.prototype,`id`,void 0),i([g({type:[`show`,`hide`,`hide-children`],json:{origins:{"portal-item":{read:!1,write:!1}}}})],$.prototype,`listMode`,void 0),i([g({type:[`SubtypeGroupLayer`,`SubtypeGroupTable`],json:{...Q(),origins:{"web-document":Q(),"portal-item":Q()}}})],$.prototype,`operationalLayerType`,null),i([g(Z.outFields)],$.prototype,`outFields`,void 0),i([g({clonable:!1})],$.prototype,`source`,null),i([g({type:v.ofType(W),json:{origins:{service:{read:{source:`subtypes`,reader(e,t,n){let r=null;if(this.useUniqueColorsForSublayers){let i=rt(t,n);r=i?at(e.length,i):null}let i=e.map(({code:e},i)=>{let a=new W({subtypeCode:e});a.read(t,n);let o=r?.[i];return o&&a.read({drawingInfo:{renderer:o.toJSON()}},n),a});return new(v.ofType(W))(i)}}}},read:{source:[`layers`,`tables`],reader(e,t,n){let r;return t.layerType===`SubtypeGroupLayer`&&t.layers?.length?r=X(t.layers,n):t.layerType===`SubtypeGroupTable`&&t.tables?.length&&(r=X(t.tables,n)),new(v.ofType(W))(r)}},write:{ignoreOrigin:!0,writer(e,t,n,r){let i=[];for(let t of e){let e=t.write({},r);i.push(e)}this.isTable?t.tables=i:t.layers=i}}}})],$.prototype,`sublayers`,void 0),i([g()],$.prototype,`useUniqueColorsForSublayers`,void 0),i([g({type:T})],$.prototype,`timeInfo`,void 0),i([g({json:{origins:{"portal-item":{write:{enabled:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}}}})],$.prototype,`title`,void 0),i([p(`service`,`title`,[`name`])],$.prototype,`readTitleFromService`,null),i([g({json:{read:!1}})],$.prototype,`type`,void 0),i([g({clonable:!1,readOnly:!0})],$.prototype,`featureTitleFields`,null),$=i([M(`esri.layers.SubtypeGroupLayer`)],$);var pt=$;export{pt as default};