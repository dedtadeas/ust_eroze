import{Fn as e,Vn as t,_m as n,fm as r,hm as i}from"./index-BqmCqmfp.js";import"./ImmutableArray-C3KNQCVd.js";import{Y as a,_ as o,ct as s,rt as c,s as l,tt as u,v as d}from"./Dictionary-B3Q9BFVY.js";import"./shared-BZhQTnH4.js";import"./number-Dq0Kt6xf.js";import{r as f}from"./containerUtils-vIXF8Wsj.js";import{i as p,t as m}from"./WhereClause-h6PJ6gjs.js";import{t as h}from"./fieldStats-DP2AlUAP.js";async function g(e,t,n,r){if(n.length===1){if(i(n[0]))return h(e,n[0],s(n[1],-1));if(u(n[0]))return h(e,n[0].toArray(),s(n[1],-1))}else if(n.length===2){if(i(n[0]))return h(e,n[0],s(n[1],-1));if(u(n[0]))return h(e,n[0].toArray(),s(n[1],-1));if(l(n[0])){let i=await n[0].load(),a=await v(m.create(n[1],{fieldsIndex:i.getFieldsIndex(),timeZone:i.dateFieldsTimeZoneDefaultUTC}),r,t);return _(t,await n[0].calculateStatistic(e,a,s(n[2],1e3),t.abortSignal))}}else if(n.length===3&&l(n[0])){let i=await n[0].load(),a=await v(m.create(n[1],{fieldsIndex:i.getFieldsIndex(),timeZone:i.dateFieldsTimeZoneDefaultUTC}),r,t);return _(t,await n[0].calculateStatistic(e,a,s(n[2],1e3),t.abortSignal))}return h(e,n,-1)}function _(t,n){return n instanceof p?e.fromReaderAsTimeStampOffset(n.toStorageFormat()):n instanceof Date?e.dateJSAndZoneToArcadeDate(n,d(t)):n}async function v(e,t,n){let r=e.getVariables();if(r.length>0){let i={};for(let e of r)i[e]=t.evaluateIdentifier(n,{name:e});e.parameters=i}return e}function y(e){e.mode===`async`&&(e.functions.stdev=function(t,n){return e.standardFunctionAsync(t,n,(n,r,i)=>g(`stdev`,t,i,e))},e.functions.variance=function(t,n){return e.standardFunctionAsync(t,n,(n,r,i)=>g(`variance`,t,i,e))},e.functions.average=function(t,n){return e.standardFunctionAsync(t,n,(n,r,i)=>g(`mean`,t,i,e))},e.functions.mean=function(t,n){return e.standardFunctionAsync(t,n,(n,r,i)=>g(`mean`,t,i,e))},e.functions.sum=function(t,n){return e.standardFunctionAsync(t,n,(n,r,i)=>g(`sum`,t,i,e))},e.functions.min=function(t,n){return e.standardFunctionAsync(t,n,(n,r,i)=>g(`min`,t,i,e))},e.functions.max=function(t,n){return e.standardFunctionAsync(t,n,(n,r,i)=>g(`max`,t,i,e))},e.functions.count=function(n,s){return e.standardFunctionAsync(n,s,async(e,c,d)=>{if(a(d,1,1,n,s),d[0]==null)return 0;if(l(d[0]))return d[0].count(e.abortSignal);if(i(d[0])||r(d[0]))return d[0].length;if(u(d[0]))return d[0].length();if(o(d[0]))return d[0].entryCount();throw new t(n,`InvalidParameter`,s)})},e.functions.isempty=function(r,i){return e.standardFunctionAsync(r,i,async(e,r,i)=>{if(a(i,1,2,e,r),i.length>=2&&!n(i[1]))throw new t(e,`InvalidParameter`,r);return s(i[1],!1)?l(i[0])?await i[0].isEmpty(e.abortSignal):f(i[0]):c(i[0])})})}export{y as registerFunctions};