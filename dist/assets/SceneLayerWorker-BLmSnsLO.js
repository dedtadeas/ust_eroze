const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/projectBuffer-Dqm9dvVZ.js","assets/index-BqmCqmfp.js","assets/index-kIqmb12G.css","assets/projectionUtils-BRmf8NVJ.js","assets/projectMeshVertexPositions-BzxucnQx.js","assets/vec3-40WN6G4a.js","assets/vec4-CcFo8HF1.js","assets/computeTranslationToOriginAndRotation-BC3OuSky.js","assets/projectPointToVector-Clou1sfo.js","assets/spatialReferenceEllipsoidUtils-DBtdxVkA.js","assets/MeshLocalVertexSpace-HjmVAuYa.js","assets/BufferView-DNaZpbJX.js","assets/Util-3rPi0NfK.js","assets/projectMeshVertexPositions-CiHqWuNj.js","assets/vertexSpaceConversion-g9XG_RJW.js","assets/meshVertexSpaceUtils-Y8FeTLov.js"])))=>i.map(i=>d[i]);
import{Cw as e,Jg as t,Jy as n,Qf as r,Ux as i,aw as a,nC as o,tp as s}from"./index-BqmCqmfp.js";import{n as c,t as l}from"./MeshLocalVertexSpace-HjmVAuYa.js";import"./projectPointToVector-Clou1sfo.js";import{n as u,o as d}from"./vec3-40WN6G4a.js";import"./dehydratedPoint-Dwb3orme.js";import"./projectVectorToVector-D-Bbb8fP.js";import"./WorkerHandle-CxcgZaVn.js";function f(){return m??=(async()=>await(await e(()=>import(`./i3s-DnFWlKMN.js`),[])).default({locateFile:e=>o(`esri/libs/i3s/${e}`)}))(),m}function p(){m=null}var m,h=class{constructor(e,t,n,r,i,a){this.layout=e,this.interleavedVertexData=t,this.indices=n,this.hasColors=r,this.hasModifications=i,this.positionData=a}},g=class{constructor(e,t,n,r,i,a,o){this.componentOffsets=e,this.featureIds=t,this.anchorIds=n,this.anchors=r,this.transformedGeometry=i,this.globalTrafo=a,this.obb=o}};new a({deallocator:null}),t();async function _(e){E=await P();let t=[e.geometryBuffer];return{result:O(E,e,t),transferList:t}}async function v(e){E=await P();let t=[e.geometryBuffer],{geometryBuffer:n}=e,r=n.byteLength,i=E._malloc(r),a=new Uint8Array(E.HEAPU8.buffer,i,r);a.set(new Uint8Array(n));let o=E.dracoDecompressPointCloudData(i,a.byteLength);if(E._free(i),o.error.length>0)throw Error(`i3s.wasm: ${o.error}`);let s=o.featureIds?.length>0?o.featureIds.slice():null,c=o.positions.slice();return s&&t.push(s.buffer),t.push(c.buffer),{result:{positions:c,featureIds:s},transferList:t}}async function y(e){await P(),A(e);let t={buffer:e.buffer};return{result:t,transferList:[t.buffer]}}async function b(e){await P(),D(e)}async function x(e){E=await P(),E.setLegacySchema(e.context,e.jsonSchema)}async function S(t){let{localMatrix:n,origin:a,positions:o,vertexSpace:u}=t,d=i.fromJSON(t.inSpatialReference),f=i.fromJSON(t.outSpatialReference),p=n?s(n):void 0,m=r(a),h,[{projectBuffer:g},{initializeProjection:_}]=await Promise.all([e(()=>import(`./projectBuffer-Dqm9dvVZ.js`),__vite__mapDeps([0,1,2])),e(()=>import(`./projectionUtils-BRmf8NVJ.js`),__vite__mapDeps([3,1,2]))]);await _(d,f);let v=[0,0,0];if(!g(m,d,0,v,f,0))throw Error(`Failed to project`);if(u.type===`georeferenced`&&u.origin==null){if(h=new Float64Array(o.length),!g(o,d,0,h,f,0,h.length/3))throw Error(`Failed to project`)}else{let t=u.type===`georeferenced`?c.fromJSON(u):l.fromJSON(u),{projectMeshVertexPositions:n}=await e(async()=>{let{projectMeshVertexPositions:e}=await import(`./projectMeshVertexPositions-BzxucnQx.js`);return{projectMeshVertexPositions:e}},__vite__mapDeps([4,5,1,2,6,7,8,9,10,11,12,13,14,15])),r=n({vertexAttributes:{position:o},transform:p?{localMatrix:p}:void 0,vertexSpace:t,spatialReference:d},f);if(!r)throw Error(`Failed to project`);h=r}let y=h.length,[b,x,S]=v;for(let e=0;e<y;e+=3)h[e]-=b,h[e+1]-=x,h[e+2]-=S;return{result:{projected:h,original:o,projectedOrigin:v},transferList:[h.buffer,o.buffer]}}async function C({normalMatrix:e,normals:t}){let r=new Float32Array(t.length);return d(r,t,e),n(e)&&u(r,r),{result:{transformed:r,original:t},transferList:[r.buffer,t.buffer]}}function w(e){j(e)}var T,E;function D(e){if(!E)return;let t=e.modifications,n=E._malloc(8*t.length),r=new Float64Array(E.HEAPU8.buffer,n,t.length);for(let e=0;e<t.length;++e)r[e]=t[e];E.setModifications(e.context,n,t.length,e.isGeodetic),E._free(n)}function O(e,t,n){let{context:r,globalTrafo:i,mbs:a,obbData:o,elevationOffset:s,geometryBuffer:c,geometryDescriptor:l,indexToVertexProjector:u,vertexToRenderProjector:d}=t,f=e._malloc(c.byteLength),p=e._malloc(33*Float64Array.BYTES_PER_ELEMENT),m=new Uint8Array(e.HEAPU8.buffer,f,c.byteLength);m.set(new Uint8Array(c));let _=new Float64Array(e.HEAPU8.buffer,p,33);M(_,[NaN,NaN,NaN]);let v=_.byteOffset+3*_.BYTES_PER_ELEMENT,y=new Float64Array(_.buffer,v);M(y,i),v+=16*_.BYTES_PER_ELEMENT,y=new Float64Array(_.buffer,v),M(y,a),v+=4*_.BYTES_PER_ELEMENT,o&&(y=new Float64Array(_.buffer,v),M(y,o));let b=l,x={isDraco:!1,isLegacy:!1,color:t.layouts.some(e=>e.some(e=>e.name===`color`)),normal:t.needNormals&&t.layouts.some(e=>e.some(e=>e.name===`normalCompressed`)),uv0:t.layouts.some(e=>e.some(e=>e.name===`uv0`)),uvRegion:t.layouts.some(e=>e.some(e=>e.name===`uvRegion`)),featureIndex:b.featureIndex},S=e.process(r,!!t.obbData,f,m.byteLength,b,x,p,s,u,d,t.normalReferenceFrame);if(e._free(p),e._free(f),S.error.length>0)throw Error(`i3s.wasm: ${S.error}`);if(S.discarded)return null;let C=S.componentOffsets.length>0?S.componentOffsets.slice():null,w=S.featureIds.length>0?S.featureIds.slice():null,T=S.anchorIds.length>0?Array.from(S.anchorIds):null,E=S.anchors.length>0?Array.from(S.anchors):null,D=S.interleavedVertedData.slice().buffer,O=S.indicesType===1?new Uint16Array(S.indices.buffer,S.indices.byteOffset,S.indices.byteLength/2).slice():new Uint32Array(S.indices.buffer,S.indices.byteOffset,S.indices.byteLength/4).slice(),k=S.positions.slice(),{buffer:A,byteOffset:j,byteLength:N}=S.positionIndices,P=S.positionIndicesType===1?new Uint16Array(A,j,N/2).slice():new Uint32Array(A,j,N/4).slice(),F=new h(t.layouts[0],D,O,S.hasColors,S.hasModifications,{data:k,indices:P});return w&&n.push(w.buffer),C&&n.push(C.buffer),n.push(D),n.push(O.buffer),n.push(k.buffer),n.push(P.buffer),new g(C,w,T,E,F,i,S.obb)}function k(e){return e===0?0:e===1?1:e===2?2:3}function A(e){if(!E)return;let{context:t,buffer:n}=e,r=E._malloc(n.byteLength),i=n.byteLength/Float64Array.BYTES_PER_ELEMENT,a=new Float64Array(E.HEAPU8.buffer,r,i),o=new Float64Array(n);a.set(o),E.filterOBBs(t,r,i),o.set(a),E._free(r)}function j(e){E&&E.destroy(e)===0&&(E=null,T=null,p())}function M(e,t){for(let n=0;n<t.length;++n)e[n]=t[n]}async function N(){E||await P()}async function P(){return E||=await(T??=f()),E}var F={transform:(e,t)=>E&&O(E,e,t),destroy:j};export{w as destroyContext,v as dracoDecompressPointCloudData,y as filterObbsForModifications,A as filterObbsForModificationsSync,N as initialize,k as interpretObbModificationResults,_ as process,S as project,x as setLegacySchema,b as setModifications,D as setModificationsSync,F as test,C as transformNormals};