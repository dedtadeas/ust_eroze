import{AE as e,Bx as t,CD as n,Dw as r,Gi as i,Hb as a,Hx as o,IS as s,Id as c,J as l,KT as u,Kb as d,LT as f,MC as p,Mb as m,Q as h,Qw as g,RC as _,SC as v,Sw as y,Sx as b,TE as x,Ux as S,Uy as C,Vb as w,WT as T,X as E,Z as D,_E as ee,aC as te,ao as ne,dx as O,eE as k,fE as A,gp as j,kC as re,ka as ie,km as ae,nD as M,oC as N,oo as oe,rt as se,ta as ce,ux as le,wa as ue,yC as de,zC as fe,zb as pe}from"./index-BqmCqmfp.js";import{n as me}from"./imageBitmapUtils-B6x9ZCyg.js";import{t as P}from"./crsUtils-rYVz-Fwk.js";import{t as F}from"./ExportWMSImageParameters-DDuJmo5d.js";var I,he=0,L=I=class extends pe(oe){constructor(e){super(e),this.description=null,this.dimensions=null,this.fullExtent=null,this.fullExtents=null,this.legendUrl=null,this.legendEnabled=!0,this.layer=null,this.maxScale=0,this.minScale=0,this.name=null,this.parent=null,this.popupEnabled=!1,this.queryable=!1,this.sublayers=null,this.spatialReferences=null,this.title=null,this.addHandles([a(()=>this.sublayers,`after-add`,({item:e})=>{e.parent=this,e.layer=this.layer},w),a(()=>this.sublayers,`after-remove`,({item:e})=>{e.layer=e.parent=null},w),d(()=>this.sublayers,(e,t)=>{if(t)for(let e of t)e.layer=e.parent=null;if(e)for(let t of e)t.parent=this,t.layer=this.layer},w),d(()=>this.layer,e=>{if(this.sublayers)for(let t of this.sublayers)t.layer=e},w)])}get id(){return this._get(`id`)??he++}set id(e){this._set(`id`,e)}readLegendUrl(e,t){return t.legendUrl??t.legendURL??null}get effectiveScaleRange(){let{minScale:e,maxScale:t}=this;return{minScale:e,maxScale:t}}castSublayers(e){return _(v.ofType(I),e)}set visible(e){this._setAndNotifyLayer(`visible`,e)}clone(){let e=new I;return this.hasOwnProperty(`description`)&&(e.description=this.description),this.hasOwnProperty(`fullExtent`)&&(e.fullExtent=this.fullExtent.clone()),this.hasOwnProperty(`fullExtents`)&&(e.fullExtents=this.fullExtents?.map(e=>e.clone())??null),this.hasOwnProperty(`legendUrl`)&&(e.legendUrl=this.legendUrl),this.hasOwnProperty(`legendEnabled`)&&(e.legendEnabled=this.legendEnabled),this.hasOwnProperty(`layer`)&&(e.layer=this.layer),this.hasOwnProperty(`name`)&&(e.name=this.name),this.hasOwnProperty(`parent`)&&(e.parent=this.parent),this.hasOwnProperty(`queryable`)&&(e.queryable=this.queryable),this.hasOwnProperty(`sublayers`)&&(e.sublayers=this.sublayers?.map(e=>e.clone())),this.hasOwnProperty(`spatialReferences`)&&(e.spatialReferences=this.spatialReferences?.map(e=>e)),this.hasOwnProperty(`visible`)&&(e.visible=this.visible),this.hasOwnProperty(`title`)&&(e.title=this.title),e}_setAndNotifyLayer(e,t){let n=this.layer;this._get(e)!==t&&(this._set(e,t),n&&n.emit(`wms-sublayer-update`,{propertyName:e,id:this.id}))}};n([p()],L.prototype,`description`,void 0),n([p({readOnly:!0})],L.prototype,`dimensions`,void 0),n([p({type:b,json:{name:`extent`}})],L.prototype,`fullExtent`,void 0),n([p()],L.prototype,`fullExtents`,void 0),n([p({type:Number,json:{write:{enabled:!1,overridePolicy:()=>({ignoreOrigin:!0,enabled:!0})}}})],L.prototype,`id`,null),n([p({type:String,json:{name:`legendUrl`,write:{ignoreOrigin:!0}}})],L.prototype,`legendUrl`,void 0),n([o(`legendUrl`,[`legendUrl`,`legendURL`])],L.prototype,`readLegendUrl`,null),n([p({type:Boolean,json:{name:`showLegend`,origins:{"web-map":{read:!1,write:!1},"web-scene":{read:!1,write:!1}}}})],L.prototype,`legendEnabled`,void 0),n([p()],L.prototype,`layer`,void 0),n([p()],L.prototype,`maxScale`,void 0),n([p()],L.prototype,`minScale`,void 0),n([p({readOnly:!0})],L.prototype,`effectiveScaleRange`,null),n([p({type:String,json:{write:{ignoreOrigin:!0}}})],L.prototype,`name`,void 0),n([p()],L.prototype,`parent`,void 0),n([p({type:Boolean,json:{read:{source:`showPopup`},write:{ignoreOrigin:!0,target:`showPopup`}}})],L.prototype,`popupEnabled`,void 0),n([p({type:Boolean,json:{write:{ignoreOrigin:!0}}})],L.prototype,`queryable`,void 0),n([p()],L.prototype,`sublayers`,void 0),n([t(`sublayers`)],L.prototype,`castSublayers`,null),n([p({type:[Number],json:{read:{source:`spatialReferences`}}})],L.prototype,`spatialReferences`,void 0),n([p({type:String,json:{write:{ignoreOrigin:!0}}})],L.prototype,`title`,void 0),n([p({type:Boolean,value:!0,json:{read:{source:`defaultVisibility`}}})],L.prototype,`visible`,null),L=I=n([re(`esri.layers.support.WMSSublayer`)],L);var R={84:4326,83:4269,27:4267};function ge(e){if(!e)return null;let t={idCounter:-1};typeof e==`string`&&(e=new DOMParser().parseFromString(e,`text/xml`));let n=e.documentElement;if(n.nodeName===`ServiceExceptionReport`){let e=Array.prototype.slice.call(n.childNodes).map(e=>e.textContent).join(`\r
`);throw new ee(`wmslayer:wms-capabilities-xml-is-not-valid`,`The server returned errors when the WMS capabilities were requested.`,e)}let r=H(`Capability`,n),i=H(`Service`,n),a=r&&H(`Request`,r);if(!r||!i||!a)return null;let o=H(`Layer`,r);if(!o)return null;let s=n.nodeName===`WMS_Capabilities`||n.nodeName===`WMT_MS_Capabilities`?n.getAttribute(`version`):`1.3.0`,c=W(`Title`,i,``)||W(`Name`,i,``),l=W(`AccessConstraints`,i,``),u=/^none$/i.test(l)?``:l,d=W(`Abstract`,i,``),f=parseInt(W(`MaxWidth`,i,`5000`),10),p=parseInt(W(`MaxHeight`,i,`5000`),10),m=be(a,`GetMap`),h=ye(a,`GetMap`),g=K(o,s,t);if(!g)return null;let _,v=0,y=Array.prototype.slice.call(r.childNodes),b=g.sublayers??[],x=e=>{e!=null&&b.push(e)};y.forEach(e=>{e.nodeName===`Layer`&&(v===0?_=e:(v===1&&g.name&&(g.name=``,x(K(_,s,t))),x(K(e,s,t))),v++)});let S=g.sublayers??[],C=g.fullExtents??[];S.length===0&&S.push(g),g.extent??=S[0].extent;let w=g.spatialReferences.length>0?g.spatialReferences:z(g),T=ye(a,`GetFeatureInfo`),E=T?be(a,`GetFeatureInfo`):null,D=B(S),te=g.minScale||0,ne=g.maxScale||0,O=g.dimensions??[],k=D.reduce((e,t)=>e.concat(t.dimensions??[]),[]),A=O.concat(k).filter(Te),j=null;if(A.length){let{start:e,end:t}=A.map(e=>{let{extent:t}=e;return Se(t)?t.map(e=>e.getTime()):t?.map(e=>[e.min.getTime(),e.max.getTime()])}).flat(2).filter(M).reduce((e,t)=>({start:Math.min(e.start,t),end:Math.max(e.end,t)}),{start:1/0,end:-1/0});j={startTimeField:null,endTimeField:null,trackIdField:void 0,timeExtent:[e,t]}}return{copyright:u,description:d,dimensions:O,extent:g.extent,fullExtents:C,featureInfoFormats:E,featureInfoUrl:T,mapUrl:h,maxWidth:f,maxHeight:p,maxScale:ne,minScale:te,layers:D,spatialReferences:w,supportedImageFormatTypes:m,timeInfo:j,title:c,version:s}}function _e(e){let t=e.filter(e=>e.popupEnabled&&e.name&&e.queryable);return t.length?t.map(({name:e})=>e).join():null}function z(e){if(e.spatialReferences.length>0)return e.spatialReferences;if(e.sublayers)for(let t of e.sublayers){let e=z(t);if(e.length>0)return e}return[]}function B(e){let t=[];for(let n of e)t.push(n),n.sublayers?.length&&(t=t.concat(B(n.sublayers)),delete n.sublayers);return t}function V(e,t,n){return t.getAttribute(e)??n}function ve(e,t,n,r){let i=H(e,n);return i?V(t,i,r):r}function H(e,t){for(let n=0;n<t.childNodes.length;n++){let r=t.childNodes[n];if(Ce(r)&&r.nodeName===e)return r}return null}function U(e,t){if(t==null)return[];let n=[];for(let r=0;r<t.childNodes.length;r++){let i=t.childNodes[r];Ce(i)&&i.nodeName===e&&n.push(i)}return n}function W(e,t,n){return H(e,t)?.textContent??n}function G(e,t,n){let r=parseFloat(e.getAttribute(`minx`)??`0`),i=parseFloat(e.getAttribute(`miny`)??`0`),a=parseFloat(e.getAttribute(`maxx`)??`0`),o=parseFloat(e.getAttribute(`maxy`)??`0`);return{xmin:n?isNaN(i)?-Number.MAX_VALUE:i:isNaN(r)?-Number.MAX_VALUE:r,ymin:n?isNaN(r)?-Number.MAX_VALUE:r:isNaN(i)?-Number.MAX_VALUE:i,xmax:n?isNaN(o)?Number.MAX_VALUE:o:isNaN(a)?Number.MAX_VALUE:a,ymax:n?isNaN(a)?Number.MAX_VALUE:a:isNaN(o)?Number.MAX_VALUE:o,spatialReference:{wkid:t}}}function ye(e,t){let n=H(t,e);if(n){let e=H(`DCPType`,n);if(e){let t=H(`HTTP`,e);if(t){let e=H(`Get`,t);if(e){let t=ve(`OnlineResource`,`xlink:href`,e,null);if(t){let e=t.indexOf(`&`);return e!==-1&&e===t.length-1&&(t=t.slice(0,-1)),Ee(t,[`service`,`request`])}}}}}return null}function be(e,t){let n=U(`Operation`,e);if(!n.length)return U(`Format`,H(t,e)).map(({textContent:e})=>e).filter(M);let r=[];for(let e of n)if(e.getAttribute(`name`)===t){let t=U(`Format`,e);for(let{textContent:e}of t)e!=null&&r.push(e)}return r}function xe(e,t,n){let r=H(t,e);if(!r)return n;let{textContent:i}=r;if(i==null||i===``)return n;let a=Number(i);return isNaN(a)?n:a}function K(e,t,n){if(!e)return null;let r=e.getAttribute(`queryable`)?.toLowerCase(),i=r===`1`||r===`true`,a={id:n.idCounter++,fullExtents:[],parentLayerId:null,queryable:i,spatialReferences:[],sublayers:null},o=H(`LatLonBoundingBox`,e),s=H(`EX_GeographicBoundingBox`,e),c=o?G(o,4326):s?{xmin:parseFloat(W(`westBoundLongitude`,s,`0`)),ymin:parseFloat(W(`southBoundLatitude`,s,`0`)),xmax:parseFloat(W(`eastBoundLongitude`,s,`0`)),ymax:parseFloat(W(`northBoundLatitude`,s,`0`)),spatialReference:{wkid:4326}}:{xmin:-180,ymin:-90,xmax:180,ymax:90,spatialReference:{wkid:4326}};a.minScale=xe(e,`MaxScaleDenominator`,0),a.maxScale=xe(e,`MinScaleDenominator`,0);let l=[`1.0.0`,`1.1.0`,`1.1.1`].includes(t)?`SRS`:`CRS`;return Array.prototype.slice.call(e.childNodes).forEach(e=>{if(e.nodeName===`Name`)a.name=e.textContent||``;else if(e.nodeName===`Title`)a.title=e.textContent||``;else if(e.nodeName===`Abstract`)a.description=e.textContent||``;else if(e.nodeName===`BoundingBox`){let n=e.getAttribute(l),r=n?.indexOf(`:`);if(r&&r>-1){let i=parseInt(n.slice(r+1),10);i===0||isNaN(i)||(i=R[i]??i);let o=t===`1.3.0`?G(e,i,P(i)):G(e,i);o&&a.fullExtents&&a.fullExtents.push(o)}}else if(e.nodeName===l)(e.textContent?.split(` `)??[]).forEach(e=>{let t=NaN;if(e.includes(`:`)){let[n,r]=e.toUpperCase().split(`:`);n!==`CRS`&&n!==`EPSG`||(t=parseInt(r,10))}else t=parseInt(e,10);if(t!==0&&!isNaN(t)){let e=R[t]??t;a.spatialReferences.includes(e)||a.spatialReferences.push(e)}});else if(e.nodeName!==`Style`||a.legendUrl){if(e.nodeName===`Layer`){let r=K(e,t,n);r&&(r.parentLayerId=a.id,a.sublayers||=[],a.sublayers.push(r))}}else{let t=H(`LegendURL`,e);if(t){let e=H(`OnlineResource`,t);e&&(a.legendUrl=e.getAttribute(`xlink:href`))}}}),a.extent=c,a.dimensions=U(`Dimension`,e).filter(e=>e.getAttribute(`name`)&&e.getAttribute(`units`)&&e.textContent).map(e=>{let t=e.getAttribute(`name`),n=e.getAttribute(`units`),r=e.textContent,i=e.getAttribute(`unitSymbol`)??void 0,a=e.getAttribute(`default`)??void 0,o=V(`default`,e,`0`)!==`0`,s=V(`nearestValue`,e,`0`)!==`0`,c=V(`current`,e,`0`)!==`0`;return Te({name:t,units:n})?{name:`time`,units:`ISO8601`,extent:ke(r),default:ke(a),multipleValues:o,nearestValue:s,current:c}:we({name:t,units:n})?{name:`elevation`,units:n,extent:De(r),unitSymbol:i,default:De(a),multipleValues:o,nearestValue:s}:{name:t,units:n,extent:Oe(r),unitSymbol:i,default:Oe(a),multipleValues:o,nearestValue:s}}),a}function Se(e){return Array.isArray(e)&&e.length>0&&e[0]instanceof Date}function Ce(e){return e.nodeType===Node.ELEMENT_NODE}function we(e){return/^elevation$/i.test(e.name)&&/^(epsg|crs):\d+$/i.test(e.units)}function Te(e){return/^time$/i.test(e.name)&&/^iso8601$/i.test(e.units)}function Ee(e,t){let n=[],r=T(e);for(let e in r.query)r.query.hasOwnProperty(e)&&(t.includes(e.toLowerCase())||n.push(e+`=`+r.query[e]));return r.path+(n.length?`?`+n.join(`&`):``)}function De(e){if(!e)return;let t=e.includes(`/`),n=e.split(`,`);return t?n.map(e=>{let t=e.split(`/`);return t.length<2?null:{min:parseFloat(t[0]),max:parseFloat(t[1]),resolution:t.length>=3&&t[2]!==`0`?parseFloat(t[2]):void 0}}).filter(M):n.map(e=>parseFloat(e))}function Oe(e){if(!e)return;let t=e.includes(`/`),n=e.split(`,`);return t?n.map(e=>{let t=e.split(`/`);return t.length<2?null:{min:t[0],max:t[1],resolution:t.length>=3&&t[2]!==`0`?t[2]:void 0}}).filter(M):n}function ke(e){if(!e)return;let t=e.includes(`/`),n=e.split(`,`);return t?n.map(e=>{let t=e.split(`/`);return t.length<2?null:{min:q(t[0]),max:q(t[1]),resolution:t.length>=3&&t[2]!==`0`?Ae(t[2]):void 0}}).filter(M):n.map(e=>q(e))}function q(e){return le.fromISO(e,{zone:O.utcInstance}).toJSDate()}function Ae(e){let t=e.match(/(?:p(\d+y|\d+(?:\.|,)\d+y)?(\d+m|\d+(?:\.|,)\d+m)?(\d+d|\d+(?:\.|,)\d+d)?)?(?:t(\d+h|\d+(?:\.|,)\d+h)?(\d+m|\d+(?:\.|,)\d+m)?(\d+s|\d+(?:\.|,)\d+s)?)?/i);return t?{years:J(t[1]),months:J(t[2]),days:J(t[3]),hours:J(t[4]),minutes:J(t[5]),seconds:J(t[6])}:null}function J(e){if(!e)return 0;let t=e.match(/(?:\d+(?:\.|,)\d+|\d+)/);if(!t)return 0;let n=t[0].replace(`,`,`.`);return Number(n)}function Y(e){return e.toISOString().replace(/\.[0-9]{3}/,``)}var je=`0000-01-01T00:00:00Z`,Me=`9999-12-31T23:59:59Z`;function Ne(e){if(!e||e.isAllTime||e.isEmpty)return;let{start:t,end:n}=e;return t&&n&&t.getTime()===n.getTime()?`${Y(t)}`:`${t?Y(t):je}/${n?Y(n):Me}`}var X=new Set([102100,3857,102113,900913]),Pe=new Set([3395,54004]);function Fe(e,t){let n=e.wkid;return t==null?n:(n!=null&&t.includes(n)||!e.latestWkid||(n=e.latestWkid),n!=null&&X.has(n)?t.find(e=>X.has(e))||t.find(e=>Pe.has(e))||102100:n)}var Z=new te({bmp:`image/bmp`,gif:`image/gif`,jpg:`image/jpeg`,png:`image/png`,svg:`image/svg+xml`},{ignoreUnknown:!1});function Ie(e){return e===`text/html`}function Le(e){return e===`text/plain`}var Q=class extends ie(l(D(E(se(h(ne(m))))))){constructor(...e){super(...e),this.allSublayers=new C({getCollections:()=>[this.sublayers],getChildrenFunction:e=>e.sublayers}),this.customParameters=null,this.customLayerParameters=null,this.copyright=null,this.description=null,this.dimensions=null,this.fullExtent=null,this.fullExtents=null,this.featureInfoFormats=null,this.featureInfoUrl=null,this.fetchFeatureInfoFunction=null,this.imageFormat=null,this.imageMaxHeight=2048,this.imageMaxWidth=2048,this.imageTransparency=!0,this.legendEnabled=!0,this.mapUrl=null,this.isReference=null,this.operationalLayerType=`WMS`,this.spatialReference=null,this.spatialReferences=null,this.sublayers=null,this.type=`wms`,this.version=null,this.addHandles([a(()=>this.sublayers,`after-add`,({item:e})=>{e.parent=e.layer=this},w),a(()=>this.sublayers,`after-remove`,({item:e})=>{e.layer=e.parent=null},w),d(()=>this.sublayers,(e,t)=>{if(t)for(let e of t)e.layer=e.parent=null;if(e)for(let t of e)t.parent=t.layer=this},w)])}normalizeCtorArgs(e,t){return typeof e==`string`?{url:e,...t}:e}destroy(){this.allSublayers.destroy()}load(e){let t=e==null?null:e.signal;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:[`WMS`]},e).catch(g).then(()=>this._fetchService(t)).then(()=>this._checkLayerValidity())),Promise.resolve(this)}set timeInfo(e){super.timeInfo=e}readFullExtentFromItemOrMap(e,t){let n=t.extent;return n?new b({xmin:n[0][0],ymin:n[0][1],xmax:n[1][0],ymax:n[1][1]}):null}writeFullExtent(e,t){t.extent=[[e.xmin,e.ymin],[e.xmax,e.ymax]]}get featureInfoFormat(){return this.featureInfoFormats==null?null:this.featureInfoFormats.find(Ie)??this.featureInfoFormats.find(Le)??null}set featureInfoFormat(e){e==null?(this.revert(`featureInfoFormat`,`service`),this._clearOverride(`featureInfoFormat`)):(Ie(e)||Le(e))&&this._override(`featureInfoFormat`,e)}readImageFormat(e,t){let n=t.supportedImageFormatTypes;return n&&n.includes(`image/png`)?`image/png`:n&&n[0]}readSpatialReferenceFromItemOrDocument(e,t){return new S(t.spatialReferences[0])}writeSpatialReferences(e,t){let n=this.spatialReference?.wkid;e&&n?(t.spatialReferences=e.filter(e=>e!==n),t.spatialReferences.unshift(n)):t.spatialReferences=e}readSublayersFromItemOrMap(e,t,n){return $(t.layers,n,t.visibleLayers)}readSublayers(e,t,n){return $(t.layers,n)}writeSublayers(e,t,n,r){t.layers=[];let i=new Map,a=e.flatten(({sublayers:e})=>e??[]);for(let e of a)if(typeof e.parent?.id==`number`){let t=i.get(e.parent.id);t==null?i.set(e.parent.id,[e.id]):t.push(e.id)}for(let e of a){let n={sublayer:e,...r},a=e.write({parentLayerId:typeof e.parent?.id==`number`?e.parent.id:-1},n);if(i.has(e.id)&&(a.sublayerIds=i.get(e.id)),!e.sublayers&&e.name){let r=e.write({},n);delete r.id,t.layers.push(r)}}t.visibleLayers=a.filter(({visible:e,sublayers:t})=>e&&!t).map(({name:e})=>e).toArray()}set url(e){if(!e)return void this._set(`url`,e);let{path:t,query:n}=T(e);for(let e in n)/^(request|service)$/i.test(e)&&delete n[e];let r=f(t,n??{});this._set(`url`,r)}createExportImageParameters(e,t,n,r){let i=r?.pixelRatio??1,a=ue({extent:e,width:t})*i,o=new F({layer:this,scale:a}),{xmin:s,ymin:c,xmax:l,ymax:u,spatialReference:d}=e,f=Fe(d,this.spatialReferences),p=this.version===`1.3.0`&&P(f)?`${c},${s},${u},${l}`:`${s},${c},${l},${u}`,m=o.toJSON(),h=this.version===`1.3.0`?`crs`:`srs`;return{bbox:p,[h]:f==null||isNaN(f)?void 0:`EPSG:`+f,...m}}async fetchImage(e,t,n,r){let i=this.mapUrl,a=this.createExportImageParameters(e,t,n,r);if(!a.layers){let e=document.createElement(`canvas`);return e.width=t,e.height=n,e}let o=Ne(r?.timeExtent),s={responseType:`image`,query:this._mixCustomParameters({width:t,height:n,...a,time:o,...this.refreshParameters}),signal:r?.signal};return y(i??``,s).then(e=>e.data)}async fetchImageBitmap(e,t,n,r){let i=this.mapUrl??``,a=this.createExportImageParameters(e,t,n,r);if(!a.layers){let e=document.createElement(`canvas`);return e.width=t,e.height=n,e}let o=Ne(r?.timeExtent),s={responseType:`blob`,query:this._mixCustomParameters({width:t,height:n,...a,time:o,...this.refreshParameters}),signal:r?.signal},{data:c}=await y(i,s);return me(c,i,r?.signal)}fetchFeatureInfo(e,t,n,r,i){let a=ue({extent:e,width:t}),o=new F({layer:this,scale:a}),s=_e(o.visibleSublayers);if(this.featureInfoUrl==null||s==null||this.fetchFeatureInfoFunction==null&&this.featureInfoFormat==null)return Promise.resolve([]);let c=this.version===`1.3.0`?{I:r,J:i}:{x:r,y:i},l={query_layers:s,request:`GetFeatureInfo`,info_format:this.featureInfoFormat,feature_count:25,width:t,height:n,...c},u={...this.createExportImageParameters(e,t,n),...l},d=this._mixCustomParameters(u);return this.fetchFeatureInfoFunction==null?this._defaultFetchFeatureInfoFunction(f(this.featureInfoUrl,d)):this.fetchFeatureInfoFunction(d)}findSublayerById(e){return this.allSublayers.find(t=>t.id===e)}findSublayerByName(e){return this.allSublayers.find(t=>t.name===e)}serviceSupportsSpatialReference(e){return r(this.url)||this.spatialReferences!=null&&this.spatialReferences.some(t=>{let n=t===900913?S.WebMercator:new S({wkid:t});return s(n,e)})}_defaultFetchFeatureInfoFunction(e){let t=document.createElement(`iframe`);t.src=u(ae.sanitizeUrl(k(e))),t.style.border=`none`,t.style.margin=`0`,t.style.width=`100%`,t.setAttribute(`sandbox`,``);let n=new j({title:this.title,content:t}),r=new c({sourceLayer:this,popupTemplate:n});return Promise.resolve([r])}async _fetchService(e){if(!this.resourceInfo&&this.parsedUrl?.path){let{path:t,query:n}=this.parsedUrl,{data:r}=await y(t,{query:{SERVICE:`WMS`,REQUEST:`GetCapabilities`,...n,...this.customParameters},responseType:`xml`,signal:e});this.resourceInfo=ge(r)}if(this.parsedUrl){let e=new A(this.parsedUrl.path),{httpsDomains:t}=x.request;e.scheme!==`https`||e.port&&e.port!==`443`||!e.host||t.includes(e.host)||t.push(e.host)}this.read(this.resourceInfo,{origin:`service`})}_checkLayerValidity(){if(!this.allSublayers.length)throw new ee(`wmslayer:empty-layer`,`The layer doesn't have any sublayer`)}_mixCustomParameters(e){if(!this.customLayerParameters&&!this.customParameters)return e;let t={...this.customParameters,...this.customLayerParameters};for(let n in t)e[n.toLowerCase()]=t[n];return e}};function Re(e,t){return e.some(e=>{for(let n in e)if(de(e,n,null,t))return!0;return!1})}function $(t,n,r){t??=[];let i=new Map;t.every(e=>e.id==null)&&(t=e(t)).forEach((e,t)=>e.id=t);for(let e of t){let t=new L;t.read(e,n),r&&!r.includes(t.name)&&(t.visible=!1),i.set(t.id,t)}let a=[];for(let e of t){let t=e.id==null?null:i.get(e.id);if(t)if(e.parentLayerId!=null&&e.parentLayerId>=0){let n=i.get(e.parentLayerId);if(!n)continue;n.sublayers||=new v,n.sublayers.push(t)}else a.push(t)}return a}n([p({readOnly:!0})],Q.prototype,`allSublayers`,void 0),n([p({json:{type:Object,write:!0}})],Q.prototype,`customParameters`,void 0),n([p({json:{type:Object,write:!0}})],Q.prototype,`customLayerParameters`,void 0),n([p({type:String,json:{write:!0}})],Q.prototype,`copyright`,void 0),n([p()],Q.prototype,`description`,void 0),n([p({readOnly:!0})],Q.prototype,`dimensions`,void 0),n([p({json:{type:[[Number]],read:{source:`extent`},write:{target:`extent`},origins:{"web-document":{write:{ignoreOrigin:!0}},"portal-item":{write:{ignoreOrigin:!0}}}}})],Q.prototype,`fullExtent`,void 0),n([o([`web-document`,`portal-item`],`fullExtent`,[`extent`])],Q.prototype,`readFullExtentFromItemOrMap`,null),n([N([`web-document`,`portal-item`],`fullExtent`,{extent:{type:[[Number]]}})],Q.prototype,`writeFullExtent`,null),n([p({type:[b]})],Q.prototype,`fullExtents`,void 0),n([p({type:String,json:{write:{ignoreOrigin:!0}}})],Q.prototype,`featureInfoFormat`,null),n([p({type:[String],readOnly:!0})],Q.prototype,`featureInfoFormats`,void 0),n([p({type:String,json:{write:{ignoreOrigin:!0}}})],Q.prototype,`featureInfoUrl`,void 0),n([p()],Q.prototype,`fetchFeatureInfoFunction`,void 0),n([p({type:String,json:{origins:{"web-document":{default:`image/png`,type:Z.jsonValues,read:{reader:Z.read,source:`format`},write:{writer:Z.write,target:`format`}}}}})],Q.prototype,`imageFormat`,void 0),n([o(`imageFormat`,[`supportedImageFormatTypes`])],Q.prototype,`readImageFormat`,null),n([p({type:Number,json:{read:{source:`maxHeight`},write:{target:`maxHeight`}}})],Q.prototype,`imageMaxHeight`,void 0),n([p({type:Number,json:{read:{source:`maxWidth`},write:{target:`maxWidth`}}})],Q.prototype,`imageMaxWidth`,void 0),n([p()],Q.prototype,`imageTransparency`,void 0),n([p(i)],Q.prototype,`legendEnabled`,void 0),n([p({type:[`show`,`hide`,`hide-children`]})],Q.prototype,`listMode`,void 0),n([p({type:String,json:{write:{ignoreOrigin:!0}}})],Q.prototype,`mapUrl`,void 0),n([p({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],Q.prototype,`isReference`,void 0),n([p({type:[`WMS`]})],Q.prototype,`operationalLayerType`,void 0),n([p()],Q.prototype,`resourceInfo`,void 0),n([p({type:S,json:{origins:{service:{read:{source:`extent.spatialReference`}}},write:!1}})],Q.prototype,`spatialReference`,void 0),n([o([`web-document`,`portal-item`],`spatialReference`,[`spatialReferences`])],Q.prototype,`readSpatialReferenceFromItemOrDocument`,null),n([p({type:[fe],json:{read:!1,origins:{service:{read:!0},"web-document":{read:!1,write:{ignoreOrigin:!0}},"portal-item":{read:!1,write:{ignoreOrigin:!0}}}}})],Q.prototype,`spatialReferences`,void 0),n([N([`web-document`,`portal-item`],`spatialReferences`)],Q.prototype,`writeSpatialReferences`,null),n([p({type:v.ofType(L),json:{write:{target:`layers`,overridePolicy(e,t,n){if(Re(this.allSublayers,n))return{ignoreOrigin:!0}}}}})],Q.prototype,`sublayers`,void 0),n([o([`web-document`,`portal-item`],`sublayers`,[`layers`,`visibleLayers`])],Q.prototype,`readSublayersFromItemOrMap`,null),n([o(`service`,`sublayers`,[`layers`])],Q.prototype,`readSublayers`,null),n([N(`sublayers`,{layers:{type:[L]},visibleLayers:{type:[String]}})],Q.prototype,`writeSublayers`,null),n([p({json:{read:!1},readOnly:!0,value:`wms`})],Q.prototype,`type`,void 0),n([p(ce)],Q.prototype,`url`,null),n([p({type:String,json:{write:{ignoreOrigin:!0}}})],Q.prototype,`version`,void 0),Q=n([re(`esri.layers.WMSLayer`)],Q);var ze=Q;export{ze as default};