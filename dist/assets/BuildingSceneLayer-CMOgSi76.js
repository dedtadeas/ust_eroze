import{AE as e,Ar as t,Bp as n,CD as r,Cd as i,Ea as a,Gb as ee,Gi as te,Hx as o,Hy as s,I as c,Id as ne,Iy as re,Ji as ie,Ki as ae,L as oe,La as se,MC as l,Ma as ce,Mb as le,Na as ue,Q as de,Qw as fe,Ra as pe,SC as u,Sw as me,Sx as he,U as ge,Un as _e,Ux as ve,Uy as ye,Wi as d,X as be,XT as xe,Yi as Se,_E as f,aC as Ce,ao as we,cC as Te,fp as Ee,gC as p,gp as De,hp as Oe,jC as ke,kC as m,mC as h,mm as Ae,oo as je,ra as Me,rt as Ne,sC as Pe,sT as Fe,sp as Ie,ut as Le,vC as g,vE as _,yT as Re,zC as ze,zb as Be}from"./index-BqmCqmfp.js";import"./quatf64-CJzmL3cc.js";import"./quat-Bk_ZaVz9.js";import"./vectorStacks-CKtslZxP.js";import"./plane-CTjDePZl.js";import"./projectPointToVector-Clou1sfo.js";import"./computeTranslationToOriginAndRotation-BC3OuSky.js";import"./spatialReferenceEllipsoidUtils-DBtdxVkA.js";import{n as Ve}from"./capabilities-Bfip05kH.js";import{n as He,r as Ue}from"./SceneService-D87lJ-9p.js";import{i as We,n as Ge,r as Ke,t as qe}from"./I3SLayerDefinitions-CBsRawSe.js";import"./dehydratedPoint-Dwb3orme.js";import"./projectVectorToVector-D-Bbb8fP.js";import"./sphere-CicnK0Bn.js";import"./featurePopupQueryUtils-D4olkuib.js";import"./I3SBinaryReader-BEyu-d1C.js";import{t as Je}from"./I3SUtil-B0pnWJld.js";import"./symbolColorUtils-BNtTwJ67.js";import"./orientedBoundingBox-DZQLHGx0.js";import"./Emissions.glsl-DaTtsIIp.js";import"./glsl-C2sn87h0.js";import"./Uniform-DXwqrKA1.js";import"./Float3DrawUniform-UsZpj3mh.js";import"./Float3PassUniform-Co8OqiAU.js";import"./FloatPassUniform-BEwJjV4q.js";import"./Texture2DDrawUniform-hiIQoiSn.js";import"./Texture2DPassUniform-Cd7cdF1a.js";import"./NoParameters-CpAItLvD.js";import"./layerViewUtils-Bbe7IKvz.js";import{n as Ye,t as Xe}from"./popupUtils-h58HBZOO.js";import"./originUtils-Xpg5-Q2D.js";import"./resourceUtils-CEABprin.js";import"./resourceUtils-Dtqy_ILo.js";import"./saveUtils-DsVVlvmj.js";import{t as Ze}from"./associatedFeatureServiceUtils-C1iuzbPQ.js";import{a as Qe,p as v,y as $e}from"./elevationInfoUtils-Df_uYU_q.js";var et=Symbol(`isBuildingGraphicOrigin`),y,tt=class extends se{get[(y=et,Ee)](){return this.sublayer}get[Oe](){return this.sublayer}get[pe](){return this.sublayer}constructor(e){super(),this[y]=!0,this.type=`building`,this.sublayer=e}get layer(){return this.sublayer.layer}get id(){return`${this.layer.id}:__${this.sublayer.id}__`}},b=class extends Be(je){constructor(e){super(e),this.title=``,this.id=-1,this.modelName=null,this.isEmpty=null,this.legendEnabled=!0,this.visible=!0,this.opacity=1}readTitle(e,t){return typeof t.alias==`string`?t.alias:typeof t.name==`string`?t.name:``}readIdOnlyOnce(e){return this.id===-1?typeof e==`number`?e:-1:this.id}};r([l({type:String,json:{origins:{"web-scene":{write:!0},"portal-item":{write:!0}}}})],b.prototype,`title`,void 0),r([o(`service`,`title`,[`alias`,`name`])],b.prototype,`readTitle`,null),r([l()],b.prototype,`layer`,void 0),r([l({type:ze,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,isRequired:!0}}})],b.prototype,`id`,void 0),r([o(`service`,`id`)],b.prototype,`readIdOnlyOnce`,null),r([l(d(String))],b.prototype,`modelName`,void 0),r([l(d(Boolean))],b.prototype,`isEmpty`,void 0),r([l({type:Boolean,nonNullable:!0})],b.prototype,`legendEnabled`,void 0),r([l({type:Boolean,json:{name:`visibility`,write:!0}})],b.prototype,`visible`,void 0),r([l({type:Number,json:{write:!0}})],b.prototype,`opacity`,void 0),b=r([m(`esri.layers.buildingSublayers.BuildingSublayer`)],b);var x=ge(),S=class extends h(p(b)){constructor(e){super(e),this.type=`building-component`,this.nodePages=null,this.materialDefinitions=[],this.textureSetDefinitions=[],this.geometryDefinitions=[],this.indexInfo=null,this.serviceUpdateTimeStamp=null,this.store=null,this.attributeStorageInfo=[],this.fields=[],this.associatedLayer=null,this.outFields=null,this.listMode=`show`,this.renderer=null,this.definitionExpression=null,this.popupEnabled=!0,this.popupTemplate=null,this.layerType=`3d-object`}initialize(){this._set(`graphicOrigin`,new tt(this))}get parsedUrl(){return this.layer?{path:`${this.layer.parsedUrl?.path}/sublayers/${this.id}`,query:this.layer.parsedUrl?.query}:{path:``}}get fieldsIndex(){return new _e(this.fields)}readAssociatedLayer(e,t){let n=this.layer.associatedFeatureServiceItem,r=t.associatedLayerID;return n!=null&&typeof r==`number`?new c({portalItem:n,customParameters:this.customParameters,layerId:r}):null}get objectIdField(){if(this.fields!=null){for(let e of this.fields)if(e.type===`oid`)return e.name}return``}get globalIdField(){if(this.fields!=null){for(let e of this.fields)if(e.type===`global-id`)return e.name}return``}get displayField(){return this.associatedLayer==null?void 0:this.associatedLayer.displayField}get apiKey(){return this.layer.apiKey}get customParameters(){return this.layer.customParameters}get fullExtent(){return this.layer.fullExtent}get spatialReference(){return this.layer.spatialReference}get version(){return this.layer.version}get elevationInfo(){return this.layer.elevationInfo}get minScale(){return this.layer.minScale}get maxScale(){return this.layer.maxScale}get effectiveScaleRange(){return this.layer.effectiveScaleRange}get defaultPopupTemplate(){return this.createPopupTemplate()}load(e){let t=e==null?null:e.signal,n=this._fetchService(t).then(()=>{this.indexInfo=Ue(this.parsedUrl.path,this.rootNode,this.nodePages,this.customParameters,this.apiKey,_.getLogger(this),t)});return this.addResolvingPromise(n),Promise.resolve(this)}createPopupTemplate(e){return oe(this,e)}async _fetchService(e){let t=(await me(this.parsedUrl.path,{query:{f:`json`,...this.customParameters,token:this.apiKey},responseType:`json`,signal:e})).data;this.read(t,{origin:`service`,url:this.parsedUrl})}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,n){let r=this.getField(e)?.domain??null;return this.associatedLayer?t(this.associatedLayer,e,n,r):r}getFeatureType(e){return e&&this.associatedLayer!=null?this.associatedLayer.getFeatureType(e):null}get types(){return this.associatedLayer==null?[]:this.associatedLayer.types??[]}get typeIdField(){return this.associatedLayer==null?null:this.associatedLayer.typeIdField}get geometryType(){return this.layerType===`3d-object`?`mesh`:`point`}get profile(){return this.layerType===`3d-object`?`mesh-pyramids`:`points`}get capabilities(){let{query:e,operations:{supportsQuery:t},data:{supportsZ:n,supportsM:r,isVersioned:i}}=this.associatedLayer!=null&&this.associatedLayer.capabilities?this.associatedLayer.capabilities:Ve;return{query:e,operations:{supportsQuery:t},data:{supportsZ:n,supportsM:r,isVersioned:i}}}createQuery(){let e=new i;return this.geometryType!==`mesh`&&(e.returnGeometry=!0,e.returnZ=!0),e.where=this.definitionExpression||`1=1`,e.sqlFormat=`standard`,e}queryExtent(e,t){return this._getAssociatedLayerForQuery().then(n=>n.queryExtent(e||this.createQuery(),t))}queryFeatureCount(e,t){return this._getAssociatedLayerForQuery().then(n=>n.queryFeatureCount(e||this.createQuery(),t))}queryFeatures(e,t){return this._getAssociatedLayerForQuery().then(n=>n.queryFeatures(e||this.createQuery(),t)).then(e=>{if(e?.features)for(let t of e.features)t.layer=this.layer,t.sourceLayer=this,t.origin=this.graphicOrigin;return e})}async queryObjectIds(e,t){return(await(await this._getAssociatedLayerForQuery()).queryObjectIds(e||this.createQuery(),t)).filter(Ae)}async queryCachedAttributes(e,t){let r=n(this.fieldsIndex,await Ye(this,Xe(this)));return Je(this.parsedUrl.path,this.attributeStorageInfo,e,t,r,this.apiKey,this.customParameters)}async queryCachedFeature(e,t){let n=await this.queryCachedAttributes(e,[t]);if(!n||n.length===0)throw new f(`scenelayer:feature-not-in-cached-data`,`Feature not found in cached data`);return new ne({attributes:n[0],layer:this,sourceLayer:this})}getFieldUsageInfo(e){return this.fieldsIndex.has(e)?{supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1}:{supportsLabelingInfo:!1,supportsRenderer:!0,supportsPopupTemplate:!0,supportsLayerQuery:this.associatedLayer!=null}}_getAssociatedLayerForQuery(){let e=this.associatedLayer;return e!=null&&e.loaded?Promise.resolve(e):this._loadAssociatedLayerForQuery()}async _loadAssociatedLayerForQuery(){if(await this.load(),this.associatedLayer==null)throw new f(`buildingscenelayer:query-not-available`,`BuildingSceneLayer component layer queries are not available without an associated feature layer`,{layer:this});try{await this.associatedLayer.load()}catch(e){throw new f(`buildingscenelayer:query-not-available`,`BuildingSceneLayer associated feature layer could not be loaded`,{layer:this,error:e})}return this.associatedLayer}};r([l({readOnly:!0})],S.prototype,`parsedUrl`,null),r([l({type:Ke,readOnly:!0})],S.prototype,`nodePages`,void 0),r([l({type:[qe],readOnly:!0})],S.prototype,`materialDefinitions`,void 0),r([l({type:[We],readOnly:!0})],S.prototype,`textureSetDefinitions`,void 0),r([l({type:[Ge],readOnly:!0})],S.prototype,`geometryDefinitions`,void 0),r([l({readOnly:!0})],S.prototype,`serviceUpdateTimeStamp`,void 0),r([l({readOnly:!0})],S.prototype,`store`,void 0),r([l({type:String,readOnly:!0,json:{read:{source:`store.rootNode`}}})],S.prototype,`rootNode`,void 0),r([l({readOnly:!0})],S.prototype,`attributeStorageInfo`,void 0),r([l(x.fields)],S.prototype,`fields`,void 0),r([l({readOnly:!0})],S.prototype,`fieldsIndex`,null),r([l({readOnly:!0,type:c})],S.prototype,`associatedLayer`,void 0),r([o(`service`,`associatedLayer`,[`associatedLayerID`])],S.prototype,`readAssociatedLayer`,null),r([l(x.outFields)],S.prototype,`outFields`,void 0),r([l({type:String,readOnly:!0})],S.prototype,`objectIdField`,null),r([l({type:String,readOnly:!0})],S.prototype,`globalIdField`,null),r([l({readOnly:!0,type:String,json:{read:!1}})],S.prototype,`displayField`,null),r([l({readOnly:!0,type:String})],S.prototype,`apiKey`,null),r([l({readOnly:!0,type:String})],S.prototype,`customParameters`,null),r([l({readOnly:!0,type:he})],S.prototype,`fullExtent`,null),r([l({readOnly:!0,type:ve})],S.prototype,`spatialReference`,null),r([l({readOnly:!0})],S.prototype,`version`,null),r([l({readOnly:!0,type:Me})],S.prototype,`elevationInfo`,null),r([l({readOnly:!0,type:Number})],S.prototype,`minScale`,null),r([l({readOnly:!0,type:Number})],S.prototype,`maxScale`,null),r([l({readOnly:!0,type:Number})],S.prototype,`effectiveScaleRange`,null),r([l({type:[`hide`,`show`],json:{write:!0}})],S.prototype,`listMode`,void 0),r([l({types:Le,json:{origins:{service:{read:{source:`drawingInfo.renderer`}}},name:`layerDefinition.drawingInfo.renderer`,write:!0},value:null})],S.prototype,`renderer`,void 0),r([l({type:String,json:{origins:{service:{read:!1,write:!1}},name:`layerDefinition.definitionExpression`,write:{enabled:!0,allowNull:!0}}})],S.prototype,`definitionExpression`,void 0),r([l(ie)],S.prototype,`popupEnabled`,void 0),r([l({type:De,json:{read:{source:`popupInfo`},write:{target:`popupInfo`}}})],S.prototype,`popupTemplate`,void 0),r([l({readOnly:!0,type:String,json:{origins:{service:{read:{source:`store.normalReferenceFrame`}}},read:!1}})],S.prototype,`normalReferenceFrame`,void 0),r([l({readOnly:!0,json:{read:!1}})],S.prototype,`defaultPopupTemplate`,null),r([l({readOnly:!0})],S.prototype,`graphicOrigin`,void 0),r([l()],S.prototype,`types`,null),r([l()],S.prototype,`typeIdField`,null),r([l({json:{write:!1}}),s(new Ce({"3DObject":`3d-object`,Point:`point`}))],S.prototype,`layerType`,void 0),r([l()],S.prototype,`geometryType`,null),r([l()],S.prototype,`profile`,null),r([l({readOnly:!0,json:{read:!1}})],S.prototype,`capabilities`,null),r([l({readOnly:!0})],S.prototype,`statisticsInfo`,void 0),S=r([m(`esri.layers.buildingSublayers.BuildingComponentSublayer`)],S);function C(e,t){e.forEach(e=>{t(e),e.type===`building-group`&&C(e.sublayers,t)})}var w={type:u,readOnly:!0,json:{origins:{service:{read:{source:`sublayers`,reader:T}}},read:!1}};function T(e,t,n){if(e&&Array.isArray(e))return new u(e.map(e=>{let t=nt(e);if(t){let r=new t;return r.read(e,n),r}return n?.messages&&e&&n.messages.push(new ke(`building-scene-layer:unsupported-sublayer-type`,`Building scene sublayer of type '`+(e.type||`unknown`)+`' are not supported`,{definition:e,context:n})),null}))}function nt(e){return e.layerType===`group`?E:S}var E=class extends b{constructor(e){super(e),this.type=`building-group`,this.listMode=`show`,this.sublayers=null}loadAll(){return Pe(this,e=>C(this.sublayers,t=>{t.type!==`building-group`&&e(t)}))}static{this.sublayersProperty=w}static{this.readSublayers=T}};r([l({type:[`hide`,`show`,`hide-children`],json:{write:!0}})],E.prototype,`listMode`,void 0),r([l(w)],E.prototype,`sublayers`,void 0),E=r([m(`esri.layers.buildingSublayers.BuildingGroupSublayer`)],E);var D=class extends g{constructor(){super(...arguments),this.type=null}};r([l({type:String,readOnly:!0,json:{write:{isRequired:!0}}})],D.prototype,`type`,void 0),D=r([m(`esri.layers.support.BuildingFilterAuthoringInfo`)],D);var O=D,k,A=k=class extends g{constructor(){super(...arguments),this.filterType=null,this.filterValues=null}clone(){return new k({filterType:this.filterType,filterValues:e(this.filterValues)})}};r([l({type:String,json:{write:{isRequired:!0}}})],A.prototype,`filterType`,void 0),r([l({type:[String],json:{write:{isRequired:!0}}})],A.prototype,`filterValues`,void 0),A=k=r([m(`esri.layers.support.BuildingFilterAuthoringInfoType`)],A);var rt=A,j,it=u.ofType(rt),M=j=class extends g{clone(){return new j({filterTypes:e(this.filterTypes)})}};r([l({type:it,json:{write:{isRequired:!0}}})],M.prototype,`filterTypes`,void 0),M=j=r([m(`esri.layers.support.BuildingFilterAuthoringInfoBlock`)],M);var at=M,N,ot=u.ofType(at),P=N=class extends O{constructor(){super(...arguments),this.type=`checkbox`}clone(){return new N({filterBlocks:e(this.filterBlocks)})}};r([l({type:[`checkbox`]})],P.prototype,`type`,void 0),r([l({type:ot,json:{write:{isRequired:!0}}})],P.prototype,`filterBlocks`,void 0),P=N=r([m(`esri.layers.support.BuildingFilterAuthoringInfoCheckbox`)],P);var F=P,I=class extends g{};r([l({readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],I.prototype,`type`,void 0),I=r([m(`esri.layers.support.BuildingFilterMode`)],I);var L=I,R,z=R=class extends L{constructor(){super(...arguments),this.type=`solid`}clone(){return new R}};r([l({type:[`solid`],readOnly:!0,json:{write:{isRequired:!0}}})],z.prototype,`type`,void 0),z=R=r([m(`esri.layers.support.BuildingFilterModeSolid`)],z);var B=z,V,H=V=class extends L{constructor(){super(...arguments),this.type=`wire-frame`,this.edges=null}clone(){return new V({edges:e(this.edges)})}};r([s({wireFrame:`wire-frame`})],H.prototype,`type`,void 0),r([l(Ie)],H.prototype,`edges`,void 0),H=V=r([m(`esri.layers.support.BuildingFilterModeWireFrame`)],H);var st=H,U,W=U=class extends L{constructor(){super(...arguments),this.type=`x-ray`}clone(){return new U}};r([l({type:[`x-ray`],readOnly:!0,json:{write:{isRequired:!0}}})],W.prototype,`type`,void 0),W=U=r([m(`esri.layers.support.BuildingFilterModeXRay`)],W);var ct=W,G,lt={nonNullable:!0,types:{key:`type`,base:L,typeMap:{solid:B,"wire-frame":st,"x-ray":ct}},json:{read:e=>{switch(e?.type){case`solid`:return B.fromJSON(e);case`wireFrame`:return st.fromJSON(e);case`x-ray`:return ct.fromJSON(e);default:return}},write:{enabled:!0,isRequired:!0}}},K=G=class extends g{constructor(){super(...arguments),this.filterExpression=null,this.filterMode=new B,this.title=``}clone(){return new G({filterExpression:this.filterExpression,filterMode:e(this.filterMode),title:this.title})}};r([l({type:String,json:{write:{enabled:!0,isRequired:!0}}})],K.prototype,`filterExpression`,void 0),r([l(lt)],K.prototype,`filterMode`,void 0),r([l({type:String,json:{write:{enabled:!0,isRequired:!0}}})],K.prototype,`title`,void 0),K=G=r([m(`esri.layers.support.BuildingFilterBlock`)],K);var ut=K,q,dt=u.ofType(ut),J=q=class extends g{constructor(e){super(e),this.description=null,this.filterBlocks=null,this.id=re(),this.name=null}clone(){return new q({description:this.description,filterBlocks:e(this.filterBlocks),id:this.id,name:this.name,filterAuthoringInfo:e(this.filterAuthoringInfo)})}};r([l({type:String,json:{write:!0}})],J.prototype,`description`,void 0),r([l({type:dt,json:{write:{enabled:!0,isRequired:!0}}})],J.prototype,`filterBlocks`,void 0),r([l({types:{key:`type`,base:O,typeMap:{checkbox:F}},json:{read:e=>e?.type===`checkbox`?F.fromJSON(e):null,write:!0}})],J.prototype,`filterAuthoringInfo`,void 0),r([l({type:String,constructOnly:!0,json:{write:{enabled:!0,isRequired:!0}}})],J.prototype,`id`,void 0),r([l({type:String,json:{write:{enabled:!0,isRequired:!0}}})],J.prototype,`name`,void 0),J=q=r([m(`esri.layers.support.BuildingFilter`)],J);var Y=class extends g{constructor(){super(...arguments),this.fieldName=null,this.modelName=null,this.label=null,this.min=null,this.max=null,this.mostFrequentValues=null,this.subLayerIds=null}};r([l({type:String})],Y.prototype,`fieldName`,void 0),r([l({type:String})],Y.prototype,`modelName`,void 0),r([l({type:String})],Y.prototype,`label`,void 0),r([l({type:Number})],Y.prototype,`min`,void 0),r([l({type:Number})],Y.prototype,`max`,void 0),r([l({json:{read:e=>Array.isArray(e)&&(e.every(e=>typeof e==`string`)||e.every(e=>typeof e==`number`))?e.slice():null}})],Y.prototype,`mostFrequentValues`,void 0),r([l({type:[Number]})],Y.prototype,`subLayerIds`,void 0),Y=r([m(`esri.layers.support.BuildingFieldStatistics`)],Y);var ft=Y,X=class extends h(p(g)){constructor(e){super(e),this.url=null,this.customParameters=null}get fields(){return this.loaded||this.loadStatus===`loading`?this._get(`fields`):(_.getLogger(this).error(`building summary statistics are not loaded`),null)}load(e){let t=e==null?null:e.signal;return this.addResolvingPromise(this._fetchService(t)),Promise.resolve(this)}async _fetchService(e){let t=(await me(this.url,{query:{f:`json`,...this.customParameters,token:this.apiKey},responseType:`json`,signal:e})).data;this.read(t,{origin:`service`})}};r([l({constructOnly:!0,type:String})],X.prototype,`url`,void 0),r([l({constructOnly:!0})],X.prototype,`customParameters`,void 0),r([l({constructOnly:!0})],X.prototype,`apiKey`,void 0),r([l({readOnly:!0,type:[ft],json:{read:{source:`summary`}}})],X.prototype,`fields`,null),X=r([m(`esri.layers.support.BuildingSummaryStatistics`)],X);var pt=u.ofType(J),mt=e(E.sublayersProperty),Z=mt.json?.origins;Z&&(Z[`web-scene`]={type:[S],write:{enabled:!0,overridePolicy:()=>({enabled:!1})}},Z[`portal-item`]={type:[S],write:{enabled:!0,overridePolicy:()=>({enabled:!1})}});var Q=class extends He(ce(Ne(de(be(we(a(ue(le)))))))){constructor(e){super(e),this.operationalLayerType=`BuildingSceneLayer`,this.allSublayers=new ye({getCollections:()=>[this.sublayers],getChildrenFunction:e=>e.type===`building-group`?e.sublayers:null}),this.sublayers=null,this._allSublayerOverrides=null,this.filters=new pt,this.activeFilterId=null,this.summaryStatistics=null,this.outFields=null,this.legendEnabled=!0,this.type=`building-scene`}normalizeCtorArgs(e){return typeof e==`string`?{url:e}:e??{}}destroy(){this.allSublayers.destroy()}readSublayers(e,t,n){let r=E.readSublayers(e,t,n);return C(r,e=>e.layer=this),this._allSublayerOverrides&&=(ht(r,this._allSublayerOverrides),null),r}write(e,t){return e=super.write(e,t),!t||t.origin!==`web-scene`&&t.origin!==`portal-item`||(this.sublayers?_t(this.sublayers,e,t):this._allSublayerOverrides&&vt(this._allSublayerOverrides,e,t)),e}read(e,t){if(super.read(e,t),(t?.origin===`web-scene`||t?.origin===`portal-item`)&&Array.isArray(e?.sublayers)){let n=gt(e.sublayers,t);this.sublayers?$(this.sublayers,n):(this._allSublayerOverrides??=new Map,this._allSublayerOverrides.set(t.origin,n))}}readSummaryStatistics(e,t){if(typeof t.statisticsHRef==`string`&&this.parsedUrl){let e=xe(this.parsedUrl.path,t.statisticsHRef);return new X({url:e,apiKey:this.apiKey,customParameters:this.customParameters})}return null}set elevationInfo(e){e!=null&&e.mode!==`absolute-height`||this._set(`elevationInfo`,e),this._validateElevationInfo(e)}load(e){let t=e==null?null:e.signal,n=this.loadFromPortal({supportedTypes:[`Scene Service`]},e).catch(fe).then(()=>this._fetchService(t)).then(()=>this._fetchAssociatedFeatureService(t));return this.addResolvingPromise(n),Promise.resolve(this)}loadAll(){return Te(this,e=>{C(this.sublayers,t=>{t.type!==`building-group`&&e(t)}),this.summaryStatistics&&e(this.summaryStatistics)})}async saveAs(e,t){return this._debouncedSaveOperations(1,{...t,getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:`building-scene`},e)}async save(){return this._debouncedSaveOperations(0,{getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:`building-scene`})}validateLayer(e){if(!e.layerType||e.layerType!==`Building`)throw new f(`buildingscenelayer:layer-type-not-supported`,`BuildingSceneLayer does not support this layer type`,{layerType:e.layerType})}_getTypeKeywords(){return[`Building`]}async _fetchAssociatedFeatureService(e){try{let{portalItem:t}=await Ze(`${this.url}/layers/${this.layerId}`,{sceneLayerItem:this.portalItem,customParameters:this.customParameters,apiKey:this.apiKey,signal:e});this.associatedFeatureServiceItem=t}catch{Fe(this._logWarningOnPopupEnabled())}}async _logWarningOnPopupEnabled(){let e=new AbortController;this.addHandles(Re(e)),await ee(()=>this.allSublayers.filter(e=>e.type===`building-component`).some(e=>e.popupEnabled&&e.popupTemplate!=null),e.signal);let t=this.allSublayers.filter(e=>e.type===`building-component`).filter(e=>e.popupEnabled&&e.popupTemplate!=null),n=[],r=[];for(let e of t){let t=e.title??`untitled ${e.id}`;e.attributeStorageInfo?n.push(t):r.push(t)}let i=n.length>0?`\nThe following sublayers will fall back to binary attributes for Popups:
  ${n.join(`
  `)}`:``,a=r.length>0?`\nThe following sublayers have no binary attributes and will not work with Popups:
  ${r.join(`
  `)}`:``;_.getLogger(this).warn(`Associated FeatureLayer could not be loaded for this BuildingSceneLayer: ${this.title}.`,i,a)}_validateElevationInfo(e){let t=`Building scene layers`;v(_.getLogger(this),$e(t,`absolute-height`,e)),v(_.getLogger(this),Qe(t,e))}};function ht(e,t){t.forEach(t=>$(e,t))}function $(e,t){let{overrides:n,context:r}=t;C(e,e=>e.read(n.get(e.id),r))}function gt(e,t){let n=new Map;for(let r of e)typeof r==`object`&&r&&typeof r.id==`number`?n.set(r.id,r):t.messages?.push(new f(`building-scene-layer:invalid-sublayer-override`,`Invalid value for sublayer override. Not an object or no id specified.`,{value:r}));return{overrides:n,context:t}}function _t(e,t,n){let r=[];C(e,e=>{let t=e.write({},n);Object.keys(t).length>1&&r.push(t)}),r.length>0&&(t.sublayers=r)}function vt(t,n,r){let i=r?.origin&&t.get(r.origin);i&&(n.sublayers=[],i.overrides.forEach(t=>{n.sublayers.push(e(t))}))}r([l({type:[`BuildingSceneLayer`]})],Q.prototype,`operationalLayerType`,void 0),r([l({readOnly:!0})],Q.prototype,`allSublayers`,void 0),r([l(mt)],Q.prototype,`sublayers`,void 0),r([o(`service`,`sublayers`)],Q.prototype,`readSublayers`,null),r([l({type:pt,nonNullable:!0,json:{write:!0}})],Q.prototype,`filters`,void 0),r([l({type:String,json:{write:!0}})],Q.prototype,`activeFilterId`,void 0),r([l({readOnly:!0,type:X})],Q.prototype,`summaryStatistics`,void 0),r([o(`summaryStatistics`,[`statisticsHRef`])],Q.prototype,`readSummaryStatistics`,null),r([l({type:[String],json:{read:!1}})],Q.prototype,`outFields`,void 0),r([l(ae)],Q.prototype,`fullExtent`,void 0),r([l(te)],Q.prototype,`legendEnabled`,void 0),r([l({type:[`show`,`hide`,`hide-children`]})],Q.prototype,`listMode`,void 0),r([l(d(ve))],Q.prototype,`spatialReference`,void 0),r([l(Se)],Q.prototype,`elevationInfo`,null),r([l({json:{read:!1},readOnly:!0})],Q.prototype,`type`,void 0),r([l()],Q.prototype,`associatedFeatureServiceItem`,void 0),Q=r([m(`esri.layers.BuildingSceneLayer`)],Q);var yt=Q;export{yt as default};