import{$l as e,CD as t,Gg as n,H_ as r,Hh as i,Ih as a,Jg as o,Lh as s,MC as c,OC as l,Oh as ee,Ph as u,Rh as d,Tt as f,Wh as p,Yg as m,ab as h,bD as te,fm as g,gt as ne,jh as re,kC as _,k_ as v,mm as y,np as b,oa as x,ru as S,vm as C,zh as w}from"./index-BqmCqmfp.js";import{t as T}from"./Uniform-DXwqrKA1.js";import{t as E}from"./NoParameters-CpAItLvD.js";var D=class extends l{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};t([c()],D.prototype,`SCENEVIEW_HITTEST_RETURN_INTERSECTOR`,void 0),t([c()],D.prototype,`DECONFLICTOR_SHOW_VISIBLE`,void 0),t([c()],D.prototype,`DECONFLICTOR_SHOW_INVISIBLE`,void 0),t([c()],D.prototype,`DECONFLICTOR_SHOW_GRID`,void 0),t([c()],D.prototype,`LABELS_SHOW_BORDER`,void 0),t([c()],D.prototype,`TEXT_SHOW_BASELINE`,void 0),t([c()],D.prototype,`TEXT_SHOW_BORDER`,void 0),t([c()],D.prototype,`OVERLAY_DRAW_DEBUG_TEXTURE`,void 0),t([c()],D.prototype,`OVERLAY_SHOW_CENTER`,void 0),t([c()],D.prototype,`SHOW_POI`,void 0),t([c()],D.prototype,`TESTS_DISABLE_OPTIMIZATIONS`,void 0),t([c()],D.prototype,`TESTS_DISABLE_FAST_UPDATES`,void 0),t([c()],D.prototype,`DRAW_MESH_GEOMETRY_NORMALS`,void 0),t([c()],D.prototype,`FEATURE_TILE_FETCH_SHOW_TILES`,void 0),t([c()],D.prototype,`FEATURE_TILE_TREE_SHOW_TILES`,void 0),t([c()],D.prototype,`TERRAIN_TILE_TREE_SHOW_TILES`,void 0),t([c()],D.prototype,`I3S_TREE_SHOW_TILES`,void 0),t([c()],D.prototype,`I3S_SHOW_MODIFICATIONS`,void 0),t([c()],D.prototype,`LOD_INSTANCE_RENDERER_DISABLE_UPDATES`,void 0),t([c()],D.prototype,`LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL`,void 0),t([c()],D.prototype,`EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES`,void 0),t([c()],D.prototype,`LINE_WIREFRAMES`,void 0),D=t([_(`esri.views.3d.support.debugFlags`)],D);var O=new D;function k(){return!!te(`enable-feature:objectAndLayerId-rendering`)}var A=class{constructor(e){this.field=e}},ie=class extends A{constructor(e){super(e),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[0,0,0],this.fallback=[0,0,0]}},j=class extends A{constructor(e){super(e),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0],this.fallback=[0,0,0,0]}},ae=class extends A{constructor(e,t=0){super(e),this.fallback=t,this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}},oe=class{};function M(e){return e!=null}function N(e,t){e&&e.push(t)}function P(e,t,n,r=b()){let i=e||0,o=t||0,c=n||0;return i!==0&&p(r,r,-i/180*Math.PI),o!==0&&a(r,r,o/180*Math.PI),c!==0&&s(r,r,c/180*Math.PI),r}function F(e,t,n,r,i){let a=e.minSize,o=e.maxSize;if(e.useSymbolValue){let e=r.symbolSize[n];return t.minSize[n]=e,t.maxSize[n]=e,t.offset[n]=t.minSize[n],t.factor[n]=0,t.type[n]=1,!0}if(M(e.field))return M(e.stops)?e.stops.length===2&&y(e.stops[0].size)&&y(e.stops[1].size)?(I(e.stops[0].size,e.stops[1].size,e.stops[0].value,e.stops[1].value,t,n),t.type[n]=1,!0):(N(i,`Could not convert size info: stops only supported with 2 elements`),!1):y(a)&&y(o)&&M(e.minDataValue)&&M(e.maxDataValue)?(I(a,o,e.minDataValue,e.maxDataValue,t,n),t.type[n]=1,!0):e.valueUnit===`unknown`?(N(i,`Could not convert size info: proportional size not supported`),!1):x[e.valueUnit]==null?(N(i,`Could not convert size info: scale-dependent size not supported`),!1):(t.minSize[n]=-1/0,t.maxSize[n]=1/0,t.offset[n]=0,t.factor[n]=1/x[e.valueUnit],t.type[n]=1,!0);if(!M(e.field)){if(e.stops?.[0]&&y(e.stops[0].size))return t.minSize[n]=e.stops[0].size,t.maxSize[n]=e.stops[0].size,t.offset[n]=t.minSize[n],t.factor[n]=0,t.type[n]=1,!0;if(y(a))return t.minSize[n]=a,t.maxSize[n]=a,t.offset[n]=a,t.factor[n]=0,t.type[n]=1,!0}return N(i,`Could not convert size info: unsupported variant of sizeInfo`),!1}function I(e,t,n,r,i,a){let o=Math.abs(r-n)>0?(t-e)/(r-n):0;i.minSize[a]=o>0?e:t,i.maxSize[a]=o>0?t:e,i.offset[a]=e-n*o,i.factor[a]=o}function L(e,t,n,r){if(e.normalizationField||e.valueRepresentation)return N(r,`Could not convert size info: unsupported property`),null;if(!C(e.field))return N(r,`Could not convert size info: field is not a string`),null;if(t.size){if(e.field)if(t.size.field){if(e.field!==t.size.field)return N(r,`Could not convert size info: multiple fields in use`),null}else t.size.field=e.field}else t.size=new ie(e.field),S(t.size.fallback,n.fallbackSize);let i;switch(e.axis){case`width`:return i=F(e,t.size,0,n,r),i?t:null;case`height`:return i=F(e,t.size,2,n,r),i?t:null;case`depth`:return i=F(e,t.size,1,n,r),i?t:null;case`width-and-depth`:return i=F(e,t.size,0,n,r),i&&F(e,t.size,1,n,r),i?t:null;case null:case void 0:case`all`:return i=F(e,t.size,0,n,r),i&&=F(e,t.size,1,n,r),i&&=F(e,t.size,2,n,r),i?t:null;default:return N(r,`Could not convert size info: unknown axis "${e.axis}""`),null}}function R(e,t,n){for(let n=0;n<3;++n){let r=t.unitInMeters;e.type[n]===1&&(r*=t.modelSize[n],e.type[n]=2),e.minSize[n]=e.minSize[n]/r,e.maxSize[n]=e.maxSize[n]/r,e.offset[n]=e.offset[n]/r,e.factor[n]=e.factor[n]/r}let r;if(e.type[0]!==0)r=0;else if(e.type[1]!==0)r=1;else{if(e.type[2]===0)return N(n,`No size axis contains a valid size or scale`),!1;r=2}for(let t=0;t<3;++t)e.type[t]===0&&(e.minSize[t]=e.minSize[r],e.maxSize[t]=e.maxSize[r],e.offset[t]=e.offset[r],e.factor[t]=e.factor[r],e.type[t]=e.type[r]);return!0}function z(e,t,n){e[4*t]=n.r/255,e[4*t+1]=n.g/255,e[4*t+2]=n.b/255,e[4*t+3]=n.a}function B(e,t,n,r){if(e.normalizationField)return N(r,`Could not convert color info: unsupported property`),null;if(g(e.field)){if(!e.stops)return N(r,`Could not convert color info: missing stops or colors`),null;{if(e.stops.length>8)return N(r,`Could not convert color info: too many color stops`),null;t.color=new j(e.field);let i=e.stops;for(let e=0;e<8;++e){let n=i[Math.min(e,i.length-1)];t.color.values[e]=n.value,z(t.color.colors,e,n.color)}f(t.color.fallback,n.fallbackColor)}}else{if(!(e.stops&&e.stops.length>=0))return N(r,`Could not convert color info: no field and no colors/stops`),null;{let r=e.stops&&e.stops.length>=0&&e.stops[0].color;t.color=new j(null);for(let e=0;e<8;e++)t.color.values[e]=1/0,z(t.color.colors,e,r);f(t.color.fallback,n.fallbackColor)}}return t}function V(e,t,n,r){if(e.normalizationField)return N(r,`Could not convert opacity info: unsupported property`),null;if(g(e.field)){if(!e.stops)return N(r,`Could not convert opacity info: missing stops or opacities`),null;{if(e.stops.length>8)return N(r,`Could not convert opacity info: too many opacity stops`),null;t.opacity=new ae(e.field,n.fallbackColor[3]);let i=e.stops;for(let e=0;e<8;++e){let n=i[Math.min(e,i.length-1)];t.opacity.values[e]=n.value,t.opacity.opacityValues[e]=n.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return N(r,`Could not convert opacity info: no field and no opacities/stops`),null;{let r=e.stops&&e.stops.length>=0?e.stops[0].opacity:0;t.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0],fallback:n.fallbackColor[3]};for(let e=0;e<8;e++)t.opacity.values[e]=1/0,t.opacity.opacityValues[e]=r}}return t}function H(e,t,n){let r=n===2&&e.rotationType===`arithmetic`;t.offset[n]=r?90:0,t.factor[n]=r?-1:1,t.type[n]=1}function U(e,t,n){if(!g(e.field))return N(n,`Could not convert rotation info: field is not a string`),null;if(t.rotation){if(e.field)if(t.rotation.field){if(e.field!==t.rotation.field)return N(n,`Could not convert rotation info: multiple fields in use`),null}else t.rotation.field=e.field}else t.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case`tilt`:return H(e,t.rotation,0),t;case`roll`:return H(e,t.rotation,1),t;case null:case void 0:case`heading`:return H(e,t.rotation,2),t;default:return N(n,`Could not convert rotation info: unknown axis "${e.axis}""`),null}}var W=class{constructor({supports:e,modelSize:t,symbolSize:r,unitInMeters:i,anchor:a,scale:o,rotation:s,fallbackColor:c,fallbackSize:l}){this.supports=e,this.modelSize=t??n(),this.symbolSize=r??n(),this.unitInMeters=i??1,this.anchor=a??m(),this.scale=o??n(),this.rotation=s??m(),this.fallbackColor=c??ne(),this.fallbackSize=l??n()}};function G(e,t,n){if(!e)return null;let r=e.reduce((e,r)=>{if(!e)return e;if(r.valueExpression)return N(n,`Could not convert visual variables: arcade expressions not supported`),null;switch(r.type){case`size`:return t.supports.size?L(r,e,t,n):e;case`color`:return t.supports.color?B(r,e,t,n):e;case`opacity`:return t.supports.opacity?V(r,e,t,n):null;case`rotation`:return t.supports.rotation?U(r,e,n):e;default:return null}},new oe);return!(e.length>0&&r)||r.size||r.color||r.opacity||r.rotation?r?.size&&!R(r.size,t,n)?null:r:null}var K=class{constructor(e,t,n){this.visualVariables=e,this.materialParameters=t,this.requiresShaderTransformation=n}};function se(e,t){if(!e||k()||O.TESTS_DISABLE_FAST_UPDATES)return null;let n=G(e.visualVariables,t);return n?new K(n,Y(n,t),!!n.size):null}function ce(e,t,n){if(!t||!e)return!1;let r=e.visualVariables,i=G(t.visualVariables,n);return!!i&&!!(q(r.size,i.size,`size`)&&q(r.color,i.color,`color`)&&q(r.rotation,i.rotation,`rotation`)&&q(r.opacity,i.opacity,`opacity`))&&(e.visualVariables=i,e.materialParameters=Y(i,n),e.requiresShaderTransformation=!!i.size,!0)}function q(e,t,n){if(!!e!=!!t||e&&e.field!==t?.field)return!1;if(e&&n===`rotation`){let n=e,r=t;for(let e=0;e<3;e++)if(n.type[e]!==r.type[e]||n.offset[e]!==r.offset[e]||n.factor[e]!==r.factor[e])return!1}return!0}var J=class extends E{constructor(e){super(),this.vvSize=e?.size??null,this.vvColor=e?.color??null,this.vvOpacity=e?.opacity??null}get hasVVSize(){return!!this.vvSize}get hasVVColor(){return!!this.vvColor}get hasVVOpacity(){return!!this.vvOpacity}};function Y(e,t){let n=new J(e);return n.vvSize&&(n.vvSymbolAnchor=t.anchor,w($),P(t.rotation[2],t.rotation[0],t.rotation[1],$),n.vvSymbolRotationMatrix=n.vvSymbolRotationMatrix||v(),r(n.vvSymbolRotationMatrix,$)),n}function le(e,t,n){if(!e.vvSize)return n;d(Z,n);let r=e.vvSymbolRotationMatrix;return i($,r[0],r[1],r[2],0,r[3],r[4],r[5],0,r[6],r[7],r[8],0,0,0,0,1),ee(Z,Z,$),X(Q,e,t),re(Z,Z,Q),u(Z,Z,e.vvSymbolAnchor),Z}function X(t,n,r){if(!n.vvSize)return e(t,1,1,1),t;if(Number.isNaN(r[0]))return S(t,n.vvSize.fallback);for(let e=0;e<3;++e){let i=n.vvSize.offset[e]+r[0]*n.vvSize.factor[e];t[e]=h(i,n.vvSize.minSize[e],n.vvSize.maxSize[e])}return t}function ue(e,t){let n=e==null?0:t.attributes[e];return typeof n==`number`&&isFinite(n)?n:NaN}var Z=b(),Q=o(),$=b(),de=class extends J{constructor(){super(...arguments),this.renderOccluded=1,this.isDecoration=!1}},fe=8,pe=class extends T{constructor(e,t,n,r){super(e,`vec4`,1,(n,i,a)=>n.setUniform4fv(e,t(i,a),r),n)}},me=class extends T{constructor(e,t,n,r){super(e,`float`,1,(n,i,a)=>n.setUniform1fv(e,t(i,a),r),n)}};export{W as a,le as c,k as d,O as f,de as i,ue as l,pe as n,se as o,fe as r,ce as s,me as t,X as u};