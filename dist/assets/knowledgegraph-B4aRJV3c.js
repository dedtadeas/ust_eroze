const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/knowledgeGraphService-DCe6R_2q.js","assets/knowledgeGraphService-DJe2wov6.js","assets/index-BqmCqmfp.js","assets/index-kIqmb12G.css","assets/Relationship-DVNtFbsI.js","assets/GPMessage-LPLTXP7P.js","assets/networkEnums-BShtiFSl.js"])))=>i.map(i=>d[i]);
import{Cw as e,Ja as t,Lx as n,Px as r,TE as i,Ux as a,Vn as o,Vx as s,_x as c,dm as l,fm as u,hg as d,hm as f,mm as p,qa as m,ug as h,vx as g,yg as _}from"./index-BqmCqmfp.js";import"./ImmutableArray-C3KNQCVd.js";import{$ as v,J as y,K as b,U as x,W as S,Y as C,_ as w,ct as T,k as E,t as D,v as O}from"./Dictionary-B3Q9BFVY.js";import"./shared-BZhQTnH4.js";import"./number-Dq0Kt6xf.js";import{t as k}from"./ArcadePortal-B5V7N8wX.js";import{t as A}from"./portalUtils-DQ6_t55e.js";import{i as j,n as M,r as N,t as P}from"./Relationship-DVNtFbsI.js";import{t as F}from"./GraphQueryStreaming-CxVQo3po.js";var I=null;async function L(e){let n=i.geometryServiceUrl??``;if(!n){h()||await d();for(let t of e)t.container[t.indexer]=_(t.container[t.indexer],a.WGS84);return}let r=e.map(e=>e.container[e.indexer]),o=new t({geometries:r,outSpatialReference:a.WGS84}),s=await m(n,o);for(let t=0;t<s.length;t++){let n=e[t];n.container[n.indexer]=s[t]}}async function R(t,n){let r=new c({portal:t,id:n});return await r.load(),I===null&&(I=await e(()=>import(`./knowledgeGraphService-DCe6R_2q.js`),__vite__mapDeps([0,1,2,3,4,5,6]))),await I.fetchKnowledgeGraph(r.url)}function z(e,t,n,i,a){if(e===null)return null;if(u(e)||p(e))return e;if(y(e)||y(e))return e.toJSDate();if(v(e))return e.toStorageFormat();if(b(e))return e.toStorageString();if(w(e)){let r={};for(let o of e.keys())r[o]=z(e.field(o),t,n,i,a),r[o]instanceof s&&a.push({container:r,indexer:o});return r}if(f(e)){let r=e.map(e=>z(e,t,n,i,a));for(let e=0;e<r.length;e++)r[e]instanceof s&&a.push({container:r,indexer:e});return r}return E(e)?e.spatialReference.isWGS84?e:e.spatialReference.isWebMercator&&t?r(e):e:void 0}function B(e,t){if(!e)return e;if(e.spatialReference.isWGS84&&t.spatialReference.isWebMercator)return n(e);if(e.spatialReference.equals(t.spatialReference))return e;throw new o(t,`WrongSpatialReference`,null)}function V(e,t){if(!e)return null;let n={};for(let r in e)n[r]=H(e[r],t);return n}function H(e,t){return e===null?null:f(e)?e.map(e=>H(e,t)):e instanceof j?{graphTypeName:e.typeName,id:e.id,graphType:`entity`,properties:V(e.properties,t)}:e instanceof N?{graphType:`object`,properties:V(e.properties,t)}:e instanceof P?{graphTypeName:e.typeName,id:e.id,graphType:`relationship`,originId:e.originId??null,destinationId:e.destinationId??null,properties:V(e.properties,t)}:e instanceof M?{graphType:`path`,path:e.path?e.path.map(e=>H(e,t)):null}:E(e)?B(e,t):u(e)||p(e)||l(e)?e:null}function U(t){t.mode===`async`&&(t.functions.knowledgegraphbyportalitem=function(e,n){return t.standardFunctionAsync(e,n,(t,r,i)=>{if(C(i,2,2,e,n),i[0]===null)throw new o(e,`PortalRequired`,n);if(i[0]instanceof k){let t=S(i[1]),n;return n=e.services?.portal?e.services.portal:g.getDefault(),R(A(i[0],n),t)}if(!1===u(i[0]))throw new o(e,`InvalidParameter`,n);let a=S(i[0]);return R(e.services?.portal??g.getDefault(),a)})},t.signatures.push({name:`knowledgegraphbyportalitem`,min:2,max:2}),t.functions.querygraph=function(n,r){return t.standardFunctionAsync(n,r,async(t,i,a)=>{C(a,2,4,n,r);let s=a[0];if(!x(s))throw new o(n,`InvalidParameter`,r);let c=a[1];if(!u(c))throw new o(n,`InvalidParameter`,r);I===null&&(I=await e(()=>import(`./knowledgeGraphService-DCe6R_2q.js`),__vite__mapDeps([0,1,2,3,4,5,6])));let l=null,d=T(a[2],null);if(!(d instanceof D||d===null))throw new o(n,`InvalidParameter`,r);if(d){let e=[];l=z(d,!0,!1,n,e),e=e.filter(e=>!e.container[e.indexer].spatialReference.isWGS84),e.length>0&&await L(e)}let p=T(a[3],!1),m=new F({openCypherQuery:c,bindParameters:l,provenanceBehavior:p?`include`:`exclude`});(s?.serviceDefinition?.currentVersion??11.3)>11.2&&(m.outputSpatialReference=n.spatialReference);let h=(await I.executeQueryStreaming(s,m)).resultRowsStream.getReader(),g=[];try{for(;;){let{done:e,value:t}=await h.read();if(e)break;if(f(t))for(let e of t)g.push(H(e,n));else{let e=[];for(let r of t)e.push(H(t[r],n));g.push(e)}}}catch(e){throw e}return D.convertJsonToArcade(g,O(n),!1,!0)})},t.signatures.push({name:`querygraph`,min:2,max:4}))}export{U as registerFunctions};