import{C_ as e,D_ as t,T_ as n,__ as r,av as i,b_ as a,c_ as o,m_ as s,nv as c,ov as l,sv as u,u_ as d,w_ as f,x_ as p,y_ as m}from"./index-BqmCqmfp.js";var h={maxSegmentLength:1/0,maxDeviation:1/0,maxSegmentsPerCurve:12e3,minSegmentsPerCurve:1},g=1e-6,_=[0,0];function v(e){return{maxSegmentLength:e.maxSegmentLength??h.maxSegmentLength,maxDeviation:e.maxDeviation??h.maxDeviation,maxSegmentsPerCurve:e.maxSegmentsPerCurve??h.maxSegmentsPerCurve,minSegmentsPerCurve:Math.max(e.minSegmentsPerCurve??h.minSegmentsPerCurve,1)}}var y=class{constructor(e,t){this.curveStart=e,this.curveEnd=t,this.tStart=0,this.tEnd=0,this.tEndStack=[],this.arcEndStack=[]}get stackSize(){return this.tEndStack.length}initialize(e,t){this.tStart=0,this.arcStart=e,this.tEndStack.push(1),this.arcEndStack.push(t)}splitAt(e){this.tEndStack.push(this.tEnd),this.arcEndStack.push(this.arcEnd),this.tEndStack.push(e),this.arcEndStack.push(this.interpolate(e))}splitInHalf(){return this.splitAt((this.tStart+this.tEnd)/2)}pop(){this.tEnd=this.tEndStack.pop(),this.arcEnd=this.arcEndStack.pop()}next(){this.tStart=this.tEnd,this.arcStart=this.arcEnd}densify(e,{maxDeviation:t,maxSegmentLength:n,maxSegmentsPerCurve:r,minSegmentsPerCurve:a}){let o=n*n,s=t*t,c=1/r,l=this.interpolate(0),u=this.interpolate(1);i(this.curveStart,l)>g&&e.push(l),this.initialize(l,u);let d=1/a;for(let e=a-1;e>0;e--){let t=e*d;this.pop(),this.splitAt(t)}for(;this.stackSize>0;)this.pop(),this.tStart===this.tEnd||this.tEnd-this.tStart<c||(o===0||!isFinite(o)||i(this.arcStart,this.arcEnd)<o)&&(s===0||!isFinite(s)||this.getDeviation2()<s)?(e.push(this.arcEnd),this.next()):this.splitInHalf();return i(this.curveEnd,u)>g&&e.push([...this.curveEnd]),e}},b=class extends y{constructor(e,t){let[n,r,i]=t.b;super(e,n),this._controlPointsStack=[],this._curveControlPoints=[r,i],this._arcControlPoints=[r,i],this._controlPointsStack.push(this._arcControlPoints)}splitAt(e){let{arcStart:t,arcEnd:n,tStart:r,tEnd:i}=this,[a,o]=this._arcControlPoints,s=(e-r)/(i-r),c=l([],t,a,s),u=l(_,a,o,s),d=l([],o,n,s),f=l([],c,u,s),p=l([],u,d,s),m=l([],f,p,s);this.tEndStack.push(this.tEnd),this.arcEndStack.push(this.arcEnd),this._controlPointsStack.push([p,d]),this.tEndStack.push(e),this.arcEndStack.push(m),this._arcControlPoints[0]=c,this._arcControlPoints[1]=f,this._controlPointsStack.push(this._arcControlPoints)}pop(){super.pop(),this._arcControlPoints=this._controlPointsStack.pop()}interpolate(e){let{curveStart:t,curveEnd:n}=this,[r,i]=this._curveControlPoints;return c(t,r,i,n,e)}getDeviation2(){let{arcStart:e,arcEnd:t}=this,[n,r]=this._arcControlPoints;return Math.max(u(n,e,t),u(r,e,t))}},x=class extends y{constructor(e,t){let[n]=t.a;super(e,n),this._derivedEllipse=d(e,t)}pop(){super.pop(),this._tMid=(this.tStart+this.tEnd)/2,this._arcMid=this.interpolate(this._tMid)}splitInHalf(){this.tEndStack.push(this.tEnd),this.arcEndStack.push(this.arcEnd),this.tEndStack.push(this._tMid),this.arcEndStack.push(this._arcMid)}interpolate(e){return o(this._derivedEllipse,e)}getDeviation2(){return u(this._arcMid,this.arcStart,this.arcEnd)}};function S(e,t,n,{cx:r,cy:a,radius:o,thetaStart:s,thetaEnd:c,isInvalid:l},{maxDeviation:u,maxSegmentLength:d,maxSegmentsPerCurve:f,minSegmentsPerCurve:p}){if(l)return e.push([...n]),e;let m=2*o,h=[r+o*Math.cos(s),a+o*Math.sin(s)],_=[r+o*Math.cos(c),a+o*Math.sin(c)];i(t,h)>g&&e.push(h);let v=Math.abs(c-s),y=d<m?2*Math.asin(d/m):v,b=u<=o?2*Math.acos(1-u/o):v,x=Math.min(y,b),S=Math.min(f,Math.max(p,Math.ceil(Math.abs(v/x)))),C=1/S;for(let t=1;t<S;t++){let n=t*C,i=s*(1-n)+c*n;e.push([r+o*Math.cos(i),a+o*Math.sin(i)])}return e.push(_),i(n,_)>g&&e.push([...n]),e}function C(e,t,n,r){return new b(t,n).densify(e,r)}function w(e,n,r,i){let a=t(n,r),[o]=r.c;return S(e,n,o,a,i)}function T(e,t,n,r){let i=s(t,n),[a]=n.a;return S(e,t,a,i,r)}function E(e,t,n,r){let[i,a,o,s,c,l,u]=n.a;return l===0||u===0?(e.push([...i]),e):new x(t,n).densify(e,r)}function D(e,t,i,o){return a(i)?(e.push([...i]),e):f(i)?C(e,t,i,o):n(i)?w(e,t,i,o):r(i)?T(e,t,i,o):E(e,t,i,o)}function O(t,n){if(!p(t))return t;let r=v(n),i=e(t),a=[];for(let e of i){let t=[];for(let n=0;n<e.length-1;n++){let i=n+1,a=[...m(e[n])];n===0&&t.push(a),D(t,a,e[i],r)}a.push(t)}return`curvePaths`in t?{...t.hasZ===void 0?{}:{hasZ:t.hasZ},...t.hasM===void 0?{}:{hasM:t.hasM},paths:a,spatialReference:t.spatialReference}:{...t.hasZ===void 0?{}:{hasZ:t.hasZ},...t.hasM===void 0?{}:{hasM:t.hasM},rings:a,spatialReference:t.spatialReference}}export{O as t};