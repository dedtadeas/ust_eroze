import{AE as e,Ax as t,CD as n,MC as r,NC as i,dy as a,kC as o,nD as s,vC as c}from"./index-BqmCqmfp.js";var l,u=l=class extends c{constructor(e){super(e),this.variableName=null,this.dimensionName=null,this.values=[],this.isSlice=!1}clone(){return new l({variableName:this.variableName,dimensionName:this.dimensionName,values:e(this.values),isSlice:this.isSlice})}};n([r({type:String,json:{write:!0}})],u.prototype,`variableName`,void 0),n([r({type:String,json:{write:!0}})],u.prototype,`dimensionName`,void 0),n([r({type:i.array(i.oneOf([i.native(Number),i.array(i.native(Number))])),json:{write:!0}})],u.prototype,`values`,void 0),n([r({type:Boolean,json:{write:!0}})],u.prototype,`isSlice`,void 0),u=l=n([o(`esri.layers.support.DimensionalDefinition`)],u);function d(e,t,n){let r=t.shift();n.length===0&&n.push({sliceId:-1,multidimensionalDefinition:[]});let i=n.length;for(let t=0;t<i;t++){let t=n.shift().multidimensionalDefinition;r.values?.forEach(i=>{n.push({sliceId:-1,multidimensionalDefinition:[...t,{variableName:e,dimensionName:r.name,values:[i]}]})})}t.length&&d(e,t,n)}function f(e,t){let n=[],r=0;return(t?e.variables.filter(e=>e.name.toLowerCase()===t.toLowerCase()):[...e.variables].sort((e,t)=>e.name>t.name?1:-1)).forEach(e=>{let t=[],i=[...e.dimensions].sort((e,t)=>e.name>t.name?-1:1);d(e.name,i,t),t.forEach(e=>{n.push({...e,sliceId:r++})})}),n}function p(e,t,n){let r=e;if(t&&(t=[...t].sort((e,t)=>e.dimensionName<t.dimensionName?-1:1)).forEach(({dimensionName:e,values:t,isSlice:n})=>{t.length&&(r=r.filter(r=>{let i=r.multidimensionalDefinition.find(t=>t.dimensionName===e);if(i==null)return!1;let a=i.values[0];return typeof a==`number`?typeof t[0]==`number`?t.includes(a):t.some(e=>e[0]<=a&&e[1]>=a):typeof t[0]==`number`?t.some(e=>a[0]<=e&&a[1]>=e):n?t.some(e=>e[0]===a[0]&&e[0]===a[1]):t.some(e=>e[0]>=a[0]&&e[0]<=a[1]||e[1]>=a[0]&&e[1]<=a[1]||e[0]<a[0]&&e[1]>a[1])}))}),r.length&&n?.start!=null&&n.end!=null){let e=n.start.getTime(),t=n.end.getTime(),i=r[0].multidimensionalDefinition.findIndex(e=>e.dimensionName===`StdTime`);i>-1&&(r=r.filter(n=>{let r=n.multidimensionalDefinition[i].values[0];return e<=r&&t>=r}))}return r.map(e=>e.sliceId)}function m(e,t){return Array.isArray(e)?t[0]===t[1]?e[0]===t[0]||e[1]===t[0]:e[0]>=t[0]&&e[0]<=t[1]&&e[1]>=t[0]&&e[1]<=t[1]:e>=t[0]&&e<=t[1]}function h(e,t){return e[0]<=t[0]&&e[1]>=t[0]||e[0]<=t[1]&&e[1]>=t[1]||e[0]>=t[0]&&e[1]<=t[1]}function g(e){return e.length===1?[e[0],e[0]]:[e[0],e[e.length-1]]}function _(e,t,n){if(!t?.subsetDefinitions?.length)return e;let r;if(n){let{variables:i}=t;if(i.length&&!i.includes(n))return null;let a=t.subsetDefinitions.find(t=>t.dimensionName===e.name&&t.variableName===n);if(!a?.values?.length)return e;r=g(a.values)}else r=t.dimensions.find(({name:t})=>t===e.name)?.extent;let i=r;if(!i?.length)return e;let a=e.values.filter(e=>m(e,i));return{...e,extent:[...i],values:a}}function v(e,t,n){if(!t?.subsetDefinitions?.length)return!1;let{variables:r}=t;if(r.length&&e.some(({variableName:e})=>e&&!r.includes(e)))return!0;for(let r=0;r<e.length;r++){let i=e[r],a=t.subsetDefinitions.find(e=>(i.variableName===``||e.variableName===i.variableName)&&e.dimensionName===i.dimensionName);if(a?.values.length){let e=g(a.values);if(!i.isSlice&&i.values.length===2&&!Array.isArray(i.values[0])&&i.values[0]!==i.values[1]&&n){if(!h(i.values,e))return!0}else if(i.values.some(t=>!m(t,e)))return!0}}return!1}function y(e,t){if(e==null)return{isOutside:!1};let{geometry:n,timeExtent:r,multidimensionalDefinition:i}=t,a=null;if(r!=null&&(a=x(e,r),a==null))return{isOutside:!0};let{areaOfInterest:o}=e;if(o&&n){let e=b(n);if(e&&!o.contains(e))return{isOutside:!0}}return i!=null&&i.length&&v(i,e,!0)?{isOutside:!0}:{isOutside:!1,intersection:{geometry:n,timeExtent:a,multidimensionalDefinition:i}}}function b(e){switch(e.type){case`point`:return e;case`extent`:return e.center;case`polygon`:{let n=a(e);return n?t.fromJSON(n):null}}return null}function x(e,t){let n=e.dimensions.find(({name:e})=>e===`StdTime`);if(n==null||t.start==null&&t.end==null)return t;t=t.clone();let{start:r,end:i}=t.toJSON(),a=r===i?[r]:r!=null&&i!=null?[r,i]:[r??i];return a.length===2&&n?.extent.length&&(a[0]=Math.max(a[0],n.extent[0]),a[1]=Math.min(a[1],n.extent[1]??n.extent[0]),a[1]<a[0])||v([new u({variableName:``,dimensionName:`StdTime`,isSlice:a.length===1,values:a})],e,!0)?null:(t.start=new Date(a[0]),t.end=new Date(a[1]??a[0]),t)}function S(e){let{rasterInfo:t,multidimensionalSubset:n}=e,{multidimensionalInfo:r}=t;if(r==null)return null;let i=e.multidimensionalDefinition?.length?e.multidimensionalDefinition:w(t,{multidimensionalSubset:n});if(!i?.length)return null;if(i.some(e=>!e.dimensionName)){let{variableName:e}=i[0],r=w(t,{multidimensionalSubset:n,variableName:e});r?.forEach(e=>{let t=i?.find(({dimensionName:t})=>t===e.dimensionName);t?.values?.length&&(e.values=t.values,e.isSlice=t.isSlice)}),i=r}let{timeExtent:a}=e;if(i!=null&&a!=null&&(a.start!=null||a.end!=null)){i=i.map(e=>e.clone());let e=r.variables.find(({name:e})=>e===i[0].variableName)?.dimensions?.find(({name:e})=>e===`StdTime`),t=i.find(({dimensionName:e})=>e===`StdTime`);if(!e||!t)return null;let{start:n,end:o}=a,s=n==null?null:n.getTime(),c=o==null?null:o.getTime(),l=s??c,u=c??s;if(e.values!=null){let n=e.values.filter(e=>{if(Array.isArray(e)){if(l===u)return e[0]<=l&&e[1]>=l;let t=e[0]<=l&&e[1]>l||e[0]<u&&e[1]>=u,n=e[0]>=l&&e[1]<=u||e[0]<l&&e[1]>u;return t||n}return l===u?e===l:e>=l&&e<=u});n.length?t.values=[n.sort((e,t)=>{let n=Array.isArray(e)?e[0]:e,r=Array.isArray(e)?e[1]:e,i=Array.isArray(t)?t[0]:t,a=Array.isArray(t)?t[1]:t;return l===u?n-i:Math.abs(r-u)-Math.abs(a-u)})[0]]:i=null}else if(e.hasRegularIntervals&&e.extent){let[n,r]=e.extent;l>r||u<n?i=null:t.values=l===u?[l]:[Math.max(n,l),Math.min(r,u)]}}return i!=null&&v(i,n)?null:i}function C(e,t={}){let{multidimensionalInfo:n,keyProperties:r}=e;if(n==null)return null;let{variableName:i,multidimensionalSubset:a,multidimensionalDefinition:o}=t,s=o==null?null:o[0]?.variableName,c=i||s||r?.DefaultVariable,{variables:l}=n;return a?.variables?.length&&(l=l.filter(({name:e})=>a.variables.includes(e))),c?l.find(({name:e})=>e===c)??l[0]:l[0]}function w(e,t={}){let n=C(e,t);if(!n)return null;let r=[],{dimensions:i,name:a}=n;if(i.length===0)return[new u({variableName:a,dimensionName:``,values:[],isSlice:!0})];for(let e=0;e<i.length;e++){let n=_(i[e],t.multidimensionalSubset,a);if(!n)return null;let{values:o,extent:s}=n,c=o?.[0]??s?.[0];n.name.toLowerCase()===`stdz`&&!n.hasRanges&&s&&Math.abs(s[1])<=Math.abs(s[0])&&(c=o?.length?o[o.length-1]:s[1]),r.push(new u({variableName:a,dimensionName:n.name,values:[c],isSlice:!t.useRangeForRangedDimensionInfo||!!n.hasRanges}))}return r}function T(e){return!!e?.length&&e.some(e=>{if(e.values==null)return!0;let t=e.values.length;return t===0||t>1||!e.isSlice&&Array.isArray(e.values[0])})}function E(e,t){if(t==null||e==null)return null;let n=t.variables.map(e=>({...e}));return e?.variables?.length&&(n=n.filter(({name:t})=>e.variables.includes(t)),n.forEach(t=>{t.dimensions=t.dimensions.map(n=>_(n,e,t.name)).filter(s)})),n}function D(e,t){let{values:n}=t;if(n?.length){let t=Array.isArray(n[0]),r=Array.isArray(e);return t===r?t&&r?n.findIndex(t=>t[0]===e[0]&&t[1]===e[1]):n.indexOf(e):-1}let{extent:r}=t;if(Array.isArray(e)||!r||e<r[0]||e>r[1])return-1;let i=t.interval||1;if(t.unit!==`ISO8601`)return Math.round((e-r[0])/i);let a=r[0],o=-1;switch(t.intervalUnit?.toLowerCase()||`days`){case`seconds`:o=Math.round((e-a)/1e3/i);break;case`minutes`:o=Math.round((e-a)/6e4/i);break;case`hours`:o=Math.round((e-a)/36e5/i);break;case`days`:o=Math.round((e-a)/864e5/i);break;case`months`:{let t=new Date(e).getUTCFullYear()-new Date(a).getUTCFullYear(),n=new Date(a).getUTCMonth(),r=new Date(e).getUTCMonth();o=t===0?r-n:r+11-n+12*(t-1)}break;case`years`:o=Math.round((new Date(e).getUTCFullYear()-new Date(a).getUTCFullYear())/i);break;case`decades`:o=Math.round((new Date(e).getUTCFullYear()-new Date(a).getUTCFullYear())/10/i)}return o}function O(e){let t=e.values?.length;if(t)return t;let{extent:n,unit:r}=e,i=e.interval||1,a=n?n[1]-n[0]:0;if(r!==`ISO8601`)return Math.round(a/i);switch(e.intervalUnit?.toLowerCase()??`seconds`){case`seconds`:t=Math.round(a/1e3/i);break;case`minutes`:t=Math.round(a/6e4/i);break;case`hours`:t=Math.round(a/36e5/i);break;case`days`:t=Math.round(a/864e5/i);break;case`months`:if(n){let e=new Date(n[1]).getUTCFullYear()-new Date(n[0]).getUTCFullYear(),r=new Date(n[0]).getUTCMonth(),i=new Date(n[1]).getUTCMonth();t=e===0?i-r+1:i+11-r+12*(e-1)+1}else t=0;break;case`years`:t=n?Math.round((new Date(n[1]).getUTCFullYear()-new Date(n[0]).getUTCFullYear())/i):0;break;case`decades`:t=n?Math.round((new Date(n[1]).getUTCFullYear()-new Date(n[0]).getUTCFullYear())/10/i):0;break;default:t=0}return t}function k(e){if(e.extent?.length!==2||!e.interval)return[];let{extent:[t,n],interval:r}=e;if(e.unit===`ISO8601`){let i=e.intervalUnit?.toLowerCase()??`days`;return[`decades`,`years`,`months`,`days`,`hours`,`minutes`,`seconds`].includes(i)?A(t,n,r,i):[]}let i=Math.round((n-t)/r);return Array.from({length:i},(e,a)=>a===i-1?n:t+a*r)}function A(e,t,n,r){let i=[],a=e,o=new Date(e);for(;a<=t;)switch(i.push(a),r){case`decades`:o.setUTCFullYear(o.getUTCFullYear()+10*n),a=o.getTime();break;case`years`:o.setUTCFullYear(o.getUTCFullYear()+n),a=o.getTime();break;case`months`:o.setUTCMonth(o.getUTCMonth()+n),a=o.getTime();break;case`days`:a+=864e5*n;break;case`hours`:a+=36e5*n;break;case`minutes`:a+=6e4*n;break;case`seconds`:a+=1e3*n}return i.length===1?i[1]=t:i[i.length-1]=t,i}function j(e,t){let n=0,r=e[0].variableName,i=[...t.variables].sort((e,t)=>e.name>t.name?1:-1);for(let t=0;t<i.length;t++){let a=i[t],o=[...a.dimensions].sort((e,t)=>e.name>t.name?-1:1);if(a.name!==r){n+=o.map(e=>O(e)).reduce((e,t)=>e*t);continue}let s=o.map(e=>O(e)),c=o.length;for(let t=0;t<c;t++){let r=e.find(e=>e.dimensionName===o[t].name);if(r==null)return null;let i=D(r.values[0],o[t]);if(i===-1)return null;s.shift(),n+=t===c-1?i:i*s.reduce((e,t)=>e*t)}break}return n}function M(e){return Math.round(24*(e-25569)*3600*1e3)}export{v as a,p as c,k as d,T as f,w as i,f as l,E as n,y as o,u as p,M as r,S as s,j as t,C as u};