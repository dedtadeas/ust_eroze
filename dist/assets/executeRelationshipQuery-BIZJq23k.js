import{Gr as e,OS as t,Pa as n,Sw as r,zu as i}from"./index-BqmCqmfp.js";import{t as a}from"./urlUtils-CtPsFIu4.js";function o(e,n){let r=e.toJSON();return r.objectIds&&=r.objectIds.join(`,`),r.orderByFields&&=r.orderByFields.join(`,`),r.outFields&&!n?.returnCountOnly?r.outFields.includes(`*`)?r.outFields=`*`:r.outFields=r.outFields.join(`,`):delete r.outFields,r.outSR&&=t(r.outSR),r.dynamicDataSource&&(r.layer=JSON.stringify({source:r.dynamicDataSource}),delete r.dynamicDataSource),r}async function s(e,t,n){let r=await l(e,t,n),i=r.data,a=i.geometryType,o=i.spatialReference,s={};for(let e of i.relatedRecordGroups){let t={fields:void 0,geometryType:a,spatialReference:o,hasZ:!!i.hasZ,hasM:!!i.hasM,features:e.relatedRecords};if(e.objectId!=null)s[e.objectId]=t;else for(let n of Object.keys(e))n!==`relatedRecords`&&(s[e[n]]=t)}return{...r,data:s}}async function c(e,t,n){let r=await l(e,t,n,{returnCountOnly:!0}),i=r.data,a={};for(let e of i.relatedRecordGroups)e.objectId!=null&&(a[e.objectId]=e.count);return{...r,data:a}}async function l(e,t,n={},i){let s=a({...e.query,f:`json`,...i,...o(t,i)});return r(e.path+`/queryRelatedRecords`,{...n,query:{...n.query,...s}})}async function u(t,r,a){r=e.from(r);let o=i(t);return s(o,r,a).then(e=>{let t=e.data,r={};return Object.keys(t).forEach(e=>r[e]=n.fromJSON(t[e])),r})}async function d(t,n,r){n=e.from(n);let a=i(t);return c(a,n,{...r}).then(e=>e.data)}export{u as executeRelationshipQuery,d as executeRelationshipQueryForCount};