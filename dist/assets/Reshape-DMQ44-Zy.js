import{$_ as e,Am as t,Ax as n,Bb as r,Bg as i,CD as a,D_ as o,Db as s,ET as c,E_ as l,Ey as u,Gb as d,Gd as f,Gm as p,Hm as m,Id as h,JC as g,Kb as _,Km as v,MC as y,OC as b,O_ as x,SC as S,TC as C,T_ as w,Ub as ee,Vb as T,Vm as E,Wb as D,X_ as O,Xh as te,Yd as ne,_E as re,__ as k,b_ as A,cT as ie,c_ as ae,fC as oe,g_ as j,h_ as se,iT as ce,iv as le,kC as M,kb as ue,mT as N,m_ as P,p_ as de,qb as fe,rv as pe,uD as F,uT as I,u_ as me,vE as he,vT as ge,v_ as _e,vd as ve,wT as L,w_ as R,wm as ye,x_ as be,xy as xe,y_ as z,yy as Se}from"./index-BqmCqmfp.js";import"./SimpleGeometryCursor-CI9GIWKa.js";import"./Point2D-UYEfE6HP.js";import"./Envelope2D-BNwQDrOT.js";import"./UnitFactory-J9WMNXdY.js";import"./Transformation2D-DVoPQwGC.js";import"./OperatorDefinitions-DQQu7-BK.js";import"./jsonConverter-DiNOXEUJ.js";import{l as Ce,p as we}from"./apiConverter-DVPFZqjR.js";import"./quatf64-CJzmL3cc.js";import"./quat-Bk_ZaVz9.js";import"./axisAngleDegrees-Di7q97jx.js";import"./MeshLocalVertexSpace-HjmVAuYa.js";import"./MeshTransform-B2p38eYR.js";import"./meshVertexSpaceUtils-Y8FeTLov.js";import"./vectorStacks-CKtslZxP.js";import"./plane-CTjDePZl.js";import"./projectPointToVector-Clou1sfo.js";import"./spatialReferenceEllipsoidUtils-DBtdxVkA.js";import"./dehydratedPoint-Dwb3orme.js";import"./projectVectorToVector-D-Bbb8fP.js";import"./layerViewUtils-Bbe7IKvz.js";import"./elevationInfoUtils-Df_uYU_q.js";import"./colorUtils-uG2qTogT.js";import"./cimSymbolUtils-1FVTTBxd.js";import"./gfxUtils-DZoKCRMw.js";import"./utils-5jlQHYup.js";import{t as B}from"./GraphicsLayer-BGvt7_Y1.js";import"./renderUtils-Ckhxu64U.js";import"./previewUtils-CT5v5cXU.js";import"./devEnvironmentUtils-8TtBy-wV.js";import"./webStyleAcceptedFormats-vp0B4e2w.js";import"./webStyleSymbolUtils-Vsg9bxK_.js";import"./previewSymbol3D-CgFD1bFX.js";import"./geodesicUtils-DJORTTMv.js";import"./getDefaultUnitForView-CBP34vcm.js";import{r as Te,t as Ee}from"./layerUtils-DVQFdwBE.js";import{t as De}from"./SketchOptions-CfisVcr8.js";import"./LineSnappingHint-BAcwqgNT.js";import"./ParallelSnappingHint-Knbe-U69.js";import"./IntersectionSnappingHint-C3U4Rx6H.js";import"./RightAngleSnappingHint--LJCiSno.js";import{i as V}from"./quantityUtils-Dywg00j-.js";import{o as Oe}from"./euclideanLengthMeasurementUtils-Bhl6nD1D.js";import"./PointSnappingHint-0hXGrSRX.js";import{n as ke,t as Ae,u as je}from"./SnappingContext-BiPKdvZN.js";import{t as Me}from"./SnappingVisualizer2D-RgcarHQv.js";import{a as Ne,i as Pe,l as Fe,o as Ie,s as Le}from"./rotate-qEFO-Vf9.js";import"./angularMeasurementUtils-BFBiid4G.js";import"./unitFormatUtils-D4yCMgjI.js";import"./GraphicManipulator-3bzgkt2P.js";import"./drapedUtils-p7eKCYi3.js";import{a as Re,i as ze}from"./drawUtils-BjZRY3_w.js";import{n as Be,r as Ve,t as He}from"./SelectedVertexTooltipInfo-CuZHeWi5.js";import{t as Ue}from"./TranslateTooltipInfo-Dg5jnkfm.js";import{n as We,t as Ge}from"./GraphicMover-CVuh8pZh.js";import{t as Ke}from"./settings-D6uYZqUj.js";import{t as qe}from"./symbolUtils-lbLywa7t.js";var Je=()=>he.getLogger(`esri.views.draw.support.ConnectedReshapeManager`),Ye=Symbol(),H=class extends b{constructor(e){super(e),this.activeOperationType=null,this.providerFactories=[],this.view=null,this._activeProviders=new Set,this._graphics=new Map,this._modifiedFeatures=new Map,this._modifiedGraphicsLayer=new B({listMode:`hide`,internal:!0,title:`Connected Reshape Modified Graphics (Internal)`}),this._pendingGraphicsLayer=new B({listMode:`hide`,internal:!0,title:`Connected Reshape Pending Graphics (Internal)`}),this._pendingFeatures=new Map,this._updatingHandles=new t}initialize(){this.view.map.addMany([this._modifiedGraphicsLayer,this._pendingGraphicsLayer])}destroy(){this.view.destroyed||this.view.map.removeMany([this._modifiedGraphicsLayer,this._pendingGraphicsLayer]),this._modifiedGraphicsLayer.destroy(),this._pendingGraphicsLayer.destroy(),this._updatingHandles.destroy()}get updating(){return this._updatingHandles.updating||Array.from(this._activeProviders).some(e=>e.updating)}startFeatureMove(e){this.activeOperationType=0,this._activeProviders.clear();for(let t of this.providerFactories)g(this._activeProviders,t.getFeatureReshapeProvider(e))}startVertexMove(e,t){this.activeOperationType=1,this._activeProviders.clear();for(let n of this.providerFactories)g(this._activeProviders,n.getVertexReshapeProvider(e,t))}finish(){this.activeOperationType=null,this._activeProviders.clear();for(let[e,t]of this._pendingFeatures){this._pendingFeatures.delete(e),this._modifiedFeatures.set(e,t);let n=this._graphics.get(e);n&&(this._modifiedGraphicsLayer.add(n),this._pendingGraphicsLayer.remove(n))}}translate(e,t,n=0){if(this.activeOperationType===null)return;let r=U(e),i=U(t),a=U(n);for(let e of this._activeProviders){let t=e.translate(r,i,a);this._update(t)}}async _initializeGraphic(e,t){e.symbol??=await this._updatingHandles.addPromise(qe(e,{scale:this.view.scale,useSourceLayer:!0})),this._pendingFeatures.has(t.uniqueId)?this._pendingGraphicsLayer.add(e):this._modifiedFeatures.has(t.uniqueId)&&this._modifiedGraphicsLayer.add(e),this.addHandles(await Xe(t.originalGraphic,e,this.view),Ye)}_update(e){for(let t of e){let e=this._modifiedFeatures.delete(t.uniqueId);this._pendingFeatures.set(t.uniqueId,t);let n=c(this._graphics,t.uniqueId,()=>{let e=t.graphic.cloneShallow();return this._initializeGraphic(e,t),e});n.geometry=t.graphic.geometry,e&&(this._modifiedGraphicsLayer.remove(n),this._pendingGraphicsLayer.add(n))}}get test(){return{activeProviders:this._activeProviders,modifiedFeatures:this._modifiedFeatures,modifiedGraphicsLayer:this._modifiedGraphicsLayer,pendingFeatures:this._pendingFeatures,pendingGraphicsLayer:this._pendingGraphicsLayer}}};async function Xe(e,t,n){let r=e.sourceLayer,i=e.getObjectId();if(i==null)return Je().error(`editing:cannot-hide-graphic`,`Unable to hide original graphic because it has no objectId.`),ge();let a=null;function o(e){a?.abort(),a=oe(async t=>{let a=await $e(n,r);ce(t),a&&a.setVisibility?.(i,e)})}return await Qe(n,t),o(!1),L([Ze(n,t,e=>o(!e)),ge(async()=>{o(!0);let e=await $e(n,r);await d(()=>!e?.updating)})])}function Ze(e,t,n){if(e.type===`3d`){let r=new Ve({graphic:t});return L([e.trackGraphicState(r),_(()=>r.displaying,n)])}return _(()=>t.visible,n)}async function Qe(e,t){if(e.type===`3d`){let n=new Ve({graphic:t}),r=e.trackGraphicState(n);await d(()=>n.displaying||n.error),r.remove()}else await d(()=>t.visible)}async function $e(e,t){let n=s(t)||ue(t)?t.parent:t;return n?e.whenLayerView(n):null}function U(e){return isNaN(e)?0:e}a([y()],H.prototype,`activeOperationType`,void 0),a([y()],H.prototype,`providerFactories`,void 0),a([y()],H.prototype,`updating`,null),a([y({constructOnly:!0})],H.prototype,`view`,void 0),H=a([M(`esri.views.draw.support.ConnectedReshapeManager`)],H);var W=class extends Pe{constructor(e){super(e),this.type=`translate-vertex`,this.distance=V,this.elevation=null,this.area=null,this.totalLength=null}clear(){this.distance=V,this.elevation=null,this.area=null,this.totalLength=null}};a([y()],W.prototype,`type`,void 0),a([y()],W.prototype,`distance`,void 0),a([y()],W.prototype,`elevation`,void 0),a([y()],W.prototype,`area`,void 0),a([y()],W.prototype,`totalLength`,void 0),W=a([M(`esri.views.interactive.tooltip.infos.TranslateVertexTooltipInfo`)],W);function et(e){let t={sketchOptions:e,viewType:`2d`};return{movePoint:new Be(t),selectedVertex:new He(t),translateGraphic:new Ue(t),translateVertices:new W(t)}}function tt(e,t){function n(){let e=t(),n=e.sketchOptions.tooltips.effectiveEnabled?e.activeTooltipInfo:null;return{...e,activeTooltipInfo:n}}let r=!1;function i(e){r||=(r=!0,e(),!1)}return L([_(()=>{let e=n();return{context:e,geometry:e.graphic?.geometry,vertexGeometry:e.selectedVertex?.geometry}},({context:t})=>{i(()=>{nt(t),e.info=t.activeTooltipInfo})},fe),_(()=>{let e=n(),{activeTooltipInfo:t}=e;if(t&&`key`in t)return{context:e,key:t.key}},(e,t)=>{e&&t&&e.key!==t.key&&i(()=>ot(e.context))},T),Ne(e,{onBeforePaste:()=>{r=!0},onAfterPaste:()=>{ot(n()),r=!1}})])}function nt(e){let t=e.activeTooltipInfo;if(t){switch(t?.type){case`move-point`:return rt(t,e);case`selected-vertex`:return it(t,e)}t.sketchOptions=e.sketchOptions}}function rt(e,{graphic:t}){at(e,t,t?.geometry)}function it(e,{graphic:t,selectedVertex:n,automaticAreaMeasurementUtils:r,automaticLengthMeasurementUtils:i}){at(e,t,n?.geometry);let a=t?.geometry;if(!a||!be(a))switch(a?.type){case`polygon`:e.geometryType=`polygon`,e.totalLength.visible=!1,e.area.actual=r.autoArea2D(a);break;case`polyline`:e.geometryType=`polyline`,e.totalLength.actual=i.autoLength2D(a),e.area.visible=!1;break;case`multipoint`:e.geometryType=`multipoint`,e.area.visible=!1,e.totalLength.visible=!1}}function at(e,t,n){t&&n?.type===`point`&&(e.setLocationFromPoint(n),e.elevation.actual=Oe(n),e.elevation.visible=!!t.geometry?.hasZ,e.elevation.readOnly=!1,e.elevation.showAsZ=!0)}function ot(e){function t(t,r){let i=r?.geometry;if(!i||i.type!==`point`)return;let{dx:a,dy:o,dz:s}=Ie(t,i);if(a===0&&o===0&&s===0)return;let{x:c,y:l,z:u,m:d,spatialReference:f}=i,p=new n({x:c+a,y:l+o,z:u==null?void 0:u+s,m:d,spatialReference:f});e.updateGeometry(r,p,i,a,o)}let{activeTooltipInfo:r,graphic:i,selectedVertex:a}=e;switch(r?.type){case`move-point`:return t(r,i);case`selected-vertex`:return t(r,a)}}function st(e,t,n,r){e.clear(),lt(e,t,r,n)}function ct(e,t,n,r,i){if(e.clear(),n&&be(n))return;let{automaticAreaMeasurementUtils:a,automaticLengthMeasurementUtils:o}=r;n?.type===`polygon`?e.area=a.autoArea2D(n):n?.type===`polyline`&&(e.totalLength=o.autoLength2D(n)),lt(e,t,i,r)}function lt(e,t,n,{automaticLengthMeasurementUtils:r}){if(!n)return;let{x:i,y:a}=n.origin,o=t.toMap(n),s=t.toMap(te(i,a));e.distance=r.autoDistanceBetweenPoints2D(s,o)??V}var G={pathIndex:`pathIndex`,pointIndex:`pointIndex`,pointIndexStart:`pointIndexStart`,pointIndexEnd:`pointIndexEnd`,controlPointKind:`kind`,relatedGraphicIndices:`relatedGraphicIndices`,curveFromStraightEdgeFlag:`curveFromStraightEdgeFlag`,tool:`esriSketchTool`},K={bezier:{cp1:`bezier-cp-1`,cp2:`bezier-cp-2`,line1:`bezier-line-1`,line2:`bezier-line-2`},circle:{interior:`circle-interior`}},q=Ke.reshapeGraphics,ut={vertices:{default:new f({style:`circle`,size:q.vertex.size,color:q.vertex.color,outline:{color:q.vertex.outlineColor,width:1}}),hover:new f({style:`circle`,size:q.vertex.hoverSize,color:q.vertex.hoverColor,outline:{color:q.vertex.hoverOutlineColor,width:1}}),selected:new f({style:`circle`,size:q.selected.size,color:q.selected.color,outline:{color:q.selected.outlineColor,width:1}})},controlPoints:{default:new f({style:`diamond`,size:q.vertex.size,color:q.vertex.color,outline:{color:q.vertex.outlineColor,width:1}}),hover:new f({style:`diamond`,size:q.vertex.hoverSize,color:q.vertex.hoverColor,outline:{color:q.vertex.hoverOutlineColor,width:1}}),selected:new f({style:`diamond`,size:q.selected.size,color:q.selected.color,outline:{color:q.selected.outlineColor,width:1}})},midpoints:{default:new f({style:`circle`,size:q.midpoint.size,color:q.midpoint.color,outline:{color:q.midpoint.outlineColor,width:1}}),hover:new f({style:`circle`,size:q.midpoint.size,color:q.midpoint.color,outline:{color:q.midpoint.outlineColor,width:1}})},constructionLines:new ne({style:`solid`,width:1,color:q.vertex.color})};function dt(e,t,n){let r=[];return e?.forEach((e,i)=>{e.forEach((e,a)=>{r.push(new h({geometry:n.arrayToPoint(z(e)),symbol:t?.vertices?.default,attributes:{[G.tool]:`box`,[G.pathIndex]:i,[G.pointIndex]:a}}))})}),r}function ft(e,t,n){let r=[];for(let i=0;i<e.length;i++){let a=e[i];if(!gt(e,i))for(let e=1;e<a.length;e++){let s=a[e];if(A(s))continue;let c=z(a[e-1]),l={[G.tool]:`box`,[G.pathIndex]:i,[G.pointIndex]:e};if(R(s)){let e=s.b.slice(1);r.push(...e.map((e,r)=>new h({geometry:n.arrayToPoint(e),symbol:t?.controlPoints?.default,attributes:{...l,[G.controlPointKind]:r===0?K.bezier.cp1:K.bezier.cp2}})))}let u=w(s),d=k(s);if(u||d){let e=u?o(c,s):P(c,s),i=O(e,.25);r.push(new h({geometry:n.arrayToPoint(i),symbol:t?.controlPoints?.default,attributes:{...l,[G.controlPointKind]:K.circle.interior}}))}}}return r}function pt(e,t,n){let r=[],{spatialReference:a}=n;for(let n=0;n<e.length;n++){let o=e[n];for(let e=1;e<o.length;e++){let s=o[e];if(!R(s))continue;let[c,l,u]=s.b,d=z(o[e-1]),f={[G.tool]:`box`,[G.pathIndex]:n,[G.pointIndex]:e};r.push(new h({geometry:new i({paths:[[[d[0],d[1]],l]],spatialReference:a}),symbol:t?.constructionLines,attributes:{...f,[G.controlPointKind]:K.bezier.line1}}),new h({geometry:new i({paths:[[[c[0],c[1]],u]],spatialReference:a}),symbol:t?.constructionLines,attributes:{...f,[G.controlPointKind]:K.bezier.line2}}))}}return r}function mt(e,t,n,r){let i=[];for(let a=0;a<e.length;a++){let o=e[a],s=vt(e,a);for(let e=0;e<o.length;e++){let c=(e+1)%o.length;if((!r||s)&&c===0)continue;let l=ht(o[e],o[c],n);i.push(new h({geometry:l,symbol:t.midpoints.default,attributes:{[G.tool]:`box`,[G.pathIndex]:a,[G.pointIndexStart]:e,[G.pointIndexEnd]:c}}))}}return i}function ht(e,t,r){let i=z(e),a=z(t),{spatialReference:s}=r,c=r.arrayToVector(i),l=r.arrayToVector(a),u=r.toXYZ(c),d=r.toXYZ(l),[f,p,m]=Se(u,d),h=r.hasM()?0:void 0;if(A(t))return new n({x:f,y:p,z:m,m:h,spatialReference:s});if(R(t)){let[e,r]=pe(i,t,.5);return new n({x:e,y:r,z:m,m:h,spatialReference:s})}if(w(t)){let e=o(i,t),[r,a]=O(e,.5);return new n({x:r,y:a,z:m,m:h,spatialReference:s})}if(k(t)){let e=P(i,t),[r,a]=O(e,.5);return new n({x:r,y:a,z:m,m:h,spatialReference:s})}let g=me(i,t),[_,v]=ae(g,.5);return new n({x:_,y:v,z:m,m:h,spatialReference:s})}function gt(e,t){let n=e.at(t);return n?.length===2&&F(z(n[1]),z(n[0]))&&k(n[1])}function _t(e,t){let n=e.at(t);return n?.length===2&&F(z(n[1]),z(n[0]))&&j(n[1])}function vt(e,t){let n=e.at(t);return n?.length===2&&F(z(n[1]),z(n[0]))&&_e(n[1])}function J(e,t){if(v(e))return void(e.points=t.flat());let n=t.some(e=>e.some(e=>!A(e)));m(e)?n?(e.curveRings=t,e.rings=[]):(e.rings=t,e.curveRings=void 0):E(e)&&(n?(e.curvePaths=t,e.paths=[]):(e.curvePaths=void 0,e.paths=t))}function yt(t,n,r,i){let a=z(n),s=[];switch(!0){case R(n):s=e(t,n,r);break;case w(n):{let e=o(t,n);s=x(e,n,r);break}case k(n):{let e=P(t,n);s=se(e,n,r);break}default:{let e=me(t,n);s=de(e,n,r);break}}if(s.length<2)return s;if(i.hasZ()){let e=t.at(2)??0,n=a.at(2)??0,i=e+(n-e)*r;z(s[0])[2]=i,z(s[1])[2]=n}if(i.hasM()){let e=i.hasZ()?3:2;z(s[0])[e]=0,z(s[1])[e]=a.at(-1)??0}return s}var Y=Symbol(),X=class extends C{constructor(e){super(e),this._updateHandlesOnExternalGeometryChange=null,this._activeOperationInfo=null,this._connectedReshapeManager=null,this._editGeometryOperations=null,this._mover=null,this._snappingContext=null,this._snappingGraphicsLayer=null,this._hoverGraphic=null,this._snappingTask=null,this._stagedVertex=null,this.tooltip=null,this.activeTooltipInfo=null,this.callbacks={onReshapeStart(){},onReshape(){},onReshapeStop(){},onMoveStart(){},onMove(){},onMoveStop(){},onGraphicClick(){}},this.connectedReshapeProviders=null,this.enableMidpoints=!0,this.enableCurveOnMidpoint=!1,this.enableMovement=!0,this.enableVertices=!0,this.graphic=null,this.highlightName=null,this.highlightsEnabled=!0,this.layer=null,this.snappingManager=null,this.symbols=ut,this.sketchOptions=new De,this.type=`reshape`,this.vertexGraphics=new S,this.curveControlPointGraphics=new S,this.constructionLineGraphics=new S,this.midpointGraphics=new S,this.selectedManipulators=new S,this.view=null}initialize(){let e=this.view;this._highlightHelper=new We({view:e}),this._setup(),this._updateHandlesOnExternalGeometryChange=r(()=>this.graphic?.geometry,e=>{if(!e)return;let t=new Set(this.selectedManipulators.map(Et));this._highlightHelper.removeAll(),this._setUpHighlights(),this._setupGraphics(),this._clearSelection(),this.vertexGraphics.filter(e=>t.has(Et(e))).forEach(e=>this._addToSelection(e));let{enableMovement:n,_mover:r,graphic:i,midpointGraphics:a,vertexGraphics:o,curveControlPointGraphics:s}=this,c=o.concat(a,s).items;n&&c.push(i),r?.set(`graphics`,c)},T),this.tooltip=Fe(()=>({view:e,options:this.sketchOptions.tooltips})),this.tooltipInfos=et(this.sketchOptions),this.addHandles([ee(()=>e?.ready,()=>{let{layer:e,view:t}=this;Te(t,e),this.addHandles(t.on(`key-down`,e=>this._keyDownHandler(e),ye.TOOL))},{once:!0,initial:!0}),_(()=>this.graphic,()=>this.refresh()),_(()=>this.layer,(e,t)=>{t&&(this._clearSelection(),this._resetGraphics(t)),this.refresh()}),_(()=>[this.highlightsEnabled,this.highlightName],()=>{this._highlightHelper?.removeAll(),this._setUpHighlights()}),_(()=>this.enableMidpoints,()=>this.refresh()),tt(this.tooltip,()=>this._tooltipsContext),_(()=>this.view.effectiveTheme.accentColor,()=>this._updateSymbolsForTheme(),D),this._updateHandlesOnExternalGeometryChange]),this._updateTooltip()}destroy(){this._reset(),this._mover?.destroy(),this._mover=null,this._connectedReshapeManager=N(this._connectedReshapeManager),this.tooltip=N(this.tooltip)}get _coordinateHelper(){return this._editGeometryOperations?.data.coordinateHelper??je(!!this.graphic.geometry?.hasZ,!!this.graphic.geometry?.hasM,this.view.spatialReference)}get _selectedManipulator(){return this.selectedManipulators.length===1?this.selectedManipulators.at(0):void 0}get _tooltipsContext(){let{automaticAreaMeasurementUtils:e,automaticLengthMeasurementUtils:t,sketchOptions:n,activeTooltipInfo:r,graphic:i}=this;return{sketchOptions:n,activeTooltipInfo:r,graphic:i,selectedVertex:this._selectedManipulator,automaticAreaMeasurementUtils:e,automaticLengthMeasurementUtils:t,updateGeometry:(e,t,n,r,i)=>{this._setUpGeometryHelper();let a=e===this.graphic;if(a?this._emitMoveStartEvent(0,0):this._emitReshapeStartEvent(e),this._syncGeometryAfterVertexMove(e,t,r,i,!0),a){let{view:e}=this,r=e.toScreen(n),i=e.toScreen(t),a=(i?.x??0)-(r?.x??0),o=(i?.y??0)-(r?.y??0);this._emitMoveEvent(a,o),this._emitMoveStopEvent(a,o)}else this._emitReshapeEvent(e),this._emitReshapeStopEvent(e);this._editGeometryOperations=N(this._editGeometryOperations)}}}get state(){let e=this.view.ready,t=!(!this.graphic||!this.layer);return e&&t?`active`:e?`ready`:`disabled`}isUIGraphic(e){return e===this.graphic||this._isMidpoint(e)||this._isCurveControlPoint(e)||this._isVertex(e)||this._isConstructionLine(e)}refresh(){this._reset(),this._setup()}reset(){this.graphic=null}clearSelection(){this._clearSelection()}removeSelectedVertices(){let{selectedManipulators:e}=this;e.length&&this._removeVertices(e)}_setup(){let{graphic:e,layer:t}=this;if(!t||e?.geometry==null)return;let n=e.geometry;n.type!==`mesh`&&n.type!==`extent`?(n.type===`polygon`&&u(n),this._setUpHighlights(),this._setupGraphics(),this._setupMover(),this._setupConnectedReshapeManager()):this._logGeometryTypeError()}_setUpHighlights(){this.highlightsEnabled&&this.graphic&&this._highlightHelper?.add(this.graphic,this.highlightName)}_setUpGeometryHelper(){let e=this.graphic.geometry;e!=null&&e.type!==`mesh`&&e.type!==`extent`?this._editGeometryOperations??=ke.fromGeometry(e,2,{allowCurves:!0}):this._logGeometryTypeError()}_saveSnappingContextForHandle(e,t){this._snappingGraphicsLayer=new B({listMode:`hide`,internal:!0,title:`Reshape snapping layer`}),this.view.map.layers.add(this._snappingGraphicsLayer);let n=this._editGeometryOperations;I(n),this._snappingContext=new Ae({editGeometryOperations:n,elevationInfo:{mode:`on-the-ground`,offset:0},pointer:t.viewEvent?.pointerType||`mouse`,excludeFeature:this.graphic,feature:this.graphic,visualizer:new Me(this._snappingGraphicsLayer),vertexHandle:this._getVertexFromEditGeometry(e)})}_reset(){this._clearSelection(),this._highlightHelper?.removeAll(),this._updateTooltip(),this._resetGraphics(),this._resetSnappingStateVars(),this._activeOperationInfo=null,this._mover?.destroy(),this._mover=null,this.removeHandles(Y)}_resetSnappingStateVars(){this.snappingManager!=null&&this.snappingManager.doneSnapping(),this._snappingGraphicsLayer!=null&&(this.view?.map&&this.view.map.layers.remove(this._snappingGraphicsLayer),this._snappingGraphicsLayer.destroy()),this._editGeometryOperations=N(this._editGeometryOperations),this._snappingTask=ie(this._snappingTask),this._snappingTask=null,this._snappingContext=null,this._stagedVertex=null}_resetGraphics(e){this._removeMidpointGraphics(e),this._removeVertexGraphics(e),this._removeCurveGraphics(e),this._updateTooltip()}_removeMidpointGraphics(e=this.layer){let{midpointGraphics:t}=this;e?.removeMany(t.items),t.drain(N)}_removeVertexGraphics(e=this.layer){let{vertexGraphics:t}=this;e?.removeMany(t.items),t.drain(N)}_removeCurveGraphics(e=this.layer){let{curveControlPointGraphics:t,constructionLineGraphics:n}=this;e?.removeMany(t.items),e?.removeMany(n.items),t.drain(N),n.drain(N)}_setupGraphics(){let e=this.graphic.geometry;if(e!=null&&(e.type===`polyline`||e.type===`polygon`||e.type===`multipoint`)){let t=bt(e);this.enableMidpoints&&e.type!==`multipoint`&&this._setUpMidpointGraphics(t),this.enableVertices&&(this._setUpVertexGraphics(t),this._setupCurveGraphics(t))}}_setUpMidpointGraphics(e){this._removeMidpointGraphics();let t=mt(e,this.symbols,this._coordinateHelper,this.graphic.geometry?.type===`polygon`);this.midpointGraphics.addMany(t),this.layer.addMany(t)}_setUpVertexGraphics(e){this._removeVertexGraphics();let t=dt(e,this.symbols,this._coordinateHelper);this.vertexGraphics.addMany(t),this._storeRelatedVertexIndices(),this.layer.addMany(t)}_setupCurveGraphics(e){this._removeCurveGraphics();let t=ft(e,this.symbols,this._coordinateHelper),n=pt(e,this.symbols,this._coordinateHelper);this.curveControlPointGraphics.addMany(t),this.constructionLineGraphics.addMany(n),this.layer.addMany(n),this.layer.addMany(t)}_updateSymbolsForTheme(){let e=this.view.effectiveTheme.accentColor;this.symbols={vertices:{...this.symbols.vertices,default:this.symbols.vertices.default.clone().set(`color`,e),hover:this.symbols.vertices.hover?.clone().set(`color`,e)},controlPoints:{...this.symbols.controlPoints,default:this.symbols.controlPoints.default.clone().set(`color`,e),hover:this.symbols.controlPoints.hover?.clone().set(`color`,e)},midpoints:{...this.symbols.midpoints},constructionLines:this.symbols.constructionLines.clone().set(`color`,e)};for(let e of this.vertexGraphics)this._isSelected(e)?e.symbol=this.symbols.vertices.selected:this._hoverGraphic===e?e.symbol=this.symbols.vertices.hover:e.symbol=this.symbols.vertices.default;for(let e of this.curveControlPointGraphics)this._isSelected(e)?e.symbol=this.symbols.controlPoints.selected:this._hoverGraphic===e?e.symbol=this.symbols.controlPoints.hover:e.symbol=this.symbols.controlPoints.default;for(let e of this.constructionLineGraphics)e.symbol=this.symbols.constructionLines}_storeRelatedVertexIndices(){let e=this.vertexGraphics.items;if(!e)return;let t=e.map(({geometry:e})=>({x:e.x,y:e.y}));for(let n=0;n<t.length;n++){let r=[];for(let e=0;e<t.length;e++){if(n===e)continue;let i=t[n],a=t[e];i.x===a.x&&i.y===a.y&&r.push(e)}e[n].attributes[G.relatedGraphicIndices]=r}}_setupMover(){let{enableMovement:e,graphic:t,midpointGraphics:n,vertexGraphics:r,view:i}=this,a=r.concat(n,this.curveControlPointGraphics).items;e&&t.geometry?.type!==`multipoint`&&a.push(t),this._mover=new Ge({enableMoveAllGraphics:!1,highlightsEnabled:!1,indicatorsEnabled:!1,graphics:a,view:i,callbacks:{onGraphicClick:e=>this._onGraphicClickCallback(e),onGraphicMoveStart:e=>this._onGraphicMoveStartCallback(e),onGraphicMove:e=>this._onGraphicMoveCallback(e),onGraphicMoveStop:e=>this._onGraphicMoveStopCallback(e),onGraphicPointerOver:e=>this._onGraphicPointerOverCallback(e),onGraphicPointerOut:e=>this._onGraphicPointerOutCallback(e)}})}_setupConnectedReshapeManager(){let{connectedReshapeProviders:e}=this;e!=null&&e.length!==0&&(this._connectedReshapeManager=new H({providerFactories:e,view:this.view}))}_onGraphicClickCallback(e){e.viewEvent.stopPropagation();let t=e.graphic,n=this._isCurveControlPoint(t);if(t===this.graphic)this.clearSelection(),this.emit(`graphic-click`,e),this.callbacks.onGraphicClick?.(e);else if(this._isMidpoint(t)){if(e.viewEvent.button===2)return;let n=this.graphic.clone(),r=this._handleMidpointClickOrStartMove(e);this.refresh(),r.length&&this._emitVertexAddEvent([t],n,r)}else if(this._isVertex(t)||n){if(e.viewEvent.stopPropagation(),e.viewEvent.button===2)return void(n||this._removeVertices(t));e.viewEvent.native.shiftKey||this._clearSelection(),this.selectedManipulators.includes(t)?this._removeFromSelection(t,!0):this._addToSelection(t)}}_setUpOperation(e){let{graphic:t,dx:n,dy:r}=e,i=t===this.graphic;this._resetSnappingStateVars(),this._setUpGeometryHelper(),this._saveSnappingContextForHandle(t,e),this._activeOperationInfo={target:this.graphic,mover:t,operationType:i?`move`:`reshape`,totalDx:n,totalDy:r}}_onGraphicMoveStartCallback(e){let{dx:t,dy:n,graphic:r}=e,i=this._connectedReshapeManager,a=i?Ot(this.graphic):null;if(r===this.graphic){let{geometry:o}=r;this._setUpOperation(e),this._emitMoveStartEvent(t,n),a&&i?.startFeatureMove([a]),o!=null&&o.type===`point`&&this._onHandleMove(r,t,n,e,()=>{this._updateTooltip(this.graphic,e.viewEvent),this._emitMoveEvent(t,n)});return}let{selectedManipulators:o}=this;if(!o.includes(r)){if(this._clearSelection(),this._isMidpoint(r)){let t=this.graphic.clone(),n=this._handleMidpointClickOrStartMove(e);n.length&&(this._emitVertexAddEvent([r],t,n),this._refreshGraphicIndicesAttributes(n[0]))}this._addToSelection(r)}if(this._setUpOperation(e),a){let e=o.filter(e=>this._isVertex(e));i?.startVertexMove(a,kt(e))}this._emitReshapeStartEvent(r),this._onHandleMove(r,t,n,e,()=>{this._updateTooltip(r,e.viewEvent),this._emitReshapeEvent(r)})}_onGraphicMoveCallback(e){let t=this._activeOperationInfo;if(!t)return;let{dx:n,dy:r,graphic:i}=e;t.totalDx+=n,t.totalDy+=r;let{operationType:a}=t,{geometry:o}=i;if(o!=null){if(a!==`move`)this._onHandleMove(i,n,r,e,()=>{this._updateTooltip(i,e.viewEvent),this._emitReshapeEvent(i)});else if(o.type===`point`)this._onHandleMove(i,n,r,e,()=>{this._updateTooltip(this.graphic,e.viewEvent),this._emitMoveEvent(n,r)});else if(o.type===`polyline`||o.type===`polygon`){let t=bt(o);this._updateVertexGraphicLocations(t);let{dxMap:i,dyMap:a}=ze(n,r,this.view);this._connectedReshapeManager?.translate(i,a,0),this._updateTooltip(this.graphic,e.viewEvent),this._emitMoveEvent(n,r)}}}_onGraphicMoveStopCallback(e){let t=this._activeOperationInfo;if(!t)return;let{dx:n,dy:r,graphic:i}=e,{operationType:a}=t;t.totalDx+=n,t.totalDy+=r,this._onHandleMove(i,n,r,e,()=>a===`move`?this._emitMoveStopEvent():this._emitReshapeStopEvent(i)),this._isMidpoint(i)||i.getAttribute(G.curveFromStraightEdgeFlag)?this.refresh():(this._updateTooltip(this._isVertex(i)?i:null),this._resetSnappingStateVars(),this._connectedReshapeManager?.finish(),this._activeOperationInfo=null)}_updateVertexGraphicLocations(e){let{_coordinateHelper:t}=this;for(let n of this.vertexGraphics){let{pathIndex:r,pointIndex:i}=n.attributes;n.geometry=t.arrayToPoint(z(e[r][i]))}this._updateMidpointGraphicLocations(e),this._updateCurveGraphicLocations(e)}_updateMidpointGraphicLocations(e){let{_coordinateHelper:t}=this;for(let n of this.midpointGraphics){let{pathIndex:r,pointIndexStart:i,pointIndexEnd:a}=n.attributes,o=e[r];n.geometry=ht(o[i],o[a],t)}}_updateCurveGraphicLocations(e){let{spatialReference:t}=this._coordinateHelper,r=new Map;for(let e of this.selectedManipulators){let[t,n]=$(e);t!=null&&n!=null&&e.getAttribute(G.controlPointKind)&&c(r,t,()=>new Set)?.add(n)}for(let t of this.curveControlPointGraphics){let[i,a]=$(t);if(r.get(i)?.has(a))continue;let s=e[i][a];if(w(s)||k(s)){let r=z(e[i][a-1]),c=w(s)?o(r,s):P(r,s),[l,u]=O(c,.25);t.geometry=new n({x:l,y:u,spatialReference:this._coordinateHelper.spatialReference})}else if(R(s)){let[e,r]=t.getAttribute(G.controlPointKind)===K.bezier.cp1?s.b[1]:s.b[2];t.geometry=new n({x:e,y:r,spatialReference:this._coordinateHelper.spatialReference})}}for(let n of this.constructionLineGraphics){let r=n.getAttribute(G.controlPointKind),[a,o]=$(n),s=e[a],c=z(s[o-1]),l=z(s[o]),u=e[a][o];r===K.bezier.line1?n.geometry=new i({paths:[[[c[0],c[1]],[...u.b[1]]]],spatialReference:t}):n.geometry=new i({paths:[[[l[0],l[1]],[...u.b[2]]]],spatialReference:t})}}_refreshGraphicIndicesAttributes(e){let{componentIndex:t,vertexIndex:n}=e,r=e=>{let[r,i]=$(e);r===t&&i>=n&&e.setAttribute(G.pointIndex,i+1)};this.vertexGraphics.forEach(r),this.curveControlPointGraphics.forEach(r),this.constructionLineGraphics.forEach(r);for(let e of this.midpointGraphics){if(e.getAttribute(G.pathIndex)!==t)continue;let r=e.getAttribute(G.pointIndexStart);r>=n&&(e.setAttribute(G.pointIndexStart,r+1),e.setAttribute(G.pointIndexEnd,e.getAttribute(G.pointIndexEnd)+1))}}_getVertexFromEditGeometry(e){let[t,n]=$(e);return I(this._editGeometryOperations),this._editGeometryOperations.data.parts[t].vertices[n]}_onHandleMove(e,t,r,i,a){ie(this._snappingTask);let o=this._snappingContext;if(!o)return;let s=e.geometry,c=i.type===`graphic-move-stop`;if(s&&p(s))if(this.snappingManager!=null&&this.selectedManipulators.length<2&&!c){let i=this.snappingManager;this._stagedVertex=i.update({point:s,context:o}),this._syncGeometryAfterVertexMove(e,new n(this._stagedVertex),t,r,c),a(),this._snappingTask=oe(async l=>{let u=await i.snap({point:s,context:o,signal:l});u.valid&&(this._stagedVertex=u.apply(),this._syncGeometryAfterVertexMove(e,new n(this._stagedVertex),t,r,c),a())})}else{let i=this._stagedVertex==null?s:new n(this._stagedVertex);this._syncGeometryAfterVertexMove(e,i,t,r,c),a()}else a()}_syncGeometryAfterVertexMove(e,t,n,r,i=!1){let a=this._editGeometryOperations?.data.geometry;if(!a)return;let{_coordinateHelper:o}=this,s=o.pointToVector(t),c=this._getVertexFromEditGeometry(e);if(c){let e=o.getZ(s),t=s[0]-c.pos[0],n=s[1]-c.pos[1],r=e==null?0:e-c.pos[2];a.type!==`point`&&a.type!==`mesh`||this._editGeometryOperations?.moveVertices([c],t,n,r),this._connectedReshapeManager?.translate(t,n,r)}if(a.type===`point`)e.geometry=t;else if(a.type===`mesh`)e.geometry=a.centerAt(t);else{if(e!==this.graphic){let i=o.spatialReference,[s,c]=$(e),l=Z(a),u=o.pointToArray(t);this._updateGeometryFromGraphic(e,l,s,c,u,i,a.type===`polygon`),this._isVertex(e)||this._isCurveControlPoint(e)?(l=this._moveRelatedCoordinates(l,e,u),l=this._moveSelectedHandleCoordinates(l,e,n,r,a.type===`polygon`),this._updateMidpointGraphicLocations(l),this._updateCurveGraphicLocations(l)):this._isMidpoint(e)&&this._updateCurveGraphicLocations(l),J(a,l)}this._updateGraphicGeometry(a.clone()),this._editGeometryOperations=ke.fromGeometry(a,2,{allowCurves:!0}),i&&(this._mover?this._mover.updateGeometry(this._mover.graphics.indexOf(e),t):e.geometry=t)}}_moveRelatedCoordinates(e,t,n){let{relatedGraphicIndices:r}=t.attributes,i=this._coordinateHelper.spatialReference;if(!r?.length)return e;for(let a of r){let r=this.vertexGraphics.at(a),[o,s]=$(r);Q(e,o,s,n,i),r.geometry=t.geometry}return e}_moveSelectedHandleCoordinates(e,t,n,r,i){let a=this._coordinateHelper.spatialReference;for(let o of this.selectedManipulators)if(o!==t){let[t,s]=$(o),c=o.getAttribute(G.relatedGraphicIndices),l=Re(o.geometry,n,r,this.view),u=xe(l);if(o.geometry=l,this._updateGeometryFromGraphic(o,e,t,s,u,a,i),c?.length)for(let t of c){let n=this.vertexGraphics.at(t),[r,i]=$(n);Q(e,r,i,u,a),n.geometry=l}}return e}_updateGeometryFromGraphic(e,t,n,r,i,a,o){let s=t[n].length-1;this._isCurveControlPoint(e)?St(t,n,r,[i[0],i[1]],e.getAttribute(G.controlPointKind)):(Q(t,n,r,i,a),o&&(r===0?Q(t,n,s,i,a):r===s&&(t[n][0]=i)))}_onGraphicPointerOverCallback(e){let t=e.graphic;this._hoverGraphic=t;let n=this._isVertex(t);n&&!this._isSelected(t)?t.symbol=this.symbols.vertices.hover:this._isCurveControlPoint(t)&&!this._isSelected(t)&&(t.symbol=this.symbols.controlPoints.hover),this._updateTooltip(n?t:null),this._updateHoverCursor(t)}_onGraphicPointerOutCallback(e){let t=e.graphic;this._hoverGraphic=null,this._isVertex(t)&&!this._isSelected(t)&&(t.symbol=this.symbols.vertices.default),this._isCurveControlPoint(t)&&!this._isSelected(t)&&(t.symbol=this.symbols.controlPoints.default),this.removeHandles(Y),this._updateTooltip()}_handleMidpointClickOrStartMove(e){let{graphic:t}=e,n=this.graphic.geometry;if(n==null||n.type!==`polygon`&&n.type!==`polyline`)return[];let r=n.clone(),i=[],{[G.pathIndex]:a,[G.pointIndexStart]:o,[G.pointIndexEnd]:s}=t.attributes,c=xe(t.geometry),l=s===0?o+1:s;t.attributes={[G.tool]:`box`,[G.pathIndex]:a,[G.pointIndex]:l,[G.relatedGraphicIndices]:[]};let u=Z(r),d=u[a][s];if(A(d))if(this.enableCurveOnMidpoint&&e.viewEvent.native.shiftKey){let e=z(u[a][l]);u[a].splice(l,1,{c:[e,[c[0],c[1]]]}),t.setAttribute(G.controlPointKind,K.circle.interior),t.setAttribute(G.curveFromStraightEdgeFlag,!0),this.midpointGraphics.remove(t),this.curveControlPointGraphics.push(t),J(r,u)}else u[a].splice(l,0,c),i.push({coordinates:u[a][l],componentIndex:a,vertexIndex:l});else{let e=z(u[a][o]),t=yt(e,d,.5,this._coordinateHelper);u[a].splice(s,1,...t),i.push({coordinates:z(u[a][l]),componentIndex:a,vertexIndex:l})}return this._updateGraphicGeometry(r),i}_addToSelection(e){let t=Dt(e);for(let e of t)this._isCurveControlPoint(e)?e.symbol=this.symbols.controlPoints.selected:e.symbol=this.symbols.vertices.selected,this.selectedManipulators.add(e),this._updateTooltip(e);this._emitSelectEvent(t)}_removeFromSelection(e,t){if(this._isVertex(e)){let{vertices:n}=this.symbols;e.symbol=t?n.hover:n.default}else if(this._isCurveControlPoint(e)){let{controlPoints:n}=this.symbols;e.symbol=t?n.hover:n.default}this.selectedManipulators.remove(e),this._emitDeselectEvent([e]),this._updateTooltip()}_clearSelection(){let e=this.selectedManipulators.toArray(),{controlPoints:t,vertices:n}=this.symbols;if(e.length>0){for(let r of e)this._isVertex(r)?r.symbol=n.default:this._isCurveControlPoint(r)&&(r.symbol=t.default);this.selectedManipulators.removeAll(),this._emitDeselectEvent(e),this._updateTooltip()}}_keyDownHandler(e){this._activeOperationInfo==null&&Le(e,this.tooltip)||ve.delete.includes(e.key)&&!e.repeat&&this.selectedManipulators.length&&this._removeVertices(this.selectedManipulators)}_removeVertices(e){let t=this.graphic.geometry,n=this.vertexGraphics.length;if(t==null||t.type!==`polygon`&&t.type!==`polyline`&&t.type!==`multipoint`||t.type===`polygon`&&n<4||t.type===`multipoint`&&n<2||t.type===`polyline`&&n<3)return;let r=this.graphic.clone(),i=t.clone(),a=Z(i),o=[],s=Dt(e);for(let e of s){if(this._isCurveControlPoint(e))continue;let{x:t,y:n}=e.geometry;for(let e=0;e<a.length;e++){let r=a[e];for(let i=0;i<r.length;i++){let[s,c]=z(r[i]);if(t===s&&n===c){o.push({coordinates:z(a[e][i]),componentIndex:e,vertexIndex:i}),a[e].splice(Number(i),1);let t=a[e][i];t&&!A(t)&&(a[e][i]=z(t))}}}}if(i.type===`polygon`)a=a.filter(e=>{if(e.length<2)return!1;let[t,n]=z(e[0]),[r,i]=z(e[e.length-1]);return(e.length!==2||t!==r||n!==i)&&(t===r&&n===i||e.push(e[0]),!0)});else if(i.type===`polyline`)for(let e of a)e.length===1&&a.splice(a.indexOf(e),1);J(i,a),this._updateGraphicGeometry(i),this.refresh(),this._emitVertexRemoveEvent(s,r,o)}_isVertex(e){return this.vertexGraphics.includes(e)}_isCurveControlPoint(e){return this.curveControlPointGraphics.includes(e)}_isConstructionLine(e){return this.constructionLineGraphics.includes(e)}_isSelected(e){return(this._isVertex(e)||this.curveControlPointGraphics.includes(e))&&this.selectedManipulators.includes(e)}_isMidpoint(e){return this.midpointGraphics.includes(e)}_updateHoverCursor(e){let t=this._isMidpoint(e)?`copy`:`move`;this.addHandles(this.view.acquireCursor(t,`high`),Y)}_updateTooltip(e,t){let n=null,{graphic:r,view:i,tooltipInfos:a}=this,o=r?.geometry;o?.type===`point`?n=a.movePoint:this._selectedManipulator?n=a.selectedVertex:e===this.graphic?(n=a.translateGraphic,st(n,i,this._tooltipsContext,t)):e&&this.selectedManipulators.length>1&&(n=a.translateVertices,ct(n,i,o,this._tooltipsContext,t)),this.activeTooltipInfo=n}_updateGraphicGeometry(e){this._updateHandlesOnExternalGeometryChange?.pause(),this.graphic.geometry=e,this._updateHandlesOnExternalGeometryChange?.resume()}_emitMoveStartEvent(e,t){let n={type:`move-start`,mover:this.graphic,dx:e,dy:t};this.emit(`move-start`,n),this.callbacks.onMoveStart?.(n)}_emitMoveEvent(e,t){let n={type:`move`,mover:this.graphic,dx:e,dy:t};this.emit(`move`,n),this.callbacks.onMove?.(n)}_emitMoveStopEvent(e,t){if(e==null||t==null){let n=this._activeOperationInfo;if(!n)return;e=n.totalDx,t=n.totalDy}let n={type:`move-stop`,mover:this.graphic,dx:e,dy:t};this.emit(`move-stop`,n),this.callbacks.onMoveStop?.(n)}_emitReshapeStartEvent(e){let t={type:`reshape-start`,graphic:this.graphic,mover:e,selected:this.selectedManipulators.toArray()};this.emit(`reshape-start`,t),this.callbacks.onReshapeStart?.(t)}_emitReshapeEvent(e){let t={type:`reshape`,graphic:this.graphic,mover:e,selected:this.selectedManipulators.toArray()};this.emit(`reshape`,t),this.callbacks.onReshape?.(t)}_emitReshapeStopEvent(e){let t={type:`reshape-stop`,graphic:this.graphic,mover:e,selected:this.selectedManipulators.toArray()};this.emit(`reshape-stop`,t),this.callbacks.onReshapeStop?.(t)}_emitSelectEvent(e){let t={type:`vertex-select`,added:e};this.emit(`select`,t),this.callbacks.onVertexSelect?.(t)}_emitDeselectEvent(e){let t={type:`vertex-deselect`,removed:e};this.emit(`deselect`,t),this.callbacks.onVertexDeselect?.(t)}_emitVertexAddEvent(e,t,n){let r={type:`vertex-add`,added:e,graphic:this.graphic,oldGraphic:t,vertices:n};this.emit(`vertex-add`,r),this.callbacks.onVertexAdd?.(r)}_emitVertexRemoveEvent(e,t,n){let r={type:`vertex-remove`,removed:e,graphic:this.graphic,oldGraphic:t,vertices:n};this.emit(`vertex-remove`,r),this.callbacks.onVertexRemove?.(r)}_logGeometryTypeError(){he.getLogger(this).error(new re(`reshape:invalid-geometry`,`Reshape operation not supported for the provided graphic. The geometry type is not supported.`))}};function bt(e){let t=Z(e.clone());if(e.type===`polygon`)for(let e of t){let t=e[e.length-1];if(!A(t))continue;let n=e[0];n[0]===t[0]&&n[1]===t[1]&&e.length>2&&e.pop()}return t}function Z(e){return e.type===`polygon`?e.curveRings?.slice()??e.rings.slice():e.type===`polyline`?e.curvePaths?.slice()??e.paths.slice():e.points.map(e=>[e])}function xt(e,t,n,r){let i=e[t][n];if(w(i))i.c[1]=r;else if(k(i)){let i=z(e[t][n]);e[t][n]={c:[i,r]}}}function St(e,t,n,r,i){switch(i){case K.circle.interior:xt(e,t,n,r);break;case K.bezier.cp1:e[t][n].b[1]=r;break;case K.bezier.cp2:e[t][n].b[2]=r}}function Ct(e,t){return e<1e-8*t}function wt(e,{cx:t,cy:n,isInvalid:r,thetaStart:i,thetaEnd:a},o,s){let[c,l]=e,[u,d]=o,f=u-c,p=d-l;t-=c,n-=l;let m=s?i>a:i<a,[h,g]=r?[t,n]:m?[-n,t]:[n,-t],[_,v]=[f,p],[y,b]=[h,g],x=_*b-v*y,S=(f**2+p**2)/2;if(Ct(Math.abs(x),S))return[(c+u)/2,(l+d)/2];let[C,w]=[b/x*S,-y/x*S],ee=C**2+w**2,[T,E]=[f/2-C,p/2-w];if(Ct(T**2+E**2,ee)){let[e,t]=m?[-w,C]:[w,-C];return[e+C+c,t+w+l]}let D=Math.sqrt((C**2+w**2)/(T**2+E**2))*Math.sign(f*h+p*g);return[T*D+C+c,E*D+w+l]}function Tt(e,t,n){let r=we(new i({curvePaths:[[e,t]],spatialReference:n})),{curvePaths:a}=Ce(r,n),o=a[0][1];return j(o)?o:l(e,o)}function Q(e,t,n,r,i){let a=e[t][n],s=e[t].at(n+1);if(gt(e,t)){let n=e[t][1];e[t][0]=[...r],e[t][1]={a:[[...r],[...n.a[1]],0,0]};return}if(_t(e,t)){let n=e[t][1],[i,a]=n.a[1],[o,s]=r,c=Math.hypot(o-i,s-a),[l,u]=[o-i,s-a],d=le(u,l);e[t][0]=[...r],e[t][1]={a:[[...r],[...n.a[1]],0,0,d,c,n.a[6]]};return}let c=z(a);if(A(a))a.splice(0,a.length,...r);else if(R(a))a.b[0].splice(0,a.b[0].length,...r);else if(w(a)||k(a)){let i=z(e[t][n-1]),s=w(a)?o(i,a):P(i,a);e[t].splice(n,1,{c:[[...r],wt(i,s,r,!0)]})}else if(j(a)){a.a[0].splice(0,a.a[0].length,...r);let o=z(e[t][n-1]);a.a=Tt(o,a,i).a}if(s&&!A(s)&&!R(a)){if(w(s)||k(s)){let i=z(s),a=w(s)?o(c,s):P(c,s);e[t].splice(n+1,1,{c:[i,wt(i,a,r,!1)]})}else if(j(s)){let e=z(a);s.a=Tt(e,s,i).a}}}function $({attributes:e}){return[e?.[G.pathIndex]||0,e?.[G.pointIndex]||0]}function Et({attributes:e}){return`${e?.[G.pathIndex]}-${e?.[G.pointIndex]}`}function Dt(e){return e instanceof h?[e]:[...e]}function Ot(e){let t=e.sourceLayer??e.layer;return Ee(t)?{graphic:e,layer:t}:null}function kt(e){return e.toArray().map(({attributes:e})=>({pathIndex:e[G.pathIndex],vertexIndex:e[G.pointIndex]}))}a([y()],X.prototype,`_activeOperationInfo`,void 0),a([y()],X.prototype,`_connectedReshapeManager`,void 0),a([y()],X.prototype,`_coordinateHelper`,null),a([y()],X.prototype,`_editGeometryOperations`,void 0),a([y()],X.prototype,`tooltip`,void 0),a([y()],X.prototype,`tooltipInfos`,void 0),a([y()],X.prototype,`activeTooltipInfo`,void 0),a([y({constructOnly:!0})],X.prototype,`automaticAreaMeasurementUtils`,void 0),a([y({constructOnly:!0})],X.prototype,`automaticLengthMeasurementUtils`,void 0),a([y()],X.prototype,`_selectedManipulator`,null),a([y()],X.prototype,`_tooltipsContext`,null),a([y()],X.prototype,`callbacks`,void 0),a([y()],X.prototype,`connectedReshapeProviders`,void 0),a([y()],X.prototype,`enableMidpoints`,void 0),a([y()],X.prototype,`enableCurveOnMidpoint`,void 0),a([y()],X.prototype,`enableMovement`,void 0),a([y()],X.prototype,`enableVertices`,void 0),a([y()],X.prototype,`graphic`,void 0),a([y()],X.prototype,`highlightName`,void 0),a([y()],X.prototype,`highlightsEnabled`,void 0),a([y()],X.prototype,`layer`,void 0),a([y()],X.prototype,`snappingManager`,void 0),a([y({readOnly:!0})],X.prototype,`state`,null),a([y()],X.prototype,`symbols`,void 0),a([y({type:De})],X.prototype,`sketchOptions`,void 0),a([y({readOnly:!0})],X.prototype,`type`,void 0),a([y({readOnly:!0})],X.prototype,`vertexGraphics`,void 0),a([y({readOnly:!0})],X.prototype,`curveControlPointGraphics`,void 0),a([y({readOnly:!0})],X.prototype,`constructionLineGraphics`,void 0),a([y({readOnly:!0})],X.prototype,`midpointGraphics`,void 0),a([y({readOnly:!0})],X.prototype,`selectedManipulators`,void 0),a([y()],X.prototype,`view`,void 0),X=a([M(`esri.views.draw.support.Reshape`)],X);var At=X;export{At as default};