import{Ax as e,Lb as t,RS as n,Ux as r,_E as i,eg as a,ft as o,jS as s,lm as c,pt as l,sm as u}from"./index-BqmCqmfp.js";import{h as d,n as f}from"./utils-BcHO3hev.js";import{c as p}from"./quantizationUtils-C5shine1.js";import{i as m}from"./utils-DD1PtgG7.js";var h=null,g=/^(?<hh>([01][0-9])|(2[0-3])):(?<mm>[0-5][0-9])(:(?<ss>[0-5][0-9]))?(\.(?<ms>\d+))?$/;function _(e,t,n){return e.x<0?e.x+=t:e.x>n&&(e.x-=t),e}function v(t,r,i,a){let o=n(i)?s(i):null,c=o?Math.round((o.valid[1]-o.valid[0])/r.scale[0]):null;return t.map(t=>{let n=new e(t.geometry);return p(r,n,n),t.geometry=o?_(n,c??0,a[0]):n,t})}function y(e,t=18,n,r,i){let s=new Float64Array(r*i);t=Math.round(a(t));let c=1/0,u=-1/0,d=l(n);for(let{geometry:n,attributes:a}of e){let{x:e,y:l}=n,f=Math.max(0,e-t),p=Math.max(0,l-t),m=Math.min(i,l+t),h=Math.min(r,e+t),g=+d(a);for(let n=p;n<m;n++)for(let i=f;i<h;i++){let a=n*r+i,d=o(i-e,n-l,t)*g,f=s[a]+=d;c=Math.min(c,f),u=Math.max(u,f)}}return{min:c,max:u}}function b(e){let n=g.exec(e);if(!n)return null;let{hh:r,mm:i,ss:a,ms:o}=n.groups;return Number(r)*t.hours+Number(i)*t.minutes+Number(a)*t.seconds+Number(o||0)}async function x(e,t,n=!0){if(!t)return[];let{field:i,field2:a,field3:o,fieldDelimiter:s,fieldInfos:l,timeZone:p}=e,g=i&&l?.find(e=>e.name.toLowerCase()===i.toLowerCase()),_=!!g&&u(g),v=!!g&&m(g),y=e.valueExpression,x=e.normalizationType,S=e.normalizationField,C=e.normalizationTotal,w=[],T=e.viewInfoParams,E=null,D=null;if(y){if(!h){let{arcadeUtils:e}=await c();h=e}h.hasGeometryOperations(y)&&await h.enableGeometryOperations(),E=h.createFunction(y),D=T?h.getViewInfo({viewingMode:T.viewingMode,scale:T.scale,spatialReference:new r(T.spatialReference)}):null}let O=e.fieldInfos,k=!(t[0]&&`declaredClass`in t[0]&&t[0].declaredClass===`esri.Graphic`)&&O?{fields:O}:null;return t.forEach(e=>{let t=e.attributes,r;if(y){let t=k?Object.assign({},e,{layer:k}):e,n=h.createExecContext(t,D,p);r=h.executeFunction(E,n)}else t&&(r=t[i],a?(r=`${d(r)}${s}${d(t[a])}`,o&&(r=`${r}${s}${d(t[o])}`)):typeof r==`string`&&n&&(v?r=r?new Date(r).getTime():null:_&&(r=r?b(r):null)));if(x&&typeof r==`number`&&isFinite(r)){let e=t&&parseFloat(t[S]);r=f(r,x,e,C)}w.push(r)}),w}function S(e){let t=e.field,n=e.normalizationType,r=e.normalizationField,i;return n===`field`?i=`(NOT `+r+` = 0)`:n!==`log`&&n!==`natural-log`&&n!==`square-root`||(i=`(${t} > 0)`),i}function C(e,t,n){let r=t==null?``:e+` >= `+t,i=n==null?``:e+` <= `+n,a=``;return a=r&&i?w(r,i):r||i,a?`(`+a+`)`:``}function w(e,t){let n=e??``;return t!=null&&t&&(n=n?`(`+n+`) AND (`+t+`)`:t),n}function T(e,t){if(e&&e.spatialRelationship!==`intersects`)return new i(t,`Only 'intersects' spatialRelationship is supported for featureFilter`)}function E(e,t,n){let r=D({layer:e,fields:t});if(r.length)return new i(n,`Unknown fields: `+r.join(`, `)+`. You can only use fields defined in the layer schema`);let a=O({layer:e,fields:t});return a.length?new i(n,`Unsupported fields: `+a.join(`, `)+`. You can only use fields that can be fetched i.e. AdapterFieldUsageInfo.supportsStatistics must be true`):void 0}function D(e){let t=e.layer;return e.fields.filter(e=>!t.getField(e))}function O(e){let t=e.layer;return e.fields.filter(e=>{let n=t.getFieldUsageInfo(e);return!n||!n.supportsStatistics})}export{E as a,y as c,C as i,v as l,x as n,w as o,T as r,b as s,S as t};