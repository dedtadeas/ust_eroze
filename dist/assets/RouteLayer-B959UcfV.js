import{Ax as e,Bd as t,Bg as n,Bu as r,CD as i,EE as a,Fu as o,Gd as s,Hb as c,Hx as l,Hy as u,IC as d,Id as f,Jm as p,Kd as m,Ld as h,MC as g,Mb as ee,NS as te,Pa as _,Pw as ne,Q as re,Qa as ie,Qx as ae,Rd as v,SC as y,Sw as b,Sx as oe,TE as se,Um as ce,Ux as x,Vg as le,WT as ue,X as de,Yd as fe,Zw as pe,_E as S,_x as me,aC as he,ao as ge,gg as _e,gp as ve,iE as ye,kC as C,kE as be,ka as xe,nD as Se,oC as w,rt as Ce,st as we,uw as Te,vC as T,vE as Ee,vx as De,yg as Oe,zu as ke,zy as Ae}from"./index-BqmCqmfp.js";import{t as je}from"./commonProperties-fyxj-C5K.js";import{t as Me}from"./originUtils-Xpg5-Q2D.js";import{T as Ne,_ as Pe,a as Fe,b as Ie,c as Le,d as Re,g as ze,h as Be,l as Ve,n as E,r as He,u as Ue,v as We,x as Ge}from"./networkEnums-BShtiFSl.js";import{t as Ke}from"./GPMessage-LPLTXP7P.js";import{a as qe,i as Je,n as Ye,r as D,t as Xe}from"./RouteInfo-BYlTBn3w.js";import{i as O,n as k,o as Ze,r as A,s as Qe,t as j}from"./Stop-DfLyF0Gk.js";var M=class extends T{constructor(e){super(e),this.break=new s({color:[255,255,255],size:12,outline:{color:[0,122,194],width:3}}),this.first=new s({color:[0,255,0],size:20,outline:{color:[255,255,255],width:4}}),this.unlocated=new s({color:[255,0,0],size:12,outline:{color:[255,255,255],width:3}}),this.last=new s({color:[255,0,0],size:20,outline:{color:[255,255,255],width:4}}),this.middle=new s({color:[51,51,51],size:12,outline:{color:[0,122,194],width:3}}),this.waypoint=new s({color:[255,255,255],size:12,outline:{color:[0,122,194],width:3}})}};i([g({types:v})],M.prototype,`break`,void 0),i([g({types:v})],M.prototype,`first`,void 0),i([g({types:v})],M.prototype,`unlocated`,void 0),i([g({types:v})],M.prototype,`last`,void 0),i([g({types:v})],M.prototype,`middle`,void 0),i([g({types:v})],M.prototype,`waypoint`,void 0),M=i([C(`esri.layers.support.RouteStopSymbols`)],M);var N=class extends T{constructor(e){super(e),this.directionLines=new fe({color:[0,122,194],width:6}),this.directionPoints=new s({color:[255,255,255],size:6,outline:{color:[0,122,194],width:2}}),this.pointBarriers=new s({style:`x`,size:10,outline:{color:[255,0,0],width:3}}),this.polygonBarriers=new m({color:[255,170,0,.6],outline:{width:7.5,color:[255,0,0,.6]}}),this.polylineBarriers=new fe({width:7.5,color:[255,85,0,.7]}),this.routeInfo=new fe({width:8,color:[20,89,127]}),this.stops=new M}};i([g({types:h})],N.prototype,`directionLines`,void 0),i([g({types:v})],N.prototype,`directionPoints`,void 0),i([g({types:v})],N.prototype,`pointBarriers`,void 0),i([g({types:t})],N.prototype,`polygonBarriers`,void 0),i([g({types:h})],N.prototype,`polylineBarriers`,void 0),i([g({types:h})],N.prototype,`routeInfo`,void 0),i([g({type:M})],N.prototype,`stops`,void 0),N=i([C(`esri.layers.support.RouteSymbols`)],N);var P=class extends T{constructor(e){super(e),this.dataType=null,this.name=null,this.parameterNames=null,this.restrictionUsageParameterName=null,this.timeNeutralAttributeName=null,this.trafficSupport=null,this.units=null,this.usageType=null}};i([g({type:String})],P.prototype,`dataType`,void 0),i([u(E,{ignoreUnknown:!1})],P.prototype,`name`,void 0),i([g({type:[String]})],P.prototype,`parameterNames`,void 0),i([g({type:String})],P.prototype,`restrictionUsageParameterName`,void 0),i([u(Le,{ignoreUnknown:!1})],P.prototype,`timeNeutralAttributeName`,void 0),i([g({type:String})],P.prototype,`trafficSupport`,void 0),i([u(Pe)],P.prototype,`units`,void 0),i([u(Ue)],P.prototype,`usageType`,void 0),P=i([C(`esri.rest.support.NetworkAttribute`)],P);var $e=P,F=class extends T{constructor(e){super(e),this.buildTime=null,this.name=null,this.networkAttributes=null,this.networkSources=null,this.state=null}};i([g({type:Number})],F.prototype,`buildTime`,void 0),i([g({type:String})],F.prototype,`name`,void 0),i([g({type:[$e]})],F.prototype,`networkAttributes`,void 0),i([g()],F.prototype,`networkSources`,void 0),i([g({type:String})],F.prototype,`state`,void 0),F=i([C(`esri.rest.support.NetworkDataset`)],F);var et=F,I=class extends T{constructor(e){super(e),this.accumulateAttributeNames=null,this.attributeParameterValues=null,this.currentVersion=null,this.defaultTravelMode=null,this.directionsLanguage=null,this.directionsLengthUnits=null,this.directionsSupportedLanguages=null,this.directionsTimeAttribute=null,this.hasZ=null,this.impedance=null,this.networkDataset=null,this.supportedTravelModes=null}readAccumulateAttributes(e){return e==null?null:e.map(e=>E.fromJSON(e))}writeAccumulateAttributes(e,t,n){e?.length&&(t[n]=e.map(e=>E.toJSON(e)))}get capabilities(){return{supportsNow:(this.currentVersion??10)>=10.81}}readDefaultTravelMode(e,t){let n=t.supportedTravelModes?.find(({id:e})=>e===t.defaultTravelMode)??t.supportedTravelModes?.find(({itemId:e})=>e===t.defaultTravelMode);return n?qe.fromJSON(n):null}};i([g()],I.prototype,`accumulateAttributeNames`,void 0),i([l(`accumulateAttributeNames`)],I.prototype,`readAccumulateAttributes`,null),i([w(`accumulateAttributeNames`)],I.prototype,`writeAccumulateAttributes`,null),i([g()],I.prototype,`attributeParameterValues`,void 0),i([g()],I.prototype,`capabilities`,null),i([g()],I.prototype,`currentVersion`,void 0),i([g()],I.prototype,`defaultTravelMode`,void 0),i([l(`defaultTravelMode`,[`defaultTravelMode`,`supportedTravelModes`])],I.prototype,`readDefaultTravelMode`,null),i([g()],I.prototype,`directionsLanguage`,void 0),i([u(Ve)],I.prototype,`directionsLengthUnits`,void 0),i([g()],I.prototype,`directionsSupportedLanguages`,void 0),i([u(Le,{ignoreUnknown:!1})],I.prototype,`directionsTimeAttribute`,void 0),i([g()],I.prototype,`hasZ`,void 0),i([u(E,{ignoreUnknown:!1})],I.prototype,`impedance`,void 0),i([g({type:et})],I.prototype,`networkDataset`,void 0),i([g({type:[qe]})],I.prototype,`supportedTravelModes`,void 0),I=i([C(`esri.rest.support.NetworkServiceDescription`)],I);var tt=()=>Ee.getLogger(`esri.rest.networkService`);function L(e,t,n,r){r[n]=[t.length,t.length+e.length],e.forEach(e=>{t.push(e.geometry)})}function nt(e,t){for(let n=0;n<t.length;n++){let r=e[t[n]];if(r&&r.length)for(let e of r)e.z=void 0}tt().warnOnce(`The remote Network Analysis service is powered by a network dataset which is not Z-aware.
Z-coordinates of the input geometry are ignored.`)}function rt(e,t){for(let n=0;n<t.length;n++){let r=e[t[n]];if(r&&r.length){for(let e of r)if(e!=null&&e.hasZ)return!0}}return!1}async function it(e,t,n){if(!e)throw new S(`network-service:missing-url`,`Url to Network service is missing`);let i=r({f:`json`,token:t},n),{data:a}=await b(e,i),{defaultTravelMode:o,supportedTravelModes:s}=await(a.currentVersion>=10.4?ot(e,t,n):at(e,n));return a.defaultTravelMode=o,a.supportedTravelModes=s,I.fromJSON(a)}async function at(e,t){let n=r({f:`json`},t),{data:i}=await b(e.replace(/\/rest\/.*$/i,`/info`),n);if(!i?.owningSystemUrl)return{supportedTravelModes:[],defaultTravelMode:null};let{owningSystemUrl:a}=i,o=ye(a)+`/sharing/rest/portals/self`,{data:s}=await b(o,n),c=be(`helperServices.routingUtilities.url`,s);if(!c)return{supportedTravelModes:[],defaultTravelMode:null};let l=ke(a),u=/\/solve$/i.test(l.path)?`Route`:/\/solveclosestfacility$/i.test(l.path)?`ClosestFacility`:`ServiceAreas`,d=r({f:`json`,serviceName:u},t),f=ye(c)+`/GetTravelModes/execute`,p=await b(f,d),m=[],h=null;if(p?.data?.results?.length){let e=p.data.results;for(let t of e)if(t.paramName===`supportedTravelModes`){if(t.value?.features){for(let{attributes:e}of t.value.features)if(e){let t=JSON.parse(e.TravelMode);m.push(t)}}}else t.paramName===`defaultTravelMode`&&(h=t.value)}return{supportedTravelModes:m,defaultTravelMode:h}}async function ot(e,t,n){try{let i=r({f:`json`,token:t},n),a=ye(e)+`/retrieveTravelModes`,{data:{supportedTravelModes:o,defaultTravelMode:s}}=await b(a,i);return{supportedTravelModes:o,defaultTravelMode:s}}catch(e){throw new S(`network-service:retrieveTravelModes`,`Could not get to the NAServer's retrieveTravelModes.`,{error:e})}}var st=new he({0:`informative`,1:`process-definition`,2:`process-start`,3:`process-stop`,50:`warning`,100:`error`,101:`empty`,200:`abort`}),R=class extends Ke{constructor(e){super(e),this.type=null}};i([g({type:String,json:{read:st.read,write:st.write}})],R.prototype,`type`,void 0),R=i([C(`esri.rest.support.NAMessage`)],R);var ct=R,z=class extends T{constructor(e){super(e)}};i([g({json:{read:{source:`string`}}})],z.prototype,`text`,void 0),i([u(Ie,{name:`stringType`})],z.prototype,`type`,void 0),z=i([C(`esri.rest.support.DirectionsString`)],z);var lt=z,B=class extends T{constructor(e){super(e),this.arriveTime=null,this.arriveTimeOffset=null,this.geometry=null,this.strings=null}readArriveTimeOffset(e,t){return Qe(t.ETA,t.arriveTimeUTC)}readGeometry(t,n){return e.fromJSON(n.point)}};i([g({type:Date,json:{read:{source:`arriveTimeUTC`}}})],B.prototype,`arriveTime`,void 0),i([g()],B.prototype,`arriveTimeOffset`,void 0),i([l(`arriveTimeOffset`,[`arriveTimeUTC`,`ETA`])],B.prototype,`readArriveTimeOffset`,null),i([g({type:e})],B.prototype,`geometry`,void 0),i([l(`geometry`,[`point`])],B.prototype,`readGeometry`,null),i([g({type:[lt]})],B.prototype,`strings`,void 0),B=i([C(`esri.rest.support.DirectionsEvent`)],B);var ut=B;function dt(e){if(e==null||e===``)return null;let t=0,n=0,r=0,i=0,a=[],o,s,c,l,u,d,f,p,m=0,h=0,g=0;if(u=e.match(/((\+|-)[^+\-|]+|\|)/g),u||=[],parseInt(u[m],32)===0){m=2;let e=parseInt(u[m],32);m++,d=parseInt(u[m],32),m++,1&e&&(h=u.indexOf(`|`)+1,f=parseInt(u[h],32),h++),2&e&&(g=u.indexOf(`|`,h)+1,p=parseInt(u[g],32),g++)}else d=parseInt(u[m],32),m++;for(;m<u.length&&u[m]!==`|`;){o=parseInt(u[m],32)+t,m++,t=o,s=parseInt(u[m],32)+n,m++,n=s;let e=[o/d,s/d];h&&(l=parseInt(u[h],32)+r,h++,r=l,e.push(l/f)),g&&(c=parseInt(u[g],32)+i,g++,i=c,e.push(c/p)),a.push(e)}return{paths:[a],hasZ:h>0,hasM:g>0}}var V=class extends f{constructor(e){super(e),this.events=null,this.geometry=null,this.strings=null}set attributes(e){super.attributes=e}readGeometry(e,t){let r=dt(t.compressedGeometry);return r==null?null:n.fromJSON(r)}};i([g({type:[ut]})],V.prototype,`events`,void 0),i([g({type:n})],V.prototype,`geometry`,void 0),i([l(`geometry`,[`compressedGeometry`])],V.prototype,`readGeometry`,null),i([g({type:[lt]})],V.prototype,`strings`,void 0),V=i([C(`esri.rest.support.DirectionsFeature`)],V);var ft=V;function pt(e,t){if(e.length===0)return new n({spatialReference:t});let r=[];for(let t of e)for(let e of t.paths)r.push(...e);let i=[];r.forEach((e,t)=>{t!==0&&e[0]===r[t-1][0]&&e[1]===r[t-1][1]||i.push(e)});let{hasM:a,hasZ:o}=e[0];return new n({hasM:a,hasZ:o,paths:[i],spatialReference:t})}var H=class extends _{constructor(e){super(e),this.extent=null,this.features=[],this.geometryType=`polyline`,this.routeId=null,this.routeName=null,this.totalDriveTime=null,this.totalLength=null,this.totalTime=null}readFeatures(e,t){if(!e)return[];let n=t.summary.envelope.spatialReference??t.spatialReference,r=n&&x.fromJSON(n);return e.map(e=>{let t=ft.fromJSON(e);if(t.geometry!=null&&(t.geometry.spatialReference=r),t.events!=null)for(let e of t.events)e.geometry!=null&&(e.geometry.spatialReference=r);return t})}get mergedGeometry(){return this.features?pt(this.features.map(({geometry:e})=>e),this.extent.spatialReference):null}get strings(){return this.features.flatMap(({strings:e})=>e).filter(Se)}};i([g({type:oe,json:{read:{source:`summary.envelope`}}})],H.prototype,`extent`,void 0),i([g({nonNullable:!0})],H.prototype,`features`,void 0),i([l(`features`)],H.prototype,`readFeatures`,null),i([g()],H.prototype,`geometryType`,void 0),i([g({readOnly:!0})],H.prototype,`mergedGeometry`,null),i([g()],H.prototype,`routeId`,void 0),i([g()],H.prototype,`routeName`,void 0),i([g({value:null,readOnly:!0})],H.prototype,`strings`,null),i([g({json:{read:{source:`summary.totalDriveTime`}}})],H.prototype,`totalDriveTime`,void 0),i([g({json:{read:{source:`summary.totalLength`}}})],H.prototype,`totalLength`,void 0),i([g({json:{read:{source:`summary.totalTime`}}})],H.prototype,`totalTime`,void 0),H=i([C(`esri.rest.support.DirectionsFeatureSet`)],H);var mt=H,U=class extends T{constructor(e){super(e),this.directionLines=null,this.directionPoints=null,this.directions=null,this.route=null,this.routeName=null,this.stops=null,this.traversedEdges=null,this.traversedJunctions=null,this.traversedTurns=null}};i([g({type:_,json:{write:!0}})],U.prototype,`directionLines`,void 0),i([g({type:_,json:{write:!0}})],U.prototype,`directionPoints`,void 0),i([g({type:mt,json:{write:!0}})],U.prototype,`directions`,void 0),i([g({type:f,json:{write:!0}})],U.prototype,`route`,void 0),i([g({type:String,json:{write:!0}})],U.prototype,`routeName`,void 0),i([g({type:[f],json:{write:!0}})],U.prototype,`stops`,void 0),i([g({type:_,json:{write:!0}})],U.prototype,`traversedEdges`,void 0),i([g({type:_,json:{write:!0}})],U.prototype,`traversedJunctions`,void 0),i([g({type:_,json:{write:!0}})],U.prototype,`traversedTurns`,void 0),U=i([C(`esri.rest.support.RouteResult`)],U);var ht=U;function gt(e){return e?_.fromJSON(e).features.filter(Se):[]}var W=class extends T{constructor(e){super(e),this.checksum=null,this.messages=null,this.pointBarriers=null,this.polylineBarriers=null,this.polygonBarriers=null,this.routeResults=null}readPointBarriers(e,t){return gt(t.barriers)}readPolylineBarriers(e){return gt(e)}readPolygonBarriers(e){return gt(e)}};i([g({type:String})],W.prototype,`checksum`,void 0),i([g({type:[ct]})],W.prototype,`messages`,void 0),i([g({type:[f]})],W.prototype,`pointBarriers`,void 0),i([l(`pointBarriers`,[`barriers`])],W.prototype,`readPointBarriers`,null),i([g({type:[f]})],W.prototype,`polylineBarriers`,void 0),i([l(`polylineBarriers`)],W.prototype,`readPolylineBarriers`,null),i([g({type:[f]})],W.prototype,`polygonBarriers`,void 0),i([l(`polygonBarriers`)],W.prototype,`readPolygonBarriers`,null),i([g({type:[ht]})],W.prototype,`routeResults`,void 0),W=i([C(`esri.rest.support.RouteSolveResult`)],W);function G(e){return e instanceof _}async function _t(e,t,n){let r=[],i=[],a={},s={},c=ke(e),{path:l}=c;G(t.stops)&&L(t.stops.features,i,`stops.features`,a),G(t.pointBarriers)&&L(t.pointBarriers.features,i,`pointBarriers.features`,a),G(t.polylineBarriers)&&L(t.polylineBarriers.features,i,`polylineBarriers.features`,a),G(t.polygonBarriers)&&L(t.polygonBarriers.features,i,`polygonBarriers.features`,a);let u=await o(i);for(let e in a){let t=a[e];r.push(e),s[e]=u.slice(t[0],t[1])}if(rt(s,r)){let e=null;try{e=await it(l,t.apiKey,n)}catch{}e&&!e.hasZ&&nt(s,r)}for(let e in s)s[e].forEach((n,r)=>{Te(t,e)[r].geometry=n});let d={...n,query:{...c.query,...Ze(t),f:`json`}},f=l.endsWith(`/solve`)?l:`${l}/solve`,{data:p}=await b(f,d);return vt(p)}function vt(e){let{barriers:t,checksum:n,directionLines:r,directionPoints:i,directions:a,messages:o,polygonBarriers:s,polylineBarriers:c,routes:l,stops:u,traversedEdges:d,traversedJunctions:f,traversedTurns:p}=e,m=e=>{let t=g.find(t=>t.routeName===e);if(t!=null)return t;let n={routeId:g.length+1,routeName:e};return g.push(n),n},h=e=>{let t=g.find(t=>t.routeId===e);if(t!=null)return t;let n={routeId:e,routeName:null};return g.push(n),n},g=[];l?.features.forEach((e,t)=>{e.geometry.spatialReference=l.spatialReference??void 0;let n=e.attributes.Name,r=t+1;g.push({routeId:r,routeName:n,route:e})}),a?.forEach(e=>{let{routeName:t}=e;m(t).directions=e});let ee=(u?.features.every(e=>e.attributes.RouteName==null)??!1)&&g.length>0?g[0].routeName:null;return u?.features.forEach(e=>{e.geometry&&(e.geometry.spatialReference??=u.spatialReference??void 0);let t=ee??e.attributes.RouteName,n=m(t);n.stops??=[],n.stops.push(e)}),r?.features.forEach(e=>{let t=e.attributes.RouteID,n=h(t),{geometryType:i,spatialReference:a}=r;n.directionLines??={features:[],geometryType:i,spatialReference:a},n.directionLines.features.push(e)}),i?.features.forEach(e=>{let t=e.attributes.RouteID,n=h(t),{geometryType:r,spatialReference:a}=i;n.directionPoints??={features:[],geometryType:r,spatialReference:a},n.directionPoints.features.push(e)}),d?.features.forEach(e=>{let t=e.attributes.RouteID,n=h(t),{geometryType:r,spatialReference:i}=d;n.traversedEdges??={features:[],geometryType:r,spatialReference:i},n.traversedEdges.features.push(e)}),f?.features.forEach(e=>{let t=e.attributes.RouteID,n=h(t),{geometryType:r,spatialReference:i}=f;n.traversedJunctions??={features:[],geometryType:r,spatialReference:i},n.traversedJunctions.features.push(e)}),p?.features.forEach(e=>{let t=e.attributes.RouteID,n=h(t);n.traversedTurns??={features:[]},n.traversedTurns.features.push(e)}),W.fromJSON({barriers:t,checksum:n,messages:o,polygonBarriers:s,polylineBarriers:c,routeResults:g})}var K=class extends Ae(T){constructor(e){super(e),this.doNotLocateOnRestrictedElements=null,this.geometry=null,this.geometryType=null,this.name=null,this.spatialRelationship=null,this.type=`layer`,this.where=null}};i([g({type:Boolean,json:{write:!0}})],K.prototype,`doNotLocateOnRestrictedElements`,void 0),i([g({types:ce,json:{read:p,write:!0}})],K.prototype,`geometry`,void 0),i([u(Fe)],K.prototype,`geometryType`,void 0),i([g({type:String,json:{name:`layerName`,write:!0}})],K.prototype,`name`,void 0),i([u(He,{name:`spatialRel`})],K.prototype,`spatialRelationship`,void 0),i([g({type:String,json:{write:!0}})],K.prototype,`type`,void 0),i([g({type:String,json:{write:!0}})],K.prototype,`where`,void 0),K=i([C(`esri.rest.support.DataLayer`)],K);var yt,q=class extends _{static{yt=this}constructor(e){super(e),this.doNotLocateOnRestrictedElements=null}clone(){return new yt({doNotLocateOnRestrictedElements:this.doNotLocateOnRestrictedElements,...this.cloneProperties()})}};i([g({type:Boolean,json:{write:!0}})],q.prototype,`doNotLocateOnRestrictedElements`,void 0),q=yt=i([C(`esri.rest.support.NetworkFeatureSet`)],q);var J=class extends Ae(T){constructor(e){super(e),this.doNotLocateOnRestrictedElements=null,this.url=null}};i([g({type:Boolean,json:{write:!0}})],J.prototype,`doNotLocateOnRestrictedElements`,void 0),i([g({type:String,json:{write:!0}})],J.prototype,`url`,void 0),J=i([C(`esri.rest.support.NetworkUrl`)],J);var bt,Y=class extends Ae(T){static{bt=this}constructor(e){super(e),this.accumulateAttributes=null,this.apiKey=null,this.attributeParameterValues=null,this.checksum=null,this.directionsLanguage=null,this.directionsLengthUnits=null,this.directionsOutputType=null,this.directionsStyleName=null,this.directionsTimeAttribute=null,this.findBestSequence=null,this.geometryPrecision=null,this.geometryPrecisionM=null,this.geometryPrecisionZ=null,this.ignoreInvalidLocations=null,this.impedanceAttribute=null,this.outputGeometryPrecision=null,this.outputGeometryPrecisionUnits=null,this.outputLines=`true-shape`,this.outSpatialReference=null,this.overrides=null,this.pointBarriers=null,this.polygonBarriers=null,this.polylineBarriers=null,this.preserveFirstStop=null,this.preserveLastStop=null,this.preserveObjectID=null,this.restrictionAttributes=null,this.restrictUTurns=null,this.returnBarriers=!1,this.returnDirections=!1,this.returnPolygonBarriers=!1,this.returnPolylineBarriers=!1,this.returnRoutes=!0,this.returnStops=!1,this.returnTraversedEdges=null,this.returnTraversedJunctions=null,this.returnTraversedTurns=null,this.returnZ=!0,this.startTime=null,this.startTimeIsUTC=!0,this.stops=null,this.timeWindowsAreUTC=null,this.travelMode=null,this.useHierarchy=null,this.useTimeWindows=null}static from(e){return d(bt,e)}readAccumulateAttributes(e){return e==null?null:e.map(e=>E.fromJSON(e))}writeAccumulateAttributes(e,t,n){e?.length&&(t[n]=e.map(e=>E.toJSON(e)))}writePointBarriers(e,t,n){X(e,t,n)}writePolygonBarrier(e,t,n){X(e,t,n)}writePolylineBarrier(e,t,n){X(e,t,n)}readRestrictionAttributes(e){return e==null?null:e.map(e=>Ne.fromJSON(e))}writeRestrictionAttributes(e,t,n){e?.length&&(t[n]=e.map(e=>Ne.toJSON(e)))}readStartTime(e,t){let{startTime:n}=t;return n==null?null:n===`now`?`now`:new Date(n)}writeStartTime(e,t){e!=null&&(t.startTime=e===`now`?`now`:e.getTime())}readStops(e,t){return Tt(t.stops)}writeStops(e,t,n){X(e,t,n)}};function xt(e){return e&&`type`in e}function St(e){return e&&`features`in e&&`doNotLocateOnRestrictedElements`in e}function Ct(e){return e&&`url`in e}function wt(e){return e&&`features`in e}function Tt(e){return xt(e)?K.fromJSON(e):Ct(e)?J.fromJSON(e):St(e)?q.fromJSON(e):wt(e)?_.fromJSON(e):null}function X(e,t,n){e!=null&&(t[n]=y.isCollection(e)?{features:e.toArray().map(e=>e.toJSON())}:e.toJSON())}i([g({type:[String],json:{name:`accumulateAttributeNames`,write:!0}})],Y.prototype,`accumulateAttributes`,void 0),i([l(`accumulateAttributes`)],Y.prototype,`readAccumulateAttributes`,null),i([w(`accumulateAttributes`)],Y.prototype,`writeAccumulateAttributes`,null),i([g(je)],Y.prototype,`apiKey`,void 0),i([g({json:{write:!0}})],Y.prototype,`attributeParameterValues`,void 0),i([g({type:String,json:{write:!0}})],Y.prototype,`checksum`,void 0),i([g({type:String,json:{write:!0}})],Y.prototype,`directionsLanguage`,void 0),i([u(Ve)],Y.prototype,`directionsLengthUnits`,void 0),i([u(We)],Y.prototype,`directionsOutputType`,void 0),i([u(Re)],Y.prototype,`directionsStyleName`,void 0),i([u(Le,{name:`directionsTimeAttributeName`,ignoreUnknown:!1})],Y.prototype,`directionsTimeAttribute`,void 0),i([g({type:Boolean,json:{write:!0}})],Y.prototype,`findBestSequence`,void 0),i([g({type:Number,json:{write:!0}})],Y.prototype,`geometryPrecision`,void 0),i([g({type:Number,json:{write:!0}})],Y.prototype,`geometryPrecisionM`,void 0),i([g({type:Number,json:{write:!0}})],Y.prototype,`geometryPrecisionZ`,void 0),i([g({type:Boolean,json:{write:!0}})],Y.prototype,`ignoreInvalidLocations`,void 0),i([u(E,{name:`impedanceAttributeName`,ignoreUnknown:!1})],Y.prototype,`impedanceAttribute`,void 0),i([g({type:Number,json:{write:!0}})],Y.prototype,`outputGeometryPrecision`,void 0),i([u(Ge)],Y.prototype,`outputGeometryPrecisionUnits`,void 0),i([u(Be)],Y.prototype,`outputLines`,void 0),i([g({type:x,json:{name:`outSR`,write:!0}})],Y.prototype,`outSpatialReference`,void 0),i([g({json:{write:!0}})],Y.prototype,`overrides`,void 0),i([g({json:{name:`barriers`,write:!0}})],Y.prototype,`pointBarriers`,void 0),i([w(`pointBarriers`)],Y.prototype,`writePointBarriers`,null),i([g({json:{write:!0}})],Y.prototype,`polygonBarriers`,void 0),i([w(`polygonBarriers`)],Y.prototype,`writePolygonBarrier`,null),i([g({json:{write:!0}})],Y.prototype,`polylineBarriers`,void 0),i([w(`polylineBarriers`)],Y.prototype,`writePolylineBarrier`,null),i([g({type:Boolean,json:{write:!0}})],Y.prototype,`preserveFirstStop`,void 0),i([g({type:Boolean,json:{write:!0}})],Y.prototype,`preserveLastStop`,void 0),i([g({type:Boolean,json:{write:!0}})],Y.prototype,`preserveObjectID`,void 0),i([g({type:[String],json:{name:`restrictionAttributeNames`,write:!0}})],Y.prototype,`restrictionAttributes`,void 0),i([l(`restrictionAttributes`)],Y.prototype,`readRestrictionAttributes`,null),i([w(`restrictionAttributes`)],Y.prototype,`writeRestrictionAttributes`,null),i([u(ze)],Y.prototype,`restrictUTurns`,void 0),i([g({type:Boolean,json:{write:!0}})],Y.prototype,`returnBarriers`,void 0),i([g({type:Boolean,json:{write:!0}})],Y.prototype,`returnDirections`,void 0),i([g({type:Boolean,json:{write:!0}})],Y.prototype,`returnPolygonBarriers`,void 0),i([g({type:Boolean,json:{write:!0}})],Y.prototype,`returnPolylineBarriers`,void 0),i([g({type:Boolean,json:{write:!0}})],Y.prototype,`returnRoutes`,void 0),i([g({type:Boolean,json:{write:!0}})],Y.prototype,`returnStops`,void 0),i([g({type:Boolean,json:{write:!0}})],Y.prototype,`returnTraversedEdges`,void 0),i([g({type:Boolean,json:{write:!0}})],Y.prototype,`returnTraversedJunctions`,void 0),i([g({type:Boolean,json:{write:!0}})],Y.prototype,`returnTraversedTurns`,void 0),i([g({type:Boolean,json:{write:!0}})],Y.prototype,`returnZ`,void 0),i([g({json:{write:!0}})],Y.prototype,`startTime`,void 0),i([l(`startTime`)],Y.prototype,`readStartTime`,null),i([w(`startTime`)],Y.prototype,`writeStartTime`,null),i([g({type:Boolean,json:{write:!0}})],Y.prototype,`startTimeIsUTC`,void 0),i([g({json:{write:!0}})],Y.prototype,`stops`,void 0),i([l(`stops`)],Y.prototype,`readStops`,null),i([w(`stops`)],Y.prototype,`writeStops`,null),i([g({type:Boolean,json:{write:!0}})],Y.prototype,`timeWindowsAreUTC`,void 0),i([g({type:qe,json:{write:!0}})],Y.prototype,`travelMode`,void 0),i([g({type:Boolean,json:{write:!0}})],Y.prototype,`useHierarchy`,void 0),i([g({type:Boolean,json:{write:!0}})],Y.prototype,`useTimeWindows`,void 0),Y=bt=i([C(`esri.rest.support.RouteParameters`)],Y);function Z(e){if(!e.length)return;let t=e.toArray(),n=t.map(({objectId:e})=>e).filter(e=>e!=null),r=Math.max(...n,0);for(let e of t)e.objectId??=++r}function Et(e,t){return!!e.length&&e.length===t.length&&Dt(e)&&Dt(t)}function Dt(e){return e.every(({objectId:e})=>e!=null)}function Ot(e){return e.length?e:null}function kt(e){switch(e){case`esriGeometryPoint`:return{type:`esriSMS`,style:`esriSMSCircle`,size:12,color:[0,0,0,0],outline:kt(`esriGeometryPolyline`)};case`esriGeometryPolyline`:return{type:`esriSLS`,style:`esriSLSSolid`,width:1,color:[0,0,0,0]};case`esriGeometryPolygon`:return{type:`esriSFS`,style:`esriSFSNull`,outline:kt(`esriGeometryPolyline`)}}}function At(e){return`layers`in e}function jt(e){return e.declaredClass===`esri.rest.support.FeatureSet`}function Mt(e){return e.declaredClass===`esri.rest.support.NetworkFeatureSet`}function Nt(e,t){for(let n of e){let e=t.find(e=>e.objectId===n.objectId);e&&(e.addedCost=n.addedCost,e.barrierType=n.barrierType,e.costs=n.costs,e.curbApproach=n.curbApproach,e.fullEdge=n.fullEdge,e.geometry=n.geometry,e.name=n.name,e.sideOfEdge=n.sideOfEdge,e.sourceId=n.sourceId,e.sourceOid=n.sourceOid,e.status=n.status,e.symbol=n.symbol)}}function Pt(e,t){for(let n of e){let e=t.find(e=>e.objectId===n.objectId);e&&(e.barrierType=n.barrierType,e.costs=n.costs,e.geometry=n.geometry,e.name=n.name,e.scaleFactor=n.scaleFactor,e.symbol=n.symbol)}}function Ft(e,t){for(let n of e){let e=t.find(e=>e.objectId===n.objectId);e&&(e.barrierType=n.barrierType,e.costs=n.costs,e.geometry=n.geometry,e.name=n.name,e.scaleFactor=n.scaleFactor,e.symbol=n.symbol)}}function It(e,t){for(let n of e){let e=t.find(e=>e.objectId===n.objectId);e&&(e.arriveCurbApproach=n.arriveCurbApproach,e.arriveTime=n.arriveTime,e.arriveTimeOffset=n.arriveTimeOffset,e.cumulativeCosts=n.cumulativeCosts,e.cumulativeDistance=n.cumulativeDistance,e.cumulativeDuration=n.cumulativeDuration,e.curbApproach=n.curbApproach,e.departCurbApproach=n.departCurbApproach,e.departTime=n.departTime,e.departTimeOffset=n.departTimeOffset,e.distanceToNetworkInMeters=n.distanceToNetworkInMeters,e.geometry=n.geometry,e.lateDuration=n.lateDuration,e.name=n.name,e.navLatency=n.navLatency,e.posAlong=n.posAlong,e.routeName=n.routeName,e.serviceCosts=n.serviceCosts,e.serviceDistance=n.serviceDistance,e.serviceDuration=n.serviceDuration,e.sequence=n.sequence,e.sideOfEdge=n.sideOfEdge,e.snapX=n.snapX,e.snapY=n.snapY,e.snapZ=n.snapZ,e.sourceId=n.sourceId,e.sourceOid=n.sourceOid,e.status=n.status,e.symbol=n.symbol,e.timeWindowEnd=n.timeWindowEnd,e.timeWindowStart=n.timeWindowStart,e.violations=n.violations,e.waitDuration=n.waitDuration,e.wait=n.wait)}}async function Lt(e){let t=x.WGS84;return await _e(e.spatialReference,t),Oe(e,t)}function Q(e,t){switch(t){case`seconds`:return e/60;case`hours`:return 60*e;case`days`:return 60*e*24;default:return e}}function Rt(e,t){return t===`decimal-degrees`||t===`points`||t===`unknown`?e:ae(e,t,`meters`)}function zt(e){let{attributes:t,geometry:n,popupTemplate:r,symbol:i}=e.toGraphic().toJSON();return{attributes:t,geometry:n,popupInfo:r,symbol:i}}var Bt=y.ofType(Je),Vt=y.ofType(D),Ht=y.ofType(O),Ut=y.ofType(A),Wt=y.ofType(k),Gt=y.ofType(j),$=class extends xe(de(Ce(re(ge(ee))))){constructor(e){super(e),this._cachedServiceDescription=null,this._featureCollection=null,this._type=`Feature Collection`,this.checksum=null,this.defaultSymbols=new N,this.directionLines=null,this.directionPoints=null,this.featureCollectionType=`route`,this.legendEnabled=!1,this.maxScale=0,this.minScale=0,this.pointBarriers=new Ht,this.polygonBarriers=new Ut,this.polylineBarriers=new Wt,this.routeInfo=null,this.spatialReference=x.WGS84,this.stops=new Gt,this.type=`route`;let t=()=>{this._setStopSymbol(this.stops)};this.addHandles(c(()=>this.stops,`change`,t,{sync:!0,onListenerAdd:t}))}writeFeatureCollectionWebmap(e,t,n,r){let i=[this._writePolygonBarriers(),this._writePolylineBarriers(),this._writePointBarriers(),this._writeRouteInfo(),this._writeDirectionLines(),this._writeDirectionPoints(),this._writeStops()].filter(e=>!!e),o=i.map((e,t)=>t),s=r.origin===`web-map`?`featureCollection.layers`:`layers`;a(s,i,t),t.opacity=this.opacity,t.visibility=this.visible,t.visibleLayers=o}readDirectionLines(e,t){return this._getNetworkFeatures(t,`DirectionLines`,e=>Je.fromGraphic(e))}readDirectionPoints(e,t){return this._getNetworkFeatures(t,`DirectionPoints`,e=>D.fromGraphic(e))}get fullExtent(){let e=new oe({xmin:-180,ymin:-90,xmax:180,ymax:90,spatialReference:x.WGS84});if(this.routeInfo?.geometry!=null)return this.routeInfo.geometry.extent??e;if(this.stops==null)return e;let t=this.stops.filter(e=>e.geometry!=null);if(t.length<2)return e;let{spatialReference:n}=t.at(0).geometry;if(n==null)return e;let r=t.toArray().map(e=>{let t=e.geometry;return[t.x,t.y]});return new le({points:r,spatialReference:n}).extent}readMaxScale(e,t){return((At(t)?t.layers:t.featureCollection?.layers)?.find(e=>e.layerDefinition.maxScale!=null))?.layerDefinition.maxScale??0}readMinScale(e,t){return((At(t)?t.layers:t.featureCollection?.layers)?.find(e=>e.layerDefinition.minScale!=null))?.layerDefinition.minScale??0}readPointBarriers(e,t){return this._getNetworkFeatures(t,`Barriers`,e=>O.fromGraphic(e))}readPolygonBarriers(e,t){return this._getNetworkFeatures(t,`PolygonBarriers`,e=>A.fromGraphic(e))}readPolylineBarriers(e,t){return this._getNetworkFeatures(t,`PolylineBarriers`,e=>k.fromGraphic(e))}readRouteInfo(e,t){return this._getNetworkFeatures(t,`RouteInfo`,e=>Xe.fromGraphic(e)).at(0)??null}readSpatialReference(e,t){let n=At(t)?t.layers:t.featureCollection?.layers;if(!n?.length)return x.WGS84;let{layerDefinition:r,featureSet:i}=n[0],a=i.features[0]?.geometry?.spatialReference??i.spatialReference??r.spatialReference??r.extent.spatialReference??te;return x.fromJSON(a)}readStops(e,t){return this._getNetworkFeatures(t,`Stops`,e=>j.fromGraphic(e),e=>this._setStopSymbol(e))}get title(){return this.routeInfo?.name??`Route`}set title(e){this._overrideIfSome(`title`,e)}get url(){return se.routeServiceUrl}set url(e){e==null?this._set(`url`,se.routeServiceUrl):this._set(`url`,ne(e,Ee.getLogger(this)))}load(e){return this.addResolvingPromise(this.loadFromPortal({supportedTypes:[`Feature Collection`]},e)),Promise.resolve(this)}removeAll(){this.removeResult(),this.pointBarriers.removeAll(),this.polygonBarriers.removeAll(),this.polylineBarriers.removeAll(),this.stops.removeAll()}removeResult(){this.directionLines!=null&&(this.directionLines.removeAll(),this._set(`directionLines`,null)),this.directionPoints!=null&&(this.directionPoints.removeAll(),this._set(`directionPoints`,null)),this.routeInfo!=null&&this._set(`routeInfo`,null)}async save(){await this.load();let{fullExtent:e,portalItem:t}=this;if(!t)throw new S(`routelayer:portal-item-not-set`,`save() requires to the layer to have a portal item`);if(!t.id)throw new S(`routelayer:portal-item-not-saved`,`Please use saveAs() first to save the routelayer`);if(t.type!==`Feature Collection`)throw new S(`routelayer:portal-item-wrong-type`,`Portal item needs to have type "Feature Collection"`);if(!this.routeInfo)throw new S(`routelayer:route-unsolved`,`save() requires a solved route`);let{portal:n}=t;await n.signIn(),n.user||await t.reload();let{itemUrl:r,itemControl:i}=t;if(i!==`admin`&&i!==`update`)throw new S(`routelayer:insufficient-permissions`,`To save this layer, you need to be the owner or an administrator of your organization`);let a={messages:[],origin:`portal-item`,portal:n,url:r?ue(r):void 0,writtenProperties:[]},o=this.write(void 0,a);return t.extent=await Lt(e),t.title=this.title,await t.update({data:o}),t}async saveAs(e,t={}){if(await this.load(),this.routeInfo==null)throw new S(`routelayer:route-unsolved`,`saveAs() requires a solved route`);let n=me.from(e).clone();n.extent??=await Lt(this.fullExtent),n.id=null,n.portal??=De.getDefault(),n.title??=this.title,n.type=`Feature Collection`,n.typeKeywords=[`Data`,`Feature Collection`,ie.MULTI_LAYER,`Route Layer`];let{portal:r}=n,i={messages:[],origin:`portal-item`,portal:r,url:null,writtenProperties:[]};await r.signIn();let a=t?.folder,o=this.write(void 0,i);return await r.user.addItem({item:n,folder:a,data:o}),this.portalItem=n,Me(i),i.portalItem=n,n}async solve(e,t){Z(this.stops),Z(this.pointBarriers),Z(this.polylineBarriers),Z(this.polygonBarriers);let n=e?.stops??this.stops,r=e?.pointBarriers??Ot(this.pointBarriers),i=e?.polylineBarriers??Ot(this.polylineBarriers),a=e?.polygonBarriers??Ot(this.polygonBarriers);if(n==null)throw new S(`routelayer:undefined-stops`,`the route layer must have stops defined in the route parameters.`);if((jt(n)||Mt(n))&&n.features.length<2||y.isCollection(n)&&n.length<2)throw new S(`routelayer:insufficent-stops`,`the route layer must have two or more stops to solve a route.`);if(y.isCollection(n))for(let e of n)e.routeName=null;let o=e?.apiKey,{checksum:s,url:c}=this,l=await this._getServiceDescription(c,o,t),u=e?.travelMode??l.defaultTravelMode,d=e?.accumulateAttributes??[];u&&(d.push(u.distanceAttributeName),u.timeAttributeName&&d.push(u.timeAttributeName));let f={accumulateAttributes:d,checksum:s,directionsOutputType:`featuresets`,ignoreInvalidLocations:!0,pointBarriers:r,polylineBarriers:i,polygonBarriers:a,preserveObjectID:!0,returnBarriers:!!r,returnDirections:!0,returnPolygonBarriers:!!a,returnPolylineBarriers:!!i,returnRoutes:!0,returnStops:!0,stops:n},p=Y.from(e??{}),m;p.set(f);try{m=await _t(c,p,t)}catch(e){throw pe(e)?e:new S(`routelayer:failed-route-request`,`the routing request failed`,{error:e})}let h=this._toRouteLayerSolution(m);return this._isOverridden(`title`)||(this.title=h.routeInfo.name??`Route`),this._populatePortalFields(h,l,p),h}update(e){let{checksum:t,directionLines:n,directionPoints:r,pointBarriers:i,polygonBarriers:a,polylineBarriers:o,routeInfo:s,stops:c}=e;Et(c,this.stops)?It(c,this.stops):this.set({stops:c}),Et(i,this.pointBarriers)?Nt(i,this.pointBarriers):this.set({pointBarriers:i}),Et(o,this.polylineBarriers)?Pt(o,this.polylineBarriers):this.set({polylineBarriers:o}),Et(a,this.polygonBarriers)?Ft(a,this.polygonBarriers):this.set({polygonBarriers:a}),this.set({checksum:t}),this._set(`directionLines`,n),this._set(`directionPoints`,r),this._set(`routeInfo`,s),s.geometry!=null&&(this.spatialReference=s.geometry.spatialReference)}_getNetworkFeatures(e,t,n,r){let i=(At(e)?e.layers:e.featureCollection?.layers)?.find(e=>e.layerDefinition.name===t);if(i==null)return new y;let{layerDefinition:a,popupInfo:o,featureSet:s}=i,c=a.drawingInfo.renderer,{features:l}=s,u=s.spatialReference??a.spatialReference??a.extent.spatialReference??te,d=c&&we(c),p=x.fromJSON(u),m=l.map(e=>{let r=f.fromJSON(e);r.geometry!=null&&e.geometry!=null&&e.geometry.spatialReference==null&&(r.geometry.spatialReference=p);let i=n(r);return i.symbol??=d?.getSymbol(r)??this._getNetworkSymbol(t),i.popupTemplate??=o&&ve.fromJSON(o),i});return r&&m.some(({symbol:e})=>!e)&&r(m),new y(m)}_getNetworkSymbol(e){switch(e){case`Barriers`:return this.defaultSymbols.pointBarriers;case`DirectionPoints`:return this.defaultSymbols.directionPoints;case`DirectionLines`:return this.defaultSymbols.directionLines;case`PolylineBarriers`:return this.defaultSymbols.polylineBarriers;case`PolygonBarriers`:return this.defaultSymbols.polygonBarriers;case`RouteInfo`:return this.defaultSymbols.routeInfo;case`Stops`:return null}}async _getServiceDescription(e,t,n){if(this._cachedServiceDescription!=null&&this._cachedServiceDescription.url===e)return this._cachedServiceDescription.serviceDescription;let r=await it(e,t,n);return this._cachedServiceDescription={serviceDescription:r,url:e},r}_setStopSymbol(e){if(!e||!e.length||!this.defaultSymbols.stops||e.every(({symbol:e})=>!!e))return;let{first:t,last:n,middle:r,unlocated:i,waypoint:a,break:o}=this.defaultSymbols.stops,s=e.map(({sequence:e})=>e).filter(e=>e!=null),c=e.length===s.length;if(!this.routeInfo&&!c||e.length===1)return void e.forEach((i,a)=>{switch(a){case 0:i.symbol=t;break;case e.length-1:i.symbol=n;break;default:i.symbol=r}});let l=Math.min(...s),u=Math.max(...s);for(let s of e)s.sequence===l?s.symbol=t:s.sequence===u?s.symbol=n:this.routeInfo&&s.status!==`ok`&&s.status!==`not-located-on-closest`?s.symbol=i:s.locationType===`waypoint`?s.symbol=a:s.locationType===`break`?s.symbol=o:s.symbol=r}_toRouteLayerSolution(e){let{checksum:t,routeResults:n}=e,r=n[0].stops?.map(e=>j.fromJSON(e.toJSON()));this._setStopSymbol(r);let i=new Gt(r),a=new Ut(e.polygonBarriers?.map(e=>{let t=A.fromJSON(e.toJSON());return t.symbol=this.defaultSymbols.polygonBarriers,t})),o=new Wt(e.polylineBarriers?.map(e=>{let t=k.fromJSON(e.toJSON());return t.symbol=this.defaultSymbols.polylineBarriers,t})),s=new Ht(e.pointBarriers?.map(e=>{let t=O.fromJSON(e.toJSON());return t.symbol=this.defaultSymbols.pointBarriers,t})),c=n[0].route?.toJSON(),l=Xe.fromJSON(c);l.symbol=this.defaultSymbols.routeInfo;let u=new Vt(n[0].directionPoints?.features.map(e=>{let t=D.fromJSON(e.toJSON());return t.symbol=this.defaultSymbols.directionPoints,t}));return{checksum:t,directionLines:new Bt(n[0].directionLines?.features.map(e=>{let t=Je.fromJSON(e.toJSON());return t.symbol=this.defaultSymbols.directionLines,t})),directionPoints:u,pointBarriers:s,polygonBarriers:a,polylineBarriers:o,routeInfo:l,stops:i}}_writeDirectionLines(){return this._writeNetworkFeatures(this.directionLines,this.defaultSymbols.directionLines,`esriGeometryPolyline`,Je.fields,`DirectionLines`,`Direction Lines`)}_writeDirectionPoints(){return this._writeNetworkFeatures(this.directionPoints,this.defaultSymbols.directionPoints,`esriGeometryPoint`,D.fields,`DirectionPoints`,`Direction Points`)}_writeNetworkFeatures(e,t,n,r,i,a){if(!e?.length)return null;let o=this.spatialReference.toJSON(),{fullExtent:s,maxScale:c,minScale:l}=this;return{featureSet:{features:e.toArray().map(e=>zt(e)),geometryType:n,spatialReference:o},layerDefinition:{capabilities:`Query,Update,Editing`,drawingInfo:{renderer:{type:`simple`,symbol:t==null?kt(n):t.toJSON()}},extent:s.toJSON(),fields:r,geometryType:n,hasM:!1,hasZ:!1,maxScale:c,minScale:l,name:i,objectIdField:`ObjectID`,spatialReference:o,title:a,type:`Feature Layer`,typeIdField:``}}}_writePointBarriers(){return this._writeNetworkFeatures(this.pointBarriers,this.defaultSymbols.pointBarriers,`esriGeometryPoint`,O.fields,`Barriers`,`Point Barriers`)}_writePolygonBarriers(){return this._writeNetworkFeatures(this.polygonBarriers,this.defaultSymbols.polygonBarriers,`esriGeometryPolygon`,A.fields,`PolygonBarriers`,`Polygon Barriers`)}_writePolylineBarriers(){return this._writeNetworkFeatures(this.polylineBarriers,this.defaultSymbols.polylineBarriers,`esriGeometryPolyline`,k.fields,`PolylineBarriers`,`Line Barriers`)}_writeRouteInfo(){return this._writeNetworkFeatures(this.routeInfo==null?null:new y([this.routeInfo]),this.defaultSymbols.routeInfo,`esriGeometryPolyline`,Xe.fields,`RouteInfo`,`Route Details`)}_writeStops(){let e=this._writeNetworkFeatures(this.stops,null,`esriGeometryPoint`,j.fields,`Stops`,`Stops`);if(e==null)return null;let{stops:t}=this.defaultSymbols,n=t?.first?.toJSON(),r=t?.middle?.toJSON(),i=t?.last?.toJSON();return e.layerDefinition.drawingInfo.renderer={type:`uniqueValue`,field1:`Sequence`,defaultSymbol:r,uniqueValueInfos:[{value:`1`,symbol:n,label:`First Stop`},{value:`${this.stops.length}`,symbol:i,label:`Last Stop`}]},e}_populatePortalFields(e,t,n){let r=(t.networkDataset?.networkAttributes)?.filter(({usageType:e})=>e===`cost`)??[],i=n.travelMode??t.defaultTravelMode;if(i==null)return void Ee.getLogger(this).warn(`route-layer:missing-travel-mode`,`The routing service must have a default travel mode or one must be specified in the route parameter.`);let{timeAttributeName:a,distanceAttributeName:o}=i,s=r.find(({name:e})=>e===a),c=r.find(({name:e})=>e===o),l=n.travelMode?.impedanceAttributeName??n.impedanceAttribute??t.impedance,u=s?.units,d=c?.units;if(!u||!d)throw new S(`routelayer:unknown-impedance-units`,`the units of either the distance or time impedance are unknown`);let f=n.directionsLanguage??t.directionsLanguage,p=n.accumulateAttributes??t.accumulateAttributeNames??[],m=new Set(r.filter(({name:e})=>e===a||e===o||e===l||e!=null&&p.includes(e)).map(({name:e})=>e)),h=e=>{for(let t in e)m.has(t)||delete e[t]};for(let t of e.pointBarriers)t.costs!=null&&(t.addedCost=t.costs[l]??0,h(t.costs));for(let t of e.polygonBarriers)t.costs!=null&&(t.scaleFactor=t.costs[l]??1,h(t.costs));for(let t of e.polylineBarriers)t.costs!=null&&(t.scaleFactor=t.costs[l]??1,h(t.costs));let{routeInfo:g}=e,{findBestSequence:ee,preserveFirstStop:te,preserveLastStop:_,startTimeIsUTC:ne,timeWindowsAreUTC:re}=n;g.analysisSettings=new Ye({accumulateAttributes:p,directionsLanguage:f,findBestSequence:ee,preserveFirstStop:te,preserveLastStop:_,startTimeIsUTC:ne,timeWindowsAreUTC:re,travelMode:i}),g.totalDuration=Q(g.totalCosts?.[a]??0,u),g.totalDistance=Rt(g.totalCosts?.[o]??0,d),g.totalLateDuration=Q(g.totalViolations?.[a]??0,u),g.totalWaitDuration=Q(g.totalWait?.[a]??0,u),g.totalCosts!=null&&h(g.totalCosts),g.totalViolations!=null&&h(g.totalViolations),g.totalWait!=null&&h(g.totalWait);for(let t of e.stops)t.serviceCosts!=null&&(t.serviceDuration=Q(t.serviceCosts[a]??0,u),t.serviceDistance=Rt(t.serviceCosts[o]??0,d),h(t.serviceCosts)),t.cumulativeCosts!=null&&(t.cumulativeDuration=Q(t.cumulativeCosts[a]??0,u),t.cumulativeDistance=Rt(t.cumulativeCosts[o]??0,d),h(t.cumulativeCosts)),t.violations!=null&&(t.lateDuration=Q(t.violations[a]??0,u),h(t.violations)),t.wait!=null&&(t.waitDuration=Q(t.wait[a]??0,u),h(t.wait))}};i([g({readOnly:!0,json:{read:!1,origins:{"portal-item":{write:{allowNull:!0,ignoreOrigin:!0}},"web-map":{write:{overridePolicy(){return{allowNull:!0,ignoreOrigin:this.portalItem==null}}}}}}})],$.prototype,`_featureCollection`,void 0),i([w([`web-map`,`portal-item`],`_featureCollection`)],$.prototype,`writeFeatureCollectionWebmap`,null),i([g({readOnly:!0,json:{read:!1,origins:{"web-map":{write:{target:`type`,overridePolicy(){return{ignoreOrigin:this.portalItem!=null}}}}}}})],$.prototype,`_type`,void 0),i([g({type:String})],$.prototype,`checksum`,void 0),i([g({nonNullable:!0,type:N})],$.prototype,`defaultSymbols`,void 0),i([g({readOnly:!0})],$.prototype,`directionLines`,void 0),i([l([`web-map`,`portal-item`],`directionLines`,[`layers`,`featureCollection.layers`])],$.prototype,`readDirectionLines`,null),i([g({readOnly:!0})],$.prototype,`directionPoints`,void 0),i([l([`web-map`,`portal-item`],`directionPoints`,[`layers`,`featureCollection.layers`])],$.prototype,`readDirectionPoints`,null),i([g({readOnly:!0,json:{read:!1,origins:{"web-map":{write:{ignoreOrigin:!0}}}}})],$.prototype,`featureCollectionType`,void 0),i([g({readOnly:!0})],$.prototype,`fullExtent`,null),i([g({json:{origins:{"web-map":{name:`featureCollection.showLegend`}},write:!0}})],$.prototype,`legendEnabled`,void 0),i([g({type:[`show`,`hide`]})],$.prototype,`listMode`,void 0),i([g({type:Number,nonNullable:!0,json:{write:!1}})],$.prototype,`maxScale`,void 0),i([l([`web-map`,`portal-item`],`maxScale`,[`layers`,`featureCollection.layers`])],$.prototype,`readMaxScale`,null),i([g({type:Number,nonNullable:!0,json:{write:!1}})],$.prototype,`minScale`,void 0),i([l([`web-map`,`portal-item`],`minScale`,[`layers`,`featureCollection.layers`])],$.prototype,`readMinScale`,null),i([g({type:[`ArcGISFeatureLayer`],value:`ArcGISFeatureLayer`})],$.prototype,`operationalLayerType`,void 0),i([g({nonNullable:!0,type:y.ofType(O)})],$.prototype,`pointBarriers`,void 0),i([l([`web-map`,`portal-item`],`pointBarriers`,[`layers`,`featureCollection.layers`])],$.prototype,`readPointBarriers`,null),i([g({nonNullable:!0,type:y.ofType(A)})],$.prototype,`polygonBarriers`,void 0),i([l([`web-map`,`portal-item`],`polygonBarriers`,[`layers`,`featureCollection.layers`])],$.prototype,`readPolygonBarriers`,null),i([g({nonNullable:!0,type:y.ofType(k)})],$.prototype,`polylineBarriers`,void 0),i([l([`web-map`,`portal-item`],`polylineBarriers`,[`layers`,`featureCollection.layers`])],$.prototype,`readPolylineBarriers`,null),i([g({readOnly:!0})],$.prototype,`routeInfo`,void 0),i([l([`web-map`,`portal-item`],`routeInfo`,[`layers`,`featureCollection.layers`])],$.prototype,`readRouteInfo`,null),i([g({type:x})],$.prototype,`spatialReference`,void 0),i([l([`web-map`,`portal-item`],`spatialReference`,[`layers`,`featureCollection.layers`])],$.prototype,`readSpatialReference`,null),i([g({nonNullable:!0,type:y.ofType(j)})],$.prototype,`stops`,void 0),i([l([`web-map`,`portal-item`],`stops`,[`layers`,`featureCollection.layers`])],$.prototype,`readStops`,null),i([g()],$.prototype,`title`,null),i([g({readOnly:!0,json:{read:!1}})],$.prototype,`type`,void 0),i([g()],$.prototype,`url`,null),$=i([C(`esri.layers.RouteLayer`)],$);var Kt=$;export{Kt as default};