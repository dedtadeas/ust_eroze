import{aC as e,ib as t}from"./index-BqmCqmfp.js";import{s as n}from"./pixelRangeUtils-DMjHgTK0.js";import{t as r}from"./PixelBlock-CjVaas_l.js";var i=9,a=`PixelID`;function o(e){return e!=null&&e.pixels?.length>0}function s(e){if(!e?.length||e.some(e=>!o(e)))return null;if(e.length===1)return e[0]?.clone()??null;let t=e,{width:n,height:i,pixelType:a}=t[0];if(t.some(e=>e.width!==n||e.height!==i))return null;let s=t.map(({mask:e})=>e).filter(e=>e!=null),c=null;s.length&&(c=new Uint8Array(n*i),c.set(s[0]),s.length>1&&v(s.slice(1),c));let l=[];t.forEach(({pixels:e})=>l.push(...e));let u=t.map(({statistics:e})=>e).filter(e=>e?.length),d=[];return u.forEach(e=>d.push(...e)),new r({pixelType:a,width:n,height:i,mask:c,pixels:l,statistics:d.length?d:null})}function c(e){if(!e)return;let t=e.colormap;if(!t||t.length===0)return;let n=t.sort((e,t)=>e[0]-t[0]),r=n[0][0]<0?n[0][0]:0,i=Math.max(256,n[n.length-1][0]-r+1),a=new Uint8Array(4*i),o=[],s=n[0].length===5;if(i>65536)return n.forEach(e=>{o[e[0]-r]=s?e.slice(1):e.slice(1).concat([255])}),{indexed2DColormap:o,offset:r,alphaSpecified:s};if(e.fillUnspecified){let e=n[0];for(let t=e[0]-r,o=0;t<i;t++)a[4*t]=e[1],a[4*t+1]=e[2],a[4*t+2]=e[3],a[4*t+3]=s?e[4]:255,t===e[0]-r&&(e=o===n.length-1?e:n[++o])}else for(let e=0;e<n.length;e++){let t=n[e],i=4*(t[0]-r);a[i]=t[1],a[i+1]=t[2],a[i+2]=t[3],a[i+3]=s?t[4]:255}return{indexedColormap:a,offset:r,alphaSpecified:s}}function l(e,t){if(!o(e)||!t||!t.indexedColormap&&!t.indexed2DColormap)return e;let n=e.clone(),r=n.pixels,i=n.mask,a=n.width*n.height;if(r.length!==1)return e;let{indexedColormap:s,indexed2DColormap:c,offset:l,alphaSpecified:u}=t,d=r[0],f=new Uint8Array(d.length),p=new Uint8Array(d.length),m=new Uint8Array(d.length),h,g=0;if(s){let e=s.length-1;if(i!=null)for(let t=0;t<a;t++)i[t]&&(g=4*(d[t]-l),g<l||g>e?i[t]=0:(f[t]=s[g],p[t]=s[g+1],m[t]=s[g+2],i[t]=s[g+3]));else{i=new Uint8Array(a);for(let t=0;t<a;t++)g=4*(d[t]-l),g<l||g>e?i[t]=0:(f[t]=s[g],p[t]=s[g+1],m[t]=s[g+2],i[t]=s[g+3]);n.mask=i}}else if(c)if(i!=null)for(let e=0;e<a;e++)i[e]&&(h=c[d[e]],f[e]=h[0],p[e]=h[1],m[e]=h[2],i[e]=h[3]);else{i=new Uint8Array(a);for(let e=0;e<a;e++)h=c[d[e]],f[e]=h[0],p[e]=h[1],m[e]=h[2],i[e]=h[3];n.mask=i}return n.pixels=[f,p,m],n.statistics=null,n.pixelType=`u8`,n.maskIsAlpha=u,n}function u(e,t){if(!o(e))return null;let{pixels:n,mask:i}=e,a=n.length,s=t.lut,{offset:c}=t;s&&s[0].length===1&&(s=n.map(()=>s));let l=[],u=t.outputPixelType||`u8`;for(let e=0;e<a;e++){let t=d(n[e],i,s[e],c||0,u);l.push(t)}let f=new r({width:e.width,height:e.height,pixels:l,mask:i,pixelType:u});return f.updateStatistics(),f}function d(e,t,n,i,a){let o=e.length,s=r.createEmptyBand(a,o);if(t)for(let r=0;r<o;r++)t[r]&&(s[r]=n[e[r]-i]);else for(let t=0;t<o;t++)s[t]=n[e[t]-i];return s}function f(e,t,n){if(!o(e))return;let{width:r,height:i,pixels:a,mask:s}=e,c=r*i,l=new Uint8Array(c);for(let e=1;e<=n.length;e++){let{bandId:t,ranges:r}=n[e-1],i=a[t];if(!i)continue;let o=r.length===1,[u,d]=r[0];for(let t=0;t<c;t++)if(!s||s[t]){let n=i[t];if(o)n>=u&&n<=d&&(l[t]=e);else for(let i=0;i<r.length;i++){let[a,o]=r[i];if(n>=a&&n<=o){l[t]=e;break}}}}let{pixels:u}=t;u.length===1&&(u[1]=u[0].slice(),u[2]=u[0].slice());let d=n.map(e=>e.color);if(t.mask){let e=t.mask;for(let t=0;t<c;t++)if(e[t]){e[t]=255;let n=l[t];if(n){let r=d[n-1];u[0][t]=r[0],u[1][t]=r[1],u[2][t]=r[2],e[t]=r[3]}}}else{let e=new Uint8Array(c).fill(255);for(let t=0;t<c;t++){let n=l[t];if(n){let r=d[n-1];u[0][t]=r[0],u[1][t]=r[1],u[2][t]=r[2],e[t]=r[3]}}t.mask=e}t.maskIsAlpha=!0}function p(e,t){if(!o(e))return null;let n=e.clone(),{pixels:r}=n,i=n.width*n.height,a=t.length,s=Math.floor(a/2),c=t[Math.floor(s)],l=r[0],u=new Uint8Array(i),d=new Uint8Array(i),f=new Uint8Array(i),p=n.mask,m=t[0].mappedColor.length===4;p||(p=new Uint8Array(i),p.fill(m?255:1),n.mask=p);for(let e=0;e<i;e++)if(p[e]){let n=l[e],r=!1,i=s,o=c,m=0,h=a-1;for(;h-m>1;){if(n===o.value){r=!0;break}n>o.value?m=i:h=i,i=Math.floor((m+h)/2),o=t[Math.floor(i)]}r||(n===t[m].value?(o=t[m],r=!0):n===t[h].value?(o=t[h],r=!0):n<t[m].value?r=!1:n>t[m].value&&(n<t[h].value?(o=t[m],r=!0):h===a-1?r=!1:(o=t[h],r=!0))),r?(u[e]=o.mappedColor[0],d[e]=o.mappedColor[1],f[e]=o.mappedColor[2],p[e]=o.mappedColor[3]):u[e]=d[e]=f[e]=p[e]=0}return n.pixels=[u,d,f],n.mask=p,n.pixelType=`u8`,n.maskIsAlpha=m,n}function m(e,n,r=!1){let i=1e-5,a=new Float32Array(27),o=n.length;for(let s=0;s<9;s++)a[3*s]=e[2*s]??t-1,a[3*s+1]=e[2*s+1]??t,a[3*s+2]=n[s]??0,s<o&&(s>0&&(a[3*s]-=i),e[2*s+1]!==e[2*s]&&(s<o-1||!r)&&(a[3*s+1]-=i));return a}function h(e,t){if(!o(e))return null;let{width:i,height:a}=e,{inputRanges:s,outputValues:c,outputPixelType:l,noDataRanges:u,allowUnmatched:d,replacementValue:f,isLastInputRangeInclusive:p}=t,m=e.pixels[0],h=r.createEmptyBand(l,m.length),g=e.mask,_=new Uint8Array(i*a);g?_.set(g):_.fill(255);let v=e.pixelType.startsWith(`f`)?1e-6:0,y=s.map(e=>e-v);y[0]=s[0],y[y.length-1]=s[s.length-1]+(p?1e-6:0);let b=s.length/2,[x,S]=n(l);for(let e=0;e<a;e++)for(let t=0;t<i;t++){let n=e*i+t;if(_[n]){let e=m[n],t=!1;for(let r=b-1;r>=0;r--)if(e===s[2*r]||e>y[2*r]&&e<y[2*r+1]){h[n]=c[r],t=!0;break}t||(d?h[n]=e>S?S:e<x?x:f??e:_[n]=0)}}let C=u?.length;if(C)for(let e=0;e<a;e++)for(let t=0;t<i;t++){let n=e*i+t;if(!g||g[n]){let e=m[n];for(let t=0;t<C;t+=2)if(e>=u[t]&&e<=u[t+1]){h[n]=0,_[n]=0;break}}}return new r({width:i,height:a,pixelType:l,pixels:[h],mask:_})}function g(e,t,n,r){let i=n!=null&&n.length>=2?new Set(n):null,a=n?.length===1?n[0]:null,o=!!t?.length;for(let n=0;n<e.length;n++)if(r[n]){let s=e[n];if(o){let e=!1;for(let n=0;n<t.length;n+=2)if(s>=t[n]&&s<=t[n+1]){e=!0;break}e||(r[n]=0)}r[n]&&(s===a||i?.has(s))&&(r[n]=0)}}function _(e,t){let n=e[0].length;for(let r=0;r<n;r++)if(t[r]){let n=!1;for(let t=0;t<e.length;t++)if(e[t][r]){n=!0;break}n||(t[r]=0)}}function v(e,t){let n=e[0].length;for(let r=0;r<n;r++)if(t[r]){let n=!1;for(let t=0;t<e.length;t++)if(e[t][r]===0){n=!0;break}n&&(t[r]=0)}}function y(e,t){if(!o(e))return null;let{width:n,height:i,pixels:a}=e,s=n*i,c=new Uint8Array(s);e.mask?c.set(e.mask):c.fill(255);let l=a.length,{includedRanges:u,noDataValues:f,outputPixelType:p,matchAll:m,lookups:h}=t;if(h){let e=[];for(let t=0;t<l;t++){let n=h[t],r=d(a[t],c,n.lut,n.offset||0,`u8`);e.push(r)}e.length===1?c.set(e[0]):m?_(e,c):v(e,c)}else if(m){let e=[];for(let t=0;t<l;t++){let n=new Uint8Array(s);n.set(c),g(a[t],u?.slice(2*t,2*t+2),f?.[t],n),e.push(n)}e.length===1?c.set(e[0]):_(e,c)}else for(let e=0;e<l;e++)g(a[e],u?.slice(2*e,2*e+2),f?.[e],c);return new r({width:n,height:i,pixelType:p,pixels:a,mask:c})}function b(e){let{srcPixelType:t,inputRanges:i,outputValues:a,allowUnmatched:o,noDataRanges:s,isLastInputRangeInclusive:c,outputPixelType:l}=e;if(t!==`u8`&&t!==`s8`&&t!==`u16`&&t!==`s16`)return null;let u=t.includes(`16`)?65536:256,d=t.includes(`s`)?-u/2:0,f=r.createEmptyBand(l,u),p=new Uint8Array(u);o&&p.fill(255);let[m,h]=n(l);if(i?.length&&a?.length){let e=i.map(e=>e-1e-6);e[0]=i[0],c&&(e[e.length-1]=i[i.length-1]);for(let t=0;t<e.length;t++){let n=a[t]>h?h:a[t]<m?m:a[t],r=Math.ceil(e[2*t]-d),o=i[2*t+1]===i[2*t]?r:Math.floor(e[2*t+1]-d);for(let e=r;e<=o;e++)f[e]=n,p[e]=255}}if(s?.length)for(let e=0;e<s.length;e++){let t=Math.ceil(s[2*e]-d),n=Math.floor(s[2*e+1]-d);for(let e=t;e<=n;e++)p[e]=0}return{lut:f,offset:d,mask:p}}function x(e,t,n){if(e!==`u8`&&e!==`s8`&&e!==`u16`&&e!==`s16`)return null;let r=e.includes(`16`)?65536:256,i=e.includes(`s`)?-r/2:0,a=new Uint8Array(r);if(t)for(let e=0;e<t.length;e++){let n=Math.ceil(t[2*e]-i),r=Math.floor(t[2*e+1]-i);for(let e=n;e<=r;e++)a[e]=255}else a.fill(255);if(n)for(let e=0;e<n.length;e++)a[n[e]-i]=0;return{lut:a,offset:i}}function S(e,t,n,r,i,a,o,s){return{xmin:i<=n*e?0:i<n*e+e?i-n*e:e,ymin:a<=r*t?0:a<r*t+t?a-r*t:t,xmax:i+o<=n*e?0:i+o<n*e+e?i+o-n*e:e,ymax:a+s<=r*t?0:a+s<r*t+t?a+s-r*t:t}}function C(e,t){if(!e||e.length===0)return null;let n=e.find(e=>e.pixelBlock);if(n?.pixelBlock==null)return null;let r=(n.extent.xmax-n.extent.xmin)/n.pixelBlock.width,i=(n.extent.ymax-n.extent.ymin)/n.pixelBlock.height,a=.01*Math.min(r,i),o=e.sort((e,t)=>Math.abs(e.extent.ymax-t.extent.ymax)>a?t.extent.ymax-e.extent.ymax:Math.abs(e.extent.xmin-t.extent.xmin)>a?e.extent.xmin-t.extent.xmin:0),s=Math.min.apply(null,o.map(e=>e.extent.xmin)),c=Math.min.apply(null,o.map(e=>e.extent.ymin)),l=Math.max.apply(null,o.map(e=>e.extent.xmax)),u=Math.max.apply(null,o.map(e=>e.extent.ymax)),d={x:Math.round((t.xmin-s)/r),y:Math.round((u-t.ymax)/i)},f={width:Math.round((l-s)/r),height:Math.round((u-c)/i)},p={width:Math.round((t.xmax-t.xmin)/r),height:Math.round((t.ymax-t.ymin)/i)};return Math.round(f.width/n.pixelBlock.width)*Math.round(f.height/n.pixelBlock.height)!==o.length||d.x<0||d.y<0||f.width<p.width||f.height<p.height?null:{extent:t,pixelBlock:T(o.map(e=>e.pixelBlock),f,{clipOffset:d,clipSize:p})}}function w(e,t,n,r,i,a){let{width:o,height:s}=n.block,{x:c,y:l}=n.offset,{width:u,height:d}=n.mosaic,f=S(o,s,r,i,c,l,u,d),p=0,m=0;if(a){let e=a.hasGCSSShiftTransform?360:a.halfWorldWidth??0,t=o*a.resolutionX,n=a.startX+r*t;n<e&&n+t>e?m=a.rightPadding:n>=e&&(p=a.leftMargin-a.rightPadding,m=0)}if(f.xmax-=m,typeof t!=`number`)for(let n=f.ymin;n<f.ymax;n++){let a=(i*s+n-l)*u+(r*o-c)+p,d=n*o;for(let n=f.xmin;n<f.xmax;n++)e[a+n]=t[d+n]}else for(let n=f.ymin;n<f.ymax;n++){let a=(i*s+n-l)*u+(r*o-c)+p;for(let n=f.xmin;n<f.xmax;n++)e[a+n]=t}}function T(e,t,n={}){let{clipOffset:i,clipSize:a,alignmentInfo:s,blockWidths:c}=n;if(c)return E(e,t,{blockWidths:c});let l=e.find(e=>o(e));if(l==null)return null;let u=a?a.width:t.width,d=a?a.height:t.height,f=l.width,p=l.height,m=t.width/f,h=t.height/p,g={offset:i||{x:0,y:0},mosaic:a||t,block:{width:f,height:p}},_=l.pixelType,v=r.getPixelArrayConstructor(_),y=l.pixels.length,b=[],x,S;for(let t=0;t<y;t++){S=new v(u*d);for(let n=0;n<h;n++)for(let r=0;r<m;r++){let i=e[n*m+r];o(i)&&(x=i.pixels[t],w(S,x,g,r,n,s))}b.push(S)}let C=e.some(e=>e==null||e.mask!=null&&e.mask.length>0),T=e.some(e=>e?.bandMasks&&e.bandMasks.length>1),D=C?new Uint8Array(u*d):void 0,O=T?[]:void 0;if(D){for(let t=0;t<h;t++)for(let n=0;n<m;n++){let r=e[t*m+n],i=r==null?null:r.mask;w(D,i??(r?255:0),g,n,t,s)}if(O)for(let t=0;t<y;t++){let n=new Uint8Array(u*d);for(let r=0;r<h;r++)for(let i=0;i<m;i++){let a=e[r*m+i],o=a?.bandMasks?.[t]??a?.mask;w(n,o??(a?255:0),g,i,r,s)}O.push(n)}}let k=new r({width:u,height:d,pixels:b,pixelType:_,bandMasks:O,mask:D});return k.updateStatistics(),k}function E(e,t,n){let i=e.find(e=>e!=null);if(i==null)return null;let a=e.some(e=>e==null||!!e.mask),{width:s,height:c}=t,l=a?new Uint8Array(s*c):null,{blockWidths:u}=n,d=[],f=i.getPlaneCount(),p=r.getPixelArrayConstructor(i.pixelType);if(a)for(let t=0,n=0;t<e.length;n+=u[t],t++){let r=e[t];if(!o(r))continue;let i=r.mask;for(let e=0;e<c;e++)for(let a=0;a<u[t];a++)l[e*s+a+n]=i==null?255:i[e*r.width+a]}let m=e.some(e=>e?.bandMasks&&e.bandMasks.length>1),h=m?[]:void 0,g=s*c;for(let t=0;t<f;t++){let n=new p(g),r=m?new Uint8Array(g):void 0;for(let i=0,a=0;i<e.length;a+=u[i],i++){let l=e[i];if(!o(l))continue;let d=l.pixels[t];if(d!=null){for(let e=0;e<c;e++)for(let t=0;t<u[i];t++)n[e*s+t+a]=d[e*l.width+t];if(r){let e=l.bandMasks?.[t]??l.mask;for(let t=0;t<c;t++)for(let n=0;n<u[i];n++)r[t*s+n+a]=e?e[t*l.width+n]:255}}}d.push(n),h&&r&&h.push(r)}let _=new r({width:s,height:c,mask:l,bandMasks:h,pixels:d,pixelType:i.pixelType});return _.updateStatistics(),_}function D(e,t,n){if(!o(e))return null;let{width:r,height:i}=e,a=t.x,s=t.y,c=n.width+a,l=n.height+s;if(a<0||s<0||c>r||l>i||a===0&&s===0&&c===r&&l===i)return e;e.mask||=new Uint8Array(r*i);let u=e.mask;for(let e=0;e<i;e++){let t=e*r;for(let n=0;n<r;n++)u[t+n]=e<s||e>=l||n<a||n>=c?0:1}return e.updateStatistics(),e}function O(e){if(!o(e))return null;let t=e.clone(),{width:n,height:r,pixels:i}=e,a=i[0],s=t.pixels[0],c=e.mask;for(let e=2;e<r-1;e++){let t=new Map;for(let r=e-2;r<e+2;r++)for(let e=0;e<4;e++){let i=r*n+e;j(t,a[i],c?c[i]:1)}s[e*n]=k(t),s[e*n+1]=s[e*n+2]=s[e*n];let r=3;for(;r<n-1;r++){let i=(e-2)*n+r+1;j(t,a[i],c?c[i]:1),i=(e-1)*n+r+1,j(t,a[i],c?c[i]:1),i=e*n+r+1,j(t,a[i],c?c[i]:1),i=(e+1)*n+r+1,j(t,a[i],c?c[i]:1),i=(e-2)*n+r-3,A(t,a[i],c?c[i]:1),i=(e-1)*n+r-3,A(t,a[i],c?c[i]:1),i=e*n+r-3,A(t,a[i],c?c[i]:1),i=(e+1)*n+r-3,A(t,a[i],c?c[i]:1),s[e*n+r]=k(t)}s[e*n+r+1]=s[e*n+r]}for(let e=0;e<n;e++)s[e]=s[n+e]=s[2*n+e],s[(r-1)*n+e]=s[(r-2)*n+e];return t.updateStatistics(),t}function k(e){if(e.size===0)return 0;let t=0,n=-1,r=0,i=e.keys(),a=i.next();for(;!a.done;)r=e.get(a.value),r>t&&(n=a.value,t=r),a=i.next();return n}function A(e,t,n){if(n===0)return;let r=e.get(t);r===1?e.delete(t):e.set(t,r-1)}function j(e,t,n){n!==0&&e.set(t,e.has(t)?e.get(t)+1:1)}function M(e,t,n){let{x:i,y:a}=t,{width:s,height:c}=n;if(i===0&&a===0&&c===e.height&&s===e.width)return e;let{width:l,height:u}=e,d=Math.max(0,a),f=Math.max(0,i),p=Math.min(i+s,l),m=Math.min(a+c,u);if(p<0||m<0||!o(e))return null;i=Math.max(0,-i),a=Math.max(0,-a);let{pixels:h}=e,g=s*c,_=h.length,v=[];for(let t=0;t<_;t++){let n=h[t],o=r.createEmptyBand(e.pixelType,g);for(let e=d;e<m;e++){let t=e*l,r=(e+a-d)*s+i;for(let e=f;e<p;e++)o[r++]=n[t+e]}v.push(o)}let y=new Uint8Array(g),b=e.mask;for(let e=d;e<m;e++){let t=e*l,n=(e+a-d)*s+i;for(let e=f;e<p;e++)y[n++]=b?b[t+e]:1}let x=new r({width:n.width,height:n.height,pixelType:e.pixelType,pixels:v,mask:y});return x.updateStatistics(),x}function N(e,t=!0){if(!o(e))return null;let{pixels:n,width:i,height:a,mask:s,pixelType:c}=e,l=[],u=Math.round(i/2),d=Math.round(a/2),f=a-1,p=i-1;for(let e=0;e<n.length;e++){let o=n[e],s=r.createEmptyBand(c,u*d),m=0;for(let e=0;e<a;e+=2)for(let n=0;n<i;n+=2){let r=o[e*i+n];if(t){let t=n===p?r:o[e*i+n+1],a=e===f?r:o[e*i+n+i],c=n===p?a:e===f?t:o[e*i+n+i+1];s[m++]=(r+t+a+c)/4}else s[m++]=r}l.push(s)}let m=null;if(s!=null){m=new Uint8Array(u*d);let e=0;for(let n=0;n<a;n+=2)for(let r=0;r<i;r+=2){let a=s[n*i+r];if(t){let t=r===p?a:s[n*i+r+1],o=n===f?a:s[n*i+r+i],c=r===p?o:n===f?t:s[n*i+r+i+1];m[e++]=a*t*o*c?1:0}else m[e++]=a}}return new r({width:u,height:d,pixelType:c,pixels:l,mask:m})}function P(e,t,n=0,r=!0){if(!o(e))return null;let{width:i,height:a}=t,{width:s,height:c}=e,l=new Map,u={x:0,y:0},d=1+n,f=e;for(let e=0;e<d;e++){let n=Math.ceil(s/i),o=Math.ceil(c/a);for(let r=0;r<o;r++){u.y=r*a;for(let a=0;a<n;a++){u.x=a*i;let n=M(f,u,t);l.set(`${e}/${r}/${a}`,n)}}e<d-1&&(f=N(f,r)),s=Math.round(s/2),c=Math.round(c/2)}return l}function ee(e){let{pixelBlock:t,tileSize:n,level:r,row:i,col:a,useBilinear:s}=e;if(!o(t))return null;let{width:c,height:l}=n,u=2**r,d=u*c,f=u*l,p=M(t,{y:i*f,x:a*d},{width:d,height:f});if(!p)return null;for(let e=r;e>0;e--)p=N(p,s);return p}function F(e,t,n,r,i=0){let{width:a,height:o}=e,{width:s,height:c}=t,l=r.cols,u=r.rows,d=Math.ceil(s/l-.1/l),f=Math.ceil(c/u-.1/u),p,m,h,g,_,v,y,b=d*l,x=b*f*u,S=new Float32Array(x),C=new Float32Array(x),w=new Uint32Array(x),T=new Uint32Array(x),E,D,O=0;for(let e=0;e<f;e++)for(let t=0;t<d;t++){p=12*(e*d+t),m=n[p],h=n[p+1],g=n[p+2],_=n[p+3],v=n[p+4],y=n[p+5];for(let n=0;n<u;n++){O=(e*u+n)*b+t*l,D=(n+.5)/u;for(let e=0;e<n;e++)E=(e+.5)/l,S[O+e]=(m*E+h*D+g)*a+i,C[O+e]=(_*E+v*D+y)*o+i,w[O+e]=Math.floor(S[O+e]),T[O+e]=Math.floor(C[O+e])}p+=6,m=n[p],h=n[p+1],g=n[p+2],_=n[p+3],v=n[p+4],y=n[p+5];for(let n=0;n<u;n++){O=(e*u+n)*b+t*l,D=(n+.5)/u;for(let e=n;e<l;e++)E=(e+.5)/l,S[O+e]=(m*E+h*D+g)*a+i,C[O+e]=(_*E+v*D+y)*o+i,w[O+e]=Math.floor(S[O+e]),T[O+e]=Math.floor(C[O+e])}}return{offsets_x:S,offsets_y:C,offsets_xi:w,offsets_yi:T,gridWidth:b}}function te(e,t){let{coefficients:n,spacing:r}=t,{offsets_x:i,offsets_y:a,gridWidth:o}=F(e,e,n,{rows:r[0],cols:r[1]}),{width:s,height:c}=e,l=new Float32Array(s*c),u=180/Math.PI;for(let e=0;e<c;e++)for(let t=0;t<s;t++){let n=e*o+t,r=e===0?n:n-o,d=e===c-1?n:n+o,f=i[r]-i[d],p=a[d]-a[r];if(isNaN(f)||isNaN(p))l[e*s+t]=90;else{let n=Math.atan2(p,f)*u;n=(360+n)%360,l[e*s+t]=n}}return l}function ne(e,t,n,i,a=`nearest`){if(!o(e))return null;a===`majority`&&(e=O(e));let{pixels:s,mask:c,bandMasks:l,pixelType:u}=e,d=e.width,f=e.height,p=r.getPixelArrayConstructor(u),m=s.length,{width:h,height:g}=t,_=!1;for(let e=0;e<n.length;e+=3)n[e]===-1&&n[e+1]===-1&&n[e+2]===-1&&(_=!0);let{offsets_x:v,offsets_y:y,offsets_xi:b,offsets_yi:x,gridWidth:S}=F({width:d,height:f},t,n,i,a===`majority`?.5:0),C,w=(e,t,n,r)=>{let i=e instanceof Float32Array||e instanceof Float64Array?0:.5;for(let a=0;a<g;a++){C=a*S;for(let o=0;o<h;o++){if(v[C]<0||y[C]<0)e[a*h+o]=0;else if(r)e[a*h+o]=t[b[C]+x[C]*d];else{let r=Math.floor(v[C]),s=Math.floor(y[C]),c=Math.ceil(v[C]),l=Math.ceil(y[C]),u=v[C]-r,f=y[C]-s;if(!n||n[r+s*d]&&n[c+s*d]&&n[r+l*d]&&n[c+l*d]){let n=(1-u)*t[r+s*d]+u*t[c+s*d],p=(1-u)*t[r+l*d]+u*t[c+l*d];e[a*h+o]=(1-f)*n+f*p+i}else e[a*h+o]=t[b[C]+x[C]*d]}C++}}},T=[],E,D=l?.length===m,k=[];for(let e=0;e<m;e++){if(D){let t=new Uint8Array(h*g);w(t,l[e],l[e],!0),k.push(t)}E=new p(h*g),w(E,s[e],D?l[e]:c,a===`nearest`||a===`majority`),T.push(E)}let A=new r({width:h,height:g,pixelType:u,pixels:T,bandMasks:D?k:void 0});if(c!=null)A.mask=new Uint8Array(h*g),w(A.mask,c,c,!0);else if(_){A.mask=new Uint8Array(h*g);for(let e=0;e<h*g;e++)A.mask[e]=v[e]<0||y[e]<0?0:1}return A.updateStatistics(),A}function I(e){let{pixelBlock:t,extent:n,fieldNames:r,skipFactor:i,skipSpatialReference:o=!1,pixelIdOffset:s=0}=e,c=[],{width:l,height:u,pixels:d,mask:f}=t,p=e.imageRowSize??l,m=n.width/l,h=n.height/u,g=d.length,_=Math.floor(i/2),{xmin:v,ymax:y}=n,b=o?void 0:n.spatialReference.toJSON();for(let e=_;e<u;e+=i)for(let t=_;t<l;t+=i){let n=e*l+t;if(!f||f[n]){let i={x:v+(t+.5)*m,y:y-(e+.5)*h,spatialReference:b},o={[a]:s+e*p+t};for(let e=0;e<g;e++)o[r[e+1]]=d[e][n];c.push({geometry:i,attributes:o})}}return c}var L=new Map;L.set(`meter-per-second`,1),L.set(`kilometer-per-hour`,.277778),L.set(`knots`,.514444),L.set(`feet-per-second`,.3048),L.set(`mile-per-hour`,.44704);var R=180/Math.PI,z=5,B=new e({esriMetersPerSecond:`meter-per-second`,esriKilometersPerHour:`kilometer-per-hour`,esriKnots:`knots`,esriFeetPerSecond:`feet-per-second`,esriMilesPerHour:`mile-per-hour`});function V(e,t){return L.get(e)/L.get(t)||1}function H(e){return(450-e)%360}function U(e,t=`geographic`){let[n,r]=e,i=Math.sqrt(n*n+r*r),a=Math.atan2(r,n)*R;return a=(360+a)%360,t===`geographic`&&(a=H(a)),[i,a]}function W(e,t=`geographic`){let n=e[1];t===`geographic`&&(n=H(n)),n%=360;let r=e[0];return[r*Math.cos(n/R),r*Math.sin(n/R)]}function G(e,t,n,r=`geographic`){if(!o(e)||n==null)return e;let i=t===`vector-magdir`?e.clone():K(e,t),a=i.pixels[1];for(let e=0;e<a.length;e++)a[e]=r===`geographic`?(a[e]+n[e]+270)%360:(a[e]+360-n[e])%360;return t===`vector-magdir`?i:K(i,`vector-magdir`)}function K(e,t,n=`geographic`,i=1){if(!o(e))return e;let{pixels:a,width:s,height:c}=e,l=s*c,u=a[0],d=a[1],f=e.pixelType.startsWith(`f`)?e.pixelType:`f32`,p=r.createEmptyBand(f,l),m=r.createEmptyBand(f,l),h=0;for(let e=0;e<c;e++)for(let e=0;e<s;e++)t===`vector-uv`?([p[h],m[h]]=U([u[h],d[h]],n),p[h]*=i):([p[h],m[h]]=W([u[h],d[h]],n),p[h]*=i,m[h]*=i),h++;let g=new r({pixelType:f,width:e.width,height:e.height,mask:e.mask,validPixelCount:e.validPixelCount,maskIsAlpha:e.maskIsAlpha,pixels:[p,m]});return g.updateStatistics(),g}function q(e,t,n=1){if(n===1||!o(e))return e;let r=e.clone(),{pixels:i,width:a,height:s}=r,c=i[0],l=i[1],u=0;for(let e=0;e<s;e++)for(let e=0;e<a;e++)t===`vector-uv`?(c[u]*=n,l[u]*=n):c[u]*=n,u++;return r.updateStatistics(),r}function re(e,t,n,r,i){if(i==null||!i.spatialReference.equals(e.spatialReference))return{extent:e,width:Math.round(t/r),height:Math.round(n/r),resolution:e.width/t};let a=i.xmin,o=i.ymax,s=(e.xmax-e.xmin)/t*r,c=(e.ymax-e.ymin)/n*r,l=(s+c)/2;return e.xmin=a+Math.floor((e.xmin-a)/s)*s,e.xmax=a+Math.ceil((e.xmax-a)/s)*s,e.ymin=o+Math.floor((e.ymin-o)/c)*c,e.ymax=o+Math.ceil((e.ymax-o)/c)*c,{extent:e,width:Math.round(e.width/s),height:Math.round(e.height/c),resolution:l}}var ie=J(0,0,0);function J(e=0,t=0,n=Math.PI,r=!0){r&&(n=(2*Math.PI-n)%(2*Math.PI));let i=r?-1:1,a=13*i,o=-7*i,s=-2*i,c=-16*i,l=21.75,[u,d]=Y(0,t+a,n,l),[f,p]=Y(e-5.5,t+o,n,l),[m,h]=Y(e+5.5,t+o,n,l),[g,_]=Y(e-1.5,t+s,n,l),[v,y]=Y(e+1.5,t+s,n,l),[b,x]=Y(e-1.5,t+c,n,l),[S,C]=Y(e+1.5,t+c,n,l);return[u,d,f,p,g,_,v,y,m,h,b,x,S,C]}function ae(e=0,t=Math.PI,n=!0){n&&(t=(2*Math.PI-t)%(2*Math.PI));let r=n?-1:1,i=5*r,a=20*r,o=25*r,s=2*r,c=n?1:-1,l=10/2*c,[u,d]=[0+l,0-a],[f,p]=[u+2*c,d],[m,h]=[f-0*c,p+s],[g,_]=[0-l,0-o],[v,y]=[g+0*c,_-s],b=Math.ceil(e/z),x=Math.floor(b/10);b-=8*x;let S=[],C=[];for(let e=0;e<b/2;e++,x--){x<=0&&b%2==1&&e===(b-1)/2&&(g=0,v=g+0*c,_=(_+d)/2,y=_-s);let[n,r]=Y(g,_,t,45);if(x>0){let[e,i]=Y(f,_,t,45),[a,o]=Y(u,d,t,45);S.push(e),S.push(i),S.push(n),S.push(r),S.push(a),S.push(o)}else{let[e,i]=Y(f,p,t,45),[a,o]=Y(m,h,t,45),[s,c]=Y(v,y,t,45);C.push(n),C.push(r),C.push(s),C.push(c),C.push(a),C.push(o),C.push(e),C.push(i)}_+=i,d+=i,p+=i,h+=i,y+=i}let[w,T]=Y(0+l,0+a,t,45),E=7*c,[D,O]=Y(0+E,0+a,t,45),[k,A]=Y(0+l,0-o,t,45),[j,M]=Y(0+E,0-o,t,45);return{pennants:S,barbs:C,shaft:[w,T,D,O,k,A,j,M]}}function Y(e,t,n,r=1){let i=Math.sqrt(e*e+t*t)/r,a=(2*Math.PI+Math.atan2(t,e))%(2*Math.PI);return[i,(2*Math.PI+a-n)%(2*Math.PI)]}var X=[0,1,3,6,10,16,21,27,33,40,47,55,63],oe=[0,.5,1,1.5,2],se=[0,.25,.5,1,1.5,2,2.5,3,3.5,4];function Z(e,t,n,r){let i=V(r||`knots`,n),a;for(a=1;a<t.length;a++)if(a===t.length-1){if(e<t[a]*i)break}else if(e<=t[a]*i)break;return Math.min(a-1,t.length-2)}function ce(e,t,n,r,i){let a=0;switch(t){case`beaufort_kn`:a=Z(e,X,`knots`,n);break;case`beaufort_km`:a=Z(e,X,`kilometer-per-hour`,n);break;case`beaufort_ft`:a=Z(e,X,`feet-per-second`,n);break;case`beaufort_m`:a=Z(e,X,`meter-per-second`,n);break;case`classified_arrow`:a=Z(e,i??[],r,n);break;case`ocean_current_m`:a=Z(e,oe,`meter-per-second`,n);break;case`ocean_current_kn`:a=Z(e,se,`knots`,n)}return a}function le(e,t){let{style:n,inputUnit:r,outputUnit:i,breakValues:a}=t,o=B.fromJSON(r),s=B.fromJSON(i),c=0,l=0,{width:u,height:d,mask:f}=e,p=e.pixels[0],m=e.pixels[1],h=f==null?u*d:f.filter(e=>e>0).length,g=new Float32Array(h*42),_=new Uint32Array(15*h),v=t.invertDirection?J(0,0,0,!1):ie;for(let e=0;e<d;e++)for(let t=0;t<u;t++){let r=e*u+t;if(!f||f[e*u+t]){let i=(m[r]+360)%360/180*Math.PI,f=ce(p[r],n,o,s,a);for(let n=0;n<v.length;n+=2)g[c++]=(t+.5)/u,g[c++]=(e+.5)/d,g[c++]=v[n],g[c++]=v[n+1]+i,g[c++]=f,g[c++]=p[r];let h=7*(c/42-1);_[l++]=h,_[l++]=h+1,_[l++]=h+2,_[l++]=h+0,_[l++]=h+4,_[l++]=h+3,_[l++]=h+0,_[l++]=h+2,_[l++]=h+3,_[l++]=h+2,_[l++]=h+5,_[l++]=h+3,_[l++]=h+5,_[l++]=h+6,_[l++]=h+3}}return{vertexData:g,indexData:_}}var Q=[];function ue(e,t){if(Q.length===0)for(let e=0;e<30;e++)Q.push(ae(5*e,0,!t.invertDirection));let n=V(B.fromJSON(t.inputUnit),`knots`),{width:r,height:i,mask:a}=e,o=e.pixels[0],s=e.pixels[1],c=[],l=[],u=0,d=0;for(let e=0;e<i;e++)for(let t=0;t<r;t++){let f=e*r+t,p=o[f]*n;if((!a||a[e*r+t])&&p>=z){let n=(s[f]+360)%360/180*Math.PI,{pennants:a,barbs:o,shaft:m}=Q[Math.min(Math.floor(p/5),29)];if(a.length+o.length===0)continue;let h=c.length/6,g=(t+.5)/r,_=(e+.5)/i;for(let e=0;e<a.length;e+=2)c[u++]=g,c[u++]=_,c[u++]=a[e],c[u++]=a[e+1]+n,c[u++]=0,c[u++]=p;for(let e=0;e<o.length;e+=2)c[u++]=g,c[u++]=_,c[u++]=o[e],c[u++]=o[e+1]+n,c[u++]=0,c[u++]=p;for(let e=0;e<m.length;e+=2)c[u++]=g,c[u++]=_,c[u++]=m[e],c[u++]=m[e+1]+n,c[u++]=0,c[u++]=p;for(let e=0;e<a.length/6;e++)l[d++]=h,l[d++]=h+1,l[d++]=h+2,h+=3;for(let e=0;e<o.length/8;e++)l[d++]=h,l[d++]=h+1,l[d++]=h+2,l[d++]=h+1,l[d++]=h+2,l[d++]=h+3,h+=4;l[d++]=h+0,l[d++]=h+1,l[d++]=h+2,l[d++]=h+1,l[d++]=h+3,l[d++]=h+2,h+=4}}return{vertexData:new Float32Array(c),indexData:new Uint32Array(l)}}function $(e,t){let n=0,r=0,{width:i,height:a,mask:o}=e,s=e.pixels[0],c=[],l=[],u=V(B.fromJSON(t.inputUnit),`knots`),d=t.style===`wind_speed`?z:Number.MAX_VALUE;for(let e=0;e<a;e++)for(let t=0;t<i;t++){let f=s[e*i+t]*u;if((!o||o[e*i+t])&&f<d){for(let r=0;r<4;r++)c[n++]=(t+.5)/i,c[n++]=(e+.5)/a,c[n++]=r<2?-.5:.5,c[n++]=r%2==0?-.5:.5,c[n++]=0,c[n++]=f;let o=4*(n/24-1);l[r++]=o,l[r++]=o+1,l[r++]=o+2,l[r++]=o+1,l[r++]=o+2,l[r++]=o+3}}return{vertexData:new Float32Array(c),indexData:new Uint32Array(l)}}function de(e,t){return t.style===`simple_scalar`?$(e,t):t.style===`wind_speed`?ue(e,t):le(e,t)}function fe(e,t,n,i=[0,0],a=.5){let{width:o,height:s,mask:c}=e,[l,u]=e.pixels,[d,f]=i,p=Math.round((o-d)/n),m=Math.round((s-f)/n),h=p*m,g=new Float32Array(h),_=new Float32Array(h),v=new Uint8Array(h),y=t===`vector-uv`;for(let e=0;e<m;e++)for(let t=0;t<p;t++){let r=0,i=e*p+t,m=Math.max(0,e*n+f),h=Math.max(0,t*n+d),b=Math.min(s,m+n),x=Math.min(o,h+n);for(let e=m;e<b;e++)for(let t=h;t<x;t++){let n=e*o+t;if(!c||c[n]){r++;let e=y?[l[n],u[n]]:[l[n],(360+u[n])%360],[t,a]=y?e:W(e);g[i]+=t,_[i]+=a}}if(r>=(b-m)*(x-h)*(1-a)){v[i]=1;let[e,t]=U([g[i]/r,_[i]/r]);g[i]=e,_[i]=t}else v[i]=0,g[i]=0,_[i]=0}let b=new r({width:p,height:m,pixels:[g,_],mask:v});return b.updateStatistics(),b}export{f as A,I as C,o as D,h as E,y as M,m as N,p as O,l as S,i as T,C as _,K as a,d as b,q as c,te as d,ee as f,T as g,ne as h,V as i,D as j,s as k,B as l,x as m,de as n,U as o,M as p,$ as r,re as s,fe as t,G as u,P as v,b as w,u as x,c as y};