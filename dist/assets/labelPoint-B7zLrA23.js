import{AE as e,Cx as t,Qm as n,Sy as r,Xm as i,Ym as a,Zm as o,Zv as s,eh as c,i_ as l,ky as u,o_ as d,py as f}from"./index-BqmCqmfp.js";import{t as p}from"./OptimizedGeometry-f3I9Z6C1.js";var m=class{static fromOptimized(e,t,n=!1,r=!1,i=1){return new h().initialize(e,t,n,r,i)}static fromJSON(e,t=!1,n=!1){let[r,i]=_(e);return new v().initialize(r,i,t,n,1)}static fromOptimizedCIM(e,t,n=!1,r=!1,i=1){return new x().initialize(e,t,n,r,i)}static fromJSONCIM(e,t=!1,n=!1,r=1){let[i,a]=_(e);return new S().initialize(i,a,t,n,r)}static fromFeatureSetReader(e){let t=e.readGeometryForDisplay(),n=e.geometryType;return t&&n?this.fromOptimized(t,n):null}static fromFeatureSetReaderCIM(e){let t=e.readGeometryForDisplay(),n=e.geometryType;return t&&n?this.fromOptimizedCIM(t,n):null}static createEmptyOptimized(e,t=!1,n=!1,r=1){return new h().initialize(new p,e,t,n,r)}static createEmptyJSON(e,t=!1,n=!1){return new v().initialize([],e,t,n,1)}static createEmptyOptimizedCIM(e,t=!1,n=!1,r=1){return new x().initialize(new p,e,t,n,r)}static createEmptyJSONCIM(e,t=!1,n=!1,r=1){return new S().initialize([],e,t,n,r)}asJSON(){let e=u(this);return this.geometryType===`esriGeometryEnvelope`?{xmin:e[0][0][0],ymin:e[0][0][1],xmax:e[0][2][0],ymax:e[0][2][1]}:this.geometryType===`esriGeometryMultipoint`?{points:e.flat()}:this.geometryType===`esriGeometryPoint`?{x:e[0][0][0],y:e[0][0][1]}:this.geometryType===`esriGeometryPolygon`?{rings:e}:{paths:e}}getCurrentRingArea(){if(this.pathSize<3)return 0;let e,t,n=0;if(this.seekPathStart(),!this.nextPoint())return 0;e=this.x,t=this.y;let r=e,i=t;for(;this.nextPoint();)n+=(e-this.x)*(t+this.y),e=this.x,t=this.y;return n+=(e-r)*(t+i),-.5*n}invertY(){this.yFactor*=-1}},h=class e extends m{constructor(){super(...arguments),this._end=-1}initialize(e,t,n,r,i){return this.hasZ=n,this.hasM=r,this.geometryType=t,this._stride=2+Number(n)+Number(r),this._geometry=e,this._pathIndex=-1,this._pathOffset=0,this._pointOffset=-this._stride,this._end=-1,this.yFactor=i,this}reset(){this.initialize(this._geometry,this.geometryType,this.hasZ,this.hasM,this.yFactor)}seekPath(e){if(e>=0&&e<this.totalSize){if(this._pathIndex<e)for(;this._pathIndex<e&&this.nextPath(););else if(this._pathIndex>e)for(;this._pathIndex>e&&this.prevPath(););return!0}return!1}seekPathStart(){this._pointOffset=this._pathOffset-this._stride}seekPathEnd(){this._pointOffset=this._end}seekInPath(e){let t=this._pathOffset+e*this._stride;return t>=0&&t<this._end&&(this._pointOffset=t,!0)}nextPoint(){return(this._pointOffset+=this._stride)<this._end}prevPoint(){return(this._pointOffset-=this._stride)>=this._pathOffset}nextPath(){return!(this.pathIndex>=this.totalSize-1)&&(this._pathIndex>=0&&(this._pathOffset+=this._stride*this.pathSize),this._pathIndex++,this._pointOffset=this._pathOffset-this._stride,this._end=this._pointOffset+this._stride+this._stride*this.pathSize,!0)}prevPath(){return!(this.pathIndex<=0)&&(this._pathIndex--,this._end=this._pathOffset,this._pathOffset-=this._stride*this.pathSize,this._pointOffset=this._pathOffset-this._stride,!0)}getCurrentPath(){let t=this._end,n=this._geometry.coords,r=this._pathOffset;return new e().initialize(new p([this.pathSize],n.slice(r,t)),this.geometryType,this.hasZ,this.hasM,this.yFactor)}pathLength(){let e=this._end,t=this._stride,n=this._geometry.coords,r=0;for(let i=this._pathOffset+t;i<e;i+=t){let e=n[i-t],a=n[i-t+1],o=n[i]-e,s=n[i+1]-a;r+=Math.sqrt(o*o+s*s)}return r}startPath(){this._geometry.lengths.push(0)}pushPath(e){this.startPath(),this.pushPoints(e)}pushPoint(e){for(let t=0;t<this._stride;++t)this._geometry.coords.push(e[t]);this._geometry.lengths[this.totalSize-1]++}pushXY(e,t){this._geometry.coords.push(e,t),this._geometry.lengths[this.totalSize-1]++}pushPoints(e){for(let t of e)for(let e=0;e<this._stride;++e)this._geometry.coords.push(t[e]);this._geometry.lengths[this.totalSize-1]+=e.length}pushCursor(e){let t=e.asOptimized();this._geometry.coords.push(...t.coords),this._geometry.lengths.push(...t.lengths)}asOptimized(){let e=this._geometry.clone();if(this.yFactor!==1)for(let t=1;t<e.coords.length;t+=this._stride)e.coords[t]*=this.yFactor;return this.geometryType===`esriGeometryPoint`&&(e.lengths.length=0),e}isClosed(){let e=this._geometry.coords,t=this._pathOffset,n=this._end-this._stride;for(let r=0;r<this._stride;r++)if(e[t+r]!==e[n+r])return!1;return!0}clone(){return new e().initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._geometry.isPoint?1:this._geometry.lengths.reduce((e,t)=>e+t)}get pathSize(){let{lengths:e}=this._geometry;return this._geometry.isPoint?1:this._pathIndex<0||this._pathIndex>e.length-1?0:e[this._pathIndex]}get totalSize(){return this._geometry.isPoint?1:this._geometry.lengths.length}get x(){return this._geometry.coords[this._pointOffset]}set x(e){this._geometry.coords[this._pointOffset]=e}get y(){return this.yFactor*this._geometry.coords[this._pointOffset+1]}set y(e){this._geometry.coords[this._pointOffset+1]=this.yFactor*e}get z(){return this._geometry.coords[this._pointOffset+2]}set z(e){this._geometry.coords[this._pointOffset+2]=e}get m(){let e=this.hasZ?3:2;return this._geometry.coords[this._pointOffset+e]}set m(e){this._geometry.coords[this._pointOffset+3]=e}get pathIndex(){return this._pathIndex}get _coordIndex(){return this._pointOffset/this._stride}};function g(e){let t=[e.x,e.y];return e.z&&t.push(e.z),e.m&&t.push(e.m),t}function _(e){return c(e)?[e.rings,`esriGeometryPolygon`]:o(e)?[e.paths,`esriGeometryPolyline`]:n(e)?[[e.points],`esriGeometryMultipoint`]:i(e)?[[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]],`esriGeometryEnvelope`]:a(e)?[[[g(e)]],`esriGeometryPoint`]:[[],`esriGeometryPolyline`]}var v=class t extends m{initialize(e,t,n,r,i){return this._paths=e,this.geometryType=t,this.hasZ=n,this.hasM=r,this._pathIndex=this._pointIndex=-1,this.yFactor=i,this._mIndex=this.hasZ?3:2,this}reset(){this._pathIndex=this._pointIndex=-1}seekPath(e){return this._pathIndex=e,this._pointIndex=-1,e>=0&&e<this.totalSize&&(this._currentPath=this._paths[e],!0)}seekPathStart(){this._pointIndex=-1}seekPathEnd(){this._pointIndex=this._currentPath.length}seekInPath(e){return e>=0&&e<this._currentPath.length&&(this._pointIndex=e,this._currentPoint=this._currentPath[this._pointIndex],!0)}nextPoint(){return this._currentPoint=this._currentPath[++this._pointIndex],this._pointIndex<this._currentPath.length}prevPoint(){return this._currentPoint=this._currentPath[--this._pointIndex],this._pointIndex>=0}nextPath(){return this._pointIndex=-1,this._currentPath=this._paths[++this._pathIndex],this._pathIndex<this.totalSize}prevPath(){return this.pathIndex>0&&(this._pointIndex=-1,this._pathIndex--,this._currentPath=this._paths[this._pathIndex],!0)}pathLength(){let e=this._currentPath.length,t=this._currentPath,n=0;for(let r=1;r<e;r++){let e=t[r-1],i=t[r],a=e[0],o=e[1],s=i[0]-a,c=i[1]-o;n+=Math.sqrt(s*s+c*c)}return n}startPath(){this._paths.push([])}getCurrentPath(){return new t().initialize([this._currentPath],this.geometryType,this.hasZ,this.hasM,this.yFactor)}pushPath(e){this._paths.push(e)}pushPoint(e){this._paths[this.totalSize-1].push(e)}pushXY(e,t){this._paths[this.totalSize-1].push([e,t])}pushPoints(e){this._paths[this.totalSize-1].push(...e)}pushCursor(e){let t=u(e);for(let e of t)this.pushPath(e)}asOptimized(){let e=new p;if(this.geometryType===`esriGeometryPoint`)e.coords.push(...this._paths[0][0]),e.lengths.length=0;else for(let t of this._paths){for(let n of t)e.coords.push(n[0]),e.coords.push(n[1]*this.yFactor),this.hasZ&&e.coords.push(n[2]),this.hasM&&e.coords.push(n[this._mIndex]);e.lengths.push(t.length)}return e}isClosed(){let e=this._currentPath[0],t=this._currentPath[this._currentPath.length-1];for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}clone(){return new t().initialize(e(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._paths.map(e=>e.length).reduce((e,t)=>e+t)}get pathSize(){return this._pathIndex<0||this._pathIndex>this.totalSize-1?-1:this._paths[this._pathIndex].length}get totalSize(){return this._paths.length}get x(){return this._currentPoint[0]}set x(e){this._currentPoint[0]=e}get y(){return this.yFactor*this._currentPoint[1]}set y(e){this._currentPoint[1]=this.yFactor*e}get z(){return this._currentPoint[2]}set z(e){this._currentPoint[2]=e}get m(){return this._currentPoint[this._mIndex]}set m(e){this._currentPoint[this._mIndex]=e}get pathIndex(){return this._pathIndex}},y=4,b=1,x=class e extends h{initialize(e,t,n,r,i){return super.initialize(e,t,n,r,i),this._controlPoints||=this._controlPoints=Array(this.totalSize).fill(void 0).map(e=>new Set),this}startPath(){super.startPath(),this._controlPoints.push(new Set)}clone(){let t=new e().initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor);return t._controlPoints=this._controlPoints,t}setControlPoint(){this._controlPoints[this.pathIndex].add(this._coordIndex)}getControlPoint(){return this._controlPoints[this.pathIndex].has(this._coordIndex)}setControlPointAt(e){this._controlPoints[this.pathIndex].add(e)}getControlPointAt(e){return this._controlPoints[this.pathIndex].has(e)}},S=class t extends v{initialize(e,t,n,r,i){return super.initialize(e,t,n,r,i)}clone(){return new t().initialize(e(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}setControlPoint(){this._paths[this.pathIndex][this._pointIndex][y]=b}getControlPoint(){return this._paths[this.pathIndex][this._pointIndex][y]===b}setControlPointAt(e){this._paths[this.pathIndex][e][y]=b}getControlPointAt(e){return this._paths[this.pathIndex][e][y]===b}},C=100*222045e-21;function w(e){if(e.totalSize===0)return null;let t=d(e);if(!t)return null;let n=4*(Math.abs(t[0])+Math.abs(t[2])+Math.abs(t[1])+Math.abs(t[3])+1)*C,r=0,i=0;e.reset();for(let t=0;e.nextPath();t++){let n=e.getCurrentRingArea();n>i&&(i=n,r=t)}if(e.seekPath(r),e.pathSize===0)return null;e.seekPathStart();let a=l(e);if(Math.abs(i)<=2*n*n)return[(a[0]+a[2])/2,(a[1]+a[3])/2];e.seekPathStart();let o=f(e,s());if(o===null)return null;if(e.totalPoints<4)return o;let c=[[NaN,NaN],[NaN,NaN],[NaN,NaN],[NaN,NaN]],u=[NaN,NaN,NaN,NaN],p=[NaN,NaN,NaN,NaN],m=!1,h=E(o,e,!0);h.distance===0&&(m=!0,c[0][0]=o[0],c[0][1]=o[1],h=E(o,e,!1)),u[0]=h.distance,p[0]=0;let g=[NaN,NaN],_=!1,v=.25,y=-1,b=NaN;do if(b=NaN,c[1]=D(e,F(a[0],a[2],v),n,t),isNaN(c[1][0])||isNaN(c[1][1])||(h=E(c[1],e,!1),b=h.distance),!isNaN(b)&&b>n&&T(c[1],e))_=!0,u[1]=b,p[1]=I(c[1],o);else if(!isNaN(b)&&b>y&&(y=b,g[0]=c[1][0],g[1]=c[1][1]),v-=.01,v<.1){if(!(y>=0))break;_=!0,u[1]=y,c[1][0]=g[0],c[1][1]=g[1],p[1]=I(c[1],o)}while(!_);_=!1,v=.5,y=-1;let x=.01,S=1;do if(b=NaN,c[2]=D(e,F(a[0],a[2],v),n,t),isNaN(c[2][0])||isNaN(c[2][1])||(h=E(c[2],e,!1),b=h.distance),!isNaN(b)&&b>n&&T(c[2],e))_=!0,u[2]=b,p[2]=I(c[2],o);else if(!isNaN(b)&&b>y)y=b,g[0]=c[2][0],g[1]=c[2][1];else if(b>y&&(y=b,g[0]=c[2][0],g[1]=c[2][1]),v=.5+x*S,x+=.01,S*=-1,v<.3||v>.7){if(!(y>=0))break;_=!0,u[2]=y,c[2][0]=g[0],c[2][1]=g[1],p[2]=I(c[2],o)}while(!_);_=!1,v=.75,y=-1;do if(b=NaN,c[3]=D(e,F(a[0],a[2],v),n,t),isNaN(c[3][0])||isNaN(c[3][1])||(h=E(c[3],e,!1),b=h.distance),!isNaN(b)&&b>n&&T(c[3],e))_=!0,u[3]=b,p[3]=I(c[3],o);else if(b>y&&(y=b,g[0]=c[3][0],g[1]=c[3][1]),v+=.01,v>.9){if(!(y>=0))break;_=!0,u[3]=y,c[3][0]=g[0],c[3][1]=g[1],p[3]=I(c[3],o)}while(!_);let w=[0,1,2,3],O=m?0:1,k;for(let e=O;e<4;e++)for(let e=O;e<3;e++){let t=p[e],n=p[e+1];L(t,n)>0&&(k=w[e],w[e]=w[e+1],w[e+1]=k,p[e]=n,p[e+1]=t)}let A=O,j=0,M=0;for(let e=O;e<4;e++){switch(e){case 0:M=2*u[w[e]];break;case 1:M=1.66666666*u[w[e]];break;case 2:M=1.33333333*u[w[e]];break;case 3:M=u[w[e]]}M>j&&(j=M,A=w[e])}return c[A]}function T(e,t){let n,r,i,a,o=0;for(t.reset();t.nextPath()&&t.nextPoint();)for(n=t.x,r=t.y;t.nextPoint();n=i,r=a)i=t.x,a=t.y,r>e[1]!=a>e[1]&&((i-n)*(e[1]-r)-(a-r)*(e[0]-n)>0?o++:o--);return o!==0}function E(e,t,n){if(n&&T(e,t))return{coord:e,distance:0};let i=1/0,a=0,o=0,s=[0,0],c=[0,0],l=[0,0];for(t.reset();t.nextPath()&&t.nextPoint();)if(!(t.pathSize<2))for(s[0]=t.x,s[1]=t.y;t.nextPoint();s=c){c=[t.x,t.y],r(l,e,s,c);let n=I(e,l);n<i&&(i=n,a=l[0],o=l[1])}return{coord:[a,o],distance:Math.sqrt(i)}}function D(e,n,r,i){let a=[n,0],o=1/0,c=1/0,l=!1,u=!1,d=[[n,i[1]-1],[n,i[3]+1]],f=[0,0],p=[0,0],m=[0,0],h=[[0,0],[0,0]],g=s();for(e.reset();e.nextPath()&&e.nextPoint();)if(!(e.pathSize<2))for(h[0][0]=e.x,h[0][1]=e.y;e.nextPoint();h[0][0]=h[1][0],h[0][1]=h[1][1]){if(h[1][0]=e.x,h[1][1]=e.y,O(g,h)===null||(p[0]=d[0][0],p[1]=d[0][1],m[0]=d[1][0],m[1]=d[1][1],N(g,p,m)===0)||!t(d[0],d[1],h[0],h[1],f))continue;let n=f[1];o>c?n<o&&(o=n,l=!0):n<c&&(c=n,u=!0)}return l&&u?a[1]=(o+c)/2:a[0]=a[1]=NaN,a}function O(e,t){if(t.length<2)return null;e||=s();let[n,r]=t[0],[i,a]=t[1];return e[0]=Math.min(n,i),e[1]=Math.min(r,a),e[2]=Math.max(n,i),e[3]=Math.max(r,a),e}var k=1,A=4,j=3,M=12;function N(e,t,n){let r=P(t,e),i=P(n,e),a=e[0],o=e[1],s=e[2],c=e[3];if(r&i)return 0;if(!(r|i))return 4;let l=(r?1:0)|(i?2:0);do{let l=n[0]-t[0],u=n[1]-t[1];if(l>u)r&j?(r&k?(t[1]+=u*(a-t[0])/l,t[0]=a):(t[1]+=u*(s-t[0])/l,t[0]=s),r=P(t,e)):i&j?(i&k?(n[1]+=u*(a-n[0])/l,n[0]=a):(n[1]+=u*(s-n[0])/l,n[0]=s),i=P(n,e)):r?(r&A?(t[0]+=l*(o-t[1])/u,t[1]=o):(t[0]+=l*(c-t[1])/u,t[1]=c),r=P(t,e)):(i&A?(n[0]+=l*(o-n[1])/u,n[1]=o):(n[0]+=l*(c-n[1])/u,n[1]=c),i=P(n,e));else if(r&M?(r&A?(t[0]+=l*(o-t[1])/u,t[1]=o):(t[0]+=l*(c-t[1])/u,t[1]=c),r=P(t,e)):i&M?(i&A?(n[0]+=l*(o-n[1])/u,n[1]=o):(n[0]+=l*(c-n[1])/u,n[1]=c),i=P(n,e)):r?(r&k?(t[1]+=u*(a-t[0])/l,t[0]=a):(t[1]+=u*(s-t[0])/l,t[0]=s),r=P(t,e)):(i&k?(n[1]+=u*(a-n[0])/l,n[0]=a):(n[1]+=u*(s-n[0])/l,n[0]=s),i=P(n,e)),r&i)return 0}while(r|i);return l}function P(e,t){return(e[0]<t[0]?1:0)|(e[0]>t[2]?1:0)<<1|(e[1]<t[1]?1:0)<<2|(e[1]>t[3]?1:0)<<3}function F(e,t,n){return e+(t-e)*n}function I(e,t){return(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])}function L(e,t){if(e<t)return-1;if(e>t)return 1;if(e===t)return 0;let n=isNaN(e),r=isNaN(t);return n<r?-1:n>r?1:0}export{m as n,w as t};