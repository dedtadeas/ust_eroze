const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/calcite-icon-D_iKcGa4.js","assets/dom-atD5WAsR.js","assets/guid-D8BoG5RM.js","assets/logger-N52NEE_B.js","assets/index-BqmCqmfp.js","assets/index-kIqmb12G.css","assets/observers-Ca90Dkfx.js","assets/calcite-icon-DU8UXGam.js","assets/calcite-input-8gkP-05n.js","assets/controllers-DZ7pbtKF.js","assets/calcite-input-C8DWvaD7.js","assets/useSetFocus-BOgV9A-L.js","assets/form-CYe_Hdps.js","assets/interactive-C1Xh6Lv0.js","assets/key-UZzOT_rp.js","assets/label-CbTib4du.js","assets/useT9n-bRfAARgx.js","assets/keyed-CU6bsPrA.js","assets/static-CFhWbVpa.js","assets/calcite-input-message-BD7sw1wZ.js","assets/calcite-progress-B9qY8ZRX.js","assets/calcite-loader-BQ1zV8tb.js","assets/calcite-loader-C2BnVEC6.js","assets/calcite-notice-CvAfSaDY.js","assets/openCloseComponent-C1bAqVbv.js","assets/calcite-chip-DHdJ6msM.js","assets/calcite-list-CgWjPxHf.js","assets/useCancelable-CRHa62_S.js","assets/utils2-B1dhLot4.js","assets/calcite-scrim-ChNbuBJA.js","assets/debounce-JuHvylml.js","assets/calcite-list-item-BNrqiIAE.js","assets/dynamicClasses-DOR4n0eL.js","assets/floating-ui-bSZlirwY.js","assets/resources5-CUqenAI5.js","assets/resources7-BZ7SBRw5.js","assets/calcite-action-CVrDQiWf.js","assets/calcite-dropdown-group-Cw7DBVuL.js","assets/calcite-dropdown-item-CuDPcNk9.js","assets/calcite-dropdown-gAQ7koWv.js","assets/calcite-tooltip-DOISgjum.js","assets/FloatingArrow-B1y4p2MR.js","assets/Feature-CglJwaNJ.js","assets/Feature-BEHOadAe.js","assets/shared-BZhQTnH4.js","assets/throttle-C7RAnISb.js","assets/unitFormatUtils-D4yCMgjI.js","assets/quantityUtils-Dywg00j-.js","assets/isImageryGraphicOrigin-Qwa2m0c8.js","assets/isImageryTileGraphicOrigin-DkUl-5nl.js","assets/AttachmentInfo-BN0SLgvw.js","assets/streamLayerUtils-BMw-RtDi.js","assets/utils-CLvHNiZV.js","assets/utils-DD1PtgG7.js","assets/utils-5jlQHYup.js","assets/cimSymbolUtils-1FVTTBxd.js","assets/gfxUtils-DZoKCRMw.js","assets/executeQueryJSON-BAg2ttNX.js","assets/query-D8IHih8e.js","assets/urlUtils-CtPsFIu4.js","assets/pbfQueryUtils-DOeTJOP2.js","assets/pbf-CwGh07vG.js","assets/memoryEstimations-O7VgDRVG.js","assets/OptimizedFeature-Dx4_lHip.js","assets/OptimizedGeometry-f3I9Z6C1.js","assets/OptimizedFeatureSet-DlHqIhoP.js","assets/queryUtils-GIY2oFHT.js","assets/FeatureUtilityNetworkAssociationsViewModel-BAKZ0nr8.js","assets/featureUtils-SEVs0V51.js"])))=>i.map(i=>d[i]);
import{CD as e,Cw as t,Kb as n,MC as r,Pd as i,Xb as a,Yb as o,_o as s,fo as c,go as l,ho as u,kC as d,mo as f,po as p,yE as m}from"./index-BqmCqmfp.js";import"./utils-DD1PtgG7.js";import"./featureUtils-SEVs0V51.js";import{n as h,t as g}from"./FeatureUtilityNetworkAssociationsViewModel-BAKZ0nr8.js";var _=`esri-utility-network-association-list`,v={featureObserver:`${_}__feature-observer`,filterContainer:`${_}__filter-container`,limitNoticeContainer:`${_}__limit-notice-container`,loadingContainer:`${_}__loading-container`},y=class extends l{constructor(e,t){super(e,t),this._isFeatureCountNoticeOpen=!0,this._observer=new IntersectionObserver(([e])=>{e?.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this._observerNode=null,this.featuresPerPage=50,this.filterText=``,this.headingLevel=5,this.maxFeatureCount=1e3,this.messagesFeature=null,this.messagesCommon=null,this.selectedLayer=null,this.tooltipReferenceMap=new i,this.viewModel=new g}initialize(){this.setUpObserver()}loadDependencies(){return s({icon:()=>t(()=>import(`./calcite-icon-D_iKcGa4.js`),__vite__mapDeps([0,1,2,3,4,5,6,7])),input:()=>t(()=>import(`./calcite-input-8gkP-05n.js`),__vite__mapDeps([8,9,4,5,10,11,1,12,13,14,15,16,17,18,2,3,6,7,19,20])),loader:()=>t(()=>import(`./calcite-loader-BQ1zV8tb.js`),__vite__mapDeps([21,9,4,5,2,16,22])),notice:()=>t(()=>import(`./calcite-notice-CvAfSaDY.js`),__vite__mapDeps([23,4,5,9,11,1,2,3,6,24,16,7]))})}destroy(){this.tooltipReferenceMap.clear()}get associatedFeatureCount(){let e=this.viewModel.associationViewModels,t=this.selectedLayer?e.get(this.selectedLayer):null;return t?t.length:0}set currentFeaturePage(e){let{featuresPerPage:t,associatedFeatureCount:n}=this,r=Math.ceil(n/t)||1,i=Math.max(Math.min(e,r),1);this._set(`currentFeaturePage`,i)}get currentFeaturePage(){return this._get(`currentFeaturePage`)??1}get endIndex(){let{currentFeaturePage:e,featuresPerPage:t,maxFeatureCount:n}=this;return Math.min(e*t,n)}renderConnectivityIcon(e,t){let{tooltipReferenceMap:n}=this,r;switch(e){case`junction-edge-from-connectivity`:r=`connection-end-left`;break;case`junction-edge-to-connectivity`:r=`connection-end-right`;break;case`junction-edge-midspan-connectivity`:r=`connection-middle`;break;default:r=`connection-to-connection`}return p(`calcite-icon`,{afterCreate:e=>n.set(t,e),afterRemoved:()=>n.delete(t),icon:r,scale:`s`,slot:`content-start`})}renderFeatureCountWarning(){let{associatedFeatureCount:e,maxFeatureCount:t,messagesFeature:n}=this;return e>t?p(`calcite-notice`,{class:this._isFeatureCountNoticeOpen?v.limitNoticeContainer:void 0,closable:!0,icon:`information`,kind:`info`,open:!0,scale:`s`,width:`full`,onCalciteNoticeBeforeOpen:()=>this._isFeatureCountNoticeOpen=!0,onCalciteNoticeClose:()=>this._isFeatureCountNoticeOpen=!1},p(`div`,{slot:`title`},n.associationsLimitNoticeTitle),p(`div`,{slot:`message`},o(n.associationsLimitNoticeMessage,{number:t}))):null}renderFeatureObserver(){return p(`div`,{afterCreate:this._onObserverCreate,bind:this,class:v.featureObserver,key:`feature-observer`})}renderFilter(){return p(`div`,{class:v.filterContainer,key:`filter`},p(`calcite-input`,{icon:`search`,placeholder:this.messagesFeature.associationFilterPlaceholder,type:`search`,onCalciteInputInput:e=>{this.filterText=e.currentTarget.value.trim().toLowerCase(),this.currentFeaturePage=1}}))}renderLoading(){return p(`div`,{class:v.loadingContainer,key:`loading-container`},this.renderLoadingIcon())}renderLoadingIcon(){return p(`calcite-loader`,{inline:!0,label:this.messagesCommon.loading})}getConnectivityTooltip(e){let{messagesFeature:t}=this;switch(e){case`connectivity`:case`junction-junction-connectivity`:return t.associationsJunctionJunction;case`junction-edge-from-connectivity`:return t.associationsJunctionEdgeFrom;case`junction-edge-midspan-connectivity`:return t.associationsJunctionEdgeMidspan;case`junction-edge-to-connectivity`:return t.associationsJunctionEdgeTo;default:return``}}setUpObserver(){this.addHandles(n(()=>this._observerNode,()=>this._onObserverChange()))}_increaseFeaturePage(){this.currentFeaturePage++}_onObserverChange(){this._observerNode&&this._observer.unobserve(this._observerNode);let{state:e,showAllEnabled:t}=this.viewModel;this._observerNode&&e===`ready`&&t&&this._observer.observe(this._observerNode)}_onObserverCreate(e){this._observerNode=e}};e([r()],y.prototype,`_observer`,void 0),e([r()],y.prototype,`_observerNode`,void 0),e([r()],y.prototype,`associatedFeatureCount`,null),e([r()],y.prototype,`currentFeaturePage`,null),e([r()],y.prototype,`endIndex`,null),e([r()],y.prototype,`featuresPerPage`,void 0),e([r()],y.prototype,`filterText`,void 0),e([r()],y.prototype,`headingLevel`,void 0),e([r()],y.prototype,`maxFeatureCount`,void 0),e([r(),f(`esri/widgets/Feature/t9n/Feature`)],y.prototype,`messagesFeature`,void 0),e([r(),f(`esri/t9n/common`)],y.prototype,`messagesCommon`,void 0),e([r()],y.prototype,`selectedLayer`,void 0),e([r()],y.prototype,`tooltipReferenceMap`,void 0),e([r({type:g})],y.prototype,`viewModel`,void 0),y=e([d(`esri.widgets.support.UtilityNetworkAssociations.UtilityNetworkAssociationList`)],y);function b(e){let{percentAlong:t}=e;return t==null?``:a(t,{style:`percent`,maximumFractionDigits:2})}function x(e){let{associationType:t}=e;return t===`connectivity`||t===`junction-junction-connectivity`||t===`junction-edge-from-connectivity`||t===`junction-edge-midspan-connectivity`||t===`junction-edge-to-connectivity`}function S(e){return e.associationType===`junction-edge-midspan-connectivity`}var C,w=`esri-feature-utility-network-associations`,T={base:w,listItemHidden:`${w}__list-item--hidden`},E=`nested`,D=C=class extends y{constructor(e,t){super(e,t),this.description=null,this.flowItems=null,this.flowType=`feature-utility-network-association-type`,this.listType=null,this.parentFeatureViewModel=null,this.title=null,this.viewModel=new g,this.visibleElements=new h}initialize(){this.setUpObserver()}loadDependencies(){return s({chip:()=>t(()=>import(`./calcite-chip-DHdJ6msM.js`),__vite__mapDeps([25,4,5,9,11,1,2,13,14,3,6,16,7])),icon:()=>t(()=>import(`./calcite-icon-D_iKcGa4.js`),__vite__mapDeps([0,1,2,3,4,5,6,7])),list:()=>t(()=>import(`./calcite-list-CgWjPxHf.js`),__vite__mapDeps([26,4,5,9,10,11,1,12,13,14,15,16,17,18,2,3,6,27,28,7,19,22,20,29,30])),"list-item":()=>t(()=>import(`./calcite-list-item-BNrqiIAE.js`),__vite__mapDeps([31,4,5,9,11,1,32,33,30,12,2,13,14,3,6,24,34,35,16,28,36,17,37,38,39,7,22])),tooltip:()=>t(()=>import(`./calcite-tooltip-DOISgjum.js`),__vite__mapDeps([40,4,5,41,17,1,33,30,2,24]))})}destroy(){this.tooltipReferenceMap.clear()}render(){let e=this.viewModel.associationViewModels,{state:t,showAllEnabled:n}=this.viewModel,{state:r}=this.parentFeatureViewModel??{};return p(`div`,{class:this.classes(T.base,u.widget)},t===`loading`||t===`querying`||r===`loading`?this.renderLoading():p(`calcite-list`,{displayMode:E,label:this.selectedLayer?.title??this.messagesCommon.untitled},n&&this.selectedLayer?p(c,null,this.renderFilter(),this.renderFeatureCountWarning(),this._renderAssociatedFeatureListPage(),this.renderFeatureObserver()):Array.from(e.keys(),t=>this._renderTypeList(t,e.get(t)))))}_showAllAssociations(e){let{flowItems:t,viewModel:n,description:r}=this;if(!t||!e)return;n.showAllEnabled=!0;let i=new C({selectedLayer:e,title:e?.title,flowItems:t,parentFeatureViewModel:this.parentFeatureViewModel,featureVisibleElements:this.featureVisibleElements,description:r,visibleElements:new h({title:!1,description:!1}),viewModel:n});t.push(i)}_renderAssociatedFeatureListPage(){let e=this.viewModel.associationViewModels.get(this.selectedLayer).filter(e=>e.title.toLowerCase().includes(this.filterText)).slice(0,this.endIndex);return[...this._renderTooltips(e),...this._renderAssociatedFeatureList(e)]}_renderItemTooltip(e){let{tooltipReferenceMap:t}=this;return x(e.association)?p(`calcite-tooltip`,{key:`tooltip-${e.featureViewModel.uid}`,overlayPositioning:`fixed`,referenceElement:t.get(e.featureViewModel.uid)},this.getConnectivityTooltip(e.association.associationType)):null}_renderAssociatedFeature(e){let{featureViewModel:t,title:n}=e,r=t.state===`loading`,i=this._findFlowItem(t),a=i<0&&this._isParentFeature(t),o=a||i>=0;return p(`calcite-list-item`,{class:r?T.listItemHidden:void 0,description:m(e.terminalName??``),key:`associated-feature-type-${t.uid}`,label:m(n),onCalciteListItemSelect:()=>this._handleFeatureClick(a,i,t)},x(e.association)?this.renderConnectivityIcon(e.association.associationType,e.featureViewModel.uid):null,S(e.association)?p(`calcite-chip`,{label:b(e.association),scale:`s`,slot:`content-end`},b(e.association)):null,this._renderChevronIconNode(o))}async _selectAssociation(e){let{flowItems:n,featureVisibleElements:r}=this;if(!n)return;e.abilities={utilityNetworkAssociationsContent:!0};let{default:i}=await t(async()=>{let{default:e}=await import(`./Feature-CglJwaNJ.js`);return{default:e}},__vite__mapDeps([42,43,4,5,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68]));n.push(new i({flowItems:n,flowType:`feature-association`,viewModel:e,visibleElements:r}))}_handleFeatureClick(e,t,n){if(e)this.flowItems.drain(e=>{`showAllEnabled`in e.viewModel&&(e.viewModel.showAllEnabled=!1),e.viewModel=null,e.destroy()});else if(t<0||!this.flowItems)this._selectAssociation(n);else for(;this.flowItems.length>t+1;){let e=this.flowItems.pop();e&&(`showAllEnabled`in e.viewModel&&(e.viewModel.showAllEnabled=!1),e.viewModel=null,e.destroy())}}_featureViewModelMatch(e,t){let n=e.graphic,r=n?.layer,i=null;r?.type===`subtype-sublayer`&&r.parent?i=r.parent.globalIdField??null:r&&`globalIdField`in r&&(i=r.globalIdField);let a=i?n?.attributes[i]:null,o=t.graphic,s=o?.layer,c=null;s?.type===`subtype-sublayer`&&s.parent?c=s.parent.globalIdField??null:s&&`globalIdField`in s&&(c=s.globalIdField);let l=c?o?.attributes[c]:null;return a&&l&&a===l}_isParentFeature(e){let t=this.flowItems?.getItemAt(0);if(!t)return!1;let n=t.parentFeatureViewModel;return this._featureViewModelMatch(n,e)}_findFlowItem(e){return this.flowItems?.findIndex(t=>{if(t.flowType!==`feature-association`)return!1;let n=t.viewModel;return this._featureViewModelMatch(n,e)})??-1}_renderTooltips(e){return e.toArray().map(e=>this._renderItemTooltip(e))}_renderAssociatedFeatureList(e){return e.toArray().map(e=>this._renderAssociatedFeature(e))}_renderChevronIconNode(e){return p(`calcite-icon`,{flipRtl:!0,icon:e?`move-up`:`chevron-right`,scale:`s`,slot:`content-end`})}_renderTypeList(e,t){let{messagesFeature:n}=this,{displayCount:r}=this.viewModel,i=t.slice(0,r),a=i.length<t.length;return p(`calcite-list-item`,{expanded:!0,key:`show-all`,label:e.title,value:e.id},p(`calcite-chip`,{label:String(t.length),scale:`s`,slot:`content-end`},t.length),p(`calcite-list`,{group:e.id,label:e.title??``},[this._renderTooltips(i),this._renderAssociatedFeatureList(i)],a?p(`calcite-list-item`,{description:o(n?.numberRecords,{number:t.length.toString()}),key:`show-all-item`,label:n.showAll,onCalciteListItemSelect:()=>this._showAllAssociations(e)},p(`calcite-icon`,{icon:`list`,scale:`s`,slot:`content-end`})):null))}};e([r()],D.prototype,`description`,void 0),e([r()],D.prototype,`featureVisibleElements`,void 0),e([r()],D.prototype,`flowItems`,void 0),e([r()],D.prototype,`flowType`,void 0),e([r()],D.prototype,`listType`,void 0),e([r()],D.prototype,`parentFeatureViewModel`,void 0),e([r()],D.prototype,`title`,void 0),e([r({type:g})],D.prototype,`viewModel`,void 0),e([r({type:h,nonNullable:!0})],D.prototype,`visibleElements`,void 0),D=C=e([d(`esri.widgets.Feature.FeatureUtilityNetworkAssociationList`)],D);var O=D;export{O as default};