import{$f as e,$l as t,Zf as n,aS as r,ep as i,ob as a,pS as o,vy as s}from"./index-BqmCqmfp.js";import{t as c}from"./earcut-Drx511Ix.js";import{o as l}from"./Indices-BsTLKVdx.js";import{b as u,f as d,y as f}from"./plane-CTjDePZl.js";import{t as p}from"./deduplicate-BuZ0DaaO.js";function m(e,t,n){let r=h(g,e,t,n)?u(g):[0,0,1];return Math.abs(r[2])>Math.cos(a(80))?2:Math.abs(r[1])>Math.abs(r[0])?1:0}function h(e,n,i,a){let s=(e=>!Array.isArray(e[0]))(n)?(e,t)=>n[3*e+t]:(e,t)=>n[e][t],c=a?r(a)/o(a):1;return d(e,(e,n)=>t(e,s(n,0)*c,s(n,1)*c,s(n,2)),i)}var g=f();function _(t){let n=y(t.rings,t.hasZ,1,t.spatialReference),r=[],a=0,o=0;for(let t of n.polygons){let i=t.count,s=t.index,u=e(n.position,3*s,3*i),d=t.holeIndices.map(e=>e-s),f=l(c(u,d,3));r.push({position:u,faces:f}),a+=u.length,o+=f.length}let s=v(r,a,o),u=Array.isArray(s.position)?p(s.position,3,{originalIndices:s.faces}):p(s.position.buffer,6,{originalIndices:s.faces});return s.position=i(new Float64Array(u.buffer)),s.faces=u.indices,s}function v(e,t,r){if(e.length===1)return e[0];let i=n(t),a=Array(r),o=0,s=0,c=0;for(let t of e){for(let e=0;e<t.position.length;e++)i[o++]=t.position[e];for(let e of t.faces)a[s++]=e+c;c=o/3}return{position:i,faces:l(a)}}function y(e,t,r,i){let a=e.length,o=Array(a),s=Array(a),c=Array(a),l=0;for(let t=0;t<a;++t)l+=e[t].length;let u=0,d=0,f=0,p=n(3*l),m=0;for(let n=a-1;n>=0;n--){let l=e[n],h=r===1&&x(l,t,i);if(h&&a!==1)o[u++]=l;else{let e=l.length;for(let t=0;t<u;++t)e+=o[t].length;let n={index:m,pathLengths:Array(u+1),count:e,holeIndices:Array(u)};n.pathLengths[0]=l.length,l.length>0&&(c[f++]={index:m,count:l.length}),m=h?b(l,l.length-1,-1,p,m,l.length,t):b(l,0,1,p,m,l.length,t);for(let e=0;e<u;++e){let r=o[e];n.holeIndices[e]=m,n.pathLengths[e+1]=r.length,r.length>0&&(c[f++]={index:m,count:r.length}),m=b(r,0,1,p,m,r.length,t)}u=0,n.count>0&&(s[d++]=n)}}for(let e=0;e<u;++e){let n=o[e];n.length>0&&(c[f++]={index:m,count:n.length}),m=b(n,0,1,p,m,n.length,t)}return s.length=d,c.length=f,{position:p,polygons:s,outlines:c}}function b(e,t,n,r,i,a,o){i*=3;for(let s=0;s<a;++s){let a=e[t];r[i++]=a[0],r[i++]=a[1],r[i++]=o&&a[2]?a[2]:0,t+=n}return i/3}function x(e,t,n){if(!t)return!s(e);let r=e.length-1;switch(m(e,r,n)){case 0:return!s(e,1,2);case 1:return!s(e,0,2);case 2:return!s(e,0,1)}}export{y as n,m as r,_ as t};