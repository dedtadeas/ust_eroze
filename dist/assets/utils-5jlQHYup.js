const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/symbolLayerUtils-BlVFgvbf.js","assets/index-BqmCqmfp.js","assets/index-kIqmb12G.css"])))=>i.map(i=>d[i]);
import{Aa as e,Cw as t,Ug as n,Vd as r,Wy as i,op as a,qh as o,uC as s,zd as c}from"./index-BqmCqmfp.js";import{i as l,t as u}from"./cimSymbolUtils-1FVTTBxd.js";import{o as d}from"./gfxUtils-DZoKCRMw.js";function f(e){let t=e.symbolLayers?.at(-1);if(t&&`outline`in t)return t?.outline?.size}function p(e){return e?c(e)?f(e)??0:o(d(e)?.width):0}function m(e){if(e==null||!(`symbolLayers`in e)||e.symbolLayers==null)return!1;switch(e.type){case`point-3d`:return e.symbolLayers.some(e=>e.type===`object`);case`line-3d`:return e.symbolLayers.some(e=>e.type===`path`);case`polygon-3d`:return e.symbolLayers.some(e=>e.type===`object`||e.type===`extrude`);default:return!1}}function h(e){return e.resource?.href??``}function g(e,t){if(!e)return null;let n=null;return c(e)?n=_(e):r(e)&&(n=e.type===`cim`?l(e):e.color?new i(e.color):null),n?v(n,t):null}function _(e){let t=e.symbolLayers;if(!t)return null;let n=null;return t.forEach(e=>{e.type===`object`&&e.resource?.href||(n=e.type===`water`?e.color:e.material?e.material.color:null)}),n?new i(n):null}function v(e,t){if(t==null||e==null)return e;let n=e.toRgba();return n[3]*=t,new i(n)}function y(e,t,n){let r=e.symbolLayers;if(!r)return;let o=(e,r=!1)=>{let a=t??e??null;return n?.override!=null&&(!a&&r&&(a=new i([255,255,255])),a&&(a.a=n.override)),v(a,n?.add)};r.forEach(e=>{if(e.type===`water`)return void(e.color=v(e.color,n?.add));let t=e.material==null?null:e.material.color,r=o(t,e.type===`icon`&&e.resource?.href!=null);e.material==null?e.material=new a({color:r}):e.material.color=r,`outline`in e&&e.outline?.color&&n?.add!=null&&(e.outline.color=v(e.outline.color,n.add)),`marker`in e&&e.marker!=null&&(e.marker.color=o(e.marker.color))})}function b(e,t,n){t??=e.color,n?.override!=null&&t&&(t.a=n.override),t&&(e.color=v(t,n?.add)),`outline`in e&&e.outline?.color&&(e.outline.color=v(e.outline.color,n?.add))}function x(e,t,n){e&&(t||n!=null)&&(t&&=new i(t),c(e)?y(e,t,n):r(e)&&b(e,t,n))}async function S(e,t){let n=e.symbolLayers;n&&await s(n,async e=>C(e,t))}async function C(e,t){switch(e.type){case`extrude`:E(e,t);break;case`icon`:case`line`:case`text`:w(e,t);break;case`path`:O(e,t);break;case`object`:await D(e,t)}}function w(e,t){let n=T(t);n!=null&&(e.size=n)}function T(e){for(let t of e)if(typeof t==`number`)return t;return null}function E(e,t){let n=t[2];typeof n==`number`&&(e.size=n)}async function D(e,t){let{resourceSize:n,symbolSize:r}=await A(e),i=k(t,n,r);i!=null&&(e.width=j(t[0],r[0],n[0],i),e.depth=j(t[1],r[1],n[1],i),e.height=j(t[2],r[2],n[2],i))}function O(e,t){let r=k(t,n,[e.width,void 0,e.height]);r!=null&&(e.width=j(t[0],e.width,1,r),e.height=j(t[2],e.height,1,r))}function k(e,t,n){for(let r=0;r<3;r++){let i=e[r];switch(i){case`symbol-value`:{let e=n[r];return e==null?1:e/t[r]}case`proportional`:break;default:if(i&&t[r])return i/t[r]}}return null}async function A(e){let{computeObjectLayerResourceSize:n}=await t(async()=>{let{computeObjectLayerResourceSize:e}=await import(`./symbolLayerUtils-BlVFgvbf.js`);return{computeObjectLayerResourceSize:e}},__vite__mapDeps([0,1,2])),r=await n(e,10),{width:i,height:a,depth:o}=e,s=[i,o,a],c=1;for(let e=0;e<3;e++){let t=s[e];if(t!=null){c=t/r[e];break}}for(let e=0;e<3;e++)s[e]??(s[e]=r[e]*c);return{resourceSize:r,symbolSize:s}}function j(e,t,n,r){switch(e){case`proportional`:return n*r;case`symbol-value`:return t??n;default:return e}}function M(e,t){let n=T(t);if(n!=null)switch(e.type){case`simple-marker`:e.size=n;break;case`picture-marker`:{let t=e.width/e.height;t>1?(e.width=n,e.height=n*t):(e.width=n*t,e.height=n);break}case`simple-line`:e.width=n;break;case`text`:e.font.size=n}}async function N(e,t){if(e&&t)return c(e)?S(e,t):void(r(e)&&M(e,t))}function P(e,t,n){if(e&&t!=null){if(c(e)){let r=e.symbolLayers;r&&r.forEach(e=>{if(e.type===`object`)switch(n){case`tilt`:e.tilt=(e.tilt??0)+t;break;case`roll`:e.roll=(e.roll??0)+t;break;default:e.heading=(e.heading??0)+t}e.type===`icon`&&(e.angle+=t)})}else if(r(e))switch(e.type){case`simple-marker`:case`picture-marker`:case`text`:e.angle+=t;break;case`cim`:u(e,t,!0)}}}function F(t,n){if(!t)return null;let r=(n?t.effects:t.effects.filter(e=>e.type!==`bloom`)).map(e=>e.toJSON());return e(r)}function I(e){return e!=null&&e.type===`polygon-3d`&&e.symbolLayers.some(e=>e.type===`extrude`)}export{g as a,p as c,P as i,F as l,x as n,h as o,N as r,m as s,I as t};