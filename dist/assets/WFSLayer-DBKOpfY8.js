const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AttributeBinsQuery-AhqeSGKe.js","assets/queryUtils-BA7HiGeg.js","assets/index-BqmCqmfp.js","assets/index-kIqmb12G.css","assets/FixedIntervalBinParameters-BO-nZFQ3.js","assets/AttributeBinsQuery-DyK0zHZB.js"])))=>i.map(i=>d[i]);
import{Ad as e,CD as t,Cd as n,Cw as r,EE as i,Ea as a,Fm as o,Gi as s,H as c,J as l,Ji as u,K as d,Kw as f,L as p,La as m,MC as h,Mb as g,Np as _,Pa as ee,Q as te,Ra as v,Sx as y,U as b,Ui as x,Ux as S,WT as C,X as ne,Xi as re,Yi as ie,Z as ae,Zi as w,Zn as T,_E as E,ao as D,bD as O,cm as k,eT as A,fp as j,gp as M,hC as N,hp as P,it as F,kC as I,ka as L,lt as R,mx as oe,oC as z,qm as B,rt as V,sa as H,sx as se,ta as U,tt as W,ut as G,vE as K,va as q,zC as J,zr as ce}from"./index-BqmCqmfp.js";import"./memoryEstimations-O7VgDRVG.js";import"./OptimizedFeature-Dx4_lHip.js";import"./OptimizedGeometry-f3I9Z6C1.js";import"./QueryEngineCapabilities-DPTJ40n4.js";import{i as le,r as ue}from"./clientSideDefaults-CpyaF_rm.js";import"./date-DKxAu4UK.js";import"./geojson-HXfjj8c5.js";import"./xmlUtils-HEdXfQxd.js";import{c as de,i as fe,r as pe,s as me,t as he}from"./wfsUtils-BPCk15Sc.js";import{t as ge}from"./AttributeBinsFeatureSet-Cw3XBtzs.js";var _e=Symbol(`isWFSGraphicOrigin`),Y,ve=class extends m{get[(Y=_e,j)](){return this.layer}get[P](){return this.layer}get[v](){return this.layer}constructor(e){super(),this[Y]=!0,this.type=`wfs`,this.layer=e}get id(){return this.layer.id}},X=class extends N{constructor(){super(...arguments),this._connection=null,this._workerHandler=null,this.capabilities=le(!1,!1),this.type=`wfs`,this.refresh=f(async()=>{await this.load();let e={customParameters:this.layer.customParameters,maxRecordCount:this.layer.maxRecordCount,maxTotalRecordCount:this.layer.maxTotalRecordCount,maxPageCount:this.layer.maxPageCount},{extent:t}=await this._workerHandler.refresh(e);return t&&(this.sourceJSON.extent=t),{dataChanged:!0,updates:{extent:this.sourceJSON.extent}}})}load(e){let t=e==null?null:e.signal;return this.addResolvingPromise(this._startWorker({signal:t})),Promise.resolve(this)}destroy(){this._connection?.close(),this._connection=null,this._workerHandler=null}async openPorts(){return await this.load(),this._connection.openPorts()}async queryFeatures(e,t={}){let n=await this.queryFeaturesJSON(e,t);return ee.fromJSON(n)}async queryFeaturesJSON(e,t={}){return await this.load(t),this._workerHandler.queryFeatures(e?e.toJSON():void 0,t)}async queryFeatureCount(e,t={}){return await this.load(t),this._workerHandler.queryFeatureCount(e?e.toJSON():void 0,t)}async queryObjectIds(e,t={}){return await this.load(t),this._workerHandler.queryObjectIds(e?e.toJSON():void 0,t)}async queryExtent(e,t={}){await this.load(t);let n=await this._workerHandler.queryExtent(e?e.toJSON():void 0,t);return{count:n.count,extent:y.fromJSON(n.extent)}}async querySnapping(e,t={}){return await this.load(t),this._workerHandler.querySnapping(e,t)}async queryAttributeBins(e,t={}){await this.load(t);let n=await this._workerHandler.queryAttributeBins(e?.toJSON(),t);return ge.fromJSON(n)}async _createLoadOptions(e){let{url:t,customParameters:n,name:r,namespaceUri:i,fields:a,geometryType:o,maxRecordCount:s,maxPageCount:c,maxTotalRecordCount:l,swapXY:u}=this.layer,d=this.layer.originOf(`spatialReference`)===`defaults`?void 0:this.layer.spatialReference;if(!t)throw new E(`wfs-layer:missing-url`,`WFSLayer must be created with a url`);this.wfsCapabilities||=await me(t,{customParameters:n,...e});let f=[`fields`,`geometryType`,`name`,`namespaceUri`,`swapXY`].some(e=>this.layer[e]==null)?await pe(this.wfsCapabilities,r,i,{spatialReference:d,customParameters:n,signal:e?.signal}):{...de(a??[]),geometryType:o,name:r,namespaceUri:i,spatialReference:d,swapXY:u},p=fe(this.wfsCapabilities.readFeatureTypes(),f.name,f.namespaceUri),m=B.toJSON(f.geometryType),{operations:h}=this.wfsCapabilities,g=h.GetFeature.url,_=h.GetFeature.outputFormat;return{customParameters:n,featureType:p,fields:f.fields?.map(e=>e.toJSON())??[],geometryField:f.geometryField,geometryType:m,getFeatureUrl:g,getFeatureOutputFormat:_,maxRecordCount:s,maxPageCount:c,maxTotalRecordCount:l,objectIdField:f.objectIdField,spatialReference:f.spatialReference?.toJSON(),swapXY:!!f.swapXY}}async _startWorker(e){let[t,n]=await A([this._createLoadOptions(e),o(`WFSSourceWorker`,{...e,strategy:O(`feature-layers-workers`)?`dedicated`:`local`,registryTarget:this})]),r=t.error||n.error||null,i=n.value||null;if(r)throw i&&i.close(),r;let a=t.value;this._connection=n.value,this._workerHandler=this._connection.createInvokeProxy();let s=await this._workerHandler.load(a,e);for(let e of s.warnings)K.getLogger(this.layer).warn(`#load()`,`${e.message} (title: '${this.layer.title||`no title`}', id: '${this.layer.id??`no id`}')`,{warning:e});this.sourceJSON={dateFieldsTimeReference:{timeZoneIANA:`UTC`},extent:s.extent,fields:a.fields,geometryType:a.geometryType,objectIdField:a.objectIdField,geometryField:a.geometryField,drawingInfo:ue(a.geometryType),name:a.featureType.title,wfsInfo:{name:a.featureType.name,featureUrl:a.getFeatureUrl,maxFeatures:a.maxRecordCount,swapXY:a.swapXY,supportedSpatialReferences:a.featureType.supportedSpatialReferences,version:`2.0.0`,wfsNamespace:a.featureType.namespaceUri}}}};t([h()],X.prototype,`capabilities`,void 0),t([h({constructOnly:!0})],X.prototype,`layer`,void 0),t([h()],X.prototype,`sourceJSON`,void 0),t([h()],X.prototype,`type`,void 0),t([h()],X.prototype,`wfsCapabilities`,void 0),X=t([I(`esri.layers.graphics.sources.WFSSource`)],X);var Z,Q=b(),$=Z=class extends W(q(a(F(H(L(l(d(ae(ne(V(te(D(g))))))))))))){static fromWFSLayerInfo(e){let{customParameters:t,fields:n,geometryField:r,geometryType:i,name:a,namespaceUri:o,objectIdField:s,spatialReference:c,swapXY:l,url:u,wfsCapabilities:d}=e;return new Z({customParameters:t,fields:n,geometryField:r,geometryType:i,name:a,namespaceUri:o,objectIdField:s,spatialReference:c,swapXY:l,url:u,wfsCapabilities:d})}constructor(e){super(e),this.copyright=null,this.customParameters=null,this.dateFieldsTimeZone=null,this.definitionExpression=null,this.displayField=null,this.elevationInfo=null,this.featureUrl=void 0,this.fields=null,this.fieldsIndex=null,this.fullExtent=null,this.geometryType=null,this.graphicOrigin=new ve(this),this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.operationalLayerType=`WFS`,this.maxRecordCount=3e3,this.maxPageCount=10,this.maxTotalRecordCount=2e5,this.mode=0,this.name=null,this.namespaceUri=null,this.outFields=null,this.popupEnabled=!0,this.popupTemplate=null,this.screenSizePerspectiveEnabled=!0,this.source=new X({layer:this}),this.spatialReference=S.WGS84,this.spatialReferences=[4326],this.swapXY=void 0,this.title=`WFS`,this.type=`wfs`,this.url=null,this.version=void 0}destroy(){this.source?.destroy()}load(e){return this.addResolvingPromise(this.loadFromPortal({supportedTypes:[`WFS`]},e).then(()=>this.source.load(e)).then(()=>{this.read(this.source.sourceJSON,{origin:`service`,url:this.parsedUrl}),this.revert([`objectIdField`,`fields`,`timeInfo`,`spatialReference`,`name`,`namespaceUri`],`service`),k(this.renderer,this.fieldsIndex),_(this.timeInfo,this.fieldsIndex)})),Promise.resolve(this)}get capabilities(){return this.source?.capabilities}get createQueryVersion(){return this.commitProperty(`definitionExpression`),this.commitProperty(`timeExtent`),this.commitProperty(`timeOffset`),this.commitProperty(`geometryType`),this.commitProperty(`capabilities`),(this._get(`createQueryVersion`)||0)+1}get defaultPopupTemplate(){return this.createPopupTemplate()}writeFields(t,n,r){let a=t.filter(e=>e.name!==he);this.geometryField&&a.unshift(new e({name:this.geometryField,alias:this.geometryField,type:`geometry`})),i(r,a.map(e=>e.toJSON()),n)}get parsedUrl(){return C(this.url)}set renderer(e){k(e,this.fieldsIndex),this._set(`renderer`,e)}get wfsCapabilities(){return this.source?.wfsCapabilities}set wfsCapabilities(e){this.source&&(this.source.wfsCapabilities=e)}createPopupTemplate(e){return p(this,e)}createQuery(){let e=new n({returnGeometry:!0,outFields:[`*`],where:this.definitionExpression||`1=1`}),{timeOffset:t,timeExtent:r}=this;return e.timeExtent=t!=null&&r!=null?r.offset(-t.value,t.unit):r||null,e}getFieldDomain(e,t){return this.getField(e)?.domain}getField(e){return this.fieldsIndex?.get(e)}queryFeatures(e,t){return this.load().then(()=>this.source.queryFeatures(n.from(e)||this.createQuery(),t)).then(e=>{if(e?.features)for(let t of e.features)t.layer=t.sourceLayer=this,t.origin=this.graphicOrigin;return e})}queryObjectIds(e,t){return this.load().then(()=>this.source.queryObjectIds(n.from(e)||this.createQuery(),t))}queryFeatureCount(e,t){return this.load().then(()=>this.source.queryFeatureCount(n.from(e)||this.createQuery(),t))}queryExtent(e,t){return this.load().then(()=>this.source.queryExtent(n.from(e)||this.createQuery(),t))}async queryAttributeBins(e,t){let{source:n,capabilities:i}=await this.load();ce(e,i,`WFSLayer`);let a=await r(()=>import(`./AttributeBinsQuery-AhqeSGKe.js`),__vite__mapDeps([0,1,2,3,4,5])),o=await n.queryAttributeBins(a.default.from(e),t);if(o.features)for(let e of o.features)e.layer=e.sourceLayer=this;return o}async hasDataChanged(){try{let{dataChanged:e,updates:t}=await this.source.refresh();return t!=null&&this.read(t,{origin:`service`,url:this.parsedUrl,ignoreDefaults:!0}),e}catch{}return!1}};t([h({readOnly:!0})],$.prototype,`capabilities`,null),t([h({type:String})],$.prototype,`copyright`,void 0),t([h({readOnly:!0})],$.prototype,`createQueryVersion`,null),t([h({json:{name:`wfsInfo.customParameters`,write:{overridePolicy:e=>({enabled:!!(e&&Object.keys(e).length>0),ignoreOrigin:!0})}}})],$.prototype,`customParameters`,void 0),t([h(se(`dateFieldsTimeReference`))],$.prototype,`dateFieldsTimeZone`,void 0),t([h({readOnly:!0})],$.prototype,`defaultPopupTemplate`,null),t([h({type:String,json:{name:`layerDefinition.definitionExpression`,write:{enabled:!0,allowNull:!0}}})],$.prototype,`definitionExpression`,void 0),t([h({type:String})],$.prototype,`displayField`,void 0),t([h(ie)],$.prototype,`elevationInfo`,void 0),t([h({type:String,readOnly:!0,json:{name:`wfsInfo.featureUrl`,write:{ignoreOrigin:!0,isRequired:!0}}})],$.prototype,`featureUrl`,void 0),t([h({type:[e],json:{name:`layerDefinition.fields`,write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:`fields`}}}})],$.prototype,`fields`,void 0),t([z(`fields`)],$.prototype,`writeFields`,null),t([h(Q.fieldsIndex)],$.prototype,`fieldsIndex`,void 0),t([h({type:y,json:{name:`extent`}})],$.prototype,`fullExtent`,void 0),t([h()],$.prototype,`geometryField`,void 0),t([h({type:String,json:{read:{source:`layerDefinition.geometryType`,reader:B.read},write:{target:`layerDefinition.geometryType`,writer:B.write,ignoreOrigin:!0},origins:{service:{read:B.read}}}})],$.prototype,`geometryType`,void 0),t([h({readOnly:!0,clonable:!1})],$.prototype,`graphicOrigin`,void 0),t([h({type:String})],$.prototype,`id`,void 0),t([h(re)],$.prototype,`labelsVisible`,void 0),t([h({type:[T],json:{name:`layerDefinition.drawingInfo.labelingInfo`,read:{reader:c},write:!0}})],$.prototype,`labelingInfo`,void 0),t([h(s)],$.prototype,`legendEnabled`,void 0),t([h({type:[`show`,`hide`]})],$.prototype,`listMode`,void 0),t([h({type:String})],$.prototype,`objectIdField`,void 0),t([h({type:[`WFS`]})],$.prototype,`operationalLayerType`,void 0),t([h({type:J,json:{name:`wfsInfo.maxFeatures`,write:{ignoreOrigin:!0,isRequired:!0}}})],$.prototype,`maxRecordCount`,void 0),t([h({type:J})],$.prototype,`maxPageCount`,void 0),t([h({type:J})],$.prototype,`maxTotalRecordCount`,void 0),t([h({type:[0],readOnly:!0,json:{origins:{"web-map":{write:{ignoreOrigin:!0,isRequired:!0}}}}})],$.prototype,`mode`,void 0),t([h({type:String,json:{name:`wfsInfo.name`,write:{ignoreOrigin:!0,isRequired:!0}}})],$.prototype,`name`,void 0),t([h({type:String,json:{name:`wfsInfo.wfsNamespace`,write:{ignoreOrigin:!0,isRequired:!0}}})],$.prototype,`namespaceUri`,void 0),t([h(x)],$.prototype,`opacity`,void 0),t([h(Q.outFields)],$.prototype,`outFields`,void 0),t([h({readOnly:!0})],$.prototype,`parsedUrl`,null),t([h(u)],$.prototype,`popupEnabled`,void 0),t([h({type:M,json:{name:`popupInfo`,write:!0}})],$.prototype,`popupTemplate`,void 0),t([h({types:R,json:{origins:{service:{name:`drawingInfo.renderer`},"web-scene":{types:G,name:`layerDefinition.drawingInfo.renderer`,write:!0}},name:`layerDefinition.drawingInfo.renderer`,write:{ignoreOrigin:!0}}})],$.prototype,`renderer`,null),t([h(w)],$.prototype,`screenSizePerspectiveEnabled`,void 0),t([h({readOnly:!0})],$.prototype,`source`,void 0),t([h({type:S,json:{name:`layerDefinition.spatialReference`,write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:`extent.spatialReference`}}}})],$.prototype,`spatialReference`,void 0),t([h({readOnly:!0,type:[J],json:{name:`wfsInfo.supportedSpatialReferences`,write:{ignoreOrigin:!0,isRequired:!0}}})],$.prototype,`spatialReferences`,void 0),t([h({type:Boolean,value:!1,json:{name:`wfsInfo.swapXY`,write:{ignoreOrigin:!0,isRequired:!0}}})],$.prototype,`swapXY`,void 0),t([h({json:{write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:`name`}}}})],$.prototype,`title`,void 0),t([h({json:{read:!1},readOnly:!0})],$.prototype,`type`,void 0),t([h(U)],$.prototype,`url`,void 0),t([h({type:String,readOnly:!0,json:{name:`wfsInfo.version`,write:{ignoreOrigin:!0,isRequired:!0}}})],$.prototype,`version`,void 0),t([h()],$.prototype,`wfsCapabilities`,null),$=Z=t([I(`esri.layers.WFSLayer`)],$);var ye=$;export{ye as default};